["<s>", "public", "void", "append", "(", "Object", "key", ")", "{", "elements", ".", "add", "(", "key", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isNotTail", "(", "TreeKey", "treeKey", ")", "{", "return", "!", "treeKey", ".", "equals", "(", "elements", ".", "get", "(", "elements", ".", "size", "(", ")", "-", "1", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "dismissOldDialog", "(", ")", "{", "if", "(", "visibleDialog", "!", "=", "null", ")", "{", "visibleDialog", ".", "dismiss", "(", ")", ";", "visibleDialog", "=", "null", ";", "}", "}", "</s>"]
["<s>", "private", "Flow", "getFlow", "(", ")", "{", "return", "Flow", ".", "get", "(", "MultiKeySampleActivity", ".", "this", ")", ";", "}", "</s>"]
["<s>", "static", "ViewAssertion", "doesNotHaveFlowService", "(", "final", "String", "serviceName", ")", "{", "return", "new", "FlowServiceIsNull", "(", "serviceName", ",", "true", ")", ";", "}", "</s>"]
["<s>", "static", "ViewAssertion", "hasFlowService", "(", "final", "String", "serviceName", ")", "{", "return", "new", "FlowServiceIsNull", "(", "serviceName", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "editsAreSaved", "(", ")", "{", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "doesNotHaveFlowService", "(", "CONTACTS_STORAGE", ")", ")", ".", "check", "(", "doesNotHaveFlowService", "(", "CONTACT_EDITOR", ")", ")", ";", "onView", "(", "withText", "(", "new", "WelcomeScreen", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACTS_STORAGE", ")", ")", ".", "check", "(", "doesNotHaveFlowService", "(", "CONTACT_EDITOR", ")", ")", ";", "onData", "(", "contactWithId", "(", "HOMER", ".", "id", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACT_EDITOR", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACTS_STORAGE", ")", ")", ";", "String", "originalName", "=", "HOMER", ".", "name", ";", "String", "originalEmail", "=", "HOMER", ".", "email", ";", "String", "editedName", "=", "originalName", "+", "\"", "<STR_LIT>", "\"", ";", "String", "editedEmail", "=", "originalEmail", "+", "\"", "<STR_LIT>", "\"", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "email", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "originalEmail", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "edit_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "originalName", ")", ")", ")", ".", "perform", "(", "ViewActions", ".", "typeText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "editedName", ")", ")", ")", ".", "perform", "(", "ViewActions", ".", "pressImeActionButton", "(", ")", ")", ";", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACT_EDITOR", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACTS_STORAGE", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "editedName", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "edit_email", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "originalEmail", ")", ")", ")", ".", "perform", "(", "ViewActions", ".", "typeText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "editedEmail", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "save", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "doesNotHaveFlowService", "(", "CONTACT_EDITOR", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACTS_STORAGE", ")", ")", ";", "onData", "(", "contactWithId", "(", "HOMER", ".", "id", ")", ")", ".", "onChildView", "(", "withId", "(", "R", ".", "id", ".", "contact_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "editedName", ")", ")", ")", ";", "onData", "(", "contactWithId", "(", "HOMER", ".", "id", ")", ")", ".", "onChildView", "(", "withId", "(", "R", ".", "id", ".", "contact_email", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "editedEmail", ")", ")", ")", ";", "pressBack", "(", ")", ";", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "doesNotHaveFlowService", "(", "CONTACTS_STORAGE", ")", ")", ".", "check", "(", "doesNotHaveFlowService", "(", "CONTACT_EDITOR", ")", ")", ";", "onView", "(", "withText", "(", "new", "WelcomeScreen", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withParent", "(", "withId", "(", "android", ".", "R", ".", "id", ".", "content", ")", ")", ")", ".", "check", "(", "hasFlowService", "(", "CONTACTS_STORAGE", ")", ")", ";", "onData", "(", "contactWithId", "(", "HOMER", ".", "id", ")", ")", ".", "onChildView", "(", "withId", "(", "R", ".", "id", ".", "contact_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "originalName", ")", ")", ")", ";", "onData", "(", "contactWithId", "(", "HOMER", ".", "id", ")", ")", ".", "onChildView", "(", "withId", "(", "R", ".", "id", ".", "contact_email", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "originalEmail", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Matcher", "<", "Contact", ">", "contactWithId", "(", "String", "contactId", ")", "{", "final", "String", "contactId1", "=", "contactId", ";", "return", "new", "BaseMatcher", "<", "Contact", ">", "(", ")", "{", "private", "final", "String", "contactId", "=", "contactId1", ";", "@", "Override", "public", "boolean", "matches", "(", "Object", "o", ")", "{", "return", "o", "instanceof", "Contact", "&", "&", "contactId", ".", "equals", "(", "(", "(", "Contact", ")", "o", ")", ".", "id", ")", ";", "}", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "\"", "<STR_LIT>", "\"", "+", "contactId", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "private", "void", "showLayout", "(", "Context", "context", ",", "@", "LayoutRes", "int", "layout", ")", "{", "LayoutInflater", "inflater", "=", "LayoutInflater", ".", "from", "(", "context", ")", ";", "setContentView", "(", "inflater", ".", "inflate", "(", "layout", ",", "null", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "showKeyAsText", "(", "Context", "context", ",", "Object", "key", ",", "@", "Nullable", "final", "Object", "nextScreenOnClick", ")", "{", "TextView", "view", "=", "new", "TextView", "(", "context", ")", ";", "view", ".", "setText", "(", "key", ".", "toString", "(", ")", ")", ";", "setContentView", "(", "view", ")", ";", "if", "(", "nextScreenOnClick", "=", "=", "null", ")", "{", "view", ".", "setOnClickListener", "(", "null", ")", ";", "}", "else", "{", "view", ".", "setOnClickListener", "(", "new", "View", ".", "OnClickListener", "(", ")", "{", "@", "Override", "public", "void", "onClick", "(", "View", "v", ")", "{", "Flow", ".", "get", "(", "v", ")", ".", "set", "(", "nextScreenOnClick", ")", ";", "}", "}", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Contact", "toContact", "(", ")", "{", "return", "new", "Contact", "(", "id", ",", "name", ",", "email", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "Contact", ">", "listContacts", "(", ")", "{", "return", "unmodifiableList", "(", "new", "ArrayList", "<", ">", "(", "contacts", ".", "values", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "Contact", "getContact", "(", "String", "id", ")", "{", "return", "contacts", ".", "get", "(", "id", ")", ";", "}", "</s>"]
["<s>", "public", "void", "save", "(", "Contact", "contact", ")", "{", "contacts", ".", "put", "(", "contact", ".", "id", ",", "contact", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setContacts", "(", "List", "<", "Contact", ">", "contacts", ")", "{", "this", ".", "contacts", ".", "clear", "(", ")", ";", "this", ".", "contacts", ".", "addAll", "(", "contacts", ")", ";", "notifyDataSetChanged", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "walkthrough", "(", ")", "{", "onView", "(", "withText", "(", "new", "ScreenOne", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "check", "(", "matches", "(", "isDisplayed", "(", ")", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenOne", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withText", "(", "new", "DialogScreen", "(", "new", "ScreenTwo", "(", ")", ")", ".", "toString", "(", ")", ")", ")", ".", "inRoot", "(", "isDialog", "(", ")", ")", ".", "check", "(", "matches", "(", "isDisplayed", "(", ")", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenOne", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "inRoot", "(", "withDecorView", "(", "is", "(", "rule", ".", "getActivity", "(", ")", ".", "getWindow", "(", ")", ".", "getDecorView", "(", ")", ")", ")", ")", ";", "rotate", "(", ")", ";", "onView", "(", "withText", "(", "new", "DialogScreen", "(", "new", "ScreenTwo", "(", ")", ")", ".", "toString", "(", ")", ")", ")", ".", "inRoot", "(", "isDialog", "(", ")", ")", ".", "check", "(", "matches", "(", "isDisplayed", "(", ")", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenOne", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "inRoot", "(", "withDecorView", "(", "is", "(", "rule", ".", "getActivity", "(", ")", ".", "getWindow", "(", ")", ".", "getDecorView", "(", ")", ")", ")", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "inRoot", "(", "isDialog", "(", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenTwo", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "check", "(", "matches", "(", "isDisplayed", "(", ")", ")", ")", ";", "pressBack", "(", ")", ";", "onView", "(", "withText", "(", "new", "DialogScreen", "(", "new", "ScreenTwo", "(", ")", ")", ".", "toString", "(", ")", ")", ")", ".", "inRoot", "(", "isDialog", "(", ")", ")", ".", "check", "(", "matches", "(", "isDisplayed", "(", ")", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenOne", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "inRoot", "(", "withDecorView", "(", "is", "(", "rule", ".", "getActivity", "(", ")", ".", "getWindow", "(", ")", ".", "getDecorView", "(", ")", ")", ")", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "inRoot", "(", "isDialog", "(", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenTwo", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withText", "(", "new", "ScreenOne", "(", ")", ".", "toString", "(", ")", ")", ")", ".", "check", "(", "matches", "(", "isDisplayed", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "State", "getState", "(", "Object", "key", ")", "{", "return", "keyManager", ".", "getState", "(", "key", ")", ";", "}", "</s>"]
["<s>", "List", "<", "Object", ">", "asList", "(", ")", "{", "final", "ArrayList", "<", "Object", ">", "copy", "=", "new", "ArrayList", "<", ">", "(", "history", ")", ";", "return", "unmodifiableList", "(", "copy", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "save", "(", "Bundle", "bundle", ",", "KeyParceler", "parceler", ",", "History", "history", ",", "KeyManager", "keyManager", ")", "{", "ArrayList", "<", "Parcelable", ">", "parcelables", "=", "new", "ArrayList", "<", ">", "(", "history", ".", "size", "(", ")", ")", ";", "final", "Iterator", "<", "Object", ">", "keys", "=", "history", ".", "reverseIterator", "(", ")", ";", "while", "(", "keys", ".", "hasNext", "(", ")", ")", "{", "Object", "key", "=", "keys", ".", "next", "(", ")", ";", "if", "(", "!", "key", ".", "getClass", "(", ")", ".", "isAnnotationPresent", "(", "NotPersistent", ".", "class", ")", ")", "{", "parcelables", ".", "add", "(", "keyManager", ".", "getState", "(", "key", ")", ".", "toBundle", "(", "parceler", ")", ")", ";", "}", "}", "bundle", ".", "putParcelableArrayList", "(", "PERSISTENCE_KEY", ",", "parcelables", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "load", "(", "Bundle", "bundle", ",", "KeyParceler", "parceler", ",", "History", ".", "Builder", "builder", ",", "KeyManager", "keyManager", ")", "{", "if", "(", "!", "bundle", ".", "containsKey", "(", "PERSISTENCE_KEY", ")", ")", "return", ";", "ArrayList", "<", "Parcelable", ">", "stateBundles", "=", "bundle", ".", "getParcelableArrayList", "(", "PERSISTENCE_KEY", ")", ";", "for", "(", "Parcelable", "stateBundle", ":", "stateBundles", ")", "{", "State", "state", "=", "State", ".", "fromBundle", "(", "(", "Bundle", ")", "stateBundle", ",", "parceler", ")", ";", "builder", ".", "push", "(", "state", ".", "getKey", "(", ")", ")", ";", "if", "(", "!", "keyManager", ".", "hasState", "(", "state", ".", "getKey", "(", ")", ")", ")", "{", "keyManager", ".", "addState", "(", "state", ")", ";", "}", "}", "}", "</s>"]
["<s>", "boolean", "hasState", "(", "Object", "key", ")", "{", "return", "states", ".", "containsKey", "(", "key", ")", ";", "}", "</s>"]
["<s>", "void", "addState", "(", "State", "state", ")", "{", "states", ".", "put", "(", "state", ".", "getKey", "(", ")", ",", "state", ")", ";", "}", "</s>"]
["<s>", "State", "getState", "(", "Object", "key", ")", "{", "State", "state", "=", "states", ".", "get", "(", "key", ")", ";", "if", "(", "state", "=", "=", "null", ")", "{", "state", "=", "new", "State", "(", "key", ")", ";", "addState", "(", "state", ")", ";", "}", "return", "state", ";", "}", "</s>"]
["<s>", "void", "clearStatesExcept", "(", "List", "<", "Object", ">", "keep", ")", "{", "Iterator", "<", "Object", ">", "keys", "=", "states", ".", "keySet", "(", ")", ".", "iterator", "(", ")", ";", "while", "(", "keys", ".", "hasNext", "(", ")", ")", "{", "final", "Object", "key", "=", "keys", ".", "next", "(", ")", ";", "if", "(", "!", "keep", ".", "contains", "(", "key", ")", ")", "keys", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "replaceHistory", "(", "final", "Object", "key", ",", "final", "Direction", "direction", ")", "{", "setHistory", "(", "getHistory", "(", ")", ".", "buildUpon", "(", ")", ".", "clear", "(", ")", ".", "push", "(", "key", ")", ".", "build", "(", ")", ",", "direction", ")", ";", "}", "</s>"]
["<s>", "public", "void", "replaceTop", "(", "final", "Object", "key", ",", "final", "Direction", "direction", ")", "{", "setHistory", "(", "getHistory", "(", ")", ".", "buildUpon", "(", ")", ".", "pop", "(", "1", ")", ".", "push", "(", "key", ")", ".", "build", "(", ")", ",", "direction", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "replaceHistoryResultsInLengthOneHistory", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ",", "charlie", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "flow", ".", "replaceHistory", "(", "delta", ",", "Flow", ".", "Direction", ".", "REPLACE", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", "=", "=", "delta", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "delta", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "REPLACE", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "replaceTopDoesNotAlterHistoryLength", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ",", "charlie", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "flow", ".", "replaceTop", "(", "delta", ",", "Flow", ".", "Direction", ".", "REPLACE", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", "=", "=", "delta", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "delta", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "REPLACE", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setDispatcher", "(", "Dispatcher", "dispatcher", ")", "{", "this", ".", "dispatcher", "=", "checkNotNull", "(", "dispatcher", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "pendingTraversal", "=", "=", "null", "|", "|", "(", "pendingTraversal", ".", "state", "=", "=", "TraversalState", ".", "DISPATCHED", "&", "&", "pendingTraversal", ".", "next", "=", "=", "null", ")", ")", "{", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "void", "doExecute", "(", ")", "{", "bootstrap", "(", "history", ")", ";", "}", "}", ")", ";", "return", ";", "}", "if", "(", "pendingTraversal", ".", "state", "=", "=", "TraversalState", ".", "ENQUEUED", ")", "{", "pendingTraversal", ".", "execute", "(", ")", ";", "return", ";", "}", "if", "(", "pendingTraversal", ".", "state", "!", "=", "TraversalState", ".", "DISPATCHED", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", "+", "pendingTraversal", ".", "state", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "setHistory", "(", "final", "History", "history", ",", "final", "Direction", "direction", ")", "{", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "void", "doExecute", "(", ")", "{", "dispatch", "(", "preserveEquivalentPrefix", "(", "getHistory", "(", ")", ",", "history", ")", ",", "direction", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "void", "dispatch", "(", "History", "nextHistory", ",", "Direction", "direction", ")", "{", "this", ".", "nextHistory", "=", "checkNotNull", "(", "nextHistory", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "dispatcher", "=", "=", "null", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "keyManager", ".", "setUp", "(", "nextHistory", ".", "top", "(", ")", ")", ";", "dispatcher", ".", "dispatch", "(", "new", "Traversal", "(", "getHistory", "(", ")", ",", "nextHistory", ",", "direction", ",", "keyManager", ")", ",", "this", ")", ";", "}", "</s>"]
