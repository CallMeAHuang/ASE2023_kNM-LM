["<s>", "@", "Override", "protected", "void", "attachBaseContext", "(", "Context", "baseContext", ")", "{", "baseContext", "=", "Flow", ".", "configure", "(", "baseContext", ",", "this", ")", ".", "install", "(", ")", ";", "super", ".", "attachBaseContext", "(", "baseContext", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onBackPressed", "(", ")", "{", "if", "(", "!", "Flow", ".", "get", "(", "this", ")", ".", "goBack", "(", ")", ")", "{", "super", ".", "onBackPressed", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "defaultKeyIsUsed", "(", ")", "{", "onView", "(", "withId", "(", "R", ".", "id", ".", "basic_activity_frame", ")", ")", ".", "check", "(", "matches", "(", "hasDescendant", "(", "isAssignableFrom", "(", "WelcomeView", ".", "class", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "rotationMaintainsState", "(", ")", "{", "onView", "(", "withId", "(", "R", ".", "id", ".", "welcome_screen_name", ")", ")", ".", "perform", "(", "ViewActions", ".", "typeText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "rotate", "(", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "welcome_screen_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "welcome_screen_name", ")", ")", ".", "perform", "(", "ViewActions", ".", "typeText", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "hello_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "hello_increment", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "hello_counter", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "rotate", "(", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "hello_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "hello_counter", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "goingBackWorksAndRestoresState", "(", ")", "{", "onView", "(", "withId", "(", "R", ".", "id", ".", "welcome_screen_name", ")", ")", ".", "perform", "(", "ViewActions", ".", "typeText", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "basic_activity_frame", ")", ")", ".", "check", "(", "matches", "(", "hasDescendant", "(", "isAssignableFrom", "(", "HelloView", ".", "class", ")", ")", ")", ")", ";", "pressBack", "(", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "basic_activity_frame", ")", ")", ".", "check", "(", "matches", "(", "hasDescendant", "(", "isAssignableFrom", "(", "WelcomeView", ".", "class", ")", ")", ")", ")", ";", "onView", "(", "withId", "(", "R", ".", "id", ".", "welcome_screen_name", ")", ")", ".", "check", "(", "matches", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "rotate", "(", ")", "{", "Configuration", "config", "=", "InstrumentationRegistry", ".", "getTargetContext", "(", ")", ".", "getResources", "(", ")", ".", "getConfiguration", "(", ")", ";", "rule", ".", "getActivity", "(", ")", ".", "setRequestedOrientation", "(", "(", "config", ".", "orientation", "=", "=", "ORIENTATION_PORTRAIT", ")", "?", "SCREEN_ORIENTATION_LANDSCAPE", ":", "SCREEN_ORIENTATION_PORTRAIT", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCreate", "(", "Bundle", "savedInstanceState", ")", "{", "super", ".", "onCreate", "(", "savedInstanceState", ")", ";", "setContentView", "(", "R", ".", "layout", ".", "basic_activity_frame", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "attachBaseContext", "(", "Context", "baseContext", ")", "{", "baseContext", "=", "Flow", ".", "configure", "(", "baseContext", ",", "this", ")", ".", "dispatcher", "(", "new", "BasicDispatcher", "(", "this", ")", ")", ".", "defaultKey", "(", "new", "WelcomeScreen", "(", ")", ")", ".", "keyParceler", "(", "new", "BasicKeyParceler", "(", ")", ")", ".", "install", "(", ")", ";", "super", ".", "attachBaseContext", "(", "baseContext", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onBackPressed", "(", ")", "{", "if", "(", "!", "Flow", ".", "get", "(", "this", ")", ".", "goBack", "(", ")", ")", "{", "super", ".", "onBackPressed", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeToParcel", "(", "Parcel", "dest", ",", "int", "flags", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "describeContents", "(", ")", "{", "return", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "WelcomeScreen", "createFromParcel", "(", "Parcel", "in", ")", "{", "return", "new", "WelcomeScreen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "WelcomeScreen", "[", "]", "newArray", "(", "int", "size", ")", "{", "return", "new", "WelcomeScreen", "[", "size", "]", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "return", "o", "!", "=", "null", "&", "&", "o", "instanceof", "WelcomeScreen", ";", "}", "</s>"]
["<s>", "HelloScreen", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "protected", "HelloScreen", "(", "Parcel", "in", ")", "{", "name", "=", "in", ".", "readString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HelloScreen", "createFromParcel", "(", "Parcel", "in", ")", "{", "return", "new", "HelloScreen", "(", "in", ".", "readString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HelloScreen", "[", "]", "newArray", "(", "int", "size", ")", "{", "return", "new", "HelloScreen", "[", "size", "]", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "describeContents", "(", ")", "{", "return", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeToParcel", "(", "Parcel", "dest", ",", "int", "flags", ")", "{", "dest", ".", "writeString", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "HelloScreen", "that", "=", "(", "HelloScreen", ")", "o", ";", "return", "name", ".", "equals", "(", "that", ".", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "name", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "public", "WelcomeView", "(", "Context", "context", ",", "AttributeSet", "attrs", ")", "{", "super", "(", "context", ",", "attrs", ")", ";", "setOrientation", "(", "VERTICAL", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onFinishInflate", "(", ")", "{", "super", ".", "onFinishInflate", "(", ")", ";", "EditText", "nameView", "=", "(", "EditText", ")", "findViewById", "(", "R", ".", "id", ".", "welcome_screen_name", ")", ";", "nameView", ".", "setOnEditorActionListener", "(", "new", "TextView", ".", "OnEditorActionListener", "(", ")", "{", "@", "Override", "public", "boolean", "onEditorAction", "(", "TextView", "view", ",", "int", "actionId", ",", "KeyEvent", "event", ")", "{", "Flow", ".", "get", "(", "view", ")", ".", "set", "(", "new", "HelloScreen", "(", "view", ".", "getText", "(", ")", ".", "toString", "(", ")", ")", ")", ";", "return", "true", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onEditorAction", "(", "TextView", "view", ",", "int", "actionId", ",", "KeyEvent", "event", ")", "{", "Flow", ".", "get", "(", "view", ")", ".", "set", "(", "new", "HelloScreen", "(", "view", ".", "getText", "(", ")", ".", "toString", "(", ")", ")", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "BasicDispatcher", "(", "Activity", "activity", ")", "{", "this", ".", "activity", "=", "activity", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Flow", ".", "Traversal", "traversal", ",", "Flow", ".", "TraversalCallback", "callback", ")", "{", "Log", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "traversal", ")", ";", "Object", "dest", "=", "traversal", ".", "destination", ".", "top", "(", ")", ";", "ViewGroup", "frame", "=", "(", "ViewGroup", ")", "activity", ".", "findViewById", "(", "R", ".", "id", ".", "basic_activity_frame", ")", ";", "if", "(", "traversal", ".", "origin", "!", "=", "null", ")", "{", "if", "(", "frame", ".", "getChildCount", "(", ")", ">", "0", ")", "{", "traversal", ".", "origin", ".", "topSaveState", "(", ")", ".", "save", "(", "frame", ".", "getChildAt", "(", "0", ")", ")", ";", "frame", ".", "removeAllViews", "(", ")", ";", "}", "}", "@", "LayoutRes", "final", "int", "layout", ";", "if", "(", "dest", "instanceof", "HelloScreen", ")", "{", "layout", "=", "R", ".", "layout", ".", "hello_screen", ";", "}", "else", "if", "(", "dest", "instanceof", "WelcomeScreen", ")", "{", "layout", "=", "R", ".", "layout", ".", "welcome_screen", ";", "}", "else", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", "+", "dest", ")", ";", "}", "View", "incomingView", "=", "LayoutInflater", ".", "from", "(", "traversal", ".", "createContext", "(", "dest", ",", "activity", ")", ")", ".", "inflate", "(", "layout", ",", "frame", ",", "false", ")", ";", "frame", ".", "addView", "(", "incomingView", ")", ";", "traversal", ".", "destination", ".", "topSaveState", "(", ")", ".", "restore", "(", "incomingView", ")", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Parcelable", "toParcelable", "(", "Object", "key", ")", "{", "return", "(", "Parcelable", ")", "key", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "toKey", "(", "Parcelable", "parcelable", ")", "{", "return", "parcelable", ";", "}", "</s>"]
["<s>", "public", "HelloView", "(", "Context", "context", ",", "AttributeSet", "attrs", ")", "{", "super", "(", "context", ",", "attrs", ")", ";", "setOrientation", "(", "VERTICAL", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onAttachedToWindow", "(", ")", "{", "super", ".", "onAttachedToWindow", "(", ")", ";", "HelloScreen", "screen", "=", "Flow", ".", "getKey", "(", "this", ")", ";", "(", "(", "TextView", ")", "findViewById", "(", "R", ".", "id", ".", "hello_name", ")", ")", ".", "setText", "(", "\"", "<STR_LIT>", "\"", "+", "screen", ".", "name", ")", ";", "final", "TextView", "counter", "=", "(", "TextView", ")", "findViewById", "(", "R", ".", "id", ".", "hello_counter", ")", ";", "findViewById", "(", "R", ".", "id", ".", "hello_increment", ")", ".", "setOnClickListener", "(", "new", "OnClickListener", "(", ")", "{", "@", "Override", "public", "void", "onClick", "(", "View", "v", ")", "{", "String", "text", "=", "counter", ".", "getText", "(", ")", ".", "toString", "(", ")", ";", "if", "(", "text", ".", "isEmpty", "(", ")", ")", "text", "=", "\"", "<STR_LIT:0>", "\"", ";", "Integer", "current", "=", "Integer", ".", "valueOf", "(", "text", ")", ";", "counter", ".", "setText", "(", "String", ".", "valueOf", "(", "current", "+", "1", ")", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onClick", "(", "View", "v", ")", "{", "String", "text", "=", "counter", ".", "getText", "(", ")", ".", "toString", "(", ")", ";", "if", "(", "text", ".", "isEmpty", "(", ")", ")", "text", "=", "\"", "<STR_LIT:0>", "\"", ";", "Integer", "current", "=", "Integer", ".", "valueOf", "(", "text", ")", ";", "counter", ".", "setText", "(", "String", ".", "valueOf", "(", "current", "+", "1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "builderCanPushPeekAndPopObjects", "(", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "List", "<", "TestState", ">", "objects", "=", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ";", "for", "(", "Object", "object", ":", "objects", ")", "{", "builder", ".", "push", "(", "object", ")", ";", "}", "for", "(", "int", "i", "=", "objects", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "Object", "object", "=", "objects", ".", "get", "(", "i", ")", ";", "assertThat", "(", "builder", ".", "peek", "(", ")", ")", ".", "isSameAs", "(", "object", ")", ";", "assertThat", "(", "builder", ".", "pop", "(", ")", ")", ".", "isSameAs", "(", "object", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "builderCanPopTo", "(", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "builder", ".", "push", "(", "ABLE", ")", ";", "builder", ".", "push", "(", "BAKER", ")", ";", "builder", ".", "push", "(", "CHARLIE", ")", ";", "builder", ".", "popTo", "(", "ABLE", ")", ";", "assertThat", "(", "builder", ".", "peek", "(", ")", ")", ".", "isSameAs", "(", "ABLE", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "builderPopToExplodesOnMissingState", "(", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "builder", ".", "push", "(", "ABLE", ")", ";", "builder", ".", "push", "(", "BAKER", ")", ";", "builder", ".", "push", "(", "CHARLIE", ")", ";", "try", "{", "builder", ".", "popTo", "(", "new", "Object", "(", ")", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ignored", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "builderCanPopCount", "(", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "builder", ".", "push", "(", "ABLE", ")", ";", "builder", ".", "push", "(", "BAKER", ")", ";", "builder", ".", "push", "(", "CHARLIE", ")", ";", "builder", ".", "pop", "(", "1", ")", ";", "assertThat", "(", "builder", ".", "peek", "(", ")", ")", ".", "isSameAs", "(", "BAKER", ")", ";", "builder", ".", "pop", "(", "<NUM_LIT:2>", ")", ";", "assertThat", "(", "builder", ".", "isEmpty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "builderPopExplodesIfCountIsTooLarge", "(", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "builder", ".", "push", "(", "ABLE", ")", ";", "builder", ".", "push", "(", "BAKER", ")", ";", "builder", ".", "push", "(", "CHARLIE", ")", ";", "try", "{", "builder", ".", "pop", "(", "<NUM_LIT:4>", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ignored", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "forwardIterator", "(", ")", "{", "List", "<", "Object", ">", "paths", "=", "new", "ArrayList", "<", ">", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ")", ";", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "paths", ")", ".", "build", "(", ")", ";", "for", "(", "Object", "o", ":", "history", ")", "{", "assertThat", "(", "o", ")", ".", "isSameAs", "(", "paths", ".", "remove", "(", "paths", ".", "size", "(", ")", "-", "1", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "reverseIterator", "(", ")", "{", "List", "<", "Object", ">", "paths", "=", "new", "ArrayList", "<", ">", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ")", ";", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "paths", ")", ".", "build", "(", ")", ";", "Iterator", "<", "Object", ">", "i", "=", "history", ".", "reverseIterator", "(", ")", ";", "while", "(", "i", ".", "hasNext", "(", ")", ")", "{", "assertThat", "(", "i", ".", "next", "(", ")", ")", ".", "isSameAs", "(", "paths", ".", "remove", "(", "0", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "emptyBuilderPeekIsNullable", "(", ")", "{", "assertThat", "(", "History", ".", "emptyBuilder", "(", ")", ".", "peek", "(", ")", ")", ".", "isNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "emptyBuilderPopThrows", "(", ")", "{", "try", "{", "History", ".", "emptyBuilder", "(", ")", ".", "pop", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "IllegalStateException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "isEmpty", "(", ")", "{", "final", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "assertThat", "(", "builder", ".", "isEmpty", "(", ")", ")", ".", "isTrue", "(", ")", ";", "builder", ".", "push", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "builder", ".", "isEmpty", "(", ")", ")", ".", "isFalse", "(", ")", ";", "builder", ".", "pop", "(", ")", ";", "assertThat", "(", "builder", ".", "isEmpty", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "historyIndexAccess", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ")", ".", "build", "(", ")", ";", "assertThat", "(", "history", ".", "peek", "(", "0", ")", ")", ".", "isEqualTo", "(", "CHARLIE", ")", ";", "assertThat", "(", "history", ".", "peek", "(", "1", ")", ")", ".", "isEqualTo", "(", "BAKER", ")", ";", "assertThat", "(", "history", ".", "peek", "(", "<NUM_LIT:2>", ")", ")", ".", "isEqualTo", "(", "ABLE", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "builderPreservesViewState", "(", ")", "{", "List", "<", "TestState", ">", "states", "=", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ";", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "states", ")", ".", "build", "(", ")", ";", "for", "(", "int", "i", "=", "states", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "View", "view", "=", "mock", "(", "View", ".", "class", ")", ";", "Parcelable", "viewState", "=", "mock", "(", "Parcelable", ".", "class", ")", ";", "mockSaveViewState", "(", "view", ",", "viewState", ")", ";", "history", ".", "peekSaveState", "(", "i", ")", ".", "save", "(", "view", ")", ";", "}", "History", "rebuiltHistory", "=", "history", ".", "buildUpon", "(", ")", ".", "clear", "(", ")", ".", "addAll", "(", "states", ")", ".", "build", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "history", ".", "size", "(", ")", ";", "i", "+", "+", ")", "{", "assertEquals", "(", "\"", "<STR_LIT>", "\"", "+", "i", ",", "history", ".", "peekSaveState", "(", "i", ")", ",", "rebuiltHistory", ".", "peekSaveState", "(", "i", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "mockSaveViewState", "(", "View", "view", ",", "final", "Parcelable", "viewState", ")", "{", "doAnswer", "(", "new", "Answer", "(", ")", "{", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "SparseArray", "<", "Parcelable", ">", "outState", "=", "(", "SparseArray", "<", "Parcelable", ">", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ";", "outState", ".", "put", "(", "0", ",", "viewState", ")", ";", "return", "null", ";", "}", "}", ")", ".", "when", "(", "view", ")", ".", "saveHierarchyState", "(", "Matchers", ".", "<", "SparseArray", "<", "Parcelable", ">", ">", "any", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "SparseArray", "<", "Parcelable", ">", "outState", "=", "(", "SparseArray", "<", "Parcelable", ">", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ";", "outState", ".", "put", "(", "0", ",", "viewState", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "initMocks", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "reentrantGo", "(", ")", "{", "Flow", ".", "Dispatcher", "dispatcher", "=", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "navigation", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "navigation", ".", "destination", ";", "Object", "next", "=", "navigation", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "next", "instanceof", "Detail", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "dispatcher", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Error", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "navigation", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "navigation", ".", "destination", ";", "Object", "next", "=", "navigation", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "next", "instanceof", "Detail", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "reentrantGoThenBack", "(", ")", "{", "Flow", ".", "Dispatcher", "dispatcher", "=", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "boolean", "loading", "=", "true", ";", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "navigation", ",", "TraversalCallback", "onComplete", ")", "{", "lastStack", "=", "navigation", ".", "destination", ";", "Object", "next", "=", "navigation", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "loading", ")", "{", "if", "(", "next", "instanceof", "Detail", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Error", ")", "{", "loading", "=", "false", ";", "flow", ".", "goBack", "(", ")", ";", "}", "}", "else", "{", "if", "(", "next", "instanceof", "Loading", ")", "{", "ReentranceTest", ".", "this", ".", "flow", ".", "goBack", "(", ")", ";", "}", "}", "onComplete", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "dispatcher", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "navigation", ",", "TraversalCallback", "onComplete", ")", "{", "lastStack", "=", "navigation", ".", "destination", ";", "Object", "next", "=", "navigation", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "loading", ")", "{", "if", "(", "next", "instanceof", "Detail", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Error", ")", "{", "loading", "=", "false", ";", "flow", ".", "goBack", "(", ")", ";", "}", "}", "else", "{", "if", "(", "next", "instanceof", "Loading", ")", "{", "ReentranceTest", ".", "this", ".", "flow", ".", "goBack", "(", ")", ";", "}", "}", "onComplete", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "reentrantForwardThenGo", "(", ")", "{", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "Object", "next", "=", "traversal", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "next", "instanceof", "Detail", ")", "{", "ReentranceTest", ".", "this", ".", "flow", ".", "setHistory", "(", "History", ".", "emptyBuilder", "(", ")", ".", "push", "(", "new", "Detail", "(", ")", ")", ".", "push", "(", "new", "Loading", "(", ")", ")", ".", "build", "(", ")", ",", "FORWARD", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "ReentranceTest", ".", "this", ".", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "this", ".", "flow", "=", "flow", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Error", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Detail", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "Object", "next", "=", "traversal", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "next", "instanceof", "Detail", ")", "{", "ReentranceTest", ".", "this", ".", "flow", ".", "setHistory", "(", "History", ".", "emptyBuilder", "(", ")", ".", "push", "(", "new", "Detail", "(", ")", ")", ".", "push", "(", "new", "Loading", "(", ")", ")", ".", "build", "(", ")", ",", "FORWARD", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "ReentranceTest", ".", "this", ".", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "reentranceWaitsForCallback", "(", ")", "{", "Flow", ".", "Dispatcher", "dispatcher", "=", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "lastCallback", "=", "callback", ";", "Object", "next", "=", "traversal", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "next", "instanceof", "Detail", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "}", "}", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "dispatcher", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Error", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "lastCallback", "=", "callback", ";", "Object", "next", "=", "traversal", ".", "destination", ".", "top", "(", ")", ";", "if", "(", "next", "instanceof", "Detail", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "else", "if", "(", "next", "instanceof", "Loading", ")", "{", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "onCompleteThrowsIfCalledTwice", "(", ")", "{", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "lastCallback", "=", "callback", ";", "}", "}", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "try", "{", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "}", "catch", "(", "IllegalStateException", "e", ")", "{", "return", ";", "}", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "lastCallback", "=", "callback", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "bootstrapTraversal", "(", ")", "{", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "pendingTraversalReplacesBootstrap", "(", ")", "{", "final", "AtomicInteger", "dispatchCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "dispatchCount", ".", "incrementAndGet", "(", ")", ";", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "assertThat", "(", "dispatchCount", ".", "intValue", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "dispatchCount", ".", "incrementAndGet", "(", ")", ";", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "allPendingTraversalsFire", "(", ")", "{", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastCallback", "=", "callback", ";", "}", "}", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Detail", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastCallback", "=", "callback", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "clearingDispatcherMidTraversalPauses", "(", ")", "{", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "flow", ".", "removeDispatcher", "(", "this", ")", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "flow", ".", "removeDispatcher", "(", "this", ")", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "dispatcherSetInMidFlightWaitsForBootstrap", "(", ")", "{", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastCallback", "=", "callback", ";", "}", "}", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "assertThat", "(", "lastStack", ")", ".", "isNull", "(", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastCallback", "=", "callback", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "dispatcherSetInMidFlightWithBigQueueNeedsNoBootstrap", "(", ")", "{", "final", "AtomicInteger", "secondDispatcherCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "lastCallback", "=", "callback", ";", "}", "}", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "secondDispatcherCount", ".", "incrementAndGet", "(", ")", ";", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "assertThat", "(", "lastStack", ")", ".", "isNull", "(", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "assertThat", "(", "secondDispatcherCount", ".", "get", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "lastCallback", "=", "callback", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "secondDispatcherCount", ".", "incrementAndGet", "(", ")", ";", "lastStack", "=", "traversal", ".", "destination", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "traversalsQueuedAfterDispatcherRemovedBootstrapTheNextOne", "(", ")", "{", "final", "AtomicInteger", "secondDispatcherCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastCallback", "=", "callback", ";", "flow", ".", "removeDispatcher", "(", "this", ")", ";", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "}", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Flow", ".", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "secondDispatcherCount", ".", "incrementAndGet", "(", ")", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", ")", ";", "assertThat", "(", "secondDispatcherCount", ".", "get", "(", ")", ")", ".", "isZero", "(", ")", ";", "lastCallback", ".", "onTraversalCompleted", "(", ")", ";", "assertThat", "(", "secondDispatcherCount", ".", "get", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "verifyHistory", "(", "flow", ".", "getHistory", "(", ")", ",", "new", "Loading", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastCallback", "=", "callback", ";", "flow", ".", "removeDispatcher", "(", "this", ")", ";", "flow", ".", "set", "(", "new", "Loading", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "secondDispatcherCount", ".", "incrementAndGet", "(", ")", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "Catalog", "(", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "Detail", "(", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "Loading", "(", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "Error", "(", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "void", "verifyHistory", "(", "History", "history", ",", "Object", ".", ".", ".", "screens", ")", "{", "List", "<", "Object", ">", "actualScreens", "=", "new", "ArrayList", "<", ">", "(", "history", ".", "size", "(", ")", ")", ";", "for", "(", "Object", "entry", ":", "history", ")", "{", "actualScreens", ".", "add", "(", "entry", ")", ";", "}", "assertThat", "(", "actualScreens", ")", ".", "containsExactly", "(", "screens", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", "{", "lastStack", "=", "traversal", ".", "destination", ";", "lastDirection", "=", "traversal", ".", "direction", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "initMocks", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "oneTwoThree", "(", ")", "{", "History", "history", "=", "History", ".", "single", "(", "new", "Uno", "(", ")", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "flow", ".", "set", "(", "new", "Dos", "(", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isInstanceOf", "(", "Dos", ".", "class", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isSameAs", "(", "Flow", ".", "Direction", ".", "FORWARD", ")", ";", "flow", ".", "set", "(", "new", "Tres", "(", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isInstanceOf", "(", "Tres", ".", "class", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isSameAs", "(", "Flow", ".", "Direction", ".", "FORWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isInstanceOf", "(", "Dos", ".", "class", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isSameAs", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isInstanceOf", "(", "Uno", ".", "class", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isSameAs", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "historyChangesAfterListenerCall", "(", ")", "{", "final", "History", "firstHistory", "=", "History", ".", "single", "(", "new", "Uno", "(", ")", ")", ";", "class", "Ourrobouros", "implements", "Flow", ".", "Dispatcher", "{", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "firstHistory", ")", ";", "{", "flow", ".", "setDispatcher", "(", "this", ")", ";", "}", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "onComplete", ")", "{", "assertThat", "(", "firstHistory", ")", ".", "hasSameSizeAs", "(", "flow", ".", "getHistory", "(", ")", ")", ";", "Iterator", "<", "Object", ">", "original", "=", "firstHistory", ".", "iterator", "(", ")", ";", "for", "(", "Object", "o", ":", "flow", ".", "getHistory", "(", ")", ")", "{", "assertThat", "(", "o", ")", ".", "isEqualTo", "(", "original", ".", "next", "(", ")", ")", ";", "}", "onComplete", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", "Ourrobouros", "listener", "=", "new", "Ourrobouros", "(", ")", ";", "listener", ".", "flow", ".", "set", "(", "new", "Dos", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "onComplete", ")", "{", "assertThat", "(", "firstHistory", ")", ".", "hasSameSizeAs", "(", "flow", ".", "getHistory", "(", ")", ")", ";", "Iterator", "<", "Object", ">", "original", "=", "firstHistory", ".", "iterator", "(", ")", ";", "for", "(", "Object", "o", ":", "flow", ".", "getHistory", "(", ")", ")", "{", "assertThat", "(", "o", ")", ".", "isEqualTo", "(", "original", ".", "next", "(", ")", ")", ";", "}", "onComplete", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "historyAddAllIsPushy", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ",", "charlie", ")", ")", ".", "build", "(", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "baker", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "able", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "setHistoryWorks", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "FlowDispatcher", "dispatcher", "=", "new", "FlowDispatcher", "(", ")", ";", "flow", ".", "setDispatcher", "(", "dispatcher", ")", ";", "History", "newHistory", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "charlie", ",", "delta", ")", ")", ".", "build", "(", ")", ";", "flow", ".", "setHistory", "(", "newHistory", ",", "Flow", ".", "Direction", ".", "FORWARD", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isSameAs", "(", "Flow", ".", "Direction", ".", "FORWARD", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "delta", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "charlie", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "setObjectGoesBack", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ",", "charlie", ",", "delta", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:4>", ")", ";", "flow", ".", "set", "(", "charlie", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "charlie", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "baker", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "able", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "setObjectToMissingObjectPushes", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:2>", ")", ";", "flow", ".", "set", "(", "charlie", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "charlie", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "FORWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "baker", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "able", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "setObjectKeepsOriginal", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:2>", ")", ";", "flow", ".", "set", "(", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", "=", "=", "able", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "able", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Test", "public", "void", "setHistoryKeepsOriginals", "(", ")", "{", "TestState", "able", "=", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "TestState", "baker", "=", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "TestState", "charlie", "=", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "TestState", "delta", "=", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ",", "charlie", ",", "delta", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:4>", ")", ";", "TestState", "echo", "=", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "TestState", "foxtrot", "=", "new", "TestState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "History", "newHistory", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "baker", ",", "echo", ",", "foxtrot", ")", ")", ".", "build", "(", ")", ";", "flow", ".", "setHistory", "(", "newHistory", ",", "Flow", ".", "Direction", ".", "REPLACE", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:4>", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "foxtrot", ")", ";", "flow", ".", "goBack", "(", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "echo", ")", ";", "flow", ".", "goBack", "(", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:2>", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "baker", ")", ";", "flow", ".", "goBack", "(", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isSameAs", "(", "able", ")", ";", "}", "</s>"]
["<s>", "Picky", "(", "String", "value", ")", "{", "this", ".", "value", "=", "value", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "Picky", "picky", "=", "(", "Picky", ")", "o", ";", "return", "value", ".", "equals", "(", "picky", ".", "value", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "value", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "setCallsEquals", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "addAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ",", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ",", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ",", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "assertThat", "(", "history", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:4>", ")", ";", "flow", ".", "set", "(", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastStack", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "lastStack", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "new", "Picky", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "lastDirection", ")", ".", "isEqualTo", "(", "Flow", ".", "Direction", ".", "BACKWARD", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "TestState", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "TestState", "screen", "=", "(", "TestState", ")", "o", ";", "return", "name", ".", "equals", "(", "screen", ".", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "name", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "this", ")", ";", "}", "</s>"]
["<s>", "private", "Preconditions", "(", ")", "{", "throw", "new", "AssertionError", "(", ")", ";", "}", "</s>"]
["<s>", "static", "void", "checkArgument", "(", "boolean", "condition", ",", "String", "errorMessage", ")", "{", "if", "(", "!", "condition", ")", "{", "throw", "new", "IllegalArgumentException", "(", "errorMessage", ")", ";", "}", "}", "</s>"]
["<s>", "static", "<", "T", ">", "T", "checkNotNull", "(", "T", "reference", ",", "String", "errorMessage", ",", "Object", ".", ".", ".", "args", ")", "{", "if", "(", "reference", "=", "=", "null", ")", "{", "throw", "new", "NullPointerException", "(", "String", ".", "format", "(", "errorMessage", ",", "args", ")", ")", ";", "}", "return", "reference", ";", "}", "</s>"]
["<s>", "public", "abstract", "void", "bindServices", "(", "Services", ".", "Binder", "services", ")", ";", "</s>"]
["<s>", "public", "void", "tearDown", "(", "Services", "services", ")", "{", "}", "</s>"]
["<s>", "public", "Builder", "(", "Activity", "activity", ")", "{", "this", ".", "activity", "=", "activity", ";", "}", "</s>"]
["<s>", "public", "Builder", "withKeyChanger", "(", "KeyChanger", "changer", ")", "{", "this", ".", "keyChanger", "=", "checkNotNull", "(", "changer", ",", "\"", "<STR_LIT>", "\"", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Flow", ".", "Dispatcher", "build", "(", ")", "{", "final", "KeyChanger", "keyChanger", "=", "this", ".", "keyChanger", "=", "=", "null", "?", "new", "DefaultKeyChanger", "(", "activity", ")", ":", "this", ".", "keyChanger", ";", "return", "new", "KeyDispatcher", "(", "activity", ",", "keyChanger", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "configure", "(", "Activity", "activity", ")", "{", "return", "new", "Builder", "(", "activity", ")", ";", "}", "</s>"]
["<s>", "private", "KeyDispatcher", "(", "Activity", "activity", ",", "KeyChanger", "keyChanger", ")", "{", "this", ".", "activity", "=", "activity", ";", "this", ".", "keyChanger", "=", "keyChanger", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dispatch", "(", "Flow", ".", "Traversal", "traversal", ",", "Flow", ".", "TraversalCallback", "callback", ")", "{", "State", "inState", "=", "traversal", ".", "destination", ".", "topSaveState", "(", ")", ";", "Object", "inKey", "=", "inState", ".", "getKey", "(", ")", ";", "State", "outState", "=", "traversal", ".", "origin", "=", "=", "null", "?", "null", ":", "traversal", ".", "origin", ".", "topSaveState", "(", ")", ";", "Object", "outKey", "=", "outState", "=", "=", "null", "?", "null", ":", "outState", ".", "getKey", "(", ")", ";", "if", "(", "inKey", ".", "equals", "(", "outKey", ")", ")", "{", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "else", "{", "changeKey", "(", "outState", ",", "inState", ",", "traversal", ".", "direction", ",", "traversal", ".", "createContext", "(", "inKey", ",", "activity", ")", ",", "callback", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "changeKey", "(", "@", "Nullable", "State", "outgoingState", ",", "State", "incomingState", ",", "Flow", ".", "Direction", "direction", ",", "Context", "incomingContext", ",", "final", "Flow", ".", "TraversalCallback", "callback", ")", "{", "keyChanger", ".", "changeKey", "(", "outgoingState", ",", "incomingState", ",", "direction", ",", "incomingContext", ",", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Flow", "get", "(", "View", "view", ")", "{", "return", "get", "(", "view", ".", "getContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Flow", "get", "(", "Context", "context", ")", "{", "return", "InternalContextWrapper", ".", "getFlow", "(", "context", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "getKey", "(", "Context", "context", ")", "{", "return", "FlowContextWrapper", ".", "get", "(", "context", ")", ".", "services", ".", "getKey", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "getKey", "(", "View", "view", ")", "{", "return", "getKey", "(", "view", ".", "getContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "getService", "(", "String", "serviceName", ",", "Context", "context", ")", "{", "return", "FlowContextWrapper", ".", "get", "(", "context", ")", ".", "services", ".", "getService", "(", "serviceName", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Installer", "configure", "(", "Context", "baseContext", ",", "Activity", "activity", ")", "{", "return", "new", "Installer", "(", "baseContext", ",", "activity", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "addHistory", "(", "Intent", "intent", ",", "History", "history", ",", "KeyParceler", "parceler", ")", "{", "intent", ".", "putExtra", "(", "HISTORY_KEY", ",", "history", ".", "getParcelable", "(", "parceler", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "onNewIntent", "(", "Intent", "intent", ",", "Activity", "activity", ")", "{", "checkArgument", "(", "intent", "!", "=", "null", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "intent", ".", "hasExtra", "(", "HISTORY_KEY", ")", ")", "{", "InternalLifecycleIntegration", ".", "find", "(", "activity", ")", ".", "onNewIntent", "(", "intent", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "void", "onTraversalCompleted", "(", ")", ";", "</s>"]
["<s>", "private", "Traversal", "(", "@", "Nullable", "History", "from", ",", "History", "to", ",", "Direction", "direction", ",", "KeyManager", "keyManager", ")", "{", "this", ".", "origin", "=", "from", ";", "this", ".", "destination", "=", "to", ";", "this", ".", "direction", "=", "direction", ";", "this", ".", "keyManager", "=", "keyManager", ";", "}", "</s>"]
["<s>", "public", "Context", "createContext", "(", "Object", "key", ",", "Context", "baseContext", ")", "{", "return", "new", "FlowContextWrapper", "(", "keyManager", ".", "findServices", "(", "key", ")", ",", "baseContext", ")", ";", "}", "</s>"]
["<s>", "void", "dispatch", "(", "Traversal", "traversal", ",", "TraversalCallback", "callback", ")", ";", "</s>"]
["<s>", "Flow", "(", "KeyManager", "keyManager", ",", "History", "history", ")", "{", "this", ".", "keyManager", "=", "keyManager", ";", "this", ".", "history", "=", "history", ";", "}", "</s>"]
["<s>", "public", "History", "getHistory", "(", ")", "{", "return", "history", ";", "}", "</s>"]
["<s>", "public", "void", "setDispatcher", "(", "Dispatcher", "dispatcher", ")", "{", "this", ".", "dispatcher", "=", "checkNotNull", "(", "dispatcher", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "pendingTraversal", "=", "=", "null", "|", "|", "(", "pendingTraversal", ".", "state", "=", "=", "TraversalState", ".", "DISPATCHED", "&", "&", "pendingTraversal", ".", "next", "=", "=", "null", ")", ")", "{", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "void", "doExecute", "(", ")", "{", "bootstrap", "(", "history", ")", ";", "}", "}", ")", ";", "return", ";", "}", "if", "(", "pendingTraversal", ".", "state", "=", "=", "TraversalState", ".", "ENQUEUED", ")", "{", "pendingTraversal", ".", "execute", "(", ")", ";", "return", ";", "}", "if", "(", "pendingTraversal", ".", "state", "!", "=", "TraversalState", ".", "DISPATCHED", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", "+", "pendingTraversal", ".", "state", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "void", "doExecute", "(", ")", "{", "bootstrap", "(", "history", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeDispatcher", "(", "Dispatcher", "dispatcher", ")", "{", "if", "(", "this", ".", "dispatcher", "=", "=", "checkNotNull", "(", "dispatcher", ",", "\"", "<STR_LIT>", "\"", ")", ")", "this", ".", "dispatcher", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "setHistory", "(", "final", "History", "history", ",", "final", "Direction", "direction", ")", "{", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "void", "doExecute", "(", ")", "{", "dispatch", "(", "preserveEquivalentPrefix", "(", "getHistory", "(", ")", ",", "history", ")", ",", "direction", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "doExecute", "(", ")", "{", "dispatch", "(", "preserveEquivalentPrefix", "(", "getHistory", "(", ")", ",", "history", ")", ",", "direction", ")", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "final", "Object", "newTopKey", ")", "{", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "void", "doExecute", "(", ")", "{", "if", "(", "newTopKey", ".", "equals", "(", "history", ".", "top", "(", ")", ")", ")", "{", "dispatch", "(", "history", ",", "Direction", ".", "REPLACE", ")", ";", "return", ";", "}", "History", ".", "Builder", "builder", "=", "history", ".", "buildUpon", "(", ")", ";", "int", "count", "=", "0", ";", "Object", "preservedInstance", "=", "null", ";", "for", "(", "Iterator", "<", "Object", ">", "it", "=", "history", ".", "reverseIterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "Object", "entry", "=", "it", ".", "next", "(", ")", ";", "if", "(", "entry", ".", "equals", "(", "newTopKey", ")", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "history", ".", "size", "(", ")", "-", "count", ";", "i", "+", "+", ")", "{", "preservedInstance", "=", "builder", ".", "pop", "(", ")", ";", "}", "break", ";", "}", "else", "{", "count", "+", "+", ";", "}", "}", "History", "newHistory", ";", "if", "(", "preservedInstance", "!", "=", "null", ")", "{", "builder", ".", "push", "(", "preservedInstance", ")", ";", "newHistory", "=", "builder", ".", "build", "(", ")", ";", "dispatch", "(", "newHistory", ",", "Direction", ".", "BACKWARD", ")", ";", "}", "else", "{", "builder", ".", "push", "(", "newTopKey", ")", ";", "newHistory", "=", "builder", ".", "build", "(", ")", ";", "dispatch", "(", "newHistory", ",", "Direction", ".", "FORWARD", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "doExecute", "(", ")", "{", "if", "(", "newTopKey", ".", "equals", "(", "history", ".", "top", "(", ")", ")", ")", "{", "dispatch", "(", "history", ",", "Direction", ".", "REPLACE", ")", ";", "return", ";", "}", "History", ".", "Builder", "builder", "=", "history", ".", "buildUpon", "(", ")", ";", "int", "count", "=", "0", ";", "Object", "preservedInstance", "=", "null", ";", "for", "(", "Iterator", "<", "Object", ">", "it", "=", "history", ".", "reverseIterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "Object", "entry", "=", "it", ".", "next", "(", ")", ";", "if", "(", "entry", ".", "equals", "(", "newTopKey", ")", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "history", ".", "size", "(", ")", "-", "count", ";", "i", "+", "+", ")", "{", "preservedInstance", "=", "builder", ".", "pop", "(", ")", ";", "}", "break", ";", "}", "else", "{", "count", "+", "+", ";", "}", "}", "History", "newHistory", ";", "if", "(", "preservedInstance", "!", "=", "null", ")", "{", "builder", ".", "push", "(", "preservedInstance", ")", ";", "newHistory", "=", "builder", ".", "build", "(", ")", ";", "dispatch", "(", "newHistory", ",", "Direction", ".", "BACKWARD", ")", ";", "}", "else", "{", "builder", ".", "push", "(", "newTopKey", ")", ";", "newHistory", "=", "builder", ".", "build", "(", ")", ";", "dispatch", "(", "newHistory", ",", "Direction", ".", "FORWARD", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "goBack", "(", ")", "{", "boolean", "canGoBack", "=", "history", ".", "size", "(", ")", ">", "1", "|", "|", "(", "pendingTraversal", "!", "=", "null", "&", "&", "pendingTraversal", ".", "state", "!", "=", "TraversalState", ".", "FINISHED", ")", ";", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "protected", "void", "doExecute", "(", ")", "{", "if", "(", "history", ".", "size", "(", ")", "=", "=", "1", ")", "{", "onTraversalCompleted", "(", ")", ";", "}", "else", "{", "History", ".", "Builder", "builder", "=", "history", ".", "buildUpon", "(", ")", ";", "builder", ".", "pop", "(", ")", ";", "History", "newHistory", "=", "builder", ".", "build", "(", ")", ";", "dispatch", "(", "newHistory", ",", "Direction", ".", "BACKWARD", ")", ";", "}", "}", "}", ")", ";", "return", "canGoBack", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "doExecute", "(", ")", "{", "if", "(", "history", ".", "size", "(", ")", "=", "=", "1", ")", "{", "onTraversalCompleted", "(", ")", ";", "}", "else", "{", "History", ".", "Builder", "builder", "=", "history", ".", "buildUpon", "(", ")", ";", "builder", ".", "pop", "(", ")", ";", "History", "newHistory", "=", "builder", ".", "build", "(", ")", ";", "dispatch", "(", "newHistory", ",", "Direction", ".", "BACKWARD", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "move", "(", "PendingTraversal", "pendingTraversal", ")", "{", "if", "(", "this", ".", "pendingTraversal", "=", "=", "null", ")", "{", "this", ".", "pendingTraversal", "=", "pendingTraversal", ";", "if", "(", "dispatcher", "!", "=", "null", ")", "pendingTraversal", ".", "execute", "(", ")", ";", "}", "else", "{", "this", ".", "pendingTraversal", ".", "enqueue", "(", "pendingTraversal", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "History", "preserveEquivalentPrefix", "(", "History", "current", ",", "History", "proposed", ")", "{", "Iterator", "<", "Object", ">", "oldIt", "=", "current", ".", "reverseIterator", "(", ")", ";", "Iterator", "<", "Object", ">", "newIt", "=", "proposed", ".", "reverseIterator", "(", ")", ";", "History", ".", "Builder", "preserving", "=", "current", ".", "buildUpon", "(", ")", ".", "clear", "(", ")", ";", "while", "(", "newIt", ".", "hasNext", "(", ")", ")", "{", "Object", "newEntry", "=", "newIt", ".", "next", "(", ")", ";", "if", "(", "!", "oldIt", ".", "hasNext", "(", ")", ")", "{", "preserving", ".", "push", "(", "newEntry", ")", ";", "break", ";", "}", "Object", "oldEntry", "=", "oldIt", ".", "next", "(", ")", ";", "if", "(", "oldEntry", ".", "equals", "(", "newEntry", ")", ")", "{", "preserving", ".", "push", "(", "oldEntry", ")", ";", "}", "else", "{", "preserving", ".", "push", "(", "newEntry", ")", ";", "break", ";", "}", "}", "while", "(", "newIt", ".", "hasNext", "(", ")", ")", "{", "preserving", ".", "push", "(", "newIt", ".", "next", "(", ")", ")", ";", "}", "return", "preserving", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "void", "enqueue", "(", "PendingTraversal", "pendingTraversal", ")", "{", "if", "(", "this", ".", "next", "=", "=", "null", ")", "{", "this", ".", "next", "=", "pendingTraversal", ";", "}", "else", "{", "this", ".", "next", ".", "enqueue", "(", "pendingTraversal", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onTraversalCompleted", "(", ")", "{", "if", "(", "state", "!", "=", "TraversalState", ".", "DISPATCHED", ")", "{", "throw", "new", "IllegalStateException", "(", "state", "=", "=", "TraversalState", ".", "FINISHED", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "nextHistory", "!", "=", "null", ")", "{", "tearDownKeys", ".", "add", "(", "history", ".", "top", "(", ")", ")", ";", "history", "=", "nextHistory", ";", "}", "state", "=", "TraversalState", ".", "FINISHED", ";", "pendingTraversal", "=", "next", ";", "if", "(", "pendingTraversal", "=", "=", "null", ")", "{", "final", "Iterator", "<", "Object", ">", "it", "=", "tearDownKeys", ".", "iterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "keyManager", ".", "tearDown", "(", "it", ".", "next", "(", ")", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "else", "if", "(", "dispatcher", "!", "=", "null", ")", "{", "pendingTraversal", ".", "execute", "(", ")", ";", "}", "}", "</s>"]
["<s>", "void", "bootstrap", "(", "History", "history", ")", "{", "if", "(", "dispatcher", "=", "=", "null", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "keyManager", ".", "setUp", "(", "history", ".", "top", "(", ")", ")", ";", "dispatcher", ".", "dispatch", "(", "new", "Traversal", "(", "null", ",", "history", ",", "Direction", ".", "REPLACE", ",", "keyManager", ")", ",", "this", ")", ";", "}", "</s>"]
["<s>", "void", "dispatch", "(", "History", "nextHistory", ",", "Direction", "direction", ")", "{", "this", ".", "nextHistory", "=", "checkNotNull", "(", "nextHistory", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "dispatcher", "=", "=", "null", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "keyManager", ".", "setUp", "(", "nextHistory", ".", "top", "(", ")", ")", ";", "dispatcher", ".", "dispatch", "(", "new", "Traversal", "(", "getHistory", "(", ")", ",", "nextHistory", ",", "direction", ",", "keyManager", ")", ",", "this", ")", ";", "}", "</s>"]
["<s>", "final", "void", "execute", "(", ")", "{", "if", "(", "state", "!", "=", "TraversalState", ".", "ENQUEUED", ")", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", "+", "state", ")", ";", "if", "(", "dispatcher", "=", "=", "null", ")", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "state", "=", "TraversalState", ".", "DISPATCHED", ";", "doExecute", "(", ")", ";", "}", "</s>"]
["<s>", "abstract", "void", "doExecute", "(", ")", ";", "</s>"]
["<s>", "KeyChanger", "(", ")", "{", "}", "</s>"]
["<s>", "public", "abstract", "void", "changeKey", "(", "@", "Nullable", "State", "outgoingState", ",", "State", "incomingState", ",", "Flow", ".", "Direction", "direction", ",", "Context", "incomingStateContext", ",", "Flow", ".", "TraversalCallback", "callback", ")", ";", "</s>"]
["<s>", "public", "Installer", "(", "Context", "baseContext", ",", "Activity", "activity", ")", "{", "this", ".", "baseContext", "=", "baseContext", ";", "this", ".", "activity", "=", "activity", ";", "}", "</s>"]
["<s>", "public", "Installer", "keyParceler", "(", "@", "Nullable", "KeyParceler", "parceler", ")", "{", "this", ".", "parceler", "=", "parceler", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Installer", "dispatcher", "(", "@", "Nullable", "Flow", ".", "Dispatcher", "dispatcher", ")", "{", "this", ".", "dispatcher", "=", "dispatcher", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Installer", "defaultKey", "(", "@", "Nullable", "Object", "defaultKey", ")", "{", "this", ".", "defaultKey", "=", "defaultKey", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Installer", "addServicesFactory", "(", "ServicesFactory", "factory", ")", "{", "contextFactories", ".", "add", "(", "factory", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Context", "install", "(", ")", "{", "if", "(", "InternalLifecycleIntegration", ".", "find", "(", "activity", ")", "!", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Flow", ".", "Dispatcher", "dispatcher", "=", "this", ".", "dispatcher", ";", "if", "(", "dispatcher", "=", "=", "null", ")", "{", "dispatcher", "=", "KeyDispatcher", ".", "configure", "(", "activity", ")", ".", "withKeyChanger", "(", "new", "DefaultKeyChanger", "(", "activity", ")", ")", ".", "build", "(", ")", ";", "}", "final", "Object", "defState", "=", "defaultKey", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "defaultKey", ";", "final", "History", "defaultHistory", "=", "History", ".", "single", "(", "defState", ")", ";", "final", "Application", "app", "=", "(", "Application", ")", "baseContext", ".", "getApplicationContext", "(", ")", ";", "final", "KeyManager", "keyManager", "=", "new", "KeyManager", "(", "contextFactories", ")", ";", "InternalLifecycleIntegration", ".", "install", "(", "app", ",", "activity", ",", "parceler", ",", "defaultHistory", ",", "dispatcher", ",", "keyManager", ")", ";", "return", "new", "InternalContextWrapper", "(", "baseContext", ",", "activity", ")", ";", "}", "</s>"]
["<s>", "boolean", "apply", "(", "Object", "key", ")", ";", "</s>"]
["<s>", "public", "static", "History", "from", "(", "Parcelable", "parcelable", ",", "KeyParceler", "parceler", ")", "{", "Bundle", "bundle", "=", "(", "Bundle", ")", "parcelable", ";", "ArrayList", "<", "Bundle", ">", "entryBundles", "=", "bundle", ".", "getParcelableArrayList", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "entryBundles", "=", "=", "null", ")", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "List", "<", "State", ">", "entries", "=", "new", "ArrayList", "<", ">", "(", "entryBundles", ".", "size", "(", ")", ")", ";", "for", "(", "Bundle", "entryBundle", ":", "entryBundles", ")", "{", "entries", ".", "add", "(", "State", ".", "fromBundle", "(", "entryBundle", ",", "parceler", ")", ")", ";", "}", "return", "new", "History", "(", "entries", ")", ";", "}", "</s>"]
["<s>", "public", "Parcelable", "getParcelable", "(", "KeyParceler", "parceler", ")", "{", "Bundle", "historyBundle", "=", "new", "Bundle", "(", ")", ";", "ArrayList", "<", "Bundle", ">", "entryBundles", "=", "new", "ArrayList", "<", ">", "(", "history", ".", "size", "(", ")", ")", ";", "for", "(", "State", "entry", ":", "history", ")", "{", "entryBundles", ".", "add", "(", "entry", ".", "toBundle", "(", "parceler", ")", ")", ";", "}", "if", "(", "entryBundles", ".", "isEmpty", "(", ")", ")", "{", "return", "null", ";", "}", "historyBundle", ".", "putParcelableArrayList", "(", "\"", "<STR_LIT>", "\"", ",", "entryBundles", ")", ";", "return", "historyBundle", ";", "}", "</s>"]
["<s>", "public", "Parcelable", "getParcelable", "(", "KeyParceler", "parceler", ",", "Filter", "filter", ")", "{", "Bundle", "historyBundle", "=", "new", "Bundle", "(", ")", ";", "ArrayList", "<", "Bundle", ">", "entryBundles", "=", "new", "ArrayList", "<", ">", "(", "history", ".", "size", "(", ")", ")", ";", "ListIterator", "<", "State", ">", "it", "=", "history", ".", "listIterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "State", "entry", "=", "it", ".", "next", "(", ")", ";", "if", "(", "filter", ".", "apply", "(", "entry", ".", "getKey", "(", ")", ")", ")", "{", "entryBundles", ".", "add", "(", "entry", ".", "toBundle", "(", "parceler", ")", ")", ";", "}", "}", "if", "(", "entryBundles", ".", "isEmpty", "(", ")", ")", "{", "return", "null", ";", "}", "historyBundle", ".", "putParcelableArrayList", "(", "\"", "<STR_LIT>", "\"", ",", "entryBundles", ")", ";", "return", "historyBundle", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "emptyBuilder", "(", ")", "{", "return", "new", "Builder", "(", "Collections", ".", "<", "State", ">", "emptyList", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "History", "single", "(", "Object", "key", ")", "{", "return", "emptyBuilder", "(", ")", ".", "push", "(", "key", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "History", "(", "List", "<", "State", ">", "history", ")", "{", "checkArgument", "(", "history", "!", "=", "null", "&", "&", "!", "history", ".", "isEmpty", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "history", "=", "history", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "Iterator", "<", "T", ">", "reverseIterator", "(", ")", "{", "return", "new", "ReadStateIterator", "<", ">", "(", "history", ".", "iterator", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Override", "public", "Iterator", "<", "Object", ">", "iterator", "(", ")", "{", "return", "new", "ReadStateIterator", "<", ">", "(", "new", "ReverseIterator", "<", ">", "(", "history", ")", ")", ";", "}", "</s>"]
["<s>", "public", "int", "size", "(", ")", "{", "return", "history", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "top", "(", ")", "{", "return", "(", "T", ")", "peekSaveState", "(", "0", ")", ".", "getKey", "(", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "peek", "(", "int", "index", ")", "{", "return", "(", "T", ")", "peekSaveState", "(", "index", ")", ".", "getKey", "(", ")", ";", "}", "</s>"]
["<s>", "public", "State", "peekSaveState", "(", "int", "index", ")", "{", "return", "history", ".", "get", "(", "history", ".", "size", "(", ")", "-", "index", "-", "1", ")", ";", "}", "</s>"]
["<s>", "public", "State", "topSaveState", "(", ")", "{", "return", "peekSaveState", "(", "0", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "buildUpon", "(", ")", "{", "return", "new", "Builder", "(", "history", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "Arrays", ".", "deepToString", "(", "history", ".", "toArray", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Builder", "(", "Collection", "<", "State", ">", "history", ")", "{", "this", ".", "history", "=", "new", "ArrayList", "<", ">", "(", "history", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "clear", "(", ")", "{", "while", "(", "!", "isEmpty", "(", ")", ")", "{", "pop", "(", ")", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "push", "(", "Object", "key", ")", "{", "State", "entry", "=", "entryMemory", ".", "get", "(", "key", ")", ";", "if", "(", "entry", "=", "=", "null", ")", "{", "final", "Object", "key1", "=", "key", ";", "entry", "=", "new", "State", "(", "key1", ")", ";", "}", "history", ".", "add", "(", "entry", ")", ";", "entryMemory", ".", "remove", "(", "key", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "addAll", "(", "Collection", "<", "?", ">", "c", ")", "{", "for", "(", "Object", "key", ":", "c", ")", "{", "push", "(", "key", ")", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Object", "peek", "(", ")", "{", "return", "history", ".", "isEmpty", "(", ")", "?", "null", ":", "history", ".", "get", "(", "history", ".", "size", "(", ")", "-", "1", ")", ".", "getKey", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isEmpty", "(", ")", "{", "return", "history", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "pop", "(", ")", "{", "if", "(", "isEmpty", "(", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "State", "entry", "=", "history", ".", "remove", "(", "history", ".", "size", "(", ")", "-", "1", ")", ";", "entryMemory", ".", "put", "(", "entry", ".", "getKey", "(", ")", ",", "entry", ")", ";", "return", "entry", ".", "getKey", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "popTo", "(", "Object", "state", ")", "{", "while", "(", "!", "isEmpty", "(", ")", "&", "&", "!", "peek", "(", ")", ".", "equals", "(", "state", ")", ")", "{", "pop", "(", ")", ";", "}", "checkArgument", "(", "!", "isEmpty", "(", ")", ",", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "state", ")", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "pop", "(", "int", "count", ")", "{", "final", "int", "size", "=", "history", ".", "size", "(", ")", ";", "checkArgument", "(", "count", "<", "=", "size", ",", "String", ".", "format", "(", "(", "Locale", ")", "null", ",", "\"", "<STR_LIT>", "\"", ",", "count", ",", "size", ")", ")", ";", "while", "(", "count", "-", "-", ">", "0", ")", "{", "pop", "(", ")", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "History", "build", "(", ")", "{", "return", "new", "History", "(", "history", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "Arrays", ".", "deepToString", "(", "history", ".", "toArray", "(", ")", ")", ";", "}", "</s>"]
["<s>", "ReverseIterator", "(", "List", "<", "T", ">", "list", ")", "{", "wrapped", "=", "list", ".", "listIterator", "(", "list", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "wrapped", ".", "hasPrevious", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "T", "next", "(", ")", "{", "return", "wrapped", ".", "previous", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "wrapped", ".", "remove", "(", ")", ";", "}", "</s>"]
["<s>", "ReadStateIterator", "(", "Iterator", "<", "State", ">", "iterator", ")", "{", "this", ".", "iterator", "=", "iterator", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "iterator", ".", "hasNext", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "T", "next", "(", ")", "{", "return", "(", "T", ")", "iterator", ".", "next", "(", ")", ".", "getKey", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "KeyManager", ".", "class", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "KeyManager", "(", "List", "<", "ServicesFactory", ">", "servicesFactories", ")", "{", "this", ".", "servicesFactories", ".", "addAll", "(", "servicesFactories", ")", ";", "nodes", ".", "put", "(", "ROOT", ",", "new", "CountedServices", "(", "Services", ".", "ROOT", ")", ")", ";", "}", "</s>"]
["<s>", "Services", "findServices", "(", "Object", "key", ")", "{", "final", "CountedServices", "counted", "=", "nodes", ".", "get", "(", "key", ")", ";", "if", "(", "counted", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "key", ")", ";", "}", "return", "counted", ".", "services", ";", "}", "</s>"]
["<s>", "void", "setUp", "(", "Object", "key", ")", "{", "Log", ".", "d", "(", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ",", "\"", "<STR_LIT>", "\"", "+", "key", ")", ";", "Services", "parent", "=", "nodes", ".", "get", "(", "ROOT", ")", ".", "services", ";", "if", "(", "key", "instanceof", "Path", ")", "{", "Path", "path", "=", "(", "Path", ")", "key", ";", "List", "<", "?", ">", "elements", "=", "path", ".", "elements", "(", ")", ";", "for", "(", "Object", "element", ":", "elements", ")", "{", "CountedServices", "node", "=", "ensureNode", "(", "parent", ",", "element", ")", ";", "node", ".", "uses", "+", "+", ";", "parent", "=", "node", ".", "services", ";", "}", "}", "else", "{", "ensureNode", "(", "parent", ",", "key", ")", ".", "uses", "+", "+", ";", "}", "}", "</s>"]
["<s>", "void", "tearDown", "(", "Object", "key", ")", "{", "Log", ".", "d", "(", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ",", "\"", "<STR_LIT>", "\"", "+", "key", ")", ";", "if", "(", "key", "instanceof", "Path", ")", "{", "Path", "path", "=", "(", "Path", ")", "key", ";", "boolean", "tornDown", "=", "false", ";", "for", "(", "Object", "element", ":", "path", ".", "elements", "(", ")", ")", "{", "if", "(", "tornDown", ")", "{", "nodes", ".", "remove", "(", "element", ")", ";", "}", "else", "{", "tornDown", "=", "decrementAndMaybeRemoveKey", "(", "element", ")", ";", "}", "}", "}", "else", "{", "decrementAndMaybeRemoveKey", "(", "key", ")", ";", "}", "}", "</s>"]
["<s>", "@", "NonNull", "private", "CountedServices", "ensureNode", "(", "@", "Nullable", "Services", "parent", ",", "Object", "key", ")", "{", "CountedServices", "node", "=", "nodes", ".", "get", "(", "key", ")", ";", "if", "(", "node", "=", "=", "null", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Services", ".", "Binder", "binder", "=", "parent", ".", "extend", "(", ")", ".", "bind", "(", "Services", ".", "KEY_SERVICE", ",", "key", ")", ";", "int", "count", "=", "servicesFactories", ".", "size", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "servicesFactories", ".", "get", "(", "i", ")", ".", "bindServices", "(", "binder", ")", ";", "}", "node", "=", "new", "CountedServices", "(", "binder", ".", "build", "(", ")", ")", ";", "nodes", ".", "put", "(", "key", ",", "node", ")", ";", "}", "return", "node", ";", "}", "</s>"]
["<s>", "private", "boolean", "decrementAndMaybeRemoveKey", "(", "Object", "key", ")", "{", "CountedServices", "node", "=", "nodes", ".", "get", "(", "key", ")", ";", "node", ".", "uses", "-", "-", ";", "if", "(", "key", "!", "=", "ROOT", "&", "&", "node", ".", "uses", "=", "=", "0", ")", "{", "int", "count", "=", "servicesFactories", ".", "size", "(", ")", ";", "for", "(", "int", "i", "=", "count", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "servicesFactories", ".", "get", "(", "i", ")", ".", "tearDown", "(", "node", ".", "services", ")", ";", "}", "nodes", ".", "remove", "(", "key", ")", ";", "return", "true", ";", "}", "if", "(", "node", ".", "uses", "<", "0", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "key", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "CountedServices", "(", "Services", "services", ")", "{", "this", ".", "services", "=", "services", ";", "}", "</s>"]
["<s>", "DefaultKeyChanger", "(", "Activity", "activity", ")", "{", "this", ".", "activity", "=", "activity", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "changeKey", "(", "@", "Nullable", "State", "outgoingState", ",", "State", "incomingState", ",", "Flow", ".", "Direction", "direction", ",", "Context", "incomingStateContext", ",", "Flow", ".", "TraversalCallback", "callback", ")", "{", "if", "(", "textView", "=", "=", "null", ")", "{", "textView", "=", "new", "TextView", "(", "activity", ")", ";", "textView", ".", "setGravity", "(", "Gravity", ".", "CENTER", ")", ";", "activity", ".", "setContentView", "(", "textView", ")", ";", "}", "textView", ".", "setText", "(", "incomingState", ".", "getKey", "(", ")", ".", "toString", "(", ")", ")", ";", "callback", ".", "onTraversalCompleted", "(", ")", ";", "}", "</s>"]
["<s>", "static", "Flow", "getFlow", "(", "Context", "context", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Flow", "systemService", "=", "(", "Flow", ")", "context", ".", "getSystemService", "(", "FLOW_SERVICE", ")", ";", "return", "systemService", ";", "}", "</s>"]
["<s>", "static", "KeyManager", "getContextManager", "(", "Context", "context", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "final", "KeyManager", "service", "=", "(", "KeyManager", ")", "context", ".", "getSystemService", "(", "CONTEXT_MANAGER_SERVICE", ")", ";", "return", "service", ";", "}", "</s>"]
["<s>", "InternalContextWrapper", "(", "Context", "baseContext", ",", "Activity", "activity", ")", "{", "super", "(", "baseContext", ")", ";", "this", ".", "activity", "=", "activity", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "getSystemService", "(", "String", "name", ")", "{", "if", "(", "FLOW_SERVICE", ".", "equals", "(", "name", ")", ")", "{", "if", "(", "flow", "=", "=", "null", ")", "{", "flow", "=", "InternalLifecycleIntegration", ".", "find", "(", "activity", ")", ".", "flow", ";", "}", "return", "flow", ";", "}", "else", "if", "(", "CONTEXT_MANAGER_SERVICE", ".", "equals", "(", "name", ")", ")", "{", "if", "(", "keyManager", "=", "=", "null", ")", "{", "keyManager", "=", "InternalLifecycleIntegration", ".", "find", "(", "activity", ")", ".", "keyManager", ";", "}", "return", "keyManager", ";", "}", "return", "super", ".", "getSystemService", "(", "name", ")", ";", "}", "</s>"]
["<s>", "static", "InternalLifecycleIntegration", "find", "(", "Activity", "activity", ")", "{", "return", "(", "InternalLifecycleIntegration", ")", "activity", ".", "getFragmentManager", "(", ")", ".", "findFragmentByTag", "(", "TAG", ")", ";", "}", "</s>"]
["<s>", "static", "void", "install", "(", "Application", "app", ",", "final", "Activity", "activity", ",", "@", "Nullable", "final", "KeyParceler", "parceler", ",", "final", "History", "defaultHistory", ",", "final", "Flow", ".", "Dispatcher", "dispatcher", ",", "final", "KeyManager", "keyManager", ")", "{", "app", ".", "registerActivityLifecycleCallbacks", "(", "new", "Application", ".", "ActivityLifecycleCallbacks", "(", ")", "{", "@", "Override", "public", "void", "onActivityCreated", "(", "Activity", "a", ",", "Bundle", "savedInstanceState", ")", "{", "if", "(", "a", "=", "=", "activity", ")", "{", "InternalLifecycleIntegration", "fragment", "=", "find", "(", "activity", ")", ";", "final", "boolean", "newFragment", "=", "fragment", "=", "=", "null", ";", "if", "(", "newFragment", ")", "{", "fragment", "=", "new", "InternalLifecycleIntegration", "(", ")", ";", "fragment", ".", "defaultHistory", "=", "defaultHistory", ";", "fragment", ".", "parceler", "=", "parceler", ";", "fragment", ".", "keyManager", "=", "keyManager", ";", "}", "fragment", ".", "dispatcher", "=", "dispatcher", ";", "if", "(", "newFragment", ")", "{", "activity", ".", "getFragmentManager", "(", ")", ".", "beginTransaction", "(", ")", ".", "add", "(", "fragment", ",", "TAG", ")", ".", "commit", "(", ")", ";", "}", "a", ".", "getApplication", "(", ")", ".", "unregisterActivityLifecycleCallbacks", "(", "this", ")", ";", "}", "}", "@", "Override", "public", "void", "onActivityStarted", "(", "Activity", "activity", ")", "{", "}", "@", "Override", "public", "void", "onActivityResumed", "(", "Activity", "activity", ")", "{", "}", "@", "Override", "public", "void", "onActivityPaused", "(", "Activity", "activity", ")", "{", "}", "@", "Override", "public", "void", "onActivityStopped", "(", "Activity", "activity", ")", "{", "}", "@", "Override", "public", "void", "onActivitySaveInstanceState", "(", "Activity", "activity", ",", "Bundle", "outState", ")", "{", "}", "@", "Override", "public", "void", "onActivityDestroyed", "(", "Activity", "a", ")", "{", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityCreated", "(", "Activity", "a", ",", "Bundle", "savedInstanceState", ")", "{", "if", "(", "a", "=", "=", "activity", ")", "{", "InternalLifecycleIntegration", "fragment", "=", "find", "(", "activity", ")", ";", "final", "boolean", "newFragment", "=", "fragment", "=", "=", "null", ";", "if", "(", "newFragment", ")", "{", "fragment", "=", "new", "InternalLifecycleIntegration", "(", ")", ";", "fragment", ".", "defaultHistory", "=", "defaultHistory", ";", "fragment", ".", "parceler", "=", "parceler", ";", "fragment", ".", "keyManager", "=", "keyManager", ";", "}", "fragment", ".", "dispatcher", "=", "dispatcher", ";", "if", "(", "newFragment", ")", "{", "activity", ".", "getFragmentManager", "(", ")", ".", "beginTransaction", "(", ")", ".", "add", "(", "fragment", ",", "TAG", ")", ".", "commit", "(", ")", ";", "}", "a", ".", "getApplication", "(", ")", ".", "unregisterActivityLifecycleCallbacks", "(", "this", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityStarted", "(", "Activity", "activity", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityResumed", "(", "Activity", "activity", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityPaused", "(", "Activity", "activity", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityStopped", "(", "Activity", "activity", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivitySaveInstanceState", "(", "Activity", "activity", ",", "Bundle", "outState", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityDestroyed", "(", "Activity", "a", ")", "{", "}", "</s>"]
["<s>", "public", "InternalLifecycleIntegration", "(", ")", "{", "super", "(", ")", ";", "setRetainInstance", "(", "true", ")", ";", "}", "</s>"]
["<s>", "void", "onNewIntent", "(", "Intent", "intent", ")", "{", "if", "(", "intent", ".", "hasExtra", "(", "Flow", ".", "HISTORY_KEY", ")", ")", "{", "History", "history", "=", "History", ".", "from", "(", "intent", ".", "getParcelableExtra", "(", "Flow", ".", "HISTORY_KEY", ")", ",", "checkNotNull", "(", "parceler", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "flow", ".", "setHistory", "(", "history", ",", "Flow", ".", "Direction", ".", "REPLACE", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onActivityCreated", "(", "Bundle", "savedInstanceState", ")", "{", "super", ".", "onActivityCreated", "(", "savedInstanceState", ")", ";", "if", "(", "flow", "=", "=", "null", ")", "{", "History", "savedHistory", "=", "null", ";", "if", "(", "savedInstanceState", "!", "=", "null", "&", "&", "savedInstanceState", ".", "containsKey", "(", "Flow", ".", "HISTORY_KEY", ")", ")", "{", "savedHistory", "=", "History", ".", "from", "(", "savedInstanceState", ".", "getParcelable", "(", "Flow", ".", "HISTORY_KEY", ")", ",", "checkNotNull", "(", "parceler", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "History", "history", "=", "selectHistory", "(", "intent", ",", "savedHistory", ",", "defaultHistory", ",", "parceler", ")", ";", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "}", "flow", ".", "setDispatcher", "(", "dispatcher", ")", ";", "dispatcherSet", "=", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onResume", "(", ")", "{", "super", ".", "onResume", "(", ")", ";", "if", "(", "!", "dispatcherSet", ")", "{", "flow", ".", "setDispatcher", "(", "dispatcher", ")", ";", "dispatcherSet", "=", "true", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onPause", "(", ")", "{", "flow", ".", "removeDispatcher", "(", "dispatcher", ")", ";", "dispatcherSet", "=", "false", ";", "super", ".", "onPause", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDestroy", "(", ")", "{", "keyManager", ".", "tearDown", "(", "flow", ".", "getHistory", "(", ")", ".", "top", "(", ")", ")", ";", "super", ".", "onDestroy", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onSaveInstanceState", "(", "Bundle", "outState", ")", "{", "super", ".", "onSaveInstanceState", "(", "outState", ")", ";", "checkArgument", "(", "outState", "!", "=", "null", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "parceler", "=", "=", "null", ")", "{", "return", ";", "}", "Parcelable", "parcelable", "=", "flow", ".", "getHistory", "(", ")", ".", "getParcelable", "(", "parceler", ",", "new", "History", ".", "Filter", "(", ")", "{", "@", "Override", "public", "boolean", "apply", "(", "Object", "state", ")", "{", "return", "!", "state", ".", "getClass", "(", ")", ".", "isAnnotationPresent", "(", "NotPersistent", ".", "class", ")", ";", "}", "}", ")", ";", "if", "(", "parcelable", "!", "=", "null", ")", "{", "outState", ".", "putParcelable", "(", "Flow", ".", "HISTORY_KEY", ",", "parcelable", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "apply", "(", "Object", "state", ")", "{", "return", "!", "state", ".", "getClass", "(", ")", ".", "isAnnotationPresent", "(", "NotPersistent", ".", "class", ")", ";", "}", "</s>"]
["<s>", "private", "static", "History", "selectHistory", "(", "Intent", "intent", ",", "History", "saved", ",", "History", "defaultHistory", ",", "@", "Nullable", "KeyParceler", "parceler", ")", "{", "if", "(", "saved", "!", "=", "null", ")", "{", "return", "saved", ";", "}", "if", "(", "intent", "!", "=", "null", "&", "&", "intent", ".", "hasExtra", "(", "Flow", ".", "HISTORY_KEY", ")", ")", "{", "checkNotNull", "(", "parceler", ",", "\"", "<STR_LIT>", "\"", ")", ";", "return", "History", ".", "from", "(", "intent", ".", "getParcelableExtra", "(", "Flow", ".", "HISTORY_KEY", ")", ",", "parceler", ")", ";", "}", "return", "defaultHistory", ";", "}", "</s>"]
["<s>", "static", "FlowContextWrapper", "get", "(", "Context", "context", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "FlowContextWrapper", "wrapper", "=", "(", "FlowContextWrapper", ")", "context", ".", "getSystemService", "(", "SYSTEM_SERVICE", ")", ";", "return", "wrapper", ";", "}", "</s>"]
["<s>", "FlowContextWrapper", "(", "Services", "services", ",", "Context", "baseContext", ")", "{", "super", "(", "baseContext", ")", ";", "this", ".", "services", "=", "services", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "getSystemService", "(", "String", "name", ")", "{", "if", "(", "SYSTEM_SERVICE", ".", "equals", "(", "name", ")", ")", "{", "return", "this", ";", "}", "if", "(", "LAYOUT_INFLATER_SERVICE", ".", "equals", "(", "name", ")", ")", "{", "if", "(", "inflater", "=", "=", "null", ")", "{", "inflater", "=", "LayoutInflater", ".", "from", "(", "getBaseContext", "(", ")", ")", ".", "cloneInContext", "(", "this", ")", ";", "}", "return", "inflater", ";", "}", "return", "super", ".", "getSystemService", "(", "name", ")", ";", "}", "</s>"]
["<s>", "private", "Binder", "(", "Services", "base", ")", "{", "checkNotNull", "(", "base", ",", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "base", "=", "base", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "getKey", "(", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "T", "key", "=", "(", "T", ")", "services", ".", "get", "(", "KEY_SERVICE", ")", ";", "return", "key", ";", "}", "</s>"]
["<s>", "public", "Binder", "bind", "(", "String", "serviceName", ",", "Object", "service", ")", "{", "services", ".", "put", "(", "serviceName", ",", "service", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "Services", "build", "(", ")", "{", "return", "new", "Services", "(", "base", ",", "services", ")", ";", "}", "</s>"]
["<s>", "private", "Services", "(", "@", "Nullable", "Services", "delegate", ",", "Map", "<", "String", ",", "Object", ">", "localServices", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "this", ".", "localServices", ".", "putAll", "(", "localServices", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "getService", "(", "String", "name", ")", "{", "if", "(", "localServices", ".", "containsKey", "(", "name", ")", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "final", "T", "service", "=", "(", "T", ")", "localServices", ".", "get", "(", "name", ")", ";", "return", "service", ";", "}", "if", "(", "delegate", "!", "=", "null", ")", "return", "delegate", ".", "getService", "(", "name", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "getKey", "(", ")", "{", "return", "getService", "(", "Services", ".", "KEY_SERVICE", ")", ";", "}", "</s>"]
["<s>", "Binder", "extend", "(", ")", "{", "return", "new", "Binder", "(", "this", ")", ";", "}", "</s>"]
["<s>", "public", "static", "State", "empty", "(", "final", "Object", "key", ")", "{", "return", "new", "EmptyState", "(", "key", ")", ";", "}", "</s>"]
["<s>", "static", "State", "fromBundle", "(", "Bundle", "savedState", ",", "KeyParceler", "parceler", ")", "{", "Object", "key", "=", "parceler", ".", "toKey", "(", "savedState", ".", "getParcelable", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "State", "state", "=", "new", "State", "(", "key", ")", ";", "state", ".", "viewState", "=", "savedState", ".", "getSparseParcelableArray", "(", "\"", "<STR_LIT>", "\"", ")", ";", "state", ".", "bundle", "=", "savedState", ".", "getBundle", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "state", ";", "}", "</s>"]
["<s>", "State", "(", "Object", "key", ")", "{", "this", ".", "key", "=", "key", ";", "}", "</s>"]
["<s>", "public", "final", "<", "T", ">", "T", "getKey", "(", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "final", "T", "state", "=", "(", "T", ")", "key", ";", "return", "state", ";", "}", "</s>"]
["<s>", "public", "void", "save", "(", "View", "view", ")", "{", "SparseArray", "<", "Parcelable", ">", "state", "=", "new", "SparseArray", "<", ">", "(", ")", ";", "view", ".", "saveHierarchyState", "(", "state", ")", ";", "viewState", "=", "state", ";", "}", "</s>"]
["<s>", "public", "void", "restore", "(", "View", "view", ")", "{", "if", "(", "viewState", "!", "=", "null", ")", "{", "view", ".", "restoreHierarchyState", "(", "viewState", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "setBundle", "(", "Bundle", "bundle", ")", "{", "this", ".", "bundle", "=", "bundle", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "Bundle", "toBundle", "(", ")", "{", "return", "bundle", ";", "}", "</s>"]
["<s>", "Bundle", "toBundle", "(", "KeyParceler", "parceler", ")", "{", "Bundle", "outState", "=", "new", "Bundle", "(", ")", ";", "outState", ".", "putParcelable", "(", "\"", "<STR_LIT>", "\"", ",", "parceler", ".", "toParcelable", "(", "getKey", "(", ")", ")", ")", ";", "outState", ".", "putSparseParcelableArray", "(", "\"", "<STR_LIT>", "\"", ",", "viewState", ")", ";", "outState", ".", "putBundle", "(", "\"", "<STR_LIT>", "\"", ",", "bundle", ")", ";", "return", "outState", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "State", "state", "=", "(", "State", ")", "o", ";", "return", "(", "getKey", "(", ")", ".", "equals", "(", "state", ".", "getKey", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "getKey", "(", ")", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "getKey", "(", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "EmptyState", "(", "Object", "flowState", ")", "{", "super", "(", "flowState", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "save", "(", "View", "view", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "restore", "(", "View", "view", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setBundle", "(", "Bundle", "bundle", ")", "{", "}", "</s>"]
["<s>", "@", "Nullable", "@", "Override", "public", "Bundle", "toBundle", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "Parcelable", "toParcelable", "(", "Object", "key", ")", ";", "</s>"]
["<s>", "Object", "toKey", "(", "Parcelable", "parcelable", ")", ";", "</s>"]
["<s>", "protected", "void", "build", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Builder", "builder", ")", "{", "}", "</s>"]
["<s>", "final", "List", "<", "Path", ">", "elements", "(", ")", "{", "if", "(", "elements", "=", "=", "null", ")", "{", "Builder", "builder", "=", "new", "Builder", "(", ")", ";", "build", "(", "builder", ")", ";", "if", "(", "builder", ".", "isNotTail", "(", "this", ")", ")", "{", "builder", ".", "append", "(", "this", ")", ";", "}", "elements", "=", "builder", ".", "elements", ";", "}", "return", "elements", ";", "}", "</s>"]
["<s>", "final", "boolean", "isRoot", "(", ")", "{", "return", "this", "=", "=", "ROOT", ";", "}", "</s>"]
["<s>", "Builder", "(", ")", "{", "elements", ".", "add", "(", "ROOT", ")", ";", "}", "</s>"]
["<s>", "public", "void", "append", "(", "Path", "path", ")", "{", "elements", ".", "add", "(", "path", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isNotTail", "(", "Path", "path", ")", "{", "return", "!", "path", ".", "equals", "(", "elements", ".", "get", "(", "elements", ".", "size", "(", ")", "-", "1", ")", ")", ";", "}", "</s>"]
