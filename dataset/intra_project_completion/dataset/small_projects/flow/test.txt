["<s>", "void", "setDispatcher", "(", "@", "NonNull", "Dispatcher", "dispatcher", ",", "final", "boolean", "restore", ")", "{", "this", ".", "dispatcher", "=", "checkNotNull", "(", "dispatcher", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "pendingTraversal", "=", "=", "null", "|", "|", "(", "pendingTraversal", ".", "state", "=", "=", "TraversalState", ".", "DISPATCHED", "&", "&", "pendingTraversal", ".", "next", "=", "=", "null", ")", ")", "{", "move", "(", "new", "PendingTraversal", "(", ")", "{", "@", "Override", "void", "doExecute", "(", ")", "{", "bootstrap", "(", "history", ",", "restore", ")", ";", "}", "}", ")", ";", "return", ";", "}", "if", "(", "pendingTraversal", ".", "state", "=", "=", "TraversalState", ".", "ENQUEUED", ")", "{", "pendingTraversal", ".", "execute", "(", ")", ";", "return", ";", "}", "if", "(", "pendingTraversal", ".", "state", "!", "=", "TraversalState", ".", "DISPATCHED", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", "+", "pendingTraversal", ".", "state", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Nullable", "public", "static", "<", "T", ">", "T", "getService", "(", "@", "NonNull", "String", "serviceName", ",", "@", "NonNull", "View", "view", ")", "{", "return", "getService", "(", "serviceName", ",", "view", ".", "getContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "incorrectFlowGetUsage", "(", ")", "{", "Context", "mockContext", "=", "Mockito", ".", "mock", "(", "Context", ".", "class", ")", ";", "Mockito", ".", "when", "(", "mockContext", ".", "getSystemService", "(", "Mockito", ".", "anyString", "(", ")", ")", ")", ".", "thenReturn", "(", "null", ")", ";", "try", "{", "Flow", ".", "get", "(", "mockContext", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "IllegalStateException", "ignored", ")", "{", "}", "}", "</s>"]
["<s>", "void", "fire", "(", ")", "{", "TraversalCallback", "oldCallback", "=", "callback", ";", "callback", "=", "null", ";", "traversal", "=", "null", ";", "oldCallback", ".", "onTraversalCompleted", "(", ")", ";", ";", "}", "</s>"]
["<s>", "void", "assertIdle", "(", ")", "{", "assertThat", "(", "callback", ")", ".", "isNull", "(", ")", ";", "assertThat", "(", "traversal", ")", ".", "isNull", "(", ")", ";", "}", "</s>"]
["<s>", "void", "assertDispatching", "(", "Object", "newTop", ")", "{", "assertThat", "(", "callback", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "traversal", ".", "destination", ".", "top", "(", ")", ")", ".", "isEqualTo", "(", "newTop", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "secondDispatcherIsBootstrapped", "(", ")", "{", "AsyncDispatcher", "firstDispatcher", "=", "new", "AsyncDispatcher", "(", ")", ";", "History", "history", "=", "History", ".", "single", "(", "able", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "firstDispatcher", ")", ";", "firstDispatcher", ".", "assertDispatching", "(", "able", ")", ";", "firstDispatcher", ".", "fire", "(", ")", ";", "firstDispatcher", ".", "assertIdle", "(", ")", ";", "flow", ".", "removeDispatcher", "(", "firstDispatcher", ")", ";", "AsyncDispatcher", "secondDispatcher", "=", "new", "AsyncDispatcher", "(", ")", ";", "flow", ".", "setDispatcher", "(", "secondDispatcher", ")", ";", "secondDispatcher", ".", "assertDispatching", "(", "able", ")", ";", "secondDispatcher", ".", "fire", "(", ")", ";", "secondDispatcher", ".", "assertIdle", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "hangingTraversalsSurviveDispatcherChange", "(", ")", "{", "AsyncDispatcher", "firstDispatcher", "=", "new", "AsyncDispatcher", "(", ")", ";", "History", "history", "=", "History", ".", "single", "(", "able", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "firstDispatcher", ")", ";", "firstDispatcher", ".", "fire", "(", ")", ";", "flow", ".", "set", "(", "baker", ")", ";", "firstDispatcher", ".", "assertDispatching", "(", "baker", ")", ";", "flow", ".", "removeDispatcher", "(", "firstDispatcher", ")", ";", "AsyncDispatcher", "secondDispatcher", "=", "new", "AsyncDispatcher", "(", ")", ";", "flow", ".", "setDispatcher", "(", "secondDispatcher", ")", ";", "secondDispatcher", ".", "assertIdle", "(", ")", ";", "firstDispatcher", ".", "fire", "(", ")", ";", "secondDispatcher", ".", "assertDispatching", "(", "baker", ")", ";", "secondDispatcher", ".", "fire", "(", ")", ";", "secondDispatcher", ".", "assertIdle", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "enqueuedTraversalsSurviveDispatcherChange", "(", ")", "{", "AsyncDispatcher", "firstDispatcher", "=", "new", "AsyncDispatcher", "(", ")", ";", "History", "history", "=", "History", ".", "single", "(", "able", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "firstDispatcher", ")", ";", "firstDispatcher", ".", "fire", "(", ")", ";", "flow", ".", "removeDispatcher", "(", "firstDispatcher", ")", ";", "flow", ".", "set", "(", "baker", ")", ";", "flow", ".", "set", "(", "charlie", ")", ";", "AsyncDispatcher", "secondDispatcher", "=", "new", "AsyncDispatcher", "(", ")", ";", "flow", ".", "setDispatcher", "(", "secondDispatcher", ")", ";", "secondDispatcher", ".", "assertDispatching", "(", "baker", ")", ";", "secondDispatcher", ".", "fire", "(", ")", ";", "secondDispatcher", ".", "assertDispatching", "(", "charlie", ")", ";", "secondDispatcher", ".", "fire", "(", ")", ";", "secondDispatcher", ".", "assertIdle", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "finishPendingTraversal", "(", ")", "{", "if", "(", "hangingCallback", "!", "=", "null", ")", "{", "TraversalCallback", "ref", "=", "hangingCallback", ";", "hangingCallback", "=", "null", ";", "ref", ".", "onTraversalCompleted", "(", ")", ";", "}", "}", "</s>"]
["<s>", "boolean", "requestLandscapeLock", "(", ")", "{", "int", "requestedOrientation", "=", "activity", ".", "getRequestedOrientation", "(", ")", ";", "if", "(", "requestedOrientation", "=", "=", "SCREEN_ORIENTATION_SENSOR_LANDSCAPE", ")", "{", "return", "false", ";", "}", "activity", ".", "setRequestedOrientation", "(", "SCREEN_ORIENTATION_SENSOR_LANDSCAPE", ")", ";", "return", "isPortrait", "(", ")", ";", "}", "</s>"]
["<s>", "void", "requestUnlock", "(", ")", "{", "activity", ".", "setRequestedOrientation", "(", "SCREEN_ORIENTATION_UNSPECIFIED", ")", ";", "}", "</s>"]
["<s>", "boolean", "isPortrait", "(", ")", "{", "return", "activity", ".", "getResources", "(", ")", ".", "getBoolean", "(", "R", ".", "bool", ".", "is_portrait", ")", ";", "}", "</s>"]
["<s>", "boolean", "requiresLandscape", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "History", "getFilteredHistory", "(", ")", "{", "return", "historyFilter", ".", "scrubHistory", "(", "getHistory", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setHistoryFilter", "(", "@", "NonNull", "HistoryFilter", "historyFilter", ")", "{", "this", ".", "historyFilter", "=", "historyFilter", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "defaultHistoryFilter", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "noPersist", ",", "charlie", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "List", "<", "Object", ">", "expected", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "asList", "(", "able", ",", "charlie", ")", ")", ".", "build", "(", ")", ".", "asList", "(", ")", ";", "assertThat", "(", "flow", ".", "getFilteredHistory", "(", ")", ".", "asList", "(", ")", ")", ".", "isEqualTo", "(", "expected", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "customHistoryFilter", "(", ")", "{", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "able", ",", "noPersist", ",", "charlie", ")", ")", ".", "build", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "history", ")", ";", "flow", ".", "setDispatcher", "(", "new", "FlowDispatcher", "(", ")", ")", ";", "flow", ".", "setHistoryFilter", "(", "new", "HistoryFilter", "(", ")", "{", "@", "NonNull", "@", "Override", "public", "History", "scrubHistory", "(", "@", "NonNull", "History", "history", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ";", "final", "Iterator", "<", "Object", ">", "keys", "=", "history", ".", "reverseIterator", "(", ")", ";", "while", "(", "keys", ".", "hasNext", "(", ")", ")", "{", "Object", "key", "=", "keys", ".", "next", "(", ")", ";", "if", "(", "!", "key", ".", "equals", "(", "able", ")", ")", "{", "builder", ".", "push", "(", "key", ")", ";", "}", "}", "return", "builder", ".", "build", "(", ")", ";", "}", "}", ")", ";", "List", "<", "Object", ">", "expected", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "asList", "(", "noPersist", ",", "charlie", ")", ")", ".", "build", "(", ")", ".", "asList", "(", ")", ";", "assertThat", "(", "flow", ".", "getFilteredHistory", "(", ")", ".", "asList", "(", ")", ")", ".", "isEqualTo", "(", "expected", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "singleInstanceActivity", "(", ")", "{", "List", "<", "String", ">", "expected", "=", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "History", "h", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "expected", ")", ".", "build", "(", ")", ";", "Context", "context", "=", "getInstrumentation", "(", ")", ".", "getTargetContext", "(", ")", ".", "getApplicationContext", "(", ")", ";", "Intent", "intent", "=", "new", "Intent", "(", "context", ",", "IntentsSingleInstanceSampleActivity", ".", "class", ")", ";", "intent", ".", "setFlags", "(", "Intent", ".", "FLAG_ACTIVITY_NEW_TASK", "|", "Intent", ".", "FLAG_ACTIVITY_CLEAR_TOP", ")", ";", "Flow", ".", "addHistory", "(", "intent", ",", "h", ",", "new", "StringParceler", "(", ")", ")", ";", "context", ".", "startActivity", "(", "intent", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "pressBack", "(", ")", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "pressBack", "(", ")", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "standardActivity", "(", ")", "{", "List", "<", "String", ">", "expected", "=", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "History", "h", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "expected", ")", ".", "build", "(", ")", ";", "Context", "context", "=", "getInstrumentation", "(", ")", ".", "getTargetContext", "(", ")", ".", "getApplicationContext", "(", ")", ";", "Intent", "intent", "=", "new", "Intent", "(", "context", ",", "IntentsStandardSampleActivity", ".", "class", ")", ";", "intent", ".", "setFlags", "(", "Intent", ".", "FLAG_ACTIVITY_NEW_TASK", "|", "Intent", ".", "FLAG_ACTIVITY_CLEAR_TOP", ")", ";", "Flow", ".", "addHistory", "(", "intent", ",", "h", ",", "new", "StringParceler", "(", ")", ")", ";", "context", ".", "startActivity", "(", "intent", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "pressBack", "(", ")", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "pressBack", "(", ")", ")", ";", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "goBackQueuesUp", "(", ")", "{", "final", "Queue", "<", "TraversalCallback", ">", "callbacks", "=", "new", "LinkedList", "<", ">", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "@", "NonNull", "Traversal", "traversal", ",", "@", "NonNull", "TraversalCallback", "callback", ")", "{", "callbacks", ".", "add", "(", "callback", ")", ";", "lastStack", "=", "traversal", ".", "destination", ";", "}", "}", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "flow", ".", "set", "(", "new", "Error", "(", ")", ")", ";", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "while", "(", "!", "callbacks", ".", "isEmpty", "(", ")", ")", "{", "callbacks", ".", "poll", "(", ")", ".", "onTraversalCompleted", "(", ")", ";", "}", "verifyHistory", "(", "lastStack", ",", "new", "Detail", "(", ")", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "overwflowQueuedBackupsNoOp", "(", ")", "{", "final", "Queue", "<", "TraversalCallback", ">", "callbacks", "=", "new", "LinkedList", "<", ">", "(", ")", ";", "Flow", "flow", "=", "new", "Flow", "(", "keyManager", ",", "History", ".", "single", "(", "new", "Catalog", "(", ")", ")", ")", ";", "flow", ".", "setDispatcher", "(", "new", "Dispatcher", "(", ")", "{", "@", "Override", "public", "void", "dispatch", "(", "@", "NonNull", "Traversal", "traversal", ",", "@", "NonNull", "TraversalCallback", "callback", ")", "{", "callbacks", ".", "add", "(", "callback", ")", ";", "lastStack", "=", "traversal", ".", "destination", ";", "}", "}", ")", ";", "flow", ".", "set", "(", "new", "Detail", "(", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:20>", ";", "i", "+", "+", ")", "{", "assertThat", "(", "flow", ".", "goBack", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "int", "callbackCount", "=", "0", ";", "while", "(", "!", "callbacks", ".", "isEmpty", "(", ")", ")", "{", "callbackCount", "+", "+", ";", "callbacks", ".", "poll", "(", ")", ".", "onTraversalCompleted", "(", ")", ";", "}", "assertThat", "(", "callbackCount", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "verifyHistory", "(", "lastStack", ",", "new", "Catalog", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "hello", "(", ")", "{", "onView", "(", "withText", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "perform", "(", "click", "(", ")", ")", ";", "}", "</s>"]
["<s>", "static", "@", "Nullable", "InternalLifecycleIntegration", "require", "(", "Activity", "activity", ")", "{", "Fragment", "fragmentByTag", "=", "find", "(", "activity", ")", ";", "if", "(", "fragmentByTag", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "(", "InternalLifecycleIntegration", ")", "fragmentByTag", ";", "}", "</s>"]
["<s>", "private", "static", "<", "T", ">", "Iterator", "<", "T", ">", "iterateFromTop", "(", "List", "<", "Object", ">", "history", ")", "{", "return", "new", "ReadStateIterator", "<", ">", "(", "history", ".", "iterator", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "T", ">", "Iterator", "<", "T", ">", "iterateFromBottom", "(", "List", "<", "Object", ">", "history", ")", "{", "return", "new", "ReadStateIterator", "<", ">", "(", "new", "ReverseIterator", "<", ">", "(", "history", ")", ")", ";", "}", "</s>"]
["<s>", "@", "NonNull", "public", "<", "T", ">", "Iterable", "<", "T", ">", "framesFromTop", "(", ")", "{", "return", "new", "HistoryIterable", "<", ">", "(", "history", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "NonNull", "public", "<", "T", ">", "Iterable", "<", "T", ">", "framesFromBottom", "(", ")", "{", "return", "new", "HistoryIterable", "<", ">", "(", "history", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "framesFromBottom", "(", ")", "{", "List", "<", "Object", ">", "paths", "=", "new", "ArrayList", "<", ">", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ")", ";", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "paths", ")", ".", "build", "(", ")", ";", "for", "(", "Object", "o", ":", "history", ".", "framesFromBottom", "(", ")", ")", "{", "assertThat", "(", "o", ")", ".", "isSameAs", "(", "paths", ".", "remove", "(", "paths", ".", "size", "(", ")", "-", "1", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "framesFromTop", "(", ")", "{", "List", "<", "Object", ">", "paths", "=", "new", "ArrayList", "<", ">", "(", "Arrays", ".", "<", "Object", ">", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ")", ";", "History", "history", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "paths", ")", ".", "build", "(", ")", ";", "for", "(", "Object", "o", ":", "history", ".", "framesFromTop", "(", ")", ")", "{", "assertThat", "(", "o", ")", ".", "isSameAs", "(", "paths", ".", "remove", "(", "0", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "historyIsIsolatedFromItsBuilder", "(", ")", "{", "History", ".", "Builder", "builder", "=", "History", ".", "emptyBuilder", "(", ")", ".", "pushAll", "(", "asList", "(", "ABLE", ",", "BAKER", ",", "CHARLIE", ")", ")", ";", "History", "history", "=", "builder", ".", "build", "(", ")", ";", "builder", ".", "pop", "(", ")", ";", "assertThat", "(", "history", ".", "peek", "(", "0", ")", ")", ".", "isEqualTo", "(", "CHARLIE", ")", ";", "}", "</s>"]
