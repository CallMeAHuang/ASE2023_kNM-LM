["<s>", "@", "Override", "public", "AstVisitor", "createJavaVisitor", "(", "@", "NonNull", "final", "JavaContext", "context", ")", "{", "return", "new", "ForwardingAstVisitor", "(", ")", "{", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "if", "(", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "if", "(", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Issue", ">", "getIssues", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "SystemTimeDetector", ".", "ISSUE", ",", "SleepDetector", ".", "ISSUE", ",", "WaitOnObjectWithTimeDetector", ".", "ISSUE", ",", "NotifyOnObjectDetector", ".", "ISSUE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "AstVisitor", "createJavaVisitor", "(", "@", "NonNull", "final", "JavaContext", "context", ")", "{", "return", "new", "ForwardingAstVisitor", "(", ")", "{", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "String", "methodName", "=", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ";", "if", "(", "BAD_METHODS", ".", "contains", "(", "methodName", ")", "&", "&", "operand", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", "+", "methodName", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "String", "methodName", "=", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ";", "if", "(", "BAD_METHODS", ".", "contains", "(", "methodName", ")", "&", "&", "operand", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", "+", "methodName", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "AstVisitor", "createJavaVisitor", "(", "@", "NonNull", "final", "JavaContext", "context", ")", "{", "return", "new", "ForwardingAstVisitor", "(", ")", "{", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "if", "(", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "operand", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "node", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "if", "(", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "operand", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "node", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "AstVisitor", "createJavaVisitor", "(", "@", "NonNull", "final", "JavaContext", "context", ")", "{", "return", "new", "ForwardingAstVisitor", "(", ")", "{", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "String", "methodName", "=", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ";", "if", "(", "BAD_METHODS", ".", "contains", "(", "methodName", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", "+", "methodName", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "visitMethodInvocation", "(", "MethodInvocation", "node", ")", "{", "Expression", "operand", "=", "node", ".", "astOperand", "(", ")", ";", "String", "methodName", "=", "node", ".", "astName", "(", ")", ".", "toString", "(", ")", ";", "if", "(", "BAD_METHODS", ".", "contains", "(", "methodName", ")", "&", "&", "!", "context", ".", "isSuppressedWithComment", "(", "node", ",", "ISSUE", ")", ")", "{", "context", ".", "report", "(", "ISSUE", ",", "context", ".", "getLocation", "(", "node", ")", ",", "\"", "<STR_LIT>", "\"", "+", "methodName", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "super", ".", "visitMethodInvocation", "(", "node", ")", ";", "}", "</s>"]
["<s>", "public", "DaoSession", "(", "SQLiteDatabase", "db", ",", "IdentityScopeType", "type", ",", "Map", "<", "Class", "<", "?", "extends", "AbstractDao", "<", "?", ",", "?", ">", ">", ",", "DaoConfig", ">", "daoConfigMap", ")", "{", "super", "(", "db", ")", ";", "tweetDaoConfig", "=", "daoConfigMap", ".", "get", "(", "TweetDao", ".", "class", ")", ".", "clone", "(", ")", ";", "tweetDaoConfig", ".", "initIdentityScope", "(", "type", ")", ";", "tweetDao", "=", "new", "TweetDao", "(", "tweetDaoConfig", ",", "this", ")", ";", "registerDao", "(", "Tweet", ".", "class", ",", "tweetDao", ")", ";", "}", "</s>"]
["<s>", "public", "void", "clear", "(", ")", "{", "tweetDaoConfig", ".", "getIdentityScope", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "deleteAllData", "(", ")", "{", "tweetDao", ".", "deleteAll", "(", ")", ";", "}", "</s>"]
["<s>", "public", "TweetDao", "getTweetDao", "(", ")", "{", "return", "tweetDao", ";", "}", "</s>"]
["<s>", "public", "TweetDao", "(", "DaoConfig", "config", ")", "{", "super", "(", "config", ")", ";", "}", "</s>"]
["<s>", "public", "TweetDao", "(", "DaoConfig", "config", ",", "DaoSession", "daoSession", ")", "{", "super", "(", "config", ",", "daoSession", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "createTable", "(", "SQLiteDatabase", "db", ",", "boolean", "ifNotExists", ")", "{", "String", "constraint", "=", "ifNotExists", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "\"", ";", "db", ".", "execSQL", "(", "\"", "<STR_LIT>", "\"", "+", "constraint", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "dropTable", "(", "SQLiteDatabase", "db", ",", "boolean", "ifExists", ")", "{", "String", "sql", "=", "\"", "<STR_LIT>", "\"", "+", "(", "ifExists", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", ";", "db", ".", "execSQL", "(", "sql", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "bindValues", "(", "SQLiteStatement", "stmt", ",", "Tweet", "entity", ")", "{", "stmt", ".", "clearBindings", "(", ")", ";", "entity", ".", "onBeforeSave", "(", ")", ";", "Long", "localId", "=", "entity", ".", "getLocalId", "(", ")", ";", "if", "(", "localId", "!", "=", "null", ")", "{", "stmt", ".", "bindLong", "(", "1", ",", "localId", ")", ";", "}", "Long", "serverId", "=", "entity", ".", "getServerId", "(", ")", ";", "if", "(", "serverId", "!", "=", "null", ")", "{", "stmt", ".", "bindLong", "(", "<NUM_LIT:2>", ",", "serverId", ")", ";", "}", "String", "text", "=", "entity", ".", "getText", "(", ")", ";", "if", "(", "text", "!", "=", "null", ")", "{", "stmt", ".", "bindString", "(", "<NUM_LIT:3>", ",", "text", ")", ";", "}", "Long", "userId", "=", "entity", ".", "getUserId", "(", ")", ";", "if", "(", "userId", "!", "=", "null", ")", "{", "stmt", ".", "bindLong", "(", "<NUM_LIT:4>", ",", "userId", ")", ";", "}", "Boolean", "isLocal", "=", "entity", ".", "getIsLocal", "(", ")", ";", "if", "(", "isLocal", "!", "=", "null", ")", "{", "stmt", ".", "bindLong", "(", "<NUM_LIT:5>", ",", "isLocal", "?", "<NUM_LIT>", ":", "0", "l", ")", ";", "}", "java", ".", "util", ".", "Date", "createdAt", "=", "entity", ".", "getCreatedAt", "(", ")", ";", "if", "(", "createdAt", "!", "=", "null", ")", "{", "stmt", ".", "bindLong", "(", "<NUM_LIT:6>", ",", "createdAt", ".", "getTime", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "readKey", "(", "Cursor", "cursor", ",", "int", "offset", ")", "{", "return", "cursor", ".", "isNull", "(", "offset", "+", "0", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Tweet", "readEntity", "(", "Cursor", "cursor", ",", "int", "offset", ")", "{", "Tweet", "entity", "=", "new", "Tweet", "(", "cursor", ".", "isNull", "(", "offset", "+", "0", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "0", ")", ",", "cursor", ".", "isNull", "(", "offset", "+", "1", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "1", ")", ",", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:2>", ")", "?", "null", ":", "cursor", ".", "getString", "(", "offset", "+", "<NUM_LIT:2>", ")", ",", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:3>", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "<NUM_LIT:3>", ")", ",", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:4>", ")", "?", "null", ":", "cursor", ".", "getShort", "(", "offset", "+", "<NUM_LIT:4>", ")", "!", "=", "0", ",", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:5>", ")", "?", "null", ":", "new", "java", ".", "util", ".", "Date", "(", "cursor", ".", "getLong", "(", "offset", "+", "<NUM_LIT:5>", ")", ")", ")", ";", "return", "entity", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readEntity", "(", "Cursor", "cursor", ",", "Tweet", "entity", ",", "int", "offset", ")", "{", "entity", ".", "setLocalId", "(", "cursor", ".", "isNull", "(", "offset", "+", "0", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "0", ")", ")", ";", "entity", ".", "setServerId", "(", "cursor", ".", "isNull", "(", "offset", "+", "1", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "1", ")", ")", ";", "entity", ".", "setText", "(", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:2>", ")", "?", "null", ":", "cursor", ".", "getString", "(", "offset", "+", "<NUM_LIT:2>", ")", ")", ";", "entity", ".", "setUserId", "(", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:3>", ")", "?", "null", ":", "cursor", ".", "getLong", "(", "offset", "+", "<NUM_LIT:3>", ")", ")", ";", "entity", ".", "setIsLocal", "(", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:4>", ")", "?", "null", ":", "cursor", ".", "getShort", "(", "offset", "+", "<NUM_LIT:4>", ")", "!", "=", "0", ")", ";", "entity", ".", "setCreatedAt", "(", "cursor", ".", "isNull", "(", "offset", "+", "<NUM_LIT:5>", ")", "?", "null", ":", "new", "java", ".", "util", ".", "Date", "(", "cursor", ".", "getLong", "(", "offset", "+", "<NUM_LIT:5>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Long", "updateKeyAfterInsert", "(", "Tweet", "entity", ",", "long", "rowId", ")", "{", "entity", ".", "setLocalId", "(", "rowId", ")", ";", "return", "rowId", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "getKey", "(", "Tweet", "entity", ")", "{", "if", "(", "entity", "!", "=", "null", ")", "{", "return", "entity", ".", "getLocalId", "(", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isEntityUpdateable", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "public", "static", "void", "createAllTables", "(", "SQLiteDatabase", "db", ",", "boolean", "ifNotExists", ")", "{", "TweetDao", ".", "createTable", "(", "db", ",", "ifNotExists", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "dropAllTables", "(", "SQLiteDatabase", "db", ",", "boolean", "ifExists", ")", "{", "TweetDao", ".", "dropTable", "(", "db", ",", "ifExists", ")", ";", "}", "</s>"]
["<s>", "public", "OpenHelper", "(", "Context", "context", ",", "String", "name", ",", "CursorFactory", "factory", ")", "{", "super", "(", "context", ",", "name", ",", "factory", ",", "SCHEMA_VERSION", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCreate", "(", "SQLiteDatabase", "db", ")", "{", "Log", ".", "i", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "SCHEMA_VERSION", ")", ";", "createAllTables", "(", "db", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "DevOpenHelper", "(", "Context", "context", ",", "String", "name", ",", "CursorFactory", "factory", ")", "{", "super", "(", "context", ",", "name", ",", "factory", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onUpgrade", "(", "SQLiteDatabase", "db", ",", "int", "oldVersion", ",", "int", "newVersion", ")", "{", "Log", ".", "i", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "oldVersion", "+", "\"", "<STR_LIT>", "\"", "+", "newVersion", "+", "\"", "<STR_LIT>", "\"", ")", ";", "dropAllTables", "(", "db", ",", "true", ")", ";", "onCreate", "(", "db", ")", ";", "}", "</s>"]
["<s>", "public", "DaoMaster", "(", "SQLiteDatabase", "db", ")", "{", "super", "(", "db", ",", "SCHEMA_VERSION", ")", ";", "registerDaoClass", "(", "TweetDao", ".", "class", ")", ";", "}", "</s>"]
["<s>", "public", "DaoSession", "newSession", "(", ")", "{", "return", "new", "DaoSession", "(", "db", ",", "IdentityScopeType", ".", "Session", ",", "daoConfigMap", ")", ";", "}", "</s>"]
["<s>", "public", "DaoSession", "newSession", "(", "IdentityScopeType", "type", ")", "{", "return", "new", "DaoSession", "(", "db", ",", "type", ",", "daoConfigMap", ")", ";", "}", "</s>"]
["<s>", "public", "TweetBase", "(", ")", "{", "}", "</s>"]
["<s>", "public", "TweetBase", "(", "Long", "localId", ")", "{", "this", ".", "localId", "=", "localId", ";", "}", "</s>"]
["<s>", "public", "TweetBase", "(", "Long", "localId", ",", "Long", "serverId", ",", "String", "text", ",", "Long", "userId", ",", "Boolean", "isLocal", ",", "java", ".", "util", ".", "Date", "createdAt", ")", "{", "this", ".", "localId", "=", "localId", ";", "this", ".", "serverId", "=", "serverId", ";", "this", ".", "text", "=", "text", ";", "this", ".", "userId", "=", "userId", ";", "this", ".", "isLocal", "=", "isLocal", ";", "this", ".", "createdAt", "=", "createdAt", ";", "}", "</s>"]
["<s>", "public", "Long", "getLocalId", "(", ")", "{", "return", "localId", ";", "}", "</s>"]
["<s>", "public", "void", "setLocalId", "(", "Long", "localId", ")", "{", "this", ".", "localId", "=", "localId", ";", "}", "</s>"]
["<s>", "public", "Long", "getServerId", "(", ")", "{", "return", "serverId", ";", "}", "</s>"]
["<s>", "public", "void", "setServerId", "(", "Long", "serverId", ")", "{", "this", ".", "serverId", "=", "serverId", ";", "}", "</s>"]
["<s>", "public", "String", "getText", "(", ")", "{", "return", "text", ";", "}", "</s>"]
["<s>", "public", "void", "setText", "(", "String", "text", ")", "{", "this", ".", "text", "=", "text", ";", "}", "</s>"]
["<s>", "public", "Long", "getUserId", "(", ")", "{", "return", "userId", ";", "}", "</s>"]
["<s>", "public", "void", "setUserId", "(", "Long", "userId", ")", "{", "this", ".", "userId", "=", "userId", ";", "}", "</s>"]
["<s>", "public", "Boolean", "getIsLocal", "(", ")", "{", "return", "isLocal", ";", "}", "</s>"]
["<s>", "public", "void", "setIsLocal", "(", "Boolean", "isLocal", ")", "{", "this", ".", "isLocal", "=", "isLocal", ";", "}", "</s>"]
["<s>", "public", "java", ".", "util", ".", "Date", "getCreatedAt", "(", ")", "{", "return", "createdAt", ";", "}", "</s>"]
["<s>", "public", "void", "setCreatedAt", "(", "java", ".", "util", ".", "Date", "createdAt", ")", "{", "this", ".", "createdAt", "=", "createdAt", ";", "}", "</s>"]
["<s>", "public", "void", "updateNotNull", "(", "Tweet", "other", ")", "{", "if", "(", "this", "=", "=", "other", ")", "{", "return", ";", "}", "if", "(", "other", ".", "localId", "!", "=", "null", ")", "{", "this", ".", "localId", "=", "other", ".", "localId", ";", "}", "if", "(", "other", ".", "serverId", "!", "=", "null", ")", "{", "this", ".", "serverId", "=", "other", ".", "serverId", ";", "}", "if", "(", "other", ".", "text", "!", "=", "null", ")", "{", "this", ".", "text", "=", "other", ".", "text", ";", "}", "if", "(", "other", ".", "userId", "!", "=", "null", ")", "{", "this", ".", "userId", "=", "other", ".", "userId", ";", "}", "if", "(", "other", ".", "isLocal", "!", "=", "null", ")", "{", "this", ".", "isLocal", "=", "other", ".", "isLocal", ";", "}", "if", "(", "other", ".", "createdAt", "!", "=", "null", ")", "{", "this", ".", "createdAt", "=", "other", ".", "createdAt", ";", "}", "}", "</s>"]
["<s>", "public", "void", "onBeforeSave", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCreate", "(", "Bundle", "savedInstanceState", ")", "{", "super", ".", "onCreate", "(", "savedInstanceState", ")", ";", "dataDirty", "=", "true", ";", "setContentView", "(", "R", ".", "layout", ".", "main", ")", ";", "jobManager", "=", "TwitterApplication", ".", "getInstance", "(", ")", ".", "getJobManager", "(", ")", ";", "ListView", "listView", "=", "(", "ListView", ")", "findViewById", "(", "R", ".", "id", ".", "tweet_list", ")", ";", "tweetAdapter", "=", "new", "TweetAdapter", "(", "getLayoutInflater", "(", ")", ")", ";", "findViewById", "(", "R", ".", "id", ".", "send_tweet", ")", ".", "setOnClickListener", "(", "new", "View", ".", "OnClickListener", "(", ")", "{", "@", "Override", "public", "void", "onClick", "(", "View", "view", ")", "{", "EditText", "text", "=", "(", "EditText", ")", "findViewById", "(", "R", ".", "id", ".", "edit_status", ")", ";", "if", "(", "text", ".", "getText", "(", ")", ".", "toString", "(", ")", ".", "trim", "(", ")", ".", "length", "(", ")", ">", "0", ")", "{", "sendTweet", "(", "text", ".", "getText", "(", ")", ".", "toString", "(", ")", ")", ";", "text", ".", "setText", "(", "\"", "\"", ")", ";", "}", "}", "}", ")", ";", "listView", ".", "setAdapter", "(", "tweetAdapter", ")", ";", "EventBus", ".", "getDefault", "(", ")", ".", "register", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onClick", "(", "View", "view", ")", "{", "EditText", "text", "=", "(", "EditText", ")", "findViewById", "(", "R", ".", "id", ".", "edit_status", ")", ";", "if", "(", "text", ".", "getText", "(", ")", ".", "toString", "(", ")", ".", "trim", "(", ")", ".", "length", "(", ")", ">", "0", ")", "{", "sendTweet", "(", "text", ".", "getText", "(", ")", ".", "toString", "(", ")", ")", ";", "text", ".", "setText", "(", "\"", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "sendTweet", "(", "final", "String", "text", ")", "{", "jobManager", ".", "addJobInBackground", "(", "new", "PostTweetJob", "(", "text", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onDestroy", "(", ")", "{", "super", ".", "onDestroy", "(", ")", ";", "try", "{", "EventBus", ".", "getDefault", "(", ")", ".", "unregister", "(", "this", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "}", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "onEventMainThread", "(", "FetchedNewTweetsEvent", "ignored", ")", "{", "onUpdateEvent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "onEventMainThread", "(", "PostingTweetEvent", "ignored", ")", "{", "onUpdateEvent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "onEventMainThread", "(", "PostedTweetEvent", "ignored", ")", "{", "onUpdateEvent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "onEventMainThread", "(", "DeletedTweetEvent", "ignored", ")", "{", "Toast", ".", "makeText", "(", "this", ",", "\"", "<STR_LIT>", "\"", ",", "Toast", ".", "LENGTH_SHORT", ")", ".", "show", "(", ")", ";", "onUpdateEvent", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "onUpdateEvent", "(", ")", "{", "if", "(", "isVisible", "(", ")", ")", "{", "refreshList", "(", ")", ";", "}", "else", "{", "dataDirty", "=", "true", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onResume", "(", ")", "{", "super", ".", "onResume", "(", ")", ";", "jobManager", ".", "addJobInBackground", "(", "new", "FetchTweetsJob", "(", ")", ")", ";", "if", "(", "dataDirty", ")", "{", "refreshList", "(", ")", ";", "dataDirty", "=", "false", ";", "}", "}", "</s>"]
["<s>", "private", "void", "refreshList", "(", ")", "{", "new", "SimpleBackgroundTask", "<", "LazyList", "<", "Tweet", ">", ">", "(", "this", ")", "{", "@", "Override", "protected", "LazyList", "<", "Tweet", ">", "onRun", "(", ")", "{", "return", "TweetModel", ".", "getInstance", "(", ")", ".", "lazyLoadTweets", "(", ")", ";", "}", "@", "Override", "protected", "void", "onSuccess", "(", "LazyList", "<", "Tweet", ">", "result", ")", "{", "tweetAdapter", ".", "replaceLazyList", "(", "result", ")", ";", "}", "}", ".", "execute", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "LazyList", "<", "Tweet", ">", "onRun", "(", ")", "{", "return", "TweetModel", ".", "getInstance", "(", ")", ".", "lazyLoadTweets", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onSuccess", "(", "LazyList", "<", "Tweet", ">", "result", ")", "{", "tweetAdapter", ".", "replaceLazyList", "(", "result", ")", ";", "}", "</s>"]
["<s>", "public", "TweetAdapter", "(", "LayoutInflater", "layoutInflater", ")", "{", "this", ".", "layoutInflater", "=", "layoutInflater", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getItemId", "(", "int", "i", ")", "{", "return", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "View", "getView", "(", "int", "i", ",", "View", "view", ",", "ViewGroup", "viewGroup", ")", "{", "ViewHolder", "holder", ";", "if", "(", "view", "=", "=", "null", ")", "{", "view", "=", "layoutInflater", ".", "inflate", "(", "R", ".", "layout", ".", "list_tweet", ",", "viewGroup", ",", "false", ")", ";", "holder", "=", "new", "ViewHolder", "(", "view", ")", ";", "}", "else", "{", "holder", "=", "ViewHolder", ".", "getFromView", "(", "view", ")", ";", "}", "holder", ".", "render", "(", "getItem", "(", "i", ")", ")", ";", "return", "view", ";", "}", "</s>"]
["<s>", "public", "ViewHolder", "(", "View", "view", ")", "{", "statusTextView", "=", "(", "TextView", ")", "view", ".", "findViewById", "(", "R", ".", "id", ".", "status", ")", ";", "view", ".", "setTag", "(", "this", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ViewHolder", "getFromView", "(", "View", "view", ")", "{", "Object", "tag", "=", "view", ".", "getTag", "(", ")", ";", "if", "(", "tag", "instanceof", "ViewHolder", ")", "{", "return", "(", "ViewHolder", ")", "tag", ";", "}", "else", "{", "return", "new", "ViewHolder", "(", "view", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "render", "(", "Tweet", "tweet", ")", "{", "statusTextView", ".", "setText", "(", "tweet", ".", "getText", "(", ")", ")", ";", "if", "(", "tweet", ".", "getServerId", "(", ")", "=", "=", "null", ")", "{", "statusTextView", ".", "setTextColor", "(", "Color", ".", "YELLOW", ")", ";", "}", "else", "{", "statusTextView", ".", "setTextColor", "(", "Color", ".", "WHITE", ")", ";", "}", "}", "</s>"]
["<s>", "public", "TwitterApplication", "(", ")", "{", "instance", "=", "this", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCreate", "(", ")", "{", "super", ".", "onCreate", "(", ")", ";", "configureJobManager", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "configureJobManager", "(", ")", "{", "Configuration", ".", "Builder", "builder", "=", "new", "Configuration", ".", "Builder", "(", "this", ")", ".", "customLogger", "(", "new", "CustomLogger", "(", ")", "{", "private", "static", "final", "String", "TAG", "=", "\"", "<STR_LIT>", "\"", ";", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "true", ";", "}", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "d", "(", "TAG", ",", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "String", ".", "format", "(", "text", ",", "args", ")", ",", "t", ")", ";", "}", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "}", ")", ".", "minConsumerCount", "(", "1", ")", ".", "maxConsumerCount", "(", "<NUM_LIT:3>", ")", ".", "loadFactor", "(", "<NUM_LIT:3>", ")", ".", "consumerKeepAlive", "(", "<NUM_LIT>", ")", ";", "if", "(", "Build", ".", "VERSION", ".", "SDK_INT", ">", "=", "Build", ".", "VERSION_CODES", ".", "LOLLIPOP", ")", "{", "frameworkScheduler", "=", "new", "FrameworkScheduler", "(", "MyJobService", ".", "class", ")", ";", "builder", ".", "scheduler", "(", "frameworkScheduler", ")", ";", "}", "jobManager", "=", "new", "JobManager2", "(", "builder", ".", "build", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "d", "(", "TAG", ",", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "String", ".", "format", "(", "text", ",", "args", ")", ",", "t", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "</s>"]
["<s>", "public", "JobManager2", "getJobManager", "(", ")", "{", "return", "jobManager", ";", "}", "</s>"]
["<s>", "public", "FrameworkScheduler", "getFrameworkScheduler", "(", ")", "{", "return", "frameworkScheduler", ";", "}", "</s>"]
["<s>", "public", "static", "TwitterApplication", "getInstance", "(", ")", "{", "return", "instance", ";", "}", "</s>"]
["<s>", "public", "SimpleBackgroundTask", "(", "Activity", "activity", ")", "{", "weakActivity", "=", "new", "WeakReference", "<", "Activity", ">", "(", "activity", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "final", "T", "doInBackground", "(", "Void", ".", ".", ".", "voids", ")", "{", "return", "onRun", "(", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "canContinue", "(", ")", "{", "Activity", "activity", "=", "weakActivity", ".", "get", "(", ")", ";", "return", "activity", "!", "=", "null", "&", "&", "activity", ".", "isFinishing", "(", ")", "=", "=", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onPostExecute", "(", "T", "t", ")", "{", "if", "(", "canContinue", "(", ")", ")", "{", "onSuccess", "(", "t", ")", ";", "}", "}", "</s>"]
["<s>", "abstract", "protected", "T", "onRun", "(", ")", ";", "</s>"]
["<s>", "abstract", "protected", "void", "onSuccess", "(", "T", "result", ")", ";", "</s>"]
["<s>", "public", "synchronized", "static", "TweetModel", "getInstance", "(", ")", "{", "if", "(", "instance", "=", "=", "null", ")", "{", "instance", "=", "new", "TweetModel", "(", ")", ";", "}", "return", "instance", ";", "}", "</s>"]
["<s>", "private", "TweetModel", "(", ")", "{", "tweetDao", "=", "DbHelper", ".", "getInstance", "(", ")", ".", "getDaoSession", "(", ")", ".", "getTweetDao", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Tweet", "getLastTweet", "(", ")", "{", "return", "tweetDao", ".", "queryBuilder", "(", ")", ".", "where", "(", "TweetDao", ".", "Properties", ".", "ServerId", ".", "isNotNull", "(", ")", ")", ".", "orderDesc", "(", "TweetDao", ".", "Properties", ".", "CreatedAt", ")", ".", "limit", "(", "1", ")", ".", "unique", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "insertOrReplace", "(", "Tweet", "tweet", ")", "{", "tweetDao", ".", "insertOrReplace", "(", "tweet", ")", ";", "}", "</s>"]
["<s>", "public", "void", "insertOrReplaceAll", "(", "Collection", "<", "Tweet", ">", "tweets", ")", "{", "tweetDao", ".", "insertOrReplaceInTx", "(", "tweets", ")", ";", "}", "</s>"]
["<s>", "public", "LazyList", "<", "Tweet", ">", "lazyLoadTweets", "(", ")", "{", "return", "tweetDao", ".", "queryBuilder", "(", ")", ".", "orderDesc", "(", "TweetDao", ".", "Properties", ".", "IsLocal", ",", "TweetDao", ".", "Properties", ".", "CreatedAt", ")", ".", "listLazy", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Tweet", "getTweetByLocalId", "(", "long", "localId", ")", "{", "return", "tweetDao", ".", "queryBuilder", "(", ")", ".", "where", "(", "TweetDao", ".", "Properties", ".", "LocalId", ".", "eq", "(", "localId", ")", ")", ".", "limit", "(", "1", ")", ".", "unique", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "deleteTweetById", "(", "long", "localId", ")", "{", "tweetDao", ".", "deleteByKey", "(", "localId", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "static", "DbHelper", "getInstance", "(", ")", "{", "if", "(", "instance", "=", "=", "null", ")", "{", "instance", "=", "new", "DbHelper", "(", ")", ";", "}", "return", "instance", ";", "}", "</s>"]
["<s>", "public", "DbHelper", "(", ")", "{", "Context", "appContext", "=", "TwitterApplication", ".", "getInstance", "(", ")", ".", "getApplicationContext", "(", ")", ";", "DaoMaster", ".", "DevOpenHelper", "devOpenHelper", "=", "new", "DaoMaster", ".", "DevOpenHelper", "(", "appContext", ",", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "db", "=", "devOpenHelper", ".", "getWritableDatabase", "(", ")", ";", "daoMaster", "=", "new", "DaoMaster", "(", "db", ")", ";", "daoSession", "=", "daoMaster", ".", "newSession", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DaoSession", "getDaoSession", "(", ")", "{", "return", "daoSession", ";", "}", "</s>"]
["<s>", "public", "DaoMaster", "getDaoMaster", "(", ")", "{", "return", "daoMaster", ";", "}", "</s>"]
["<s>", "public", "LazyListAdapter", "(", ")", "{", "}", "</s>"]
["<s>", "public", "LazyListAdapter", "(", "LazyList", "<", "T", ">", "initialList", ")", "{", "lazyList", "=", "initialList", ";", "}", "</s>"]
["<s>", "public", "void", "replaceLazyList", "(", "LazyList", "<", "T", ">", "newList", ")", "{", "if", "(", "lazyList", "!", "=", "null", ")", "{", "lazyList", ".", "close", "(", ")", ";", "}", "lazyList", "=", "newList", ";", "notifyDataSetChanged", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getCount", "(", ")", "{", "return", "lazyList", "=", "=", "null", "?", "0", ":", "lazyList", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "T", "getItem", "(", "int", "i", ")", "{", "return", "lazyList", "=", "=", "null", "?", "null", ":", "lazyList", ".", "get", "(", "i", ")", ";", "}", "</s>"]
["<s>", "public", "void", "close", "(", ")", "{", "if", "(", "lazyList", "!", "=", "null", ")", "{", "lazyList", ".", "close", "(", ")", ";", "lazyList", "=", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onResume", "(", ")", "{", "super", ".", "onResume", "(", ")", ";", "visible", "=", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onPause", "(", ")", "{", "super", ".", "onPause", "(", ")", ";", "visible", "=", "false", ";", "}", "</s>"]
["<s>", "public", "boolean", "isVisible", "(", ")", "{", "return", "visible", ";", "}", "</s>"]
["<s>", "public", "PostTweetJob", "(", "String", "text", ")", "{", "super", "(", "new", "Params", "(", "Priority", ".", "MID", ")", ".", "requireNetwork", "(", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "localId", "=", "-", "System", ".", "currentTimeMillis", "(", ")", ";", "this", ".", "text", "=", "text", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "try", "{", "Tweet", "tweet", "=", "new", "Tweet", "(", "localId", ",", "null", ",", "text", ",", "TwitterController", ".", "getInstance", "(", ")", ".", "getUserId", "(", ")", ",", "null", ",", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ")", ";", "TweetModel", ".", "getInstance", "(", ")", ".", "insertOrReplace", "(", "tweet", ")", ";", "EventBus", ".", "getDefault", "(", ")", ".", "post", "(", "new", "PostingTweetEvent", "(", "tweet", ")", ")", ";", "}", "catch", "(", "TwitterException", "exception", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "Status", "status", "=", "TwitterController", ".", "getInstance", "(", ")", ".", "postTweet", "(", "text", ")", ";", "Tweet", "newTweet", "=", "new", "Tweet", "(", "status", ")", ";", "TweetModel", "tweetModel", "=", "TweetModel", ".", "getInstance", "(", ")", ";", "Tweet", "existingTweet", "=", "tweetModel", ".", "getTweetByLocalId", "(", "localId", ")", ";", "if", "(", "existingTweet", "!", "=", "null", ")", "{", "existingTweet", ".", "updateNotNull", "(", "newTweet", ")", ";", "tweetModel", ".", "insertOrReplace", "(", "existingTweet", ")", ";", "}", "else", "{", "tweetModel", ".", "insertOrReplace", "(", "newTweet", ")", ";", "}", "EventBus", ".", "getDefault", "(", ")", ".", "post", "(", "new", "PostedTweetEvent", "(", "newTweet", ",", "localId", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "Tweet", "localTweet", "=", "TweetModel", ".", "getInstance", "(", ")", ".", "getTweetByLocalId", "(", "localId", ")", ";", "if", "(", "localTweet", "!", "=", "null", ")", "{", "TweetModel", ".", "getInstance", "(", ")", ".", "deleteTweetById", "(", "localId", ")", ";", "EventBus", ".", "getDefault", "(", ")", ".", "post", "(", "new", "DeletedTweetEvent", "(", "localId", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "RetryConstraint", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "if", "(", "throwable", "instanceof", "TwitterException", ")", "{", "TwitterException", "twitterException", "=", "(", "TwitterException", ")", "throwable", ";", "int", "errorCode", "=", "twitterException", ".", "getErrorCode", "(", ")", ";", "return", "errorCode", "<", "<NUM_LIT>", "|", "|", "errorCode", ">", "<NUM_LIT>", "?", "RetryConstraint", ".", "RETRY", ":", "RetryConstraint", ".", "CANCEL", ";", "}", "return", "RetryConstraint", ".", "RETRY", ";", "}", "</s>"]
["<s>", "public", "FetchTweetsJob", "(", ")", "{", "super", "(", "new", "Params", "(", "Priority", ".", "LOW", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "id", "=", "jobCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "if", "(", "id", "!", "=", "jobCounter", ".", "get", "(", ")", ")", "{", "return", ";", "}", "TweetModel", "tweetModel", "=", "TweetModel", ".", "getInstance", "(", ")", ";", "Tweet", "lastTweet", "=", "tweetModel", ".", "getLastTweet", "(", ")", ";", "List", "<", "Status", ">", "statusList", "=", "TwitterController", ".", "getInstance", "(", ")", ".", "loadTweets", "(", "lastTweet", "=", "=", "null", "?", "null", ":", "lastTweet", ".", "getServerId", "(", ")", ")", ";", "if", "(", "statusList", ".", "size", "(", ")", ">", "0", ")", "{", "List", "<", "Tweet", ">", "tweets", "=", "new", "ArrayList", "<", "Tweet", ">", "(", "statusList", ".", "size", "(", ")", ")", ";", "for", "(", "Status", "status", ":", "statusList", ")", "{", "Tweet", "tweet", "=", "new", "Tweet", "(", "status", ")", ";", "tweets", ".", "add", "(", "tweet", ")", ";", "}", "tweetModel", ".", "insertOrReplaceAll", "(", "tweets", ")", ";", "EventBus", ".", "getDefault", "(", ")", ".", "post", "(", "new", "FetchedNewTweetsEvent", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "RetryConstraint", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "if", "(", "throwable", "instanceof", "TwitterException", ")", "{", "TwitterException", "twitterException", "=", "(", "TwitterException", ")", "throwable", ";", "int", "errorCode", "=", "twitterException", ".", "getErrorCode", "(", ")", ";", "return", "errorCode", "<", "<NUM_LIT>", "|", "|", "errorCode", ">", "<NUM_LIT>", "?", "RetryConstraint", ".", "RETRY", ":", "RetryConstraint", ".", "CANCEL", ";", "}", "return", "RetryConstraint", ".", "RETRY", ";", "}", "</s>"]
["<s>", "public", "DeletedTweetEvent", "(", "long", "id", ")", "{", "this", ".", "id", "=", "id", ";", "}", "</s>"]
["<s>", "public", "long", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "PostingTweetEvent", "(", "Tweet", "tweeet", ")", "{", "this", ".", "tweeet", "=", "tweeet", ";", "}", "</s>"]
["<s>", "public", "Tweet", "getTweeet", "(", ")", "{", "return", "tweeet", ";", "}", "</s>"]
["<s>", "public", "PostedTweetEvent", "(", "Tweet", "tweet", ",", "long", "localId", ")", "{", "this", ".", "tweet", "=", "tweet", ";", "this", ".", "localId", "=", "localId", ";", "}", "</s>"]
["<s>", "public", "Tweet", "getTweet", "(", ")", "{", "return", "tweet", ";", "}", "</s>"]
["<s>", "public", "long", "getLocalId", "(", ")", "{", "return", "localId", ";", "}", "</s>"]
["<s>", "public", "synchronized", "static", "TwitterController", "getInstance", "(", ")", "{", "if", "(", "instance", "=", "=", "null", ")", "{", "instance", "=", "new", "TwitterController", "(", ")", ";", "}", "return", "instance", ";", "}", "</s>"]
["<s>", "public", "TwitterController", "(", ")", "{", "twitter", "=", "new", "TwitterFactory", "(", "new", "ConfigurationBuilder", "(", ")", ".", "setOAuthAccessToken", "(", "Config", ".", "ACCESS_TOKEN", ")", ".", "setOAuthAccessTokenSecret", "(", "Config", ".", "ACCESS_TOKEN_SECRET", ")", ".", "setDebugEnabled", "(", "true", ")", ".", "setOAuthConsumerKey", "(", "Config", ".", "CONSUMER_KEY", ")", ".", "setOAuthConsumerKey", "(", "Config", ".", "CONSUMER_SECRET", ")", ".", "build", "(", ")", ")", ".", "getSingleton", "(", ")", ";", "AccessToken", "accessToken", "=", "new", "AccessToken", "(", "Config", ".", "ACCESS_TOKEN", ",", "Config", ".", "ACCESS_TOKEN_SECRET", ")", ";", "twitter", ".", "setOAuthConsumer", "(", "Config", ".", "CONSUMER_KEY", ",", "Config", ".", "CONSUMER_SECRET", ")", ";", "twitter", ".", "setOAuthAccessToken", "(", "accessToken", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "Status", ">", "loadTweets", "(", "Long", "sinceId", ")", "throws", "TwitterException", "{", "Paging", "paging", "=", "new", "Paging", "(", ")", ";", "paging", ".", "setCount", "(", "PAGE_LENGTH", ")", ";", "if", "(", "sinceId", "!", "=", "null", ")", "{", "paging", ".", "setSinceId", "(", "sinceId", ")", ";", "}", "return", "twitter", ".", "getHomeTimeline", "(", "paging", ")", ";", "}", "</s>"]
["<s>", "public", "Status", "postTweet", "(", "String", "status", ")", "throws", "TwitterException", "{", "return", "twitter", ".", "updateStatus", "(", "status", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getUserId", "(", ")", "throws", "TwitterException", "{", "if", "(", "userId", "=", "=", "null", ")", "{", "userId", "=", "twitter", ".", "getId", "(", ")", ";", "}", "return", "userId", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "FrameworkScheduler", "getScheduler", "(", ")", "{", "return", "TwitterApplication", ".", "getInstance", "(", ")", ".", "getFrameworkScheduler", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Tweet", "(", ")", "{", "}", "</s>"]
["<s>", "public", "Tweet", "(", "Long", "localId", ")", "{", "super", "(", "localId", ")", ";", "}", "</s>"]
["<s>", "public", "Tweet", "(", "Long", "localId", ",", "Long", "serverId", ",", "String", "text", ",", "Long", "userId", ",", "Boolean", "isLocal", ",", "java", ".", "util", ".", "Date", "createdAt", ")", "{", "super", "(", "localId", ",", "serverId", ",", "text", ",", "userId", ",", "isLocal", ",", "createdAt", ")", ";", "}", "</s>"]
["<s>", "public", "Tweet", "(", "Status", "status", ")", "{", "super", "(", "null", ",", "status", ".", "getId", "(", ")", ",", "status", ".", "getText", "(", ")", ",", "status", ".", "getUser", "(", ")", ".", "getId", "(", ")", ",", "false", ",", "status", ".", "getCreatedAt", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onBeforeSave", "(", ")", "{", "isLocal", "=", "serverId", "=", "=", "null", ";", "super", ".", "onBeforeSave", "(", ")", ";", "}", "</s>"]
["<s>", "public", "TwitterDaoGenerator", "(", ")", "throws", "IOException", "{", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "{", "Schema", "schema", "=", "new", "Schema", "(", "<NUM_LIT:3>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "schema", ".", "setDefaultJavaPackageTest", "(", "\"", "<STR_LIT>", "\"", ")", ";", "schema", ".", "setDefaultJavaPackageDao", "(", "\"", "<STR_LIT>", "\"", ")", ";", "schema", ".", "enableKeepSectionsByDefault", "(", ")", ";", "Entity", "tweet", "=", "schema", ".", "addEntity", "(", "\"", "<STR_LIT>", "\"", ")", ";", "tweet", ".", "addLongProperty", "(", "\"", "<STR_LIT>", "\"", ")", ".", "primaryKey", "(", ")", ".", "autoincrement", "(", ")", ";", "tweet", ".", "addLongProperty", "(", "\"", "<STR_LIT>", "\"", ")", ".", "unique", "(", ")", ";", "tweet", ".", "addStringProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "tweet", ".", "addLongProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "tweet", ".", "addBooleanProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "tweet", ".", "addDateProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "new", "DaoGenerator", "(", ")", ".", "generateAll", "(", "schema", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "init", "(", ")", "{", "PriorityMessageQueue", "pmq", "=", "mock", "(", "PriorityMessageQueue", ".", "class", ")", ";", "SafeMessageQueue", "mq", "=", "mock", "(", "SafeMessageQueue", ".", "class", ")", ";", "Consumer", "consumer", "=", "new", "Consumer", "(", "pmq", ",", "mq", ",", "factory", ",", "timer", ")", ";", "consumer", ".", "run", "(", ")", ";", "verify", "(", "mq", ")", ".", "consume", "(", "any", "(", "MessageQueueConsumer", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setRunning", "(", "MessageQueue", "mq", ")", "{", "Reflection", ".", "field", "(", "\"", "<STR_LIT>", "\"", ")", ".", "ofType", "(", "AtomicBoolean", ".", "class", ")", ".", "in", "(", "mq", ")", ".", "get", "(", ")", ".", "set", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "idleMessage", "(", ")", "{", "MessageFactory", "factory", "=", "new", "MessageFactory", "(", ")", ";", "PriorityMessageQueue", "pmq", "=", "new", "PriorityMessageQueue", "(", "timer", ",", "factory", ")", ";", "SafeMessageQueue", "mq", "=", "new", "SafeMessageQueue", "(", "timer", ",", "factory", ",", "\"", "<STR_LIT>", "\"", ")", ";", "setRunning", "(", "pmq", ")", ";", "setRunning", "(", "mq", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "Consumer", "consumer", "=", "new", "Consumer", "(", "pmq", ",", "mq", ",", "factory", ",", "timer", ")", ";", "consumer", ".", "queueConsumer", ".", "onIdle", "(", ")", ";", "Message", "message", "=", "pmq", ".", "next", "(", "dummyConsumer", ")", ";", "assertThat", "(", "message", ",", "CoreMatchers", ".", "instanceOf", "(", "JobConsumerIdleMessage", ".", "class", ")", ")", ";", "assertThat", "(", "(", "(", "JobConsumerIdleMessage", ")", "message", ")", ".", "getLastJobCompleted", "(", ")", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "runJobMessage", "(", ")", "{", "MessageFactory", "factory", "=", "new", "MessageFactory", "(", ")", ";", "PriorityMessageQueue", "pmq", "=", "new", "PriorityMessageQueue", "(", "timer", ",", "factory", ")", ";", "setRunning", "(", "pmq", ")", ";", "SafeMessageQueue", "mq", "=", "new", "SafeMessageQueue", "(", "timer", ",", "factory", ",", "\"", "<STR_LIT>", "\"", ")", ";", "setRunning", "(", "mq", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "Consumer", "consumer", "=", "new", "Consumer", "(", "pmq", ",", "mq", ",", "factory", ",", "timer", ")", ";", "RunJobMessage", "rjm", "=", "factory", ".", "obtain", "(", "RunJobMessage", ".", "class", ")", ";", "JobHolder", "mockHolder", "=", "mock", "(", "JobHolder", ".", "class", ")", ";", "when", "(", "mockHolder", ".", "safeRun", "(", "0", ")", ")", ".", "thenReturn", "(", "JobHolder", ".", "RUN_RESULT_SUCCESS", ")", ";", "rjm", ".", "setJobHolder", "(", "mockHolder", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "consumer", ".", "queueConsumer", ".", "handleMessage", "(", "rjm", ")", ";", "Message", "message", "=", "pmq", ".", "next", "(", "dummyConsumer", ")", ";", "assertThat", "(", "message", ",", "CoreMatchers", ".", "instanceOf", "(", "RunJobResultMessage", ".", "class", ")", ")", ";", "RunJobResultMessage", "result", "=", "(", "RunJobResultMessage", ")", "message", ";", "assertThat", "(", "result", ".", "getResult", "(", ")", ",", "CoreMatchers", ".", "is", "(", "JobHolder", ".", "RUN_RESULT_SUCCESS", ")", ")", ";", "assertThat", "(", "result", ".", "getJobHolder", "(", ")", ",", "CoreMatchers", ".", "is", "(", "mockHolder", ")", ")", ";", "assertThat", "(", "consumer", ".", "lastJobCompleted", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "removePokesAfterJobTest", "(", ")", "{", "MessageFactory", "factory", "=", "new", "MessageFactory", "(", ")", ";", "PriorityMessageQueue", "pmq", "=", "new", "PriorityMessageQueue", "(", "timer", ",", "factory", ")", ";", "setRunning", "(", "pmq", ")", ";", "SafeMessageQueue", "mq", "=", "spy", "(", "new", "SafeMessageQueue", "(", "timer", ",", "factory", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "setRunning", "(", "mq", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "Consumer", "consumer", "=", "new", "Consumer", "(", "pmq", ",", "mq", ",", "factory", ",", "timer", ")", ";", "RunJobMessage", "rjm", "=", "factory", ".", "obtain", "(", "RunJobMessage", ".", "class", ")", ";", "JobHolder", "mockHolder", "=", "mock", "(", "JobHolder", ".", "class", ")", ";", "when", "(", "mockHolder", ".", "safeRun", "(", "0", ")", ")", ".", "thenReturn", "(", "JobHolder", ".", "RUN_RESULT_SUCCESS", ")", ";", "rjm", ".", "setJobHolder", "(", "mockHolder", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "verify", "(", "mq", ",", "times", "(", "0", ")", ")", ".", "cancelMessages", "(", "Consumer", ".", "pokeMessagePredicate", ")", ";", "consumer", ".", "queueConsumer", ".", "handleMessage", "(", "rjm", ")", ";", "verify", "(", "mq", ",", "times", "(", "1", ")", ")", ".", "cancelMessages", "(", "Consumer", ".", "pokeMessagePredicate", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "pokePredicateTest", "(", ")", "{", "CommandMessage", "cm", "=", "new", "CommandMessage", "(", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "assertThat", "(", "Consumer", ".", "pokeMessagePredicate", ".", "onMessage", "(", "cm", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "QUIT", ")", ";", "assertThat", "(", "Consumer", ".", "pokeMessagePredicate", ".", "onMessage", "(", "cm", ")", ",", "CoreMatchers", ".", "is", "(", "false", ")", ")", ";", "assertThat", "(", "Consumer", ".", "pokeMessagePredicate", ".", "onMessage", "(", "new", "RunJobMessage", "(", ")", ")", ",", "CoreMatchers", ".", "is", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "public", "JobManagerThreadRunnable", "(", "JobManager", "jobManager", ")", "{", "this", ".", "jobManager", "=", "jobManager", ";", "}", "</s>"]
["<s>", "private", "void", "assertRunning", "(", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "running", ".", "get", "(", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "getNextJob", "(", ")", "{", "assertRunning", "(", ")", ";", "return", "jobManager", ".", "jobManagerThread", ".", "getNextJobForTesting", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "getNextJob", "(", "Collection", "<", "String", ">", "exclude", ")", "{", "assertRunning", "(", ")", ";", "return", "jobManager", ".", "jobManagerThread", ".", "getNextJobForTesting", "(", "exclude", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "removeJob", "(", "JobHolder", "jobHolder", ")", "{", "assertRunning", "(", ")", ";", "jobManager", ".", "jobManagerThread", ".", "nonPersistentJobQueue", ".", "remove", "(", "jobHolder", ")", ";", "jobManager", ".", "jobManagerThread", ".", "persistentJobQueue", ".", "remove", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "findJobFromQueues", "(", "String", "id", ")", "{", "assertRunning", "(", ")", ";", "JobHolder", "holder", "=", "jobManager", ".", "jobManagerThread", ".", "nonPersistentJobQueue", ".", "findJobById", "(", "id", ")", ";", "if", "(", "holder", "!", "=", "null", ")", "{", "return", "holder", ";", "}", "return", "jobManager", ".", "jobManagerThread", ".", "persistentJobQueue", ".", "findJobById", "(", "id", ")", ";", "}", "</s>"]
["<s>", "public", "T", "run", "(", ")", "throws", "Throwable", "{", "final", "Object", "[", "]", "result", "=", "new", "Object", "[", "1", "]", ";", "jobManager", ".", "internalRunInJobManagerThread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "running", ".", "set", "(", "true", ")", ";", "result", "[", "0", "]", "=", "onRun", "(", ")", ";", "}", "finally", "{", "running", ".", "set", "(", "false", ")", ";", "}", "}", "}", ")", ";", "return", "(", "T", ")", "result", "[", "0", "]", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "running", ".", "set", "(", "true", ")", ";", "result", "[", "0", "]", "=", "onRun", "(", ")", ";", "}", "finally", "{", "running", ".", "set", "(", "false", ")", ";", "}", "}", "</s>"]
["<s>", "public", "abstract", "T", "onRun", "(", ")", ";", "</s>"]
["<s>", "@", "SuppressLint", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "@", "Test", "public", "void", "testNow", "(", ")", "throws", "Throwable", "{", "SystemTimer", "timer", "=", "new", "SystemTimer", "(", ")", ";", "long", "startNs", "=", "System", ".", "nanoTime", "(", ")", ";", "long", "start", "=", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "assertReasonable", "(", "timer", ".", "nanoTime", "(", ")", ",", "System", ".", "nanoTime", "(", ")", "-", "startNs", "+", "start", ")", ";", "SystemTimer", "timer2", "=", "new", "SystemTimer", "(", ")", ";", "assertReasonable", "(", "timer2", ".", "nanoTime", "(", ")", ",", "System", ".", "nanoTime", "(", ")", "-", "startNs", "+", "start", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressLint", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Test", "public", "void", "testWaitOnObject", "(", ")", "throws", "Throwable", "{", "SystemTimer", "timer", "=", "new", "SystemTimer", "(", ")", ";", "long", "startRealTime", "=", "System", ".", "nanoTime", "(", ")", ";", "long", "startNs", "=", "timer", ".", "nanoTime", "(", ")", ";", "long", "waitNs", "=", "JobManager", ".", "NS_PER_MS", "*", "<NUM_LIT>", ";", "long", "waitUntil", "=", "startNs", "+", "waitNs", ";", "final", "Object", "object", "=", "new", "Object", "(", ")", ";", "synchronized", "(", "object", ")", "{", "timer", ".", "waitOnObjectUntilNs", "(", "object", ",", "waitUntil", ")", ";", "}", "assertBetween", "(", "System", ".", "nanoTime", "(", ")", "-", "startRealTime", ",", "waitNs", ",", "waitNs", "+", "<NUM_LIT>", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "}", "</s>"]
["<s>", "public", "void", "assertBetween", "(", "long", "value", ",", "long", "min", ",", "long", "max", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "value", ",", "new", "Range", "(", "min", ",", "max", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "assertReasonable", "(", "long", "value", ",", "long", "expected", ")", "{", "long", "deviation", "=", "JobManager", ".", "NS_PER_MS", "*", "<NUM_LIT>", ";", "assertBetween", "(", "value", ",", "expected", "-", "deviation", ",", "expected", "+", "deviation", ")", ";", "}", "</s>"]
["<s>", "public", "Range", "(", "long", "min", ",", "long", "max", ")", "{", "this", ".", "min", "=", "min", ";", "this", ".", "max", "=", "max", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matches", "(", "Object", "item", ")", "{", "long", "value", "=", "(", "long", ")", "item", ";", "return", "value", ">", "=", "min", "&", "&", "value", "<", "=", "max", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "\"", "<STR_LIT>", "\"", ")", ".", "appendValue", "(", "min", ")", ".", "appendText", "(", "\"", "<STR_LIT>", "\"", ")", ".", "appendValue", "(", "max", ")", ";", "}", "</s>"]
["<s>", "public", "TestConstraint", "(", "Timer", "timer", ")", "{", "this", ".", "timer", "=", "timer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setShouldNotRequireNetwork", "(", "boolean", "shouldNotRequireNetwork", ")", "{", "super", ".", "setShouldNotRequireNetwork", "(", "shouldNotRequireNetwork", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setTagConstraint", "(", "TagConstraint", "tagConstraint", ")", "{", "super", ".", "setTagConstraint", "(", "tagConstraint", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setExcludeRunning", "(", "boolean", "excludeRunning", ")", "{", "super", ".", "setExcludeRunning", "(", "excludeRunning", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setShouldNotRequireUnmeteredNetwork", "(", "boolean", "shouldNotRequireUnmeteredNetwork", ")", "{", "super", ".", "setShouldNotRequireUnmeteredNetwork", "(", "shouldNotRequireUnmeteredNetwork", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setTags", "(", "String", "[", "]", "tags", ")", "{", "super", ".", "setTags", "(", "tags", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setExcludeGroups", "(", "Collection", "<", "String", ">", "excludeGroups", ")", "{", "super", ".", "setExcludeGroups", "(", "excludeGroups", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setExcludeJobIds", "(", "Collection", "<", "String", ">", "jobsIds", ")", "{", "super", ".", "setExcludeJobIds", "(", "jobsIds", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "super", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getNowInNs", "(", ")", "{", "return", "timer", ".", "nanoTime", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setTimeLimit", "(", "Long", "timeLimit", ")", "{", "super", ".", "setTimeLimit", "(", "timeLimit", ")", ";", "}", "</s>"]
["<s>", "public", "static", "TestConstraint", "forTags", "(", "Timer", "timer", ",", "TagConstraint", "tagConstraint", ",", "Collection", "<", "String", ">", "excludeIds", ",", "String", ".", ".", ".", "tags", ")", "{", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "timer", ")", ";", "constraint", ".", "setTagConstraint", "(", "tagConstraint", ")", ";", "constraint", ".", "setExcludeJobIds", "(", "excludeIds", ")", ";", "constraint", ".", "setTags", "(", "tags", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "failed", "(", "Throwable", "e", ",", "Description", "description", ")", "{", "Map", "<", "Thread", ",", "StackTraceElement", "[", "]", ">", "stackTraces", "=", "Thread", ".", "getAllStackTraces", "(", ")", ";", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "Map", ".", "Entry", "<", "Thread", ",", "StackTraceElement", "[", "]", ">", "entry", ":", "stackTraces", ".", "entrySet", "(", ")", ")", "{", "sb", ".", "append", "(", "entry", ".", "getKey", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "for", "(", "StackTraceElement", "element", ":", "entry", ".", "getValue", "(", ")", ")", "{", "sb", ".", "append", "(", "\"", "\"", ")", ".", "append", "(", "element", ".", "getClassName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT:#>", "\"", ")", ".", "append", "(", "element", ".", "getMethodName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT:#>", "\"", ")", ".", "append", "(", "element", ".", "getLineNumber", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "sb", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "throw", "new", "AssertionError", "(", "sb", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "CleanupRule", "(", "JobManagerTestBase", "test", ")", "{", "this", ".", "test", "=", "test", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "starting", "(", "Description", "description", ")", "{", "super", ".", "starting", "(", "description", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "getId", "(", "description", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "finished", "(", "Description", "description", ")", "{", "String", "id", "=", "getId", "(", "description", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "for", "(", "JobManager", "jobManager", ":", "test", ".", "getCreatedJobManagers", "(", ")", ")", "{", "JobManagerTestBase", ".", "NeverEndingDummyJob", ".", "unlockAll", "(", ")", ";", "jobManager", ".", "destroy", "(", ")", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "}", "</s>"]
["<s>", "private", "String", "getId", "(", "Description", "description", ")", "{", "return", "description", ".", "getMethodName", "(", ")", "+", "\"", "<STR_LIT:/>", "\"", "+", "description", ".", "getClassName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "failed", "(", "Throwable", "e", ",", "Description", "description", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "super", ".", "failed", "(", "e", ",", "description", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test1", "(", ")", "{", "CommandMessage", "mC1", "=", "new", "CommandMessage", "(", ")", ";", "CommandMessage", "mC2", "=", "new", "CommandMessage", "(", ")", ";", "AddJobMessage", "aj1", "=", "new", "AddJobMessage", "(", ")", ";", "AddJobMessage", "aj2", "=", "new", "AddJobMessage", "(", ")", ";", "mq", ".", "post", "(", "mC1", ")", ";", "mq", ".", "post", "(", "mC2", ")", ";", "mq", ".", "post", "(", "aj1", ")", ";", "mq", ".", "post", "(", "aj2", ")", ";", "final", "List", "<", "Message", ">", "expectedOrder", "=", "Arrays", ".", "asList", "(", "aj1", ",", "aj2", ",", "mC1", ",", "mC2", ")", ";", "mq", ".", "consume", "(", "new", "MessageQueueConsumer", "(", ")", "{", "int", "index", ";", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "assertThat", "(", "message", ",", "is", "(", "expectedOrder", ".", "get", "(", "index", "+", "+", ")", ")", ")", ";", "if", "(", "index", "=", "=", "expectedOrder", ".", "size", "(", ")", ")", "{", "mq", ".", "stop", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "assertThat", "(", "message", ",", "is", "(", "expectedOrder", ".", "get", "(", "index", "+", "+", ")", ")", ")", ";", "if", "(", "index", "=", "=", "expectedOrder", ".", "size", "(", ")", ")", "{", "mq", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "PriorityMessageQueue", "createMessageQueue", "(", "Timer", "timer", ",", "MessageFactory", "factory", ")", "{", "return", "new", "PriorityMessageQueue", "(", "timer", ",", "factory", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoveAll", "(", ")", "{", "for", "(", "Long", "readyNs", ":", "items", ")", "{", "add", "(", "readyNs", ")", ";", "}", "bag", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "true", ";", "}", "}", ")", ";", "MessageQueue", "mq", "=", "mock", "(", "MessageQueue", ".", "class", ")", ";", "Long", "t1", "=", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "assertThat", "(", "t1", ",", "CoreMatchers", ".", "nullValue", "(", ")", ")", ";", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "verify", "(", "mq", ",", "times", "(", "0", ")", ")", ".", "post", "(", "any", "(", "Message", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoveNothing", "(", ")", "{", "for", "(", "Long", "readyNs", ":", "items", ")", "{", "add", "(", "readyNs", ")", ";", "}", "bag", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "false", ";", "}", "}", ")", ";", "MessageQueue", "mq", "=", "mock", "(", "MessageQueue", ".", "class", ")", ";", "long", "t1", "=", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "assertThat", "(", "t1", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "verify", "(", "mq", ",", "times", "(", "<NUM_LIT:3>", ")", ")", ".", "post", "(", "any", "(", "Message", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoveUnmatch", "(", ")", "{", "testRemove", "(", "0", ",", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove1000", "(", ")", "{", "testRemove", "(", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove2000", "(", ")", "{", "testRemove", "(", "<NUM_LIT>", ",", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove3000", "(", ")", "{", "testRemove", "(", "<NUM_LIT>", ",", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testRemove", "(", "final", "long", "itemToRemove", ",", "long", ".", ".", ".", "toBeReceived", ")", "{", "for", "(", "Long", "readyNs", ":", "items", ")", "{", "add", "(", "readyNs", ")", ";", "}", "bag", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", ".", "readyNs", "=", "=", "itemToRemove", ";", "}", "}", ")", ";", "MessageQueue", "mq", "=", "mock", "(", "MessageQueue", ".", "class", ")", ";", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "for", "(", "long", "item", ":", "toBeReceived", ")", "{", "verify", "(", "mq", ")", ".", "post", "(", "same", "(", "added", ".", "get", "(", "item", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", ".", "readyNs", "=", "=", "itemToRemove", ";", "}", "</s>"]
["<s>", "private", "Message", "add", "(", "long", "readyNs", ")", "{", "CommandMessage", "msg", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "bag", ".", "add", "(", "msg", ",", "readyNs", ")", ";", "added", ".", "put", "(", "readyNs", ",", "msg", ")", ";", "return", "msg", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test", "(", ")", "{", "AddJobMessage", "aj1", "=", "factory", ".", "obtain", "(", "AddJobMessage", ".", "class", ")", ";", "assertThat", "(", "aj1", ",", "isA", "(", "AddJobMessage", ".", "class", ")", ")", ";", "CommandMessage", "cm1", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "assertThat", "(", "cm1", ",", "isA", "(", "CommandMessage", ".", "class", ")", ")", ";", "assertThat", "(", "factory", ".", "obtain", "(", "AddJobMessage", ".", "class", ")", ",", "not", "(", "sameInstance", "(", "aj1", ")", ")", ")", ";", "assertThat", "(", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ",", "not", "(", "sameInstance", "(", "cm1", ")", ")", ")", ";", "factory", ".", "release", "(", "aj1", ")", ";", "factory", ".", "release", "(", "cm1", ")", ";", "assertThat", "(", "factory", ".", "obtain", "(", "AddJobMessage", ".", "class", ")", ",", "sameInstance", "(", "aj1", ")", ")", ";", "assertThat", "(", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ",", "sameInstance", "(", "cm1", ")", ")", ";", "assertThat", "(", "factory", ".", "obtain", "(", "AddJobMessage", ".", "class", ")", ",", "not", "(", "sameInstance", "(", "aj1", ")", ")", ")", ";", "assertThat", "(", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ",", "not", "(", "sameInstance", "(", "cm1", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "simplePost", "(", ")", "{", "Message", "m", "=", "new", "CommandMessage", "(", ")", ";", "Message", "m2", "=", "new", "CommandMessage", "(", ")", ";", "Message", "m3", "=", "new", "CommandMessage", "(", ")", ";", "mq", ".", "post", "(", "m", ")", ";", "mq", ".", "post", "(", "m2", ")", ";", "mq", ".", "post", "(", "m3", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "m", ")", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "m2", ")", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "m3", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "simplePostAtFront", "(", ")", "{", "Message", "m", "=", "new", "CommandMessage", "(", ")", ";", "Message", "m2", "=", "new", "CommandMessage", "(", ")", ";", "Message", "m3", "=", "new", "CommandMessage", "(", ")", ";", "mq", ".", "postAtFront", "(", "m", ")", ";", "mq", ".", "postAtFront", "(", "m2", ")", ";", "mq", ".", "postAtFront", "(", "m3", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "m3", ")", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "m2", ")", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "m", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoveAll", "(", ")", "{", "for", "(", "Long", "readyNs", ":", "items", ")", "{", "add", "(", "readyNs", ")", ";", "}", "mq", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "true", ";", "}", "}", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "nullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoveNothing", "(", ")", "{", "for", "(", "Long", "readyNs", ":", "items", ")", "{", "add", "(", "readyNs", ")", ";", "}", "mq", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "false", ";", "}", "}", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "sameInstance", "(", "added", ".", "get", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "sameInstance", "(", "added", ".", "get", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "sameInstance", "(", "added", ".", "get", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoveUnmatch", "(", ")", "{", "testRemove", "(", "0", ",", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove1000", "(", ")", "{", "testRemove", "(", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove2000", "(", ")", "{", "testRemove", "(", "<NUM_LIT>", ",", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove3000", "(", ")", "{", "testRemove", "(", "<NUM_LIT>", ",", "<NUM_LIT:1000>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testRemove", "(", "final", "long", "itemToRemove", ",", "long", ".", ".", ".", "toBeReceived", ")", "{", "for", "(", "Long", "id", ":", "items", ")", "{", "add", "(", "id", ")", ";", "}", "mq", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", "=", "=", "added", ".", "get", "(", "itemToRemove", ")", ";", "}", "}", ")", ";", "for", "(", "long", "item", ":", "toBeReceived", ")", "{", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "is", "(", "added", ".", "get", "(", "item", ")", ")", ")", ";", "}", "assertThat", "(", "mq", ".", "next", "(", ")", ",", "nullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", "=", "=", "added", ".", "get", "(", "itemToRemove", ")", ";", "}", "</s>"]
["<s>", "private", "Message", "add", "(", "long", "id", ")", "{", "CommandMessage", "msg", "=", "new", "CommandMessage", "(", ")", ";", "mq", ".", "post", "(", "msg", ")", ";", "added", ".", "put", "(", "id", ",", "msg", ")", ";", "return", "msg", ";", "}", "</s>"]
["<s>", "public", "DelayedMessageBagAddTest", "(", "List", "<", "Long", ">", "ordered", ")", "{", "this", ".", "ordered", "=", "ordered", ";", "}", "</s>"]
["<s>", "@", "Parameterized", ".", "Parameters", "(", "name", "=", "\"", "<STR_LIT>", "\"", ")", "static", "public", "List", "<", "List", "<", "Long", ">", ">", "params", "(", ")", "{", "List", "<", "List", "<", "Long", ">", ">", "result", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", "int", "a", "=", "0", ";", "a", "<", "<NUM_LIT:3>", ";", "a", "+", "+", ")", "{", "for", "(", "int", "b", "=", "0", ";", "b", "<", "<NUM_LIT:3>", ";", "b", "+", "+", ")", "{", "if", "(", "b", "=", "=", "a", ")", "{", "continue", ";", "}", "for", "(", "int", "c", "=", "0", ";", "c", "<", "<NUM_LIT:3>", ";", "c", "+", "+", ")", "{", "if", "(", "c", "=", "=", "a", "|", "|", "c", "=", "=", "b", ")", "{", "continue", ";", "}", "Long", "[", "]", "items", "=", "new", "Long", "[", "<NUM_LIT:3>", "]", ";", "items", "[", "a", "]", "=", "<NUM_LIT>", ";", "items", "[", "b", "]", "=", "<NUM_LIT>", ";", "items", "[", "c", "]", "=", "<NUM_LIT>", ";", "result", ".", "add", "(", "Arrays", ".", "asList", "(", "items", ")", ")", ";", "}", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddOrdered", "(", ")", "{", "for", "(", "Long", "readyNs", ":", "ordered", ")", "{", "add", "(", "readyNs", ")", ";", "}", "Message", "m1", "=", "added", ".", "get", "(", "<NUM_LIT>", ")", ";", "Message", "m2", "=", "added", ".", "get", "(", "<NUM_LIT>", ")", ";", "Message", "m3", "=", "added", ".", "get", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "m1", ",", "CoreMatchers", ".", "notNullValue", "(", ")", ")", ";", "assertThat", "(", "m2", ",", "CoreMatchers", ".", "notNullValue", "(", ")", ")", ";", "assertThat", "(", "m3", ",", "CoreMatchers", ".", "notNullValue", "(", ")", ")", ";", "MessageQueue", "mq", "=", "mock", "(", "MessageQueue", ".", "class", ")", ";", "long", "t1", "=", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "assertThat", "(", "t1", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "verify", "(", "mq", ",", "times", "(", "0", ")", ")", ".", "post", "(", "any", "(", "Message", ".", "class", ")", ")", ";", "long", "t2", "=", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT:1000>", ",", "mq", ")", ";", "assertThat", "(", "t2", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "verify", "(", "mq", ")", ".", "post", "(", "m1", ")", ";", "Long", "t3", "=", "bag", ".", "flushReadyMessages", "(", "<NUM_LIT>", ",", "mq", ")", ";", "assertThat", "(", "t3", ",", "CoreMatchers", ".", "nullValue", "(", ")", ")", ";", "verify", "(", "mq", ")", ".", "post", "(", "m2", ")", ";", "verify", "(", "mq", ")", ".", "post", "(", "m3", ")", ";", "}", "</s>"]
["<s>", "private", "Message", "add", "(", "long", "readyNs", ")", "{", "CommandMessage", "msg", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "bag", ".", "add", "(", "msg", ",", "readyNs", ")", ";", "added", ".", "put", "(", "readyNs", ",", "msg", ")", ";", "return", "msg", ";", "}", "</s>"]
["<s>", "@", "Override", "SafeMessageQueue", "createMessageQueue", "(", "Timer", "timer", ",", "MessageFactory", "factory", ")", "{", "return", "new", "SafeMessageQueue", "(", "timer", ",", "factory", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "abstract", "T", "createMessageQueue", "(", "Timer", "timer", ",", "MessageFactory", "factory", ")", ";", "</s>"]
["<s>", "@", "Test", "public", "void", "postDelayed", "(", ")", "throws", "InterruptedException", "{", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "final", "T", "mq", "=", "createMessageQueue", "(", "timer", ",", "new", "MessageFactory", "(", ")", ")", ";", "final", "CountDownLatch", "idleLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "Throwable", "[", "]", "exception", "=", "new", "Throwable", "[", "1", "]", ";", "final", "MessageQueueConsumer", "mqConsumer", "=", "new", "MessageQueueConsumer", "(", ")", "{", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "try", "{", "assertThat", "(", "idleLatch", ".", "getCount", "(", ")", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "exception", "[", "0", "]", "=", "t", ";", "}", "finally", "{", "idleLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", ";", "Thread", "thread", "=", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "mqConsumer", ")", ";", "}", "}", ")", ";", "thread", ".", "start", "(", ")", ";", "assertThat", "(", "idleLatch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "timer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "mq", ".", "stop", "(", ")", ";", "thread", ".", "join", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "exception", "[", "0", "]", ",", "CoreMatchers", ".", "nullValue", "(", ")", ")", ";", "assertThat", "(", "thread", ".", "isAlive", "(", ")", ",", "CoreMatchers", ".", "is", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "try", "{", "assertThat", "(", "idleLatch", ".", "getCount", "(", ")", ",", "CoreMatchers", ".", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "exception", "[", "0", "]", "=", "t", ";", "}", "finally", "{", "idleLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "mqConsumer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "recycleOnClear", "(", ")", "{", "MessageFactory", "factory", "=", "spy", "(", "new", "MessageFactory", "(", ")", ")", ";", "MockTimer", "mockTimer", "=", "new", "MockTimer", "(", ")", ";", "T", "mq", "=", "createMessageQueue", "(", "mockTimer", ",", "factory", ")", ";", "CommandMessage", "cm", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "mq", ".", "post", "(", "cm", ")", ";", "mq", ".", "clear", "(", ")", ";", "verify", "(", "factory", ")", ".", "release", "(", "cm", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "recycleOnConsume", "(", ")", "{", "MessageFactory", "factory", "=", "spy", "(", "new", "MessageFactory", "(", ")", ")", ";", "MockTimer", "mockTimer", "=", "new", "MockTimer", "(", ")", ";", "final", "T", "mq", "=", "createMessageQueue", "(", "mockTimer", ",", "factory", ")", ";", "CommandMessage", "cm", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "mq", ".", "post", "(", "cm", ")", ";", "mq", ".", "consume", "(", "new", "MessageQueueConsumer", "(", ")", "{", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "mq", ".", "stop", "(", ")", ";", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "}", ")", ";", "verify", "(", "factory", ")", ".", "release", "(", "cm", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "mq", ".", "stop", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "recycleOnCancel", "(", ")", "{", "MessageFactory", "factory", "=", "spy", "(", "new", "MessageFactory", "(", ")", ")", ";", "MockTimer", "mockTimer", "=", "new", "MockTimer", "(", ")", ";", "final", "T", "mq", "=", "createMessageQueue", "(", "mockTimer", ",", "factory", ")", ";", "final", "CommandMessage", "cm", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "mq", ".", "post", "(", "cm", ")", ";", "final", "CommandMessage", "cm2", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm2", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "mq", ".", "post", "(", "cm2", ")", ";", "mq", ".", "cancelMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", "=", "=", "cm", ";", "}", "}", ")", ";", "verify", "(", "factory", ")", ".", "release", "(", "cm", ")", ";", "verify", "(", "factory", ",", "times", "(", "0", ")", ")", ".", "release", "(", "cm2", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", "=", "=", "cm", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "addMessageOnIdle", "(", ")", "throws", "InterruptedException", "{", "addMessageOnIdle", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "addDelayedMessageOnIdle", "(", ")", "throws", "InterruptedException", "{", "addMessageOnIdle", "(", "true", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addMessageOnIdle", "(", "final", "boolean", "delayed", ")", "throws", "InterruptedException", "{", "final", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "final", "MessageQueue", "mq", "=", "createMessageQueue", "(", "timer", ",", "new", "MessageFactory", "(", ")", ")", ";", "final", "CountDownLatch", "idleLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "MessageQueueConsumer", "mqConsumer", "=", "new", "MessageQueueConsumer", "(", ")", "{", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", "&", "&", "(", "(", "CommandMessage", ")", "message", ")", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "POKE", ")", "{", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "if", "(", "idleLatch", ".", "getCount", "(", ")", "=", "=", "1", ")", "{", "CommandMessage", "cm", "=", "new", "CommandMessage", "(", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "if", "(", "delayed", ")", "{", "mq", ".", "postAt", "(", "cm", ",", "timer", ".", "nanoTime", "(", ")", "+", "<NUM_LIT>", ")", ";", "}", "else", "{", "mq", ".", "post", "(", "cm", ")", ";", "}", "idleLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", ";", "Thread", "thread", "=", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "mqConsumer", ")", ";", "}", "}", ")", ";", "thread", ".", "start", "(", ")", ";", "assertThat", "(", "idleLatch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "timer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "runLatch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "mq", ".", "stop", "(", ")", ";", "thread", ".", "join", "(", "<NUM_LIT>", ")", ";", "if", "(", "thread", ".", "isAlive", "(", ")", ")", "{", "threadDump", ".", "failed", "(", "new", "AssertionFailedError", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ";", "}", "assertThat", "(", "thread", ".", "isAlive", "(", ")", ",", "CoreMatchers", ".", "is", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", "&", "&", "(", "(", "CommandMessage", ")", "message", ")", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "POKE", ")", "{", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "if", "(", "idleLatch", ".", "getCount", "(", ")", "=", "=", "1", ")", "{", "CommandMessage", "cm", "=", "new", "CommandMessage", "(", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "if", "(", "delayed", ")", "{", "mq", ".", "postAt", "(", "cm", ",", "timer", ".", "nanoTime", "(", ")", "+", "<NUM_LIT>", ")", ";", "}", "else", "{", "mq", ".", "post", "(", "cm", ")", ";", "}", "idleLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "mqConsumer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "postAtNoIdleCall", "(", ")", "throws", "InterruptedException", "{", "final", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "final", "MessageQueue", "mq", "=", "createMessageQueue", "(", "timer", ",", "new", "MessageFactory", "(", ")", ")", ";", "final", "CountDownLatch", "idleLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "firstIdleLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "MessageQueueConsumer", "mqConsumer", "=", "new", "MessageQueueConsumer", "(", ")", "{", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", "&", "&", "(", "(", "CommandMessage", ")", "message", ")", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "POKE", ")", "{", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "if", "(", "firstIdleLatch", ".", "getCount", "(", ")", "=", "=", "1", ")", "{", "firstIdleLatch", ".", "countDown", "(", ")", ";", "}", "else", "{", "idleLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", ";", "Thread", "thread", "=", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "mqConsumer", ")", ";", "}", "}", ")", ";", "thread", ".", "start", "(", ")", ";", "firstIdleLatch", ".", "await", "(", ")", ";", "CommandMessage", "cm", "=", "new", "CommandMessage", "(", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "mq", ".", "postAt", "(", "cm", ",", "<NUM_LIT:100>", ")", ";", "assertThat", "(", "idleLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "false", ")", ")", ";", "timer", ".", "incrementNs", "(", "<NUM_LIT:100>", ")", ";", "assertThat", "(", "idleLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "mq", ".", "stop", "(", ")", ";", "thread", ".", "join", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", "&", "&", "(", "(", "CommandMessage", ")", "message", ")", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "POKE", ")", "{", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "if", "(", "firstIdleLatch", ".", "getCount", "(", ")", "=", "=", "1", ")", "{", "firstIdleLatch", ".", "countDown", "(", ")", ";", "}", "else", "{", "idleLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "mqConsumer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "postWhileIdle", "(", ")", "throws", "InterruptedException", "{", "final", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "final", "MessageQueue", "mq", "=", "createMessageQueue", "(", "timer", ",", "new", "MessageFactory", "(", ")", ")", ";", "final", "CountDownLatch", "idleEnterLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "idleExitLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "handleMessage", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CommandMessage", "cm", "=", "new", "CommandMessage", "(", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "final", "MessageQueueConsumer", "consumer", "=", "new", "MessageQueueConsumer", "(", ")", "{", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", "=", "=", "cm", ")", "{", "handleMessage", ".", "countDown", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "idleEnterLatch", ".", "countDown", "(", ")", ";", "try", "{", "idleExitLatch", ".", "await", "(", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "}", "}", ";", "Thread", "thread", "=", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "consumer", ")", ";", "}", "}", ")", ";", "thread", ".", "start", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "idleEnterLatch", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "mq", ".", "post", "(", "cm", ")", ";", "idleExitLatch", ".", "countDown", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "handleMessage", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "mq", ".", "stop", "(", ")", ";", "thread", ".", "join", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "thread", ".", "isAlive", "(", ")", ",", "CoreMatchers", ".", "is", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", "=", "=", "cm", ")", "{", "handleMessage", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "idleEnterLatch", ".", "countDown", "(", ")", ";", "try", "{", "idleExitLatch", ".", "await", "(", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mq", ".", "consume", "(", "consumer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "recycleOnClear", "(", ")", "{", "CommandMessage", "cm", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "bag", ".", "add", "(", "cm", ",", "<NUM_LIT:1000>", ")", ";", "bag", ".", "clear", "(", ")", ";", "verify", "(", "factory", ")", ".", "release", "(", "cm", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "recycleOnCancel", "(", ")", "{", "final", "CommandMessage", "cm", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "bag", ".", "add", "(", "cm", ",", "<NUM_LIT:1000>", ")", ";", "final", "CommandMessage", "cm2", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm2", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "bag", ".", "add", "(", "cm2", ",", "<NUM_LIT:1000>", ")", ";", "bag", ".", "removeMessages", "(", "new", "MessagePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", "=", "=", "cm", ";", "}", "}", ")", ";", "verify", "(", "factory", ")", ".", "release", "(", "cm", ")", ";", "verify", "(", "factory", ",", "times", "(", "0", ")", ")", ".", "release", "(", "cm2", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", "=", "=", "cm", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "if", "(", "ENABLE_DEBUG", ")", "{", "enableDebug", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "After", "public", "void", "clearDebugger", "(", ")", "{", "JqLog", ".", "clearLogger", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "enableDebug", "(", ")", "{", "ShadowLog", ".", "stream", "=", "System", ".", "out", ";", "JqLog", ".", "setCustomLogger", "(", "new", "CustomLogger", "(", ")", "{", "private", "String", "TAG", "=", "\"", "<STR_LIT>", "\"", ";", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "true", ";", "}", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "d", "(", "TAG", ",", "prefix", "(", ")", "+", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "prefix", "(", ")", "+", "String", ".", "format", "(", "text", ",", "args", ")", ",", "t", ")", ";", "}", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "prefix", "(", ")", "+", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "private", "String", "prefix", "(", ")", "{", "return", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "d", "(", "TAG", ",", "prefix", "(", ")", "+", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "prefix", "(", ")", "+", "String", ".", "format", "(", "text", ",", "args", ")", ",", "t", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "Log", ".", "e", "(", "TAG", ",", "prefix", "(", ")", "+", "String", ".", "format", "(", "text", ",", "args", ")", ")", ";", "}", "</s>"]
["<s>", "private", "String", "prefix", "(", ")", "{", "return", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "</s>"]
["<s>", "protected", "void", "enableCollectingDebug", "(", ")", "{", "ShadowLog", ".", "stream", "=", "System", ".", "out", ";", "JqLog", ".", "setCustomLogger", "(", "new", "CustomLogger", "(", ")", "{", "private", "String", "TAG", "=", "\"", "<STR_LIT>", "\"", ";", "private", "StringBuffer", "logs", "=", "new", "StringBuffer", "(", ")", ";", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "true", ";", "}", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "logs", ".", "append", "(", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logs", ".", "append", "(", "String", ".", "format", "(", "text", ",", "args", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "logs", ".", "append", "(", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logs", ".", "append", "(", "String", ".", "format", "(", "text", ",", "args", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "logs", ".", "append", "(", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logs", ".", "append", "(", "String", ".", "format", "(", "text", ",", "args", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "logs", ".", "append", "(", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logs", ".", "append", "(", "String", ".", "format", "(", "text", ",", "args", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "logs", ".", "append", "(", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logs", ".", "append", "(", "String", ".", "format", "(", "text", ",", "args", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "logs", ".", "append", "(", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logs", ".", "append", "(", "String", ".", "format", "(", "text", ",", "args", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPriority", "(", ")", "throws", "Exception", "{", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "maxConsumerCount", "(", "1", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "testPriority", "(", "jobManager", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "public", "void", "testPriority", "(", "JobManager", "jobManager", ",", "boolean", "persist", ")", "throws", "Exception", "{", "priorityRunLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "DummyJobWithRunOrderAssert", ".", "globalRunCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "Job", "job1", "=", "new", "DummyJobWithRunOrderAssert", "(", "<NUM_LIT:2>", ",", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "persist", ")", ")", ";", "Job", "job2", "=", "new", "DummyJobWithRunOrderAssert", "(", "1", ",", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "setPersistent", "(", "persist", ")", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "jobManager", ".", "addJob", "(", "job1", ")", ";", "jobManager", ".", "addJob", "(", "job2", ")", ";", "jobManager", ".", "start", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "priorityRunLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "priorityRunLatch", ".", "getCount", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "public", "DummyJobWithRunOrderAssert", "(", "int", "expectedRunOrder", ",", "Params", "params", ")", "{", "super", "(", "params", ".", "requireNetwork", "(", ")", ")", ";", "this", ".", "expectedRunOrder", "=", "expectedRunOrder", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "final", "int", "cnt", "=", "globalRunCount", ".", "incrementAndGet", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "expectedRunOrder", ",", "equalTo", "(", "cnt", ")", ")", ";", "priorityRunLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelay", "(", ")", "throws", "Throwable", "{", "testDelay", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayPersistent", "(", ")", "throws", "Throwable", "{", "testDelay", "(", "true", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testDelay", "(", "boolean", "persist", ")", "throws", "Throwable", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "DummyJob", "delayedJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ".", "setPersistent", "(", "persist", ")", ")", ";", "DummyJob", "nonDelayedJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "setPersistent", "(", "persist", ")", ")", ";", "jobManager", ".", "addJob", "(", "delayedJob", ")", ";", "jobManager", ".", "addJob", "(", "nonDelayedJob", ")", ";", "JobHolder", "receivedJob", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "receivedJob", ",", "notNullValue", "(", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "receivedJob", ".", "getId", "(", ")", ",", "equalTo", "(", "nonDelayedJob", ".", "getId", "(", ")", ")", ")", ";", "removeJob", "(", "jobManager", ",", "receivedJob", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "nextJob", "(", "jobManager", ")", ",", "nullValue", "(", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "nextJob", "(", "jobManager", ")", ",", "nullValue", "(", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "receivedJob", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "receivedJob", ",", "notNullValue", "(", ")", ")", ";", "if", "(", "receivedJob", "!", "=", "null", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "receivedJob", ".", "getId", "(", ")", ",", "equalTo", "(", "delayedJob", ".", "getId", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnyAsyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnySyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllAsyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllSyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testCancelWithoutNetwork", "(", "boolean", "async", ",", "TagConstraint", "constraint", ")", "throws", "InterruptedException", "{", "final", "int", "jobCount", "=", "<NUM_LIT:30>", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "networkUtil", "(", "networkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "jobCount", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "new", "FailingJob", "(", "new", "Params", "(", "i", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "}", "final", "CancelResult", "[", "]", "result", "=", "new", "CancelResult", "[", "1", "]", ";", "if", "(", "async", ")", "{", "final", "CountDownLatch", "cancelLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "}", ",", "constraint", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "cancelLatch", ".", "await", "(", "jobCount", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "else", "{", "result", "[", "0", "]", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "jobCount", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "final", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "UNMETERED", ",", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "runLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnyAsyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnySyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllAsyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllSyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testCancelWithoutNetworkPersistent", "(", "boolean", "async", ",", "TagConstraint", "constraint", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "networkUtil", "(", "networkUtil", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "final", "CancelResult", "[", "]", "result", "=", "new", "CancelResult", "[", "1", "]", ";", "if", "(", "async", ")", "{", "final", "CountDownLatch", "cancelLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "}", ",", "constraint", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cancelLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "else", "{", "result", "[", "0", "]", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "final", "CountDownLatch", "runLatch", "=", "persistentLatches", "[", "latchCounter", "+", "+", "]", ";", "jobManager", ".", "addJob", "(", "new", "PersistentDummyJob", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ",", "latchCounter", "-", "1", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "FailingJob", "(", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getShouldReRunOnThrowableCnt", "(", ")", "{", "return", "<NUM_LIT:20>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "if", "(", "networkUtil", ".", "getNetworkStatus", "(", "RuntimeEnvironment", ".", "application", ")", "=", "=", "NetworkUtil", ".", "DISCONNECTED", ")", "{", "Thread", ".", "sleep", "(", "getCurrentRunCount", "(", ")", "*", "<NUM_LIT>", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "public", "PersistentDummyJob", "(", "Params", "params", ",", "int", "latch", ")", "{", "super", "(", "params", ".", "persist", "(", ")", ")", ";", "this", ".", "latch", "=", "latch", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "if", "(", "networkUtil", ".", "getNetworkStatus", "(", "RuntimeEnvironment", ".", "application", ")", "=", "=", "NetworkUtil", ".", "DISCONNECTED", ")", "{", "Thread", ".", "sleep", "(", "getCurrentRunCount", "(", ")", "*", "<NUM_LIT>", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "persistentLatches", "[", "latch", "]", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLoadFactor", "(", ")", "throws", "Exception", "{", "int", "maxConsumerCount", "=", "<NUM_LIT:5>", ";", "int", "minConsumerCount", "=", "<NUM_LIT:2>", ";", "int", "loadFactor", "=", "<NUM_LIT:5>", ";", "enableDebug", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "maxConsumerCount", "(", "maxConsumerCount", ")", ".", "minConsumerCount", "(", "minConsumerCount", ")", ".", "loadFactor", "(", "loadFactor", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "final", "CountDownLatch", "runLock", "=", "new", "CountDownLatch", "(", "1", ")", ";", "Semaphore", "semaphore", "=", "new", "Semaphore", "(", "maxConsumerCount", ")", ";", "int", "totalJobCount", "=", "loadFactor", "*", "maxConsumerCount", "*", "<NUM_LIT:5>", ";", "List", "<", "DummyJob", ">", "runningJobs", "=", "new", "ArrayList", "<", "DummyJob", ">", "(", "totalJobCount", ")", ";", "int", "prevConsumerCount", "=", "0", ";", "final", "Semaphore", "onRunCount", "=", "new", "Semaphore", "(", "totalJobCount", ")", ";", "onRunCount", ".", "acquire", "(", "totalJobCount", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "totalJobCount", ";", "i", "+", "+", ")", "{", "DummyJob", "job", "=", "new", "NeverEndingDummyJob", "(", "new", "Params", "(", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:3>", ")", ")", ",", "runLock", ",", "semaphore", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "onRunCount", ".", "release", "(", ")", ";", "super", ".", "onRun", "(", ")", ";", "}", "}", ";", "runningJobs", ".", "add", "(", "job", ")", ";", "jobManager", ".", "addJob", "(", "job", ")", ";", "final", "int", "wantedConsumers", "=", "(", "int", ")", "Math", ".", "ceil", "(", "(", "i", "+", "<NUM_LIT>", ")", "/", "loadFactor", ")", ";", "final", "int", "expectedConsumerCount", "=", "Math", ".", "max", "(", "Math", ".", "min", "(", "i", "+", "1", ",", "minConsumerCount", ")", ",", "Math", ".", "min", "(", "maxConsumerCount", ",", "wantedConsumers", ")", ")", ";", "if", "(", "prevConsumerCount", "!", "=", "expectedConsumerCount", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "onRunCount", ".", "tryAcquire", "(", "1", ",", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "(", "i", "+", "1", ")", "+", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getActiveConsumerCount", "(", ")", ",", "equalTo", "(", "expectedConsumerCount", ")", ")", ";", "prevConsumerCount", "=", "expectedConsumerCount", ";", "}", "waitUntilJobsAreDone", "(", "jobManager", ",", "runningJobs", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "runLock", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "onRunCount", ".", "release", "(", ")", ";", "super", ".", "onRun", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "runLock", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "long", "getTimeout", "(", ")", "{", "return", "<NUM_LIT>", "*", "<NUM_LIT:5>", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMultiThreaded", "(", ")", "throws", "Exception", "{", "multiThreadedJobCounter", "=", "new", "AtomicInteger", "(", "0", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "loadFactor", "(", "<NUM_LIT:3>", ")", ".", "maxConsumerCount", "(", "<NUM_LIT:10>", ")", ")", ";", "int", "limit", "=", "<NUM_LIT>", ";", "ExecutorService", "executor", "=", "new", "ThreadPoolExecutor", "(", "<NUM_LIT:20>", ",", "<NUM_LIT:20>", ",", "<NUM_LIT>", ",", "TimeUnit", ".", "SECONDS", ",", "new", "ArrayBlockingQueue", "<", "Runnable", ">", "(", "limit", ")", ")", ";", "final", "String", "cancelTag", "=", "\"", "<STR_LIT>", "\"", ";", "Collection", "<", "Future", "<", "?", ">", ">", "futures", "=", "new", "LinkedList", "<", "Future", "<", "?", ">", ">", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "limit", ";", "i", "+", "+", ")", "{", "final", "int", "id", "=", "i", ";", "futures", ".", "add", "(", "executor", ".", "submit", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "final", "boolean", "persistent", "=", "Math", ".", "round", "(", "Math", ".", "random", "(", ")", ")", "%", "<NUM_LIT:2>", "=", "=", "0", ";", "boolean", "requiresNetwork", "=", "Math", ".", "round", "(", "Math", ".", "random", "(", ")", ")", "%", "<NUM_LIT:2>", "=", "=", "0", ";", "int", "priority", "=", "(", "int", ")", "(", "Math", ".", "round", "(", "Math", ".", "random", "(", ")", ")", "%", "<NUM_LIT:10>", ")", ";", "multiThreadedJobCounter", ".", "incrementAndGet", "(", ")", ";", "Params", "params", "=", "new", "Params", "(", "priority", ")", ".", "setRequiresNetwork", "(", "requiresNetwork", ")", ".", "setPersistent", "(", "persistent", ")", ";", "if", "(", "Math", ".", "random", "(", ")", "<", "<NUM_LIT>", ")", "{", "params", ".", "addTags", "(", "cancelTag", ")", ";", "}", "jobManager", ".", "addJob", "(", "new", "DummyJobForMultiThread", "(", "id", ",", "params", ")", ")", ";", "}", "}", ")", ")", ";", "}", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "CancelResult", "cancelResult", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ALL", ",", "cancelTag", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "cancelResult", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ";", "i", "+", "+", ")", "{", "multiThreadedJobCounter", ".", "decrementAndGet", "(", ")", ";", "}", "for", "(", "Future", "<", "?", ">", "future", ":", "futures", ")", "{", "future", ".", "get", "(", ")", ";", "}", "Log", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "long", "start", "=", "System", ".", "nanoTime", "(", ")", ";", "long", "timeLimit", "=", "JobManager", ".", "NS_PER_MS", "*", "<NUM_LIT>", "*", "<NUM_LIT:20>", ";", "while", "(", "System", ".", "nanoTime", "(", ")", "-", "start", "<", "timeLimit", "&", "&", "multiThreadedJobCounter", ".", "get", "(", ")", "!", "=", "0", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "jobManager", ".", "stopAndWaitUntilConsumersAreFinished", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "multiThreadedJobCounter", ".", "get", "(", ")", ",", "CoreMatchers", ".", "is", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "final", "boolean", "persistent", "=", "Math", ".", "round", "(", "Math", ".", "random", "(", ")", ")", "%", "<NUM_LIT:2>", "=", "=", "0", ";", "boolean", "requiresNetwork", "=", "Math", ".", "round", "(", "Math", ".", "random", "(", ")", ")", "%", "<NUM_LIT:2>", "=", "=", "0", ";", "int", "priority", "=", "(", "int", ")", "(", "Math", ".", "round", "(", "Math", ".", "random", "(", ")", ")", "%", "<NUM_LIT:10>", ")", ";", "multiThreadedJobCounter", ".", "incrementAndGet", "(", ")", ";", "Params", "params", "=", "new", "Params", "(", "priority", ")", ".", "setRequiresNetwork", "(", "requiresNetwork", ")", ".", "setPersistent", "(", "persistent", ")", ";", "if", "(", "Math", ".", "random", "(", ")", "<", "<NUM_LIT>", ")", "{", "params", ".", "addTags", "(", "cancelTag", ")", ";", "}", "jobManager", ".", "addJob", "(", "new", "DummyJobForMultiThread", "(", "id", ",", "params", ")", ")", ";", "}", "</s>"]
["<s>", "private", "DummyJobForMultiThread", "(", "int", "id", ",", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "this", ".", "id", "=", "id", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "Thread", ".", "sleep", "(", "(", "long", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:1000>", ")", ")", ";", "if", "(", "Math", ".", "random", "(", ")", "<", "<NUM_LIT>", ")", "{", "throw", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "int", "remaining", "=", "multiThreadedJobCounter", ".", "decrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "int", "getRetryLimit", "(", ")", "{", "return", "<NUM_LIT:1000>", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "canUseRealTimer", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "successNonPersistent", "(", ")", "throws", "Throwable", "{", "JobManagerCallback", "callback", "=", "mock", "(", "JobManagerCallback", ".", "class", ")", ";", "final", "Job", "job", "=", "mock", "(", "Job", ".", "class", ")", ";", "doReturn", "(", "\"", "<STR_LIT>", "\"", ")", ".", "when", "(", "job", ")", ".", "getId", "(", ")", ";", "doNothing", "(", ")", ".", "when", "(", "job", ")", ".", "onAdded", "(", ")", ";", "doNothing", "(", ")", ".", "when", "(", "job", ")", ".", "onRun", "(", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "callback", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "verify", "(", "job", ")", ".", "onAdded", "(", ")", ";", "verify", "(", "job", ")", ".", "onRun", "(", ")", ";", "verify", "(", "callback", ")", ".", "onJobAdded", "(", "job", ")", ";", "verify", "(", "callback", ")", ".", "onJobRun", "(", "job", ",", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "cancelViaRetryLimit", "(", ")", "throws", "Throwable", "{", "JobManagerCallback", "callback", "=", "mock", "(", "JobManagerCallback", ".", "class", ")", ";", "final", "PublicJob", "job", "=", "mock", "(", "PublicJob", ".", "class", ")", ";", "doNothing", "(", ")", ".", "when", "(", "job", ")", ".", "onAdded", "(", ")", ";", "doReturn", "(", "\"", "<STR_LIT>", "\"", ")", ".", "when", "(", "job", ")", ".", "getId", "(", ")", ";", "doThrow", "(", "new", "Exception", "(", ")", ")", ".", "when", "(", "job", ")", ".", "onRun", "(", ")", ";", "doReturn", "(", "<NUM_LIT:3>", ")", ".", "when", "(", "job", ")", ".", "getRetryLimit", "(", ")", ";", "doReturn", "(", "RetryConstraint", ".", "RETRY", ")", ".", "when", "(", "job", ")", ".", "shouldReRunOnThrowable", "(", "any", "(", "Throwable", ".", "class", ")", ",", "anyInt", "(", ")", ",", "anyInt", "(", ")", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "callback", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "verify", "(", "callback", ")", ".", "onJobAdded", "(", "job", ")", ";", "verify", "(", "callback", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "onJobRun", "(", "job", ",", "JobManagerCallback", ".", "RESULT_FAIL_WILL_RETRY", ")", ";", "verify", "(", "callback", ",", "times", "(", "1", ")", ")", ".", "onJobRun", "(", "job", ",", "JobManagerCallback", ".", "RESULT_CANCEL_REACHED_RETRY_LIMIT", ")", ";", "verify", "(", "callback", ")", ".", "onJobCancelled", "(", "job", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "cancelViaShouldReRun", "(", ")", "throws", "Throwable", "{", "JobManagerCallback", "callback", "=", "mock", "(", "JobManagerCallback", ".", "class", ")", ";", "final", "PublicJob", "job", "=", "mock", "(", "PublicJob", ".", "class", ")", ";", "doReturn", "(", "\"", "<STR_LIT>", "\"", ")", ".", "when", "(", "job", ")", ".", "getId", "(", ")", ";", "doNothing", "(", ")", ".", "when", "(", "job", ")", ".", "onAdded", "(", ")", ";", "doThrow", "(", "new", "Exception", "(", ")", ")", ".", "when", "(", "job", ")", ".", "onRun", "(", ")", ";", "doReturn", "(", "<NUM_LIT:3>", ")", ".", "when", "(", "job", ")", ".", "getRetryLimit", "(", ")", ";", "doReturn", "(", "RetryConstraint", ".", "CANCEL", ")", ".", "when", "(", "job", ")", ".", "shouldReRunOnThrowable", "(", "any", "(", "Throwable", ".", "class", ")", ",", "anyInt", "(", ")", ",", "anyInt", "(", ")", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "callback", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "verify", "(", "callback", ")", ".", "onJobAdded", "(", "job", ")", ";", "verify", "(", "callback", ",", "times", "(", "1", ")", ")", ".", "onJobRun", "(", "job", ",", "JobManagerCallback", ".", "RESULT_CANCEL_CANCELLED_VIA_SHOULD_RE_RUN", ")", ";", "verify", "(", "callback", ")", ".", "onJobCancelled", "(", "job", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "cancelViaCancelCall", "(", ")", "throws", "Throwable", "{", "JobManagerCallback", "callback", "=", "mock", "(", "JobManagerCallback", ".", "class", ")", ";", "final", "CountDownLatch", "startLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "endLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "Throwable", "[", "]", "jobError", "=", "new", "Throwable", "[", "1", "]", ";", "PublicJob", "job", "=", "spy", "(", "new", "PublicJob", "(", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "startLatch", ".", "countDown", "(", ")", ";", "try", "{", "Assert", ".", "assertThat", "(", "endLatch", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "jobError", "[", "0", "]", "=", "t", ";", "}", "throw", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ")", ";", "doCallRealMethod", "(", ")", ".", "when", "(", "job", ")", ".", "onRun", "(", ")", ";", "doReturn", "(", "<NUM_LIT:3>", ")", ".", "when", "(", "job", ")", ".", "getRetryLimit", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "callback", ")", ";", "jobManager", ".", "addJob", "(", "job", ")", ";", "Assert", ".", "assertThat", "(", "startLatch", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "null", ",", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "while", "(", "!", "job", ".", "isCancelled", "(", ")", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:100>", ")", ";", "}", "endLatch", ".", "countDown", "(", ")", ";", "while", "(", "jobManager", ".", "getJobStatus", "(", "job", ".", "getId", "(", ")", ")", "!", "=", "JobStatus", ".", "UNKNOWN", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:100>", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "jobError", "[", "0", "]", ",", "CoreMatchers", ".", "nullValue", "(", ")", ")", ";", "verify", "(", "job", ",", "times", "(", "0", ")", ")", ".", "shouldReRunOnThrowable", "(", "any", "(", "Throwable", ".", "class", ")", ",", "anyInt", "(", ")", ",", "anyInt", "(", ")", ")", ";", "jobManager", ".", "stopAndWaitUntilConsumersAreFinished", "(", ")", ";", "verify", "(", "callback", ")", ".", "onJobAdded", "(", "job", ")", ";", "verify", "(", "callback", ",", "times", "(", "1", ")", ")", ".", "onJobRun", "(", "job", ",", "JobManagerCallback", ".", "RESULT_CANCEL_CANCELLED_WHILE_RUNNING", ")", ";", "verify", "(", "callback", ")", ".", "onJobCancelled", "(", "job", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "startLatch", ".", "countDown", "(", ")", ";", "try", "{", "Assert", ".", "assertThat", "(", "endLatch", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "jobError", "[", "0", "]", "=", "t", ";", "}", "throw", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "successPersistent", "(", ")", "throws", "Throwable", "{", "JobManagerCallback", "callback", "=", "mock", "(", "JobManagerCallback", ".", "class", ")", ";", "final", "Job", "job", "=", "new", "PersistentDummyJob", "(", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "callback", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "verify", "(", "callback", ")", ".", "onJobAdded", "(", "any", "(", "PersistentDummyJob", ".", "class", ")", ")", ";", "verify", "(", "callback", ")", ".", "onJobRun", "(", "any", "(", "PersistentDummyJob", ".", "class", ")", ",", "eq", "(", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "public", "PersistentDummyJob", "(", ")", "{", "super", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "}", "</s>"]
["<s>", "protected", "PublicJob", "(", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "super", ".", "shouldReRunOnThrowable", "(", "throwable", ",", "runCount", ",", "maxRunCount", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getCurrentRunCount", "(", ")", "{", "return", "super", ".", "getCurrentRunCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRetryLimit", "(", ")", "{", "return", "super", ".", "getRetryLimit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "}", "</s>"]
["<s>", "public", "AddInBackgroundTest", "(", "boolean", "delay", ",", "boolean", "useCallback", ")", "{", "this", ".", "delayed", "=", "delay", ";", "this", ".", "useCallback", "=", "useCallback", ";", "}", "</s>"]
["<s>", "@", "ParameterizedRobolectricTestRunner", ".", "Parameters", "(", "name", "=", "\"", "<STR_LIT>", "\"", ")", "public", "static", "List", "<", "Object", "[", "]", ">", "getParameters", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "new", "Object", "[", "]", "{", "false", ",", "false", "}", ",", "new", "Object", "[", "]", "{", "false", ",", "true", "}", ",", "new", "Object", "[", "]", "{", "true", ",", "false", "}", ",", "new", "Object", "[", "]", "{", "true", ",", "true", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "addInBackground", "(", ")", "throws", "Throwable", "{", "long", "currentThreadId", "=", "Thread", ".", "currentThread", "(", ")", ".", "getId", "(", ")", ";", "final", "AtomicLong", "onAddedThreadId", "=", "new", "AtomicLong", "(", ")", ";", "final", "CountDownLatch", "addedLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "final", "Job", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "setDelayMs", "(", "delayed", "?", "<NUM_LIT:1000>", ":", "0", ")", ")", "{", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "onAddedThreadId", ".", "set", "(", "Thread", ".", "currentThread", "(", ")", ".", "getId", "(", ")", ")", ";", "addedLatch", ".", "countDown", "(", ")", ";", "}", "}", ";", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "if", "(", "useCallback", ")", "{", "jobManager", ".", "addJobInBackground", "(", "dummyJob", ",", "new", "AsyncAddCallback", "(", ")", "{", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "addedLatch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "}", "else", "{", "addedLatch", ".", "countDown", "(", ")", ";", "jobManager", ".", "addJobInBackground", "(", "dummyJob", ")", ";", "}", "addedLatch", ".", "await", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "delayed", ",", "currentThreadId", ",", "CoreMatchers", ".", "not", "(", "onAddedThreadId", ".", "get", "(", ")", ")", ")", ";", "if", "(", "useCallback", ")", "{", "JobHolder", "holder", "=", "new", "JobManagerThreadRunnable", "<", "JobHolder", ">", "(", "jobManager", ")", "{", "@", "Override", "public", "JobHolder", "onRun", "(", ")", "{", "return", "findJobFromQueues", "(", "dummyJob", ".", "getId", "(", ")", ")", ";", "}", "}", ".", "run", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "dummyJob", ".", "getId", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "delayed", ",", "holder", ",", "CoreMatchers", ".", "notNullValue", "(", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "holder", ".", "getJob", "(", ")", ",", "CoreMatchers", ".", "is", "(", "dummyJob", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "onAddedThreadId", ".", "set", "(", "Thread", ".", "currentThread", "(", ")", ".", "getId", "(", ")", ")", ";", "addedLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "addedLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "onRun", "(", ")", "{", "return", "findJobFromQueues", "(", "dummyJob", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnyAsyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnySyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllAsyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllSyncWithoutNetwork", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testCancelWithoutNetwork", "(", "boolean", "async", ",", "TagConstraint", "constraint", ")", "throws", "InterruptedException", "{", "DummyNetworkUtilWithConnectivityEventSupport", "networkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "networkUtil", "(", "networkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "final", "CancelResult", "[", "]", "result", "=", "new", "CancelResult", "[", "1", "]", ";", "if", "(", "async", ")", "{", "final", "CountDownLatch", "cancelLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "}", ",", "constraint", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cancelLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "else", "{", "result", "[", "0", "]", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "final", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "runLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnyAsyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAnySyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ANY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllAsyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "true", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelAllSyncWithoutNetworAndPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancelWithoutNetwork", "(", "false", ",", "TagConstraint", ".", "ALL", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testCancelWithoutNetworkPersistent", "(", "boolean", "async", ",", "TagConstraint", "constraint", ")", "throws", "InterruptedException", "{", "DummyNetworkUtilWithConnectivityEventSupport", "networkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "networkUtil", "(", "networkUtil", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "persist", "(", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "persist", "(", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "final", "CancelResult", "[", "]", "result", "=", "new", "CancelResult", "[", "1", "]", ";", "if", "(", "async", ")", "{", "final", "CountDownLatch", "cancelLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "}", ",", "constraint", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cancelLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "else", "{", "result", "[", "0", "]", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", "[", "0", "]", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "final", "CountDownLatch", "runLatch", "=", "persistentLatches", "[", "latchCounter", "+", "+", "]", ";", "jobManager", ".", "addJob", "(", "new", "PersistentDummyJob", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "persist", "(", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ",", "latchCounter", "-", "1", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "PersistentDummyJob", "(", "Params", "params", ",", "int", "latch", ")", "{", "super", "(", "params", ".", "persist", "(", ")", ")", ";", "this", ".", "latch", "=", "latch", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "persistentLatches", "[", "latch", "]", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "@", "Test", "public", "void", "testJobStatus", "(", ")", "throws", "InterruptedException", "{", "DummyNetworkUtilWithConnectivityEventSupport", "networkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "networkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "List", "<", "Integer", ">", "networkRequiringJobIndices", "=", "new", "ArrayList", "<", "Integer", ">", "(", ")", ";", "Job", "[", "]", "jobs", "=", "new", "Job", "[", "]", "{", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ".", "requireNetwork", "(", ")", ".", "addTags", "(", "REQ_NETWORK_TAG", ")", ")", "}", ";", "String", "[", "]", "ids", "=", "new", "String", "[", "jobs", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "jobs", ".", "length", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "jobs", "[", "i", "]", ")", ";", "ids", "[", "i", "]", "=", "jobs", "[", "i", "]", ".", "getId", "(", ")", ";", "if", "(", "jobs", "[", "i", "]", ".", "requiresNetwork", "(", "mockTimer", ")", ")", "{", "networkRequiringJobIndices", ".", "add", "(", "i", ")", ";", "}", "JobStatus", "expectedStatus", "=", "(", "!", "networkUtil", ".", "isDisconnected", "(", ")", "|", "|", "!", "jobs", "[", "i", "]", ".", "requiresNetwork", "(", "mockTimer", ")", ")", "?", "JobStatus", ".", "WAITING_READY", ":", "JobStatus", ".", "WAITING_NOT_READY", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "ids", "[", "i", "]", ")", ",", "is", "(", "expectedStatus", ")", ")", ";", "}", "boolean", "exists", ";", "String", "unknownId", ";", "do", "{", "unknownId", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "exists", "=", "false", ";", "for", "(", "String", "id", ":", "ids", ")", "{", "if", "(", "unknownId", ".", "equals", "(", "id", ")", ")", "{", "exists", "=", "true", ";", "}", "}", "}", "while", "(", "exists", ")", ";", "for", "(", "boolean", "persistent", ":", "new", "boolean", "[", "]", "{", "true", ",", "false", "}", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "unknownId", ")", ",", "is", "(", "JobStatus", ".", "UNKNOWN", ")", ")", ";", "}", "final", "CountDownLatch", "startLatch", "=", "new", "CountDownLatch", "(", "1", ")", ",", "endLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "DummyTwoLatchJob", "twoLatchJob", "=", "new", "DummyTwoLatchJob", "(", "new", "Params", "(", "0", ")", ",", "startLatch", ",", "endLatch", ")", ";", "jobManager", ".", "start", "(", ")", ";", "jobManager", ".", "addJob", "(", "twoLatchJob", ")", ";", "final", "String", "jobId", "=", "twoLatchJob", ".", "getId", "(", ")", ";", "twoLatchJob", ".", "waitTillOnRun", "(", ")", ";", "final", "CountDownLatch", "twoLatchJobDone", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "job", "=", "=", "twoLatchJob", "&", "&", "resultCode", "=", "=", "RESULT_SUCCEED", ")", "{", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "twoLatchJobDone", ".", "countDown", "(", ")", ";", "}", "}", "}", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "jobId", ")", ",", "is", "(", "JobStatus", ".", "RUNNING", ")", ")", ";", "startLatch", ".", "countDown", "(", ")", ";", "try", "{", "endLatch", ".", "await", "(", ")", ";", "}", "catch", "(", "InterruptedException", "ignored", ")", "{", "}", "twoLatchJobDone", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "jobId", ",", "jobManager", ".", "getJobStatus", "(", "jobId", ")", ",", "is", "(", "JobStatus", ".", "UNKNOWN", ")", ")", ";", "for", "(", "Integer", "i", ":", "networkRequiringJobIndices", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "ids", "[", "i", "]", ")", ",", "is", "(", "JobStatus", ".", "WAITING_NOT_READY", ")", ")", ";", "}", "jobManager", ".", "stop", "(", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "for", "(", "Integer", "i", ":", "networkRequiringJobIndices", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "ids", "[", "i", "]", ")", ",", "is", "(", "JobStatus", ".", "WAITING_READY", ")", ")", ";", "}", "final", "CountDownLatch", "networkRequiredLatch", "=", "new", "CountDownLatch", "(", "networkRequiringJobIndices", ".", "size", "(", ")", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "if", "(", "job", ".", "getTags", "(", ")", ".", "contains", "(", "REQ_NETWORK_TAG", ")", ")", "{", "networkRequiredLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", ")", ";", "jobManager", ".", "start", "(", ")", ";", "networkRequiredLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "is", "(", "0", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "jobs", ".", "length", ";", "i", "+", "+", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "ids", "[", "i", "]", ")", ",", "is", "(", "JobStatus", ".", "UNKNOWN", ")", ")", ";", "}", "final", "long", "SHORT_SLEEP", "=", "<NUM_LIT>", ";", "Job", "[", "]", "delayedJobs", "=", "new", "Job", "[", "]", "{", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "delayInMs", "(", "SHORT_SLEEP", ")", ")", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "delayInMs", "(", "SHORT_SLEEP", ")", ".", "persist", "(", ")", ")", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "delayInMs", "(", "SHORT_SLEEP", "*", "<NUM_LIT:10>", ")", ")", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "delayInMs", "(", "SHORT_SLEEP", "*", "<NUM_LIT:10>", ")", ".", "persist", "(", ")", ")", "}", ";", "String", "[", "]", "delayedIds", "=", "new", "String", "[", "delayedJobs", ".", "length", "]", ";", "long", "start", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "delayedJobs", ".", "length", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "delayedJobs", "[", "i", "]", ")", ";", "delayedIds", "[", "i", "]", "=", "delayedJobs", "[", "i", "]", ".", "getId", "(", ")", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "delayedJobs", ".", "length", ";", "i", "+", "+", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "i", "+", "\"", "<STR_LIT>", "\"", "+", "start", ",", "jobManager", ".", "getJobStatus", "(", "delayedIds", "[", "i", "]", ")", ",", "is", "(", "JobStatus", ".", "WAITING_NOT_READY", ")", ")", ";", "}", "jobManager", ".", "stop", "(", ")", ";", "mockTimer", ".", "incrementMs", "(", "SHORT_SLEEP", "*", "<NUM_LIT:2>", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "delayedJobs", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "delayedJobs", "[", "i", "]", ".", "getDelayInMs", "(", ")", "=", "=", "SHORT_SLEEP", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "delayedIds", "[", "i", "]", ")", ",", "is", "(", "JobStatus", ".", "WAITING_READY", ")", ")", ";", "}", "else", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getJobStatus", "(", "delayedIds", "[", "i", "]", ")", ",", "is", "(", "JobStatus", ".", "WAITING_NOT_READY", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "job", "=", "=", "twoLatchJob", "&", "&", "resultCode", "=", "=", "RESULT_SUCCEED", ")", "{", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "twoLatchJobDone", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "if", "(", "job", ".", "getTags", "(", ")", ".", "contains", "(", "REQ_NETWORK_TAG", ")", ")", "{", "networkRequiredLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "clear", "(", ")", "{", "retryProvider", "=", "null", ";", "canRun", "=", "false", ";", "runCount", "=", "0", ";", "onRunLatch", "=", "null", ";", "onRunCallback", "=", "null", ";", "onCancelCallback", "=", "null", ";", "cancelLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "dummyJobRunLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testExponential", "(", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "RetryConstraint", ".", "createExponentialBackoff", "(", "1", ",", "<NUM_LIT:10>", ")", ".", "getNewDelayInMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "RetryConstraint", ".", "createExponentialBackoff", "(", "<NUM_LIT:2>", ",", "<NUM_LIT:10>", ")", ".", "getNewDelayInMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "RetryConstraint", ".", "createExponentialBackoff", "(", "<NUM_LIT:3>", ",", "<NUM_LIT:10>", ")", ".", "getNewDelayInMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "RetryConstraint", ".", "createExponentialBackoff", "(", "1", ",", "<NUM_LIT:5>", ")", ".", "getNewDelayInMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "RetryConstraint", ".", "createExponentialBackoff", "(", "<NUM_LIT:2>", ",", "<NUM_LIT:5>", ")", ".", "getNewDelayInMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "RetryConstraint", ".", "createExponentialBackoff", "(", "<NUM_LIT:3>", ",", "<NUM_LIT:5>", ")", ".", "getNewDelayInMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRunCountPersistent", "(", ")", "throws", "InterruptedException", "{", "testFirstRunCount", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRunCountNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testFirstRunCount", "(", "false", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testFirstRunCount", "(", "boolean", "persistent", ")", "throws", "InterruptedException", "{", "final", "AtomicInteger", "runCnt", "=", "new", "AtomicInteger", "(", "0", ")", ";", "onRunCallback", "=", "new", "Callback", "(", ")", "{", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "(", "RetryJob", ")", "job", ")", ".", "getCurrentRunCount", "(", ")", ",", "is", "(", "runCnt", ".", "incrementAndGet", "(", ")", ")", ")", ";", "}", "}", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "RetryConstraint", ".", "RETRY", ";", "}", "}", ";", "canRun", "=", "true", ";", "RetryJob", "job", "=", "new", "RetryJob", "(", "new", "Params", "(", "0", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "job", ".", "retryLimit", "=", "<NUM_LIT:10>", ";", "createJobManager", "(", ")", ".", "addJob", "(", "job", ")", ";", "assertThat", "(", "\"", "\"", ",", "cancelLatch", ".", "await", "(", "<NUM_LIT:4>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "\"", ",", "runCount", ",", "is", "(", "<NUM_LIT:10>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "(", "RetryJob", ")", "job", ")", ".", "getCurrentRunCount", "(", ")", ",", "is", "(", "runCnt", ".", "incrementAndGet", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "RetryConstraint", ".", "RETRY", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangeDelayOfTheGroup", "(", ")", "throws", "InterruptedException", "{", "testChangeDelayOfTheGroup", "(", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangeDelayOfTheGroupPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangeDelayOfTheGroup", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangeDelayOfTheGroupNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangeDelayOfTheGroup", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "public", "void", "testChangeDelayOfTheGroup", "(", "Boolean", "persistent", ")", "throws", "InterruptedException", "{", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "canRun", "=", "true", ";", "final", "RetryJob", "job1", "=", "new", "RetryJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "setPersistent", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "persistent", ")", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "job1", ".", "identifier", "=", "\"", "<STR_LIT>", "\"", ";", "RetryJob", "job2", "=", "new", "RetryJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "setPersistent", "(", "!", "Boolean", ".", "FALSE", ".", "equals", "(", "persistent", ")", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "job2", ".", "identifier", "=", "\"", "<STR_LIT>", "\"", ";", "job1", ".", "retryLimit", "=", "<NUM_LIT:2>", ";", "job2", ".", "retryLimit", "=", "<NUM_LIT:2>", ";", "final", "String", "job1Id", "=", "job1", ".", "identifier", ";", "final", "String", "job2Id", "=", "job2", ".", "identifier", ";", "final", "PersistableDummyJob", "postTestJob", "=", "new", "PersistableDummyJob", "(", "new", "Params", "(", "1", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ".", "setPersistent", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "persistent", ")", ")", ")", ";", "final", "Semaphore", "jobsCanRun", "=", "new", "Semaphore", "(", "<NUM_LIT:4>", ")", ";", "jobsCanRun", ".", "acquire", "(", "<NUM_LIT:3>", ")", ";", "final", "Job", "[", "]", "unexpectedRun", "=", "new", "Job", "[", "1", "]", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "constraint", ".", "setNewDelayInMs", "(", "<NUM_LIT>", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ",", "mockTimer", ".", "nanoTime", "(", ")", ",", "(", "(", "RetryJob", ")", "job", ")", ".", "identifier", ")", ";", "constraint", ".", "setApplyNewDelayToGroup", "(", "true", ")", ";", "return", "constraint", ";", "}", "}", ";", "final", "List", "<", "Pair", "<", "String", ",", "Long", ">", ">", "runTimes", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "final", "Map", "<", "String", ",", "Long", ">", "cancelTimes", "=", "new", "HashMap", "<", ">", "(", ")", ";", "final", "Throwable", "[", "]", "lastJobRunOrder", "=", "new", "Throwable", "[", "1", "]", ";", "onRunCallback", "=", "new", "Callback", "(", ")", "{", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "!", "jobsCanRun", ".", "tryAcquire", "(", ")", "&", "&", "unexpectedRun", "[", "0", "]", "=", "=", "null", ")", "{", "unexpectedRun", "[", "0", "]", "=", "job", ";", "}", "runTimes", ".", "add", "(", "new", "Pair", "<", ">", "(", "retryJob", ".", "identifier", ",", "mockTimer", ".", "nanoTime", "(", ")", ")", ")", ";", "}", "}", ";", "onCancelCallback", "=", "new", "Callback", "(", ")", "{", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "job", ")", ";", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelTimes", ".", "containsKey", "(", "retryJob", ".", "identifier", ")", ",", "is", "(", "false", ")", ")", ";", "cancelTimes", ".", "put", "(", "retryJob", ".", "identifier", ",", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "if", "(", "!", "job", ".", "isPersistent", "(", ")", "|", "|", "postTestJob", ".", "isPersistent", "(", ")", ")", "{", "if", "(", "dummyJobRunLatch", ".", "getCount", "(", ")", "!", "=", "1", ")", "{", "lastJobRunOrder", "[", "0", "]", "=", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", "}", ";", "cancelLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "final", "CountDownLatch", "jobRunLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:5>", ")", ";", "final", "Throwable", "[", "]", "afterJobError", "=", "new", "Throwable", "[", "1", "]", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "synchronized", "(", "this", ")", "{", "try", "{", "if", "(", "job", "instanceof", "RetryJob", ")", "{", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "retryJob", ".", "identifier", ".", "equals", "(", "job1Id", ")", "&", "&", "retryJob", ".", "getCurrentRunCount", "(", ")", "=", "=", "retryJob", ".", "getRetryLimit", "(", ")", ")", "{", "jobsCanRun", ".", "release", "(", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "afterJobError", "[", "0", "]", "=", "t", ";", "}", "}", "}", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "synchronized", "(", "this", ")", "{", "try", "{", "if", "(", "job", "instanceof", "RetryJob", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "jobRunLatch", ".", "getCount", "(", ")", ",", "unexpectedRun", "[", "0", "]", ",", "nullValue", "(", ")", ")", ";", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "retryJob", ".", "getCurrentRunCount", "(", ")", "=", "=", "<NUM_LIT:2>", ")", "{", "}", "else", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "countReadyJobs", "(", ")", ",", "is", "(", "0", ")", ")", ";", "jobsCanRun", ".", "release", "(", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "afterJobError", "[", "0", "]", "=", "t", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "}", "finally", "{", "jobRunLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", "}", ")", ";", "jobManager", ".", "addJob", "(", "job1", ")", ";", "jobManager", ".", "addJob", "(", "job2", ")", ";", "jobManager", ".", "addJob", "(", "postTestJob", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobRunLatch", ".", "await", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "afterJobError", "[", "0", "]", ",", "nullValue", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "MILLISECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runTimes", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:4>", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:4>", ";", "i", "+", "+", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "i", ",", "runTimes", ".", "get", "(", "i", ")", ".", "first", ",", "is", "(", "i", "<", "<NUM_LIT:2>", "?", "job1Id", ":", "job2Id", ")", ")", ";", "}", "long", "timeInBetween", "=", "TimeUnit", ".", "NANOSECONDS", ".", "toSeconds", "(", "runTimes", ".", "get", "(", "1", ")", ".", "second", "-", "runTimes", ".", "get", "(", "0", ")", ".", "second", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT::>", "\"", "+", "timeInBetween", ",", "<NUM_LIT:2>", "<", "=", "timeInBetween", ",", "is", "(", "true", ")", ")", ";", "timeInBetween", "=", "TimeUnit", ".", "NANOSECONDS", ".", "toSeconds", "(", "runTimes", ".", "get", "(", "<NUM_LIT:3>", ")", ".", "second", "-", "runTimes", ".", "get", "(", "<NUM_LIT:2>", ")", ".", "second", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT::>", "\"", "+", "timeInBetween", ",", "<NUM_LIT:2>", "<", "=", "timeInBetween", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "dummyJobRunLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "dummyJobRunLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "addJob", "(", "new", "PersistableDummyJob", "(", "new", "Params", "(", "1", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "dummyJobRunLatch", ".", "await", "(", "<NUM_LIT>", ",", "TimeUnit", ".", "MILLISECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "lastJobRunOrder", "[", "0", "]", ",", "nullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "constraint", ".", "setNewDelayInMs", "(", "<NUM_LIT>", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ",", "mockTimer", ".", "nanoTime", "(", ")", ",", "(", "(", "RetryJob", ")", "job", ")", ".", "identifier", ")", ";", "constraint", ".", "setApplyNewDelayToGroup", "(", "true", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "!", "jobsCanRun", ".", "tryAcquire", "(", ")", "&", "&", "unexpectedRun", "[", "0", "]", "=", "=", "null", ")", "{", "unexpectedRun", "[", "0", "]", "=", "job", ";", "}", "runTimes", ".", "add", "(", "new", "Pair", "<", ">", "(", "retryJob", ".", "identifier", ",", "mockTimer", ".", "nanoTime", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "job", ")", ";", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelTimes", ".", "containsKey", "(", "retryJob", ".", "identifier", ")", ",", "is", "(", "false", ")", ")", ";", "cancelTimes", ".", "put", "(", "retryJob", ".", "identifier", ",", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "if", "(", "!", "job", ".", "isPersistent", "(", ")", "|", "|", "postTestJob", ".", "isPersistent", "(", ")", ")", "{", "if", "(", "dummyJobRunLatch", ".", "getCount", "(", ")", "!", "=", "1", ")", "{", "lastJobRunOrder", "[", "0", "]", "=", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "synchronized", "(", "this", ")", "{", "try", "{", "if", "(", "job", "instanceof", "RetryJob", ")", "{", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "retryJob", ".", "identifier", ".", "equals", "(", "job1Id", ")", "&", "&", "retryJob", ".", "getCurrentRunCount", "(", ")", "=", "=", "retryJob", ".", "getRetryLimit", "(", ")", ")", "{", "jobsCanRun", ".", "release", "(", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "afterJobError", "[", "0", "]", "=", "t", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "synchronized", "(", "this", ")", "{", "try", "{", "if", "(", "job", "instanceof", "RetryJob", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "jobRunLatch", ".", "getCount", "(", ")", ",", "unexpectedRun", "[", "0", "]", ",", "nullValue", "(", ")", ")", ";", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "retryJob", ".", "getCurrentRunCount", "(", ")", "=", "=", "<NUM_LIT:2>", ")", "{", "}", "else", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "countReadyJobs", "(", ")", ",", "is", "(", "0", ")", ")", ";", "jobsCanRun", ".", "release", "(", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "afterJobError", "[", "0", "]", "=", "t", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "jobRunLatch", ".", "countDown", "(", ")", ";", "}", "finally", "{", "jobRunLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangeDelayPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangeDelay", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangeDelayNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangeDelay", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "public", "void", "testChangeDelay", "(", "boolean", "persistent", ")", "throws", "InterruptedException", "{", "canRun", "=", "true", ";", "RetryJob", "job", "=", "new", "RetryJob", "(", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "job", ".", "retryLimit", "=", "<NUM_LIT:2>", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "constraint", ".", "setNewDelayInMs", "(", "<NUM_LIT>", ")", ";", "return", "constraint", ";", "}", "}", ";", "final", "List", "<", "Long", ">", "runTimes", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "onRunCallback", "=", "new", "Callback", "(", ")", "{", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "runTimes", ".", "add", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "}", ";", "final", "Throwable", "[", "]", "callbackError", "=", "new", "Throwable", "[", "1", "]", ";", "final", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "try", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "countReadyJobs", "(", ")", ",", "is", "(", "0", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "callbackError", "[", "0", "]", "=", "t", ";", "}", "finally", "{", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", "}", ")", ";", "jobManager", ".", "addJob", "(", "job", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:100>", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "callbackError", "[", "0", "]", ",", "nullValue", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runCount", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "long", "timeInBetween", "=", "TimeUnit", ".", "NANOSECONDS", ".", "toSeconds", "(", "runTimes", ".", "get", "(", "1", ")", "-", "runTimes", ".", "get", "(", "0", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "timeInBetween", ",", "<NUM_LIT:2>", "<", "=", "timeInBetween", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "constraint", ".", "setNewDelayInMs", "(", "<NUM_LIT>", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "runTimes", ".", "add", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "try", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "countReadyJobs", "(", ")", ",", "is", "(", "0", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "callbackError", "[", "0", "]", "=", "t", ";", "}", "finally", "{", "runLatch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangePriorityAndObserveExecutionOrderPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangePriorityAndObserveExecutionOrder", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangePriorityAndObserveExecutionOrderNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangePriorityAndObserveExecutionOrder", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "public", "void", "testChangePriorityAndObserveExecutionOrder", "(", "boolean", "persistent", ")", "throws", "InterruptedException", "{", "cancelLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "RetryJob", "job1", "=", "new", "RetryJob", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ".", "setPersistent", "(", "persistent", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "job1", ".", "identifier", "=", "\"", "<STR_LIT:1>", "\"", ";", "RetryJob", "job2", "=", "new", "RetryJob", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ".", "setPersistent", "(", "persistent", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "job2", ".", "identifier", "=", "\"", "<STR_LIT:2>", "\"", ";", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "jobManager", ".", "addJob", "(", "job1", ")", ";", "jobManager", ".", "addJob", "(", "job2", ")", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "\"", "<STR_LIT:1>", "\"", ".", "equals", "(", "retryJob", ".", "identifier", ")", ")", "{", "if", "(", "retryJob", ".", "getPriority", "(", ")", "=", "=", "1", ")", "{", "return", "RetryConstraint", ".", "CANCEL", ";", "}", "RetryConstraint", "retryConstraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "retryConstraint", ".", "setNewPriority", "(", "1", ")", ";", "return", "retryConstraint", ";", "}", "else", "{", "return", "RetryConstraint", ".", "CANCEL", ";", "}", "}", "}", ";", "final", "List", "<", "String", ">", "runOrder", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "onRunCallback", "=", "new", "Callback", "(", ")", "{", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "runOrder", ".", "add", "(", "(", "(", "RetryJob", ")", "job", ")", ".", "identifier", ")", ";", "}", "}", ";", "canRun", "=", "true", ";", "jobManager", ".", "start", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runCount", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "final", "List", "<", "String", ">", "expectedRunOrder", "=", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runOrder", ".", "size", "(", ")", ",", "is", "(", "expectedRunOrder", ".", "size", "(", ")", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "expectedRunOrder", ".", "size", "(", ")", ";", "i", "+", "+", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "i", "+", "\"", "<STR_LIT>", "\"", ",", "runOrder", ".", "get", "(", "i", ")", ",", "is", "(", "expectedRunOrder", ".", "get", "(", "i", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryJob", "retryJob", "=", "(", "RetryJob", ")", "job", ";", "if", "(", "\"", "<STR_LIT:1>", "\"", ".", "equals", "(", "retryJob", ".", "identifier", ")", ")", "{", "if", "(", "retryJob", ".", "getPriority", "(", ")", "=", "=", "1", ")", "{", "return", "RetryConstraint", ".", "CANCEL", ";", "}", "RetryConstraint", "retryConstraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "retryConstraint", ".", "setNewPriority", "(", "1", ")", ";", "return", "retryConstraint", ";", "}", "else", "{", "return", "RetryConstraint", ".", "CANCEL", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "runOrder", ".", "add", "(", "(", "(", "RetryJob", ")", "job", ")", ".", "identifier", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangePriorityPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangePriority", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testChangePriorityNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testChangePriority", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Ignore", "public", "void", "testChangePriority", "(", "boolean", "persistent", ")", "throws", "InterruptedException", "{", "final", "AtomicInteger", "priority", "=", "new", "AtomicInteger", "(", "1", ")", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "priority", ".", "set", "(", "job", ".", "getPriority", "(", ")", "*", "<NUM_LIT:2>", ")", ";", "constraint", ".", "setNewPriority", "(", "priority", ".", "get", "(", ")", ")", ";", "return", "constraint", ";", "}", "}", ";", "onRunCallback", "=", "new", "Callback", "(", ")", "{", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getPriority", "(", ")", ",", "is", "(", "priority", ".", "get", "(", ")", ")", ")", ";", "}", "}", ";", "RetryJob", "retryJob", "=", "new", "RetryJob", "(", "new", "Params", "(", "priority", ".", "get", "(", ")", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "retryJob", ".", "retryLimit", "=", "<NUM_LIT:3>", ";", "canRun", "=", "true", ";", "onRunLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:3>", ")", ";", "createJobManager", "(", ")", ".", "addJob", "(", "retryJob", ")", ";", "assertThat", "(", "onRunLatch", ".", "await", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runCount", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "cancelLatch", ".", "await", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "priority", ".", "set", "(", "job", ".", "getPriority", "(", ")", "*", "<NUM_LIT:2>", ")", ";", "constraint", ".", "setNewPriority", "(", "priority", ".", "get", "(", ")", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "on", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getPriority", "(", ")", ",", "is", "(", "priority", ".", "get", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancel", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testCancel", "(", "false", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testCancel", "(", "boolean", "persistent", ")", "throws", "InterruptedException", "{", "canRun", "=", "true", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "RetryConstraint", ".", "CANCEL", ";", "}", "}", ";", "RetryJob", "job", "=", "new", "RetryJob", "(", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "job", ".", "retryLimit", "=", "<NUM_LIT:3>", ";", "onRunLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:3>", ")", ";", "createJobManager", "(", ")", ".", "addJob", "(", "job", ")", ";", "assertThat", "(", "onRunLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "false", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runCount", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "cancelLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "RetryConstraint", ".", "CANCEL", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "retryPersistent", "(", ")", "throws", "InterruptedException", "{", "testRetry", "(", "true", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "retryNonPersistent", "(", ")", "throws", "InterruptedException", "{", "testRetry", "(", "false", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "retryPersistentWithNull", "(", ")", "throws", "InterruptedException", "{", "testRetry", "(", "true", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "retryNonPersistentWithNull", "(", ")", "throws", "InterruptedException", "{", "testRetry", "(", "false", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testRetry", "(", "boolean", "persistent", ",", "final", "boolean", "returnTrue", ")", "throws", "InterruptedException", "{", "canRun", "=", "true", ";", "retryProvider", "=", "new", "RetryProvider", "(", ")", "{", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "returnTrue", "?", "RetryConstraint", ".", "RETRY", ":", "null", ";", "}", "}", ";", "RetryJob", "job", "=", "new", "RetryJob", "(", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "job", ".", "retryLimit", "=", "<NUM_LIT:3>", ";", "onRunLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:3>", ")", ";", "createJobManager", "(", ")", ".", "addJob", "(", "job", ")", ";", "assertThat", "(", "onRunLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runCount", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "cancelLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "return", "returnTrue", "?", "RetryConstraint", ".", "RETRY", ":", "null", ";", "}", "</s>"]
["<s>", "protected", "RetryJob", "(", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "canRun", ",", "is", "(", "true", ")", ")", ";", "if", "(", "onRunCallback", "!", "=", "null", ")", "{", "onRunCallback", ".", "on", "(", "this", ")", ";", "}", "runCount", "+", "+", ";", "if", "(", "onRunLatch", "!", "=", "null", ")", "{", "onRunLatch", ".", "countDown", "(", ")", ";", "}", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "identifier", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "identifier", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "int", "getRetryLimit", "(", ")", "{", "return", "retryLimit", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "if", "(", "onCancelCallback", "!", "=", "null", ")", "{", "onCancelCallback", ".", "on", "(", "this", ")", ";", "}", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "RetryConstraint", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "if", "(", "retryProvider", "!", "=", "null", ")", "{", "return", "retryProvider", ".", "build", "(", "this", ",", "throwable", ",", "runCount", ",", "maxRunCount", ")", ";", "}", "return", "RetryConstraint", ".", "createExponentialBackoff", "(", "runCount", ",", "<NUM_LIT:1000>", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getCurrentRunCount", "(", ")", "{", "return", "super", ".", "getCurrentRunCount", "(", ")", ";", "}", "</s>"]
["<s>", "public", "PersistableDummyJob", "(", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "dummyJobRunLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "RetryConstraint", "build", "(", "Job", "job", ",", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", ";", "</s>"]
["<s>", "public", "void", "on", "(", "Job", "job", ")", ";", "</s>"]
["<s>", "@", "Test", "public", "void", "testNetworkNextJob", "(", ")", "throws", "Throwable", "{", "DummyNetworkUtil", "dummyNetworkUtil", "=", "new", "DummyNetworkUtil", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "dummyNetworkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "DummyJob", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ")", ";", "jobManager", ".", "addJob", "(", "dummyJob", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "nextJob", "(", "jobManager", ")", ",", "nullValue", "(", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "JobHolder", "retrieved", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ",", "notNullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReRunWithLimit", "(", ")", "throws", "Exception", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "testReRun", "(", "jobManager", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReRunWithLimitPersist", "(", ")", "throws", "Exception", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "testReRun", "(", "jobManager", ",", "true", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testReRun", "(", "final", "JobManager", "jobManager", ",", "boolean", "persist", ")", "throws", "InterruptedException", "{", "DummyJobWithRunCount", ".", "runCount", "=", "0", ";", "final", "DummyJobWithRunCount", "job", "=", "new", "DummyJobWithRunCount", "(", "persist", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "DummyJobWithRunCount", ".", "runCount", ",", "equalTo", "(", "job", ".", "getRetryLimit", "(", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "runManyNonPersistentJobs", "(", ")", "throws", "Exception", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "int", "limit", "=", "<NUM_LIT:2>", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "limit", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "limit", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "new", "DummyLatchJob", "(", "new", "Params", "(", "i", ")", ",", "latch", ")", ")", ";", "}", "jobManager", ".", "start", "(", ")", ";", "latch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "latch", ".", "getCount", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "int", "getActiveConsumerCount", "(", "JobManager", "jobManager", ")", "{", "return", "jobManager", ".", "getActiveConsumerCount", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "long", "getTimeout", "(", ")", "{", "return", "<NUM_LIT>", ";", "}", "</s>"]
["<s>", "protected", "JobManager", "createJobManager", "(", ")", "{", "if", "(", "createdJobManagers", ".", "size", "(", ")", ">", "0", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "timer", "(", "mockTimer", ")", ".", "inTestMode", "(", ")", ")", ";", "createdJobManagers", ".", "add", "(", "jobManager", ")", ";", "return", "jobManager", ";", "}", "</s>"]
["<s>", "protected", "JobManager", "createJobManager", "(", "Configuration", ".", "Builder", "configurationBuilder", ")", "{", "if", "(", "createdJobManagers", ".", "size", "(", ")", ">", "0", ")", "{", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Configuration", "config", "=", "configurationBuilder", ".", "inTestMode", "(", ")", ".", "id", "(", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ")", ".", "build", "(", ")", ";", "if", "(", "config", ".", "getTimer", "(", ")", "!", "=", "mockTimer", "&", "&", "!", "canUseRealTimer", "(", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "JobManager", "jobManager", "=", "new", "JobManager", "(", "RuntimeEnvironment", ".", "application", ",", "config", ")", ";", "createdJobManagers", ".", "add", "(", "jobManager", ")", ";", "return", "jobManager", ";", "}", "</s>"]
["<s>", "public", "List", "<", "JobManager", ">", "getCreatedJobManagers", "(", ")", "{", "return", "createdJobManagers", ";", "}", "</s>"]
["<s>", "public", "MockTimer", "getMockTimer", "(", ")", "{", "return", "mockTimer", ";", "}", "</s>"]
["<s>", "protected", "DummyTwoLatchJob", "(", "Params", "params", ",", "CountDownLatch", "waitFor", ",", "CountDownLatch", "trigger", ")", "{", "super", "(", "params", ")", ";", "this", ".", "waitFor", "=", "waitFor", ";", "this", ".", "trigger", "=", "trigger", ";", "onRunLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "}", "</s>"]
["<s>", "public", "void", "waitTillOnRun", "(", ")", "throws", "InterruptedException", "{", "onRunLatch", ".", "await", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "onRunLatch", ".", "countDown", "(", ")", ";", "waitFor", ".", "await", "(", ")", ";", "super", ".", "onRun", "(", ")", ";", "trigger", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "nextJob", "(", "JobManager", "jobManager", ")", "throws", "Throwable", "{", "return", "new", "JobManagerThreadRunnable", "<", "JobHolder", ">", "(", "jobManager", ")", "{", "@", "Override", "public", "JobHolder", "onRun", "(", ")", "{", "return", "getNextJob", "(", ")", ";", "}", "}", ".", "run", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "onRun", "(", ")", "{", "return", "getNextJob", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "nextJob", "(", "JobManager", "jobManager", ",", "final", "Collection", "<", "String", ">", "exclude", ")", "throws", "Throwable", "{", "return", "new", "JobManagerThreadRunnable", "<", "JobHolder", ">", "(", "jobManager", ")", "{", "@", "Override", "public", "JobHolder", "onRun", "(", ")", "{", "return", "getNextJob", "(", "exclude", ")", ";", "}", "}", ".", "run", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "onRun", "(", ")", "{", "return", "getNextJob", "(", "exclude", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "removeJob", "(", "final", "JobManager", "jobManager", ",", "final", "JobHolder", "holder", ")", "throws", "Throwable", "{", "new", "JobManagerThreadRunnable", "<", "Void", ">", "(", "jobManager", ")", "{", "@", "Override", "public", "Void", "onRun", "(", ")", "{", "removeJob", "(", "holder", ")", ";", "return", "null", ";", "}", "}", ".", "run", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "onRun", "(", ")", "{", "removeJob", "(", "holder", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "protected", "DummyLatchJob", "(", "Params", "params", ",", "CountDownLatch", "latch", ")", "{", "super", "(", "params", ")", ";", "this", ".", "latch", "=", "latch", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "latch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "DummyJobWithRunCount", "(", "boolean", "persistent", ")", "{", "super", "(", "new", "Params", "(", "0", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "runCount", "+", "+", ";", "super", ".", "onRun", "(", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "runCount", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "int", "getRetryLimit", "(", ")", "{", "return", "<NUM_LIT:5>", ";", "}", "</s>"]
["<s>", "protected", "void", "setNetworkStatus", "(", "@", "NetworkStatus", "int", "networkStatus", ")", "{", "this", ".", "networkStatus", "=", "networkStatus", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNetworkStatus", "(", "Context", "context", ")", "{", "return", "networkStatus", ";", "}", "</s>"]
["<s>", "protected", "void", "setNetworkStatus", "(", "@", "NetworkStatus", "int", "networkStatus", ",", "boolean", "notifyListener", ")", "{", "this", ".", "networkStatus", "=", "networkStatus", ";", "if", "(", "notifyListener", "&", "&", "listener", "!", "=", "null", ")", "{", "listener", ".", "onNetworkChange", "(", "networkStatus", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "setNetworkStatus", "(", "@", "NetworkStatus", "int", "networkStatus", ")", "{", "setNetworkStatus", "(", "networkStatus", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNetworkStatus", "(", "Context", "context", ")", "{", "return", "networkStatus", ";", "}", "</s>"]
["<s>", "public", "boolean", "isDisconnected", "(", ")", "{", "return", "networkStatus", "=", "=", "DISCONNECTED", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setListener", "(", "Listener", "listener", ")", "{", "this", ".", "listener", "=", "listener", ";", "}", "</s>"]
["<s>", "Object", "getObject", "(", ")", "{", "return", "object", ";", "}", "</s>"]
["<s>", "void", "setObject", "(", "Object", "object", ")", "{", "this", ".", "object", "=", "object", ";", "}", "</s>"]
["<s>", "public", "NeverEndingDummyJob", "(", "Params", "params", ",", "CountDownLatch", "lock", ",", "Semaphore", "semaphore", ")", "{", "super", "(", "params", ")", ";", "this", ".", "lock", "=", "lock", ";", "this", ".", "semaphore", "=", "semaphore", ";", "createdJobs", ".", "add", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "semaphore", ".", "tryAcquire", "(", ")", ",", "equalTo", "(", "true", ")", ")", ";", "lock", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "semaphore", ".", "release", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "unlockAll", "(", ")", "{", "for", "(", "NeverEndingDummyJob", "job", ":", "createdJobs", ")", "{", "job", ".", "lock", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "boolean", "canUseRealTimer", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "protected", "void", "waitUntilJobsAreDone", "(", "final", "JobManager", "jobManager", ",", "List", "<", "?", "extends", "Job", ">", "jobs", ",", "Runnable", "action", ")", "throws", "InterruptedException", "{", "final", "Set", "<", "String", ">", "uuids", "=", "new", "HashSet", "<", ">", "(", ")", ";", "for", "(", "Job", "job", ":", "jobs", ")", "{", "uuids", ".", "add", "(", "job", ".", "getId", "(", ")", ")", ";", "}", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "uuids", ".", "size", "(", ")", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "if", "(", "uuids", ".", "remove", "(", "job", ".", "getId", "(", ")", ")", ")", "{", "latch", ".", "countDown", "(", ")", ";", "}", "}", "}", ")", ";", "if", "(", "action", "!", "=", "null", ")", "{", "action", ".", "run", "(", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "latch", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "if", "(", "uuids", ".", "remove", "(", "job", ".", "getId", "(", ")", ")", ")", "{", "latch", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "SuppressLint", "(", "\"", "<STR_LIT>", "\"", ")", "protected", "void", "waitUntilAJobIsDone", "(", "final", "JobManager", "jobManager", ",", "final", "WaitUntilCallback", "callback", ")", "throws", "InterruptedException", "{", "final", "CountDownLatch", "runJob", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "Throwable", "[", "]", "throwable", "=", "new", "Throwable", "[", "1", "]", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "synchronized", "(", "this", ")", "{", "super", ".", "onDone", "(", "job", ")", ";", "if", "(", "callback", "!", "=", "null", ")", "{", "try", "{", "callback", ".", "assertJob", "(", "job", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "throwable", "[", "0", "]", "=", "t", ";", "}", "}", "runJob", ".", "countDown", "(", ")", ";", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "}", "}", "}", ")", ";", "if", "(", "callback", "!", "=", "null", ")", "{", "callback", ".", "run", "(", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runJob", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "throwable", "[", "0", "]", ",", "CoreMatchers", ".", "nullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "synchronized", "(", "this", ")", "{", "super", ".", "onDone", "(", "job", ")", ";", "if", "(", "callback", "!", "=", "null", ")", "{", "try", "{", "callback", ".", "assertJob", "(", "job", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "throwable", "[", "0", "]", "=", "t", ";", "}", "}", "runJob", ".", "countDown", "(", ")", ";", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "}", "}", "</s>"]
["<s>", "void", "run", "(", ")", ";", "</s>"]
["<s>", "void", "assertJob", "(", "Job", "job", ")", ";", "</s>"]
["<s>", "@", "Test", "public", "void", "testSessionId", "(", ")", "throws", "Throwable", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "Long", "sessionId", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "Job", "[", "]", "jobs", "=", "new", "Job", "[", "]", "{", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", "}", ";", "for", "(", "Job", "job", ":", "jobs", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "jobs", ".", "length", ";", "i", "+", "+", ")", "{", "JobHolder", "jobHolder", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "i", ",", "jobHolder", ".", "getRunningSessionId", "(", ")", ",", "equalTo", "(", "sessionId", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelBeforeRunning", "(", ")", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "DummyJob", "nonPersistentJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "DummyJob", "persistentJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "persist", "(", ")", ")", ";", "jobManager", ".", "addJob", "(", "nonPersistentJob", ")", ";", "jobManager", ".", "addJob", "(", "persistentJob", ")", ";", "CancelResult", "result", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "for", "(", "Job", "j", ":", "result", ".", "getCancelledJobs", "(", ")", ")", "{", "DummyJob", "job", "=", "(", "DummyJob", ")", "j", ";", "if", "(", "!", "job", ".", "isPersistent", "(", ")", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnAddedCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnCancelCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnRunCnt", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelBeforeRunningWithGroups", "(", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "DummyJob", "nonPersistentJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "DummyJob", "persistentJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "jobManager", ".", "addJob", "(", "nonPersistentJob", ")", ";", "jobManager", ".", "addJob", "(", "persistentJob", ")", ";", "CancelResult", "result", "=", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "for", "(", "Job", "j", ":", "result", ".", "getCancelledJobs", "(", ")", ")", "{", "DummyJob", "job", "=", "(", "DummyJob", ")", "j", ";", "if", "(", "!", "job", ".", "isPersistent", "(", ")", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnAddedCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnCancelCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnRunCnt", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "is", "(", "0", ")", ")", ";", "jobManager", ".", "start", "(", ")", ";", "DummyJob", "nonPersistentJob2", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "nonPersistentJobLatch", ".", "countDown", "(", ")", ";", "}", "}", ";", "DummyJob", "persistentJob2", "=", "new", "PersistentDummyJob", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "jobManager", ".", "addJob", "(", "persistentJob2", ")", ";", "jobManager", ".", "addJob", "(", "nonPersistentJob2", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "nonPersistentJobLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "persistentJobLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "nonPersistentJobLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "PersistentDummyJob", "(", "Params", "params", ")", "{", "super", "(", "params", ".", "persist", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "persistentJobLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "runFailingJob", "(", ")", "throws", "Exception", "{", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addJob", "(", "new", "Job", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ")", "{", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "throw", "new", "RuntimeException", "(", ")", ";", "}", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "latch", ".", "countDown", "(", ")", ";", "}", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "false", ";", "}", "}", ")", ";", "latch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "latch", ".", "getCount", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "throw", "new", "RuntimeException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "latch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "private", "String", "addJob", "(", "JobManager", "jobManager", ",", "Job", "job", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "return", "job", ".", "getId", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGrouping", "(", ")", "throws", "Throwable", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "String", "jobId1", "=", "addJob", "(", "jobManager", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "String", "jobId2", "=", "addJob", "(", "jobManager", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "String", "jobId3", "=", "addJob", "(", "jobManager", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "String", "jobId4", "=", "addJob", "(", "jobManager", ",", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "JobHolder", "nextJob", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "nextJob", ".", "getId", "(", ")", ",", "equalTo", "(", "jobId1", ")", ")", ";", "JobHolder", "group2Job", "=", "nextJob", "(", "jobManager", ",", "Collections", ".", "singletonList", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "group2Job", ".", "getId", "(", ")", ",", "equalTo", "(", "jobId3", ")", ")", ";", "removeJob", "(", "jobManager", ",", "nextJob", ")", ";", "JobHolder", "group1NextJob", "=", "nextJob", "(", "jobManager", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "group1NextJob", ".", "getId", "(", ")", ",", "equalTo", "(", "jobId2", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "nextJob", "(", "jobManager", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "removeJob", "(", "jobManager", ",", "group2Job", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "nextJob", "(", "jobManager", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "@", "Test", "public", "void", "testGroupingRaceCondition", "(", ")", "throws", "Exception", "{", "DummyNetworkUtilWithConnectivityEventSupport", "dummyNetworkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "maxConsumerCount", "(", "<NUM_LIT:10>", ")", ".", "networkUtil", "(", "dummyNetworkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "final", "String", "GROUP_ID", "=", "\"", "<STR_LIT>", "\"", ";", "final", "int", "AFTER_ADDED_JOBS_COUNT", "=", "<NUM_LIT:5>", ";", "final", "int", "NOT_SET_JOB_ID", "=", "-", "1", ";", "final", "AtomicInteger", "firstRunJob", "=", "new", "AtomicInteger", "(", "NOT_SET_JOB_ID", ")", ";", "final", "int", "FIRST_JOB_ID", "=", "-", "<NUM_LIT:10>", ";", "final", "CountDownLatch", "onAddedCalled", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "remainingJobsOnAddedCalled", "=", "new", "CountDownLatch", "(", "AFTER_ADDED_JOBS_COUNT", ")", ";", "final", "CountDownLatch", "aJobRun", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "aJobRun", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "jobManager", ".", "addJobInBackground", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "GROUP_ID", ")", ")", "{", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "onAddedCalled", ".", "countDown", "(", ")", ";", "}", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "firstRunJob", ".", "compareAndSet", "(", "NOT_SET_JOB_ID", ",", "FIRST_JOB_ID", ")", ";", "}", "}", ")", ";", "onAddedCalled", ".", "await", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "AFTER_ADDED_JOBS_COUNT", ";", "i", "+", "+", ")", "{", "final", "int", "finalI", "=", "i", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ".", "groupBy", "(", "GROUP_ID", ")", ".", "requireNetwork", "(", ")", ")", "{", "final", "int", "id", "=", "finalI", "+", "1", ";", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "remainingJobsOnAddedCalled", ".", "countDown", "(", ")", ";", "}", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "firstRunJob", ".", "compareAndSet", "(", "NOT_SET_JOB_ID", ",", "id", ")", ";", "}", "}", ")", ";", "}", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "aJobRun", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "firstRunJob", ".", "get", "(", ")", ",", "is", "(", "FIRST_JOB_ID", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "aJobRun", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "onAddedCalled", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "firstRunJob", ".", "compareAndSet", "(", "NOT_SET_JOB_ID", ",", "FIRST_JOB_ID", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "remainingJobsOnAddedCalled", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "firstRunJob", ".", "compareAndSet", "(", "NOT_SET_JOB_ID", ",", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelBeforeRunning", "(", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "DummyJobWithLatches", "nonPersistentJob", "=", "new", "DummyJobWithLatches", "(", "0", ",", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "jobManager", ".", "addJob", "(", "nonPersistentJob", ")", ";", "DummyJobWithLatches", "persistentJob", "=", "new", "DummyJobWithLatches", "(", "0", ",", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ".", "persist", "(", ")", ")", ";", "jobManager", ".", "addJob", "(", "persistentJob", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "startLatches", "[", "0", "]", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "final", "CancelResult", "[", "]", "cancelResults", "=", "new", "CancelResult", "[", "1", "]", ";", "final", "CountDownLatch", "resultLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "startLatches", "[", "0", "]", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "cancelResults", "[", "0", "]", "=", "cancelResult", ";", "resultLatch", ".", "countDown", "(", ")", ";", "}", "}", ",", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "while", "(", "!", "nonPersistentJob", ".", "isCancelled", "(", ")", ")", "{", "}", "endLatches", "[", "0", "]", ".", "countDown", "(", ")", ";", "endLatches", "[", "0", "]", ".", "countDown", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "resultLatch", ".", "await", "(", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelResults", "[", "0", "]", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelResults", "[", "0", "]", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJobWithLatches", "(", "1", ",", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJobWithLatches", "(", "1", ",", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ".", "persist", "(", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "startLatches", "[", "1", "]", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "endLatches", "[", "1", "]", ".", "countDown", "(", ")", ";", "endLatches", "[", "1", "]", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "cancelResults", "[", "0", "]", "=", "cancelResult", ";", "resultLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DummyJobWithLatches", "(", "int", "latchIndex", ",", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "this", ".", "latchIndex", "=", "latchIndex", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "startLatches", "[", "latchIndex", "]", ".", "countDown", "(", ")", ";", "endLatches", "[", "latchIndex", "]", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNonPersistent", "(", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "MyDummyJob", "job", "=", "new", "MyDummyJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ",", "runLatch", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT>", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ")", ")", ";", "}", "jobManager", ".", "addJob", "(", "job", ")", ";", "runLatch", ".", "await", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "onAddedCntWhenRun", ",", "equalTo", "(", "1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPersistent", "(", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "MyDummyPersistentJob", ".", "persistentJobLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT>", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ")", ")", ";", "}", "jobManager", ".", "addJob", "(", "new", "MyDummyPersistentJob", "(", "<NUM_LIT:2>", ")", ")", ";", "MyDummyPersistentJob", ".", "persistentJobLatch", ".", "await", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "MyDummyPersistentJob", ".", "onAddedCountWhenOnRun", ",", "equalTo", "(", "1", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "MyDummyPersistentJob", "(", "int", "priority", ")", "{", "super", "(", "new", "Params", "(", "priority", ")", ".", "persist", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "persistentOnAdded", "+", "+", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "onAddedCountWhenOnRun", "=", "persistentOnAdded", ";", "persistentJobLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "protected", "MyDummyJob", "(", "Params", "params", ",", "CountDownLatch", "latch", ")", "{", "super", "(", "params", ",", "latch", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "super", ".", "onAdded", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "onAddedCntWhenRun", "=", "super", ".", "getOnAddedCnt", "(", ")", ";", "super", ".", "onRun", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testClear", "(", ")", "throws", "Exception", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "final", "int", "LIMIT", "=", "<NUM_LIT:20>", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "LIMIT", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "setPersistent", "(", "i", "%", "<NUM_LIT:2>", "=", "=", "1", ")", ")", ")", ";", "}", "jobManager", ".", "clear", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddedCount", "(", ")", "throws", "Exception", "{", "testAddedCount", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddedCountPersistent", "(", ")", "{", "testAddedCount", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testAddedCount", "(", "DummyJob", "dummyJob", ")", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "jobManager", ".", "addJob", "(", "dummyJob", ")", ";", "MatcherAssert", ".", "assertThat", "(", "1", ",", "equalTo", "(", "dummyJob", ".", "getOnAddedCnt", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "NetworkJobWithFallbackTest", "(", "boolean", "persistent", ")", "{", "this", ".", "persistent", "=", "persistent", ";", "}", "</s>"]
["<s>", "@", "ParameterizedRobolectricTestRunner", ".", "Parameters", "(", "name", "=", "\"", "<STR_LIT>", "\"", ")", "public", "static", "List", "<", "Object", "[", "]", ">", "getParams", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "new", "Object", "[", "]", "{", "true", "}", ",", "new", "Object", "[", "]", "{", "false", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFallbackFromUnmeteredToMobile", "(", ")", "throws", "InterruptedException", "{", "final", "DummyNetworkUtilWithConnectivityEventSupport", "networkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "networkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "DummyJob", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "persistent", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:10>", ")", ")", ";", "jobManager", ".", "addJob", "(", "dummyJob", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "jobManager", ".", "getJobStatus", "(", "dummyJob", ".", "getId", "(", ")", ")", ",", "CoreMatchers", ".", "is", "(", "JobStatus", ".", "WAITING_NOT_READY", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "1", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "jobManager", ".", "getJobStatus", "(", "dummyJob", ".", "getId", "(", ")", ")", ",", "CoreMatchers", ".", "is", "(", "JobStatus", ".", "WAITING_NOT_READY", ")", ")", ";", "waitUntilJobsAreDone", "(", "jobManager", ",", "Arrays", ".", "asList", "(", "dummyJob", ")", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayedRun", "(", ")", "throws", "Exception", "{", "delayedRunTest", "(", "false", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayedRunPersist", "(", ")", "throws", "Exception", "{", "delayedRunTest", "(", "true", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayedRunTryToStop", "(", ")", "throws", "Exception", "{", "delayedRunTest", "(", "false", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayedRunPersistAndTryToStop", "(", ")", "throws", "Exception", "{", "delayedRunTest", "(", "true", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayWith0Consumers", "(", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "0", ")", ".", "maxConsumerCount", "(", "<NUM_LIT:3>", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "DummyJob", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "latch", ".", "countDown", "(", ")", ";", "}", "}", ";", "jobManager", ".", "addJob", "(", "dummyJob", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "countReadyJobs", "(", ")", ",", "is", "(", "0", ")", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ",", "is", "(", "(", "Job", ")", "dummyJob", ")", ")", ";", "}", "}", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "latch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "NANOSECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "super", ".", "onRun", "(", ")", ";", "latch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ",", "is", "(", "(", "Job", ")", "dummyJob", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "delayedRunTest", "(", "boolean", "persist", ",", "boolean", "tryToStop", ")", "throws", "Exception", "{", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "super", ".", "onJobRun", "(", "job", ",", "resultCode", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", "+", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", "+", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", "+", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "}", ")", ";", "final", "DummyJob", "delayedJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ".", "setPersistent", "(", "persist", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "DummyJob", "nonDelayedJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "setPersistent", "(", "persist", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "delayedJob", ")", ";", "jobManager", ".", "addJob", "(", "nonDelayedJob", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "String", ")", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "if", "(", "tryToStop", ")", "{", "jobManager", ".", "stopAndWaitUntilConsumersAreFinished", "(", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "start", "(", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "String", ")", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "}", ")", ";", "}", "else", "{", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "String", ")", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "}", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "super", ".", "onJobRun", "(", "job", ",", "resultCode", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", "+", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", "+", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", "+", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "delayedJob", ")", ";", "jobManager", ".", "addJob", "(", "nonDelayedJob", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "String", ")", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "String", ")", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "String", ")", "job", ".", "getTags", "(", ")", ".", "toArray", "(", ")", "[", "0", "]", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "public", "NetworkJobTest", "(", "boolean", "unmetered", ")", "{", "this", ".", "unmetered", "=", "unmetered", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "cleanup", "(", ")", "{", "persistentDummyJobRunLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedRobolectricTestRunner", ".", "Parameters", "(", "name", "=", "\"", "<STR_LIT>", "\"", ")", "public", "static", "List", "<", "Object", "[", "]", ">", "getParams", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "new", "Object", "[", "]", "{", "true", "}", ",", "new", "Object", "[", "]", "{", "false", "}", ")", ";", "}", "</s>"]
["<s>", "private", "Params", "addRequirement", "(", "Params", "params", ")", "{", "if", "(", "unmetered", ")", "{", "return", "params", ".", "requireUnmeteredNetwork", "(", ")", ";", "}", "else", "{", "return", "params", ".", "requireNetwork", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Params", "addRequirement", "(", "Params", "params", ",", "long", "timeoutMs", ")", "{", "if", "(", "unmetered", ")", "{", "return", "params", ".", "requireUnmeteredNetworkWithTimeout", "(", "timeoutMs", ")", ";", "}", "else", "{", "return", "params", ".", "requireNetworkWithTimeout", "(", "timeoutMs", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNetworkJobWithTimeout", "(", ")", "throws", "InterruptedException", "{", "JobManagerTestBase", ".", "DummyNetworkUtil", "dummyNetworkUtil", "=", "new", "JobManagerTestBase", ".", "DummyNetworkUtil", "(", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "dummyNetworkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "final", "CountDownLatch", "runLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "DummyJob", "networkDummyJob", "=", "new", "DummyJob", "(", "addRequirement", "(", "new", "Params", "(", "1", ")", ",", "<NUM_LIT:4>", ")", ")", "{", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "runLatch", ".", "countDown", "(", ")", ";", "super", ".", "onRun", "(", ")", ";", "}", "}", ";", "jobManager", ".", "addJob", "(", "networkDummyJob", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "false", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:4>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "runLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "runLatch", ".", "countDown", "(", ")", ";", "super", ".", "onRun", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPersistentNetworkJobWithTimeout", "(", ")", "throws", "InterruptedException", "{", "JobManagerTestBase", ".", "DummyNetworkUtil", "dummyNetworkUtil", "=", "new", "JobManagerTestBase", ".", "DummyNetworkUtil", "(", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "dummyNetworkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "PersistentDummyJob", "networkDummyJob", "=", "new", "PersistentDummyJob", "(", "addRequirement", "(", "new", "Params", "(", "1", ")", ",", "<NUM_LIT:4>", ")", ")", ";", "jobManager", ".", "addJob", "(", "networkDummyJob", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "persistentDummyJobRunLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "false", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:4>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "persistentDummyJobRunLatch", ".", "await", "(", "<NUM_LIT:3>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "@", "Test", "public", "void", "testNetworkJob", "(", ")", "throws", "Exception", "{", "enableDebug", "(", ")", ";", "JobManagerTestBase", ".", "DummyNetworkUtil", "dummyNetworkUtil", "=", "new", "JobManagerTestBase", ".", "DummyNetworkUtil", "(", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "dummyNetworkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "DummyJob", "networkDummyJob", "=", "new", "DummyJob", "(", "addRequirement", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "networkDummyJob", ")", ";", "DummyJob", "noNetworkDummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ")", ";", "jobManager", ".", "addJob", "(", "noNetworkDummyJob", ")", ";", "DummyJob", "networkPersistentJob", "=", "new", "DummyJob", "(", "addRequirement", "(", "new", "Params", "(", "<NUM_LIT:6>", ")", ".", "persist", "(", ")", ")", ")", ";", "jobManager", ".", "addJob", "(", "networkPersistentJob", ")", ";", "DummyJob", "noNetworkPersistentJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ")", ";", "jobManager", ".", "addJob", "(", "noNetworkPersistentJob", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "<NUM_LIT:4>", ")", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "<NUM_LIT:4>", ")", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "final", "CountDownLatch", "noNetworkLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "resultCode", "=", "=", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "requiresNetwork", "(", "mockTimer", ")", ",", "is", "(", "false", ")", ")", ";", "noNetworkLatch", ".", "countDown", "(", ")", ";", "if", "(", "noNetworkLatch", ".", "getCount", "(", ")", "=", "=", "0", ")", "{", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "}", "}", "}", "}", ")", ";", "jobManager", ".", "start", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "noNetworkLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ";", "final", "CountDownLatch", "networkLatch", "=", "new", "CountDownLatch", "(", "<NUM_LIT:2>", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "resultCode", "=", "=", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "requiresNetwork", "(", "mockTimer", ")", ",", "is", "(", "true", ")", ")", ";", "networkLatch", ".", "countDown", "(", ")", ";", "if", "(", "networkLatch", ".", "getCount", "(", ")", "=", "=", "0", ")", "{", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "}", "}", "}", "}", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "if", "(", "unmetered", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "networkLatch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "false", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "networkLatch", ".", "getCount", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "UNMETERED", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT>", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "networkLatch", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "resultCode", "=", "=", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "requiresNetwork", "(", "mockTimer", ")", ",", "is", "(", "false", ")", ")", ";", "noNetworkLatch", ".", "countDown", "(", ")", ";", "if", "(", "noNetworkLatch", ".", "getCount", "(", ")", "=", "=", "0", ")", "{", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "resultCode", "=", "=", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "requiresNetwork", "(", "mockTimer", ")", ",", "is", "(", "true", ")", ")", ";", "networkLatch", ".", "countDown", "(", ")", ";", "if", "(", "networkLatch", ".", "getCount", "(", ")", "=", "=", "0", ")", "{", "jobManager", ".", "removeCallback", "(", "this", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "PersistentDummyJob", "(", "Params", "params", ")", "{", "super", "(", "params", ".", "persist", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "persistentDummyJobRunLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelBeforeRunning", "(", ")", "throws", "InterruptedException", "{", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "minConsumerCount", "(", "<NUM_LIT:5>", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "JobWithEndLatch", "nonPersistent1", "=", "new", "JobWithEndLatch", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ",", "true", ")", ";", "JobWithEndLatch", "nonPersistent2", "=", "new", "JobWithEndLatch", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ",", "false", ")", ";", "DummyJob", "persistentJob1", "=", "new", "PersistentJobWithEndLatch", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ",", "false", ")", ";", "DummyJob", "persistentJob2", "=", "new", "PersistentJobWithEndLatch", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ")", ",", "true", ")", ";", "jobManager", ".", "addJob", "(", "nonPersistent1", ")", ";", "jobManager", ".", "addJob", "(", "nonPersistent2", ")", ";", "jobManager", ".", "addJob", "(", "persistentJob1", ")", ";", "jobManager", ".", "addJob", "(", "persistentJob2", ")", ";", "onStartLatch", ".", "await", "(", ")", ";", "nonPersistent1", ".", "onStartLatch", ".", "await", "(", ")", ";", "nonPersistent2", ".", "onStartLatch", ".", "await", "(", ")", ";", "final", "CancelResult", "[", "]", "resultHolder", "=", "new", "CancelResult", "[", "<NUM_LIT:2>", "]", ";", "final", "CountDownLatch", "cancelLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "resultHolder", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "}", ",", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "jobManager", ".", "cancelJobsInBackground", "(", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "resultHolder", "[", "1", "]", "=", "cancelResult", ";", "}", "}", ",", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelLatch", ".", "await", "(", "<NUM_LIT:4>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "false", ")", ")", ";", "onEndLatch", ".", "countDown", "(", ")", ";", "nonPersistent1", ".", "onEndLatch", ".", "countDown", "(", ")", ";", "nonPersistent2", ".", "onEndLatch", ".", "countDown", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "cancelLatch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "final", "CancelResult", "result", "=", "resultHolder", "[", "0", "]", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getCancelledJobs", "(", ")", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getFailedToCancel", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "for", "(", "Job", "j", ":", "result", ".", "getCancelledJobs", "(", ")", ")", "{", "FailingJob", "job", "=", "(", "FailingJob", ")", "j", ";", "if", "(", "!", "job", ".", "isPersistent", "(", ")", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnAddedCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "if", "(", "job", ".", "fail", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnCancelCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "else", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnCancelCnt", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "}", "for", "(", "Job", "j", ":", "result", ".", "getFailedToCancel", "(", ")", ")", "{", "FailingJob", "job", "=", "(", "FailingJob", ")", "j", ";", "if", "(", "!", "job", ".", "isPersistent", "(", ")", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnAddedCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "if", "(", "job", ".", "fail", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnCancelCnt", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "else", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getOnCancelCnt", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "resultHolder", "[", "1", "]", ".", "getCancelledJobs", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "resultHolder", "[", "1", "]", ".", "getFailedToCancel", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "resultHolder", "[", "0", "]", "=", "cancelResult", ";", "cancelLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "resultHolder", "[", "1", "]", "=", "cancelResult", ";", "}", "</s>"]
["<s>", "public", "PersistentJobWithEndLatch", "(", "Params", "params", ",", "boolean", "fail", ")", "{", "super", "(", "params", ".", "persist", "(", ")", ",", "fail", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "onStartLatch", ".", "countDown", "(", ")", ";", "onEndLatch", ".", "await", "(", ")", ";", "if", "(", "fail", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "}", "</s>"]
["<s>", "public", "JobWithEndLatch", "(", "Params", "params", ",", "boolean", "fail", ")", "{", "super", "(", "params", ",", "fail", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "onStartLatch", ".", "countDown", "(", ")", ";", "onEndLatch", ".", "await", "(", ")", ";", "if", "(", "fail", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "}", "</s>"]
["<s>", "public", "FailingJob", "(", "Params", "params", ",", "boolean", "fail", ")", "{", "super", "(", "params", ")", ";", "this", ".", "fail", "=", "fail", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "getClass", "(", ")", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", "+", "System", ".", "identityHashCode", "(", "this", ")", "+", "\"", "<STR_LIT:)>", "\"", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInjector", "(", ")", "throws", "Throwable", "{", "Configuration", ".", "Builder", "builder", "=", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ";", "final", "JobManagerTestBase", ".", "ObjectReference", "injectedJobReference", "=", "new", "JobManagerTestBase", ".", "ObjectReference", "(", ")", ";", "final", "AtomicInteger", "injectionCallCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "DependencyInjector", "dependencyInjector", "=", "new", "DependencyInjector", "(", ")", "{", "@", "Override", "public", "void", "inject", "(", "Job", "job", ")", "{", "injectedJobReference", ".", "setObject", "(", "job", ")", ";", "injectionCallCount", ".", "incrementAndGet", "(", ")", ";", "}", "}", ";", "builder", ".", "injector", "(", "dependencyInjector", ")", ";", "builder", ".", "timer", "(", "mockTimer", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "builder", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "<NUM_LIT:4>", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "injectionCallCount", ".", "get", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "injectionCallCount", ".", "get", "(", ")", ",", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ";", "JobHolder", "holder", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "holder", ".", "getJob", "(", ")", ",", "not", "(", "injectedJobReference", ".", "getObject", "(", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "injectionCallCount", ".", "get", "(", ")", ",", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ";", "holder", "=", "nextJob", "(", "jobManager", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "holder", ".", "getJob", "(", ")", ",", "equalTo", "(", "injectedJobReference", ".", "getObject", "(", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "injectionCallCount", ".", "get", "(", ")", ",", "equalTo", "(", "<NUM_LIT:3>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "inject", "(", "Job", "job", ")", "{", "injectedJobReference", ".", "setObject", "(", "job", ")", ";", "injectionCallCount", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMaxConsumerCount", "(", ")", "throws", "Exception", "{", "int", "maxConsumerCount", "=", "<NUM_LIT:2>", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "maxConsumerCount", "(", "maxConsumerCount", ")", ".", "loadFactor", "(", "maxConsumerCount", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "Semaphore", "semaphore", "=", "new", "Semaphore", "(", "maxConsumerCount", ")", ";", "int", "totalJobCount", "=", "maxConsumerCount", "*", "<NUM_LIT:3>", ";", "List", "<", "NeverEndingDummyJob", ">", "runningJobs", "=", "new", "ArrayList", "<", ">", "(", "totalJobCount", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "totalJobCount", ";", "i", "+", "+", ")", "{", "NeverEndingDummyJob", "job", "=", "new", "NeverEndingDummyJob", "(", "new", "Params", "(", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:3>", ")", ")", ",", "runLock", ",", "semaphore", ")", ";", "runningJobs", ".", "add", "(", "job", ")", ";", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "Timer", "timer", "=", "new", "SystemTimer", "(", ")", ";", "long", "start", "=", "timer", ".", "nanoTime", "(", ")", ";", "long", "tenSeconds", "=", "TimeUnit", ".", "SECONDS", ".", "toNanos", "(", "<NUM_LIT:10>", ")", ";", "while", "(", "timer", ".", "nanoTime", "(", ")", "-", "start", "<", "tenSeconds", "&", "&", "semaphore", ".", "tryAcquire", "(", ")", ")", "{", "semaphore", ".", "release", "(", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:100>", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "timer", ".", "nanoTime", "(", ")", "-", "start", ">", "tenSeconds", ",", "is", "(", "false", ")", ")", ";", "Thread", ".", "sleep", "(", "TimeUnit", ".", "SECONDS", ".", "toMillis", "(", "<NUM_LIT:3>", ")", ")", ";", "int", "totalRunningCount", "=", "0", ";", "for", "(", "DummyJob", "job", ":", "runningJobs", ")", "{", "totalRunningCount", "+", "=", "job", ".", "getOnRunCnt", "(", ")", ";", "}", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "totalRunningCount", ",", "equalTo", "(", "maxConsumerCount", ")", ")", ";", "waitUntilJobsAreDone", "(", "jobManager", ",", "runningJobs", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "runLock", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "runLock", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "clear", "(", ")", "{", "retryCount", "=", "0", ";", "errors", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "getContextNonPersistent", "(", ")", "throws", "InterruptedException", ",", "MultipleFailureException", "{", "getContextTest", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "getContextPersistent", "(", ")", "throws", "InterruptedException", ",", "MultipleFailureException", "{", "getContextTest", "(", "true", ")", ";", "}", "</s>"]
["<s>", "public", "void", "getContextTest", "(", "boolean", "persistent", ")", "throws", "InterruptedException", ",", "MultipleFailureException", "{", "final", "ContextCheckJob", "addedJob", "=", "new", "ContextCheckJob", "(", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "persistent", ")", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "addedJob", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "if", "(", "!", "errors", ".", "isEmpty", "(", ")", ")", "{", "throw", "new", "MultipleFailureException", "(", "errors", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "addedJob", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "protected", "ContextCheckJob", "(", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertContext", "(", "String", "method", ")", "{", "Context", "applicationContext", "=", "getApplicationContext", "(", ")", ";", "try", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "method", ",", "applicationContext", ",", "sameInstance", "(", "(", "Context", ")", "RuntimeEnvironment", ".", "application", ")", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "errors", ".", "add", "(", "t", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "assertContext", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "assertContext", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "retryCount", "<", "<NUM_LIT:2>", ")", "{", "retryCount", "+", "+", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "assertContext", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "assertContext", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "retryCount", "<", "<NUM_LIT:2>", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "@", "Test", "public", "void", "testCount", "(", ")", "throws", "Exception", "{", "enableDebug", "(", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "stop", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:10>", ";", "i", "+", "+", ")", "{", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "i", "*", "<NUM_LIT:2>", "+", "1", ")", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "i", "*", "<NUM_LIT:2>", "+", "<NUM_LIT:2>", ")", ")", ";", "}", "final", "CountDownLatch", "jobsToRun", "=", "new", "CountDownLatch", "(", "<NUM_LIT:20>", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "resultCode", "=", "=", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", "{", "jobsToRun", ".", "countDown", "(", ")", ";", "}", "}", "}", ")", ";", "jobManager", ".", "start", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobsToRun", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ",", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "if", "(", "resultCode", "=", "=", "JobManagerCallback", ".", "RESULT_SUCCEED", ")", "{", "jobsToRun", ".", "countDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNetworkJobWithConnectivityListener", "(", ")", "throws", "Exception", "{", "final", "DummyNetworkUtilWithConnectivityEventSupport", "dummyNetworkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "networkUtil", "(", "dummyNetworkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ",", "true", ")", ";", "final", "DummyJob", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ")", ";", "jobManager", ".", "addJob", "(", "dummyJob", ")", ";", "jobManager", ".", "waitUntilConsumersAreFinished", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "false", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ",", "CoreMatchers", ".", "is", "(", "(", "Job", ")", "dummyJob", ")", ")", ";", "}", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "dummyNetworkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ",", "CoreMatchers", ".", "is", "(", "(", "Job", ")", "dummyJob", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testKeepAlive", "(", ")", "throws", "Exception", "{", "testKeepAlive", "(", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testKeepAliveWithoutNetworkEvents", "(", ")", "throws", "Exception", "{", "testKeepAlive", "(", "new", "DummyNetworkUtil", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "Build", ".", "VERSION_CODES", ".", "GINGERBREAD", ")", "public", "void", "testKeepAlive", "(", "final", "DummyNetworkUtil", "networkUtil", ")", "throws", "Exception", "{", "int", "keepAlive", "=", "<NUM_LIT:3>", "+", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:5>", ")", ";", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "consumerKeepAlive", "(", "keepAlive", ")", ".", "networkUtil", "(", "networkUtil", ")", ".", "timer", "(", "mockTimer", ")", ")", ";", "final", "CountDownLatch", "jobDone", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "jobDone", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", ")", ";", "jobManager", ".", "count", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getActiveConsumerCount", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "jobDone", ".", "await", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "mockTimer", ".", "incrementNs", "(", "(", "long", ")", "(", "JobManager", ".", "NETWORK_CHECK_INTERVAL", "+", "TimeUnit", ".", "SECONDS", ".", "toNanos", "(", "keepAlive", ")", "*", "<NUM_LIT>", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "getActiveConsumerCount", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "final", "DummyJob", "dj1", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ")", ";", "jobManager", ".", "addJob", "(", "dj1", ")", ";", "mockTimer", ".", "incrementNs", "(", "JobManager", ".", "NETWORK_CHECK_INTERVAL", "+", "TimeUnit", ".", "SECONDS", ".", "toNanos", "(", "keepAlive", ")", "*", "<NUM_LIT:2>", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "Assert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ",", "is", "(", "(", "Job", ")", "dj1", ")", ")", ";", "}", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobManager", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "jobDone", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "Assert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "job", ",", "is", "(", "(", "Job", ")", "dj1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPersistentJob", "(", ")", "throws", "Exception", "{", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "jobManager", ".", "addJob", "(", "new", "DummyPersistentLatchJob", "(", ")", ")", ";", "persistentRunLatch", ".", "await", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "MatcherAssert", ".", "assertThat", "(", "(", "int", ")", "persistentRunLatch", ".", "getCount", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "public", "DummyPersistentLatchJob", "(", ")", "{", "super", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "PersistentJobTest", ".", "persistentRunLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", ";", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "set", "=", "new", "RunningJobSet", "(", "new", "SystemTimer", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEmpty", "(", ")", "{", "assertThat", "(", "set", ".", "getSafe", "(", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAdd", "(", ")", "{", "set", ".", "add", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "set", ".", "getSafe", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ",", "is", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddTheSame", "(", ")", "{", "set", ".", "add", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "set", ".", "add", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "set", ".", "getSafe", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ",", "is", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "assertThat", "(", "set", ".", "getSafe", "(", ")", ".", "size", "(", ")", ",", "is", "(", "1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove", "(", ")", "{", "set", ".", "add", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "set", ".", "remove", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "set", ".", "getSafe", "(", ")", ".", "iterator", "(", ")", ".", "hasNext", "(", ")", ",", "is", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testOrder", "(", ")", "{", "set", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "set", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "set", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertList", "(", "String", ".", ".", ".", "items", ")", "{", "assertThat", "(", "set", ".", "getSafe", "(", ")", ".", "size", "(", ")", ",", "is", "(", "items", ".", "length", ")", ")", ";", "Iterator", "<", "String", ">", "iterator", "=", "set", ".", "getSafe", "(", ")", ".", "iterator", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "items", ".", "length", ";", "i", "+", "+", ")", "{", "assertThat", "(", "iterator", ".", "next", "(", ")", ",", "is", "(", "items", "[", "i", "]", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddWithTimeout", "(", ")", "{", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "set", "=", "new", "RunningJobSet", "(", "timer", ")", ";", "set", ".", "addGroupUntil", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT>", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:5>", ")", ";", "assertList", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:11>", ")", ";", "assertList", "(", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:3>", ")", ";", "assertList", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddSameGroupTwiceWithTimeout", "(", ")", "{", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "set", "=", "new", "RunningJobSet", "(", "timer", ")", ";", "set", ".", "addGroupUntil", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT>", ")", ";", "set", ".", "addGroupUntil", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT>", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:5>", ")", ";", "assertList", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:11>", ")", ";", "assertList", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "assertList", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddMultipleGroupTimeouts", "(", ")", "{", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "set", "=", "new", "RunningJobSet", "(", "timer", ")", ";", "set", ".", "addGroupUntil", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT>", ")", ";", "set", ".", "addGroupUntil", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT>", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:5>", ")", ";", "assertList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT:11>", ")", ";", "assertList", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "timer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "assertList", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "long", "nanoTime", "(", ")", "{", "return", "now", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "incrementMs", "(", "long", "time", ")", "{", "setNow", "(", "now", "+", "time", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "incrementNs", "(", "long", "time", ")", "{", "setNow", "(", "now", "+", "time", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setNow", "(", "long", "now", ")", "{", "this", ".", "now", "=", "now", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "now", ")", ";", "notifyObjectWaits", "(", "now", ")", ";", "}", "</s>"]
["<s>", "private", "synchronized", "void", "notifyObjectWaits", "(", "long", "now", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "now", ")", ";", "for", "(", "ObjectWait", "objectWait", ":", "waitingList", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "objectWait", ",", "objectWait", ".", "target", ",", "objectWait", ".", "timeUntil", ")", ";", "if", "(", "objectWait", ".", "timeUntil", "<", "=", "now", ")", "{", "final", "ObjectWait", "toWait", "=", "objectWait", ";", "waitingList", ".", "remove", "(", "objectWait", ")", ";", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "synchronized", "(", "toWait", ".", "target", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "toWait", ")", ";", "toWait", ".", "target", ".", "notifyAll", "(", ")", ";", "}", "}", "}", ")", ".", "start", "(", ")", ";", "}", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "synchronized", "(", "toWait", ".", "target", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "toWait", ")", ";", "toWait", ".", "target", ".", "notifyAll", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "waitOnObjectUntilNs", "(", "Object", "object", ",", "long", "untilNs", ")", "throws", "InterruptedException", "{", "synchronized", "(", "this", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "object", ",", "untilNs", ",", "stopped", ")", ";", "if", "(", "stopped", ")", "{", "return", ";", "}", "if", "(", "untilNs", "<", "now", ")", "{", "return", ";", "}", "anyObjectToNotify", ".", "put", "(", "object", ",", "true", ")", ";", "ObjectWait", "objectWait", "=", "new", "ObjectWait", "(", "object", ",", "untilNs", ")", ";", "waitingList", ".", "add", "(", "objectWait", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "objectWait", ",", "objectWait", ".", "target", ",", "objectWait", ".", "timeUntil", ",", "objectWait", ".", "timeUntil", "=", "=", "ObjectWait", ".", "FOREVER", ")", ";", "}", "object", ".", "wait", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "notifyObject", "(", "Object", "object", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "object", ")", ";", "for", "(", "ObjectWait", "objectWait", ":", "waitingList", ")", "{", "if", "(", "objectWait", ".", "target", "=", "=", "object", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "objectWait", ")", ";", "waitingList", ".", "remove", "(", "objectWait", ")", ";", "object", ".", "notifyAll", "(", ")", ";", "}", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "waitOnObject", "(", "Object", "object", ")", "throws", "InterruptedException", "{", "waitOnObjectUntilNs", "(", "object", ",", "ObjectWait", ".", "FOREVER", ")", ";", "}", "</s>"]
["<s>", "public", "ObjectWait", "(", "Object", "target", ",", "long", "time", ")", "{", "timeUntil", "=", "time", ";", "this", ".", "target", "=", "target", ";", "}", "</s>"]
["<s>", "public", "DummyJob", "(", "Params", "params", ")", "{", "super", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "onAddedCnt", "+", "+", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRun", "(", ")", "throws", "Throwable", "{", "onRunCnt", "+", "+", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onCancel", "(", ")", "{", "onCancelCnt", "+", "+", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "shouldReRunOnThrowableCnt", "+", "+", ";", "return", "false", ";", "}", "</s>"]
["<s>", "public", "int", "getOnAddedCnt", "(", ")", "{", "return", "onAddedCnt", ";", "}", "</s>"]
["<s>", "public", "int", "getOnRunCnt", "(", ")", "{", "return", "onRunCnt", ";", "}", "</s>"]
["<s>", "public", "int", "getOnCancelCnt", "(", ")", "{", "return", "onCancelCnt", ";", "}", "</s>"]
["<s>", "public", "int", "getShouldReRunOnThrowableCnt", "(", ")", "{", "return", "shouldReRunOnThrowableCnt", ";", "}", "</s>"]
["<s>", "public", "SimpleInMemoryJobQueueTest", "(", ")", "{", "super", "(", "new", "JobQueueFactory", "(", ")", "{", "@", "Override", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", "{", "return", "new", "SimpleInMemoryPriorityQueue", "(", "null", ",", "sessionId", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", "{", "return", "new", "SimpleInMemoryPriorityQueue", "(", "null", ",", "sessionId", ")", ";", "}", "</s>"]
["<s>", "public", "CachedPersistentJobQueueTest", "(", ")", "{", "super", "(", "new", "JobQueueFactory", "(", ")", "{", "@", "Override", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", "{", "SqliteJobQueue", ".", "JavaSerializer", "jobSerializer", "=", "new", "SqliteJobQueue", ".", "JavaSerializer", "(", ")", ";", "return", "new", "SqliteJobQueue", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "id", "(", "id", ")", ".", "jobSerializer", "(", "jobSerializer", ")", ".", "inTestMode", "(", ")", ".", "timer", "(", "timer", ")", ".", "build", "(", ")", ",", "sessionId", ",", "jobSerializer", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", "{", "SqliteJobQueue", ".", "JavaSerializer", "jobSerializer", "=", "new", "SqliteJobQueue", ".", "JavaSerializer", "(", ")", ";", "return", "new", "SqliteJobQueue", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "id", "(", "id", ")", ".", "jobSerializer", "(", "jobSerializer", ")", ".", "inTestMode", "(", ")", ".", "timer", "(", "timer", ")", ".", "build", "(", ")", ",", "sessionId", ",", "jobSerializer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "assertParamsUnderstood", "(", ")", "{", "DummyJob", "j1", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireNetwork", "(", ")", ")", ";", "MockTimer", "mockTimer", "=", "new", "MockTimer", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j1", ".", "requiresNetwork", "(", "mockTimer", ")", ",", "equalTo", "(", "true", ")", ")", ";", "j1", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j1", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "equalTo", "(", "Params", ".", "FOREVER", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j1", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ",", "equalTo", "(", "Params", ".", "NEVER", ")", ")", ";", "DummyJob", "j2", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "groupBy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j2", ".", "getRunGroupId", "(", ")", ",", "equalTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "j2", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j2", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "equalTo", "(", "Params", ".", "NEVER", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j2", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ",", "equalTo", "(", "Params", ".", "NEVER", ")", ")", ";", "DummyJob", "j3", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "persist", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j3", ".", "isPersistent", "(", ")", ",", "equalTo", "(", "true", ")", ")", ";", "DummyJob", "j4", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "setPersistent", "(", "false", ")", ".", "setRequiresNetwork", "(", "false", ")", ".", "setGroupId", "(", "null", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j4", ".", "isPersistent", "(", ")", ",", "equalTo", "(", "false", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j4", ".", "requiresNetwork", "(", "mockTimer", ")", ",", "equalTo", "(", "false", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j4", ".", "requiresUnmeteredNetwork", "(", "mockTimer", ")", ",", "equalTo", "(", "false", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j4", ".", "getRunGroupId", "(", ")", ",", "nullValue", "(", ")", ")", ";", "DummyJob", "j5", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:15>", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "j5", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j5", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j5", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "DummyJob", "j6", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:15>", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "j6", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j6", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j6", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "DummyJob", "j7", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:15>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:20>", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "<NUM_LIT:2>", ")", ";", "j7", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j7", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j7", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "DummyJob", "j8", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:15>", ")", ".", "requireNetwork", "(", ")", ")", ";", "j8", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j8", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "is", "(", "Params", ".", "FOREVER", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j8", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "DummyJob", "j9", "=", "new", "DummyJob", "(", "new", "Params", "(", "1", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:15>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:10>", ")", ")", ";", "mockTimer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "j9", ".", "seal", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j9", ".", "getRequiresNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "j9", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "public", "SqliteJobQueueTest", "(", ")", "{", "super", "(", "new", "JobQueueFactory", "(", ")", "{", "@", "Override", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", "{", "SqliteJobQueue", ".", "JavaSerializer", "serializer", "=", "new", "SqliteJobQueue", ".", "JavaSerializer", "(", ")", ";", "return", "new", "SqliteJobQueue", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "id", "(", "id", ")", ".", "jobSerializer", "(", "serializer", ")", ".", "inTestMode", "(", ")", ".", "timer", "(", "timer", ")", ".", "build", "(", ")", ",", "sessionId", ",", "serializer", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobQueue", "createNew", "(", "long", "sessionId", ",", "String", "id", ",", "Timer", "timer", ")", "{", "SqliteJobQueue", ".", "JavaSerializer", "serializer", "=", "new", "SqliteJobQueue", ".", "JavaSerializer", "(", ")", ";", "return", "new", "SqliteJobQueue", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "id", "(", "id", ")", ".", "jobSerializer", "(", "serializer", ")", ".", "inTestMode", "(", ")", ".", "timer", "(", "timer", ")", ".", "build", "(", ")", ",", "sessionId", ",", "serializer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCustomSerializer", "(", ")", "throws", "Exception", "{", "final", "CountDownLatch", "calledForSerialize", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CountDownLatch", "calledForDeserialize", "=", "new", "CountDownLatch", "(", "1", ")", ";", "SqliteJobQueue", ".", "JobSerializer", "jobSerializer", "=", "new", "SqliteJobQueue", ".", "JavaSerializer", "(", ")", "{", "@", "Override", "public", "byte", "[", "]", "serialize", "(", "Object", "object", ")", "throws", "IOException", "{", "calledForSerialize", ".", "countDown", "(", ")", ";", "return", "super", ".", "serialize", "(", "object", ")", ";", "}", "@", "Override", "public", "<", "T", "extends", "Job", ">", "T", "deserialize", "(", "byte", "[", "]", "bytes", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "calledForDeserialize", ".", "countDown", "(", ")", ";", "return", "super", ".", "deserialize", "(", "bytes", ")", ";", "}", "}", ";", "SqliteJobQueue", "jobQueue", "=", "new", "SqliteJobQueue", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "id", "(", "\"", "<STR_LIT>", "\"", "+", "mockTimer", ".", "nanoTime", "(", ")", ")", ".", "jobSerializer", "(", "jobSerializer", ")", ".", "inTestMode", "(", ")", ".", "timer", "(", "mockTimer", ")", ".", "build", "(", ")", ",", "mockTimer", ".", "nanoTime", "(", ")", ",", "jobSerializer", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ")", ")", ";", "calledForSerialize", ".", "await", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "int", ")", "calledForSerialize", ".", "getCount", "(", ")", ",", "CoreMatchers", ".", "equalTo", "(", "0", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "int", ")", "calledForDeserialize", ".", "getCount", "(", ")", ",", "CoreMatchers", ".", "equalTo", "(", "1", ")", ")", ";", "jobQueue", ".", "nextJobAndIncRunCount", "(", "new", "TestConstraint", "(", "mockTimer", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "(", "int", ")", "calledForDeserialize", ".", "getCount", "(", ")", ",", "CoreMatchers", ".", "equalTo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "serialize", "(", "Object", "object", ")", "throws", "IOException", "{", "calledForSerialize", ".", "countDown", "(", ")", ";", "return", "super", ".", "serialize", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", "extends", "Job", ">", "T", "deserialize", "(", "byte", "[", "]", "bytes", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "calledForDeserialize", ".", "countDown", "(", ")", ";", "return", "super", ".", "deserialize", "(", "bytes", ")", ";", "}", "</s>"]
["<s>", "public", "JobQueueTestBase", "(", "JobQueueFactory", "factory", ")", "{", "currentFactory", "=", "factory", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBasicAddRemoveCount", "(", ")", "throws", "Exception", "{", "final", "int", "ADD_COUNT", "=", "<NUM_LIT:6>", ";", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ADD_COUNT", ";", "i", "+", "+", ")", "{", "JobHolder", "holder", "=", "createNewJobHolder", "(", ")", ";", "jobQueue", ".", "insert", "(", "holder", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "i", "+", "1", ")", ")", ";", "assertThat", "(", "holder", ".", "getInsertionOrder", "(", ")", ",", "equalTo", "(", "i", "+", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "holder", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "i", "+", "1", ")", ")", ";", "}", "JobHolder", "firstHolder", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "firstHolder", ".", "getRunCount", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "ADD_COUNT", "-", "1", ")", ")", ";", "JobHolder", "secondHolder", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "secondHolder", ".", "getRunCount", "(", ")", ",", "equalTo", "(", "1", ")", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "ADD_COUNT", "-", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "firstHolder", ".", "getId", "(", ")", ",", "not", "(", "secondHolder", ".", "getId", "(", ")", ")", ")", ";", "jobQueue", ".", "remove", "(", "secondHolder", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "ADD_COUNT", "-", "<NUM_LIT:2>", ")", ")", ";", "jobQueue", ".", "remove", "(", "secondHolder", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "ADD_COUNT", "-", "<NUM_LIT:2>", ")", ")", ";", "jobQueue", ".", "remove", "(", "firstHolder", ")", ";", "assertThat", "(", "(", "int", ")", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "ADD_COUNT", "-", "<NUM_LIT:2>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPriority", "(", ")", "throws", "Exception", "{", "int", "JOB_LIMIT", "=", "<NUM_LIT:20>", ";", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "JOB_LIMIT", ";", "i", "+", "+", ")", "{", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "}", "int", "minPriority", "=", "Integer", ".", "MAX_VALUE", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "JOB_LIMIT", ";", "i", "+", "+", ")", "{", "JobHolder", "holder", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "holder", ".", "getPriority", "(", ")", "<", "=", "minPriority", ",", "is", "(", "true", ")", ")", ";", "}", "assertThat", "(", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithPriority", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "lowPriorityHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ",", "1", ")", ";", "JobHolder", "highPriorityHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ")", ";", "jobQueue", ".", "insert", "(", "lowPriorityHolder", ")", ";", "jobQueue", ".", "insert", "(", "highPriorityHolder", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "new", "TestConstraint", "(", "mockTimer", ")", ")", ",", "equalTo", "(", "lowPriorityHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGroupId", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "jobHolder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "JobHolder", "jobHolder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "JobHolder", "jobHolder3", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "JobHolder", "jobHolder4", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "JobHolder", "jobHolder5", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder1", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder2", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder3", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder4", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder5", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:2>", "\"", "}", ")", ")", ";", "JobHolder", "received", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received", ".", "getJob", "(", ")", ".", "getRunGroupId", "(", ")", ",", "equalTo", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder1", ".", "getId", "(", ")", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "JobHolder", "jobHolder6", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder6", ")", ";", "JobHolder", "tmpReceived", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "tmpReceived", ".", "getId", "(", ")", ",", "is", "(", "jobHolder6", ".", "getId", "(", ")", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ".", "getJob", "(", ")", ".", "getRunGroupId", "(", ")", ",", "equalTo", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "assertThat", "(", "jobQueue", ".", "insertOrReplace", "(", "received", ")", ",", "is", "(", "true", ")", ")", ";", "constraint", ".", "clear", "(", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "JobHolder", "received2", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received2", ".", "getId", "(", ")", ",", "equalTo", "(", "received", ".", "getId", "(", ")", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", "}", ")", ")", ";", "JobHolder", "received3", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received3", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder4", ".", "getId", "(", ")", ")", ")", ";", "JobHolder", "jobHolder7", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder7", ")", ";", "JobHolder", "jobHolder8", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder8", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", "}", ")", ")", ";", "JobHolder", "holder4", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "holder4", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder7", ".", "getId", "(", ")", ")", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "holder4", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder7", ".", "getId", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDueDelayUntilWithPriority", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "mockTimer", ".", "setNow", "(", "<NUM_LIT>", ")", ";", "long", "now", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "JobHolder", "lowPriorityHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ",", "now", "-", "<NUM_LIT:1000>", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "JobHolder", "highPriorityHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ",", "now", "-", "<NUM_LIT>", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "jobQueue", ".", "insert", "(", "lowPriorityHolder", ")", ";", "jobQueue", ".", "insert", "(", "highPriorityHolder", ")", ";", "long", "soonJobDelay", "=", "<NUM_LIT>", ";", "JobHolder", "highestPriorityDelayedJob", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "<NUM_LIT:12>", ")", ",", "now", "+", "soonJobDelay", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "jobQueue", ".", "insert", "(", "highestPriorityDelayedJob", ")", ";", "Constraint", "constraint", "=", "new", "Constraint", "(", ")", ";", "constraint", ".", "setNowInNs", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "highPriorityHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "soonJobDelay", "+", "1", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ".", "getId", "(", ")", ",", "equalTo", "(", "highestPriorityDelayedJob", ".", "getId", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntil", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "long", "now", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "JobHolder", "networkJobHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ",", "now", "+", "<NUM_LIT:2>", ")", ";", "JobHolder", "noNetworkJobHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ",", "now", "+", "<NUM_LIT:5>", ")", ";", "jobQueue", ".", "insert", "(", "networkJobHolder", ")", ";", "jobQueue", ".", "insert", "(", "noNetworkJobHolder", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "noNetworkJobHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "constraint", ".", "clear", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "networkJobHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "JobHolder", "noNetworkJobHolder2", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ",", "now", "+", "1", ")", ";", "jobQueue", ".", "insert", "(", "noNetworkJobHolder2", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "noNetworkJobHolder2", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithExcludeGroups", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "long", "now", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "JobHolder", "networkJobHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ",", "now", "+", "<NUM_LIT>", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "JobHolder", "noNetworkJobHolder", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ",", "now", "+", "<NUM_LIT>", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "jobQueue", ".", "insert", "(", "networkJobHolder", ")", ";", "jobQueue", ".", "insert", "(", "noNetworkJobHolder", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "noNetworkJobHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "noNetworkJobHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "noNetworkJobHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "networkJobHolder", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "JobHolder", "noNetworkJobHolder2", "=", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ",", "now", "+", "<NUM_LIT>", "*", "JobManager", ".", "NS_PER_MS", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "jobQueue", ".", "insert", "(", "noNetworkJobHolder2", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "equalTo", "(", "noNetworkJobHolder2", ".", "getDelayUntilNs", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testTruncate", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "final", "int", "LIMIT", "=", "<NUM_LIT:20>", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "LIMIT", ";", "i", "+", "+", ")", "{", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", ")", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "LIMIT", ")", ")", ";", "jobQueue", ".", "clear", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "0", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "LIMIT", ";", "i", "+", "+", ")", "{", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", ")", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "count", "(", ")", ",", "equalTo", "(", "LIMIT", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPriorityWithDelayedJobs", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "delayedPriority_5", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ")", ";", "org", ".", "fest", ".", "reflect", ".", "field", ".", "Invoker", "<", "Long", ">", "delayUntilField", "=", "getDelayUntilNsField", "(", "delayedPriority_5", ")", ";", "delayUntilField", ".", "set", "(", "mockTimer", ".", "nanoTime", "(", ")", "-", "<NUM_LIT:1000>", ")", ";", "JobHolder", "delayedPriority_2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ")", ";", "delayUntilField", "=", "getDelayUntilNsField", "(", "delayedPriority_2", ")", ";", "delayUntilField", ".", "set", "(", "mockTimer", ".", "nanoTime", "(", ")", "-", "<NUM_LIT>", ")", ";", "JobHolder", "nonDelayedPriority_6", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:6>", ")", ")", ";", "JobHolder", "nonDelayedPriority_3", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ")", ";", "JobHolder", "nonDelayedPriority_2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ")", ";", "jobQueue", ".", "insert", "(", "delayedPriority_5", ")", ";", "jobQueue", ".", "insert", "(", "delayedPriority_2", ")", ";", "jobQueue", ".", "insert", "(", "nonDelayedPriority_6", ")", ";", "jobQueue", ".", "insert", "(", "nonDelayedPriority_2", ")", ";", "jobQueue", ".", "insert", "(", "nonDelayedPriority_3", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "int", "lastPriority", "=", "Integer", ".", "MAX_VALUE", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:5>", ";", "i", "+", "+", ")", "{", "JobHolder", "next", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "next", ",", "notNullValue", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "i", ",", "next", ".", "getPriority", "(", ")", "<", "=", "lastPriority", ",", "is", "(", "true", ")", ")", ";", "lastPriority", "=", "next", ".", "getPriority", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "org", ".", "fest", ".", "reflect", ".", "field", ".", "Invoker", "<", "Long", ">", "getDelayUntilNsField", "(", "JobHolder", "jobHolder", ")", "{", "return", "Reflection", ".", "field", "(", "\"", "<STR_LIT>", "\"", ")", ".", "ofType", "(", "long", ".", "class", ")", ".", "in", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "private", "org", ".", "fest", ".", "reflect", ".", "field", ".", "Invoker", "<", "Integer", ">", "getPriorityField", "(", "Params", "params", ")", "{", "return", "Reflection", ".", "field", "(", "\"", "<STR_LIT>", "\"", ")", ".", "ofType", "(", "int", ".", "class", ")", ".", "in", "(", "params", ")", ";", "}", "</s>"]
["<s>", "private", "org", ".", "fest", ".", "reflect", ".", "field", ".", "Invoker", "<", "Long", ">", "getDelayMsField", "(", "Params", "params", ")", "{", "return", "Reflection", ".", "field", "(", "\"", "<STR_LIT>", "\"", ")", ".", "ofType", "(", "long", ".", "class", ")", ".", "in", "(", "params", ")", ";", "}", "</s>"]
["<s>", "private", "org", ".", "fest", ".", "reflect", ".", "field", ".", "Invoker", "<", "String", ">", "getGroupIdField", "(", "Params", "params", ")", "{", "return", "Reflection", ".", "field", "(", "\"", "<STR_LIT>", "\"", ")", ".", "ofType", "(", "String", ".", "class", ")", ".", "in", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSessionId", "(", ")", "throws", "Exception", "{", "long", "sessionId", "=", "(", "long", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT>", ")", ";", "JobQueue", "jobQueue", "=", "createNewJobQueueWithSessionId", "(", "sessionId", ")", ";", "JobHolder", "jobHolder", "=", "createNewJobHolder", "(", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder", ")", ";", "jobHolder", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "new", "TestConstraint", "(", "mockTimer", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobHolder", ".", "getRunningSessionId", "(", ")", ",", "equalTo", "(", "sessionId", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPriorityWithReAdd", "(", ")", "throws", "Exception", "{", "int", "JOB_LIMIT", "=", "<NUM_LIT:20>", ";", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "JOB_LIMIT", ";", "i", "+", "+", ")", "{", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "}", "int", "minPriority", "=", "Integer", ".", "MAX_VALUE", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "JOB_LIMIT", ";", "i", "+", "+", ")", "{", "JobHolder", "holder", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "new", "TestConstraint", "(", "mockTimer", ")", ")", ";", "assertThat", "(", "holder", ".", "getPriority", "(", ")", "<", "=", "minPriority", ",", "is", "(", "true", ")", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "holder", ")", ";", "}", "assertThat", "(", "jobQueue", ".", "nextJobAndIncRunCount", "(", "new", "TestConstraint", "(", "mockTimer", ")", ")", ",", "notNullValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemove", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder", "=", "createNewJobHolder", "(", ")", ";", "jobQueue", ".", "insert", "(", "holder", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ".", "getId", "(", ")", ",", "equalTo", "(", "holder", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "jobQueue", ".", "remove", "(", "holder", ")", ";", "assertThat", "(", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNetwork", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "jobHolder", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "notNullValue", "(", ")", ")", ";", "jobQueue", ".", "remove", "(", "jobHolder", ")", ";", "jobHolder", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "jobQueue", ".", "remove", "(", "jobHolder", ")", ";", "jobHolder", "=", "createNewJobHolder", "(", "new", "Params", "(", "1", ")", ")", ";", "JobHolder", "jobHolder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ".", "requireNetwork", "(", ")", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder2", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "JobHolder", "retrieved", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ",", "notNullValue", "(", ")", ")", ";", "if", "(", "retrieved", "!", "=", "null", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder", ".", "getId", "(", ")", ")", ")", ";", "}", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ",", "nullValue", "(", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "retrieved", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ",", "notNullValue", "(", ")", ")", ";", "if", "(", "retrieved", "!", "=", "null", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder2", ".", "getId", "(", ")", ")", ")", ";", "}", "jobQueue", ".", "insertOrReplace", "(", "jobHolder", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "jobHolder2", ")", ";", "retrieved", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ",", "notNullValue", "(", ")", ")", ";", "if", "(", "retrieved", "!", "=", "null", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder2", ".", "getId", "(", ")", ")", ")", ";", "}", "jobQueue", ".", "insertOrReplace", "(", "jobHolder2", ")", ";", "JobHolder", "highestPriorityJob", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:10>", ")", ")", ";", "jobQueue", ".", "insert", "(", "highestPriorityJob", ")", ";", "retrieved", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ",", "notNullValue", "(", ")", ")", ";", "if", "(", "retrieved", "!", "=", "null", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "retrieved", ".", "getId", "(", ")", ",", "equalTo", "(", "highestPriorityJob", ".", "getId", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCountReadyJobs", "(", ")", "throws", "Exception", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "0", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "requireNetwork", "(", ")", ")", ")", ";", "long", "now", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "long", "delay", "=", "<NUM_LIT:1000>", ";", "constraint", ".", "setTimeLimit", "(", "now", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ",", "now", "+", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "delay", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "1", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "delay", "+", "1", ")", ";", "constraint", ".", "setTimeLimit", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:3>", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:5>", ")", ".", "groupBy", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:4>", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:3>", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:4>", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "groupBy", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "constraint", ".", "clear", "(", ")", ";", "constraint", ".", "setTimeLimit", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:5>", ")", ")", ";", "now", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "groupBy", "(", "\"", "<STR_LIT:3>", "\"", ")", ",", "now", "+", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "delay", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:5>", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:3>", ")", ".", "groupBy", "(", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:6>", ")", ")", ";", "mockTimer", ".", "incrementMs", "(", "delay", ")", ";", "constraint", ".", "setTimeLimit", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:6>", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:4>", ")", ")", ";", "now", "=", "mockTimer", ".", "nanoTime", "(", ")", ";", "constraint", ".", "setTimeLimit", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT:10>", "\"", ")", ",", "now", "+", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:10>", "\"", ")", ",", "now", "+", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ".", "groupBy", "(", "\"", "<STR_LIT:10>", "\"", ")", ",", "now", "-", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolderWithDelayUntil", "(", "new", "Params", "(", "0", ")", ".", "groupBy", "(", "\"", "<STR_LIT:10>", "\"", ")", ",", "now", "-", "<NUM_LIT:1000>", ")", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:5>", ")", ")", ";", "constraint", ".", "clear", "(", ")", ";", "constraint", ".", "setExcludeRunning", "(", "true", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:7>", ")", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "constraint", ".", "setExcludeGroups", "(", "Arrays", ".", "asList", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", "}", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "countReadyJobs", "(", "constraint", ")", ",", "equalTo", "(", "<NUM_LIT:4>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testJobFields", "(", ")", "throws", "Exception", "{", "long", "sessionId", "=", "(", "long", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:1000>", ")", ";", "JobQueue", "jobQueue", "=", "createNewJobQueueWithSessionId", "(", "sessionId", ")", ";", "JobHolder", "jobHolder", "=", "createNewJobHolder", "(", ")", ";", "int", "priority", "=", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:1000>", ")", ";", "jobHolder", ".", "setPriority", "(", "priority", ")", ";", "DummyJob", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", ";", "dummyJob", ".", "seal", "(", "mockTimer", ")", ";", "jobHolder", ".", "setJob", "(", "dummyJob", ")", ";", "int", "runCount", "=", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT:10>", ")", ";", "jobHolder", ".", "setRunCount", "(", "runCount", ")", ";", "jobQueue", ".", "insert", "(", "jobHolder", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:2>", ";", "i", "+", "+", ")", "{", "JobHolder", "received", "=", "jobQueue", ".", "nextJobAndIncRunCount", "(", "new", "TestConstraint", "(", "mockTimer", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received", ".", "getId", "(", ")", ",", "equalTo", "(", "jobHolder", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received", ".", "getPriority", "(", ")", ",", "equalTo", "(", "priority", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received", ".", "getRunningSessionId", "(", ")", ",", "equalTo", "(", "sessionId", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "received", ".", "getRunCount", "(", ")", ",", "equalTo", "(", "runCount", "+", "i", "+", "1", ")", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "received", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "assertJob", "(", "JobQueue", "jobQueue", ",", "String", "msg", ",", "String", "id", ",", "JobHolder", "holder", ")", "{", "if", "(", "holder", "=", "=", "null", ")", "{", "assertThat", "(", "msg", ",", "jobQueue", ".", "findJobById", "(", "id", ")", ",", "nullValue", "(", ")", ")", ";", "return", ";", "}", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobById", "(", "id", ")", ",", "notNullValue", "(", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobById", "(", "id", ")", ".", "getId", "(", ")", ",", "is", "(", "holder", ".", "getId", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFindJobHolderById", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "assertJob", "(", "jobQueue", ",", "\"", "<STR_LIT>", "\"", ",", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ",", "null", ")", ";", "final", "int", "LIMIT", "=", "<NUM_LIT:100>", ";", "JobHolder", "[", "]", "holders", "=", "new", "JobHolder", "[", "LIMIT", "]", ";", "String", "[", "]", "ids", "=", "new", "String", "[", "LIMIT", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "LIMIT", ";", "i", "+", "+", ")", "{", "holders", "[", "i", "]", "=", "createNewJobHolder", "(", "new", "Params", "(", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "<NUM_LIT>", ")", ")", ".", "setPersistent", "(", "Math", ".", "random", "(", ")", "<", "<NUM_LIT>", ")", ".", "setRequiresNetwork", "(", "Math", ".", "random", "(", ")", "<", "<NUM_LIT>", ")", ")", ";", "ids", "[", "i", "]", "=", "holders", "[", "i", "]", ".", "getId", "(", ")", ";", "jobQueue", ".", "insert", "(", "holders", "[", "i", "]", ")", ";", "assertJob", "(", "jobQueue", ",", "\"", "<STR_LIT>", "\"", ",", "ids", "[", "i", "]", ",", "holders", "[", "i", "]", ")", ";", "}", "final", "int", "REMOVE_CNT", "=", "LIMIT", "/", "<NUM_LIT:2>", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "REMOVE_CNT", ";", "i", "+", "+", ")", "{", "int", "ind", "=", "(", "int", ")", "(", "Math", ".", "random", "(", ")", "*", "LIMIT", ")", ";", "if", "(", "holders", "[", "ind", "]", "=", "=", "null", ")", "{", "continue", ";", "}", "jobQueue", ".", "remove", "(", "holders", "[", "ind", "]", ")", ";", "holders", "[", "ind", "]", "=", "null", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "LIMIT", ";", "i", "+", "+", ")", "{", "if", "(", "holders", "[", "i", "]", "!", "=", "null", ")", "{", "assertJob", "(", "jobQueue", ",", "\"", "<STR_LIT>", "\"", ",", "ids", "[", "i", "]", ",", "holders", "[", "i", "]", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "holders", "[", "i", "]", ")", ";", "assertJob", "(", "jobQueue", ",", "\"", "<STR_LIT>", "\"", ",", "ids", "[", "i", "]", ",", "holders", "[", "i", "]", ")", ";", "}", "else", "{", "assertJob", "(", "jobQueue", ",", "\"", "<STR_LIT>", "\"", ",", "ids", "[", "i", "]", ",", "null", ")", ";", "}", "}", "jobQueue", ".", "clear", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "LIMIT", ";", "i", "+", "+", ")", "{", "assertJob", "(", "jobQueue", ",", "\"", "<STR_LIT>", "\"", ",", "ids", "[", "i", "]", ",", "null", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testTagsWithMultipleHolders", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "final", "String", "tag1", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "String", "tag2", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "while", "(", "tag2", ".", "equals", "(", "tag1", ")", ")", "{", "tag2", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "}", "String", "tag3", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "while", "(", "tag3", ".", "equals", "(", "tag1", ")", "|", "|", "tag3", ".", "equals", "(", "tag2", ")", ")", "{", "tag3", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "}", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "tag1", ",", "tag2", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "tag1", ",", "tag3", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "Set", "<", "JobHolder", ">", "twoJobs", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag1", ")", ")", ";", "Set", "<", "String", ">", "resultIds", "=", "ids", "(", "twoJobs", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "twoJobs", ".", "size", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "resultIds", ",", "hasItems", "(", "holder1", ".", "getId", "(", ")", ",", "holder2", ".", "getId", "(", ")", ")", ")", ";", "for", "(", "String", "tag", ":", "new", "String", "[", "]", "{", "tag2", ",", "tag3", "}", ")", "{", "Set", "<", "JobHolder", ">", "oneJob", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag", ")", ")", ";", "resultIds", "=", "ids", "(", "oneJob", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "oneJob", ".", "size", "(", ")", ",", "is", "(", "1", ")", ")", ";", "if", "(", "tag", ".", "equals", "(", "tag2", ")", ")", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "resultIds", ",", "hasItems", "(", "holder1", ".", "getId", "(", ")", ")", ")", ";", "}", "else", "{", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "resultIds", ",", "hasItems", "(", "holder2", ".", "getId", "(", ")", ")", ")", ";", "}", "}", "jobQueue", ".", "remove", "(", "holder1", ")", ";", "assertTags", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ",", "holder2", ")", ";", "}", "</s>"]
["<s>", "private", "Set", "<", "String", ">", "ids", "(", "Collection", "<", "JobHolder", ">", "result", ")", "{", "HashSet", "<", "String", ">", "ids", "=", "new", "HashSet", "<", ">", "(", ")", ";", "for", "(", "JobHolder", "holder", ":", "result", ")", "{", "ids", ".", "add", "(", "holder", ".", "getId", "(", ")", ")", ";", "}", "return", "ids", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFindByMultipleTags", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "final", "String", "tag1", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "String", "tag2", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "while", "(", "tag2", ".", "equals", "(", "tag1", ")", ")", "{", "tag2", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "}", "JobHolder", "holder", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "tag1", ",", "tag2", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder", ")", ";", "assertTags", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ",", "holder", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "holder", ")", ";", "assertTags", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ",", "holder", ")", ";", "jobQueue", ".", "remove", "(", "holder", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag1", ")", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag2", ")", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFindByTags", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "jobQueue", ".", "insert", "(", "createNewJobHolder", "(", ")", ")", ";", "Set", "<", "JobHolder", ">", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "final", "String", "tag1", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "JobHolder", "holder", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "tag1", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder", ")", ";", "assertTags", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ",", "holder", ")", ";", "jobQueue", ".", "insertOrReplace", "(", "holder", ")", ";", "assertTags", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ",", "holder", ")", ";", "jobQueue", ".", "remove", "(", "holder", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag1", ")", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ".", "addTags", "(", "tag1", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag1", ")", ")", ".", "size", "(", ")", ",", "is", "(", "1", ")", ")", ";", "jobQueue", ".", "onJobCancelled", "(", "holder2", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tag1", ")", ")", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirement", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirement2", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirement3", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirement4", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirement5", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirementAndRegularDelayedJob", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirementAndRegularDelayedJob2", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirementAndRegularDelayedJob3", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithNetworkRequirementAndRegularDelayedJob4", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirement", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirement2", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirement3", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirement4", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "false", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirement5", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "false", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirementAndRegularDelayedJob", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirementAndRegularDelayedJob2", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT:1000>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirementAndRegularDelayedJob3", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredNetworkRequirementAndRegularDelayedJob4", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder1", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT>", ")", ")", ";", "JobHolder", "holder2", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "delayInMs", "(", "<NUM_LIT:1000>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder2", ")", ";", "jobQueue", ".", "insert", "(", "holder1", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredAndNetworkRequirements", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "true", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelayUntilWithUnmeteredAndNetworkRequirements2", "(", ")", "{", "JobQueue", "jobQueue", "=", "createNewJobQueue", "(", ")", ";", "JobHolder", "holder", "=", "createNewJobHolder", "(", "new", "Params", "(", "<NUM_LIT:2>", ")", ".", "requireUnmeteredNetworkWithTimeout", "(", "<NUM_LIT>", ")", ".", "requireNetworkWithTimeout", "(", "<NUM_LIT>", ")", ")", ";", "jobQueue", ".", "insert", "(", "holder", ")", ";", "TestConstraint", "constraint", "=", "new", "TestConstraint", "(", "mockTimer", ")", ";", "constraint", ".", "setShouldNotRequireUnmeteredNetwork", "(", "true", ")", ";", "constraint", ".", "setShouldNotRequireNetwork", "(", "false", ")", ";", "assertThat", "(", "jobQueue", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertTags", "(", "String", "msg", ",", "JobQueue", "jobQueue", ",", "JobHolder", "holder", ")", "{", "Set", "<", "JobHolder", ">", "result", ";", "String", "wrongTag", ";", "final", "String", "id", "=", "holder", ".", "getId", "(", ")", ";", "boolean", "found", ";", "Matcher", "allTagsMatcher", "=", "CoreMatchers", ".", "hasItems", "(", "holder", ".", "getTags", "(", ")", ".", "toArray", "(", "new", "String", "[", "holder", ".", "getTags", "(", ")", ".", "size", "(", ")", "]", ")", ")", ";", "do", "{", "wrongTag", "=", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ";", "found", "=", "false", ";", "if", "(", "holder", ".", "getTags", "(", ")", "!", "=", "null", ")", "{", "for", "(", "String", "tag", ":", "holder", ".", "getTags", "(", ")", ")", "{", "if", "(", "tag", ".", "equals", "(", "wrongTag", ")", ")", "{", "found", "=", "true", ";", "break", ";", "}", "}", "}", "}", "while", "(", "found", ")", ";", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "wrongTag", ")", ")", ";", "found", "=", "false", ";", "for", "(", "JobHolder", "received", ":", "result", ")", "{", "if", "(", "received", ".", "getId", "(", ")", ".", "equals", "(", "holder", ".", "getId", "(", ")", ")", ")", "{", "found", "=", "true", ";", "}", "}", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "found", ",", "is", "(", "false", ")", ")", ";", "if", "(", "holder", ".", "getTags", "(", ")", "=", "=", "null", ")", "{", "return", ";", "}", "Collection", "<", "String", ">", "exclude", "=", "Arrays", ".", "asList", "(", "holder", ".", "getId", "(", ")", ")", ";", "for", "(", "String", "[", "]", "tags", ":", "combinations", "(", "holder", ".", "getTags", "(", ")", ")", ")", "{", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "TagConstraint", ".", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tags", ")", ")", ";", "if", "(", "tags", ".", "length", "=", "=", "0", ")", "{", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "else", "{", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getId", "(", ")", ",", "is", "(", "id", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getTags", "(", ")", ",", "allTagsMatcher", ")", ";", "}", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "TagConstraint", ".", "ANY", ",", "exclude", ",", "tags", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "for", "(", "String", "[", "]", "tags", ":", "combinations", "(", "holder", ".", "getTags", "(", ")", ")", ")", "{", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ALL", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tags", ")", ")", ";", "if", "(", "tags", ".", "length", "=", "=", "0", ")", "{", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "else", "{", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getId", "(", ")", ",", "is", "(", "id", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getTags", "(", ")", ",", "allTagsMatcher", ")", ";", "}", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ALL", ",", "exclude", ",", "tags", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "for", "(", "String", "[", "]", "tags", ":", "combinations", "(", "holder", ".", "getTags", "(", ")", ")", ")", "{", "String", "[", "]", "tagsWithAdditional", "=", "new", "String", "[", "tags", ".", "length", "+", "1", "]", ";", "System", ".", "arraycopy", "(", "tags", ",", "0", ",", "tagsWithAdditional", ",", "0", ",", "tags", ".", "length", ")", ";", "tagsWithAdditional", "[", "tags", ".", "length", "]", "=", "wrongTag", ";", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "TagConstraint", ".", "ANY", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tagsWithAdditional", ")", ")", ";", "if", "(", "tags", ".", "length", "=", "=", "0", ")", "{", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "else", "{", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getId", "(", ")", ",", "is", "(", "id", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getTags", "(", ")", ",", "allTagsMatcher", ")", ";", "}", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ALL", ",", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ",", "tagsWithAdditional", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "result", "=", "jobQueue", ".", "findJobs", "(", "forTags", "(", "mockTimer", ",", "ALL", ",", "exclude", ",", "tagsWithAdditional", ")", ")", ";", "assertThat", "(", "msg", "+", "\"", "<STR_LIT>", "\"", ",", "result", ".", "size", "(", ")", ",", "is", "(", "0", ")", ")", ";", "}", "}", "</s>"]
["<s>", "List", "<", "String", "[", "]", ">", "combinations", "(", "Set", "<", "String", ">", "strings", ")", "{", "if", "(", "strings", ".", "size", "(", ")", "=", "=", "0", ")", "{", "List", "<", "String", "[", "]", ">", "result", "=", "new", "ArrayList", "<", "String", "[", "]", ">", "(", ")", ";", "result", ".", "add", "(", "new", "String", "[", "]", "{", "}", ")", ";", "return", "result", ";", "}", "Set", "<", "String", ">", "remaining", "=", "new", "HashSet", "<", "String", ">", "(", ")", ";", "boolean", "skip", "=", "true", ";", "for", "(", "String", "str", ":", "strings", ")", "{", "if", "(", "skip", ")", "{", "skip", "=", "false", ";", "}", "else", "{", "remaining", ".", "add", "(", "str", ")", ";", "}", "}", "List", "<", "String", "[", "]", ">", "others", "=", "combinations", "(", "remaining", ")", ";", "List", "<", "String", "[", "]", ">", "result", "=", "new", "ArrayList", "<", "String", "[", "]", ">", "(", ")", ";", "for", "(", "String", "[", "]", "subset", ":", "others", ")", "{", "result", ".", "add", "(", "subset", ")", ";", "String", "[", "]", "copy", "=", "new", "String", "[", "subset", ".", "length", "+", "1", "]", ";", "copy", "[", "0", "]", "=", "strings", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "for", "(", "int", "i", "=", "1", ";", "i", "<", "=", "subset", ".", "length", ";", "i", "+", "+", ")", "{", "copy", "[", "i", "]", "=", "subset", "[", "i", "-", "1", "]", ";", "}", "result", ".", "add", "(", "copy", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "createNewJobHolder", "(", ")", "{", "return", "createNewJobHolder", "(", "new", "Params", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "JobHolder", "createNewJobHolder", "(", "Params", "params", ")", "{", "long", "delay", "=", "getDelayMsField", "(", "params", ")", ".", "get", "(", ")", ";", "DummyJob", "job", "=", "new", "DummyJob", "(", "params", ")", ";", "job", ".", "seal", "(", "mockTimer", ")", ";", "return", "new", "JobHolder", ".", "Builder", "(", ")", ".", "priority", "(", "getPriorityField", "(", "params", ")", ".", "get", "(", ")", ")", ".", "groupId", "(", "getGroupIdField", "(", "params", ")", ".", "get", "(", ")", ")", ".", "runCount", "(", "0", ")", ".", "job", "(", "job", ")", ".", "createdNs", "(", "mockTimer", ".", "nanoTime", "(", ")", ")", ".", "delayUntilNs", "(", "delay", ">", "0", "?", "mockTimer", ".", "nanoTime", "(", ")", "+", "delay", "*", "JobManager", ".", "NS_PER_MS", ":", "JobManager", ".", "NOT_DELAYED_JOB_DELAY", ")", ".", "runningSessionId", "(", "JobManager", ".", "NOT_RUNNING_SESSION_ID", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "JobHolder", "createNewJobHolderWithDelayUntil", "(", "Params", "params", ",", "long", "delayUntil", ")", "{", "JobHolder", "jobHolder", "=", "createNewJobHolder", "(", "params", ")", ";", "getDelayUntilNsField", "(", "jobHolder", ")", ".", "set", "(", "delayUntil", ")", ";", "return", "jobHolder", ";", "}", "</s>"]
["<s>", "protected", "JobQueue", "createNewJobQueue", "(", ")", "{", "return", "createNewJobQueueWithSessionId", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "private", "JobQueue", "createNewJobQueueWithSessionId", "(", "Long", "sessionId", ")", "{", "return", "currentFactory", ".", "createNew", "(", "sessionId", ",", "\"", "<STR_LIT:_>", "\"", "+", "sessionId", ",", "mockTimer", ")", ";", "}", "</s>"]
["<s>", "public", "JobManager2", "(", "Configuration", "configuration", ")", "{", "messageFactory", "=", "new", "MessageFactory", "(", ")", ";", "messageQueue", "=", "new", "PriorityMessageQueue", "(", "configuration", ".", "getTimer", "(", ")", ",", "messageFactory", ")", ";", "jobManagerThread", "=", "new", "JobManagerThread", "(", "configuration", ",", "messageQueue", ",", "messageFactory", ")", ";", "chefThread", "=", "new", "Thread", "(", "jobManagerThread", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "configuration", ".", "getScheduler", "(", ")", "!", "=", "null", ")", "{", "Scheduler", ".", "Callback", "callback", "=", "createSchedulerCallback", "(", ")", ";", "configuration", ".", "getScheduler", "(", ")", ".", "init", "(", "configuration", ".", "getAppContext", "(", ")", ",", "callback", ")", ";", "}", "chefThread", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Scheduler", ".", "Callback", "createSchedulerCallback", "(", ")", "{", "return", "new", "Scheduler", ".", "Callback", "(", ")", "{", "@", "Override", "public", "boolean", "start", "(", "SchedulerConstraint", "constraint", ")", "{", "dispatchSchedulerStart", "(", "constraint", ")", ";", "return", "true", ";", "}", "@", "Override", "public", "boolean", "stop", "(", "SchedulerConstraint", "constraint", ")", "{", "return", "dispatchSchedulerStop", "(", "constraint", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "start", "(", "SchedulerConstraint", "constraint", ")", "{", "dispatchSchedulerStart", "(", "constraint", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "stop", "(", "SchedulerConstraint", "constraint", ")", "{", "return", "dispatchSchedulerStop", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "private", "void", "dispatchSchedulerStart", "(", "SchedulerConstraint", "constraint", ")", "{", "SchedulerMessage", "message", "=", "messageFactory", ".", "obtain", "(", "SchedulerMessage", ".", "class", ")", ";", "message", ".", "set", "(", "SchedulerMessage", ".", "START", ",", "constraint", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "dispatchSchedulerStop", "(", "SchedulerConstraint", "constraint", ")", "{", "SchedulerMessage", "message", "=", "messageFactory", ".", "obtain", "(", "SchedulerMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "START", ",", "constraint", ")", ";", "Integer", "result", "=", "new", "IntQueryFuture", "<", ">", "(", "messageQueue", ",", "message", ")", ".", "getSafe", "(", ")", ";", "return", "result", "!", "=", "null", "&", "&", "result", "=", "=", "1", ";", "}", "</s>"]
["<s>", "public", "void", "start", "(", ")", "{", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "START", ",", "null", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "void", "stop", "(", ")", "{", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "STOP", ",", "null", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getActiveConsumerCount", "(", ")", "{", "assertNotInMainThread", "(", ")", ";", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "ACTIVE_CONSUMER_COUNT", ",", "null", ")", ";", "return", "new", "IntQueryFuture", "<", ">", "(", "messageQueue", ",", "message", ")", ".", "getSafe", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "destroy", "(", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "stopAndWaitUntilConsumersAreFinished", "(", ")", ";", "CommandMessage", "message", "=", "messageFactory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "message", ".", "set", "(", "CommandMessage", ".", "QUIT", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "jobManagerThread", ".", "callbackManager", ".", "destroy", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "stopAndWaitUntilConsumersAreFinished", "(", ")", "{", "waitUntilConsumersAreFinished", "(", "true", ")", ";", "}", "</s>"]
["<s>", "public", "void", "waitUntilConsumersAreFinished", "(", ")", "{", "waitUntilConsumersAreFinished", "(", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "waitUntilConsumersAreFinished", "(", "boolean", "stop", ")", "{", "assertNotInMainThread", "(", ")", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManagerThread", ".", "consumerManager", ".", "addNoConsumersListener", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "latch", ".", "countDown", "(", ")", ";", "jobManagerThread", ".", "consumerManager", ".", "removeNoConsumersListener", "(", "this", ")", ";", "}", "}", ")", ";", "if", "(", "stop", ")", "{", "stop", "(", ")", ";", "}", "if", "(", "jobManagerThread", ".", "consumerManager", ".", "getWorkerCount", "(", ")", "=", "=", "0", ")", "{", "return", ";", "}", "try", "{", "latch", ".", "await", "(", ")", ";", "}", "catch", "(", "InterruptedException", "ignored", ")", "{", "}", "PublicQueryMessage", "pm", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "pm", ".", "set", "(", "PublicQueryMessage", ".", "CLEAR", ",", "null", ")", ";", "new", "IntQueryFuture", "<", ">", "(", "jobManagerThread", ".", "callbackManager", ".", "messageQueue", ",", "pm", ")", ".", "getSafe", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "latch", ".", "countDown", "(", ")", ";", "jobManagerThread", ".", "consumerManager", ".", "removeNoConsumersListener", "(", "this", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addJobInBackground", "(", "Job", "job", ")", "{", "AddJobMessage", "message", "=", "messageFactory", ".", "obtain", "(", "AddJobMessage", ".", "class", ")", ";", "message", ".", "setJob", "(", "job", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "void", "cancelJobsInBackground", "(", "final", "CancelResult", ".", "AsyncCancelCallback", "cancelCallback", ",", "final", "TagConstraint", "constraint", ",", "final", "String", ".", ".", ".", "tags", ")", "{", "if", "(", "constraint", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "CancelMessage", "message", "=", "messageFactory", ".", "obtain", "(", "CancelMessage", ".", "class", ")", ";", "message", ".", "setCallback", "(", "cancelCallback", ")", ";", "message", ".", "setConstraint", "(", "constraint", ")", ";", "message", ".", "setTags", "(", "tags", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addCallback", "(", "JobManagerCallback", "callback", ")", "{", "jobManagerThread", ".", "addCallback", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "removeCallback", "(", "JobManagerCallback", "callback", ")", "{", "return", "jobManagerThread", ".", "removeCallback", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addJob", "(", "Job", "job", ")", "{", "assertNotInMainThread", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:.>", "\"", ")", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "String", "uuid", "=", "job", ".", "getId", "(", ")", ";", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onJobAdded", "(", "Job", "job", ")", "{", "if", "(", "uuid", ".", "equals", "(", "job", ".", "getId", "(", ")", ")", ")", "{", "latch", ".", "countDown", "(", ")", ";", "removeCallback", "(", "this", ")", ";", "}", "}", "}", ")", ";", "addJobInBackground", "(", "job", ")", ";", "try", "{", "latch", ".", "await", "(", ")", ";", "}", "catch", "(", "InterruptedException", "ignored", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobAdded", "(", "Job", "job", ")", "{", "if", "(", "uuid", ".", "equals", "(", "job", ".", "getId", "(", ")", ")", ")", "{", "latch", ".", "countDown", "(", ")", ";", "removeCallback", "(", "this", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "addJobInBackground", "(", "Job", "job", ",", "final", "AsyncAddCallback", "callback", ")", "{", "if", "(", "callback", "=", "=", "null", ")", "{", "addJobInBackground", "(", "job", ")", ";", "return", ";", "}", "final", "String", "uuid", "=", "job", ".", "getId", "(", ")", ";", "addCallback", "(", "new", "JobManagerCallbackAdapter", "(", ")", "{", "@", "Override", "public", "void", "onJobAdded", "(", "Job", "job", ")", "{", "if", "(", "uuid", ".", "equals", "(", "job", ".", "getId", "(", ")", ")", ")", "{", "try", "{", "callback", ".", "onAdded", "(", ")", ";", "}", "finally", "{", "removeCallback", "(", "this", ")", ";", "}", "}", "}", "}", ")", ";", "addJobInBackground", "(", "job", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobAdded", "(", "Job", "job", ")", "{", "if", "(", "uuid", ".", "equals", "(", "job", ".", "getId", "(", ")", ")", ")", "{", "try", "{", "callback", ".", "onAdded", "(", ")", ";", "}", "finally", "{", "removeCallback", "(", "this", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "CancelResult", "cancelJobs", "(", "TagConstraint", "constraint", ",", "String", ".", ".", ".", "tags", ")", "{", "assertNotInMainThread", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "constraint", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "CancelResult", "[", "]", "result", "=", "new", "CancelResult", "[", "1", "]", ";", "CancelResult", ".", "AsyncCancelCallback", "myCallback", "=", "new", "CancelResult", ".", "AsyncCancelCallback", "(", ")", "{", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "latch", ".", "countDown", "(", ")", ";", "}", "}", ";", "CancelMessage", "message", "=", "messageFactory", ".", "obtain", "(", "CancelMessage", ".", "class", ")", ";", "message", ".", "setConstraint", "(", "constraint", ")", ";", "message", ".", "setTags", "(", "tags", ")", ";", "message", ".", "setCallback", "(", "myCallback", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "try", "{", "latch", ".", "await", "(", ")", ";", "}", "catch", "(", "InterruptedException", "ignored", ")", "{", "}", "return", "result", "[", "0", "]", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", "{", "result", "[", "0", "]", "=", "cancelResult", ";", "latch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "count", "(", ")", "{", "assertNotInMainThread", "(", ")", ";", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "COUNT", ",", "null", ")", ";", "return", "new", "IntQueryFuture", "<", ">", "(", "messageQueue", ",", "message", ")", ".", "getSafe", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "countReadyJobs", "(", ")", "{", "assertNotInMainThread", "(", ")", ";", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "COUNT_READY", ",", "null", ")", ";", "return", "new", "IntQueryFuture", "<", ">", "(", "messageQueue", ",", "message", ")", ".", "getSafe", "(", ")", ";", "}", "</s>"]
["<s>", "public", "JobStatus", "getJobStatus", "(", "String", "id", ")", "{", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "JOB_STATUS", ",", "id", ",", "null", ")", ";", "Integer", "status", "=", "new", "IntQueryFuture", "<", ">", "(", "messageQueue", ",", "message", ")", ".", "getSafe", "(", ")", ";", "return", "JobStatus", ".", "values", "(", ")", "[", "status", "]", ";", "}", "</s>"]
["<s>", "public", "void", "clear", "(", ")", "{", "final", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "CLEAR", ",", "null", ")", ";", "new", "IntQueryFuture", "<", ">", "(", "messageQueue", ",", "message", ")", ".", "getSafe", "(", ")", ";", "}", "</s>"]
["<s>", "void", "internalRunInJobManagerThread", "(", "final", "Runnable", "runnable", ")", "throws", "Throwable", "{", "final", "Throwable", "[", "]", "error", "=", "new", "Throwable", "[", "1", "]", ";", "final", "PublicQueryMessage", "message", "=", "messageFactory", ".", "obtain", "(", "PublicQueryMessage", ".", "class", ")", ";", "message", ".", "set", "(", "PublicQueryMessage", ".", "INTERNAL_RUNNABLE", ",", "null", ")", ";", "new", "IntQueryFuture", "<", "PublicQueryMessage", ">", "(", "messageQueue", ",", "message", ")", "{", "@", "Override", "public", "void", "onResult", "(", "int", "result", ")", "{", "try", "{", "runnable", ".", "run", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "error", "[", "0", "]", "=", "t", ";", "}", "super", ".", "onResult", "(", "result", ")", ";", "}", "}", ".", "getSafe", "(", ")", ";", "if", "(", "error", "[", "0", "]", "!", "=", "null", ")", "{", "throw", "error", "[", "0", "]", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onResult", "(", "int", "result", ")", "{", "try", "{", "runnable", ".", "run", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "error", "[", "0", "]", "=", "t", ";", "}", "super", ".", "onResult", "(", "result", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertNotInMainThread", "(", ")", "{", "assertNotInMainThread", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertNotInMainThread", "(", "String", "message", ")", "{", "if", "(", "Looper", ".", "getMainLooper", "(", ")", ".", "getThread", "(", ")", "=", "=", "Thread", ".", "currentThread", "(", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "message", ")", ";", "}", "}", "</s>"]
["<s>", "public", "IntQueryFuture", "(", "MessageQueue", "messageQueue", ",", "T", "message", ")", "{", "this", ".", "messageQueue", "=", "messageQueue", ";", "this", ".", "message", "=", "message", ";", "message", ".", "setCallback", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "cancel", "(", "boolean", "mayInterruptIfRunning", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isCancelled", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDone", "(", ")", "{", "return", "latch", ".", "getCount", "(", ")", "=", "=", "0", ";", "}", "</s>"]
["<s>", "public", "Integer", "getSafe", "(", ")", "{", "try", "{", "return", "get", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Integer", "get", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "messageQueue", ".", "post", "(", "message", ")", ";", "latch", ".", "await", "(", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Integer", "get", "(", "long", "timeout", ",", "@", "NonNull", "TimeUnit", "unit", ")", "throws", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "messageQueue", ".", "post", "(", "message", ")", ";", "latch", ".", "await", "(", "timeout", ",", "unit", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onResult", "(", "int", "result", ")", "{", "this", ".", "result", "=", "result", ";", "latch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "JobQueue", "createPersistentQueue", "(", "Configuration", "configuration", ",", "long", "sessionId", ")", ";", "</s>"]
["<s>", "JobQueue", "createNonPersistent", "(", "Configuration", "configuration", ",", "long", "sessionId", ")", ";", "</s>"]
["<s>", "CancelHandler", "(", "TagConstraint", "constraint", ",", "String", "[", "]", "tags", ",", "CancelResult", ".", "AsyncCancelCallback", "callback", ")", "{", "this", ".", "tagConstraint", "=", "constraint", ";", "this", ".", "tags", "=", "tags", ";", "cancelled", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "failedToCancel", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "this", ".", "callback", "=", "callback", ";", "}", "</s>"]
["<s>", "void", "query", "(", "JobManagerThread", "jobManagerThread", ",", "ConsumerManager", "consumerManager", ")", "{", "running", "=", "consumerManager", ".", "markJobsCancelled", "(", "tagConstraint", ",", "tags", ")", ";", "Constraint", "queryConstraint", "=", "jobManagerThread", ".", "queryConstraint", ";", "queryConstraint", ".", "clear", "(", ")", ";", "queryConstraint", ".", "setNowInNs", "(", "jobManagerThread", ".", "timer", ".", "nanoTime", "(", ")", ")", ";", "queryConstraint", ".", "setTagConstraint", "(", "tagConstraint", ")", ";", "queryConstraint", ".", "setExcludeJobIds", "(", "running", ")", ";", "queryConstraint", ".", "setTags", "(", "tags", ")", ";", "queryConstraint", ".", "setExcludeRunning", "(", "true", ")", ";", "Set", "<", "JobHolder", ">", "nonPersistentInQueue", "=", "jobManagerThread", ".", "nonPersistentJobQueue", ".", "findJobs", "(", "queryConstraint", ")", ";", "Set", "<", "JobHolder", ">", "persistentInQueue", "=", "jobManagerThread", ".", "persistentJobQueue", ".", "findJobs", "(", "queryConstraint", ")", ";", "for", "(", "JobHolder", "nonPersistent", ":", "nonPersistentInQueue", ")", "{", "nonPersistent", ".", "markAsCancelled", "(", ")", ";", "cancelled", ".", "add", "(", "nonPersistent", ")", ";", "jobManagerThread", ".", "nonPersistentJobQueue", ".", "onJobCancelled", "(", "nonPersistent", ")", ";", "}", "for", "(", "JobHolder", "persistent", ":", "persistentInQueue", ")", "{", "persistent", ".", "markAsCancelled", "(", ")", ";", "cancelled", ".", "add", "(", "persistent", ")", ";", "jobManagerThread", ".", "persistentJobQueue", ".", "onJobCancelled", "(", "persistent", ")", ";", "}", "}", "</s>"]
["<s>", "void", "commit", "(", "JobManagerThread", "jobManagerThread", ")", "{", "for", "(", "JobHolder", "jobHolder", ":", "cancelled", ")", "{", "try", "{", "jobHolder", ".", "onCancel", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "jobHolder", ".", "getJob", "(", ")", ".", "isPersistent", "(", ")", ")", "{", "jobManagerThread", ".", "nonPersistentJobQueue", ".", "remove", "(", "jobHolder", ")", ";", "}", "}", "if", "(", "callback", "!", "=", "null", ")", "{", "Collection", "<", "Job", ">", "cancelledJobs", "=", "new", "ArrayList", "<", ">", "(", "cancelled", ".", "size", "(", ")", ")", ";", "Collection", "<", "Job", ">", "failedToCancelJobs", "=", "new", "ArrayList", "<", ">", "(", "failedToCancel", ".", "size", "(", ")", ")", ";", "for", "(", "JobHolder", "holder", ":", "cancelled", ")", "{", "cancelledJobs", ".", "add", "(", "holder", ".", "getJob", "(", ")", ")", ";", "}", "for", "(", "JobHolder", "holder", ":", "failedToCancel", ")", "{", "failedToCancelJobs", ".", "add", "(", "holder", ".", "getJob", "(", ")", ")", ";", "}", "CancelResult", "result", "=", "new", "CancelResult", "(", "cancelledJobs", ",", "failedToCancelJobs", ")", ";", "jobManagerThread", ".", "callbackManager", ".", "notifyCancelResult", "(", "result", ",", "callback", ")", ";", "}", "for", "(", "JobHolder", "jobHolder", ":", "cancelled", ")", "{", "jobManagerThread", ".", "callbackManager", ".", "notifyOnCancel", "(", "jobHolder", ".", "getJob", "(", ")", ",", "true", ")", ";", "}", "}", "</s>"]
["<s>", "void", "onJobRun", "(", "JobHolder", "holder", ",", "int", "resultCode", ")", "{", "final", "boolean", "exists", ";", "exists", "=", "running", ".", "remove", "(", "holder", ".", "getId", "(", ")", ")", ";", "if", "(", "exists", ")", "{", "if", "(", "resultCode", "=", "=", "JobHolder", ".", "RUN_RESULT_FAIL_FOR_CANCEL", ")", "{", "cancelled", ".", "add", "(", "holder", ")", ";", "}", "else", "{", "failedToCancel", ".", "add", "(", "holder", ")", ";", "}", "}", "}", "</s>"]
["<s>", "boolean", "isDone", "(", ")", "{", "return", "running", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "ConsumerManager", "(", "JobManagerThread", "jobManagerThread", ",", "Timer", "timer", ",", "MessageFactory", "factory", ",", "Configuration", "configuration", ")", "{", "this", ".", "jobManagerThread", "=", "jobManagerThread", ";", "this", ".", "timer", "=", "timer", ";", "this", ".", "factory", "=", "factory", ";", "this", ".", "loadFactor", "=", "configuration", ".", "getLoadFactor", "(", ")", ";", "this", ".", "minConsumerCount", "=", "configuration", ".", "getMinConsumerCount", "(", ")", ";", "this", ".", "maxConsumerCount", "=", "configuration", ".", "getMaxConsumerCount", "(", ")", ";", "this", ".", "consumerKeepAliveNs", "=", "configuration", ".", "getConsumerKeepAlive", "(", ")", "*", "<NUM_LIT:1000>", "*", "JobManagerThread", ".", "NS_PER_MS", ";", "runningJobHolders", "=", "new", "HashMap", "<", ">", "(", ")", ";", "runningJobGroups", "=", "new", "RunningJobSet", "(", "timer", ")", ";", "threadGroup", "=", "new", "ThreadGroup", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "void", "addNoConsumersListener", "(", "Runnable", "runnable", ")", "{", "internalZeroConsumersListeners", ".", "add", "(", "runnable", ")", ";", "}", "</s>"]
["<s>", "boolean", "removeNoConsumersListener", "(", "Runnable", "runnable", ")", "{", "return", "internalZeroConsumersListeners", ".", "remove", "(", "runnable", ")", ";", "}", "</s>"]
["<s>", "void", "onJobAdded", "(", ")", "{", "considerAddingConsumers", "(", "false", ")", ";", "}", "</s>"]
["<s>", "void", "handleConstraintChange", "(", ")", "{", "considerAddingConsumers", "(", "true", ")", ";", "}", "</s>"]
["<s>", "void", "handleStop", "(", ")", "{", "for", "(", "Consumer", "consumer", ":", "consumers", ")", "{", "SafeMessageQueue", "mq", "=", "consumer", ".", "messageQueue", ";", "CommandMessage", "command", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "command", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "mq", ".", "post", "(", "command", ")", ";", "}", "if", "(", "consumers", ".", "isEmpty", "(", ")", ")", "{", "for", "(", "Runnable", "runnable", ":", "internalZeroConsumersListeners", ")", "{", "runnable", ".", "run", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "considerAddingConsumers", "(", "boolean", "pokeAllWaiting", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "pokeAllWaiting", ",", "jobManagerThread", ".", "isRunning", "(", ")", ",", "waitingConsumers", ".", "size", "(", ")", ")", ";", "if", "(", "!", "jobManagerThread", ".", "isRunning", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "if", "(", "waitingConsumers", ".", "size", "(", ")", ">", "0", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "int", "i", "=", "waitingConsumers", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "Consumer", "consumer", "=", "waitingConsumers", ".", "remove", "(", "i", ")", ";", "CommandMessage", "command", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "command", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "consumer", ".", "messageQueue", ".", "post", "(", "command", ")", ";", "if", "(", "!", "pokeAllWaiting", ")", "{", "break", ";", "}", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "boolean", "isAboveLoadFactor", "=", "isAboveLoadFactor", "(", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "isAboveLoadFactor", ")", ";", "if", "(", "isAboveLoadFactor", ")", "{", "addWorker", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "addWorker", "(", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Consumer", "consumer", "=", "new", "Consumer", "(", "jobManagerThread", ".", "messageQueue", ",", "new", "SafeMessageQueue", "(", "timer", ",", "factory", ",", "\"", "<STR_LIT>", "\"", ")", ",", "factory", ",", "timer", ")", ";", "Thread", "thread", "=", "new", "Thread", "(", "threadGroup", ",", "consumer", ",", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "consumers", ".", "add", "(", "consumer", ")", ";", "thread", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isAboveLoadFactor", "(", ")", "{", "final", "int", "workerCount", "=", "consumers", ".", "size", "(", ")", ";", "if", "(", "workerCount", ">", "=", "maxConsumerCount", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "workerCount", ")", ";", "return", "false", ";", "}", "final", "int", "remainingJobs", "=", "jobManagerThread", ".", "countRemainingReadyJobs", "(", ")", ";", "final", "int", "runningHolders", "=", "runningJobHolders", ".", "size", "(", ")", ";", "boolean", "aboveLoadFactor", "=", "(", "workerCount", "*", "loadFactor", "<", "remainingJobs", "+", "runningHolders", ")", "|", "|", "(", "workerCount", "<", "minConsumerCount", "&", "&", "workerCount", "<", "remainingJobs", "+", "runningHolders", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "workerCount", ",", "minConsumerCount", ",", "maxConsumerCount", ",", "loadFactor", ",", "remainingJobs", ",", "runningHolders", ",", "aboveLoadFactor", ")", ";", "return", "aboveLoadFactor", ";", "}", "</s>"]
["<s>", "boolean", "handleIdle", "(", "JobConsumerIdleMessage", "message", ")", "{", "Consumer", "consumer", "=", "(", "Consumer", ")", "message", ".", "getWorker", "(", ")", ";", "if", "(", "consumer", ".", "hasJob", ")", "{", "return", "true", ";", "}", "JobHolder", "nextJob", "=", "null", ";", "final", "boolean", "running", "=", "jobManagerThread", ".", "isRunning", "(", ")", ";", "if", "(", "running", ")", "{", "nextJob", "=", "jobManagerThread", ".", "getNextJob", "(", "runningJobGroups", ".", "getSafe", "(", ")", ")", ";", "}", "if", "(", "nextJob", "!", "=", "null", ")", "{", "consumer", ".", "hasJob", "=", "true", ";", "runningJobGroups", ".", "add", "(", "nextJob", ".", "getGroupId", "(", ")", ")", ";", "RunJobMessage", "runJobMessage", "=", "factory", ".", "obtain", "(", "RunJobMessage", ".", "class", ")", ";", "runJobMessage", ".", "setJobHolder", "(", "nextJob", ")", ";", "runningJobHolders", ".", "put", "(", "nextJob", ".", "getJob", "(", ")", ".", "getId", "(", ")", ",", "nextJob", ")", ";", "if", "(", "nextJob", ".", "getGroupId", "(", ")", "!", "=", "null", ")", "{", "runningJobGroups", ".", "add", "(", "nextJob", ".", "getGroupId", "(", ")", ")", ";", "}", "consumer", ".", "messageQueue", ".", "post", "(", "runJobMessage", ")", ";", "return", "true", ";", "}", "else", "{", "long", "keepAliveTimeout", "=", "message", ".", "getLastJobCompleted", "(", ")", "+", "consumerKeepAliveNs", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "keepAliveTimeout", ")", ";", "final", "boolean", "tooMany", "=", "consumers", ".", "size", "(", ")", ">", "minConsumerCount", ";", "boolean", "kill", "=", "!", "running", "|", "|", "(", "tooMany", "&", "&", "keepAliveTimeout", "<", "timer", ".", "nanoTime", "(", ")", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "kill", ",", "running", ")", ";", "if", "(", "kill", ")", "{", "CommandMessage", "command", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "command", ".", "set", "(", "CommandMessage", ".", "QUIT", ")", ";", "consumer", ".", "messageQueue", ".", "post", "(", "command", ")", ";", "waitingConsumers", ".", "remove", "(", "consumer", ")", ";", "consumers", ".", "remove", "(", "consumer", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "consumers", ".", "size", "(", ")", ")", ";", "if", "(", "consumers", ".", "isEmpty", "(", ")", "&", "&", "internalZeroConsumersListeners", "!", "=", "null", ")", "{", "for", "(", "Runnable", "runnable", ":", "internalZeroConsumersListeners", ")", "{", "runnable", ".", "run", "(", ")", ";", "}", "}", "}", "else", "{", "if", "(", "!", "waitingConsumers", ".", "contains", "(", "consumer", ")", ")", "{", "waitingConsumers", ".", "add", "(", "consumer", ")", ";", "}", "if", "(", "tooMany", "|", "|", "!", "jobManagerThread", ".", "canListenToNetwork", "(", ")", ")", "{", "CommandMessage", "cm", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "cm", ".", "set", "(", "CommandMessage", ".", "POKE", ")", ";", "if", "(", "!", "tooMany", ")", "{", "keepAliveTimeout", "=", "timer", ".", "nanoTime", "(", ")", "+", "consumerKeepAliveNs", ";", "}", "consumer", ".", "messageQueue", ".", "postAt", "(", "cm", ",", "keepAliveTimeout", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "keepAliveTimeout", ")", ";", "}", "}", "return", "false", ";", "}", "}", "</s>"]
["<s>", "Set", "<", "String", ">", "markJobsCancelled", "(", "TagConstraint", "constraint", ",", "String", "[", "]", "tags", ")", "{", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", ">", "(", ")", ";", "for", "(", "JobHolder", "holder", ":", "runningJobHolders", ".", "values", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "holder", ".", "getJob", "(", ")", ",", "holder", ".", "getJob", "(", ")", ".", "getTags", "(", ")", ")", ";", "if", "(", "!", "holder", ".", "hasTags", "(", ")", ")", "{", "continue", ";", "}", "if", "(", "holder", ".", "isCancelled", "(", ")", ")", "{", "continue", ";", "}", "if", "(", "constraint", ".", "matches", "(", "tags", ",", "holder", ".", "getTags", "(", ")", ")", ")", "{", "result", ".", "add", "(", "holder", ".", "getId", "(", ")", ")", ";", "holder", ".", "markAsCancelled", "(", ")", ";", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "void", "handleRunJobResult", "(", "RunJobResultMessage", "message", ",", "JobHolder", "jobHolder", ",", "RetryConstraint", "retryConstraint", ")", "{", "Consumer", "consumer", "=", "(", "Consumer", ")", "message", ".", "getWorker", "(", ")", ";", "if", "(", "!", "consumer", ".", "hasJob", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "consumer", ".", "hasJob", "=", "false", ";", "runningJobHolders", ".", "remove", "(", "jobHolder", ".", "getJob", "(", ")", ".", "getId", "(", ")", ")", ";", "if", "(", "jobHolder", ".", "getGroupId", "(", ")", "!", "=", "null", ")", "{", "runningJobGroups", ".", "remove", "(", "jobHolder", ".", "getGroupId", "(", ")", ")", ";", "if", "(", "retryConstraint", "!", "=", "null", "&", "&", "retryConstraint", ".", "willApplyNewDelayToGroup", "(", ")", "&", "&", "retryConstraint", ".", "getNewDelayInMs", "(", ")", ">", "0", ")", "{", "runningJobGroups", ".", "addGroupUntil", "(", "jobHolder", ".", "getGroupId", "(", ")", ",", "timer", ".", "nanoTime", "(", ")", "+", "retryConstraint", ".", "getNewDelayInMs", "(", ")", "*", "JobManagerThread", ".", "NS_PER_MS", ")", ";", "}", "}", "}", "</s>"]
["<s>", "boolean", "isJobRunning", "(", "String", "id", ")", "{", "return", "runningJobHolders", ".", "get", "(", "id", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "int", "getWorkerCount", "(", ")", "{", "return", "consumers", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasJobsWithSchedulerConstraint", "(", "SchedulerConstraint", "constraint", ",", "long", "nowInNs", ")", "{", "for", "(", "JobHolder", "jobHolder", ":", "runningJobHolders", ".", "values", "(", ")", ")", "{", "if", "(", "!", "jobHolder", ".", "getJob", "(", ")", ".", "isPersistent", "(", ")", ")", "{", "continue", ";", "}", "if", "(", "constraint", ".", "requireNetwork", "(", ")", "&", "&", "jobHolder", ".", "requiresNetwork", "(", "nowInNs", ")", ")", "{", "return", "true", ";", "}", "if", "(", "constraint", ".", "requireUnmeteredNetwork", "(", ")", "&", "&", "jobHolder", ".", "requiresUnmeteredNetwork", "(", "nowInNs", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "boolean", "areAllConsumersIdle", "(", ")", "{", "return", "waitingConsumers", ".", "size", "(", ")", "=", "=", "consumers", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onMessage", "(", "Message", "message", ")", "{", "return", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", "&", "&", "(", "(", "CommandMessage", ")", "message", ")", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "POKE", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "type", ")", "{", "case", "RUN_JOB", ":", "handleRunJob", "(", "(", "RunJobMessage", ")", "message", ")", ";", "lastJobCompleted", "=", "timer", ".", "nanoTime", "(", ")", ";", "removePokeMessages", "(", ")", ";", "break", ";", "case", "COMMAND", ":", "handleCommand", "(", "(", "CommandMessage", ")", "message", ")", ";", "break", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "JobConsumerIdleMessage", "idle", "=", "factory", ".", "obtain", "(", "JobConsumerIdleMessage", ".", "class", ")", ";", "idle", ".", "setWorker", "(", "Consumer", ".", "this", ")", ";", "idle", ".", "setLastJobCompleted", "(", "lastJobCompleted", ")", ";", "parentMessageQueue", ".", "post", "(", "idle", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removePokeMessages", "(", ")", "{", "messageQueue", ".", "cancelMessages", "(", "pokeMessagePredicate", ")", ";", "}", "</s>"]
["<s>", "public", "Consumer", "(", "MessageQueue", "parentMessageQueue", ",", "SafeMessageQueue", "messageQueue", ",", "MessageFactory", "factory", ",", "Timer", "timer", ")", "{", "this", ".", "messageQueue", "=", "messageQueue", ";", "this", ".", "factory", "=", "factory", ";", "this", ".", "parentMessageQueue", "=", "parentMessageQueue", ";", "this", ".", "timer", "=", "timer", ";", "this", ".", "lastJobCompleted", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "messageQueue", ".", "consume", "(", "queueConsumer", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleCommand", "(", "CommandMessage", "message", ")", "{", "switch", "(", "message", ".", "getWhat", "(", ")", ")", "{", "case", "CommandMessage", ".", "QUIT", ":", "messageQueue", ".", "stop", "(", ")", ";", "break", ";", "case", "CommandMessage", ".", "POKE", ":", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "break", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleRunJob", "(", "RunJobMessage", "message", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "message", ".", "getJobHolder", "(", ")", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ")", ";", "JobHolder", "jobHolder", "=", "message", ".", "getJobHolder", "(", ")", ";", "int", "result", "=", "jobHolder", ".", "safeRun", "(", "jobHolder", ".", "getRunCount", "(", ")", ")", ";", "RunJobResultMessage", "resultMessage", "=", "factory", ".", "obtain", "(", "RunJobResultMessage", ".", "class", ")", ";", "resultMessage", ".", "setJobHolder", "(", "jobHolder", ")", ";", "resultMessage", ".", "setResult", "(", "result", ")", ";", "resultMessage", ".", "setWorker", "(", "this", ")", ";", "parentMessageQueue", ".", "post", "(", "resultMessage", ")", ";", "}", "</s>"]
["<s>", "void", "onResult", "(", "int", "result", ")", ";", "</s>"]
["<s>", "void", "setCallback", "(", "IntCallback", "intCallback", ")", ";", "</s>"]
["<s>", "JobManagerThread", "(", "Configuration", "config", ",", "PriorityMessageQueue", "messageQueue", ",", "MessageFactory", "messageFactory", ")", "{", "this", ".", "messageQueue", "=", "messageQueue", ";", "if", "(", "config", ".", "getCustomLogger", "(", ")", "!", "=", "null", ")", "{", "JqLog", ".", "setCustomLogger", "(", "config", ".", "getCustomLogger", "(", ")", ")", ";", "}", "this", ".", "messageFactory", "=", "messageFactory", ";", "timer", "=", "config", ".", "getTimer", "(", ")", ";", "appContext", "=", "config", ".", "getAppContext", "(", ")", ";", "sessionId", "=", "timer", ".", "nanoTime", "(", ")", ";", "scheduler", "=", "config", ".", "getScheduler", "(", ")", ";", "this", ".", "persistentJobQueue", "=", "config", ".", "getQueueFactory", "(", ")", ".", "createPersistentQueue", "(", "config", ",", "sessionId", ")", ";", "this", ".", "nonPersistentJobQueue", "=", "config", ".", "getQueueFactory", "(", ")", ".", "createNonPersistent", "(", "config", ",", "sessionId", ")", ";", "networkUtil", "=", "config", ".", "getNetworkUtil", "(", ")", ";", "dependencyInjector", "=", "config", ".", "getDependencyInjector", "(", ")", ";", "if", "(", "networkUtil", "instanceof", "NetworkEventProvider", ")", "{", "(", "(", "NetworkEventProvider", ")", "networkUtil", ")", ".", "setListener", "(", "this", ")", ";", "}", "consumerManager", "=", "new", "ConsumerManager", "(", "this", ",", "timer", ",", "messageFactory", ",", "config", ")", ";", "callbackManager", "=", "new", "CallbackManager", "(", "messageFactory", ",", "timer", ")", ";", "}", "</s>"]
["<s>", "void", "addCallback", "(", "JobManagerCallback", "callback", ")", "{", "callbackManager", ".", "addCallback", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "boolean", "removeCallback", "(", "JobManagerCallback", "callback", ")", "{", "return", "callbackManager", ".", "removeCallback", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "boolean", "canListenToNetwork", "(", ")", "{", "return", "networkUtil", "instanceof", "NetworkEventProvider", ";", "}", "</s>"]
["<s>", "private", "void", "handleAddJob", "(", "AddJobMessage", "message", ")", "{", "Job", "job", "=", "message", ".", "getJob", "(", ")", ";", "long", "delayUntilNs", "=", "job", ".", "getDelayInMs", "(", ")", ">", "0", "?", "timer", ".", "nanoTime", "(", ")", "+", "job", ".", "getDelayInMs", "(", ")", "*", "NS_PER_MS", ":", "NOT_DELAYED_JOB_DELAY", ";", "job", ".", "seal", "(", "timer", ")", ";", "JobHolder", "jobHolder", "=", "new", "JobHolder", ".", "Builder", "(", ")", ".", "priority", "(", "job", ".", "getPriority", "(", ")", ")", ".", "job", "(", "job", ")", ".", "groupId", "(", "job", ".", "getRunGroupId", "(", ")", ")", ".", "createdNs", "(", "timer", ".", "nanoTime", "(", ")", ")", ".", "delayUntilNs", "(", "delayUntilNs", ")", ".", "runningSessionId", "(", "NOT_RUNNING_SESSION_ID", ")", ".", "build", "(", ")", ";", "final", "boolean", "persistent", "=", "job", ".", "isPersistent", "(", ")", ";", "if", "(", "persistent", ")", "{", "persistentJobQueue", ".", "insert", "(", "jobHolder", ")", ";", "}", "else", "{", "nonPersistentJobQueue", ".", "insert", "(", "jobHolder", ")", ";", "}", "if", "(", "JqLog", ".", "isDebugEnabled", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "job", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ",", "job", ".", "getPriority", "(", ")", ",", "job", ".", "getDelayInMs", "(", ")", ",", "job", ".", "getRunGroupId", "(", ")", ",", "persistent", ",", "job", ".", "requiresNetwork", "(", "timer", ")", ")", ";", "}", "if", "(", "dependencyInjector", "!", "=", "null", ")", "{", "dependencyInjector", ".", "inject", "(", "job", ")", ";", "}", "jobHolder", ".", "setApplicationContext", "(", "appContext", ")", ";", "try", "{", "jobHolder", ".", "getJob", "(", ")", ".", "onAdded", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "callbackManager", ".", "notifyOnAdded", "(", "jobHolder", ".", "getJob", "(", ")", ")", ";", "consumerManager", ".", "onJobAdded", "(", ")", ";", "if", "(", "persistent", ")", "{", "scheduleWakeUpFor", "(", "job", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "scheduleWakeUpFor", "(", "Job", "job", ")", "{", "if", "(", "scheduler", "=", "=", "null", ")", "{", "return", ";", "}", "SchedulerConstraint", "constraint", "=", "new", "SchedulerConstraint", "(", ")", ";", "constraint", ".", "setRequireNetwork", "(", "job", ".", "requiresNetwork", "(", "timer", ")", ")", ";", "constraint", ".", "setRequireUnmeteredNetwork", "(", "job", ".", "requiresUnmeteredNetwork", "(", "timer", ")", ")", ";", "long", "delayInMs", "=", "job", ".", "getDelayInMs", "(", ")", ";", "constraint", ".", "setDelayInMs", "(", "delayInMs", ">", "0", "?", "delayInMs", ":", "0", ")", ";", "scheduler", ".", "request", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "messageQueue", ".", "consume", "(", "new", "MessageQueueConsumer", "(", ")", "{", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "type", ")", "{", "case", "ADD_JOB", ":", "handleAddJob", "(", "(", "AddJobMessage", ")", "message", ")", ";", "break", ";", "case", "JOB_CONSUMER_IDLE", ":", "boolean", "busy", "=", "consumerManager", ".", "handleIdle", "(", "(", "JobConsumerIdleMessage", ")", "message", ")", ";", "if", "(", "!", "busy", ")", "{", "invokeSchedulersIfIdle", "(", ")", ";", "}", "break", ";", "case", "RUN_JOB_RESULT", ":", "handleRunJobResult", "(", "(", "RunJobResultMessage", ")", "message", ")", ";", "break", ";", "case", "CONSTRAINT_CHANGE", ":", "consumerManager", ".", "handleConstraintChange", "(", ")", ";", "break", ";", "case", "CANCEL", ":", "handleCancel", "(", "(", "CancelMessage", ")", "message", ")", ";", "break", ";", "case", "PUBLIC_QUERY", ":", "handlePublicQuery", "(", "(", "PublicQueryMessage", ")", "message", ")", ";", "break", ";", "case", "COMMAND", ":", "handleCommand", "(", "(", "CommandMessage", ")", "message", ")", ";", "break", ";", "case", "SCHEDULER", ":", "handleSchedulerMessage", "(", "(", "SchedulerMessage", ")", "message", ")", ";", "break", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "running", ")", ";", "if", "(", "!", "running", ")", "{", "return", ";", "}", "Long", "nextJobTimeNs", "=", "getNextWakeUpNs", "(", "true", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "nextJobTimeNs", ")", ";", "if", "(", "nextJobTimeNs", "!", "=", "null", ")", "{", "ConstraintChangeMessage", "constraintMessage", "=", "messageFactory", ".", "obtain", "(", "ConstraintChangeMessage", ".", "class", ")", ";", "messageQueue", ".", "postAt", "(", "constraintMessage", ",", "nextJobTimeNs", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "type", ")", "{", "case", "ADD_JOB", ":", "handleAddJob", "(", "(", "AddJobMessage", ")", "message", ")", ";", "break", ";", "case", "JOB_CONSUMER_IDLE", ":", "boolean", "busy", "=", "consumerManager", ".", "handleIdle", "(", "(", "JobConsumerIdleMessage", ")", "message", ")", ";", "if", "(", "!", "busy", ")", "{", "invokeSchedulersIfIdle", "(", ")", ";", "}", "break", ";", "case", "RUN_JOB_RESULT", ":", "handleRunJobResult", "(", "(", "RunJobResultMessage", ")", "message", ")", ";", "break", ";", "case", "CONSTRAINT_CHANGE", ":", "consumerManager", ".", "handleConstraintChange", "(", ")", ";", "break", ";", "case", "CANCEL", ":", "handleCancel", "(", "(", "CancelMessage", ")", "message", ")", ";", "break", ";", "case", "PUBLIC_QUERY", ":", "handlePublicQuery", "(", "(", "PublicQueryMessage", ")", "message", ")", ";", "break", ";", "case", "COMMAND", ":", "handleCommand", "(", "(", "CommandMessage", ")", "message", ")", ";", "break", ";", "case", "SCHEDULER", ":", "handleSchedulerMessage", "(", "(", "SchedulerMessage", ")", "message", ")", ";", "break", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "running", ")", ";", "if", "(", "!", "running", ")", "{", "return", ";", "}", "Long", "nextJobTimeNs", "=", "getNextWakeUpNs", "(", "true", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "nextJobTimeNs", ")", ";", "if", "(", "nextJobTimeNs", "!", "=", "null", ")", "{", "ConstraintChangeMessage", "constraintMessage", "=", "messageFactory", ".", "obtain", "(", "ConstraintChangeMessage", ".", "class", ")", ";", "messageQueue", ".", "postAt", "(", "constraintMessage", ",", "nextJobTimeNs", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "invokeSchedulersIfIdle", "(", ")", "{", "if", "(", "scheduler", "=", "=", "null", "|", "|", "pendingSchedulerCallbacks", "=", "=", "null", "|", "|", "pendingSchedulerCallbacks", ".", "isEmpty", "(", ")", "|", "|", "!", "consumerManager", ".", "areAllConsumersIdle", "(", ")", ")", "{", "return", ";", "}", "for", "(", "int", "i", "=", "pendingSchedulerCallbacks", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "SchedulerConstraint", "constraint", "=", "pendingSchedulerCallbacks", ".", "remove", "(", "i", ")", ";", "boolean", "reschedule", "=", "hasJobsWithSchedulerConstraint", "(", "constraint", ")", ";", "scheduler", ".", "onFinished", "(", "constraint", ",", "reschedule", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleSchedulerMessage", "(", "SchedulerMessage", "message", ")", "{", "final", "int", "what", "=", "message", ".", "getWhat", "(", ")", ";", "if", "(", "what", "=", "=", "SchedulerMessage", ".", "START", ")", "{", "handleSchedulerStart", "(", "message", ".", "getConstraint", "(", ")", ")", ";", "}", "else", "if", "(", "what", "=", "=", "SchedulerMessage", ".", "STOP", ")", "{", "handleSchedulerStop", "(", "message", ".", "getConstraint", "(", ")", ",", "message", ".", "getCallback", "(", ")", ")", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "what", ")", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "hasJobsWithSchedulerConstraint", "(", "SchedulerConstraint", "constraint", ")", "{", "if", "(", "consumerManager", ".", "hasJobsWithSchedulerConstraint", "(", "constraint", ",", "timer", ".", "nanoTime", "(", ")", ")", ")", "{", "return", "true", ";", "}", "queryConstraint", ".", "clear", "(", ")", ";", "queryConstraint", ".", "setNowInNs", "(", "timer", ".", "nanoTime", "(", ")", ")", ";", "if", "(", "constraint", ".", "requireUnmeteredNetwork", "(", ")", ")", "{", "queryConstraint", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "UNMETERED", ")", ";", "}", "else", "if", "(", "constraint", ".", "requireNetwork", "(", ")", ")", "{", "queryConstraint", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "}", "else", "{", "queryConstraint", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "}", "return", "persistentJobQueue", ".", "countReadyJobs", "(", "queryConstraint", ")", ">", "0", ";", "}", "</s>"]
["<s>", "private", "void", "handleSchedulerStop", "(", "SchedulerConstraint", "constraint", ",", "IntCallback", "callback", ")", "{", "boolean", "hasMatchingJobs", "=", "hasJobsWithSchedulerConstraint", "(", "constraint", ")", ";", "callback", ".", "onResult", "(", "hasMatchingJobs", "?", "1", ":", "0", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleSchedulerStart", "(", "SchedulerConstraint", "constraint", ")", "{", "if", "(", "!", "isRunning", "(", ")", ")", "{", "if", "(", "scheduler", "!", "=", "null", ")", "{", "scheduler", ".", "onFinished", "(", "constraint", ",", "true", ")", ";", "}", "return", ";", "}", "boolean", "hasMatchingJobs", "=", "hasJobsWithSchedulerConstraint", "(", "constraint", ")", ";", "if", "(", "!", "hasMatchingJobs", ")", "{", "if", "(", "scheduler", "!", "=", "null", ")", "{", "scheduler", ".", "onFinished", "(", "constraint", ",", "false", ")", ";", "}", "return", ";", "}", "if", "(", "pendingSchedulerCallbacks", "=", "=", "null", ")", "{", "pendingSchedulerCallbacks", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "}", "pendingSchedulerCallbacks", ".", "add", "(", "constraint", ")", ";", "consumerManager", ".", "handleConstraintChange", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleCommand", "(", "CommandMessage", "message", ")", "{", "if", "(", "message", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "QUIT", ")", "{", "messageQueue", ".", "stop", "(", ")", ";", "messageQueue", ".", "clear", "(", ")", ";", "}", "}", "</s>"]
["<s>", "int", "count", "(", ")", "{", "return", "persistentJobQueue", ".", "count", "(", ")", "+", "nonPersistentJobQueue", ".", "count", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handlePublicQuery", "(", "PublicQueryMessage", "message", ")", "{", "switch", "(", "message", ".", "getWhat", "(", ")", ")", "{", "case", "PublicQueryMessage", ".", "COUNT", ":", "message", ".", "getCallback", "(", ")", ".", "onResult", "(", "count", "(", ")", ")", ";", "break", ";", "case", "PublicQueryMessage", ".", "COUNT_READY", ":", "message", ".", "getCallback", "(", ")", ".", "onResult", "(", "countReadyJobs", "(", "getNetworkStatus", "(", ")", ")", ")", ";", "break", ";", "case", "PublicQueryMessage", ".", "START", ":", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "running", ")", "{", "return", ";", "}", "running", "=", "true", ";", "consumerManager", ".", "handleConstraintChange", "(", ")", ";", "break", ";", "case", "PublicQueryMessage", ".", "STOP", ":", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "running", "=", "false", ";", "consumerManager", ".", "handleStop", "(", ")", ";", "break", ";", "case", "PublicQueryMessage", ".", "JOB_STATUS", ":", "JobStatus", "status", "=", "getJobStatus", "(", "message", ".", "getStringArg", "(", ")", ")", ";", "message", ".", "getCallback", "(", ")", ".", "onResult", "(", "status", ".", "ordinal", "(", ")", ")", ";", "break", ";", "case", "PublicQueryMessage", ".", "CLEAR", ":", "clear", "(", ")", ";", "if", "(", "message", ".", "getCallback", "(", ")", "!", "=", "null", ")", "{", "message", ".", "getCallback", "(", ")", ".", "onResult", "(", "0", ")", ";", "}", "break", ";", "case", "PublicQueryMessage", ".", "ACTIVE_CONSUMER_COUNT", ":", "message", ".", "getCallback", "(", ")", ".", "onResult", "(", "consumerManager", ".", "getWorkerCount", "(", ")", ")", ";", "break", ";", "case", "PublicQueryMessage", ".", "INTERNAL_RUNNABLE", ":", "message", ".", "getCallback", "(", ")", ".", "onResult", "(", "0", ")", ";", "break", ";", "default", ":", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "message", ".", "getWhat", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "clear", "(", ")", "{", "nonPersistentJobQueue", ".", "clear", "(", ")", ";", "persistentJobQueue", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "private", "JobStatus", "getJobStatus", "(", "String", "id", ")", "{", "if", "(", "consumerManager", ".", "isJobRunning", "(", "id", ")", ")", "{", "return", "JobStatus", ".", "RUNNING", ";", "}", "JobHolder", "holder", ";", "holder", "=", "nonPersistentJobQueue", ".", "findJobById", "(", "id", ")", ";", "if", "(", "holder", "=", "=", "null", ")", "{", "holder", "=", "persistentJobQueue", ".", "findJobById", "(", "id", ")", ";", "}", "if", "(", "holder", "=", "=", "null", ")", "{", "return", "JobStatus", ".", "UNKNOWN", ";", "}", "final", "int", "networkStatus", "=", "getNetworkStatus", "(", ")", ";", "long", "now", "=", "timer", ".", "nanoTime", "(", ")", ";", "if", "(", "networkStatus", "=", "=", "DISCONNECTED", "&", "&", "holder", ".", "requiresNetwork", "(", "now", ")", ")", "{", "return", "JobStatus", ".", "WAITING_NOT_READY", ";", "}", "if", "(", "networkStatus", "!", "=", "UNMETERED", "&", "&", "holder", ".", "requiresUnmeteredNetwork", "(", "now", ")", ")", "{", "return", "JobStatus", ".", "WAITING_NOT_READY", ";", "}", "if", "(", "holder", ".", "getDelayUntilNs", "(", ")", ">", "now", ")", "{", "return", "JobStatus", ".", "WAITING_NOT_READY", ";", "}", "return", "JobStatus", ".", "WAITING_READY", ";", "}", "</s>"]
["<s>", "private", "void", "handleCancel", "(", "CancelMessage", "message", ")", "{", "CancelHandler", "handler", "=", "new", "CancelHandler", "(", "message", ".", "getConstraint", "(", ")", ",", "message", ".", "getTags", "(", ")", ",", "message", ".", "getCallback", "(", ")", ")", ";", "handler", ".", "query", "(", "this", ",", "consumerManager", ")", ";", "if", "(", "handler", ".", "isDone", "(", ")", ")", "{", "handler", ".", "commit", "(", "this", ")", ";", "}", "else", "{", "if", "(", "pendingCancelHandlers", "=", "=", "null", ")", "{", "pendingCancelHandlers", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "}", "pendingCancelHandlers", ".", "add", "(", "handler", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleRunJobResult", "(", "RunJobResultMessage", "message", ")", "{", "final", "int", "result", "=", "message", ".", "getResult", "(", ")", ";", "final", "JobHolder", "jobHolder", "=", "message", ".", "getJobHolder", "(", ")", ";", "callbackManager", ".", "notifyOnRun", "(", "jobHolder", ".", "getJob", "(", ")", ",", "result", ")", ";", "RetryConstraint", "retryConstraint", "=", "null", ";", "switch", "(", "result", ")", "{", "case", "JobHolder", ".", "RUN_RESULT_SUCCESS", ":", "jobHolder", ".", "markAsSuccessful", "(", ")", ";", "removeJob", "(", "jobHolder", ")", ";", "break", ";", "case", "JobHolder", ".", "RUN_RESULT_FAIL_RUN_LIMIT", ":", "case", "JobHolder", ".", "RUN_RESULT_FAIL_SHOULD_RE_RUN", ":", "try", "{", "jobHolder", ".", "onCancel", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "callbackManager", ".", "notifyOnCancel", "(", "jobHolder", ".", "getJob", "(", ")", ",", "false", ")", ";", "removeJob", "(", "jobHolder", ")", ";", "break", ";", "case", "JobHolder", ".", "RUN_RESULT_TRY_AGAIN", ":", "retryConstraint", "=", "jobHolder", ".", "getRetryConstraint", "(", ")", ";", "insertOrReplace", "(", "jobHolder", ")", ";", "break", ";", "case", "JobHolder", ".", "RUN_RESULT_FAIL_FOR_CANCEL", ":", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "break", ";", "default", ":", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "consumerManager", ".", "handleRunJobResult", "(", "message", ",", "jobHolder", ",", "retryConstraint", ")", ";", "callbackManager", ".", "notifyAfterRun", "(", "jobHolder", ".", "getJob", "(", ")", ",", "result", ")", ";", "if", "(", "pendingCancelHandlers", "!", "=", "null", ")", "{", "int", "limit", "=", "pendingCancelHandlers", ".", "size", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "limit", ";", "i", "+", "+", ")", "{", "CancelHandler", "handler", "=", "pendingCancelHandlers", ".", "get", "(", "i", ")", ";", "handler", ".", "onJobRun", "(", "jobHolder", ",", "result", ")", ";", "if", "(", "handler", ".", "isDone", "(", ")", ")", "{", "handler", ".", "commit", "(", "this", ")", ";", "pendingCancelHandlers", ".", "remove", "(", "i", ")", ";", "i", "-", "-", ";", "limit", "-", "-", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "void", "insertOrReplace", "(", "JobHolder", "jobHolder", ")", "{", "RetryConstraint", "retryConstraint", "=", "jobHolder", ".", "getRetryConstraint", "(", ")", ";", "if", "(", "retryConstraint", "=", "=", "null", ")", "{", "reAddJob", "(", "jobHolder", ")", ";", "return", ";", "}", "if", "(", "retryConstraint", ".", "getNewPriority", "(", ")", "!", "=", "null", ")", "{", "jobHolder", ".", "setPriority", "(", "retryConstraint", ".", "getNewPriority", "(", ")", ")", ";", "}", "long", "delay", "=", "-", "1", ";", "if", "(", "retryConstraint", ".", "getNewDelayInMs", "(", ")", "!", "=", "null", ")", "{", "delay", "=", "retryConstraint", ".", "getNewDelayInMs", "(", ")", ";", "}", "jobHolder", ".", "setDelayUntilNs", "(", "delay", ">", "0", "?", "timer", ".", "nanoTime", "(", ")", "+", "delay", "*", "NS_PER_MS", ":", "NOT_DELAYED_JOB_DELAY", ")", ";", "reAddJob", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "private", "void", "reAddJob", "(", "JobHolder", "jobHolder", ")", "{", "if", "(", "!", "jobHolder", ".", "isCancelled", "(", ")", ")", "{", "if", "(", "jobHolder", ".", "getJob", "(", ")", ".", "isPersistent", "(", ")", ")", "{", "persistentJobQueue", ".", "insertOrReplace", "(", "jobHolder", ")", ";", "}", "else", "{", "nonPersistentJobQueue", ".", "insertOrReplace", "(", "jobHolder", ")", ";", "}", "}", "else", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", "+", "jobHolder", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "removeJob", "(", "JobHolder", "jobHolder", ")", "{", "if", "(", "jobHolder", ".", "getJob", "(", ")", ".", "isPersistent", "(", ")", ")", "{", "persistentJobQueue", ".", "remove", "(", "jobHolder", ")", ";", "}", "else", "{", "nonPersistentJobQueue", ".", "remove", "(", "jobHolder", ")", ";", "}", "callbackManager", ".", "notifyOnDone", "(", "jobHolder", ".", "getJob", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onNetworkChange", "(", "@", "NetworkUtil", ".", "NetworkStatus", "int", "networkStatus", ")", "{", "ConstraintChangeMessage", "constraint", "=", "messageFactory", ".", "obtain", "(", "ConstraintChangeMessage", ".", "class", ")", ";", "messageQueue", ".", "post", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "boolean", "isRunning", "(", ")", "{", "return", "running", ";", "}", "</s>"]
["<s>", "int", "countRemainingReadyJobs", "(", ")", "{", "return", "countReadyJobs", "(", "getNetworkStatus", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "int", "countReadyJobs", "(", "@", "NetworkUtil", ".", "NetworkStatus", "int", "networkStatus", ")", "{", "final", "Collection", "<", "String", ">", "runningJobs", "=", "consumerManager", ".", "runningJobGroups", ".", "getSafe", "(", ")", ";", "queryConstraint", ".", "clear", "(", ")", ";", "queryConstraint", ".", "setNowInNs", "(", "timer", ".", "nanoTime", "(", ")", ")", ";", "queryConstraint", ".", "setNetworkStatus", "(", "networkStatus", ")", ";", "queryConstraint", ".", "setExcludeGroups", "(", "runningJobs", ")", ";", "queryConstraint", ".", "setExcludeRunning", "(", "true", ")", ";", "queryConstraint", ".", "setTimeLimit", "(", "timer", ".", "nanoTime", "(", ")", ")", ";", "int", "total", "=", "0", ";", "total", "+", "=", "nonPersistentJobQueue", ".", "countReadyJobs", "(", "queryConstraint", ")", ";", "total", "+", "=", "persistentJobQueue", ".", "countReadyJobs", "(", "queryConstraint", ")", ";", "return", "total", ";", "}", "</s>"]
["<s>", "@", "NetworkUtil", ".", "NetworkStatus", "private", "int", "getNetworkStatus", "(", ")", "{", "return", "networkUtil", "=", "=", "null", "?", "NetworkUtil", ".", "UNMETERED", ":", "networkUtil", ".", "getNetworkStatus", "(", "appContext", ")", ";", "}", "</s>"]
["<s>", "Long", "getNextWakeUpNs", "(", "boolean", "includeNetworkWatch", ")", "{", "final", "Long", "groupDelay", "=", "consumerManager", ".", "runningJobGroups", ".", "getNextDelayForGroups", "(", ")", ";", "final", "int", "networkStatus", "=", "getNetworkStatus", "(", ")", ";", "final", "Collection", "<", "String", ">", "groups", "=", "consumerManager", ".", "runningJobGroups", ".", "getSafe", "(", ")", ";", "queryConstraint", ".", "clear", "(", ")", ";", "queryConstraint", ".", "setNowInNs", "(", "timer", ".", "nanoTime", "(", ")", ")", ";", "queryConstraint", ".", "setNetworkStatus", "(", "networkStatus", ")", ";", "queryConstraint", ".", "setExcludeGroups", "(", "groups", ")", ";", "queryConstraint", ".", "setExcludeRunning", "(", "true", ")", ";", "final", "Long", "nonPersistent", "=", "nonPersistentJobQueue", ".", "getNextJobDelayUntilNs", "(", "queryConstraint", ")", ";", "final", "Long", "persistent", "=", "persistentJobQueue", ".", "getNextJobDelayUntilNs", "(", "queryConstraint", ")", ";", "Long", "delay", "=", "null", ";", "if", "(", "groupDelay", "!", "=", "null", ")", "{", "delay", "=", "groupDelay", ";", "}", "if", "(", "nonPersistent", "!", "=", "null", ")", "{", "delay", "=", "delay", "=", "=", "null", "?", "nonPersistent", ":", "Math", ".", "min", "(", "nonPersistent", ",", "delay", ")", ";", "}", "if", "(", "persistent", "!", "=", "null", ")", "{", "delay", "=", "delay", "=", "=", "null", "?", "persistent", ":", "Math", ".", "min", "(", "persistent", ",", "delay", ")", ";", "}", "if", "(", "includeNetworkWatch", "&", "&", "!", "(", "networkUtil", "instanceof", "NetworkEventProvider", ")", ")", "{", "long", "checkNetworkAt", "=", "timer", ".", "nanoTime", "(", ")", "+", "JobManager", ".", "NETWORK_CHECK_INTERVAL", ";", "delay", "=", "delay", "=", "=", "null", "?", "checkNetworkAt", ":", "Math", ".", "min", "(", "checkNetworkAt", ",", "delay", ")", ";", "}", "return", "delay", ";", "}", "</s>"]
["<s>", "JobHolder", "getNextJobForTesting", "(", ")", "{", "return", "getNextJobForTesting", "(", "null", ")", ";", "}", "</s>"]
["<s>", "JobHolder", "getNextJobForTesting", "(", "Collection", "<", "String", ">", "runningJobGroups", ")", "{", "return", "getNextJob", "(", "runningJobGroups", ",", "true", ")", ";", "}", "</s>"]
["<s>", "JobHolder", "getNextJob", "(", "Collection", "<", "String", ">", "runningJobGroups", ")", "{", "return", "getNextJob", "(", "runningJobGroups", ",", "false", ")", ";", "}", "</s>"]
["<s>", "JobHolder", "getNextJob", "(", "Collection", "<", "String", ">", "runningJobGroups", ",", "boolean", "ignoreRunning", ")", "{", "if", "(", "!", "running", "&", "&", "!", "ignoreRunning", ")", "{", "return", "null", ";", "}", "final", "int", "networkStatus", "=", "getNetworkStatus", "(", ")", ";", "JobHolder", "jobHolder", ";", "boolean", "persistent", "=", "false", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "queryConstraint", ".", "clear", "(", ")", ";", "queryConstraint", ".", "setNowInNs", "(", "timer", ".", "nanoTime", "(", ")", ")", ";", "queryConstraint", ".", "setNetworkStatus", "(", "networkStatus", ")", ";", "queryConstraint", ".", "setExcludeGroups", "(", "runningJobGroups", ")", ";", "queryConstraint", ".", "setExcludeRunning", "(", "true", ")", ";", "queryConstraint", ".", "setTimeLimit", "(", "timer", ".", "nanoTime", "(", ")", ")", ";", "jobHolder", "=", "nonPersistentJobQueue", ".", "nextJobAndIncRunCount", "(", "queryConstraint", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "jobHolder", ")", ";", "if", "(", "jobHolder", "=", "=", "null", ")", "{", "jobHolder", "=", "persistentJobQueue", ".", "nextJobAndIncRunCount", "(", "queryConstraint", ")", ";", "persistent", "=", "true", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "jobHolder", ")", ";", "}", "if", "(", "jobHolder", "=", "=", "null", ")", "{", "return", "null", ";", "}", "if", "(", "persistent", "&", "&", "dependencyInjector", "!", "=", "null", ")", "{", "dependencyInjector", ".", "inject", "(", "jobHolder", ".", "getJob", "(", ")", ")", ";", "}", "jobHolder", ".", "setApplicationContext", "(", "appContext", ")", ";", "return", "jobHolder", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldNotRequireNetwork", "(", ")", "{", "return", "shouldNotRequireNetwork", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldNotRequireUnmeteredNetwork", "(", ")", "{", "return", "shouldNotRequireUnmeteredNetwork", ";", "}", "</s>"]
["<s>", "public", "TagConstraint", "getTagConstraint", "(", ")", "{", "return", "tagConstraint", ";", "}", "</s>"]
["<s>", "public", "Set", "<", "String", ">", "getTags", "(", ")", "{", "return", "tags", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getExcludeGroups", "(", ")", "{", "return", "excludeGroups", ";", "}", "</s>"]
["<s>", "public", "boolean", "excludeRunning", "(", ")", "{", "return", "excludeRunning", ";", "}", "</s>"]
["<s>", "public", "Long", "getTimeLimit", "(", ")", "{", "return", "timeLimit", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getExcludeJobIds", "(", ")", "{", "return", "excludeJobIds", ";", "}", "</s>"]
["<s>", "void", "setShouldNotRequireNetwork", "(", "boolean", "shouldNotRequireNetwork", ")", "{", "this", ".", "shouldNotRequireNetwork", "=", "shouldNotRequireNetwork", ";", "}", "</s>"]
["<s>", "void", "setShouldNotRequireUnmeteredNetwork", "(", "boolean", "shouldNotRequireUnmeteredNetwork", ")", "{", "this", ".", "shouldNotRequireUnmeteredNetwork", "=", "shouldNotRequireUnmeteredNetwork", ";", "}", "</s>"]
["<s>", "void", "setTagConstraint", "(", "TagConstraint", "tagConstraint", ")", "{", "this", ".", "tagConstraint", "=", "tagConstraint", ";", "}", "</s>"]
["<s>", "void", "setExcludeRunning", "(", "boolean", "excludeRunning", ")", "{", "this", ".", "excludeRunning", "=", "excludeRunning", ";", "}", "</s>"]
["<s>", "void", "setTags", "(", "String", "[", "]", "tags", ")", "{", "this", ".", "tags", ".", "clear", "(", ")", ";", "if", "(", "tags", "!", "=", "null", ")", "{", "Collections", ".", "addAll", "(", "this", ".", "tags", ",", "tags", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "setNowInNs", "(", "long", "nowInNs", ")", "{", "this", ".", "nowInNs", "=", "nowInNs", ";", "}", "</s>"]
["<s>", "void", "setExcludeGroups", "(", "Collection", "<", "String", ">", "excludeGroups", ")", "{", "this", ".", "excludeGroups", ".", "clear", "(", ")", ";", "if", "(", "excludeGroups", "!", "=", "null", ")", "{", "this", ".", "excludeGroups", ".", "addAll", "(", "excludeGroups", ")", ";", "}", "}", "</s>"]
["<s>", "void", "setExcludeJobIds", "(", "Collection", "<", "String", ">", "jobsIds", ")", "{", "this", ".", "excludeJobIds", ".", "clear", "(", ")", ";", "if", "(", "jobsIds", "!", "=", "null", ")", "{", "this", ".", "excludeJobIds", ".", "addAll", "(", "jobsIds", ")", ";", "}", "}", "</s>"]
["<s>", "public", "long", "getNowInNs", "(", ")", "{", "return", "nowInNs", ";", "}", "</s>"]
["<s>", "void", "setTimeLimit", "(", "Long", "timeLimit", ")", "{", "this", ".", "timeLimit", "=", "timeLimit", ";", "}", "</s>"]
["<s>", "void", "clear", "(", ")", "{", "shouldNotRequireNetwork", "=", "false", ";", "shouldNotRequireUnmeteredNetwork", "=", "false", ";", "tagConstraint", "=", "null", ";", "tags", ".", "clear", "(", ")", ";", "excludeGroups", ".", "clear", "(", ")", ";", "excludeJobIds", ".", "clear", "(", ")", ";", "excludeRunning", "=", "false", ";", "timeLimit", "=", "null", ";", "nowInNs", "=", "Long", ".", "MIN_VALUE", ";", "}", "</s>"]
["<s>", "void", "setNetworkStatus", "(", "@", "NetworkUtil", ".", "NetworkStatus", "int", "connectionStatus", ")", "{", "setShouldNotRequireNetwork", "(", "connectionStatus", "=", "=", "DISCONNECTED", ")", ";", "setShouldNotRequireUnmeteredNetwork", "(", "connectionStatus", "!", "=", "UNMETERED", ")", ";", "}", "</s>"]
["<s>", "public", "DefaultQueueFactory", "(", ")", "{", "jobSerializer", "=", "new", "SqliteJobQueue", ".", "JavaSerializer", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DefaultQueueFactory", "(", "SqliteJobQueue", ".", "JobSerializer", "jobSerializer", ")", "{", "this", ".", "jobSerializer", "=", "jobSerializer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobQueue", "createPersistentQueue", "(", "Configuration", "configuration", ",", "long", "sessionId", ")", "{", "return", "new", "CachedJobQueue", "(", "new", "SqliteJobQueue", "(", "configuration", ",", "sessionId", ",", "jobSerializer", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobQueue", "createNonPersistent", "(", "Configuration", "configuration", ",", "long", "sessionId", ")", "{", "return", "new", "CachedJobQueue", "(", "new", "SimpleInMemoryPriorityQueue", "(", "configuration", ",", "sessionId", ")", ")", ";", "}", "</s>"]
["<s>", "public", "CallbackManager", "(", "MessageFactory", "factory", ",", "Timer", "timer", ")", "{", "this", ".", "timer", "=", "timer", ";", "this", ".", "messageQueue", "=", "new", "SafeMessageQueue", "(", "timer", ",", "factory", ",", "\"", "<STR_LIT>", "\"", ")", ";", "callbacks", "=", "new", "CopyOnWriteArrayList", "<", ">", "(", ")", ";", "this", ".", "factory", "=", "factory", ";", "}", "</s>"]
["<s>", "void", "addCallback", "(", "JobManagerCallback", "callback", ")", "{", "callbacks", ".", "add", "(", "callback", ")", ";", "callbacksSize", ".", "incrementAndGet", "(", ")", ";", "startIfNeeded", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "startIfNeeded", "(", ")", "{", "if", "(", "!", "started", ".", "getAndSet", "(", "true", ")", ")", "{", "start", "(", ")", ";", "}", "}", "</s>"]
["<s>", "boolean", "removeCallback", "(", "JobManagerCallback", "callback", ")", "{", "boolean", "removed", "=", "callbacks", ".", "remove", "(", "callback", ")", ";", "if", "(", "removed", ")", "{", "callbacksSize", ".", "decrementAndGet", "(", ")", ";", "}", "return", "removed", ";", "}", "</s>"]
["<s>", "private", "void", "start", "(", ")", "{", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "messageQueue", ".", "consume", "(", "new", "MessageQueueConsumer", "(", ")", "{", "long", "lastDelivery", "=", "Long", ".", "MIN_VALUE", ";", "@", "Override", "public", "void", "onStart", "(", ")", "{", "}", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "CALLBACK", ")", "{", "CallbackMessage", "cm", "=", "(", "CallbackMessage", ")", "message", ";", "deliverMessage", "(", "cm", ")", ";", "lastDelivery", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "CANCEL_RESULT_CALLBACK", ")", "{", "deliverCancelResult", "(", "(", "CancelResultMessage", ")", "message", ")", ";", "lastDelivery", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", ")", "{", "CommandMessage", "command", "=", "(", "CommandMessage", ")", "message", ";", "if", "(", "command", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "QUIT", ")", "{", "messageQueue", ".", "stop", "(", ")", ";", "started", ".", "set", "(", "false", ")", ";", "}", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "PUBLIC_QUERY", ")", "{", "(", "(", "PublicQueryMessage", ")", "message", ")", ".", "getCallback", "(", ")", ".", "onResult", "(", "0", ")", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "}", ")", ";", "}", "}", ",", "\"", "<STR_LIT>", "\"", ")", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "messageQueue", ".", "consume", "(", "new", "MessageQueueConsumer", "(", ")", "{", "long", "lastDelivery", "=", "Long", ".", "MIN_VALUE", ";", "@", "Override", "public", "void", "onStart", "(", ")", "{", "}", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "CALLBACK", ")", "{", "CallbackMessage", "cm", "=", "(", "CallbackMessage", ")", "message", ";", "deliverMessage", "(", "cm", ")", ";", "lastDelivery", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "CANCEL_RESULT_CALLBACK", ")", "{", "deliverCancelResult", "(", "(", "CancelResultMessage", ")", "message", ")", ";", "lastDelivery", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", ")", "{", "CommandMessage", "command", "=", "(", "CommandMessage", ")", "message", ";", "if", "(", "command", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "QUIT", ")", "{", "messageQueue", ".", "stop", "(", ")", ";", "started", ".", "set", "(", "false", ")", ";", "}", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "PUBLIC_QUERY", ")", "{", "(", "(", "PublicQueryMessage", ")", "message", ")", ".", "getCallback", "(", ")", ".", "onResult", "(", "0", ")", ";", "}", "}", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onStart", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleMessage", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "CALLBACK", ")", "{", "CallbackMessage", "cm", "=", "(", "CallbackMessage", ")", "message", ";", "deliverMessage", "(", "cm", ")", ";", "lastDelivery", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "CANCEL_RESULT_CALLBACK", ")", "{", "deliverCancelResult", "(", "(", "CancelResultMessage", ")", "message", ")", ";", "lastDelivery", "=", "timer", ".", "nanoTime", "(", ")", ";", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "COMMAND", ")", "{", "CommandMessage", "command", "=", "(", "CommandMessage", ")", "message", ";", "if", "(", "command", ".", "getWhat", "(", ")", "=", "=", "CommandMessage", ".", "QUIT", ")", "{", "messageQueue", ".", "stop", "(", ")", ";", "started", ".", "set", "(", "false", ")", ";", "}", "}", "else", "if", "(", "message", ".", "type", "=", "=", "Type", ".", "PUBLIC_QUERY", ")", "{", "(", "(", "PublicQueryMessage", ")", "message", ")", ".", "getCallback", "(", ")", ".", "onResult", "(", "0", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onIdle", "(", ")", "{", "}", "</s>"]
["<s>", "private", "void", "deliverCancelResult", "(", "CancelResultMessage", "message", ")", "{", "message", ".", "getCallback", "(", ")", ".", "onCancelled", "(", "message", ".", "getResult", "(", ")", ")", ";", "startIfNeeded", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "deliverMessage", "(", "CallbackMessage", "cm", ")", "{", "switch", "(", "cm", ".", "getWhat", "(", ")", ")", "{", "case", "CallbackMessage", ".", "ON_ADDED", ":", "notifyOnAddedListeners", "(", "cm", ".", "getJob", "(", ")", ")", ";", "break", ";", "case", "CallbackMessage", ".", "ON_AFTER_RUN", ":", "notifyAfterRunListeners", "(", "cm", ".", "getJob", "(", ")", ",", "cm", ".", "getResultCode", "(", ")", ")", ";", "break", ";", "case", "CallbackMessage", ".", "ON_CANCEL", ":", "notifyOnCancelListeners", "(", "cm", ".", "getJob", "(", ")", ",", "cm", ".", "isByUserRequest", "(", ")", ")", ";", "break", ";", "case", "CallbackMessage", ".", "ON_DONE", ":", "notifyOnDoneListeners", "(", "cm", ".", "getJob", "(", ")", ")", ";", "break", ";", "case", "CallbackMessage", ".", "ON_RUN", ":", "notifyOnRunListeners", "(", "cm", ".", "getJob", "(", ")", ",", "cm", ".", "getResultCode", "(", ")", ")", ";", "break", ";", "}", "}", "</s>"]
["<s>", "private", "void", "notifyOnCancelListeners", "(", "Job", "job", ",", "boolean", "byCancelRequest", ")", "{", "for", "(", "JobManagerCallback", "callback", ":", "callbacks", ")", "{", "callback", ".", "onJobCancelled", "(", "job", ",", "byCancelRequest", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "notifyOnRunListeners", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "for", "(", "JobManagerCallback", "callback", ":", "callbacks", ")", "{", "callback", ".", "onJobRun", "(", "job", ",", "resultCode", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "notifyAfterRunListeners", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "for", "(", "JobManagerCallback", "callback", ":", "callbacks", ")", "{", "callback", ".", "onAfterJobRun", "(", "job", ",", "resultCode", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "notifyOnDoneListeners", "(", "Job", "job", ")", "{", "for", "(", "JobManagerCallback", "callback", ":", "callbacks", ")", "{", "callback", ".", "onDone", "(", "job", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "notifyOnAddedListeners", "(", "Job", "job", ")", "{", "for", "(", "JobManagerCallback", "callback", ":", "callbacks", ")", "{", "callback", ".", "onJobAdded", "(", "job", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "notifyOnRun", "(", "Job", "job", ",", "int", "result", ")", "{", "if", "(", "!", "hasAnyCallbacks", "(", ")", ")", "{", "return", ";", "}", "CallbackMessage", "callback", "=", "factory", ".", "obtain", "(", "CallbackMessage", ".", "class", ")", ";", "callback", ".", "set", "(", "job", ",", "CallbackMessage", ".", "ON_RUN", ",", "result", ")", ";", "messageQueue", ".", "post", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "hasAnyCallbacks", "(", ")", "{", "return", "callbacksSize", ".", "get", "(", ")", ">", "0", ";", "}", "</s>"]
["<s>", "public", "void", "notifyAfterRun", "(", "Job", "job", ",", "int", "result", ")", "{", "if", "(", "!", "hasAnyCallbacks", "(", ")", ")", "{", "return", ";", "}", "CallbackMessage", "callback", "=", "factory", ".", "obtain", "(", "CallbackMessage", ".", "class", ")", ";", "callback", ".", "set", "(", "job", ",", "CallbackMessage", ".", "ON_AFTER_RUN", ",", "result", ")", ";", "messageQueue", ".", "post", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "void", "notifyOnCancel", "(", "Job", "job", ",", "boolean", "byCancelRequest", ")", "{", "if", "(", "!", "hasAnyCallbacks", "(", ")", ")", "{", "return", ";", "}", "CallbackMessage", "callback", "=", "factory", ".", "obtain", "(", "CallbackMessage", ".", "class", ")", ";", "callback", ".", "set", "(", "job", ",", "CallbackMessage", ".", "ON_CANCEL", ",", "byCancelRequest", ")", ";", "messageQueue", ".", "post", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "void", "notifyOnAdded", "(", "Job", "job", ")", "{", "if", "(", "!", "hasAnyCallbacks", "(", ")", ")", "{", "return", ";", "}", "CallbackMessage", "callback", "=", "factory", ".", "obtain", "(", "CallbackMessage", ".", "class", ")", ";", "callback", ".", "set", "(", "job", ",", "CallbackMessage", ".", "ON_ADDED", ")", ";", "messageQueue", ".", "post", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "void", "notifyOnDone", "(", "Job", "job", ")", "{", "if", "(", "!", "hasAnyCallbacks", "(", ")", ")", "{", "return", ";", "}", "CallbackMessage", "callback", "=", "factory", ".", "obtain", "(", "CallbackMessage", ".", "class", ")", ";", "callback", ".", "set", "(", "job", ",", "CallbackMessage", ".", "ON_DONE", ")", ";", "messageQueue", ".", "post", "(", "callback", ")", ";", "}", "</s>"]
["<s>", "public", "void", "notifyCancelResult", "(", "CancelResult", "result", ",", "CancelResult", ".", "AsyncCancelCallback", "callback", ")", "{", "CancelResultMessage", "message", "=", "factory", ".", "obtain", "(", "CancelResultMessage", ".", "class", ")", ";", "message", ".", "set", "(", "callback", ",", "result", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "startIfNeeded", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "destroy", "(", ")", "{", "if", "(", "!", "started", ".", "get", "(", ")", ")", "{", "return", ";", "}", "CommandMessage", "message", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "message", ".", "set", "(", "CommandMessage", ".", "QUIT", ")", ";", "messageQueue", ".", "post", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "SchedulerConstraint", "(", ")", "{", "}", "</s>"]
["<s>", "public", "long", "getDelayInMs", "(", ")", "{", "return", "delayInMs", ";", "}", "</s>"]
["<s>", "public", "void", "setDelayInMs", "(", "long", "delayInMs", ")", "{", "this", ".", "delayInMs", "=", "delayInMs", ";", "}", "</s>"]
["<s>", "public", "boolean", "requireUnmeteredNetwork", "(", ")", "{", "return", "requireUnmeteredNetwork", ";", "}", "</s>"]
["<s>", "public", "void", "setRequireUnmeteredNetwork", "(", "boolean", "requireUnmeteredNetwork", ")", "{", "this", ".", "requireUnmeteredNetwork", "=", "requireUnmeteredNetwork", ";", "}", "</s>"]
["<s>", "public", "boolean", "requireNetwork", "(", ")", "{", "return", "requireNetwork", ";", "}", "</s>"]
["<s>", "public", "void", "setRequireNetwork", "(", "boolean", "requireNetwork", ")", "{", "this", ".", "requireNetwork", "=", "requireNetwork", ";", "}", "</s>"]
["<s>", "public", "Object", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "public", "void", "setData", "(", "Object", "data", ")", "{", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "delayInMs", "+", "\"", "<STR_LIT>", "\"", "+", "requireUnmeteredNetwork", "+", "\"", "<STR_LIT>", "\"", "+", "requireNetwork", "+", "\"", "<STR_LIT>", "\"", "+", "data", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "protected", "Scheduler", "(", ")", "{", "}", "</s>"]
["<s>", "public", "final", "void", "init", "(", "Context", "context", ",", "Callback", "callback", ")", "{", "this", ".", "context", "=", "context", ".", "getApplicationContext", "(", ")", ";", "this", ".", "callback", "=", "callback", ";", "}", "</s>"]
["<s>", "public", "Context", "getApplicationContext", "(", ")", "{", "return", "context", ";", "}", "</s>"]
["<s>", "abstract", "public", "void", "request", "(", "SchedulerConstraint", "constraint", ")", ";", "</s>"]
["<s>", "public", "final", "boolean", "start", "(", "SchedulerConstraint", "constraint", ")", "{", "if", "(", "callback", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "callback", ".", "start", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "public", "final", "boolean", "stop", "(", "SchedulerConstraint", "constraint", ")", "{", "if", "(", "callback", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "callback", ".", "stop", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "abstract", "public", "void", "onFinished", "(", "SchedulerConstraint", "constraint", ",", "boolean", "reschedule", ")", ";", "</s>"]
["<s>", "boolean", "start", "(", "SchedulerConstraint", "constraint", ")", ";", "</s>"]
["<s>", "boolean", "stop", "(", "SchedulerConstraint", "constraint", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "onCreate", "(", ")", "{", "super", ".", "onCreate", "(", ")", ";", "getScheduler", "(", ")", ".", "setJobService", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDestroy", "(", ")", "{", "super", ".", "onDestroy", "(", ")", ";", "getScheduler", "(", ")", ".", "setJobService", "(", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onStartJob", "(", "JobParameters", "params", ")", "{", "return", "getScheduler", "(", ")", ".", "onStartJob", "(", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "onStopJob", "(", "JobParameters", "params", ")", "{", "return", "getScheduler", "(", ")", ".", "onStopJob", "(", "params", ")", ";", "}", "</s>"]
["<s>", "abstract", "public", "FrameworkScheduler", "getScheduler", "(", ")", ";", "</s>"]
["<s>", "public", "FrameworkScheduler", "(", "Class", "<", "?", "extends", "FrameworkJobSchedulerService", ">", "serviceImpl", ")", "{", "this", ".", "serviceImpl", "=", "serviceImpl", ";", "}", "</s>"]
["<s>", "public", "void", "setJobService", "(", "@", "Nullable", "JobService", "jobService", ")", "{", "this", ".", "jobService", "=", "jobService", ";", "}", "</s>"]
["<s>", "private", "SharedPreferences", "getPreferences", "(", ")", "{", "if", "(", "preferences", "=", "=", "null", ")", "{", "preferences", "=", "getApplicationContext", "(", ")", ".", "getSharedPreferences", "(", "\"", "<STR_LIT>", "\"", ",", "Context", ".", "MODE_PRIVATE", ")", ";", "}", "return", "preferences", ";", "}", "</s>"]
["<s>", "private", "ComponentName", "getComponentName", "(", ")", "{", "if", "(", "componentName", "=", "=", "null", ")", "{", "componentName", "=", "new", "ComponentName", "(", "getApplicationContext", "(", ")", ".", "getPackageName", "(", ")", ",", "serviceImpl", ".", "getCanonicalName", "(", ")", ")", ";", "}", "return", "componentName", ";", "}", "</s>"]
["<s>", "public", "int", "createId", "(", ")", "{", "final", "SharedPreferences", "preferences", "=", "getPreferences", "(", ")", ";", "final", "int", "id", "=", "preferences", ".", "getInt", "(", "KEY_ID", ",", "0", ")", "+", "1", ";", "preferences", ".", "edit", "(", ")", ".", "putInt", "(", "KEY_ID", ",", "id", ")", ".", "commit", "(", ")", ";", "return", "id", ";", "}", "</s>"]
["<s>", "private", "JobScheduler", "getJobScheduler", "(", ")", "{", "if", "(", "jobScheduler", "=", "=", "null", ")", "{", "jobScheduler", "=", "(", "JobScheduler", ")", "getApplicationContext", "(", ")", ".", "getSystemService", "(", "Context", ".", "JOB_SCHEDULER_SERVICE", ")", ";", "}", "return", "jobScheduler", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "request", "(", "SchedulerConstraint", "constraint", ")", "{", "JobScheduler", "jobScheduler", "=", "getJobScheduler", "(", ")", ";", "final", "int", "id", "=", "createId", "(", ")", ";", "JobInfo", ".", "Builder", "builder", "=", "new", "JobInfo", ".", "Builder", "(", "id", ",", "getComponentName", "(", ")", ")", ".", "setExtras", "(", "toPersistentBundle", "(", "constraint", ")", ")", ".", "setPersisted", "(", "true", ")", ";", "if", "(", "constraint", ".", "requireUnmeteredNetwork", "(", ")", ")", "{", "builder", ".", "setRequiredNetworkType", "(", "JobInfo", ".", "NETWORK_TYPE_UNMETERED", ")", ";", "}", "else", "if", "(", "constraint", ".", "requireNetwork", "(", ")", ")", "{", "builder", ".", "setRequiredNetworkType", "(", "JobInfo", ".", "NETWORK_TYPE_ANY", ")", ";", "}", "else", "{", "builder", ".", "setRequiredNetworkType", "(", "JobInfo", ".", "NETWORK_TYPE_ANY", ")", ";", "builder", ".", "setRequiresDeviceIdle", "(", "true", ")", ";", "}", "int", "scheduled", "=", "jobScheduler", ".", "schedule", "(", "builder", ".", "build", "(", ")", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "scheduled", ">", "0", ",", "scheduled", ",", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onFinished", "(", "SchedulerConstraint", "constraint", ",", "boolean", "reschedule", ")", "{", "if", "(", "JqLog", ".", "isDebugEnabled", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "constraint", ",", "reschedule", ")", ";", "}", "JobService", "service", "=", "this", ".", "jobService", ";", "if", "(", "service", "=", "=", "null", ")", "{", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "Object", "data", "=", "constraint", ".", "getData", "(", ")", ";", "if", "(", "data", "instanceof", "JobParameters", ")", "{", "JobParameters", "params", "=", "(", "JobParameters", ")", "data", ";", "service", ".", "jobFinished", "(", "params", ",", "reschedule", ")", ";", "}", "else", "{", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "PersistableBundle", "toPersistentBundle", "(", "SchedulerConstraint", "constraint", ")", "{", "PersistableBundle", "bundle", "=", "new", "PersistableBundle", "(", ")", ";", "bundle", ".", "putInt", "(", "KEY_REQUIRE_NETWORK", ",", "constraint", ".", "requireNetwork", "(", ")", "?", "1", ":", "0", ")", ";", "bundle", ".", "putInt", "(", "KEY_REQUIRE_UNMETERED_NETWORK", ",", "constraint", ".", "requireUnmeteredNetwork", "(", ")", "?", "1", ":", "0", ")", ";", "bundle", ".", "putLong", "(", "KEY_DELAY", ",", "constraint", ".", "getDelayInMs", "(", ")", ")", ";", "return", "bundle", ";", "}", "</s>"]
["<s>", "private", "static", "SchedulerConstraint", "fromPersistentBundle", "(", "PersistableBundle", "bundle", ")", "{", "SchedulerConstraint", "constraint", "=", "new", "SchedulerConstraint", "(", ")", ";", "constraint", ".", "setRequireNetwork", "(", "bundle", ".", "getInt", "(", "KEY_REQUIRE_NETWORK", ",", "0", ")", "=", "=", "1", ")", ";", "constraint", ".", "setRequireUnmeteredNetwork", "(", "bundle", ".", "getInt", "(", "KEY_REQUIRE_UNMETERED_NETWORK", ",", "0", ")", "=", "=", "1", ")", ";", "constraint", ".", "setDelayInMs", "(", "bundle", ".", "getLong", "(", "KEY_DELAY", ",", "0", ")", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "public", "boolean", "onStartJob", "(", "JobParameters", "params", ")", "{", "SchedulerConstraint", "constraint", "=", "fromPersistentBundle", "(", "params", ".", "getExtras", "(", ")", ")", ";", "if", "(", "JqLog", ".", "isDebugEnabled", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "constraint", ",", "params", ".", "getJobId", "(", ")", ")", ";", "}", "return", "start", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "onStopJob", "(", "JobParameters", "params", ")", "{", "SchedulerConstraint", "constraint", "=", "fromPersistentBundle", "(", "params", ".", "getExtras", "(", ")", ")", ";", "return", "stop", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "compare", "(", "JobHolder", "holder1", ",", "JobHolder", "holder2", ")", "{", "if", "(", "holder1", ".", "getJob", "(", ")", ".", "getId", "(", ")", ".", "equals", "(", "holder2", ".", "getJob", "(", ")", ".", "getId", "(", ")", ")", ")", "{", "return", "0", ";", "}", "int", "cmp", "=", "compareInt", "(", "holder1", ".", "getPriority", "(", ")", ",", "holder2", ".", "getPriority", "(", ")", ")", ";", "if", "(", "cmp", "!", "=", "0", ")", "{", "return", "cmp", ";", "}", "cmp", "=", "-", "compareLong", "(", "holder1", ".", "getCreatedNs", "(", ")", ",", "holder2", ".", "getCreatedNs", "(", ")", ")", ";", "if", "(", "cmp", "!", "=", "0", ")", "{", "return", "cmp", ";", "}", "return", "-", "compareLong", "(", "holder1", ".", "getInsertionOrder", "(", ")", ",", "holder2", ".", "getInsertionOrder", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "int", "compareInt", "(", "int", "i1", ",", "int", "i2", ")", "{", "if", "(", "i1", ">", "i2", ")", "{", "return", "-", "1", ";", "}", "if", "(", "i2", ">", "i1", ")", "{", "return", "1", ";", "}", "return", "0", ";", "}", "</s>"]
["<s>", "private", "int", "compareLong", "(", "long", "l1", ",", "long", "l2", ")", "{", "if", "(", "l1", ">", "l2", ")", "{", "return", "-", "1", ";", "}", "if", "(", "l2", ">", "l1", ")", "{", "return", "1", ";", "}", "return", "0", ";", "}", "</s>"]
["<s>", "public", "SimpleInMemoryPriorityQueue", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Configuration", "configuration", ",", "long", "sessionId", ")", "{", "this", ".", "sessionId", "=", "sessionId", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "insert", "(", "JobHolder", "jobHolder", ")", "{", "jobHolder", ".", "setInsertionOrder", "(", "insertionOrderCounter", ".", "incrementAndGet", "(", ")", ")", ";", "JobHolder", "existing", "=", "idCache", ".", "get", "(", "jobHolder", ".", "getId", "(", ")", ")", ";", "if", "(", "existing", "!", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "idCache", ".", "put", "(", "jobHolder", ".", "getId", "(", ")", ",", "jobHolder", ")", ";", "jobs", ".", "add", "(", "jobHolder", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "insertOrReplace", "(", "JobHolder", "jobHolder", ")", "{", "if", "(", "jobHolder", ".", "getInsertionOrder", "(", ")", "=", "=", "null", ")", "{", "return", "insert", "(", "jobHolder", ")", ";", "}", "JobHolder", "existing", "=", "idCache", ".", "get", "(", "jobHolder", ".", "getId", "(", ")", ")", ";", "if", "(", "existing", "!", "=", "null", ")", "{", "remove", "(", "existing", ")", ";", "}", "idCache", ".", "put", "(", "jobHolder", ".", "getId", "(", ")", ",", "jobHolder", ")", ";", "jobs", ".", "add", "(", "jobHolder", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", "JobHolder", "jobHolder", ")", "{", "idCache", ".", "remove", "(", "jobHolder", ".", "getId", "(", ")", ")", ";", "jobs", ".", "remove", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "count", "(", ")", "{", "return", "jobs", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "countReadyJobs", "(", "Constraint", "constraint", ")", "{", "int", "count", "=", "0", ";", "reusedList", ".", "clear", "(", ")", ";", "for", "(", "JobHolder", "holder", ":", "jobs", ")", "{", "String", "groupId", "=", "holder", ".", "getGroupId", "(", ")", ";", "if", "(", "(", "groupId", "=", "=", "null", "|", "|", "!", "reusedList", ".", "contains", "(", "groupId", ")", ")", "&", "&", "matches", "(", "holder", ",", "constraint", ")", ")", "{", "count", "+", "+", ";", "if", "(", "groupId", "!", "=", "null", ")", "{", "reusedList", ".", "add", "(", "groupId", ")", ";", "}", "}", "}", "reusedList", ".", "clear", "(", ")", ";", "return", "count", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "nextJobAndIncRunCount", "(", "Constraint", "constraint", ")", "{", "for", "(", "JobHolder", "holder", ":", "jobs", ")", "{", "if", "(", "matches", "(", "holder", ",", "constraint", ")", ")", "{", "remove", "(", "holder", ")", ";", "holder", ".", "setRunCount", "(", "holder", ".", "getRunCount", "(", ")", "+", "1", ")", ";", "holder", ".", "setRunningSessionId", "(", "sessionId", ")", ";", "return", "holder", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "static", "Long", "getDelayUntil", "(", "JobHolder", "holder", ",", "boolean", "hasNetwork", ",", "boolean", "hasUnmetered", ")", "{", "final", "long", "networkTimeout", "=", "holder", ".", "getRequiresNetworkUntilNs", "(", ")", ";", "final", "long", "unmeteredTimeout", "=", "holder", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ";", "long", "delay", "=", "holder", ".", "getDelayUntilNs", "(", ")", ";", "if", "(", "!", "hasNetwork", ")", "{", "if", "(", "networkTimeout", "=", "=", "Params", ".", "FOREVER", ")", "{", "return", "null", ";", "}", "delay", "=", "Math", ".", "max", "(", "delay", ",", "networkTimeout", ")", ";", "}", "if", "(", "!", "hasUnmetered", ")", "{", "if", "(", "unmeteredTimeout", "=", "=", "Params", ".", "FOREVER", ")", "{", "return", "null", ";", "}", "delay", "=", "Math", ".", "max", "(", "delay", ",", "unmeteredTimeout", ")", ";", "}", "return", "delay", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "getNextJobDelayUntilNs", "(", "Constraint", "constraint", ")", "{", "Long", "minDelay", "=", "null", ";", "boolean", "hasNetwork", "=", "!", "constraint", ".", "shouldNotRequireNetwork", "(", ")", ";", "boolean", "hasUnmetered", "=", "!", "constraint", ".", "shouldNotRequireUnmeteredNetwork", "(", ")", ";", "if", "(", "!", "hasNetwork", "|", "|", "!", "hasUnmetered", ")", "{", "for", "(", "JobHolder", "holder", ":", "jobs", ")", "{", "if", "(", "matches", "(", "holder", ",", "constraint", ",", "true", ")", ")", "{", "final", "Long", "delay", "=", "getDelayUntil", "(", "holder", ",", "hasNetwork", ",", "hasUnmetered", ")", ";", "if", "(", "delay", "=", "=", "null", ")", "{", "continue", ";", "}", "if", "(", "minDelay", "=", "=", "null", "|", "|", "delay", "<", "minDelay", ")", "{", "minDelay", "=", "delay", ";", "}", "}", "}", "}", "else", "{", "for", "(", "JobHolder", "holder", ":", "jobs", ")", "{", "if", "(", "matches", "(", "holder", ",", "constraint", ")", ")", "{", "if", "(", "minDelay", "=", "=", "null", "|", "|", "holder", ".", "getDelayUntilNs", "(", ")", "<", "minDelay", ")", "{", "minDelay", "=", "holder", ".", "getDelayUntilNs", "(", ")", ";", "}", "}", "}", "}", "return", "minDelay", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "jobs", ".", "clear", "(", ")", ";", "idCache", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "findJobById", "(", "String", "id", ")", "{", "return", "idCache", ".", "get", "(", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "<", "JobHolder", ">", "findJobs", "(", "Constraint", "constraint", ")", "{", "Set", "<", "JobHolder", ">", "result", "=", "new", "HashSet", "<", ">", "(", ")", ";", "for", "(", "JobHolder", "holder", ":", "jobs", ")", "{", "if", "(", "matches", "(", "holder", ",", "constraint", ")", ")", "{", "result", ".", "add", "(", "holder", ")", ";", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobCancelled", "(", "JobHolder", "holder", ")", "{", "remove", "(", "holder", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "matches", "(", "JobHolder", "holder", ",", "Constraint", "constraint", ")", "{", "return", "matches", "(", "holder", ",", "constraint", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "private", "static", "boolean", "matches", "(", "JobHolder", "holder", ",", "Constraint", "constraint", ",", "boolean", "ignoreNetwork", ")", "{", "if", "(", "!", "ignoreNetwork", ")", "{", "if", "(", "constraint", ".", "shouldNotRequireNetwork", "(", ")", "&", "&", "holder", ".", "requiresNetwork", "(", "constraint", ".", "getNowInNs", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "constraint", ".", "shouldNotRequireUnmeteredNetwork", "(", ")", "&", "&", "holder", ".", "requiresUnmeteredNetwork", "(", "constraint", ".", "getNowInNs", "(", ")", ")", ")", "{", "return", "false", ";", "}", "}", "if", "(", "constraint", ".", "getTimeLimit", "(", ")", "!", "=", "null", "&", "&", "holder", ".", "getDelayUntilNs", "(", ")", ">", "constraint", ".", "getTimeLimit", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "holder", ".", "getGroupId", "(", ")", "!", "=", "null", "&", "&", "constraint", ".", "getExcludeGroups", "(", ")", ".", "contains", "(", "holder", ".", "getGroupId", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "constraint", ".", "getExcludeJobIds", "(", ")", ".", "contains", "(", "holder", ".", "getId", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "constraint", ".", "getTagConstraint", "(", ")", "!", "=", "null", "&", "&", "(", "holder", ".", "getTags", "(", ")", "=", "=", "null", "|", "|", "constraint", ".", "getTags", "(", ")", ".", "isEmpty", "(", ")", "|", "|", "!", "constraint", ".", "getTagConstraint", "(", ")", ".", "matches", "(", "constraint", ".", "getTags", "(", ")", ",", "holder", ".", "getTags", "(", ")", ")", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "MessageFactory", "(", ")", "{", "Arrays", ".", "fill", "(", "counts", ",", "0", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", "extends", "Message", ">", "T", "obtain", "(", "Class", "<", "T", ">", "klass", ")", "{", "final", "Type", "type", "=", "Type", ".", "mapping", ".", "get", "(", "klass", ")", ";", "synchronized", "(", "type", ")", "{", "Message", "message", "=", "pools", "[", "type", ".", "ordinal", "(", ")", "]", ";", "if", "(", "message", "!", "=", "null", ")", "{", "pools", "[", "type", ".", "ordinal", "(", ")", "]", "=", "message", ".", "next", ";", "counts", "[", "type", ".", "ordinal", "(", ")", "]", "-", "=", "1", ";", "message", ".", "next", "=", "null", ";", "return", "(", "T", ")", "message", ";", "}", "try", "{", "return", "klass", ".", "newInstance", "(", ")", ";", "}", "catch", "(", "InstantiationException", "e", ")", "{", "JqLog", ".", "e", "(", "e", ",", "\"", "<STR_LIT>", "\"", "+", "klass", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "JqLog", ".", "e", "(", "e", ",", "\"", "<STR_LIT>", "\"", "+", "klass", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "void", "release", "(", "Message", "message", ")", "{", "final", "Type", "type", "=", "message", ".", "type", ";", "message", ".", "recycle", "(", ")", ";", "synchronized", "(", "type", ")", "{", "if", "(", "counts", "[", "type", ".", "ordinal", "(", ")", "]", "<", "CACHE_LIMIT", ")", "{", "message", ".", "next", "=", "pools", "[", "type", ".", "ordinal", "(", ")", "]", ";", "pools", "[", "type", ".", "ordinal", "(", ")", "]", "=", "message", ";", "counts", "[", "type", ".", "ordinal", "(", ")", "]", "+", "=", "1", ";", "}", "}", "}", "</s>"]
["<s>", "protected", "Message", "(", "Type", "type", ")", "{", "this", ".", "type", "=", "type", ";", "}", "</s>"]
["<s>", "abstract", "protected", "void", "onRecycled", "(", ")", ";", "</s>"]
["<s>", "final", "void", "recycle", "(", ")", "{", "next", "=", "null", ";", "readyNs", "=", "Long", ".", "MIN_VALUE", ";", "onRecycled", "(", ")", ";", "}", "</s>"]
["<s>", "DelayedMessageBag", "(", "MessageFactory", "factory", ")", "{", "this", ".", "factory", "=", "factory", ";", "}", "</s>"]
["<s>", "Long", "flushReadyMessages", "(", "long", "now", ",", "MessageQueue", "addInto", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "now", ")", ";", "while", "(", "queue", "!", "=", "null", "&", "&", "queue", ".", "readyNs", "<", "=", "now", ")", "{", "Message", "msg", "=", "queue", ";", "queue", "=", "msg", ".", "next", ";", "msg", ".", "next", "=", "null", ";", "addInto", ".", "post", "(", "msg", ")", ";", "}", "if", "(", "queue", "!", "=", "null", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "(", "queue", ".", "readyNs", "-", "now", ")", ")", ";", "return", "queue", ".", "readyNs", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "void", "add", "(", "Message", "message", ",", "long", "readyNs", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "readyNs", ")", ";", "message", ".", "readyNs", "=", "readyNs", ";", "if", "(", "queue", "=", "=", "null", ")", "{", "queue", "=", "message", ";", "return", ";", "}", "Message", "prev", "=", "null", ";", "Message", "curr", "=", "queue", ";", "while", "(", "curr", "!", "=", "null", "&", "&", "curr", ".", "readyNs", "<", "=", "readyNs", ")", "{", "prev", "=", "curr", ";", "curr", "=", "curr", ".", "next", ";", "}", "if", "(", "prev", "=", "=", "null", ")", "{", "message", ".", "next", "=", "queue", ";", "queue", "=", "message", ";", "}", "else", "{", "prev", ".", "next", "=", "message", ";", "message", ".", "next", "=", "curr", ";", "}", "}", "</s>"]
["<s>", "public", "void", "clear", "(", ")", "{", "while", "(", "queue", "!", "=", "null", ")", "{", "Message", "curr", "=", "queue", ";", "queue", "=", "curr", ".", "next", ";", "factory", ".", "release", "(", "curr", ")", ";", "}", "queue", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "removeMessages", "(", "MessagePredicate", "predicate", ")", "{", "Message", "prev", "=", "null", ";", "Message", "curr", "=", "queue", ";", "while", "(", "curr", "!", "=", "null", ")", "{", "final", "boolean", "remove", "=", "predicate", ".", "onMessage", "(", "curr", ")", ";", "final", "Message", "next", "=", "curr", ".", "next", ";", "if", "(", "remove", ")", "{", "if", "(", "prev", "=", "=", "null", ")", "{", "queue", "=", "curr", ".", "next", ";", "}", "else", "{", "prev", ".", "next", "=", "curr", ".", "next", ";", "}", "factory", ".", "release", "(", "curr", ")", ";", "}", "else", "{", "prev", "=", "curr", ";", "}", "curr", "=", "next", ";", "}", "}", "</s>"]
["<s>", "public", "UnsafeMessageQueue", "(", "MessageFactory", "factory", ",", "String", "logTag", ")", "{", "this", ".", "factory", "=", "factory", ";", "this", ".", "logTag", "=", "logTag", "+", "\"", "<STR_LIT:_>", "\"", "+", "idCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "Message", "next", "(", ")", "{", "final", "Message", "result", "=", "queue", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "logTag", ",", "result", ")", ";", "if", "(", "result", "!", "=", "null", ")", "{", "queue", "=", "result", ".", "next", ";", "if", "(", "tail", "=", "=", "result", ")", "{", "tail", "=", "null", ";", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "protected", "void", "post", "(", "Message", "message", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "logTag", ",", "message", ")", ";", "if", "(", "tail", "=", "=", "null", ")", "{", "queue", "=", "message", ";", "tail", "=", "message", ";", "}", "else", "{", "tail", ".", "next", "=", "message", ";", "tail", "=", "message", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "postAtFront", "(", "Message", "message", ")", "{", "message", ".", "next", "=", "queue", ";", "if", "(", "tail", "=", "=", "null", ")", "{", "tail", "=", "message", ";", "}", "queue", "=", "message", ";", "}", "</s>"]
["<s>", "protected", "void", "removeMessages", "(", "MessagePredicate", "predicate", ")", "{", "Message", "prev", "=", "null", ";", "Message", "curr", "=", "queue", ";", "while", "(", "curr", "!", "=", "null", ")", "{", "final", "boolean", "remove", "=", "predicate", ".", "onMessage", "(", "curr", ")", ";", "if", "(", "remove", ")", "{", "final", "Message", "next", "=", "curr", ".", "next", ";", "remove", "(", "prev", ",", "curr", ")", ";", "curr", "=", "next", ";", "}", "else", "{", "prev", "=", "curr", ";", "curr", "=", "curr", ".", "next", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "remove", "(", "Message", "prev", ",", "Message", "curr", ")", "{", "if", "(", "tail", "=", "=", "curr", ")", "{", "tail", "=", "prev", ";", "}", "if", "(", "prev", "=", "=", "null", ")", "{", "queue", "=", "curr", ".", "next", ";", "}", "else", "{", "prev", ".", "next", "=", "curr", ".", "next", ";", "}", "factory", ".", "release", "(", "curr", ")", ";", "}", "</s>"]
["<s>", "public", "void", "clear", "(", ")", "{", "while", "(", "queue", "!", "=", "null", ")", "{", "Message", "curr", "=", "queue", ";", "queue", "=", "curr", ".", "next", ";", "factory", ".", "release", "(", "curr", ")", ";", "}", "tail", "=", "null", ";", "}", "</s>"]
["<s>", "Type", "(", "Class", "<", "?", "extends", "Message", ">", "klass", ",", "int", "priority", ")", "{", "this", ".", "klass", "=", "klass", ";", "this", ".", "priority", "=", "priority", ";", "}", "</s>"]
["<s>", "public", "SafeMessageQueue", "(", "Timer", "timer", ",", "MessageFactory", "factory", ",", "String", "logTag", ")", "{", "super", "(", "factory", ",", "logTag", ")", ";", "this", ".", "factory", "=", "factory", ";", "this", ".", "timer", "=", "timer", ";", "this", ".", "delayedBag", "=", "new", "DelayedMessageBag", "(", "factory", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isRunning", "(", ")", "{", "return", "running", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "consume", "(", "MessageQueueConsumer", "consumer", ")", "{", "if", "(", "running", ".", "getAndSet", "(", "true", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "consumer", ".", "onStart", "(", ")", ";", "while", "(", "running", ".", "get", "(", ")", ")", "{", "Message", "message", "=", "next", "(", "consumer", ")", ";", "if", "(", "message", "!", "=", "null", ")", "{", "consumer", ".", "handleMessage", "(", "message", ")", ";", "factory", ".", "release", "(", "message", ")", ";", "}", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "logTag", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "stop", "(", ")", "{", "running", ".", "set", "(", "false", ")", ";", "synchronized", "(", "LOCK", ")", "{", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "clear", "(", ")", "{", "synchronized", "(", "LOCK", ")", "{", "super", ".", "clear", "(", ")", ";", "}", "}", "</s>"]
["<s>", "Message", "next", "(", "MessageQueueConsumer", "consumer", ")", "{", "boolean", "calledIdle", "=", "false", ";", "while", "(", "running", ".", "get", "(", ")", ")", "{", "final", "Long", "nextDelayedReadyAt", ";", "final", "long", "now", ";", "synchronized", "(", "LOCK", ")", "{", "now", "=", "timer", ".", "nanoTime", "(", ")", ";", "nextDelayedReadyAt", "=", "delayedBag", ".", "flushReadyMessages", "(", "now", ",", "this", ")", ";", "Message", "message", "=", "super", ".", "next", "(", ")", ";", "if", "(", "message", "!", "=", "null", ")", "{", "return", "message", ";", "}", "postMessageTick", "=", "false", ";", "}", "if", "(", "!", "calledIdle", ")", "{", "consumer", ".", "onIdle", "(", ")", ";", "calledIdle", "=", "true", ";", "}", "synchronized", "(", "LOCK", ")", "{", "if", "(", "postMessageTick", ")", "{", "continue", ";", "}", "if", "(", "nextDelayedReadyAt", "!", "=", "null", "&", "&", "nextDelayedReadyAt", "<", "=", "now", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "logTag", ")", ";", "continue", ";", "}", "if", "(", "running", ".", "get", "(", ")", ")", "{", "try", "{", "if", "(", "nextDelayedReadyAt", "=", "=", "null", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "logTag", ")", ";", "timer", ".", "waitOnObject", "(", "LOCK", ")", ";", "}", "else", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "logTag", ",", "nextDelayedReadyAt", ")", ";", "timer", ".", "waitOnObjectUntilNs", "(", "LOCK", ",", "nextDelayedReadyAt", ")", ";", "}", "}", "catch", "(", "InterruptedException", "ignored", ")", "{", "}", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "post", "(", "Message", "message", ")", "{", "synchronized", "(", "LOCK", ")", "{", "postMessageTick", "=", "true", ";", "super", ".", "post", "(", "message", ")", ";", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postAt", "(", "Message", "message", ",", "long", "readyNs", ")", "{", "synchronized", "(", "LOCK", ")", "{", "postMessageTick", "=", "true", ";", "delayedBag", ".", "add", "(", "message", ",", "readyNs", ")", ";", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "cancelMessages", "(", "MessagePredicate", "predicate", ")", "{", "synchronized", "(", "LOCK", ")", "{", "super", ".", "removeMessages", "(", "predicate", ")", ";", "delayedBag", ".", "removeMessages", "(", "predicate", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postAtFront", "(", "Message", "message", ")", "{", "synchronized", "(", "LOCK", ")", "{", "postMessageTick", "=", "true", ";", "super", ".", "postAtFront", "(", "message", ")", ";", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "void", "post", "(", "Message", "message", ")", ";", "</s>"]
["<s>", "void", "postAt", "(", "Message", "message", ",", "long", "readyNs", ")", ";", "</s>"]
["<s>", "void", "cancelMessages", "(", "MessagePredicate", "predicate", ")", ";", "</s>"]
["<s>", "void", "stop", "(", ")", ";", "</s>"]
["<s>", "void", "consume", "(", "MessageQueueConsumer", "consumer", ")", ";", "</s>"]
["<s>", "void", "clear", "(", ")", ";", "</s>"]
["<s>", "abstract", "public", "void", "handleMessage", "(", "Message", "message", ")", ";", "</s>"]
["<s>", "abstract", "public", "void", "onIdle", "(", ")", ";", "</s>"]
["<s>", "public", "void", "onStart", "(", ")", "{", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "PriorityMessageQueue", "(", "Timer", "timer", ",", "MessageFactory", "factory", ")", "{", "delayedBag", "=", "new", "DelayedMessageBag", "(", "factory", ")", ";", "this", ".", "factory", "=", "factory", ";", "queues", "=", "new", "UnsafeMessageQueue", "[", "Type", ".", "MAX_PRIORITY", "+", "1", "]", ";", "this", ".", "timer", "=", "timer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "consume", "(", "MessageQueueConsumer", "consumer", ")", "{", "if", "(", "running", ".", "getAndSet", "(", "true", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "while", "(", "running", ".", "get", "(", ")", ")", "{", "Message", "message", "=", "next", "(", "consumer", ")", ";", "if", "(", "message", "!", "=", "null", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "LOG_TAG", ",", "message", ".", "type", ")", ";", "consumer", ".", "handleMessage", "(", "message", ")", ";", "factory", ".", "release", "(", "message", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "synchronized", "(", "LOCK", ")", "{", "for", "(", "int", "i", "=", "Type", ".", "MAX_PRIORITY", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "UnsafeMessageQueue", "mq", "=", "queues", "[", "i", "]", ";", "if", "(", "mq", "=", "=", "null", ")", "{", "continue", ";", "}", "mq", ".", "clear", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "stop", "(", ")", "{", "running", ".", "set", "(", "false", ")", ";", "synchronized", "(", "LOCK", ")", "{", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Message", "next", "(", "MessageQueueConsumer", "consumer", ")", "{", "boolean", "calledOnIdle", "=", "false", ";", "while", "(", "running", ".", "get", "(", ")", ")", "{", "final", "Long", "nextDelayedReadyAt", ";", "final", "long", "now", ";", "synchronized", "(", "LOCK", ")", "{", "now", "=", "timer", ".", "nanoTime", "(", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "LOG_TAG", ",", "now", ")", ";", "nextDelayedReadyAt", "=", "delayedBag", ".", "flushReadyMessages", "(", "now", ",", "this", ")", ";", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "LOG_TAG", ",", "nextDelayedReadyAt", ")", ";", "for", "(", "int", "i", "=", "Type", ".", "MAX_PRIORITY", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "UnsafeMessageQueue", "mq", "=", "queues", "[", "i", "]", ";", "if", "(", "mq", "=", "=", "null", ")", "{", "continue", ";", "}", "Message", "message", "=", "mq", ".", "next", "(", ")", ";", "if", "(", "message", "!", "=", "null", ")", "{", "return", "message", ";", "}", "}", "postJobTick", "=", "false", ";", "}", "if", "(", "!", "calledOnIdle", ")", "{", "consumer", ".", "onIdle", "(", ")", ";", "calledOnIdle", "=", "true", ";", "}", "synchronized", "(", "LOCK", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "LOG_TAG", ",", "postJobTick", ")", ";", "if", "(", "postJobTick", ")", "{", "continue", ";", "}", "if", "(", "nextDelayedReadyAt", "!", "=", "null", "&", "&", "nextDelayedReadyAt", "<", "=", "now", ")", "{", "continue", ";", "}", "if", "(", "running", ".", "get", "(", ")", ")", "{", "try", "{", "if", "(", "nextDelayedReadyAt", "=", "=", "null", ")", "{", "timer", ".", "waitOnObject", "(", "LOCK", ")", ";", "}", "else", "{", "timer", ".", "waitOnObjectUntilNs", "(", "LOCK", ",", "nextDelayedReadyAt", ")", ";", "}", "}", "catch", "(", "InterruptedException", "ignored", ")", "{", "}", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "post", "(", "Message", "message", ")", "{", "synchronized", "(", "LOCK", ")", "{", "postJobTick", "=", "true", ";", "int", "index", "=", "message", ".", "type", ".", "priority", ";", "if", "(", "queues", "[", "index", "]", "=", "=", "null", ")", "{", "queues", "[", "index", "]", "=", "new", "UnsafeMessageQueue", "(", "factory", ",", "\"", "<STR_LIT:_>", "\"", "+", "message", ".", "type", ".", "name", "(", ")", ")", ";", "}", "queues", "[", "index", "]", ".", "post", "(", "message", ")", ";", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postAt", "(", "Message", "message", ",", "long", "readyNs", ")", "{", "synchronized", "(", "LOCK", ")", "{", "postJobTick", "=", "true", ";", "delayedBag", ".", "add", "(", "message", ",", "readyNs", ")", ";", "timer", ".", "notifyObject", "(", "LOCK", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "cancelMessages", "(", "MessagePredicate", "predicate", ")", "{", "synchronized", "(", "LOCK", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "=", "Type", ".", "MAX_PRIORITY", ";", "i", "+", "+", ")", "{", "UnsafeMessageQueue", "mq", "=", "queues", "[", "i", "]", ";", "if", "(", "mq", "=", "=", "null", ")", "{", "continue", ";", "}", "mq", ".", "removeMessages", "(", "predicate", ")", ";", "}", "delayedBag", ".", "removeMessages", "(", "predicate", ")", ";", "}", "}", "</s>"]
["<s>", "boolean", "onMessage", "(", "Message", "message", ")", ";", "</s>"]
["<s>", "public", "CancelMessage", "(", ")", "{", "super", "(", "Type", ".", "CANCEL", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "}", "</s>"]
["<s>", "public", "TagConstraint", "getConstraint", "(", ")", "{", "return", "constraint", ";", "}", "</s>"]
["<s>", "public", "void", "setConstraint", "(", "TagConstraint", "constraint", ")", "{", "this", ".", "constraint", "=", "constraint", ";", "}", "</s>"]
["<s>", "public", "String", "[", "]", "getTags", "(", ")", "{", "return", "tags", ";", "}", "</s>"]
["<s>", "public", "void", "setTags", "(", "String", "[", "]", "tags", ")", "{", "this", ".", "tags", "=", "tags", ";", "}", "</s>"]
["<s>", "public", "CancelResult", ".", "AsyncCancelCallback", "getCallback", "(", ")", "{", "return", "callback", ";", "}", "</s>"]
["<s>", "public", "void", "setCallback", "(", "CancelResult", ".", "AsyncCancelCallback", "callback", ")", "{", "this", ".", "callback", "=", "callback", ";", "}", "</s>"]
["<s>", "public", "CancelResultMessage", "(", ")", "{", "super", "(", "Type", ".", "CANCEL_RESULT_CALLBACK", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "result", "=", "null", ";", "callback", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "CancelResult", ".", "AsyncCancelCallback", "callback", ",", "CancelResult", "result", ")", "{", "this", ".", "callback", "=", "callback", ";", "this", ".", "result", "=", "result", ";", "}", "</s>"]
["<s>", "public", "CancelResult", ".", "AsyncCancelCallback", "getCallback", "(", ")", "{", "return", "callback", ";", "}", "</s>"]
["<s>", "public", "CancelResult", "getResult", "(", ")", "{", "return", "result", ";", "}", "</s>"]
["<s>", "public", "JobConsumerIdleMessage", "(", ")", "{", "super", "(", "Type", ".", "JOB_CONSUMER_IDLE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "worker", "=", "null", ";", "}", "</s>"]
["<s>", "public", "long", "getLastJobCompleted", "(", ")", "{", "return", "lastJobCompleted", ";", "}", "</s>"]
["<s>", "public", "Object", "getWorker", "(", ")", "{", "return", "worker", ";", "}", "</s>"]
["<s>", "public", "void", "setWorker", "(", "Object", "worker", ")", "{", "this", ".", "worker", "=", "worker", ";", "}", "</s>"]
["<s>", "public", "void", "setLastJobCompleted", "(", "long", "lastJobCompleted", ")", "{", "this", ".", "lastJobCompleted", "=", "lastJobCompleted", ";", "}", "</s>"]
["<s>", "public", "PublicQueryMessage", "(", ")", "{", "super", "(", "Type", ".", "PUBLIC_QUERY", ")", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "int", "what", ",", "IntCallback", "callback", ")", "{", "this", ".", "callback", "=", "callback", ";", "this", ".", "what", "=", "what", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "int", "what", ",", "String", "stringArg", ",", "IntCallback", "callback", ")", "{", "this", ".", "what", "=", "what", ";", "this", ".", "stringArg", "=", "stringArg", ";", "this", ".", "callback", "=", "callback", ";", "}", "</s>"]
["<s>", "public", "IntCallback", "getCallback", "(", ")", "{", "return", "callback", ";", "}", "</s>"]
["<s>", "public", "int", "getWhat", "(", ")", "{", "return", "what", ";", "}", "</s>"]
["<s>", "public", "String", "getStringArg", "(", ")", "{", "return", "stringArg", ";", "}", "</s>"]
["<s>", "public", "void", "setCallback", "(", "IntCallback", "callback", ")", "{", "this", ".", "callback", "=", "callback", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "callback", "=", "null", ";", "what", "=", "-", "1", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "what", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "</s>"]
["<s>", "public", "RunJobResultMessage", "(", ")", "{", "super", "(", "Type", ".", "RUN_JOB_RESULT", ")", ";", "}", "</s>"]
["<s>", "public", "JobHolder", "getJobHolder", "(", ")", "{", "return", "jobHolder", ";", "}", "</s>"]
["<s>", "public", "void", "setJobHolder", "(", "JobHolder", "jobHolder", ")", "{", "this", ".", "jobHolder", "=", "jobHolder", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "jobHolder", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "setResult", "(", "int", "result", ")", "{", "this", ".", "result", "=", "result", ";", "}", "</s>"]
["<s>", "public", "int", "getResult", "(", ")", "{", "return", "result", ";", "}", "</s>"]
["<s>", "public", "Object", "getWorker", "(", ")", "{", "return", "worker", ";", "}", "</s>"]
["<s>", "public", "void", "setWorker", "(", "Object", "worker", ")", "{", "this", ".", "worker", "=", "worker", ";", "}", "</s>"]
["<s>", "public", "CommandMessage", "(", ")", "{", "super", "(", "Type", ".", "COMMAND", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "what", "=", "-", "1", ";", "}", "</s>"]
["<s>", "public", "int", "getWhat", "(", ")", "{", "return", "what", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "int", "what", ")", "{", "this", ".", "what", "=", "what", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "what", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "</s>"]
["<s>", "public", "SchedulerMessage", "(", ")", "{", "super", "(", "Type", ".", "SCHEDULER", ")", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "int", "what", ",", "SchedulerConstraint", "constraint", ")", "{", "this", ".", "what", "=", "what", ";", "this", ".", "constraint", "=", "constraint", ";", "}", "</s>"]
["<s>", "public", "int", "getWhat", "(", ")", "{", "return", "what", ";", "}", "</s>"]
["<s>", "@", "NonNull", "public", "SchedulerConstraint", "getConstraint", "(", ")", "{", "return", "constraint", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "IntCallback", "getCallback", "(", ")", "{", "return", "resultCallback", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "constraint", "=", "null", ";", "resultCallback", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setCallback", "(", "IntCallback", "intCallback", ")", "{", "this", ".", "resultCallback", "=", "intCallback", ";", "}", "</s>"]
["<s>", "public", "ConstraintChangeMessage", "(", ")", "{", "super", "(", "Type", ".", "CONSTRAINT_CHANGE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "}", "</s>"]
["<s>", "public", "AddJobMessage", "(", ")", "{", "super", "(", "Type", ".", "ADD_JOB", ")", ";", "}", "</s>"]
["<s>", "public", "Job", "getJob", "(", ")", "{", "return", "job", ";", "}", "</s>"]
["<s>", "public", "void", "setJob", "(", "Job", "job", ")", "{", "this", ".", "job", "=", "job", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "job", "=", "null", ";", "}", "</s>"]
["<s>", "public", "RunJobMessage", "(", ")", "{", "super", "(", "Type", ".", "RUN_JOB", ")", ";", "}", "</s>"]
["<s>", "public", "JobHolder", "getJobHolder", "(", ")", "{", "return", "jobHolder", ";", "}", "</s>"]
["<s>", "public", "void", "setJobHolder", "(", "JobHolder", "jobHolder", ")", "{", "this", ".", "jobHolder", "=", "jobHolder", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "jobHolder", "=", "null", ";", "}", "</s>"]
["<s>", "public", "CallbackMessage", "(", ")", "{", "super", "(", "Type", ".", "CALLBACK", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onRecycled", "(", ")", "{", "job", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "Job", "job", ",", "int", "what", ")", "{", "this", ".", "what", "=", "what", ";", "this", ".", "job", "=", "job", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "Job", "job", ",", "int", "what", ",", "int", "resultCode", ")", "{", "this", ".", "what", "=", "what", ";", "this", ".", "resultCode", "=", "resultCode", ";", "this", ".", "job", "=", "job", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "Job", "job", ",", "int", "what", ",", "boolean", "byUserRequest", ")", "{", "this", ".", "what", "=", "what", ";", "this", ".", "byUserRequest", "=", "byUserRequest", ";", "this", ".", "job", "=", "job", ";", "}", "</s>"]
["<s>", "public", "int", "getWhat", "(", ")", "{", "return", "what", ";", "}", "</s>"]
["<s>", "public", "int", "getResultCode", "(", ")", "{", "return", "resultCode", ";", "}", "</s>"]
["<s>", "public", "boolean", "isByUserRequest", "(", ")", "{", "return", "byUserRequest", ";", "}", "</s>"]
["<s>", "public", "Job", "getJob", "(", ")", "{", "return", "job", ";", "}", "</s>"]
["<s>", "JobQueue", "createPersistentQueue", "(", "Context", "context", ",", "Long", "sessionId", ",", "String", "id", ",", "boolean", "inTestMode", ",", "Timer", "timer", ")", ";", "</s>"]
["<s>", "JobQueue", "createNonPersistent", "(", "Context", "context", ",", "Long", "sessionId", ",", "String", "id", ",", "boolean", "inTestMode", ",", "Timer", "timer", ")", ";", "</s>"]
["<s>", "public", "boolean", "matches", "(", "String", "[", "]", "constraintTags", ",", "Set", "<", "String", ">", "jobTags", ")", "{", "if", "(", "this", "=", "=", "TagConstraint", ".", "ANY", ")", "{", "for", "(", "String", "tag", ":", "constraintTags", ")", "{", "if", "(", "jobTags", ".", "contains", "(", "tag", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "else", "{", "for", "(", "String", "tag", ":", "constraintTags", ")", "{", "if", "(", "!", "jobTags", ".", "contains", "(", "tag", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "matches", "(", "Collection", "<", "String", ">", "constraintTags", ",", "Set", "<", "String", ">", "jobTags", ")", "{", "if", "(", "this", "=", "=", "TagConstraint", ".", "ANY", ")", "{", "for", "(", "String", "tag", ":", "constraintTags", ")", "{", "if", "(", "jobTags", ".", "contains", "(", "tag", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "else", "{", "for", "(", "String", "tag", ":", "constraintTags", ")", "{", "if", "(", "!", "jobTags", ".", "contains", "(", "tag", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "}", "</s>"]
["<s>", "public", "CancelResult", "(", ")", "{", "this", ".", "cancelledJobs", "=", "new", "HashSet", "<", ">", "(", ")", ";", "this", ".", "failedToCancel", "=", "new", "HashSet", "<", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "CancelResult", "(", "Collection", "<", "Job", ">", "cancelledJobs", ",", "Collection", "<", "Job", ">", "failedToCancel", ")", "{", "this", ".", "cancelledJobs", "=", "cancelledJobs", ";", "this", ".", "failedToCancel", "=", "failedToCancel", ";", "}", "</s>"]
["<s>", "public", "Collection", "<", "Job", ">", "getCancelledJobs", "(", ")", "{", "return", "cancelledJobs", ";", "}", "</s>"]
["<s>", "public", "Collection", "<", "Job", ">", "getFailedToCancel", "(", ")", "{", "return", "failedToCancel", ";", "}", "</s>"]
["<s>", "void", "onCancelled", "(", "CancelResult", "cancelResult", ")", ";", "</s>"]
["<s>", "protected", "Job", "(", "Params", "params", ")", "{", "this", ".", "requiresNetworkTimeoutMs", "=", "params", ".", "getRequiresNetworkTimeoutMs", "(", ")", ";", "this", ".", "requiresUnmeteredNetworkTimeoutMs", "=", "params", ".", "getRequiresUnmeteredNetworkTimeoutMs", "(", ")", ";", "this", ".", "persistent", "=", "params", ".", "isPersistent", "(", ")", ";", "this", ".", "groupId", "=", "params", ".", "getGroupId", "(", ")", ";", "this", ".", "priority", "=", "params", ".", "getPriority", "(", ")", ";", "this", ".", "delayInMs", "=", "params", ".", "getDelayMs", "(", ")", ";", "final", "Set", "<", "String", ">", "tags", "=", "params", ".", "getTags", "(", ")", ";", "this", ".", "readonlyTags", "=", "tags", "=", "=", "null", "?", "null", ":", "Collections", ".", "unmodifiableSet", "(", "tags", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "final", "int", "getPriority", "(", ")", "{", "return", "priority", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getDelayInMs", "(", ")", "{", "return", "delayInMs", ";", "}", "</s>"]
["<s>", "public", "final", "Set", "<", "String", ">", "getTags", "(", ")", "{", "return", "readonlyTags", ";", "}", "</s>"]
["<s>", "private", "void", "writeObject", "(", "ObjectOutputStream", "oos", ")", "throws", "IOException", "{", "if", "(", "!", "sealed", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "oos", ".", "writeLong", "(", "requiresNetworkUntilNs", ")", ";", "oos", ".", "writeLong", "(", "requiresUnmeteredNetworkUntilNs", ")", ";", "oos", ".", "writeObject", "(", "groupId", ")", ";", "oos", ".", "writeBoolean", "(", "persistent", ")", ";", "final", "int", "tagCount", "=", "readonlyTags", "=", "=", "null", "?", "0", ":", "readonlyTags", ".", "size", "(", ")", ";", "oos", ".", "writeInt", "(", "tagCount", ")", ";", "if", "(", "tagCount", ">", "0", ")", "{", "for", "(", "String", "tag", ":", "readonlyTags", ")", "{", "oos", ".", "writeUTF", "(", "tag", ")", ";", "}", "}", "oos", ".", "writeUTF", "(", "id", ")", ";", "}", "</s>"]
["<s>", "private", "void", "readObject", "(", "ObjectInputStream", "ois", ")", "throws", "ClassNotFoundException", ",", "IOException", "{", "requiresNetworkUntilNs", "=", "ois", ".", "readLong", "(", ")", ";", "requiresUnmeteredNetworkUntilNs", "=", "ois", ".", "readLong", "(", ")", ";", "groupId", "=", "(", "String", ")", "ois", ".", "readObject", "(", ")", ";", "persistent", "=", "ois", ".", "readBoolean", "(", ")", ";", "final", "int", "tagCount", "=", "ois", ".", "readInt", "(", ")", ";", "if", "(", "tagCount", ">", "0", ")", "{", "readonlyTags", "=", "new", "HashSet", "<", ">", "(", "tagCount", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "tagCount", ";", "i", "+", "+", ")", "{", "readonlyTags", ".", "add", "(", "ois", ".", "readUTF", "(", ")", ")", ";", "}", "}", "id", "=", "ois", ".", "readUTF", "(", ")", ";", "sealed", "=", "true", ";", "}", "</s>"]
["<s>", "public", "final", "boolean", "isPersistent", "(", ")", "{", "return", "persistent", ";", "}", "</s>"]
["<s>", "abstract", "public", "void", "onAdded", "(", ")", ";", "</s>"]
["<s>", "abstract", "public", "void", "onRun", "(", ")", "throws", "Throwable", ";", "</s>"]
["<s>", "abstract", "protected", "void", "onCancel", "(", ")", ";", "</s>"]
["<s>", "@", "Deprecated", "protected", "boolean", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "protected", "RetryConstraint", "shouldReRunOnThrowable", "(", "Throwable", "throwable", ",", "int", "runCount", ",", "int", "maxRunCount", ")", "{", "boolean", "reRun", "=", "shouldReRunOnThrowable", "(", "throwable", ")", ";", "return", "reRun", "?", "RetryConstraint", ".", "RETRY", ":", "RetryConstraint", ".", "CANCEL", ";", "}", "</s>"]
["<s>", "final", "int", "safeRun", "(", "JobHolder", "holder", ",", "int", "currentRunCount", ")", "{", "this", ".", "currentRunCount", "=", "currentRunCount", ";", "if", "(", "JqLog", ".", "isDebugEnabled", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ")", ";", "}", "boolean", "reRun", "=", "false", ";", "boolean", "failed", "=", "false", ";", "try", "{", "onRun", "(", ")", ";", "if", "(", "JqLog", ".", "isDebugEnabled", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "failed", "=", "true", ";", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "reRun", "=", "currentRunCount", "<", "getRetryLimit", "(", ")", ";", "if", "(", "reRun", "&", "&", "!", "cancelled", ")", "{", "try", "{", "RetryConstraint", "retryConstraint", "=", "shouldReRunOnThrowable", "(", "t", ",", "currentRunCount", ",", "getRetryLimit", "(", ")", ")", ";", "if", "(", "retryConstraint", "=", "=", "null", ")", "{", "retryConstraint", "=", "RetryConstraint", ".", "RETRY", ";", "}", "this", ".", "retryConstraint", "=", "retryConstraint", ";", "reRun", "=", "retryConstraint", ".", "shouldRetry", "(", ")", ";", "}", "catch", "(", "Throwable", "t2", ")", "{", "JqLog", ".", "e", "(", "t2", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "!", "failed", ",", "reRun", ",", "cancelled", ")", ";", "if", "(", "!", "failed", ")", "{", "return", "JobHolder", ".", "RUN_RESULT_SUCCESS", ";", "}", "if", "(", "holder", ".", "isCancelled", "(", ")", ")", "{", "return", "JobHolder", ".", "RUN_RESULT_FAIL_FOR_CANCEL", ";", "}", "if", "(", "reRun", ")", "{", "return", "JobHolder", ".", "RUN_RESULT_TRY_AGAIN", ";", "}", "if", "(", "currentRunCount", "<", "getRetryLimit", "(", ")", ")", "{", "return", "JobHolder", ".", "RUN_RESULT_FAIL_SHOULD_RE_RUN", ";", "}", "else", "{", "return", "JobHolder", ".", "RUN_RESULT_FAIL_RUN_LIMIT", ";", "}", "}", "</s>"]
["<s>", "protected", "int", "getCurrentRunCount", "(", ")", "{", "return", "currentRunCount", ";", "}", "</s>"]
["<s>", "public", "final", "boolean", "requiresNetwork", "(", "Timer", "timer", ")", "{", "return", "sealed", "?", "requiresNetworkUntilNs", ">", "timer", ".", "nanoTime", "(", ")", ":", "requiresNetworkTimeoutMs", "!", "=", "Params", ".", "NEVER", ";", "}", "</s>"]
["<s>", "public", "final", "boolean", "requiresUnmeteredNetwork", "(", "Timer", "timer", ")", "{", "return", "sealed", "?", "requiresUnmeteredNetworkUntilNs", ">", "timer", ".", "nanoTime", "(", ")", ":", "requiresUnmeteredNetworkTimeoutMs", "!", "=", "Params", ".", "NEVER", ";", "}", "</s>"]
["<s>", "public", "final", "boolean", "requiresNetworkIgnoreTimeout", "(", ")", "{", "return", "sealed", "?", "requiresNetworkUntilNs", ">", "0", ":", "requiresNetworkTimeoutMs", ">", "0", ";", "}", "</s>"]
["<s>", "public", "final", "boolean", "requiresUnmeteredNetworkIgnoreTimeout", "(", ")", "{", "return", "sealed", "?", "requiresUnmeteredNetworkUntilNs", ">", "0", ":", "requiresUnmeteredNetworkTimeoutMs", ">", "0", ";", "}", "</s>"]
["<s>", "public", "long", "getRequiresUnmeteredNetworkUntilNs", "(", ")", "{", "return", "requiresUnmeteredNetworkUntilNs", ";", "}", "</s>"]
["<s>", "public", "long", "getRequiresNetworkUntilNs", "(", ")", "{", "return", "requiresNetworkUntilNs", ";", "}", "</s>"]
["<s>", "public", "final", "String", "getRunGroupId", "(", ")", "{", "return", "groupId", ";", "}", "</s>"]
["<s>", "protected", "int", "getRetryLimit", "(", ")", "{", "return", "DEFAULT_RETRY_LIMIT", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCancelled", "(", ")", "{", "return", "cancelled", ";", "}", "</s>"]
["<s>", "public", "void", "assertNotCancelled", "(", ")", "{", "if", "(", "cancelled", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "void", "setApplicationContext", "(", "Context", "context", ")", "{", "this", ".", "applicationContext", "=", "context", ";", "}", "</s>"]
["<s>", "public", "Context", "getApplicationContext", "(", ")", "{", "return", "applicationContext", ";", "}", "</s>"]
["<s>", "public", "void", "seal", "(", "Timer", "timer", ")", "{", "if", "(", "sealed", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "requiresNetworkTimeoutMs", "=", "=", "Params", ".", "NEVER", ")", "{", "requiresNetworkUntilNs", "=", "Params", ".", "NEVER", ";", "}", "else", "if", "(", "requiresNetworkTimeoutMs", "=", "=", "Params", ".", "FOREVER", ")", "{", "requiresNetworkUntilNs", "=", "Params", ".", "FOREVER", ";", "}", "else", "{", "requiresNetworkUntilNs", "=", "timer", ".", "nanoTime", "(", ")", "+", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "requiresNetworkTimeoutMs", ")", ";", "}", "if", "(", "requiresUnmeteredNetworkTimeoutMs", "=", "=", "Params", ".", "NEVER", ")", "{", "requiresUnmeteredNetworkUntilNs", "=", "Params", ".", "NEVER", ";", "}", "else", "if", "(", "requiresUnmeteredNetworkTimeoutMs", "=", "=", "Params", ".", "FOREVER", ")", "{", "requiresUnmeteredNetworkUntilNs", "=", "Params", ".", "FOREVER", ";", "}", "else", "{", "requiresUnmeteredNetworkUntilNs", "=", "timer", ".", "nanoTime", "(", ")", "+", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "requiresUnmeteredNetworkTimeoutMs", ")", ";", "}", "if", "(", "requiresNetworkUntilNs", "<", "requiresUnmeteredNetworkUntilNs", ")", "{", "requiresNetworkUntilNs", "=", "requiresUnmeteredNetworkUntilNs", ";", "}", "sealed", "=", "true", ";", "}", "</s>"]
["<s>", "boolean", "insert", "(", "JobHolder", "jobHolder", ")", ";", "</s>"]
["<s>", "boolean", "insertOrReplace", "(", "JobHolder", "jobHolder", ")", ";", "</s>"]
["<s>", "void", "remove", "(", "JobHolder", "jobHolder", ")", ";", "</s>"]
["<s>", "int", "count", "(", ")", ";", "</s>"]
["<s>", "int", "countReadyJobs", "(", "Constraint", "constraint", ")", ";", "</s>"]
["<s>", "JobHolder", "nextJobAndIncRunCount", "(", "Constraint", "constraint", ")", ";", "</s>"]
["<s>", "Long", "getNextJobDelayUntilNs", "(", "Constraint", "constraint", ")", ";", "</s>"]
["<s>", "void", "clear", "(", ")", ";", "</s>"]
["<s>", "JobHolder", "findJobById", "(", "String", "id", ")", ";", "</s>"]
["<s>", "Set", "<", "JobHolder", ">", "findJobs", "(", "Constraint", "constraint", ")", ";", "</s>"]
["<s>", "void", "onJobCancelled", "(", "JobHolder", "holder", ")", ";", "</s>"]
["<s>", "void", "onAdded", "(", ")", ";", "</s>"]
["<s>", "public", "Params", "(", "int", "priority", ")", "{", "this", ".", "priority", "=", "priority", ";", "}", "</s>"]
["<s>", "public", "Params", "requireNetwork", "(", ")", "{", "return", "requireNetworkWithTimeout", "(", "FOREVER", ")", ";", "}", "</s>"]
["<s>", "public", "Params", "requireUnmeteredNetwork", "(", ")", "{", "return", "requireUnmeteredNetworkWithTimeout", "(", "FOREVER", ")", ";", "}", "</s>"]
["<s>", "public", "Params", "requireUnmeteredNetworkWithTimeout", "(", "long", "timeoutMs", ")", "{", "requiresUnmeteredNetworkWithTimeout", "=", "timeoutMs", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "requireNetworkWithTimeout", "(", "long", "timeoutMs", ")", "{", "requiresNetworkWithTimeout", "=", "timeoutMs", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "groupBy", "(", "String", "groupId", ")", "{", "this", ".", "groupId", "=", "groupId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "persist", "(", ")", "{", "this", ".", "persistent", "=", "true", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "delayInMs", "(", "long", "delayMs", ")", "{", "this", ".", "delayMs", "=", "delayMs", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "setRequiresNetwork", "(", "boolean", "requiresNetwork", ")", "{", "return", "setRequiresNetwork", "(", "requiresNetwork", ",", "FOREVER", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getRequiresNetworkTimeoutMs", "(", ")", "{", "return", "requiresNetworkWithTimeout", ";", "}", "</s>"]
["<s>", "public", "long", "getRequiresUnmeteredNetworkTimeoutMs", "(", ")", "{", "return", "requiresUnmeteredNetworkWithTimeout", ";", "}", "</s>"]
["<s>", "public", "Params", "setRequiresNetwork", "(", "boolean", "requiresNetwork", ",", "long", "timeout", ")", "{", "if", "(", "requiresNetwork", ")", "{", "requiresNetworkWithTimeout", "=", "timeout", ";", "}", "else", "{", "requiresNetworkWithTimeout", "=", "NEVER", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "setGroupId", "(", "String", "groupId", ")", "{", "this", ".", "groupId", "=", "groupId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "setPersistent", "(", "boolean", "persistent", ")", "{", "this", ".", "persistent", "=", "persistent", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "setDelayMs", "(", "long", "delayMs", ")", "{", "this", ".", "delayMs", "=", "delayMs", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "addTags", "(", "String", ".", ".", ".", "newTags", ")", "{", "if", "(", "tags", "=", "=", "null", ")", "{", "tags", "=", "new", "HashSet", "<", ">", "(", ")", ";", "}", "Collections", ".", "addAll", "(", "tags", ",", "newTags", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "removeTags", "(", "String", ".", ".", ".", "oldTags", ")", "{", "if", "(", "tags", "=", "=", "null", ")", "{", "return", "this", ";", "}", "for", "(", "String", "tag", ":", "oldTags", ")", "{", "tags", ".", "remove", "(", "tag", ")", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "clearTags", "(", ")", "{", "tags", "=", "null", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "String", "getGroupId", "(", ")", "{", "return", "groupId", ";", "}", "</s>"]
["<s>", "public", "boolean", "isPersistent", "(", ")", "{", "return", "persistent", ";", "}", "</s>"]
["<s>", "public", "int", "getPriority", "(", ")", "{", "return", "priority", ";", "}", "</s>"]
["<s>", "public", "long", "getDelayMs", "(", ")", "{", "return", "delayMs", ";", "}", "</s>"]
["<s>", "public", "HashSet", "<", "String", ">", "getTags", "(", ")", "{", "return", "tags", ";", "}", "</s>"]
["<s>", "private", "JobHolder", "(", "int", "priority", ",", "String", "groupId", ",", "int", "runCount", ",", "Job", "job", ",", "long", "createdNs", ",", "long", "delayUntilNs", ",", "long", "runningSessionId", ")", "{", "this", ".", "id", "=", "job", ".", "getId", "(", ")", ";", "this", ".", "priority", "=", "priority", ";", "this", ".", "groupId", "=", "groupId", ";", "this", ".", "runCount", "=", "runCount", ";", "this", ".", "createdNs", "=", "createdNs", ";", "this", ".", "delayUntilNs", "=", "delayUntilNs", ";", "this", ".", "job", "=", "job", ";", "job", ".", "priority", "=", "priority", ";", "this", ".", "runningSessionId", "=", "runningSessionId", ";", "this", ".", "requiresNetworkUntilNs", "=", "job", ".", "getRequiresNetworkUntilNs", "(", ")", ";", "this", ".", "requiresUnmeteredNetworkUntilNs", "=", "job", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ";", "this", ".", "tags", "=", "job", ".", "getTags", "(", ")", "=", "=", "null", "?", "null", ":", "Collections", ".", "unmodifiableSet", "(", "job", ".", "getTags", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "int", "safeRun", "(", "int", "currentRunCount", ")", "{", "return", "job", ".", "safeRun", "(", "this", ",", "currentRunCount", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "boolean", "requiresNetwork", "(", "long", "timeInNs", ")", "{", "return", "requiresNetworkUntilNs", ">", "timeInNs", ";", "}", "</s>"]
["<s>", "public", "long", "getRequiresNetworkUntilNs", "(", ")", "{", "return", "requiresNetworkUntilNs", ";", "}", "</s>"]
["<s>", "public", "boolean", "requiresUnmeteredNetwork", "(", "long", "timeInNs", ")", "{", "return", "requiresUnmeteredNetworkUntilNs", ">", "timeInNs", ";", "}", "</s>"]
["<s>", "public", "long", "getRequiresUnmeteredNetworkUntilNs", "(", ")", "{", "return", "requiresUnmeteredNetworkUntilNs", ";", "}", "</s>"]
["<s>", "public", "int", "getPriority", "(", ")", "{", "return", "priority", ";", "}", "</s>"]
["<s>", "public", "void", "setPriority", "(", "int", "priority", ")", "{", "this", ".", "priority", "=", "priority", ";", "this", ".", "job", ".", "priority", "=", "this", ".", "priority", ";", "}", "</s>"]
["<s>", "public", "Long", "getInsertionOrder", "(", ")", "{", "return", "insertionOrder", ";", "}", "</s>"]
["<s>", "public", "void", "setInsertionOrder", "(", "long", "insertionOrder", ")", "{", "this", ".", "insertionOrder", "=", "insertionOrder", ";", "}", "</s>"]
["<s>", "public", "void", "setDelayUntilNs", "(", "long", "delayUntilNs", ")", "{", "this", ".", "delayUntilNs", "=", "delayUntilNs", ";", "}", "</s>"]
["<s>", "public", "int", "getRunCount", "(", ")", "{", "return", "runCount", ";", "}", "</s>"]
["<s>", "public", "void", "setRunCount", "(", "int", "runCount", ")", "{", "this", ".", "runCount", "=", "runCount", ";", "}", "</s>"]
["<s>", "public", "long", "getCreatedNs", "(", ")", "{", "return", "createdNs", ";", "}", "</s>"]
["<s>", "public", "void", "setCreatedNs", "(", "long", "createdNs", ")", "{", "this", ".", "createdNs", "=", "createdNs", ";", "}", "</s>"]
["<s>", "public", "long", "getRunningSessionId", "(", ")", "{", "return", "runningSessionId", ";", "}", "</s>"]
["<s>", "public", "void", "setRunningSessionId", "(", "long", "runningSessionId", ")", "{", "this", ".", "runningSessionId", "=", "runningSessionId", ";", "}", "</s>"]
["<s>", "public", "long", "getDelayUntilNs", "(", ")", "{", "return", "delayUntilNs", ";", "}", "</s>"]
["<s>", "public", "Job", "getJob", "(", ")", "{", "return", "job", ";", "}", "</s>"]
["<s>", "public", "void", "setJob", "(", "Job", "job", ")", "{", "this", ".", "job", "=", "job", ";", "this", ".", "id", "=", "job", ".", "getId", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getGroupId", "(", ")", "{", "return", "groupId", ";", "}", "</s>"]
["<s>", "public", "Set", "<", "String", ">", "getTags", "(", ")", "{", "return", "tags", ";", "}", "</s>"]
["<s>", "public", "void", "markAsCancelled", "(", ")", "{", "cancelled", "=", "true", ";", "job", ".", "cancelled", "=", "true", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCancelled", "(", ")", "{", "return", "cancelled", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "id", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "!", "(", "o", "instanceof", "JobHolder", ")", ")", "{", "return", "false", ";", "}", "JobHolder", "other", "=", "(", "JobHolder", ")", "o", ";", "return", "id", ".", "equals", "(", "other", ".", "id", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasTags", "(", ")", "{", "return", "tags", "!", "=", "null", "&", "&", "tags", ".", "size", "(", ")", ">", "0", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "markAsSuccessful", "(", ")", "{", "successful", "=", "true", ";", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "isSuccessful", "(", ")", "{", "return", "successful", ";", "}", "</s>"]
["<s>", "public", "void", "setApplicationContext", "(", "Context", "applicationContext", ")", "{", "this", ".", "job", ".", "setApplicationContext", "(", "applicationContext", ")", ";", "}", "</s>"]
["<s>", "public", "void", "onCancel", "(", ")", "{", "job", ".", "onCancel", "(", ")", ";", "}", "</s>"]
["<s>", "public", "RetryConstraint", "getRetryConstraint", "(", ")", "{", "return", "job", ".", "retryConstraint", ";", "}", "</s>"]
["<s>", "public", "Builder", "priority", "(", "int", "priority", ")", "{", "this", ".", "priority", "=", "priority", ";", "providedFlags", "|", "=", "FLAG_PRIORITY", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "groupId", "(", "String", "groupId", ")", "{", "this", ".", "groupId", "=", "groupId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "runCount", "(", "int", "runCount", ")", "{", "this", ".", "runCount", "=", "runCount", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "job", "(", "Job", "job", ")", "{", "this", ".", "job", "=", "job", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "createdNs", "(", "long", "createdNs", ")", "{", "this", ".", "createdNs", "=", "createdNs", ";", "providedFlags", "|", "=", "FLAG_CREATED_AT", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "delayUntilNs", "(", "long", "delayUntilNs", ")", "{", "this", ".", "delayUntilNs", "=", "delayUntilNs", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "insertionOrder", "(", "long", "insertionOrder", ")", "{", "this", ".", "insertionOrder", "=", "insertionOrder", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "runningSessionId", "(", "long", "runningSessionId", ")", "{", "this", ".", "runningSessionId", "=", "runningSessionId", ";", "providedFlags", "|", "=", "FLAG_SESSION_ID", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "JobHolder", "build", "(", ")", "{", "if", "(", "job", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "(", "providedFlags", "&", "FLAG_PRIORITY", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "(", "providedFlags", "&", "FLAG_SESSION_ID", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "(", "providedFlags", "&", "FLAG_CREATED_AT", ")", "=", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "JobHolder", "jobHolder", "=", "new", "JobHolder", "(", "priority", ",", "groupId", ",", "runCount", ",", "job", ",", "createdNs", ",", "delayUntilNs", ",", "runningSessionId", ")", ";", "if", "(", "insertionOrder", "!", "=", "null", ")", "{", "jobHolder", ".", "setInsertionOrder", "(", "insertionOrder", ")", ";", "}", "return", "jobHolder", ";", "}", "</s>"]
["<s>", "public", "RunningJobSet", "(", "Timer", "timer", ")", "{", "internalSet", "=", "new", "TreeSet", "<", ">", "(", ")", ";", "groupDelays", "=", "new", "HashMap", "<", ">", "(", ")", ";", "groupDelayTimeout", "=", "Long", ".", "MAX_VALUE", ";", "this", ".", "timer", "=", "timer", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "addGroupUntil", "(", "String", "group", ",", "long", "until", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "group", ",", "until", ")", ";", "Long", "current", "=", "groupDelays", ".", "get", "(", "group", ")", ";", "if", "(", "current", "!", "=", "null", ")", "{", "if", "(", "current", ">", "until", ")", "{", "return", ";", "}", "}", "groupDelays", ".", "put", "(", "group", ",", "until", ")", ";", "groupDelayTimeout", "=", "calculateNextDelayForGroups", "(", ")", ";", "publicClone", "=", "null", ";", "}", "</s>"]
["<s>", "public", "synchronized", "Collection", "<", "String", ">", "getSafe", "(", ")", "{", "final", "long", "now", "=", "timer", ".", "nanoTime", "(", ")", ";", "if", "(", "publicClone", "=", "=", "null", "|", "|", "now", ">", "groupDelayTimeout", ")", "{", "if", "(", "groupDelays", ".", "isEmpty", "(", ")", ")", "{", "publicClone", "=", "new", "ArrayList", "<", ">", "(", "internalSet", ")", ";", "groupDelayTimeout", "=", "Long", ".", "MAX_VALUE", ";", "}", "else", "{", "TreeSet", "<", "String", ">", "tmpClone", "=", "new", "TreeSet", "<", ">", "(", "internalSet", ")", ";", "Iterator", "<", "Map", ".", "Entry", "<", "String", ",", "Long", ">", ">", "itr", "=", "groupDelays", ".", "entrySet", "(", ")", ".", "iterator", "(", ")", ";", "while", "(", "itr", ".", "hasNext", "(", ")", ")", "{", "Map", ".", "Entry", "<", "String", ",", "Long", ">", "entry", "=", "itr", ".", "next", "(", ")", ";", "if", "(", "entry", ".", "getValue", "(", ")", ">", "now", ")", "{", "if", "(", "!", "tmpClone", ".", "contains", "(", "entry", ".", "getKey", "(", ")", ")", ")", "{", "tmpClone", ".", "add", "(", "entry", ".", "getKey", "(", ")", ")", ";", "}", "}", "else", "{", "itr", ".", "remove", "(", ")", ";", "}", "}", "publicClone", "=", "new", "ArrayList", "<", ">", "(", "tmpClone", ")", ";", "groupDelayTimeout", "=", "calculateNextDelayForGroups", "(", ")", ";", "}", "}", "return", "publicClone", ";", "}", "</s>"]
["<s>", "public", "Long", "getNextDelayForGroups", "(", ")", "{", "if", "(", "groupDelayTimeout", "=", "=", "Long", ".", "MAX_VALUE", ")", "{", "return", "null", ";", "}", "return", "groupDelayTimeout", ";", "}", "</s>"]
["<s>", "private", "long", "calculateNextDelayForGroups", "(", ")", "{", "long", "result", "=", "Long", ".", "MAX_VALUE", ";", "for", "(", "Long", "value", ":", "groupDelays", ".", "values", "(", ")", ")", "{", "if", "(", "value", "<", "result", ")", "{", "result", "=", "value", ";", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "add", "(", "String", "group", ")", "{", "if", "(", "group", "=", "=", "null", ")", "{", "return", ";", "}", "if", "(", "internalSet", ".", "add", "(", "group", ")", ")", "{", "publicClone", "=", "null", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "void", "remove", "(", "String", "group", ")", "{", "if", "(", "group", "=", "=", "null", ")", "{", "return", ";", "}", "if", "(", "internalSet", ".", "remove", "(", "group", ")", ")", "{", "publicClone", "=", "null", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "void", "clear", "(", ")", "{", "internalSet", ".", "clear", "(", ")", ";", "groupDelays", ".", "clear", "(", ")", ";", "publicClone", "=", "null", ";", "}", "</s>"]
["<s>", "public", "JobManager", "(", "Configuration", "configuration", ")", "{", "super", "(", "configuration", ")", ";", "}", "</s>"]
["<s>", "public", "JobManager", "(", "Context", "context", ",", "Configuration", "configuration", ")", "{", "super", "(", "configuration", ")", ";", "}", "</s>"]
["<s>", "public", "JobManager", "(", "Context", "context", ")", "{", "this", "(", "context", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "JobManager", "(", "Context", "context", ",", "String", "id", ")", "{", "this", "(", "new", "Configuration", ".", "Builder", "(", "context", ")", ".", "id", "(", "id", ")", ".", "build", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "RetryConstraint", "(", "boolean", "retry", ")", "{", "this", ".", "retry", "=", "retry", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldRetry", "(", ")", "{", "return", "retry", ";", "}", "</s>"]
["<s>", "public", "void", "setRetry", "(", "boolean", "retry", ")", "{", "this", ".", "retry", "=", "retry", ";", "}", "</s>"]
["<s>", "public", "Long", "getNewDelayInMs", "(", ")", "{", "return", "newDelayInMs", ";", "}", "</s>"]
["<s>", "public", "void", "setNewDelayInMs", "(", "Long", "newDelayInMs", ")", "{", "this", ".", "newDelayInMs", "=", "newDelayInMs", ";", "}", "</s>"]
["<s>", "public", "Integer", "getNewPriority", "(", ")", "{", "return", "newPriority", ";", "}", "</s>"]
["<s>", "public", "void", "setNewPriority", "(", "Integer", "newPriority", ")", "{", "this", ".", "newPriority", "=", "newPriority", ";", "}", "</s>"]
["<s>", "public", "static", "RetryConstraint", "createExponentialBackoff", "(", "int", "runCount", ",", "long", "initialBackOffInMs", ")", "{", "RetryConstraint", "constraint", "=", "new", "RetryConstraint", "(", "true", ")", ";", "constraint", ".", "setNewDelayInMs", "(", "initialBackOffInMs", "*", "(", "long", ")", "Math", ".", "pow", "(", "<NUM_LIT:2>", ",", "Math", ".", "max", "(", "0", ",", "runCount", "-", "1", ")", ")", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "public", "void", "setApplyNewDelayToGroup", "(", "boolean", "applyDelayToGroup", ")", "{", "this", ".", "applyNewDelayToGroup", "=", "applyDelayToGroup", ";", "}", "</s>"]
["<s>", "public", "boolean", "willApplyNewDelayToGroup", "(", ")", "{", "return", "applyNewDelayToGroup", ";", "}", "</s>"]
["<s>", "public", "ImmutableRetryConstraint", "(", "boolean", "retry", ")", "{", "super", "(", "retry", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setRetry", "(", "boolean", "retry", ")", "{", "throw", "new", "IllegalStateException", "(", "MESSAGE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setNewDelayInMs", "(", "Long", "newDelayInMs", ")", "{", "throw", "new", "IllegalStateException", "(", "MESSAGE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setNewPriority", "(", "Integer", "newPriority", ")", "{", "throw", "new", "IllegalStateException", "(", "MESSAGE", ")", ";", "}", "</s>"]
["<s>", "void", "inject", "(", "Job", "job", ")", ";", "</s>"]
["<s>", "public", "CachedJobQueue", "(", "JobQueue", "delegate", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "insert", "(", "JobHolder", "jobHolder", ")", "{", "invalidateCache", "(", ")", ";", "return", "delegate", ".", "insert", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "private", "void", "invalidateCache", "(", ")", "{", "cachedCount", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "insertOrReplace", "(", "JobHolder", "jobHolder", ")", "{", "invalidateCache", "(", ")", ";", "return", "delegate", ".", "insertOrReplace", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", "JobHolder", "jobHolder", ")", "{", "invalidateCache", "(", ")", ";", "delegate", ".", "remove", "(", "jobHolder", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "count", "(", ")", "{", "if", "(", "cachedCount", "=", "=", "null", ")", "{", "cachedCount", "=", "delegate", ".", "count", "(", ")", ";", "}", "return", "cachedCount", ";", "}", "</s>"]
["<s>", "private", "boolean", "isEmpty", "(", ")", "{", "return", "cachedCount", "!", "=", "null", "&", "&", "cachedCount", "=", "=", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "countReadyJobs", "(", "Constraint", "constraint", ")", "{", "if", "(", "isEmpty", "(", ")", ")", "{", "return", "0", ";", "}", "return", "delegate", ".", "countReadyJobs", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "nextJobAndIncRunCount", "(", "Constraint", "constraint", ")", "{", "if", "(", "isEmpty", "(", ")", ")", "{", "return", "null", ";", "}", "JobHolder", "holder", "=", "delegate", ".", "nextJobAndIncRunCount", "(", "constraint", ")", ";", "if", "(", "holder", "!", "=", "null", "&", "&", "cachedCount", "!", "=", "null", ")", "{", "cachedCount", "-", "=", "1", ";", "}", "return", "holder", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "getNextJobDelayUntilNs", "(", "Constraint", "constraint", ")", "{", "return", "delegate", ".", "getNextJobDelayUntilNs", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "invalidateCache", "(", ")", ";", "delegate", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "<", "JobHolder", ">", "findJobs", "(", "Constraint", "constraint", ")", "{", "return", "delegate", ".", "findJobs", "(", "constraint", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobCancelled", "(", "JobHolder", "holder", ")", "{", "invalidateCache", "(", ")", ";", "delegate", ".", "onJobCancelled", "(", "holder", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "findJobById", "(", "String", "id", ")", "{", "return", "delegate", ".", "findJobById", "(", "id", ")", ";", "}", "</s>"]
["<s>", "public", "SqliteJobQueue", "(", "Configuration", "configuration", ",", "long", "sessionId", ",", "JobSerializer", "serializer", ")", "{", "this", ".", "sessionId", "=", "sessionId", ";", "whereQueryCache", "=", "new", "WhereQueryCache", "(", "sessionId", ")", ";", "dbOpenHelper", "=", "new", "DbOpenHelper", "(", "configuration", ".", "getAppContext", "(", ")", ",", "configuration", ".", "isInTestMode", "(", ")", "?", "null", ":", "(", "\"", "<STR_LIT:_>", "\"", "+", "configuration", ".", "getId", "(", ")", ")", ")", ";", "db", "=", "dbOpenHelper", ".", "getWritableDatabase", "(", ")", ";", "sqlHelper", "=", "new", "SqlHelper", "(", "db", ",", "DbOpenHelper", ".", "JOB_HOLDER_TABLE_NAME", ",", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnName", ",", "DbOpenHelper", ".", "COLUMN_COUNT", ",", "DbOpenHelper", ".", "JOB_TAGS_TABLE_NAME", ",", "DbOpenHelper", ".", "TAGS_COLUMN_COUNT", ",", "sessionId", ")", ";", "this", ".", "jobSerializer", "=", "serializer", ";", "if", "(", "configuration", ".", "resetDelaysOnRestart", "(", ")", ")", "{", "sqlHelper", ".", "resetDelayTimesTo", "(", "JobManager", ".", "NOT_DELAYED_JOB_DELAY", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "insert", "(", "JobHolder", "jobHolder", ")", "{", "if", "(", "jobHolder", ".", "hasTags", "(", ")", ")", "{", "return", "insertWithTags", "(", "jobHolder", ")", ";", "}", "final", "SQLiteStatement", "stmt", "=", "sqlHelper", ".", "getInsertStatement", "(", ")", ";", "stmt", ".", "clearBindings", "(", ")", ";", "bindValues", "(", "stmt", ",", "jobHolder", ")", ";", "long", "insertId", "=", "stmt", ".", "executeInsert", "(", ")", ";", "jobHolder", ".", "setInsertionOrder", "(", "insertId", ")", ";", "return", "insertId", "!", "=", "-", "1", ";", "}", "</s>"]
["<s>", "private", "boolean", "insertWithTags", "(", "JobHolder", "jobHolder", ")", "{", "final", "SQLiteStatement", "stmt", "=", "sqlHelper", ".", "getInsertStatement", "(", ")", ";", "final", "SQLiteStatement", "tagsStmt", "=", "sqlHelper", ".", "getInsertTagsStatement", "(", ")", ";", "db", ".", "beginTransaction", "(", ")", ";", "try", "{", "stmt", ".", "clearBindings", "(", ")", ";", "bindValues", "(", "stmt", ",", "jobHolder", ")", ";", "boolean", "insertResult", "=", "stmt", ".", "executeInsert", "(", ")", "!", "=", "-", "1", ";", "if", "(", "!", "insertResult", ")", "{", "return", "false", ";", "}", "for", "(", "String", "tag", ":", "jobHolder", ".", "getTags", "(", ")", ")", "{", "tagsStmt", ".", "clearBindings", "(", ")", ";", "bindTag", "(", "tagsStmt", ",", "jobHolder", ".", "getId", "(", ")", ",", "tag", ")", ";", "tagsStmt", ".", "executeInsert", "(", ")", ";", "}", "db", ".", "setTransactionSuccessful", "(", ")", ";", "return", "true", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "return", "false", ";", "}", "finally", "{", "db", ".", "endTransaction", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "bindTag", "(", "SQLiteStatement", "stmt", ",", "String", "jobId", ",", "String", "tag", ")", "{", "stmt", ".", "bindString", "(", "DbOpenHelper", ".", "TAGS_JOB_ID_COLUMN", ".", "columnIndex", "+", "1", ",", "jobId", ")", ";", "stmt", ".", "bindString", "(", "DbOpenHelper", ".", "TAGS_NAME_COLUMN", ".", "columnIndex", "+", "1", ",", "tag", ")", ";", "}", "</s>"]
["<s>", "private", "void", "bindValues", "(", "SQLiteStatement", "stmt", ",", "JobHolder", "jobHolder", ")", "{", "if", "(", "jobHolder", ".", "getInsertionOrder", "(", ")", "!", "=", "null", ")", "{", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "INSERTION_ORDER_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getInsertionOrder", "(", ")", ")", ";", "}", "stmt", ".", "bindString", "(", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getId", "(", ")", ")", ";", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "PRIORITY_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getPriority", "(", ")", ")", ";", "if", "(", "jobHolder", ".", "getGroupId", "(", ")", "!", "=", "null", ")", "{", "stmt", ".", "bindString", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getGroupId", "(", ")", ")", ";", "}", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "RUN_COUNT_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getRunCount", "(", ")", ")", ";", "byte", "[", "]", "job", "=", "getSerializeJob", "(", "jobHolder", ")", ";", "if", "(", "job", "!", "=", "null", ")", "{", "stmt", ".", "bindBlob", "(", "DbOpenHelper", ".", "BASE_JOB_COLUMN", ".", "columnIndex", "+", "1", ",", "job", ")", ";", "}", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "CREATED_NS_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getCreatedNs", "(", ")", ")", ";", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getDelayUntilNs", "(", ")", ")", ";", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "RUNNING_SESSION_ID_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getRunningSessionId", "(", ")", ")", ";", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "REQUIRES_NETWORK_UNTIL_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getRequiresNetworkUntilNs", "(", ")", ")", ";", "stmt", ".", "bindLong", "(", "DbOpenHelper", ".", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ".", "columnIndex", "+", "1", ",", "jobHolder", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "insertOrReplace", "(", "JobHolder", "jobHolder", ")", "{", "if", "(", "jobHolder", ".", "getInsertionOrder", "(", ")", "=", "=", "null", ")", "{", "return", "insert", "(", "jobHolder", ")", ";", "}", "jobHolder", ".", "setRunningSessionId", "(", "JobManager", ".", "NOT_RUNNING_SESSION_ID", ")", ";", "SQLiteStatement", "stmt", "=", "sqlHelper", ".", "getInsertOrReplaceStatement", "(", ")", ";", "stmt", ".", "clearBindings", "(", ")", ";", "bindValues", "(", "stmt", ",", "jobHolder", ")", ";", "return", "stmt", ".", "executeInsert", "(", ")", "!", "=", "-", "1", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", "JobHolder", "jobHolder", ")", "{", "if", "(", "jobHolder", ".", "getId", "(", ")", "=", "=", "null", ")", "{", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "delete", "(", "jobHolder", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "delete", "(", "String", "id", ")", "{", "pendingCancelations", ".", "remove", "(", "id", ")", ";", "SQLiteStatement", "stmt", "=", "sqlHelper", ".", "getDeleteStatement", "(", ")", ";", "stmt", ".", "clearBindings", "(", ")", ";", "stmt", ".", "bindString", "(", "1", ",", "id", ")", ";", "stmt", ".", "execute", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "count", "(", ")", "{", "SQLiteStatement", "stmt", "=", "sqlHelper", ".", "getCountStatement", "(", ")", ";", "stmt", ".", "clearBindings", "(", ")", ";", "stmt", ".", "bindLong", "(", "1", ",", "sessionId", ")", ";", "return", "(", "int", ")", "stmt", ".", "simpleQueryForLong", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "countReadyJobs", "(", "Constraint", "constraint", ")", "{", "final", "Where", "where", "=", "createWhere", "(", "constraint", ")", ";", "final", "long", "result", "=", "where", ".", "countReady", "(", "db", ",", "reusedStringBuilder", ")", ".", "simpleQueryForLong", "(", ")", ";", "return", "(", "int", ")", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "findJobById", "(", "String", "id", ")", "{", "Cursor", "cursor", "=", "db", ".", "rawQuery", "(", "sqlHelper", ".", "FIND_BY_ID_QUERY", ",", "new", "String", "[", "]", "{", "id", "}", ")", ";", "try", "{", "if", "(", "!", "cursor", ".", "moveToFirst", "(", ")", ")", "{", "return", "null", ";", "}", "return", "createJobHolderFromCursor", "(", "cursor", ")", ";", "}", "catch", "(", "InvalidJobException", "e", ")", "{", "JqLog", ".", "e", "(", "e", ",", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "<", "JobHolder", ">", "findJobs", "(", "Constraint", "constraint", ")", "{", "final", "Where", "where", "=", "createWhere", "(", "constraint", ")", ";", "String", "selectQuery", "=", "where", ".", "findJobs", "(", "sqlHelper", ")", ";", "Cursor", "cursor", "=", "db", ".", "rawQuery", "(", "selectQuery", ",", "where", ".", "args", ")", ";", "Set", "<", "JobHolder", ">", "jobs", "=", "new", "HashSet", "<", ">", "(", ")", ";", "try", "{", "while", "(", "cursor", ".", "moveToNext", "(", ")", ")", "{", "jobs", ".", "add", "(", "createJobHolderFromCursor", "(", "cursor", ")", ")", ";", "}", "}", "catch", "(", "InvalidJobException", "e", ")", "{", "JqLog", ".", "e", "(", "e", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "return", "jobs", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobCancelled", "(", "JobHolder", "holder", ")", "{", "pendingCancelations", ".", "add", "(", "holder", ".", "getId", "(", ")", ")", ";", "setSessionIdOnJob", "(", "holder", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JobHolder", "nextJobAndIncRunCount", "(", "Constraint", "constraint", ")", "{", "final", "Where", "where", "=", "createWhere", "(", "constraint", ")", ";", "final", "String", "selectQuery", "=", "where", ".", "nextJob", "(", "sqlHelper", ")", ";", "while", "(", "true", ")", "{", "Cursor", "cursor", "=", "db", ".", "rawQuery", "(", "selectQuery", ",", "where", ".", "args", ")", ";", "try", "{", "if", "(", "!", "cursor", ".", "moveToNext", "(", ")", ")", "{", "return", "null", ";", "}", "JobHolder", "holder", "=", "createJobHolderFromCursor", "(", "cursor", ")", ";", "setSessionIdOnJob", "(", "holder", ")", ";", "return", "holder", ";", "}", "catch", "(", "InvalidJobException", "e", ")", "{", "String", "jobId", "=", "cursor", ".", "getString", "(", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnIndex", ")", ";", "if", "(", "jobId", "=", "=", "null", ")", "{", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "delete", "(", "jobId", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "Where", "createWhere", "(", "Constraint", "constraint", ")", "{", "return", "whereQueryCache", ".", "build", "(", "constraint", ",", "pendingCancelations", ",", "reusedStringBuilder", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "getNextJobDelayUntilNs", "(", "Constraint", "constraint", ")", "{", "final", "Where", "where", "=", "createWhere", "(", "constraint", ")", ";", "try", "{", "if", "(", "constraint", ".", "shouldNotRequireNetwork", "(", ")", "|", "|", "constraint", ".", "shouldNotRequireUnmeteredNetwork", "(", ")", ")", "{", "return", "where", ".", "nextJobDelayUntilWithNetworkRequirement", "(", "db", ",", "sqlHelper", ")", ".", "simpleQueryForLong", "(", ")", ";", "}", "else", "{", "return", "where", ".", "nextJobDelayUntil", "(", "db", ",", "sqlHelper", ")", ".", "simpleQueryForLong", "(", ")", ";", "}", "}", "catch", "(", "SQLiteDoneException", "empty", ")", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "sqlHelper", ".", "truncate", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setSessionIdOnJob", "(", "JobHolder", "jobHolder", ")", "{", "SQLiteStatement", "stmt", "=", "sqlHelper", ".", "getOnJobFetchedForRunningStatement", "(", ")", ";", "jobHolder", ".", "setRunCount", "(", "jobHolder", ".", "getRunCount", "(", ")", "+", "1", ")", ";", "jobHolder", ".", "setRunningSessionId", "(", "sessionId", ")", ";", "stmt", ".", "clearBindings", "(", ")", ";", "stmt", ".", "bindLong", "(", "1", ",", "jobHolder", ".", "getRunCount", "(", ")", ")", ";", "stmt", ".", "bindLong", "(", "<NUM_LIT:2>", ",", "sessionId", ")", ";", "stmt", ".", "bindString", "(", "<NUM_LIT:3>", ",", "jobHolder", ".", "getId", "(", ")", ")", ";", "stmt", ".", "execute", "(", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "String", "logJobs", "(", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "String", "select", "=", "sqlHelper", ".", "createSelect", "(", "null", ",", "<NUM_LIT:100>", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "PRIORITY_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "DESC", ")", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "CREATED_NS_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "ASC", ")", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "INSERTION_ORDER_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "ASC", ")", ")", ";", "Cursor", "cursor", "=", "db", ".", "rawQuery", "(", "select", ",", "new", "String", "[", "0", "]", ")", ";", "try", "{", "while", "(", "cursor", ".", "moveToNext", "(", ")", ")", "{", "String", "id", "=", "cursor", ".", "getString", "(", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnIndex", ")", ";", "sb", ".", "append", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "INSERTION_ORDER_COLUMN", ".", "columnIndex", ")", ")", ".", "append", "(", "\"", "\"", ")", ".", "append", "(", "id", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "cursor", ".", "getString", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnIndex", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ".", "columnIndex", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "RUNNING_SESSION_ID_COLUMN", ".", "columnIndex", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "REQUIRES_NETWORK_UNTIL_COLUMN", ".", "columnIndex", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ".", "columnIndex", ")", ")", ";", "Cursor", "tags", "=", "db", ".", "rawQuery", "(", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "TAGS_NAME_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "JOB_TAGS_TABLE_NAME", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "TAGS_JOB_ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", ",", "new", "String", "[", "]", "{", "id", "}", ")", ";", "try", "{", "while", "(", "tags", ".", "moveToNext", "(", ")", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "tags", ".", "getString", "(", "0", ")", ")", ";", "}", "}", "finally", "{", "tags", ".", "close", "(", ")", ";", "}", "sb", ".", "append", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "private", "JobHolder", "createJobHolderFromCursor", "(", "Cursor", "cursor", ")", "throws", "InvalidJobException", "{", "Job", "job", "=", "safeDeserialize", "(", "cursor", ".", "getBlob", "(", "DbOpenHelper", ".", "BASE_JOB_COLUMN", ".", "columnIndex", ")", ")", ";", "if", "(", "job", "=", "=", "null", ")", "{", "throw", "new", "InvalidJobException", "(", ")", ";", "}", "return", "new", "JobHolder", ".", "Builder", "(", ")", ".", "insertionOrder", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "INSERTION_ORDER_COLUMN", ".", "columnIndex", ")", ")", ".", "priority", "(", "cursor", ".", "getInt", "(", "DbOpenHelper", ".", "PRIORITY_COLUMN", ".", "columnIndex", ")", ")", ".", "groupId", "(", "cursor", ".", "getString", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnIndex", ")", ")", ".", "runCount", "(", "cursor", ".", "getInt", "(", "DbOpenHelper", ".", "RUN_COUNT_COLUMN", ".", "columnIndex", ")", ")", ".", "job", "(", "job", ")", ".", "createdNs", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "CREATED_NS_COLUMN", ".", "columnIndex", ")", ")", ".", "delayUntilNs", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ".", "columnIndex", ")", ")", ".", "runningSessionId", "(", "cursor", ".", "getLong", "(", "DbOpenHelper", ".", "RUNNING_SESSION_ID_COLUMN", ".", "columnIndex", ")", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Job", "safeDeserialize", "(", "byte", "[", "]", "bytes", ")", "{", "try", "{", "return", "jobSerializer", ".", "deserialize", "(", "bytes", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "getSerializeJob", "(", "JobHolder", "jobHolder", ")", "{", "return", "safeSerialize", "(", "jobHolder", ".", "getJob", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "safeSerialize", "(", "Object", "object", ")", "{", "try", "{", "return", "jobSerializer", ".", "serialize", "(", "object", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ",", "object", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "serialize", "(", "Object", "object", ")", "throws", "IOException", "{", "if", "(", "object", "=", "=", "null", ")", "{", "return", "null", ";", "}", "ByteArrayOutputStream", "bos", "=", "null", ";", "try", "{", "bos", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "ObjectOutput", "out", "=", "new", "ObjectOutputStream", "(", "bos", ")", ";", "out", ".", "writeObject", "(", "object", ")", ";", "return", "bos", ".", "toByteArray", "(", ")", ";", "}", "finally", "{", "if", "(", "bos", "!", "=", "null", ")", "{", "bos", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", "extends", "Job", ">", "T", "deserialize", "(", "byte", "[", "]", "bytes", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "if", "(", "bytes", "=", "=", "null", "|", "|", "bytes", ".", "length", "=", "=", "0", ")", "{", "return", "null", ";", "}", "ObjectInputStream", "in", "=", "null", ";", "try", "{", "in", "=", "new", "ObjectInputStream", "(", "new", "ByteArrayInputStream", "(", "bytes", ")", ")", ";", "return", "(", "T", ")", "in", ".", "readObject", "(", ")", ";", "}", "finally", "{", "if", "(", "in", "!", "=", "null", ")", "{", "in", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "byte", "[", "]", "serialize", "(", "Object", "object", ")", "throws", "IOException", ";", "</s>"]
["<s>", "<", "T", "extends", "Job", ">", "T", "deserialize", "(", "byte", "[", "]", "bytes", ")", "throws", "IOException", ",", "ClassNotFoundException", ";", "</s>"]
["<s>", "public", "Where", "(", "long", "cacheKey", ",", "String", "query", ",", "String", "[", "]", "args", ")", "{", "this", ".", "cacheKey", "=", "cacheKey", ";", "this", ".", "query", "=", "query", ";", "this", ".", "args", "=", "args", ";", "}", "</s>"]
["<s>", "public", "void", "setNetworkTimeoutArgIndex", "(", "int", "index", ")", "{", "this", ".", "networkTimeoutArgIndex", "=", "index", ";", "}", "</s>"]
["<s>", "public", "void", "setUnmeteredNetworkTimeoutArgIndex", "(", "int", "unmeteredNetworkTimeoutArgIndex", ")", "{", "this", ".", "unmeteredNetworkTimeoutArgIndex", "=", "unmeteredNetworkTimeoutArgIndex", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "countReady", "(", "SQLiteDatabase", "database", ",", "StringBuilder", "stringBuilder", ")", "{", "if", "(", "countReadyStmt", "=", "=", "null", ")", "{", "stringBuilder", ".", "setLength", "(", "0", ")", ";", "stringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "JOB_HOLDER_TABLE_NAME", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "query", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "countReadyStmt", "=", "database", ".", "compileStatement", "(", "stringBuilder", ".", "toString", "(", ")", ")", ";", "}", "else", "{", "countReadyStmt", ".", "clearBindings", "(", ")", ";", "}", "for", "(", "int", "i", "=", "1", ";", "i", "<", "=", "args", ".", "length", ";", "i", "+", "+", ")", "{", "countReadyStmt", ".", "bindString", "(", "i", ",", "args", "[", "i", "-", "1", "]", ")", ";", "}", "return", "countReadyStmt", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "nextJobDelayUntilWithNetworkRequirement", "(", "SQLiteDatabase", "database", ",", "SqlHelper", "sqlHelper", ")", "{", "if", "(", "nextJobDelayUntilViaNetworkStmt", "=", "=", "null", ")", "{", "StringBuilder", "sb", "=", "sqlHelper", ".", "reusedStringBuilder", ";", "sb", ".", "setLength", "(", "0", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ".", "columnName", ")", ";", "if", "(", "networkTimeoutArgIndex", "!", "=", "-", "1", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "REQUIRES_NETWORK_UNTIL_COLUMN", ".", "columnName", ")", ";", "}", "if", "(", "unmeteredNetworkTimeoutArgIndex", "!", "=", "-", "1", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ".", "columnName", ")", ";", "}", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "JOB_HOLDER_TABLE_NAME", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "query", ")", ";", "if", "(", "networkTimeoutArgIndex", "!", "=", "-", "1", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "REQUIRES_NETWORK_UNTIL_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "Params", ".", "FOREVER", ")", ";", "}", "if", "(", "unmeteredNetworkTimeoutArgIndex", "!", "=", "-", "1", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "Params", ".", "FOREVER", ")", ";", "}", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "String", "selectQuery", "=", "sb", ".", "toString", "(", ")", ";", "nextJobDelayUntilViaNetworkStmt", "=", "database", ".", "compileStatement", "(", "selectQuery", ")", ";", "}", "else", "{", "nextJobDelayUntilViaNetworkStmt", ".", "clearBindings", "(", ")", ";", "}", "for", "(", "int", "i", "=", "1", ";", "i", "<", "=", "args", ".", "length", ";", "i", "+", "+", ")", "{", "nextJobDelayUntilViaNetworkStmt", ".", "bindString", "(", "i", ",", "args", "[", "i", "-", "1", "]", ")", ";", "}", "if", "(", "networkTimeoutArgIndex", "!", "=", "-", "1", ")", "{", "nextJobDelayUntilViaNetworkStmt", ".", "bindString", "(", "networkTimeoutArgIndex", "+", "1", ",", "Long", ".", "toString", "(", "Params", ".", "FOREVER", ")", ")", ";", "}", "if", "(", "unmeteredNetworkTimeoutArgIndex", "!", "=", "-", "1", ")", "{", "nextJobDelayUntilViaNetworkStmt", ".", "bindString", "(", "unmeteredNetworkTimeoutArgIndex", "+", "1", ",", "Long", ".", "toString", "(", "Params", ".", "FOREVER", ")", ")", ";", "}", "return", "nextJobDelayUntilViaNetworkStmt", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "nextJobDelayUntil", "(", "SQLiteDatabase", "database", ",", "SqlHelper", "sqlHelper", ")", "{", "if", "(", "nextJobDelayUntilStmt", "=", "=", "null", ")", "{", "String", "selectQuery", "=", "sqlHelper", ".", "createSelectOneField", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ",", "query", ",", "1", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "ASC", ")", ")", ";", "nextJobDelayUntilStmt", "=", "database", ".", "compileStatement", "(", "selectQuery", ")", ";", "}", "else", "{", "nextJobDelayUntilStmt", ".", "clearBindings", "(", ")", ";", "}", "for", "(", "int", "i", "=", "1", ";", "i", "<", "=", "args", ".", "length", ";", "i", "+", "+", ")", "{", "nextJobDelayUntilStmt", ".", "bindString", "(", "i", ",", "args", "[", "i", "-", "1", "]", ")", ";", "}", "return", "nextJobDelayUntilStmt", ";", "}", "</s>"]
["<s>", "public", "String", "nextJob", "(", "SqlHelper", "sqlHelper", ")", "{", "if", "(", "nextJobQuery", "=", "=", "null", ")", "{", "nextJobQuery", "=", "sqlHelper", ".", "createSelect", "(", "query", ",", "1", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "PRIORITY_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "DESC", ")", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "CREATED_NS_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "ASC", ")", ",", "new", "SqlHelper", ".", "Order", "(", "DbOpenHelper", ".", "INSERTION_ORDER_COLUMN", ",", "SqlHelper", ".", "Order", ".", "Type", ".", "ASC", ")", ")", ";", "}", "return", "nextJobQuery", ";", "}", "</s>"]
["<s>", "public", "String", "findJobs", "(", "SqlHelper", "sqlHelper", ")", "{", "if", "(", "findJobsQuery", "=", "=", "null", ")", "{", "findJobsQuery", "=", "sqlHelper", ".", "createSelect", "(", "query", ",", "null", ")", ";", "}", "return", "findJobsQuery", ";", "}", "</s>"]
["<s>", "public", "void", "destroy", "(", ")", "{", "if", "(", "countReadyStmt", "!", "=", "null", ")", "{", "countReadyStmt", ".", "close", "(", ")", ";", "countReadyStmt", "=", "null", ";", "}", "if", "(", "nextJobDelayUntilStmt", "!", "=", "null", ")", "{", "nextJobDelayUntilStmt", ".", "close", "(", ")", ";", "nextJobDelayUntilStmt", "=", "null", ";", "}", "if", "(", "nextJobDelayUntilViaNetworkStmt", "!", "=", "null", ")", "{", "nextJobDelayUntilViaNetworkStmt", ".", "close", "(", ")", ";", "nextJobDelayUntilViaNetworkStmt", "=", "null", ";", "}", "}", "</s>"]
["<s>", "public", "DbOpenHelper", "(", "Context", "context", ",", "String", "name", ")", "{", "super", "(", "context", ",", "name", ",", "null", ",", "DB_VERSION", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onCreate", "(", "SQLiteDatabase", "sqLiteDatabase", ")", "{", "String", "createQuery", "=", "SqlHelper", ".", "create", "(", "JOB_HOLDER_TABLE_NAME", ",", "INSERTION_ORDER_COLUMN", ",", "ID_COLUMN", ",", "PRIORITY_COLUMN", ",", "GROUP_ID_COLUMN", ",", "RUN_COUNT_COLUMN", ",", "BASE_JOB_COLUMN", ",", "CREATED_NS_COLUMN", ",", "DELAY_UNTIL_NS_COLUMN", ",", "RUNNING_SESSION_ID_COLUMN", ",", "REQUIRES_NETWORK_UNTIL_COLUMN", ",", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ")", ";", "sqLiteDatabase", ".", "execSQL", "(", "createQuery", ")", ";", "String", "createTagsQuery", "=", "SqlHelper", ".", "create", "(", "JOB_TAGS_TABLE_NAME", ",", "TAGS_ID_COLUMN", ",", "TAGS_JOB_ID_COLUMN", ",", "TAGS_NAME_COLUMN", ")", ";", "sqLiteDatabase", ".", "execSQL", "(", "createTagsQuery", ")", ";", "sqLiteDatabase", ".", "execSQL", "(", "\"", "<STR_LIT>", "\"", "+", "TAG_INDEX_NAME", "+", "\"", "<STR_LIT>", "\"", "+", "JOB_TAGS_TABLE_NAME", "+", "\"", "<STR_LIT:(>", "\"", "+", "DbOpenHelper", ".", "TAGS_NAME_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onUpgrade", "(", "SQLiteDatabase", "sqLiteDatabase", ",", "int", "oldVersion", ",", "int", "newVersion", ")", "{", "sqLiteDatabase", ".", "execSQL", "(", "SqlHelper", ".", "drop", "(", "JOB_HOLDER_TABLE_NAME", ")", ")", ";", "sqLiteDatabase", ".", "execSQL", "(", "SqlHelper", ".", "drop", "(", "JOB_TAGS_TABLE_NAME", ")", ")", ";", "sqLiteDatabase", ".", "execSQL", "(", "\"", "<STR_LIT>", "\"", "+", "TAG_INDEX_NAME", ")", ";", "onCreate", "(", "sqLiteDatabase", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDowngrade", "(", "SQLiteDatabase", "sqLiteDatabase", ",", "int", "oldVersion", ",", "int", "newVersion", ")", "{", "onUpgrade", "(", "sqLiteDatabase", ",", "oldVersion", ",", "newVersion", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "entryRemoved", "(", "boolean", "evicted", ",", "Long", "key", ",", "Where", "oldValue", ",", "Where", "newValue", ")", "{", "oldValue", ".", "destroy", "(", ")", ";", "}", "</s>"]
["<s>", "public", "WhereQueryCache", "(", "long", "sessionId", ")", "{", "this", ".", "sessionId", "=", "Long", ".", "toString", "(", "sessionId", ")", ";", "}", "</s>"]
["<s>", "public", "Where", "build", "(", "Constraint", "constraint", ",", "Collection", "<", "String", ">", "pendingCancellations", ",", "StringBuilder", "stringBuilder", ")", "{", "final", "boolean", "cacheable", "=", "isCacheable", "(", "constraint", ")", ";", "final", "long", "cacheKey", "=", "cacheKey", "(", "constraint", ",", "pendingCancellations", ")", ";", "Where", "where", "=", "cacheable", "?", "queryCache", ".", "get", "(", "cacheKey", ")", ":", "null", ";", "if", "(", "where", "=", "=", "null", ")", "{", "where", "=", "createWhere", "(", "cacheKey", ",", "constraint", ",", "pendingCancellations", ",", "stringBuilder", ")", ";", "if", "(", "cacheable", ")", "{", "queryCache", ".", "put", "(", "cacheKey", ",", "where", ")", ";", "}", "}", "fillWhere", "(", "constraint", ",", "where", ",", "pendingCancellations", ")", ";", "return", "where", ";", "}", "</s>"]
["<s>", "private", "void", "fillWhere", "(", "Constraint", "constraint", ",", "Where", "where", ",", "Collection", "<", "String", ">", "pendingCancellations", ")", "{", "int", "count", "=", "0", ";", "if", "(", "constraint", ".", "shouldNotRequireNetwork", "(", ")", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "Long", ".", "toString", "(", "constraint", ".", "getNowInNs", "(", ")", ")", ";", "}", "if", "(", "constraint", ".", "shouldNotRequireUnmeteredNetwork", "(", ")", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "Long", ".", "toString", "(", "constraint", ".", "getNowInNs", "(", ")", ")", ";", "}", "if", "(", "constraint", ".", "getTimeLimit", "(", ")", "!", "=", "null", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "Long", ".", "toString", "(", "constraint", ".", "getTimeLimit", "(", ")", ")", ";", "}", "if", "(", "constraint", ".", "getTagConstraint", "(", ")", "!", "=", "null", ")", "{", "for", "(", "String", "tag", ":", "constraint", ".", "getTags", "(", ")", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "tag", ";", "}", "}", "for", "(", "String", "group", ":", "constraint", ".", "getExcludeGroups", "(", ")", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "group", ";", "}", "for", "(", "String", "jobId", ":", "constraint", ".", "getExcludeJobIds", "(", ")", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "jobId", ";", "}", "for", "(", "String", "cancelled", ":", "pendingCancellations", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "cancelled", ";", "}", "if", "(", "constraint", ".", "excludeRunning", "(", ")", ")", "{", "where", ".", "args", "[", "count", "+", "+", "]", "=", "sessionId", ";", "}", "if", "(", "count", "!", "=", "where", ".", "args", ".", "length", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "where", ".", "query", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Where", "createWhere", "(", "long", "cacheKey", ",", "Constraint", "constraint", ",", "Collection", "<", "String", ">", "pendingCancellations", ",", "StringBuilder", "reusedStringBuilder", ")", "{", "reusedStringBuilder", ".", "setLength", "(", "0", ")", ";", "int", "argCount", "=", "0", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "int", "networkTimeoutArgIndex", "=", "-", "1", ";", "int", "unmeteredTimeoutArgIndex", "=", "-", "1", ";", "if", "(", "constraint", ".", "shouldNotRequireNetwork", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "REQUIRES_NETWORK_UNTIL_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "networkTimeoutArgIndex", "=", "argCount", ";", "argCount", "+", "+", ";", "}", "if", "(", "constraint", ".", "shouldNotRequireUnmeteredNetwork", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "unmeteredTimeoutArgIndex", "=", "argCount", ";", "argCount", "+", "+", ";", "}", "if", "(", "constraint", ".", "getTimeLimit", "(", ")", "!", "=", "null", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "argCount", "+", "+", ";", "}", "if", "(", "constraint", ".", "getTagConstraint", "(", ")", "!", "=", "null", ")", "{", "if", "(", "constraint", ".", "getTags", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "TAGS_JOB_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "JOB_TAGS_TABLE_NAME", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "TAGS_NAME_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "SqlHelper", ".", "addPlaceholdersInto", "(", "reusedStringBuilder", ",", "constraint", ".", "getTags", "(", ")", ".", "size", "(", ")", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "if", "(", "constraint", ".", "getTagConstraint", "(", ")", "=", "=", "TagConstraint", ".", "ANY", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "else", "if", "(", "constraint", ".", "getTagConstraint", "(", ")", "=", "=", "TagConstraint", ".", "ALL", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "TAGS_JOB_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "constraint", ".", "getTags", "(", ")", ".", "size", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "constraint", ")", ";", "}", "argCount", "+", "=", "constraint", ".", "getTags", "(", ")", ".", "size", "(", ")", ";", "}", "}", "if", "(", "!", "constraint", ".", "getExcludeGroups", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "GROUP_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "SqlHelper", ".", "addPlaceholdersInto", "(", "reusedStringBuilder", ",", "constraint", ".", "getExcludeGroups", "(", ")", ".", "size", "(", ")", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "argCount", "+", "=", "constraint", ".", "getExcludeGroups", "(", ")", ".", "size", "(", ")", ";", "}", "if", "(", "!", "constraint", ".", "getExcludeJobIds", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "SqlHelper", ".", "addPlaceholdersInto", "(", "reusedStringBuilder", ",", "constraint", ".", "getExcludeJobIds", "(", ")", ".", "size", "(", ")", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "argCount", "+", "=", "constraint", ".", "getExcludeJobIds", "(", ")", ".", "size", "(", ")", ";", "}", "if", "(", "!", "pendingCancellations", ".", "isEmpty", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "SqlHelper", ".", "addPlaceholdersInto", "(", "reusedStringBuilder", ",", "pendingCancellations", ".", "size", "(", ")", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "argCount", "+", "=", "pendingCancellations", ".", "size", "(", ")", ";", "}", "if", "(", "constraint", ".", "excludeRunning", "(", ")", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "RUNNING_SESSION_ID_COLUMN", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "argCount", "+", "+", ";", "}", "String", "[", "]", "args", "=", "new", "String", "[", "argCount", "]", ";", "Where", "where", "=", "new", "Where", "(", "cacheKey", ",", "reusedStringBuilder", ".", "toString", "(", ")", ",", "args", ")", ";", "where", ".", "setNetworkTimeoutArgIndex", "(", "networkTimeoutArgIndex", ")", ";", "where", ".", "setUnmeteredNetworkTimeoutArgIndex", "(", "unmeteredTimeoutArgIndex", ")", ";", "return", "where", ";", "}", "</s>"]
["<s>", "private", "boolean", "isCacheable", "(", "Constraint", "constraint", ")", "{", "return", "constraint", ".", "getTags", "(", ")", ".", "size", "(", ")", "<", "INT_LIMIT", "&", "&", "constraint", ".", "getExcludeGroups", "(", ")", ".", "size", "(", ")", "<", "INT_LIMIT", "&", "&", "constraint", ".", "getExcludeJobIds", "(", ")", ".", "size", "(", ")", "<", "INT_LIMIT", ";", "}", "</s>"]
["<s>", "private", "long", "cacheKey", "(", "Constraint", "constraint", ",", "Collection", "<", "String", ">", "pendingCancelations", ")", "{", "long", "key", ";", "key", "=", "(", "constraint", ".", "shouldNotRequireNetwork", "(", ")", "?", "1", ":", "0", ")", "<", "<", "NETWORK", "|", "(", "constraint", ".", "shouldNotRequireUnmeteredNetwork", "(", ")", "?", "1", ":", "0", ")", "<", "<", "UNMETERED_NETWORK", "|", "(", "constraint", ".", "getTagConstraint", "(", ")", "=", "=", "null", "?", "<NUM_LIT:2>", ":", "constraint", ".", "getTagConstraint", "(", ")", ".", "ordinal", "(", ")", ")", "<", "<", "TAG_TYPE", "|", "constraint", ".", "getTags", "(", ")", ".", "size", "(", ")", "<", "<", "TAG_COUNT", "|", "constraint", ".", "getExcludeGroups", "(", ")", ".", "size", "(", ")", "<", "<", "GROUP_COUNT", "|", "constraint", ".", "getExcludeJobIds", "(", ")", ".", "size", "(", ")", "<", "<", "JOB_COUNT", "|", "(", "constraint", ".", "excludeRunning", "(", ")", "?", "1", ":", "0", ")", "<", "<", "EXCLUDE_RUNNING", "|", "(", "constraint", ".", "getTimeLimit", "(", ")", "=", "=", "null", "?", "1", ":", "0", ")", "<", "<", "TIME_LIMIT", "|", "pendingCancelations", ".", "size", "(", ")", "<", "<", "PENDING_CANCELLATIONS", ";", "return", "key", ";", "}", "</s>"]
["<s>", "public", "SqlHelper", "(", "SQLiteDatabase", "db", ",", "String", "tableName", ",", "String", "primaryKeyColumnName", ",", "int", "columnCount", ",", "String", "tagsTableName", ",", "int", "tagsColumnCount", ",", "long", "sessionId", ")", "{", "this", ".", "db", "=", "db", ";", "this", ".", "tableName", "=", "tableName", ";", "this", ".", "columnCount", "=", "columnCount", ";", "this", ".", "primaryKeyColumnName", "=", "primaryKeyColumnName", ";", "this", ".", "sessionId", "=", "sessionId", ";", "this", ".", "tagsColumnCount", "=", "tagsColumnCount", ";", "this", ".", "tagsTableName", "=", "tagsTableName", ";", "FIND_BY_ID_QUERY", "=", "\"", "<STR_LIT>", "\"", "+", "tableName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", ";", "FIND_BY_TAG_QUERY", "=", "\"", "<STR_LIT>", "\"", "+", "tableName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "TAGS_JOB_ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "tagsTableName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "TAGS_NAME_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "public", "static", "String", "create", "(", "String", "tableName", ",", "Property", "primaryKey", ",", "Property", ".", ".", ".", "properties", ")", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "append", "(", "tableName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "append", "(", "primaryKey", ".", "columnName", ")", ".", "append", "(", "\"", "\"", ")", ";", "builder", ".", "append", "(", "primaryKey", ".", "type", ")", ";", "builder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "Property", "property", ":", "properties", ")", "{", "builder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "property", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "property", ".", "type", ")", ";", "if", "(", "property", ".", "unique", ")", "{", "builder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "for", "(", "Property", "property", ":", "properties", ")", "{", "if", "(", "property", ".", "foreignKey", "!", "=", "null", ")", "{", "ForeignKey", "key", "=", "property", ".", "foreignKey", ";", "builder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "property", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "key", ".", "targetTable", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "key", ".", "targetFieldName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "builder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "JqLog", ".", "d", "(", "builder", ".", "toString", "(", ")", ")", ";", "return", "builder", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "drop", "(", "String", "tableName", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "tableName", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getInsertStatement", "(", ")", "{", "if", "(", "insertStatement", "=", "=", "null", ")", "{", "reusedStringBuilder", ".", "setLength", "(", "0", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "tableName", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "columnCount", ";", "i", "+", "+", ")", "{", "if", "(", "i", "!", "=", "0", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:?>", "\"", ")", ";", "}", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "insertStatement", "=", "db", ".", "compileStatement", "(", "reusedStringBuilder", ".", "toString", "(", ")", ")", ";", "}", "return", "insertStatement", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getInsertTagsStatement", "(", ")", "{", "if", "(", "insertTagsStatement", "=", "=", "null", ")", "{", "reusedStringBuilder", ".", "setLength", "(", "0", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "DbOpenHelper", ".", "JOB_TAGS_TABLE_NAME", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "tagsColumnCount", ";", "i", "+", "+", ")", "{", "if", "(", "i", "!", "=", "0", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:?>", "\"", ")", ";", "}", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "insertTagsStatement", "=", "db", ".", "compileStatement", "(", "reusedStringBuilder", ".", "toString", "(", ")", ")", ";", "}", "return", "insertTagsStatement", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getCountStatement", "(", ")", "{", "if", "(", "countStatement", "=", "=", "null", ")", "{", "countStatement", "=", "db", ".", "compileStatement", "(", "\"", "<STR_LIT>", "\"", "+", "tableName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "RUNNING_SESSION_ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "countStatement", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getInsertOrReplaceStatement", "(", ")", "{", "if", "(", "insertOrReplaceStatement", "=", "=", "null", ")", "{", "reusedStringBuilder", ".", "setLength", "(", "0", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "tableName", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "columnCount", ";", "i", "+", "+", ")", "{", "if", "(", "i", "!", "=", "0", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:?>", "\"", ")", ";", "}", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "insertOrReplaceStatement", "=", "db", ".", "compileStatement", "(", "reusedStringBuilder", ".", "toString", "(", ")", ")", ";", "}", "return", "insertOrReplaceStatement", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getDeleteStatement", "(", ")", "{", "if", "(", "deleteStatement", "=", "=", "null", ")", "{", "deleteStatement", "=", "db", ".", "compileStatement", "(", "\"", "<STR_LIT>", "\"", "+", "tableName", "+", "\"", "<STR_LIT>", "\"", "+", "primaryKeyColumnName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "deleteStatement", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getOnJobFetchedForRunningStatement", "(", ")", "{", "if", "(", "onJobFetchedForRunningStatement", "=", "=", "null", ")", "{", "String", "sql", "=", "\"", "<STR_LIT>", "\"", "+", "tableName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "RUN_COUNT_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "RUNNING_SESSION_ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "primaryKeyColumnName", "+", "\"", "<STR_LIT>", "\"", ";", "onJobFetchedForRunningStatement", "=", "db", ".", "compileStatement", "(", "sql", ")", ";", "}", "return", "onJobFetchedForRunningStatement", ";", "}", "</s>"]
["<s>", "public", "String", "createSelect", "(", "String", "where", ",", "Integer", "limit", ",", "Order", ".", ".", ".", "orders", ")", "{", "reusedStringBuilder", ".", "setLength", "(", "0", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "reusedStringBuilder", ".", "append", "(", "tableName", ")", ";", "if", "(", "where", "!", "=", "null", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "where", ")", ";", "}", "boolean", "first", "=", "true", ";", "for", "(", "Order", "order", ":", "orders", ")", "{", "if", "(", "first", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "first", "=", "false", ";", "reusedStringBuilder", ".", "append", "(", "order", ".", "property", ".", "columnName", ")", ".", "append", "(", "\"", "\"", ")", ".", "append", "(", "order", ".", "type", ")", ";", "}", "if", "(", "limit", "!", "=", "null", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "limit", ")", ";", "}", "return", "reusedStringBuilder", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "createSelectOneField", "(", "Property", "property", ",", "String", "where", ",", "Integer", "limit", ",", "Order", ".", ".", ".", "orders", ")", "{", "reusedStringBuilder", ".", "setLength", "(", "0", ")", ";", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "property", ".", "columnName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "tableName", ")", ";", "if", "(", "where", "!", "=", "null", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "where", ")", ";", "}", "boolean", "first", "=", "true", ";", "for", "(", "Order", "order", ":", "orders", ")", "{", "if", "(", "first", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "first", "=", "false", ";", "reusedStringBuilder", ".", "append", "(", "order", ".", "property", ".", "columnName", ")", ".", "append", "(", "\"", "\"", ")", ".", "append", "(", "order", ".", "type", ")", ";", "}", "if", "(", "limit", "!", "=", "null", ")", "{", "reusedStringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "limit", ")", ";", "}", "return", "reusedStringBuilder", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "static", "void", "addPlaceholdersInto", "(", "StringBuilder", "stringBuilder", ",", "int", "count", ")", "{", "if", "(", "count", "=", "=", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "stringBuilder", ".", "append", "(", "\"", "<STR_LIT:?>", "\"", ")", ";", "for", "(", "int", "i", "=", "1", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "stringBuilder", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "truncate", "(", ")", "{", "db", ".", "execSQL", "(", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "JOB_HOLDER_TABLE_NAME", ")", ";", "vacuum", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "vacuum", "(", ")", "{", "db", ".", "execSQL", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "void", "resetDelayTimesTo", "(", "long", "newDelayTime", ")", "{", "db", ".", "execSQL", "(", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "JOB_HOLDER_TABLE_NAME", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "DELAY_UNTIL_NS_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "REQUIRES_NETWORK_UNTIL_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "REQUIRES_UNMETERED_NETWORK_UNTIL_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "newDelayTime", ",", "newDelayTime", ",", "newDelayTime", "}", ")", ";", "}", "</s>"]
["<s>", "public", "Property", "(", "String", "columnName", ",", "String", "type", ",", "int", "columnIndex", ")", "{", "this", "(", "columnName", ",", "type", ",", "columnIndex", ",", "null", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "Property", "(", "String", "columnName", ",", "String", "type", ",", "int", "columnIndex", ",", "ForeignKey", "foreignKey", ")", "{", "this", "(", "columnName", ",", "type", ",", "columnIndex", ",", "foreignKey", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "Property", "(", "String", "columnName", ",", "String", "type", ",", "int", "columnIndex", ",", "ForeignKey", "foreignKey", ",", "boolean", "unique", ")", "{", "this", ".", "columnName", "=", "columnName", ";", "this", ".", "type", "=", "type", ";", "this", ".", "columnIndex", "=", "columnIndex", ";", "this", ".", "foreignKey", "=", "foreignKey", ";", "this", ".", "unique", "=", "unique", ";", "}", "</s>"]
["<s>", "public", "ForeignKey", "(", "String", "targetTable", ",", "String", "targetFieldName", ")", "{", "this", ".", "targetTable", "=", "targetTable", ";", "this", ".", "targetFieldName", "=", "targetFieldName", ";", "}", "</s>"]
["<s>", "public", "Order", "(", "Property", "property", ",", "Type", "type", ")", "{", "this", ".", "property", "=", "property", ";", "this", ".", "type", "=", "type", ";", "}", "</s>"]
["<s>", "private", "Configuration", "(", ")", "{", "}", "</s>"]
["<s>", "public", "Context", "getAppContext", "(", ")", "{", "return", "appContext", ";", "}", "</s>"]
["<s>", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "QueueFactory", "getQueueFactory", "(", ")", "{", "return", "queueFactory", ";", "}", "</s>"]
["<s>", "public", "DependencyInjector", "getDependencyInjector", "(", ")", "{", "return", "dependencyInjector", ";", "}", "</s>"]
["<s>", "public", "int", "getConsumerKeepAlive", "(", ")", "{", "return", "consumerKeepAlive", ";", "}", "</s>"]
["<s>", "public", "NetworkUtil", "getNetworkUtil", "(", ")", "{", "return", "networkUtil", ";", "}", "</s>"]
["<s>", "public", "int", "getMaxConsumerCount", "(", ")", "{", "return", "maxConsumerCount", ";", "}", "</s>"]
["<s>", "public", "int", "getMinConsumerCount", "(", ")", "{", "return", "minConsumerCount", ";", "}", "</s>"]
["<s>", "public", "CustomLogger", "getCustomLogger", "(", ")", "{", "return", "customLogger", ";", "}", "</s>"]
["<s>", "public", "int", "getLoadFactor", "(", ")", "{", "return", "loadFactor", ";", "}", "</s>"]
["<s>", "public", "boolean", "isInTestMode", "(", ")", "{", "return", "inTestMode", ";", "}", "</s>"]
["<s>", "public", "Timer", "getTimer", "(", ")", "{", "return", "timer", ";", "}", "</s>"]
["<s>", "public", "boolean", "resetDelaysOnRestart", "(", ")", "{", "return", "resetDelaysOnRestart", ";", "}", "</s>"]
["<s>", "public", "Scheduler", "getScheduler", "(", ")", "{", "return", "scheduler", ";", "}", "</s>"]
["<s>", "public", "Builder", "(", "Context", "context", ")", "{", "this", ".", "configuration", "=", "new", "Configuration", "(", ")", ";", "this", ".", "configuration", ".", "appContext", "=", "context", ".", "getApplicationContext", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "id", "(", "String", "id", ")", "{", "configuration", ".", "id", "=", "id", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "consumerKeepAlive", "(", "int", "keepAlive", ")", "{", "configuration", ".", "consumerKeepAlive", "=", "keepAlive", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "resetDelaysOnRestart", "(", ")", "{", "configuration", ".", "resetDelaysOnRestart", "=", "true", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "queueFactory", "(", "com", ".", "birbit", ".", "android", ".", "jobqueue", ".", "QueueFactory", "queueFactory", ")", "{", "if", "(", "configuration", ".", "queueFactory", "!", "=", "null", "&", "&", "queueFactory", "!", "=", "null", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "configuration", ".", "queueFactory", "=", "queueFactory", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "jobSerializer", "(", "SqliteJobQueue", ".", "JobSerializer", "jobSerializer", ")", "{", "configuration", ".", "queueFactory", "=", "new", "DefaultQueueFactory", "(", "jobSerializer", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "networkUtil", "(", "NetworkUtil", "networkUtil", ")", "{", "configuration", ".", "networkUtil", "=", "networkUtil", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "injector", "(", "DependencyInjector", "injector", ")", "{", "configuration", ".", "dependencyInjector", "=", "injector", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "maxConsumerCount", "(", "int", "count", ")", "{", "configuration", ".", "maxConsumerCount", "=", "count", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "minConsumerCount", "(", "int", "count", ")", "{", "configuration", ".", "minConsumerCount", "=", "count", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "timer", "(", "Timer", "timer", ")", "{", "configuration", ".", "timer", "=", "timer", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "customLogger", "(", "CustomLogger", "logger", ")", "{", "configuration", ".", "customLogger", "=", "logger", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "loadFactor", "(", "int", "loadFactor", ")", "{", "configuration", ".", "loadFactor", "=", "loadFactor", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "inTestMode", "(", ")", "{", "configuration", ".", "inTestMode", "=", "true", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "scheduler", "(", "Scheduler", "scheduler", ")", "{", "configuration", ".", "scheduler", "=", "scheduler", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Configuration", "build", "(", ")", "{", "if", "(", "configuration", ".", "queueFactory", "=", "=", "null", ")", "{", "configuration", ".", "queueFactory", "=", "new", "DefaultQueueFactory", "(", ")", ";", "}", "if", "(", "configuration", ".", "networkUtil", "=", "=", "null", ")", "{", "configuration", ".", "networkUtil", "=", "new", "NetworkUtilImpl", "(", "configuration", ".", "appContext", ")", ";", "}", "if", "(", "configuration", ".", "timer", "=", "=", "null", ")", "{", "configuration", ".", "timer", "=", "new", "SystemTimer", "(", ")", ";", "}", "return", "configuration", ";", "}", "</s>"]
["<s>", "@", "NetworkStatus", "int", "getNetworkStatus", "(", "Context", "context", ")", ";", "</s>"]
["<s>", "public", "NetworkUtilImpl", "(", "Context", "context", ")", "{", "context", ".", "getApplicationContext", "(", ")", ".", "registerReceiver", "(", "new", "BroadcastReceiver", "(", ")", "{", "@", "Override", "public", "void", "onReceive", "(", "Context", "context", ",", "Intent", "intent", ")", "{", "if", "(", "listener", "=", "=", "null", ")", "{", "return", ";", "}", "listener", ".", "onNetworkChange", "(", "getNetworkStatus", "(", "context", ")", ")", ";", "}", "}", ",", "getNetworkIntentFilter", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onReceive", "(", "Context", "context", ",", "Intent", "intent", ")", "{", "if", "(", "listener", "=", "=", "null", ")", "{", "return", ";", "}", "listener", ".", "onNetworkChange", "(", "getNetworkStatus", "(", "context", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNetworkStatus", "(", "Context", "context", ")", "{", "if", "(", "isDozing", "(", "context", ")", ")", "{", "return", "NetworkUtil", ".", "DISCONNECTED", ";", "}", "ConnectivityManager", "cm", "=", "(", "ConnectivityManager", ")", "context", ".", "getSystemService", "(", "Context", ".", "CONNECTIVITY_SERVICE", ")", ";", "NetworkInfo", "netInfo", "=", "cm", ".", "getActiveNetworkInfo", "(", ")", ";", "if", "(", "netInfo", "=", "=", "null", ")", "{", "return", "NetworkUtil", ".", "DISCONNECTED", ";", "}", "if", "(", "netInfo", ".", "getType", "(", ")", "=", "=", "ConnectivityManager", ".", "TYPE_WIFI", "|", "|", "netInfo", ".", "getType", "(", ")", "=", "=", "ConnectivityManager", ".", "TYPE_ETHERNET", ")", "{", "return", "NetworkUtil", ".", "UNMETERED", ";", "}", "return", "NetworkUtil", ".", "METERED", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "<NUM_LIT>", ")", "private", "static", "IntentFilter", "getNetworkIntentFilter", "(", ")", "{", "IntentFilter", "networkIntentFilter", "=", "new", "IntentFilter", "(", "ConnectivityManager", ".", "CONNECTIVITY_ACTION", ")", ";", "if", "(", "VERSION", ".", "SDK_INT", ">", "=", "<NUM_LIT>", ")", "{", "networkIntentFilter", ".", "addAction", "(", "PowerManager", ".", "ACTION_DEVICE_IDLE_MODE_CHANGED", ")", ";", "}", "return", "networkIntentFilter", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "<NUM_LIT>", ")", "private", "static", "boolean", "isDozing", "(", "Context", "context", ")", "{", "if", "(", "VERSION", ".", "SDK_INT", ">", "=", "<NUM_LIT>", ")", "{", "PowerManager", "powerManager", "=", "(", "PowerManager", ")", "context", ".", "getSystemService", "(", "Context", ".", "POWER_SERVICE", ")", ";", "return", "powerManager", ".", "isDeviceIdleMode", "(", ")", "&", "&", "!", "powerManager", ".", "isIgnoringBatteryOptimizations", "(", "context", ".", "getPackageName", "(", ")", ")", ";", "}", "else", "{", "return", "false", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setListener", "(", "Listener", "listener", ")", "{", "this", ".", "listener", "=", "listener", ";", "}", "</s>"]
["<s>", "void", "setListener", "(", "Listener", "listener", ")", ";", "</s>"]
["<s>", "void", "onNetworkChange", "(", "@", "NetworkUtil", ".", "NetworkStatus", "int", "networkStatus", ")", ";", "</s>"]
["<s>", "long", "nanoTime", "(", ")", ";", "</s>"]
["<s>", "void", "waitOnObjectUntilNs", "(", "Object", "object", ",", "long", "timeout", ")", "throws", "InterruptedException", ";", "</s>"]
["<s>", "void", "notifyObject", "(", "Object", "object", ")", ";", "</s>"]
["<s>", "void", "waitOnObject", "(", "Object", "object", ")", "throws", "InterruptedException", ";", "</s>"]
["<s>", "public", "SystemTimer", "(", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ")", ";", "startWallClock", "=", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ";", "startNs", "=", "System", ".", "nanoTime", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "nanoTime", "(", ")", "{", "return", "System", ".", "nanoTime", "(", ")", "-", "startNs", "+", "startWallClock", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "waitOnObjectUntilNs", "(", "Object", "object", ",", "long", "untilNs", ")", "throws", "InterruptedException", "{", "long", "now", "=", "nanoTime", "(", ")", ";", "if", "(", "now", ">", "untilNs", ")", "{", "object", ".", "wait", "(", "1", ")", ";", "}", "else", "{", "TimeUnit", ".", "NANOSECONDS", ".", "timedWait", "(", "object", ",", "untilNs", "-", "now", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "waitOnObject", "(", "Object", "object", ")", "throws", "InterruptedException", "{", "object", ".", "wait", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "notifyObject", "(", "Object", "object", ")", "{", "object", ".", "notifyAll", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "clearLogger", "(", ")", "{", "setCustomLogger", "(", "new", "CustomLogger", "(", ")", "{", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "false", ";", "}", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "}", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "}", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "}", "</s>"]
["<s>", "public", "static", "void", "setCustomLogger", "(", "CustomLogger", "customLogger", ")", "{", "JqLog", ".", "customLogger", "=", "customLogger", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "isDebugEnabled", "(", ")", "{", "return", "customLogger", ".", "isDebugEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "customLogger", ".", "d", "(", "text", ",", "args", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "customLogger", ".", "e", "(", "t", ",", "text", ",", "args", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "customLogger", ".", "e", "(", "text", ",", "args", ")", ";", "}", "</s>"]
["<s>", "boolean", "isDebugEnabled", "(", ")", ";", "</s>"]
["<s>", "void", "d", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", ";", "</s>"]
["<s>", "void", "e", "(", "Throwable", "t", ",", "String", "text", ",", "Object", ".", ".", ".", "args", ")", ";", "</s>"]
["<s>", "void", "e", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobAdded", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onJobCancelled", "(", "Job", "job", ",", "boolean", "byCancelRequest", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onDone", "(", "Job", "job", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", "{", "}", "</s>"]
["<s>", "void", "onJobAdded", "(", "Job", "job", ")", ";", "</s>"]
["<s>", "void", "onJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", ";", "</s>"]
["<s>", "void", "onJobCancelled", "(", "Job", "job", ",", "boolean", "byCancelRequest", ")", ";", "</s>"]
["<s>", "void", "onDone", "(", "Job", "job", ")", ";", "</s>"]
["<s>", "void", "onAfterJobRun", "(", "Job", "job", ",", "int", "resultCode", ")", ";", "</s>"]
