["<s>", "private", "void", "handleSchedulerStop", "(", "SchedulerConstraint", "constraint", ")", "{", "final", "List", "<", "SchedulerConstraint", ">", "pendingCallbacks", "=", "this", ".", "pendingSchedulerCallbacks", ";", "if", "(", "pendingCallbacks", "!", "=", "null", ")", "{", "for", "(", "int", "i", "=", "pendingCallbacks", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "SchedulerConstraint", "pendingConstraint", "=", "pendingCallbacks", ".", "get", "(", "i", ")", ";", "if", "(", "pendingConstraint", ".", "getUuid", "(", ")", ".", "equals", "(", "constraint", ".", "getUuid", "(", ")", ")", ")", "{", "pendingCallbacks", ".", "remove", "(", "i", ")", ";", "}", "}", "}", "if", "(", "scheduler", "=", "=", "null", ")", "{", "return", ";", "}", "final", "boolean", "hasMatchingJobs", "=", "hasJobsWithSchedulerConstraint", "(", "constraint", ")", ";", "if", "(", "hasMatchingJobs", ")", "{", "scheduler", ".", "request", "(", "constraint", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "setUuid", "(", "String", "uuid", ")", "{", "this", ".", "uuid", "=", "uuid", ";", "}", "</s>"]
["<s>", "@", "NetworkUtil", ".", "NetworkStatus", "public", "int", "getNetworkStatus", "(", ")", "{", "return", "networkStatus", ";", "}", "</s>"]
["<s>", "public", "void", "setNetworkStatus", "(", "int", "networkStatus", ")", "{", "this", ".", "networkStatus", "=", "networkStatus", ";", "}", "</s>"]
["<s>", "public", "Params", "setRequiresUnmeteredNetwork", "(", "boolean", "requiresUnmeteredNetwork", ",", "long", "timeout", ")", "{", "if", "(", "!", "requiresUnmeteredNetwork", ")", "{", "this", ".", "requiresUnmeteredNetworkWithTimeout", "=", "NEVER", ";", "}", "else", "{", "this", ".", "requiresUnmeteredNetworkWithTimeout", "=", "timeout", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "setRequiresUnmeteredNetwork", "(", "boolean", "requiresUnmeteredNetwork", ")", "{", "return", "setRequiresUnmeteredNetwork", "(", "requiresUnmeteredNetwork", ",", "FOREVER", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedRobolectricTestRunner", ".", "Parameters", "(", "name", "=", "\"", "<STR_LIT>", "\"", ")", "public", "static", "List", "<", "Object", "[", "]", ">", "getParams", "(", ")", "{", "List", "<", "Object", "[", "]", ">", "params", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", "long", "delay", ":", "new", "long", "[", "]", "{", "0", ",", "<NUM_LIT:1000>", ",", "JobManager", ".", "MIN_DELAY_TO_USE_SCHEDULER_IN_MS", "}", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:8>", ";", "i", "+", "+", ")", "{", "params", ".", "add", "(", "new", "Object", "[", "]", "{", "(", "i", "&", "1", ")", "=", "=", "1", ",", "(", "i", "&", "<NUM_LIT:2>", ")", "=", "=", "<NUM_LIT:2>", ",", "(", "i", "&", "<NUM_LIT:4>", ")", "=", "=", "<NUM_LIT:4>", ",", "delay", "}", ")", ";", "}", "}", "return", "params", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testScheduleWhenJobAdded", "(", ")", "throws", "InterruptedException", "{", "Scheduler", "scheduler", "=", "Mockito", ".", "mock", "(", "Scheduler", ".", "class", ")", ";", "ArgumentCaptor", "<", "SchedulerConstraint", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "SchedulerConstraint", ".", "class", ")", ";", "DummyNetworkUtilWithConnectivityEventSupport", "networkUtil", "=", "new", "DummyNetworkUtilWithConnectivityEventSupport", "(", ")", ";", "Configuration", ".", "Builder", "builder", "=", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "timer", "(", "mockTimer", ")", ".", "networkUtil", "(", "networkUtil", ")", ".", "inTestMode", "(", ")", ".", "scheduler", "(", "scheduler", ")", ";", "if", "(", "requireUnmeteredNetwork", ")", "{", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "UNMETERED", ")", ";", "}", "else", "if", "(", "requireNetwork", ")", "{", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "METERED", ")", ";", "}", "else", "{", "networkUtil", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "}", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "builder", ")", ";", "Params", "params", "=", "new", "Params", "(", "1", ")", ";", "params", ".", "setPersistent", "(", "persistent", ")", ";", "params", ".", "setRequiresNetwork", "(", "requireNetwork", ")", ";", "params", ".", "setRequiresUnmeteredNetwork", "(", "requireUnmeteredNetwork", ")", ";", "params", ".", "setDelayMs", "(", "delayInMs", ")", ";", "final", "SchedulerJob", "job", "=", "new", "SchedulerJob", "(", "params", ")", ";", "waitUntilJobsAreDone", "(", "jobManager", ",", "Collections", ".", "singletonList", "(", "job", ")", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "mockTimer", ".", "incrementMs", "(", "delayInMs", ")", ";", "}", "}", ")", ";", "if", "(", "persistent", "&", "&", "(", "requireNetwork", "|", "|", "requireUnmeteredNetwork", "|", "|", "delayInMs", ">", "=", "JobManager", ".", "MIN_DELAY_TO_USE_SCHEDULER_IN_MS", ")", ")", "{", "Mockito", ".", "verify", "(", "scheduler", ")", ".", "request", "(", "captor", ".", "capture", "(", ")", ")", ";", "SchedulerConstraint", "constraint", "=", "captor", ".", "getValue", "(", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getNetworkStatus", "(", ")", ",", "CoreMatchers", ".", "is", "(", "requireUnmeteredNetwork", "?", "NetworkUtil", ".", "UNMETERED", ":", "requireNetwork", "?", "NetworkUtil", ".", "METERED", ":", "NetworkUtil", ".", "DISCONNECTED", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "delayInMs", ")", ")", ";", "Mockito", ".", "verify", "(", "scheduler", ")", ".", "cancelAll", "(", ")", ";", "}", "else", "{", "Mockito", ".", "verify", "(", "scheduler", ",", "Mockito", ".", "never", "(", ")", ")", ".", "request", "(", "Mockito", ".", "any", "(", "SchedulerConstraint", ".", "class", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "removeFromConstraints", "(", "SchedulerConstraint", "constraint", ")", "{", "synchronized", "(", "constraints", ")", "{", "for", "(", "int", "i", "=", "constraints", ".", "size", "(", ")", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "ConstraintWrapper", "existing", "=", "constraints", ".", "get", "(", "i", ")", ";", "if", "(", "existing", ".", "constraint", ".", "getUuid", "(", ")", ".", "equals", "(", "constraint", ".", "getUuid", "(", ")", ")", ")", "{", "constraints", ".", "remove", "(", "i", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "protected", "boolean", "addToConstraints", "(", "SchedulerConstraint", "constraint", ")", "{", "final", "long", "now", "=", "timer", ".", "nanoTime", "(", ")", ";", "long", "expectedRunTime", "=", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "constraint", ".", "getDelayInMs", "(", ")", ")", "+", "now", ";", "synchronized", "(", "constraints", ")", "{", "for", "(", "ConstraintWrapper", "existing", ":", "constraints", ")", "{", "if", "(", "covers", "(", "existing", ",", "constraint", ",", "expectedRunTime", ")", ")", "{", "return", "false", ";", "}", "}", "long", "group", "=", "constraint", ".", "getDelayInMs", "(", ")", "/", "batchingDurationInMs", ";", "long", "newDelay", "=", "(", "group", "+", "1", ")", "*", "batchingDurationInMs", ";", "constraint", ".", "setDelayInMs", "(", "newDelay", ")", ";", "constraints", ".", "add", "(", "new", "ConstraintWrapper", "(", "now", "+", "TimeUnit", ".", "MILLISECONDS", ".", "toNanos", "(", "newDelay", ")", ",", "constraint", ")", ")", ";", "return", "true", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "covers", "(", "ConstraintWrapper", "existing", ",", "SchedulerConstraint", "constraint", ",", "long", "expectedRunTime", ")", "{", "if", "(", "existing", ".", "constraint", ".", "getNetworkStatus", "(", ")", "!", "=", "constraint", ".", "getNetworkStatus", "(", ")", ")", "{", "return", "false", ";", "}", "long", "timeDiff", "=", "existing", ".", "delayUntilNs", "-", "expectedRunTime", ";", "return", "timeDiff", ">", "0", "&", "&", "timeDiff", "<", "=", "batchingDurationInNs", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "init", "(", ")", "{", "scheduler", "=", "mock", "(", "Scheduler", ".", "class", ")", ";", "MockTimer", "timer", "=", "new", "MockTimer", "(", ")", ";", "bs", "=", "new", "BatchingScheduler", "(", "scheduler", ",", "timer", ")", ";", "Context", "context", "=", "mock", "(", "Context", ".", "class", ")", ";", "when", "(", "context", ".", "getApplicationContext", "(", ")", ")", ".", "thenReturn", "(", "mock", "(", "Context", ".", "class", ")", ")", ";", "bs", ".", "init", "(", "context", ",", "mock", "(", "Scheduler", ".", "Callback", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddOne", "(", ")", "{", "SchedulerConstraint", "constraint", "=", "new", "SchedulerConstraint", "(", "\"", "<STR_LIT>", "\"", ")", ";", "constraint", ".", "setDelayInMs", "(", "0", ")", ";", "constraint", ".", "setNetworkStatus", "(", "NetworkUtil", ".", "DISCONNECTED", ")", ";", "bs", ".", "request", "(", "constraint", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddTwoOfTheSame", "(", ")", "{", "SchedulerConstraint", "constraint", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint", ")", ";", "SchedulerConstraint", "constraint2", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint2", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "0", ")", ")", ".", "request", "(", "constraint2", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddTwoOfTheSameWithDelay", "(", ")", "{", "SchedulerConstraint", "constraint", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint", ")", ";", "SchedulerConstraint", "constraint2", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "<NUM_LIT:100>", ")", ";", "bs", ".", "request", "(", "constraint2", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "0", ")", ")", ".", "request", "(", "constraint2", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddTwoOfTheSameWithEnoughDelay", "(", ")", "{", "SchedulerConstraint", "constraint", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint", ")", ";", "SchedulerConstraint", "constraint2", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "BatchingScheduler", ".", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ";", "bs", ".", "request", "(", "constraint2", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint2", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint2", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", "*", "<NUM_LIT:2>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddTwoWithDifferentNetwork", "(", ")", "{", "SchedulerConstraint", "constraint", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint", ")", ";", "SchedulerConstraint", "constraint2", "=", "createConstraint", "(", "NetworkUtil", ".", "UNMETERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint2", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint2", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint2", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddRemoveThenAddAgainOfTheSame", "(", ")", "{", "SchedulerConstraint", "constraint", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "0", ")", ";", "bs", ".", "request", "(", "constraint", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "bs", ".", "onFinished", "(", "constraint", ",", "false", ")", ";", "SchedulerConstraint", "constraint2", "=", "createConstraint", "(", "NetworkUtil", ".", "METERED", ",", "<NUM_LIT:2>", ")", ";", "bs", ".", "request", "(", "constraint2", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "1", ")", ")", ".", "request", "(", "constraint2", ")", ";", "MatcherAssert", ".", "assertThat", "(", "constraint2", ".", "getDelayInMs", "(", ")", ",", "CoreMatchers", ".", "is", "(", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "SchedulerConstraint", "createConstraint", "(", "@", "NetworkUtil", ".", "NetworkStatus", "int", "networkStatus", ",", "long", "delay", ")", "{", "SchedulerConstraint", "constraint", "=", "new", "SchedulerConstraint", "(", "\"", "<STR_LIT>", "\"", ")", ";", "constraint", ".", "setDelayInMs", "(", "delay", ")", ";", "constraint", ".", "setNetworkStatus", "(", "networkStatus", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "private", "void", "cancelSafely", "(", "JobHolder", "jobHolder", ",", "@", "CancelReason", "int", "cancelReason", ")", "{", "try", "{", "jobHolder", ".", "onCancel", "(", "cancelReason", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "JqLog", ".", "e", "(", "t", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "callbackManager", ".", "notifyOnCancel", "(", "jobHolder", ".", "getJob", "(", ")", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getThreadPriority", "(", ")", "{", "return", "threadPriority", ";", "}", "</s>"]
["<s>", "public", "Builder", "setThreadPriority", "(", "int", "threadPriority", ")", "{", "configuration", ".", "threadPriority", "=", "threadPriority", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "boolean", "batchSchedulerRequests", "(", ")", "{", "return", "batchSchedulerRequests", ";", "}", "</s>"]
["<s>", "public", "Builder", "scheduler", "(", "Scheduler", "scheduler", ",", "boolean", "batch", ")", "{", "configuration", ".", "scheduler", "=", "scheduler", ";", "configuration", ".", "batchSchedulerRequests", "=", "batch", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "static", "SharedPreferences", "getPreferences", "(", "Context", "context", ")", "{", "synchronized", "(", "GcmScheduler", ".", "class", ")", "{", "if", "(", "preferences", "=", "=", "null", ")", "{", "preferences", "=", "context", ".", "getSharedPreferences", "(", "\"", "<STR_LIT>", "\"", ",", "Context", ".", "MODE_PRIVATE", ")", ";", "}", "return", "preferences", ";", "}", "}", "</s>"]
["<s>", "@", "SuppressLint", "(", "\"", "<STR_LIT>", "\"", ")", "public", "int", "createId", "(", ")", "{", "synchronized", "(", "GcmScheduler", ".", "class", ")", "{", "final", "SharedPreferences", "preferences", "=", "getPreferences", "(", "getApplicationContext", "(", ")", ")", ";", "final", "int", "id", "=", "preferences", ".", "getInt", "(", "KEY_ID", ",", "0", ")", "+", "1", ";", "preferences", ".", "edit", "(", ")", ".", "putInt", "(", "KEY_ID", ",", "id", ")", ".", "commit", "(", ")", ";", "return", "id", ";", "}", "}", "</s>"]
["<s>", "public", "long", "getExecutionWindowSizeInSeconds", "(", ")", "{", "return", "TimeUnit", ".", "MILLISECONDS", ".", "toSeconds", "(", "BatchingScheduler", ".", "DEFAULT_BATCHING_PERIOD_IN_MS", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "toNetworkState", "(", "@", "NetworkUtil", ".", "NetworkStatus", "int", "networkStatus", ")", "{", "switch", "(", "networkStatus", ")", "{", "case", "NetworkUtil", ".", "DISCONNECTED", ":", "return", "Task", ".", "NETWORK_STATE_ANY", ";", "case", "NetworkUtil", ".", "METERED", ":", "return", "Task", ".", "NETWORK_STATE_CONNECTED", ";", "case", "NetworkUtil", ".", "UNMETERED", ":", "return", "Task", ".", "NETWORK_STATE_UNMETERED", ";", "}", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ",", "networkStatus", ")", ";", "return", "Task", ".", "NETWORK_STATE_CONNECTED", ";", "}", "</s>"]
["<s>", "private", "static", "Bundle", "toBundle", "(", "SchedulerConstraint", "constraint", ")", "{", "Bundle", "bundle", "=", "new", "Bundle", "(", ")", ";", "bundle", ".", "putString", "(", "KEY_UUID", ",", "constraint", ".", "getUuid", "(", ")", ")", ";", "bundle", ".", "putInt", "(", "KEY_NETWORK_STATUS", ",", "constraint", ".", "getNetworkStatus", "(", ")", ")", ";", "bundle", ".", "putLong", "(", "KEY_DELAY", ",", "constraint", ".", "getDelayInMs", "(", ")", ")", ";", "return", "bundle", ";", "}", "</s>"]
["<s>", "private", "static", "SchedulerConstraint", "fromBundle", "(", "Bundle", "bundle", ")", "{", "SchedulerConstraint", "constraint", "=", "new", "SchedulerConstraint", "(", "bundle", ".", "getString", "(", "KEY_UUID", ")", ")", ";", "if", "(", "constraint", ".", "getUuid", "(", ")", "=", "=", "null", ")", "{", "constraint", ".", "setUuid", "(", "UUID", ".", "randomUUID", "(", ")", ".", "toString", "(", ")", ")", ";", "}", "constraint", ".", "setNetworkStatus", "(", "bundle", ".", "getInt", "(", "KEY_NETWORK_STATUS", ",", "NetworkUtil", ".", "DISCONNECTED", ")", ")", ";", "constraint", ".", "setDelayInMs", "(", "bundle", ".", "getLong", "(", "KEY_DELAY", ",", "0", ")", ")", ";", "return", "constraint", ";", "}", "</s>"]
["<s>", "public", "int", "onStartJob", "(", "TaskParams", "taskParams", ")", "{", "SchedulerConstraint", "constraint", "=", "fromBundle", "(", "taskParams", ".", "getExtras", "(", ")", ")", ";", "if", "(", "JqLog", ".", "isDebugEnabled", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", ",", "constraint", ")", ";", "}", "ResultCallback", "callback", "=", "new", "ResultCallback", "(", ")", ";", "constraint", ".", "setData", "(", "callback", ")", ";", "start", "(", "constraint", ")", ";", "return", "callback", ".", "get", "(", ")", "?", "GcmNetworkManager", ".", "RESULT_RESCHEDULE", ":", "GcmNetworkManager", ".", "RESULT_SUCCESS", ";", "}", "</s>"]
["<s>", "public", "boolean", "get", "(", ")", "{", "try", "{", "latch", ".", "await", "(", "<NUM_LIT:10>", "*", "<NUM_LIT>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "JqLog", ".", "e", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "reschedule", ";", "}", "</s>"]
["<s>", "public", "void", "onDone", "(", "boolean", "reschedule", ")", "{", "this", ".", "reschedule", "=", "reschedule", ";", "latch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "FrameworkScheduler", "createSchedulerFor", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Context", "appContext", ",", "Class", "<", "?", "extends", "FrameworkJobSchedulerService", ">", "klass", ")", "{", "if", "(", "FrameworkJobSchedulerService", ".", "class", "=", "=", "klass", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "synchronized", "(", "schedulerMap", ")", "{", "if", "(", "schedulerMap", ".", "get", "(", "klass", ")", "!", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "klass", ".", "getCanonicalName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "FrameworkScheduler", "scheduler", "=", "new", "FrameworkScheduler", "(", "klass", ")", ";", "schedulerMap", ".", "put", "(", "klass", ",", "scheduler", ")", ";", "return", "scheduler", ";", "}", "}", "</s>"]
["<s>", "public", "static", "GcmScheduler", "createSchedulerFor", "(", "Context", "appContext", ",", "Class", "<", "?", "extends", "GcmJobSchedulerService", ">", "klass", ")", "{", "if", "(", "GcmJobSchedulerService", ".", "class", "=", "=", "klass", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "synchronized", "(", "schedulerMap", ")", "{", "if", "(", "schedulerMap", ".", "get", "(", "klass", ")", "!", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "klass", ".", "getCanonicalName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "GcmScheduler", "scheduler", "=", "new", "GcmScheduler", "(", "appContext", ".", "getApplicationContext", "(", ")", ",", "klass", ")", ";", "schedulerMap", ".", "put", "(", "klass", ",", "scheduler", ")", ";", "return", "scheduler", ";", "}", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "<NUM_LIT>", ")", "private", "void", "listeNetworkViaConnectivityManager", "(", "final", "Context", "context", ")", "{", "ConnectivityManager", "cm", "=", "(", "ConnectivityManager", ")", "context", ".", "getApplicationContext", "(", ")", ".", "getSystemService", "(", "Context", ".", "CONNECTIVITY_SERVICE", ")", ";", "NetworkRequest", "request", "=", "new", "NetworkRequest", ".", "Builder", "(", ")", ".", "addCapability", "(", "NetworkCapabilities", ".", "NET_CAPABILITY_INTERNET", ")", ".", "addCapability", "(", "NetworkCapabilities", ".", "NET_CAPABILITY_NOT_RESTRICTED", ")", ".", "build", "(", ")", ";", "cm", ".", "registerNetworkCallback", "(", "request", ",", "new", "ConnectivityManager", ".", "NetworkCallback", "(", ")", "{", "@", "Override", "public", "void", "onAvailable", "(", "Network", "network", ")", "{", "dispatchNetworkChange", "(", "context", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "TargetApi", "(", "<NUM_LIT>", ")", "private", "void", "listenForIdle", "(", "Context", "context", ")", "{", "context", ".", "getApplicationContext", "(", ")", ".", "registerReceiver", "(", "new", "BroadcastReceiver", "(", ")", "{", "@", "Override", "public", "void", "onReceive", "(", "Context", "context", ",", "Intent", "intent", ")", "{", "dispatchNetworkChange", "(", "context", ")", ";", "}", "}", ",", "new", "IntentFilter", "(", "PowerManager", ".", "ACTION_DEVICE_IDLE_MODE_CHANGED", ")", ")", ";", "}", "</s>"]
["<s>", "void", "dispatchNetworkChange", "(", "Context", "context", ")", "{", "if", "(", "listener", "=", "=", "null", ")", "{", "return", ";", "}", "listener", ".", "onNetworkChange", "(", "getNetworkStatus", "(", "context", ")", ")", ";", "}", "</s>"]
["<s>", "public", "SQLiteStatement", "getDeleteJobTagsStatement", "(", ")", "{", "if", "(", "deleteJobTagsStatement", "=", "=", "null", ")", "{", "deleteJobTagsStatement", "=", "db", ".", "compileStatement", "(", "\"", "<STR_LIT>", "\"", "+", "tagsTableName", "+", "\"", "<STR_LIT>", "\"", "+", "DbOpenHelper", ".", "TAGS_JOB_ID_COLUMN", ".", "columnName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "deleteJobTagsStatement", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "public", "SQLiteDatabase", "getDb", "(", ")", "{", "return", "db", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testClearTags", "(", ")", "throws", "Throwable", "{", "SqliteJobQueue", "queue", "=", "(", "SqliteJobQueue", ")", "createNewJobQueue", "(", ")", ";", "JobHolder", "vh1", "=", "createNewJobHolder", "(", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "JobHolder", "vh2", "=", "createNewJobHolder", "(", "new", "Params", "(", "1", ")", ".", "addTags", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "queue", ".", "insert", "(", "vh1", ")", ";", "queue", ".", "insert", "(", "vh2", ")", ";", "assertTags", "(", "queue", ",", "new", "TagInfo", "(", "0", ",", "vh1", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh1", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh1", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh2", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh2", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh2", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "queue", ".", "remove", "(", "vh2", ")", ";", "assertTags", "(", "queue", ",", "new", "TagInfo", "(", "0", ",", "vh1", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh1", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ",", "new", "TagInfo", "(", "0", ",", "vh1", ".", "getId", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertTags", "(", "SqliteJobQueue", "queue", ",", "TagInfo", ".", ".", ".", "expected", ")", "{", "List", "<", "TagInfo", ">", "tags", "=", "loadAllTags", "(", "queue", ")", ";", "assertThat", "(", "tags", ",", "hasItems", "(", "expected", ")", ")", ";", "assertThat", "(", "tags", ".", "size", "(", ")", ",", "is", "(", "expected", ".", "length", ")", ")", ";", "}", "</s>"]
["<s>", "private", "List", "<", "TagInfo", ">", "loadAllTags", "(", "SqliteJobQueue", "queue", ")", "{", "Cursor", "cursor", "=", "queue", ".", "getDb", "(", ")", ".", "rawQuery", "(", "\"", "<STR_LIT>", "\"", ",", "new", "String", "[", "0", "]", ")", ";", "List", "<", "TagInfo", ">", "result", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "while", "(", "cursor", ".", "moveToNext", "(", ")", ")", "{", "result", ".", "add", "(", "new", "TagInfo", "(", "cursor", ".", "getInt", "(", "cursor", ".", "getColumnIndex", "(", "\"", "<STR_LIT>", "\"", ")", ")", ",", "cursor", ".", "getString", "(", "cursor", ".", "getColumnIndex", "(", "\"", "<STR_LIT>", "\"", ")", ")", ",", "cursor", ".", "getString", "(", "cursor", ".", "getColumnIndex", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "void", "v", "(", "String", "text", ",", "Object", ".", ".", ".", "args", ")", "{", "customLogger", ".", "v", "(", "text", ",", "args", ")", ";", "}", "</s>"]
["<s>", "void", "setThrowable", "(", "@", "Nullable", "Throwable", "throwable", ")", "{", "this", ".", "throwable", "=", "throwable", ";", "}", "</s>"]
["<s>", "@", "Nullable", "Throwable", "getThrowable", "(", ")", "{", "return", "throwable", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "Throwable", "getThrowable", "(", ")", "{", "return", "throwable", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "ThreadFactory", "getThreadFactory", "(", ")", "{", "return", "threadFactory", ";", "}", "</s>"]
["<s>", "@", "NonNull", "public", "Builder", "threadFactory", "(", "@", "Nullable", "final", "ThreadFactory", "threadFactory", ")", "{", "configuration", ".", "threadFactory", "=", "threadFactory", ";", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testThreadFactory", "(", ")", "throws", "Throwable", "{", "final", "JobManager", "jobManager", "=", "createJobManager", "(", "new", "Configuration", ".", "Builder", "(", "RuntimeEnvironment", ".", "application", ")", ".", "timer", "(", "mockTimer", ")", ".", "threadFactory", "(", "new", "ThreadFactory", "(", ")", "{", "@", "Override", "public", "Thread", "newThread", "(", "@", "NonNull", "Runnable", "r", ")", "{", "return", "new", "DummyThread", "(", "r", ")", ";", "}", "}", ")", ")", ";", "final", "Job", "job", "=", "new", "CheckWorkerJob", "(", ")", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "job", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "if", "(", "error", "!", "=", "null", ")", "{", "throw", "error", ";", "}", "}", "</s>"]
["<s>", "@", "Nullable", "public", "Scheduler", "getScheduler", "(", ")", "{", "return", "scheduler", ";", "}", "</s>"]
["<s>", "private", "void", "assertNotInJobManagerThread", "(", "String", "message", ")", "{", "if", "(", "Thread", ".", "currentThread", "(", ")", "=", "=", "chefThread", ")", "{", "throw", "new", "WrongThreadException", "(", "message", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetActiveConsumerCount", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "getActiveConsumerCount", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAddJob", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelJobs", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "cancelJobs", "(", "TagConstraint", ".", "ANY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCount", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "count", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCountReady", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "countReadyJobs", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testJobStatus", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "getJobStatus", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testClear", "(", ")", "throws", "InterruptedException", "{", "assertFailure", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "clear", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "private", "void", "assertFailure", "(", "final", "Runnable", "runnable", ")", "throws", "InterruptedException", "{", "final", "Throwable", "[", "]", "throwable", "=", "new", "Throwable", "[", "1", "]", ";", "jobManager", "=", "createJobManager", "(", ")", ";", "final", "DummyJob", "dummyJob", "=", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ")", "{", "@", "Override", "public", "void", "onAdded", "(", ")", "{", "super", ".", "onAdded", "(", ")", ";", "try", "{", "runnable", ".", "run", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "throwable", "[", "0", "]", "=", "t", ";", "}", "}", "}", ";", "waitUntilAJobIsDone", "(", "jobManager", ",", "new", "WaitUntilCallback", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "jobManager", ".", "addJob", "(", "dummyJob", ")", ";", "}", "@", "Override", "public", "void", "assertJob", "(", "Job", "job", ")", "{", "}", "}", ")", ";", "assertThat", "(", "throwable", "[", "0", "]", "instanceof", "WrongThreadException", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "public", "Thread", "getJobManagerExecutionThread", "(", ")", "{", "return", "chefThread", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test", "(", ")", "throws", "InterruptedException", "{", "final", "Throwable", "[", "]", "throwable", "=", "new", "Throwable", "[", "1", "]", ";", "JobManager", "jobManager", "=", "createJobManager", "(", ")", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "jobManager", ".", "getJobManagerExecutionThread", "(", ")", ".", "setUncaughtExceptionHandler", "(", "new", "Thread", ".", "UncaughtExceptionHandler", "(", ")", "{", "@", "Override", "public", "void", "uncaughtException", "(", "Thread", "thread", ",", "Throwable", "ex", ")", "{", "throwable", "[", "0", "]", "=", "ex", ";", "latch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "jobManager", ".", "addJobInBackground", "(", "new", "DummyJob", "(", "new", "Params", "(", "0", ")", ".", "persist", "(", ")", ")", "{", "ICannotBeSerialized", "iCannotBeSerialized", "=", "new", "ICannotBeSerialized", "(", ")", ";", "}", ")", ";", "MatcherAssert", ".", "assertThat", "(", "latch", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "throwable", "[", "0", "]", "instanceof", "RuntimeException", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "MatcherAssert", ".", "assertThat", "(", "throwable", "[", "0", "]", ".", "getCause", "(", ")", "instanceof", "IOException", ",", "CoreMatchers", ".", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "void", "delete", "(", "String", "id", ")", "{", "final", "File", "file", "=", "toFile", "(", "id", ")", ";", "if", "(", "file", ".", "exists", "(", ")", ")", "{", "file", ".", "delete", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Nullable", "byte", "[", "]", "load", "(", "String", "id", ")", "throws", "IOException", "{", "final", "File", "file", "=", "toFile", "(", "id", ")", ";", "if", "(", "file", ".", "exists", "(", ")", "&", "&", "file", ".", "canRead", "(", ")", ")", "{", "BufferedSource", "source", "=", "Okio", ".", "buffer", "(", "Okio", ".", "source", "(", "file", ")", ")", ";", "try", "{", "return", "source", ".", "readByteArray", "(", ")", ";", "}", "finally", "{", "closeQuitely", "(", "source", ")", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "void", "save", "(", "String", "id", ",", "byte", "[", "]", "data", ")", "throws", "IOException", "{", "final", "File", "file", "=", "toFile", "(", "id", ")", ";", "BufferedSink", "sink", "=", "Okio", ".", "buffer", "(", "Okio", ".", "sink", "(", "file", ")", ")", ";", "try", "{", "sink", ".", "write", "(", "data", ")", ".", "flush", "(", ")", ";", "}", "finally", "{", "closeQuitely", "(", "sink", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "String", "filename", "(", "String", "id", ")", "{", "return", "id", "+", "EXT", ";", "}", "</s>"]
["<s>", "private", "File", "toFile", "(", "String", "id", ")", "{", "return", "new", "File", "(", "folder", ",", "filename", "(", "id", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "private", "static", "String", "filenameToId", "(", "String", "filename", ")", "{", "if", "(", "filename", ".", "length", "(", ")", "<", "EXT", ".", "length", "(", ")", "+", "1", ")", "{", "return", "null", ";", "}", "return", "filename", ".", "substring", "(", "0", ",", "filename", ".", "length", "(", ")", "-", "EXT", ".", "length", "(", ")", ")", ";", "}", "</s>"]
["<s>", "void", "truncateExcept", "(", "Set", "<", "String", ">", "ids", ")", "{", "for", "(", "String", "filename", ":", "folder", ".", "list", "(", ")", ")", "{", "if", "(", "!", "filename", ".", "endsWith", "(", "EXT", ")", ")", "{", "continue", ";", "}", "String", "id", "=", "filenameToId", "(", "filename", ")", ";", "if", "(", "!", "ids", ".", "contains", "(", "id", ")", ")", "{", "File", "file", "=", "new", "File", "(", "folder", ",", "filename", ")", ";", "if", "(", "!", "file", ".", "delete", "(", ")", ")", "{", "JqLog", ".", "d", "(", "\"", "<STR_LIT>", "\"", "+", "file", ".", "getAbsolutePath", "(", ")", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "static", "void", "closeQuitely", "(", "Closeable", "closeable", ")", "{", "try", "{", "closeable", ".", "close", "(", ")", ";", "}", "catch", "(", "IOException", "ignored", ")", "{", "}", "}", "</s>"]
["<s>", "private", "void", "cleanupFiles", "(", ")", "{", "Cursor", "cursor", "=", "db", ".", "rawQuery", "(", "sqlHelper", ".", "LOAD_ALL_IDS_QUERY", ",", "null", ")", ";", "Set", "<", "String", ">", "jobIds", "=", "new", "HashSet", "<", ">", "(", ")", ";", "try", "{", "while", "(", "cursor", ".", "moveToNext", "(", ")", ")", "{", "jobIds", ".", "add", "(", "cursor", ".", "getString", "(", "0", ")", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "jobStorage", ".", "truncateExcept", "(", "jobIds", ")", ";", "}", "</s>"]
["<s>", "private", "void", "persistJobToDisk", "(", "@", "NonNull", "JobHolder", "jobHolder", ")", "{", "try", "{", "jobStorage", ".", "save", "(", "jobHolder", ".", "getId", "(", ")", ",", "jobSerializer", ".", "serialize", "(", "jobHolder", ".", "getJob", "(", ")", ")", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "final", "void", "updateFromJobHolder", "(", "JobHolder", "holder", ")", "{", "if", "(", "sealed", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "id", "=", "holder", ".", "id", ";", "groupId", "=", "holder", ".", "groupId", ";", "priority", "=", "holder", ".", "getPriority", "(", ")", ";", "this", ".", "persistent", "=", "holder", ".", "persistent", ";", "readonlyTags", "=", "holder", ".", "tags", ";", "requiresNetworkUntilNs", "=", "holder", ".", "getRequiresNetworkUntilNs", "(", ")", ";", "requiresUnmeteredNetworkUntilNs", "=", "holder", ".", "getRequiresUnmeteredNetworkUntilNs", "(", ")", ";", "sealed", "=", "true", ";", "}", "</s>"]
["<s>", "public", "final", "String", "getSingleInstanceId", "(", ")", "{", "if", "(", "tags", "!", "=", "null", ")", "{", "for", "(", "String", "tag", ":", "tags", ")", "{", "if", "(", "tag", ".", "startsWith", "(", "Job", ".", "SINGLE_ID_TAG_PREFIX", ")", ")", "{", "return", "tag", ";", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "void", "clearRetryConstraint", "(", ")", "{", "retryConstraint", "=", "null", ";", "}", "</s>"]
["<s>", "public", "Builder", "tags", "(", "Set", "<", "String", ">", "tags", ")", "{", "this", ".", "tags", "=", "tags", ";", "providedFlags", "|", "=", "FLAG_TAGS", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "persistent", "(", "boolean", "persistent", ")", "{", "this", ".", "persistent", "=", "persistent", ";", "providedFlags", "|", "=", "FLAG_PERSISTENT", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "id", "(", "String", "id", ")", "{", "this", ".", "id", "=", "id", ";", "providedFlags", "|", "=", "FLAG_ID", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "requiresNetworkUntilNs", "(", "long", "requiresNetworkUntilNs", ")", "{", "this", ".", "requiresNetworkUntilNs", "=", "requiresNetworkUntilNs", ";", "providedFlags", "|", "=", "FLAG_REQ_NETWORK_UNTIL", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "requiresUnmeteredNetworkUntil", "(", "long", "requiresUnmeteredNetworkUntilNs", ")", "{", "this", ".", "requiresUnmeteredNetworkUntilNs", "=", "requiresUnmeteredNetworkUntilNs", ";", "providedFlags", "|", "=", "FLAG_REQ_UNMETERED_NETWORK_UNTIL", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "Set", "<", "String", ">", "loadTags", "(", "String", "jobId", ")", "{", "Cursor", "cursor", "=", "db", ".", "rawQuery", "(", "sqlHelper", ".", "LOAD_TAGS_QUERY", ",", "new", "String", "[", "]", "{", "jobId", "}", ")", ";", "if", "(", "cursor", ".", "getCount", "(", ")", "=", "=", "0", ")", "{", "return", "Collections", ".", "EMPTY_SET", ";", "}", "final", "Set", "<", "String", ">", "tags", "=", "new", "HashSet", "<", ">", "(", ")", ";", "try", "{", "while", "(", "cursor", ".", "moveToNext", "(", ")", ")", "{", "tags", ".", "add", "(", "cursor", ".", "getString", "(", "0", ")", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "return", "tags", ";", "}", "</s>"]
["<s>", "public", "static", "JobHolder", "createNewJobHolder", "(", "Params", "params", ",", "Timer", "timer", ")", "{", "long", "delay", "=", "getDelayMsField", "(", "params", ")", ".", "get", "(", ")", ";", "DummyJob", "job", "=", "new", "DummyJob", "(", "params", ")", ";", "return", "new", "JobHolder", ".", "Builder", "(", ")", ".", "priority", "(", "getPriorityField", "(", "params", ")", ".", "get", "(", ")", ")", ".", "groupId", "(", "getGroupIdField", "(", "params", ")", ".", "get", "(", ")", ")", ".", "job", "(", "job", ")", ".", "id", "(", "job", ".", "getId", "(", ")", ")", ".", "persistent", "(", "params", ".", "isPersistent", "(", ")", ")", ".", "tags", "(", "job", ".", "getTags", "(", ")", ")", ".", "createdNs", "(", "timer", ".", "nanoTime", "(", ")", ")", ".", "delayUntilNs", "(", "delay", ">", "0", "?", "timer", ".", "nanoTime", "(", ")", "+", "delay", "*", "JobManager", ".", "NS_PER_MS", ":", "JobManager", ".", "NOT_DELAYED_JOB_DELAY", ")", ".", "sealTimes", "(", "timer", ",", "params", ".", "getRequiresNetworkTimeoutMs", "(", ")", ",", "params", ".", "getRequiresUnmeteredNetworkTimeoutMs", "(", ")", ")", ".", "runningSessionId", "(", "JobManager", ".", "NOT_RUNNING_SESSION_ID", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "public", "boolean", "waitUntilAllMessagesAreConsumed", "(", "int", "seconds", ")", "{", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "CommandMessage", "poke", "=", "factory", ".", "obtain", "(", "CommandMessage", ".", "class", ")", ";", "poke", ".", "set", "(", "CommandMessage", ".", "RUNNABLE", ")", ";", "poke", ".", "setRunnable", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "latch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "messageQueue", ".", "post", "(", "poke", ")", ";", "try", "{", "return", "latch", ".", "await", "(", "seconds", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "return", "false", ";", "}", "}", "</s>"]
["<s>", "public", "Runnable", "getRunnable", "(", ")", "{", "return", "runnable", ";", "}", "</s>"]
["<s>", "public", "void", "setRunnable", "(", "Runnable", "runnable", ")", "{", "this", ".", "runnable", "=", "runnable", ";", "}", "</s>"]
["<s>", "public", "static", "ConsumerManager", "getConsumerManager", "(", "JobManager", "jobManager", ")", "{", "return", "jobManager", ".", "jobManagerThread", ".", "consumerManager", ";", "}", "</s>"]
["<s>", "public", "static", "CallbackManager", "getCallbackManager", "(", "JobManager", "jobManager", ")", "{", "return", "jobManager", ".", "jobManagerThread", ".", "callbackManager", ";", "}", "</s>"]
["<s>", "private", "boolean", "covers", "(", "ConstraintWrapper", "existing", ",", "SchedulerConstraint", "constraint", ",", "long", "expectedRunTime", ",", "Long", "expectedDeadline", ")", "{", "if", "(", "existing", ".", "constraint", ".", "getNetworkStatus", "(", ")", "!", "=", "constraint", ".", "getNetworkStatus", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "expectedDeadline", "!", "=", "null", ")", "{", "if", "(", "existing", ".", "deadlineNs", "=", "=", "null", ")", "{", "return", "false", ";", "}", "long", "timeDiff", "=", "existing", ".", "deadlineNs", "-", "expectedDeadline", ";", "if", "(", "timeDiff", "<", "1", "|", "|", "timeDiff", ">", "batchingDurationInNs", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "existing", ".", "deadlineNs", "!", "=", "null", ")", "{", "return", "false", ";", "}", "long", "timeDiff", "=", "existing", ".", "delayUntilNs", "-", "expectedRunTime", ";", "return", "timeDiff", ">", "0", "&", "&", "timeDiff", "<", "=", "batchingDurationInNs", ";", "}", "</s>"]
["<s>", "public", "int", "getMaxNetworkType", "(", ")", "{", "return", "maxNetworkType", ";", "}", "</s>"]
["<s>", "void", "setMaxNetworkType", "(", "int", "maxNetworkType", ")", "{", "this", ".", "maxNetworkType", "=", "maxNetworkType", ";", "}", "</s>"]
["<s>", "void", "setDeadlineReached", "(", "boolean", "deadlineReached", ")", "{", "isDeadlineReached", "=", "deadlineReached", ";", "}", "</s>"]
["<s>", "public", "boolean", "isDeadlineReached", "(", ")", "{", "return", "isDeadlineReached", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "final", "boolean", "requiresNetwork", "(", ")", "{", "return", "requiredNetworkType", ">", "=", "NetworkUtil", ".", "METERED", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "final", "boolean", "requiresUnmeteredNetwork", "(", ")", "{", "return", "requiredNetworkType", ">", "=", "NetworkUtil", ".", "UNMETERED", ";", "}", "</s>"]
["<s>", "long", "getDeadlineInMs", "(", ")", "{", "return", "deadlineInMs", ";", "}", "</s>"]
["<s>", "boolean", "shouldCancelOnDeadline", "(", ")", "{", "return", "cancelOnDeadline", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldCancelOnDeadline", "(", ")", "{", "return", "cancelOnDeadline", ";", "}", "</s>"]
["<s>", "public", "void", "setDeadlineIsReached", "(", "boolean", "didReachDeadline", ")", "{", "this", ".", "job", ".", "setDeadlineReached", "(", "didReachDeadline", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasDeadline", "(", ")", "{", "return", "deadlineNs", "!", "=", "Params", ".", "FOREVER", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasDelay", "(", ")", "{", "return", "delayUntilNs", "!", "=", "JobManager", ".", "NOT_DELAYED_JOB_DELAY", ";", "}", "</s>"]
["<s>", "@", "NetworkUtil", ".", "NetworkStatus", "public", "int", "getRequiredNetworkType", "(", ")", "{", "return", "requiredNetworkType", ";", "}", "</s>"]
["<s>", "public", "Builder", "deadline", "(", "long", "deadlineNs", ",", "boolean", "cancelOnDeadline", ")", "{", "this", ".", "deadlineNs", "=", "deadlineNs", ";", "this", ".", "cancelOnDeadline", "=", "cancelOnDeadline", ";", "providedFlags", "|", "=", "FLAG_DEADLINE", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "overrideDeadlineToRunInMs", "(", "long", "deadlineInMs", ")", "{", "if", "(", "Boolean", ".", "TRUE", ".", "equals", "(", "cancelOnDeadline", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "deadlineMs", "=", "deadlineInMs", ";", "cancelOnDeadline", "=", "false", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Params", "overrideDeadlineToCancelInMs", "(", "long", "deadlineInMs", ")", "{", "if", "(", "Boolean", ".", "FALSE", ".", "equals", "(", "cancelOnDeadline", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "deadlineMs", "=", "deadlineInMs", ";", "cancelOnDeadline", "=", "true", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "long", "getDeadlineMs", "(", ")", "{", "return", "deadlineMs", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Nullable", "public", "Boolean", "getCancelOnDeadline", "(", ")", "{", "return", "cancelOnDeadline", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldCancelOnDeadline", "(", ")", "{", "return", "Boolean", ".", "TRUE", ".", "equals", "(", "cancelOnDeadline", ")", ";", "}", "</s>"]
