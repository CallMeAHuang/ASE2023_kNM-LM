["<s>", "private", "FieldSpec", "initializeBuilder", "(", "EntityDescriptor", "entity", ",", "TypeName", "name", ",", "String", "fieldName", ")", "{", "FieldSpec", ".", "Builder", "builder", "=", "FieldSpec", ".", "builder", "(", "name", ",", "fieldName", ",", "Modifier", ".", "PROTECTED", ")", ";", "if", "(", "entity", ".", "builderFactoryMethod", "(", ")", ".", "isPresent", "(", ")", ")", "{", "TypeName", "baseName", "=", "TypeName", ".", "get", "(", "entity", ".", "element", "(", ")", ".", "asType", "(", ")", ")", ";", "builder", ".", "initializer", "(", "\"", "<STR_LIT>", "\"", ",", "baseName", ",", "entity", ".", "builderFactoryMethod", "(", ")", ".", "map", "(", "method", "-", ">", "method", ".", "getSimpleName", "(", ")", ".", "toString", "(", ")", ")", ".", "orElse", "(", "\"", "\"", ")", ")", ";", "}", "else", "{", "builder", ".", "initializer", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "generateProperties", "(", "AttributeDescriptor", "attribute", ",", "AttributeDescriptor", "parent", ",", "TypeMirror", "typeMirror", ",", "TypeName", "targetName", ",", "TypeName", "attributeName", ",", "CodeBlock", ".", "Builder", "block", ")", "{", "String", "prefix", "=", "\"", "\"", ";", "if", "(", "parent", "!", "=", "null", ")", "{", "prefix", "=", "parent", ".", "getterName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "}", "Class", "propertyClass", "=", "propertyClassFor", "(", "typeMirror", ")", ";", "ParameterizedTypeName", "propertyType", "=", "propertyName", "(", "propertyClass", ",", "targetName", ",", "attributeName", ")", ";", "TypeSpec", ".", "Builder", "builder", "=", "TypeSpec", ".", "anonymousClassBuilder", "(", "\"", "\"", ")", ".", "addSuperinterface", "(", "propertyType", ")", ";", "boolean", "isNullable", "=", "typeMirror", ".", "getKind", "(", ")", ".", "isPrimitive", "(", ")", "&", "&", "attribute", ".", "isNullable", "(", ")", ";", "boolean", "useGetter", "=", "entity", ".", "isUnimplementable", "(", ")", "|", "|", "entity", ".", "isImmutable", "(", ")", ";", "boolean", "useSetter", "=", "entity", ".", "isUnimplementable", "(", ")", ";", "String", "getName", "=", "prefix", "+", "(", "useGetter", "?", "attribute", ".", "getterName", "(", ")", ":", "attribute", ".", "fieldName", "(", ")", ")", ";", "String", "setName", "=", "prefix", "+", "(", "useSetter", "?", "attribute", ".", "setterName", "(", ")", ":", "attribute", ".", "fieldName", "(", ")", ")", ";", "new", "GeneratedProperty", "(", "getName", ",", "setName", ",", "targetName", ",", "attributeName", ")", ".", "setNullable", "(", "isNullable", ")", ".", "setReadOnly", "(", "entity", ".", "isImmutable", "(", ")", ")", ".", "setUseMethod", "(", "useGetter", ")", ".", "build", "(", "builder", ")", ";", "if", "(", "propertyClass", "!", "=", "Property", ".", "class", ")", "{", "TypeName", "primitiveType", "=", "TypeName", ".", "get", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "String", "name", "=", "Names", ".", "upperCaseFirst", "(", "attribute", ".", "typeMirror", "(", ")", ".", "toString", "(", ")", ")", ";", "new", "GeneratedProperty", "(", "getName", ",", "setName", ",", "targetName", ",", "primitiveType", ")", ".", "setMethodSuffix", "(", "name", ")", ".", "setReadOnly", "(", "entity", ".", "isImmutable", "(", ")", ")", ".", "setUseMethod", "(", "useGetter", ")", ".", "build", "(", "builder", ")", ";", "}", "block", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "builder", ".", "build", "(", ")", ")", ";", "block", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "element", "(", ")", ".", "getSimpleName", "(", ")", ")", ";", "if", "(", "!", "entity", ".", "isStateless", "(", ")", ")", "{", "ClassName", "stateClass", "=", "ClassName", ".", "get", "(", "PropertyState", ".", "class", ")", ";", "TypeSpec", ".", "Builder", "stateType", "=", "TypeSpec", ".", "anonymousClassBuilder", "(", "\"", "\"", ")", ".", "addSuperinterface", "(", "parameterizedTypeName", "(", "Property", ".", "class", ",", "targetName", ",", "stateClass", ")", ")", ";", "String", "fieldName", "=", "prefix", "+", "propertyStateFieldName", "(", "attribute", ")", ";", "new", "GeneratedProperty", "(", "fieldName", ",", "targetName", ",", "stateClass", ")", ".", "build", "(", "stateType", ")", ";", "block", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "stateType", ".", "build", "(", ")", ")", ";", "}", "if", "(", "entity", ".", "isImmutable", "(", ")", ")", "{", "String", "propertyName", "=", "attribute", ".", "fieldName", "(", ")", ";", "TypeName", "builderName", "=", "typeName", ";", "useSetter", "=", "false", ";", "String", "parameterSuffix", "=", "null", ";", "Optional", "<", "TypeElement", ">", "builderType", "=", "entity", ".", "builderType", "(", ")", ";", "if", "(", "builderType", ".", "isPresent", "(", ")", ")", "{", "parameterSuffix", "=", "\"", "<STR_LIT>", "\"", ";", "if", "(", "parent", "!", "=", "null", ")", "{", "parameterSuffix", "=", "\"", "<STR_LIT:.>", "\"", "+", "parent", ".", "fieldName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "}", "propertyName", "=", "attribute", ".", "setterName", "(", ")", ";", "useSetter", "=", "true", ";", "for", "(", "ExecutableElement", "method", ":", "ElementFilter", ".", "methodsIn", "(", "builderType", ".", "get", "(", ")", ".", "getEnclosedElements", "(", ")", ")", ")", "{", "List", "<", "?", "extends", "VariableElement", ">", "parameters", "=", "method", ".", "getParameters", "(", ")", ";", "String", "name", "=", "Names", ".", "removeMethodPrefixes", "(", "method", ".", "getSimpleName", "(", ")", ")", ";", "if", "(", "(", "name", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "name", ".", "length", "(", ")", ">", "<NUM_LIT:4>", "&", "&", "Character", ".", "isUpperCase", "(", "name", ".", "charAt", "(", "<NUM_LIT:4>", ")", ")", ")", "|", "|", "name", ".", "equalsIgnoreCase", "(", "attribute", ".", "fieldName", "(", ")", ")", "&", "&", "parameters", ".", "size", "(", ")", "=", "=", "1", ")", "{", "propertyName", "=", "method", ".", "getSimpleName", "(", ")", ".", "toString", "(", ")", ";", "break", ";", "}", "}", "}", "propertyType", "=", "propertyName", "(", "propertyClass", ",", "builderName", ",", "attributeName", ")", ";", "TypeSpec", ".", "Builder", "builderProperty", "=", "TypeSpec", ".", "anonymousClassBuilder", "(", "\"", "\"", ")", ".", "addSuperinterface", "(", "propertyType", ")", ";", "new", "GeneratedProperty", "(", "propertyName", ",", "builderName", ",", "attributeName", ")", ".", "setWriteOnly", "(", "true", ")", ".", "setUseMethod", "(", "useSetter", ")", ".", "setAccessSuffix", "(", "parameterSuffix", ")", ".", "build", "(", "builderProperty", ")", ";", "if", "(", "propertyClass", "!", "=", "Property", ".", "class", ")", "{", "TypeName", "primitiveType", "=", "TypeName", ".", "get", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "String", "name", "=", "Names", ".", "upperCaseFirst", "(", "attribute", ".", "typeMirror", "(", ")", ".", "toString", "(", ")", ")", ";", "new", "GeneratedProperty", "(", "propertyName", ",", "builderName", ",", "primitiveType", ")", ".", "setMethodSuffix", "(", "name", ")", ".", "setAccessSuffix", "(", "parameterSuffix", ")", ".", "setUseMethod", "(", "useSetter", ")", ".", "setWriteOnly", "(", "true", ")", ".", "build", "(", "builderProperty", ")", ";", "}", "block", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "builderProperty", ".", "build", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "GeneratedProperty", "setAccessSuffix", "(", "String", "suffix", ")", "{", "this", ".", "accessSuffix", "=", "suffix", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "builder", "(", ")", "{", "return", "new", "AutoValue_Address", ".", "Builder", "(", ")", ".", "setId", "(", "-", "1", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "builder", "(", ")", "{", "return", "new", "AutoValue_Coordinate", ".", "Builder", "(", ")", ";", "}", "</s>"]
["<s>", "private", "FieldSpec", "generateAttribute", "(", "AttributeDescriptor", "attribute", ",", "AttributeDescriptor", "parent", ",", "TypeName", "targetName", ",", "String", "fieldName", ",", "TypeMirror", "mirror", ",", "boolean", "expression", ")", "{", "TypeMirror", "typeMirror", "=", "mirror", ";", "TypeName", "typeName", ";", "if", "(", "attribute", ".", "isIterable", "(", ")", ")", "{", "typeMirror", "=", "tryFirstTypeArgument", "(", "typeMirror", ")", ";", "typeName", "=", "parameterizedCollectionName", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "}", "else", "if", "(", "attribute", ".", "isOptional", "(", ")", ")", "{", "typeMirror", "=", "tryFirstTypeArgument", "(", "typeMirror", ")", ";", "typeName", "=", "TypeName", ".", "get", "(", "typeMirror", ")", ";", "}", "else", "{", "typeName", "=", "nameResolver", ".", "generatedTypeNameOf", "(", "typeMirror", ")", ".", "orElse", "(", "null", ")", ";", "}", "if", "(", "typeName", "=", "=", "null", ")", "{", "typeName", "=", "boxedTypeName", "(", "typeMirror", ")", ";", "}", "ParameterizedTypeName", "type", ";", "ClassName", "attributeType", "=", "null", ";", "boolean", "useKotlinDelegate", "=", "false", ";", "if", "(", "expression", ")", "{", "type", "=", "parameterizedTypeName", "(", "QueryExpression", ".", "class", ",", "typeName", ")", ";", "}", "else", "{", "boolean", "isQueryable", "=", "attribute", ".", "cardinality", "(", ")", "=", "=", "null", "|", "|", "attribute", ".", "isForeignKey", "(", ")", ";", "Class", "<", "?", ">", "attributeClass", "=", "isQueryable", "?", "QueryAttribute", ".", "class", ":", "Attribute", ".", "class", ";", "attributeType", "=", "ClassName", ".", "get", "(", "attributeClass", ")", ";", "if", "(", "isQueryable", "&", "&", "SourceLanguage", ".", "of", "(", "entity", ".", "element", "(", ")", ")", "=", "=", "SourceLanguage", ".", "KOTLIN", ")", "{", "TypeElement", "delegateType", "=", "elements", ".", "getTypeElement", "(", "KOTLIN_ATTRIBUTE_DELEGATE", ")", ";", "if", "(", "delegateType", "!", "=", "null", ")", "{", "attributeType", "=", "ClassName", ".", "get", "(", "delegateType", ")", ";", "useKotlinDelegate", "=", "true", ";", "}", "}", "type", "=", "ParameterizedTypeName", ".", "get", "(", "attributeType", ",", "targetName", ",", "typeName", ")", ";", "}", "CodeBlock", ".", "Builder", "builder", "=", "CodeBlock", ".", "builder", "(", ")", ";", "if", "(", "attribute", ".", "isIterable", "(", ")", ")", "{", "typeMirror", "=", "tryFirstTypeArgument", "(", "typeMirror", ")", ";", "TypeName", "name", "=", "nameResolver", ".", "tryGeneratedTypeName", "(", "typeMirror", ")", ";", "TypeElement", "collection", "=", "(", "TypeElement", ")", "types", ".", "asElement", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "ParameterizedTypeName", "builderName", "=", "parameterizedTypeName", "(", "attribute", ".", "builderClass", "(", ")", ",", "targetName", ",", "typeName", ",", "name", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "builderName", ",", "attribute", ".", "name", "(", ")", ",", "ClassName", ".", "get", "(", "collection", ")", ",", "name", ")", ";", "}", "else", "if", "(", "attribute", ".", "isMap", "(", ")", "&", "&", "attribute", ".", "cardinality", "(", ")", "!", "=", "null", ")", "{", "List", "<", "TypeMirror", ">", "parameters", "=", "Mirrors", ".", "listGenericTypeArguments", "(", "typeMirror", ")", ";", "TypeName", "keyName", "=", "TypeName", ".", "get", "(", "parameters", ".", "get", "(", "0", ")", ")", ";", "typeMirror", "=", "parameters", ".", "get", "(", "1", ")", ";", "TypeName", "valueName", "=", "nameResolver", ".", "tryGeneratedTypeName", "(", "typeMirror", ")", ";", "TypeElement", "valueElement", "=", "(", "TypeElement", ")", "types", ".", "asElement", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "ParameterizedTypeName", "builderName", "=", "parameterizedTypeName", "(", "attribute", ".", "builderClass", "(", ")", ",", "targetName", ",", "typeName", ",", "keyName", ",", "valueName", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "builderName", ",", "attribute", ".", "name", "(", ")", ",", "ClassName", ".", "get", "(", "valueElement", ")", ",", "keyName", ",", "valueName", ")", ";", "}", "else", "{", "ParameterizedTypeName", "builderName", "=", "parameterizedTypeName", "(", "attribute", ".", "builderClass", "(", ")", ",", "targetName", ",", "typeName", ")", ";", "TypeName", "classType", "=", "typeName", ";", "if", "(", "typeMirror", ".", "getKind", "(", ")", ".", "isPrimitive", "(", ")", ")", "{", "classType", "=", "TypeName", ".", "get", "(", "typeMirror", ")", ";", "}", "String", "statement", ";", "if", "(", "Mirrors", ".", "listGenericTypeArguments", "(", "typeMirror", ")", ".", "size", "(", ")", ">", "0", ")", "{", "classType", "=", "TypeName", ".", "get", "(", "types", ".", "erasure", "(", "typeMirror", ")", ")", ";", "statement", "=", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ";", "}", "else", "{", "statement", "=", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ";", "}", "builder", ".", "add", "(", "statement", ",", "builderName", ",", "attribute", ".", "name", "(", ")", ",", "classType", ")", ";", "}", "if", "(", "!", "expression", ")", "{", "generateProperties", "(", "attribute", ",", "parent", ",", "typeMirror", ",", "targetName", ",", "typeName", ",", "builder", ")", ";", "}", "if", "(", "attribute", ".", "isKey", "(", ")", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ")", ";", "}", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isGenerated", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isLazy", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isNullable", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isUnique", "(", ")", ")", ";", "if", "(", "!", "Names", ".", "isEmpty", "(", "attribute", ".", "defaultValue", "(", ")", ")", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "defaultValue", "(", ")", ")", ";", "}", "if", "(", "!", "Names", ".", "isEmpty", "(", "attribute", ".", "collate", "(", ")", ")", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "collate", "(", ")", ")", ";", "}", "if", "(", "attribute", ".", "columnLength", "(", ")", "!", "=", "null", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "columnLength", "(", ")", ")", ";", "}", "if", "(", "attribute", ".", "isVersion", "(", ")", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isVersion", "(", ")", ")", ";", "}", "if", "(", "attribute", ".", "converterName", "(", ")", "!", "=", "null", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "converterName", "(", ")", ")", ";", "}", "if", "(", "attribute", ".", "isForeignKey", "(", ")", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isForeignKey", "(", ")", ")", ";", "Optional", "<", "EntityDescriptor", ">", "referencedType", "=", "graph", ".", "referencingEntity", "(", "attribute", ")", ";", "referencedType", ".", "ifPresent", "(", "referenced", "-", ">", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "referenced", ".", "isImmutable", "(", ")", "?", "TypeName", ".", "get", "(", "referenced", ".", "element", "(", ")", ".", "asType", "(", ")", ")", ":", "nameResolver", ".", "typeNameOf", "(", "referenced", ")", ")", ";", "graph", ".", "referencingAttribute", "(", "attribute", ",", "referenced", ")", ".", "ifPresent", "(", "referencedAttribute", "-", ">", "{", "String", "name", "=", "Names", ".", "upperCaseUnderscore", "(", "referencedAttribute", ".", "fieldName", "(", ")", ")", ";", "TypeSpec", "provider", "=", "CodeGeneration", ".", "createAnonymousSupplier", "(", "ClassName", ".", "get", "(", "Attribute", ".", "class", ")", ",", "CodeBlock", ".", "builder", "(", ")", ".", "addStatement", "(", "\"", "<STR_LIT>", "\"", ",", "nameResolver", ".", "typeNameOf", "(", "referenced", ")", ",", "name", ")", ".", "build", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "provider", ")", ";", "}", ")", ";", "}", ")", ";", "}", "if", "(", "attribute", ".", "isIndexed", "(", ")", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "isIndexed", "(", ")", ")", ";", "if", "(", "!", "attribute", ".", "indexNames", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "StringJoiner", "joiner", "=", "new", "StringJoiner", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "attribute", ".", "indexNames", "(", ")", ".", "forEach", "(", "name", "-", ">", "joiner", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "joiner", "+", "\"", "<STR_LIT:)>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "attribute", ".", "indexNames", "(", ")", ".", "toArray", "(", ")", ")", ";", "}", "}", "if", "(", "attribute", ".", "deleteAction", "(", ")", "!", "=", "null", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "ClassName", ".", "get", "(", "ReferentialAction", ".", "class", ")", ",", "attribute", ".", "deleteAction", "(", ")", ")", ";", "}", "if", "(", "attribute", ".", "updateAction", "(", ")", "!", "=", "null", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "ClassName", ".", "get", "(", "ReferentialAction", ".", "class", ")", ",", "attribute", ".", "updateAction", "(", ")", ")", ";", "}", "if", "(", "!", "attribute", ".", "cascadeActions", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "StringJoiner", "joiner", "=", "new", "StringJoiner", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "attribute", ".", "cascadeActions", "(", ")", ".", "forEach", "(", "action", "-", ">", "joiner", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "int", "index", "=", "0", ";", "ClassName", "cascadeClass", "=", "ClassName", ".", "get", "(", "CascadeAction", ".", "class", ")", ";", "Object", "[", "]", "args", "=", "new", "Object", "[", "attribute", ".", "cascadeActions", "(", ")", ".", "size", "(", ")", "*", "<NUM_LIT:2>", "]", ";", "for", "(", "CascadeAction", "action", ":", "attribute", ".", "cascadeActions", "(", ")", ")", "{", "args", "[", "index", "+", "+", "]", "=", "cascadeClass", ";", "args", "[", "index", "+", "+", "]", "=", "action", ";", "}", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "joiner", "+", "\"", "<STR_LIT:)>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "args", ")", ";", "}", "if", "(", "attribute", ".", "cardinality", "(", ")", "!", "=", "null", ")", "{", "if", "(", "!", "expression", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "ClassName", ".", "get", "(", "Cardinality", ".", "class", ")", ",", "attribute", ".", "cardinality", "(", ")", ")", ";", "}", "graph", ".", "referencingEntity", "(", "attribute", ")", ".", "ifPresent", "(", "referenced", "-", ">", "{", "Set", "<", "AttributeDescriptor", ">", "mappings", "=", "graph", ".", "mappedAttributes", "(", "entity", ",", "attribute", ",", "referenced", ")", ";", "if", "(", "attribute", ".", "cardinality", "(", ")", "=", "=", "Cardinality", ".", "MANY_TO_MANY", ")", "{", "generateJunctionType", "(", "attribute", ",", "referenced", ",", "mappings", ")", ".", "ifPresent", "(", "name", "-", ">", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "name", ")", ")", ";", "}", "if", "(", "mappings", ".", "size", "(", ")", "=", "=", "1", ")", "{", "AttributeDescriptor", "mapped", "=", "mappings", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "String", "staticMemberName", "=", "Names", ".", "upperCaseUnderscore", "(", "mapped", ".", "fieldName", "(", ")", ")", ";", "TypeSpec", "provider", "=", "CodeGeneration", ".", "createAnonymousSupplier", "(", "ClassName", ".", "get", "(", "Attribute", ".", "class", ")", ",", "CodeBlock", ".", "builder", "(", ")", ".", "addStatement", "(", "\"", "<STR_LIT>", "\"", ",", "nameResolver", ".", "typeNameOf", "(", "referenced", ")", ",", "staticMemberName", ")", ".", "build", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "provider", ")", ";", "}", "if", "(", "attribute", ".", "orderBy", "(", ")", "!", "=", "null", ")", "{", "referenced", ".", "attributes", "(", ")", ".", "values", "(", ")", ".", "stream", "(", ")", ".", "filter", "(", "entry", "-", ">", "entry", ".", "name", "(", ")", ".", "equals", "(", "attribute", ".", "orderBy", "(", ")", ")", ")", ".", "findFirst", "(", ")", ".", "ifPresent", "(", "orderBy", "-", ">", "{", "String", "staticMemberName", "=", "Names", ".", "upperCaseUnderscore", "(", "orderBy", ".", "fieldName", "(", ")", ")", ";", "TypeSpec", "provider", "=", "CodeGeneration", ".", "createAnonymousSupplier", "(", "ClassName", ".", "get", "(", "Attribute", ".", "class", ")", ",", "CodeBlock", ".", "builder", "(", ")", ".", "addStatement", "(", "\"", "<STR_LIT>", "\"", ",", "nameResolver", ".", "typeNameOf", "(", "referenced", ")", ",", "staticMemberName", ")", ".", "build", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "provider", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "ClassName", ".", "get", "(", "Order", ".", "class", ")", ",", "attribute", ".", "orderByDirection", "(", ")", ")", ";", "}", ")", ";", "}", "}", ")", ";", "}", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "FieldSpec", ".", "Builder", "field", "=", "FieldSpec", ".", "builder", "(", "type", ",", "fieldName", ",", "Modifier", ".", "PUBLIC", ",", "Modifier", ".", "STATIC", ",", "Modifier", ".", "FINAL", ")", ";", "if", "(", "useKotlinDelegate", ")", "{", "return", "field", ".", "initializer", "(", "\"", "<STR_LIT>", "\"", ",", "attributeType", ",", "builder", ".", "build", "(", ")", ")", ".", "build", "(", ")", ";", "}", "else", "{", "return", "field", ".", "initializer", "(", "\"", "<STR_LIT>", "\"", ",", "builder", ".", "build", "(", ")", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryUpdateRefresh", "(", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "int", "id", "=", "person", ".", "getId", "(", ")", ";", "int", "rowCount", "=", "data", ".", "update", "(", "Person", ".", "class", ")", ".", "set", "(", "Person", ".", "AGE", ",", "<NUM_LIT>", ")", ".", "where", "(", "Person", ".", "ID", ".", "eq", "(", "id", ")", ")", ".", "get", "(", ")", ".", "value", "(", ")", ";", "assertEquals", "(", "1", ",", "rowCount", ")", ";", "Person", "selected", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "where", "(", "Person", ".", "ID", ".", "eq", "(", "id", ")", ")", ".", "get", "(", ")", ".", "first", "(", ")", ";", "assertSame", "(", "<NUM_LIT>", ",", "selected", ".", "getAge", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryJoinOrderBy", "(", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "person", ".", "setAddress", "(", "randomAddress", "(", ")", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "Result", "<", "Address", ">", "result", "=", "data", ".", "select", "(", "Address", ".", "class", ")", ".", "join", "(", "Person", ".", "class", ")", ".", "on", "(", "Person", ".", "ADDRESS_ID", ".", "eq", "(", "Person", ".", "ID", ")", ")", ".", "where", "(", "Person", ".", "ID", ".", "eq", "(", "person", ".", "getId", "(", ")", ")", ")", ".", "orderBy", "(", "Address", ".", "CITY", ".", "desc", "(", ")", ")", ".", "get", "(", ")", ";", "List", "<", "Address", ">", "addresses", "=", "result", ".", "toList", "(", ")", ";", "assertTrue", "(", "addresses", ".", "size", "(", ")", ">", "0", ")", ";", "}", "</s>"]
["<s>", "void", "insert", "(", "E", "entity", ",", "final", "EntityProxy", "<", "E", ">", "proxy", ",", "GeneratedKeys", "<", "E", ">", "keys", ")", "{", "insert", "(", "entity", ",", "proxy", ",", "Cascade", ".", "AUTO", ",", "keys", ")", ";", "}", "</s>"]
["<s>", "void", "insert", "(", "final", "E", "entity", ",", "EntityProxy", "<", "E", ">", "proxy", ",", "Cascade", "mode", ",", "GeneratedKeys", "<", "E", ">", "keys", ")", "{", "GeneratedResultReader", "keyReader", "=", "null", ";", "if", "(", "hasGeneratedKey", ")", "{", "final", "Settable", "<", "E", ">", "settable", "=", "keys", "=", "=", "null", "?", "proxy", ":", "keys", ";", "keyReader", "=", "new", "GeneratedResultReader", "(", ")", "{", "@", "Override", "public", "void", "read", "(", "int", "index", ",", "ResultSet", "results", ")", "throws", "SQLException", "{", "if", "(", "results", ".", "next", "(", ")", ")", "{", "readGeneratedKeys", "(", "settable", ",", "results", ")", ";", "}", "}", "@", "Override", "public", "String", "[", "]", "generatedColumns", "(", ")", "{", "return", "generatedColumnNames", ";", "}", "}", ";", "}", "EntityUpdateOperation", "insert", "=", "new", "EntityUpdateOperation", "(", "context", ",", "keyReader", ")", "{", "@", "Override", "public", "int", "bindParameters", "(", "PreparedStatement", "statement", ")", "throws", "SQLException", "{", "return", "EntityWriter", ".", "this", ".", "bindParameters", "(", "statement", ",", "entity", ",", "null", ")", ";", "}", "}", ";", "QueryElement", "<", "Scalar", "<", "Integer", ">", ">", "query", "=", "new", "QueryElement", "<", ">", "(", "QueryType", ".", "INSERT", ",", "model", ",", "insert", ")", ";", "query", ".", "from", "(", "entityClass", ")", ";", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "associativeAttributes", ")", "{", "cascadeKeyReference", "(", "Cascade", ".", "INSERT", ",", "proxy", ",", "attribute", ")", ";", "}", "incrementVersion", "(", "proxy", ")", ";", "for", "(", "Attribute", "attribute", ":", "bindableAttributes", ")", "{", "query", ".", "value", "(", "(", "Expression", ")", "attribute", ",", "null", ")", ";", "}", "context", ".", "getStateListener", "(", ")", ".", "preInsert", "(", "entity", ",", "proxy", ")", ";", "checkRowsAffected", "(", "query", ".", "get", "(", ")", ".", "value", "(", ")", ",", "entity", ",", "null", ")", ";", "proxy", ".", "link", "(", "context", ".", "read", "(", "entityClass", ")", ")", ";", "updateAssociations", "(", "mode", ",", "entity", ",", "proxy", ",", "null", ")", ";", "context", ".", "getStateListener", "(", ")", ".", "postInsert", "(", "entity", ",", "proxy", ")", ";", "if", "(", "cacheable", ")", "{", "cache", ".", "put", "(", "entityClass", ",", "proxy", ".", "key", "(", ")", ",", "entity", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "update", "(", "E", "entity", ",", "EntityProxy", "<", "E", ">", "proxy", ",", "final", "Attribute", "<", "E", ",", "?", ">", "[", "]", "attributes", ")", "{", "final", "List", "<", "Attribute", "<", "E", ",", "?", ">", ">", "list", "=", "Arrays", ".", "asList", "(", "attributes", ")", ";", "update", "(", "entity", ",", "proxy", ",", "Cascade", ".", "AUTO", ",", "new", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "boolean", "test", "(", "Attribute", "<", "E", ",", "?", ">", "value", ")", "{", "return", "list", ".", "contains", "(", "value", ")", "&", "&", "!", "value", ".", "isAssociation", "(", ")", ";", "}", "}", ",", "new", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "boolean", "test", "(", "Attribute", "<", "E", ",", "?", ">", "value", ")", "{", "return", "list", ".", "contains", "(", "value", ")", "&", "&", "value", ".", "isAssociation", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "private", "int", "update", "(", "final", "E", "entity", ",", "final", "EntityProxy", "<", "E", ">", "proxy", ",", "Cascade", "mode", ",", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "filterBindable", ",", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "filterAssociations", ")", "{", "context", ".", "getStateListener", "(", ")", ".", "preUpdate", "(", "entity", ",", "proxy", ")", ";", "if", "(", "filterBindable", "=", "=", "null", ")", "{", "filterBindable", "=", "new", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "boolean", "test", "(", "Attribute", "<", "E", ",", "?", ">", "value", ")", "{", "return", "stateless", "|", "|", "(", "(", "proxy", ".", "getState", "(", "value", ")", "=", "=", "PropertyState", ".", "MODIFIED", ")", "&", "&", "(", "!", "value", ".", "isAssociation", "(", ")", "|", "|", "value", ".", "isForeignKey", "(", ")", "|", "|", "value", ".", "isKey", "(", ")", ")", ")", ";", "}", "}", ";", "}", "boolean", "hasVersion", "=", "versionAttribute", "!", "=", "null", ";", "final", "Object", "version", "=", "hasVersion", "?", "incrementVersion", "(", "proxy", ",", "filterBindable", ")", ":", "null", ";", "final", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "filter", "=", "filterBindable", ";", "EntityUpdateOperation", "operation", "=", "new", "EntityUpdateOperation", "(", "context", ",", "null", ")", "{", "@", "Override", "public", "int", "bindParameters", "(", "PreparedStatement", "statement", ")", "throws", "SQLException", "{", "int", "index", "=", "EntityWriter", ".", "this", ".", "bindParameters", "(", "statement", ",", "entity", ",", "filter", ")", ";", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "whereAttributes", ")", "{", "if", "(", "attribute", "=", "=", "versionAttribute", ")", "{", "mapping", ".", "write", "(", "(", "Expression", ")", "attribute", ",", "statement", ",", "index", "+", "1", ",", "version", ")", ";", "}", "else", "{", "if", "(", "attribute", ".", "getPrimitiveKind", "(", ")", "!", "=", "null", ")", "{", "mapPrimitiveType", "(", "proxy", ",", "attribute", ",", "statement", ",", "index", "+", "1", ")", ";", "}", "else", "{", "Object", "value", "=", "proxy", ".", "get", "(", "attribute", ",", "false", ")", ";", "mapping", ".", "write", "(", "(", "Expression", ")", "attribute", ",", "statement", ",", "index", "+", "1", ",", "value", ")", ";", "}", "}", "index", "+", "+", ";", "}", "return", "index", ";", "}", "}", ";", "QueryElement", "<", "Scalar", "<", "Integer", ">", ">", "query", "=", "new", "QueryElement", "<", ">", "(", "UPDATE", ",", "model", ",", "operation", ")", ";", "query", ".", "from", "(", "entityClass", ")", ";", "int", "count", "=", "0", ";", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "bindableAttributes", ")", "{", "if", "(", "!", "filterBindable", ".", "test", "(", "attribute", ")", ")", "{", "continue", ";", "}", "S", "referenced", "=", "foreignKeyReference", "(", "proxy", ",", "attribute", ")", ";", "if", "(", "referenced", "!", "=", "null", "&", "&", "!", "stateless", ")", "{", "proxy", ".", "setState", "(", "attribute", ",", "PropertyState", ".", "LOADED", ")", ";", "cascadeWrite", "(", "mode", ",", "referenced", ",", "null", ")", ";", "proxy", ".", "setState", "(", "attribute", ",", "PropertyState", ".", "MODIFIED", ")", ";", "}", "query", ".", "set", "(", "(", "Expression", ")", "attribute", ",", "null", ")", ";", "count", "+", "+", ";", "}", "int", "result", "=", "-", "1", ";", "if", "(", "count", ">", "0", ")", "{", "if", "(", "keyAttribute", "!", "=", "null", ")", "{", "query", ".", "where", "(", "Attributes", ".", "query", "(", "keyAttribute", ")", ".", "equal", "(", "\"", "<STR_LIT:?>", "\"", ")", ")", ";", "}", "else", "{", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "type", ".", "getKeyAttributes", "(", ")", ")", "{", "query", ".", "where", "(", "Attributes", ".", "query", "(", "attribute", ")", ".", "equal", "(", "\"", "<STR_LIT:?>", "\"", ")", ")", ";", "}", "}", "if", "(", "hasVersion", ")", "{", "addVersionCondition", "(", "query", ",", "version", ")", ";", "}", "result", "=", "query", ".", "get", "(", ")", ".", "value", "(", ")", ";", "proxy", ".", "link", "(", "context", ".", "read", "(", "entityClass", ")", ")", ";", "if", "(", "result", ">", "0", ")", "{", "updateAssociations", "(", "mode", ",", "entity", ",", "proxy", ",", "filterAssociations", ")", ";", "}", "}", "else", "{", "updateAssociations", "(", "mode", ",", "entity", ",", "proxy", ",", "filterAssociations", ")", ";", "}", "context", ".", "getStateListener", "(", ")", ".", "postUpdate", "(", "entity", ",", "proxy", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "private", "void", "updateAssociations", "(", "Cascade", "mode", ",", "E", "entity", ",", "EntityProxy", "<", "E", ">", "proxy", ",", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "filter", ")", "{", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "associativeAttributes", ")", "{", "if", "(", "(", "filter", "!", "=", "null", "&", "&", "filter", ".", "test", "(", "attribute", ")", ")", "|", "|", "(", "stateless", "|", "|", "proxy", ".", "getState", "(", "attribute", ")", "=", "=", "PropertyState", ".", "MODIFIED", ")", ")", "{", "updateAssociation", "(", "mode", ",", "entity", ",", "proxy", ",", "attribute", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "private", "void", "updateAssociation", "(", "Cascade", "mode", ",", "E", "entity", ",", "EntityProxy", "<", "E", ">", "proxy", ",", "Attribute", "<", "E", ",", "?", ">", "attribute", ")", "{", "switch", "(", "attribute", ".", "getCardinality", "(", ")", ")", "{", "case", "ONE_TO_ONE", ":", "S", "value", "=", "(", "S", ")", "proxy", ".", "get", "(", "attribute", ",", "false", ")", ";", "if", "(", "value", "!", "=", "null", ")", "{", "Attribute", "<", "S", ",", "Object", ">", "mapped", "=", "Attributes", ".", "get", "(", "attribute", ".", "getMappedAttribute", "(", ")", ")", ";", "EntityProxy", "<", "S", ">", "referred", "=", "context", ".", "proxyOf", "(", "value", ",", "true", ")", ";", "referred", ".", "set", "(", "mapped", ",", "entity", ",", "PropertyState", ".", "MODIFIED", ")", ";", "cascadeWrite", "(", "mode", ",", "value", ",", "referred", ")", ";", "}", "else", "if", "(", "!", "stateless", ")", "{", "throw", "new", "PersistenceException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "break", ";", "case", "ONE_TO_MANY", ":", "Object", "relation", "=", "proxy", ".", "get", "(", "attribute", ",", "false", ")", ";", "if", "(", "relation", "instanceof", "ObservableCollection", ")", "{", "ObservableCollection", "<", "S", ">", "collection", "=", "(", "ObservableCollection", "<", "S", ">", ")", "relation", ";", "CollectionChanges", "<", "?", ",", "S", ">", "changes", "=", "(", "CollectionChanges", "<", "?", ",", "S", ">", ")", "collection", ".", "observer", "(", ")", ";", "List", "<", "S", ">", "added", "=", "new", "ArrayList", "<", ">", "(", "changes", ".", "addedElements", "(", ")", ")", ";", "List", "<", "S", ">", "removed", "=", "new", "ArrayList", "<", ">", "(", "changes", ".", "removedElements", "(", ")", ")", ";", "changes", ".", "clear", "(", ")", ";", "for", "(", "S", "element", ":", "added", ")", "{", "updateMappedAssociation", "(", "mode", ",", "element", ",", "attribute", ",", "entity", ")", ";", "}", "for", "(", "S", "element", ":", "removed", ")", "{", "updateMappedAssociation", "(", "Cascade", ".", "UPDATE", ",", "element", ",", "attribute", ",", "null", ")", ";", "}", "}", "else", "if", "(", "relation", "instanceof", "Iterable", ")", "{", "Iterable", "<", "S", ">", "iterable", "=", "(", "Iterable", "<", "S", ">", ")", "relation", ";", "for", "(", "S", "added", ":", "iterable", ")", "{", "updateMappedAssociation", "(", "mode", ",", "added", ",", "attribute", ",", "entity", ")", ";", "}", "}", "else", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "relation", ")", ";", "}", "break", ";", "case", "MANY_TO_MANY", ":", "Class", "referencedClass", "=", "attribute", ".", "getReferencedClass", "(", ")", ";", "if", "(", "referencedClass", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "attribute", ")", ";", "}", "Type", "<", "?", ">", "referencedType", "=", "model", ".", "typeOf", "(", "referencedClass", ")", ";", "QueryAttribute", "<", "S", ",", "Object", ">", "tKey", "=", "null", ";", "QueryAttribute", "<", "S", ",", "Object", ">", "uKey", "=", "null", ";", "for", "(", "Attribute", "a", ":", "referencedType", ".", "getAttributes", "(", ")", ")", "{", "if", "(", "entityClass", ".", "isAssignableFrom", "(", "a", ".", "getReferencedClass", "(", ")", ")", ")", "{", "tKey", "=", "Attributes", ".", "query", "(", "a", ")", ";", "}", "else", "if", "(", "attribute", ".", "getElementClass", "(", ")", ".", "isAssignableFrom", "(", "a", ".", "getReferencedClass", "(", ")", ")", ")", "{", "uKey", "=", "Attributes", ".", "query", "(", "a", ")", ";", "}", "}", "Objects", ".", "requireNotNull", "(", "tKey", ")", ";", "Objects", ".", "requireNotNull", "(", "uKey", ")", ";", "Attribute", "<", "E", ",", "Object", ">", "tRef", "=", "Attributes", ".", "get", "(", "tKey", ".", "getReferencedAttribute", "(", ")", ")", ";", "Attribute", "<", "S", ",", "Object", ">", "uRef", "=", "Attributes", ".", "get", "(", "uKey", ".", "getReferencedAttribute", "(", ")", ")", ";", "CollectionChanges", "<", "?", ",", "S", ">", "changes", "=", "null", ";", "relation", "=", "proxy", ".", "get", "(", "attribute", ",", "false", ")", ";", "Iterable", "<", "S", ">", "addedElements", "=", "(", "Iterable", "<", "S", ">", ")", "relation", ";", "boolean", "isObservable", "=", "relation", "instanceof", "ObservableCollection", ";", "if", "(", "relation", "instanceof", "ObservableCollection", ")", "{", "ObservableCollection", "<", "S", ">", "collection", "=", "(", "ObservableCollection", "<", "S", ">", ")", "relation", ";", "changes", "=", "(", "CollectionChanges", "<", "?", ",", "S", ">", ")", "collection", ".", "observer", "(", ")", ";", "if", "(", "changes", "!", "=", "null", ")", "{", "addedElements", "=", "changes", ".", "addedElements", "(", ")", ";", "}", "}", "for", "(", "S", "added", ":", "addedElements", ")", "{", "S", "junction", "=", "(", "S", ")", "referencedType", ".", "getFactory", "(", ")", ".", "get", "(", ")", ";", "EntityProxy", "<", "S", ">", "junctionProxy", "=", "context", ".", "proxyOf", "(", "junction", ",", "false", ")", ";", "EntityProxy", "<", "S", ">", "uProxy", "=", "context", ".", "proxyOf", "(", "added", ",", "false", ")", ";", "if", "(", "attribute", ".", "getCascadeActions", "(", ")", ".", "contains", "(", "CascadeAction", ".", "SAVE", ")", ")", "{", "cascadeWrite", "(", "mode", ",", "added", ",", "uProxy", ")", ";", "}", "Object", "tValue", "=", "proxy", ".", "get", "(", "tRef", ",", "false", ")", ";", "Object", "uValue", "=", "uProxy", ".", "get", "(", "uRef", ",", "false", ")", ";", "junctionProxy", ".", "set", "(", "tKey", ",", "tValue", ",", "PropertyState", ".", "MODIFIED", ")", ";", "junctionProxy", ".", "set", "(", "uKey", ",", "uValue", ",", "PropertyState", ".", "MODIFIED", ")", ";", "Cascade", "cascade", "=", "!", "isObservable", "&", "&", "mode", "=", "=", "Cascade", ".", "UPSERT", "?", "Cascade", ".", "UPSERT", ":", "Cascade", ".", "INSERT", ";", "cascadeWrite", "(", "cascade", ",", "junction", ",", "null", ")", ";", "}", "if", "(", "changes", "!", "=", "null", ")", "{", "Object", "keyValue", "=", "proxy", ".", "get", "(", "tRef", ",", "false", ")", ";", "for", "(", "S", "removed", ":", "changes", ".", "removedElements", "(", ")", ")", "{", "Object", "otherValue", "=", "context", ".", "proxyOf", "(", "removed", ",", "false", ")", ".", "get", "(", "uRef", ")", ";", "Class", "<", "?", "extends", "S", ">", "removeType", "=", "(", "Class", "<", "?", "extends", "S", ">", ")", "referencedType", ".", "getClassType", "(", ")", ";", "Supplier", "<", "Scalar", "<", "Integer", ">", ">", "query", "=", "queryable", ".", "delete", "(", "removeType", ")", ".", "where", "(", "tKey", ".", "equal", "(", "keyValue", ")", ")", ".", "and", "(", "uKey", ".", "equal", "(", "otherValue", ")", ")", ";", "int", "count", "=", "query", ".", "get", "(", ")", ".", "value", "(", ")", ";", "if", "(", "count", "!", "=", "1", ")", "{", "throw", "new", "RowCountException", "(", "1", ",", "count", ")", ";", "}", "}", "changes", ".", "clear", "(", ")", ";", "}", "break", ";", "case", "MANY_TO_ONE", ":", "default", ":", "break", ";", "}", "context", ".", "read", "(", "type", ".", "getClassType", "(", ")", ")", ".", "refresh", "(", "entity", ",", "proxy", ",", "attribute", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "incrementVersion", "(", "EntityProxy", "<", "E", ">", "proxy", ",", "Predicate", "<", "Attribute", "<", "E", ",", "?", ">", ">", "filter", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "bindableAttributes", ")", "{", "if", "(", "attribute", "!", "=", "versionAttribute", "&", "&", "filter", ".", "test", "(", "attribute", ")", ")", "{", "modified", "=", "true", ";", "break", ";", "}", "}", "final", "Object", "version", "=", "proxy", ".", "get", "(", "versionAttribute", ",", "true", ")", ";", "if", "(", "modified", ")", "{", "if", "(", "version", "=", "=", "null", ")", "{", "throw", "new", "MissingVersionException", "(", "proxy", ")", ";", "}", "incrementVersion", "(", "proxy", ")", ";", "}", "return", "version", ";", "}", "</s>"]
["<s>", "private", "void", "updateMappedAssociation", "(", "Cascade", "mode", ",", "S", "entity", ",", "Attribute", "attribute", ",", "Object", "value", ")", "{", "EntityProxy", "<", "S", ">", "proxy", "=", "context", ".", "proxyOf", "(", "entity", ",", "false", ")", ";", "Attribute", "<", "S", ",", "Object", ">", "mapped", "=", "Attributes", ".", "get", "(", "attribute", ".", "getMappedAttribute", "(", ")", ")", ";", "proxy", ".", "set", "(", "mapped", ",", "value", ",", "PropertyState", ".", "MODIFIED", ")", ";", "cascadeWrite", "(", "mode", ",", "entity", ",", "proxy", ")", ";", "}", "</s>"]
["<s>", "private", "void", "cascadeKeyReference", "(", "Cascade", "mode", ",", "EntityProxy", "<", "E", ">", "proxy", ",", "Attribute", "<", "E", ",", "?", ">", "attribute", ")", "{", "S", "referenced", "=", "foreignKeyReference", "(", "proxy", ",", "attribute", ")", ";", "if", "(", "referenced", "!", "=", "null", "&", "&", "proxy", ".", "getState", "(", "attribute", ")", "=", "=", "PropertyState", ".", "MODIFIED", ")", "{", "EntityProxy", "<", "S", ">", "referred", "=", "context", ".", "proxyOf", "(", "referenced", ",", "false", ")", ";", "if", "(", "!", "referred", ".", "isLinked", "(", ")", ")", "{", "proxy", ".", "setState", "(", "attribute", ",", "PropertyState", ".", "LOADED", ")", ";", "cascadeWrite", "(", "mode", ",", "referenced", ",", "null", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "<", "U", "extends", "S", ">", "void", "cascadeWrite", "(", "Cascade", "mode", ",", "U", "entity", ",", "EntityProxy", "<", "U", ">", "proxy", ")", "{", "if", "(", "entity", "!", "=", "null", ")", "{", "if", "(", "proxy", "=", "=", "null", ")", "{", "proxy", "=", "context", ".", "proxyOf", "(", "entity", ",", "false", ")", ";", "}", "EntityWriter", "<", "U", ",", "S", ">", "writer", "=", "context", ".", "write", "(", "proxy", ".", "type", "(", ")", ".", "getClassType", "(", ")", ")", ";", "if", "(", "mode", "=", "=", "Cascade", ".", "AUTO", ")", "{", "mode", "=", "proxy", ".", "isLinked", "(", ")", "|", "|", "hasKey", "(", "proxy", ")", "?", "Cascade", ".", "UPDATE", ":", "Cascade", ".", "INSERT", ";", "}", "switch", "(", "mode", ")", "{", "case", "INSERT", ":", "writer", ".", "insert", "(", "entity", ",", "proxy", ",", "mode", ",", "null", ")", ";", "break", ";", "case", "UPDATE", ":", "writer", ".", "update", "(", "entity", ",", "proxy", ",", "mode", ",", "null", ",", "null", ")", ";", "break", ";", "case", "UPSERT", ":", "writer", ".", "upsert", "(", "entity", ",", "proxy", ")", ";", "break", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setup", "(", ")", "throws", "SQLException", "{", "Platform", "platform", "=", "new", "HSQL", "(", ")", ";", "CommonDataSource", "dataSource", "=", "DatabaseType", ".", "getDataSource", "(", "platform", ")", ";", "EntityModel", "model", "=", "io", ".", "requery", ".", "test", ".", "model", ".", "Models", ".", "DEFAULT", ";", "CachingProvider", "provider", "=", "Caching", ".", "getCachingProvider", "(", ")", ";", "CacheManager", "cacheManager", "=", "provider", ".", "getCacheManager", "(", ")", ";", "Configuration", "configuration", "=", "new", "ConfigurationBuilder", "(", "dataSource", ",", "model", ")", ".", "useDefaultLogging", "(", ")", ".", "setWriteExecutor", "(", "Executors", ".", "newSingleThreadExecutor", "(", ")", ")", ".", "setEntityCache", "(", "new", "EntityCacheBuilder", "(", "model", ")", ".", "useReferenceCache", "(", "true", ")", ".", "useSerializableCache", "(", "true", ")", ".", "useCacheManager", "(", "cacheManager", ")", ".", "build", "(", ")", ")", ".", "build", "(", ")", ";", "SchemaModifier", "tables", "=", "new", "SchemaModifier", "(", "configuration", ")", ";", "tables", ".", "createTables", "(", "TableCreationMode", ".", "DROP_CREATE", ")", ";", "data", "=", "ReactiveSupport", ".", "toReactiveStore", "(", "new", "EntityDataStore", "<", "Persistable", ">", "(", "configuration", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsert", "(", ")", "throws", "Exception", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Person", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Person", "person", ")", "{", "assertTrue", "(", "person", ".", "getId", "(", ")", ">", "0", ")", ";", "Person", "cached", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "where", "(", "Person", ".", "ID", ".", "equal", "(", "person", ".", "getId", "(", ")", ")", ")", ".", "get", "(", ")", ".", "first", "(", ")", ";", "assertSame", "(", "cached", ",", "person", ")", ";", "latch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "latch", ".", "await", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelete", "(", ")", "throws", "Exception", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "data", ".", "delete", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "Person", "cached", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "where", "(", "Person", ".", "ID", ".", "equal", "(", "person", ".", "getId", "(", ")", ")", ")", ".", "get", "(", ")", ".", "firstOrNull", "(", ")", ";", "assertNull", "(", "cached", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertCount", "(", ")", "throws", "Exception", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "Observable", ".", "just", "(", "person", ")", ".", "concatMap", "(", "new", "Function", "<", "Person", ",", "Observable", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "Observable", "<", "Person", ">", "apply", "(", "Person", "person", ")", "{", "return", "data", ".", "insert", "(", "person", ")", ".", "toObservable", "(", ")", ";", "}", "}", ")", ";", "Person", "p", "=", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "assertTrue", "(", "p", ".", "getId", "(", ")", ">", "0", ")", ";", "int", "count", "=", "data", ".", "count", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "toSingle", "(", ")", ".", "toBlocking", "(", ")", ".", "value", "(", ")", ";", "assertEquals", "(", "1", ",", "count", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertOneToMany", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "map", "(", "new", "Function", "<", "Person", ",", "Phone", ">", "(", ")", "{", "@", "Override", "public", "Phone", "apply", "(", "Person", "person", ")", "{", "Phone", "phone1", "=", "randomPhone", "(", ")", ";", "phone1", ".", "setOwner", "(", "person", ")", ";", "return", "phone1", ";", "}", "}", ")", ".", "flatMap", "(", "new", "Function", "<", "Phone", ",", "Single", "<", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "Single", "<", "?", ">", "apply", "(", "Phone", "phone", ")", "{", "return", "data", ".", "insert", "(", "phone", ")", ";", "}", "}", ")", ".", "blockingGet", "(", ")", ";", "assertTrue", "(", "person", ".", "getPhoneNumbers", "(", ")", ".", "toList", "(", ")", ".", "size", "(", ")", "=", "=", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryObservable", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:30>", ";", "i", "+", "+", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "}", "final", "List", "<", "Person", ">", "people", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "limit", "(", "<NUM_LIT>", ")", ".", "get", "(", ")", ".", "observable", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Person", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Person", "person", ")", "{", "people", ".", "add", "(", "person", ")", ";", "}", "}", ")", ";", "assertEquals", "(", "<NUM_LIT:30>", ",", "people", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQuerySelfObservable", "(", ")", "throws", "Exception", "{", "final", "AtomicInteger", "count", "=", "new", "AtomicInteger", "(", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "observableResult", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Result", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Result", "<", "Person", ">", "persons", ")", "{", "count", ".", "incrementAndGet", "(", ")", ";", "}", "}", ")", ";", "data", ".", "insert", "(", "randomPerson", "(", ")", ")", ".", "blockingGet", "(", ")", ";", "data", ".", "insert", "(", "randomPerson", "(", ")", ")", ".", "blockingGet", "(", ")", ";", "assertEquals", "(", "<NUM_LIT:3>", ",", "count", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQuerySelfObservableMap", "(", ")", "throws", "Exception", "{", "final", "AtomicInteger", "count", "=", "new", "AtomicInteger", "(", ")", ";", "Disposable", "disposable", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "limit", "(", "<NUM_LIT:2>", ")", ".", "get", "(", ")", ".", "observableResult", "(", ")", ".", "flatMap", "(", "new", "Function", "<", "Result", "<", "Person", ">", ",", "Observable", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "Observable", "<", "Person", ">", "apply", "(", "Result", "<", "Person", ">", "persons", ")", "{", "return", "persons", ".", "observable", "(", ")", ";", "}", "}", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Person", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Person", "persons", ")", "{", "count", ".", "incrementAndGet", "(", ")", ";", "}", "}", ")", ";", "data", ".", "insert", "(", "randomPerson", "(", ")", ")", ".", "blockingGet", "(", ")", ";", "data", ".", "insert", "(", "randomPerson", "(", ")", ")", ".", "blockingGet", "(", ")", ";", "assertEquals", "(", "<NUM_LIT:3>", ",", "count", ".", "get", "(", ")", ")", ";", "disposable", ".", "dispose", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSelfObservableDelete", "(", ")", "throws", "Exception", "{", "final", "AtomicInteger", "count", "=", "new", "AtomicInteger", "(", ")", ";", "Disposable", "disposable", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "observableResult", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Result", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Result", "<", "Person", ">", "persons", ")", "{", "count", ".", "incrementAndGet", "(", ")", ";", "}", "}", ")", ";", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "data", ".", "delete", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "assertEquals", "(", "<NUM_LIT:3>", ",", "count", ".", "get", "(", ")", ")", ";", "disposable", ".", "dispose", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSelfObservableDeleteQuery", "(", ")", "throws", "Exception", "{", "final", "AtomicInteger", "count", "=", "new", "AtomicInteger", "(", ")", ";", "Disposable", "disposable", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "observableResult", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Result", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Result", "<", "Person", ">", "persons", ")", "{", "count", ".", "incrementAndGet", "(", ")", ";", "}", "}", ")", ";", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "assertEquals", "(", "<NUM_LIT:2>", ",", "count", ".", "get", "(", ")", ")", ";", "int", "rows", "=", "data", ".", "delete", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "value", "(", ")", ";", "assertEquals", "(", "<NUM_LIT:3>", ",", "count", ".", "get", "(", ")", ")", ";", "disposable", ".", "dispose", "(", ")", ";", "assertEquals", "(", "rows", ",", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQuerySelfObservableRelational", "(", ")", "throws", "Exception", "{", "final", "AtomicInteger", "count", "=", "new", "AtomicInteger", "(", ")", ";", "Disposable", "disposable", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "observableResult", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Result", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Result", "<", "Person", ">", "persons", ")", "{", "count", ".", "incrementAndGet", "(", ")", ";", "}", "}", ")", ";", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "Phone", "phone", "=", "randomPhone", "(", ")", ";", "person", ".", "getPhoneNumbers", "(", ")", ".", "add", "(", "phone", ")", ";", "data", ".", "update", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "data", ".", "delete", "(", "phone", ")", ".", "blockingGet", "(", ")", ";", "assertEquals", "(", "<NUM_LIT:4>", ",", "count", ".", "get", "(", ")", ")", ";", "disposable", ".", "dispose", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryObservableFromEntity", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "map", "(", "new", "Function", "<", "Person", ",", "Phone", ">", "(", ")", "{", "@", "Override", "public", "Phone", "apply", "(", "Person", "person", ")", "{", "Phone", "phone1", "=", "randomPhone", "(", ")", ";", "phone1", ".", "setOwner", "(", "person", ")", ";", "return", "phone1", ";", "}", "}", ")", ".", "flatMap", "(", "new", "Function", "<", "Phone", ",", "Single", "<", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "Single", "<", "?", ">", "apply", "(", "Phone", "phone", ")", "{", "return", "data", ".", "insert", "(", "phone", ")", ";", "}", "}", ")", ".", "blockingGet", "(", ")", ";", "int", "count", "=", "person", ".", "getPhoneNumbers", "(", ")", ".", "toObservable", "(", ")", ".", "count", "(", ")", ".", "toBlocking", "(", ")", ".", "first", "(", ")", ";", "assertEquals", "(", "1", ",", "count", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRunInTransaction", "(", ")", "{", "final", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "runInTransaction", "(", "data", ".", "insert", "(", "person", ")", ",", "data", ".", "update", "(", "person", ")", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Object", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Object", "o", ")", "{", "}", "}", ")", ";", "assertEquals", "(", "1", ",", "data", ".", "count", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "value", "(", ")", ".", "intValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryObservablePull", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT>", ";", "i", "+", "+", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "blockingGet", "(", ")", ";", "}", "final", "List", "<", "Person", ">", "people", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "flowable", "(", ")", ".", "subscribeOn", "(", "Schedulers", ".", "trampoline", "(", ")", ")", ".", "subscribe", "(", "new", "Subscriber", "<", "Person", ">", "(", ")", "{", "Subscription", "s", ";", "@", "Override", "public", "void", "onSubscribe", "(", "Subscription", "s", ")", "{", "this", ".", "s", "=", "s", ";", "s", ".", "request", "(", "<NUM_LIT:10>", ")", ";", "}", "@", "Override", "public", "void", "onComplete", "(", ")", "{", "}", "@", "Override", "public", "void", "onError", "(", "Throwable", "e", ")", "{", "}", "@", "Override", "public", "void", "onNext", "(", "Person", "person", ")", "{", "people", ".", "add", "(", "person", ")", ";", "if", "(", "people", ".", "size", "(", ")", "%", "<NUM_LIT:10>", "=", "=", "0", "&", "&", "people", ".", "size", "(", ")", ">", "1", ")", "{", "s", ".", "request", "(", "<NUM_LIT:10>", ")", ";", "}", "}", "}", ")", ";", "assertEquals", "(", "<NUM_LIT>", ",", "people", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "requestAll", "(", ")", "{", "try", "(", "CloseableIterator", "<", "T", ">", "iterator", "=", "result", ".", "iterator", "(", ")", ")", "{", "while", "(", "!", "canceled", ".", "get", "(", ")", ")", "{", "if", "(", "iterator", ".", "hasNext", "(", ")", ")", "{", "subscriber", ".", "onNext", "(", "iterator", ".", "next", "(", ")", ")", ";", "emitted", ".", "incrementAndGet", "(", ")", ";", "}", "else", "{", "subscriber", ".", "onComplete", "(", ")", ";", "break", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "void", "requestN", "(", "long", "n", ")", "{", "long", "count", "=", "n", ";", "while", "(", "count", ">", "0", ")", "{", "try", "(", "CloseableIterator", "<", "T", ">", "iterator", "=", "result", ".", "iterator", "(", "emitted", ".", "intValue", "(", ")", ",", "(", "int", ")", "n", ")", ")", "{", "long", "i", "=", "0", ";", "while", "(", "!", "canceled", ".", "get", "(", ")", "&", "&", "iterator", ".", "hasNext", "(", ")", ")", "{", "if", "(", "i", "+", "+", "<", "count", ")", "{", "subscriber", ".", "onNext", "(", "iterator", ".", "next", "(", ")", ")", ";", "}", "else", "{", "break", ";", "}", "}", "emitted", ".", "addAndGet", "(", "i", ")", ";", "if", "(", "!", "canceled", ".", "get", "(", ")", "&", "&", "i", "<", "count", ")", "{", "subscriber", ".", "onComplete", "(", ")", ";", "break", ";", "}", "count", "=", "requested", ".", "addAndGet", "(", "-", "count", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "static", "<", "S", ">", "ReactiveEntityStore", "<", "S", ">", "toReactiveStore", "(", "BlockingEntityStore", "<", "S", ">", "store", ")", "{", "return", "new", "WrappedEntityStore", "<", ">", "(", "store", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "Observable", "<", "Result", "<", "T", ">", ">", "toObservableResult", "(", "final", "Result", "<", "T", ">", "result", ")", "{", "if", "(", "!", "(", "result", "instanceof", "TransactionListenable", ")", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "TransactionListenable", "listenable", "=", "(", "TransactionListenable", ")", "result", ";", "final", "QueryElement", "<", "?", ">", "element", "=", "(", "(", "QueryWrapper", ")", "result", ")", ".", "unwrapQuery", "(", ")", ";", "listenable", ".", "addTransactionListener", "(", "typeChanges", ")", ";", "return", "typeChanges", ".", "commitSubject", "(", ")", ".", "filter", "(", "new", "Predicate", "<", "Set", "<", "Type", "<", "?", ">", ">", ">", "(", ")", "{", "@", "Override", "public", "boolean", "test", "(", "Set", "<", "Type", "<", "?", ">", ">", "types", ")", "{", "return", "!", "Collections", ".", "disjoint", "(", "element", ".", "entityTypes", "(", ")", ",", "types", ")", "|", "|", "RxSupport", ".", "referencesType", "(", "element", ".", "entityTypes", "(", ")", ",", "types", ")", ";", "}", "}", ")", ".", "map", "(", "new", "Function", "<", "Set", "<", "Type", "<", "?", ">", ">", ",", "Result", "<", "T", ">", ">", "(", ")", "{", "@", "Override", "public", "Result", "<", "T", ">", "apply", "(", "Set", "<", "Type", "<", "?", ">", ">", "types", ")", "{", "return", "result", ";", "}", "}", ")", ".", "startWith", "(", "result", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", ">", "Flowable", "<", "E", ">", "toFlowable", "(", "final", "BaseResult", "<", "E", ">", "result", ")", "{", "return", "new", "Flowable", "<", "E", ">", "(", ")", "{", "@", "Override", "protected", "void", "subscribeActual", "(", "Subscriber", "<", "?", "super", "E", ">", "s", ")", "{", "s", ".", "onSubscribe", "(", "new", "QuerySubscription", "<", ">", "(", "result", ",", "s", ")", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "Subject", "<", "Set", "<", "Type", "<", "?", ">", ">", ">", "commitSubject", "(", ")", "{", "return", "commitSubject", ";", "}", "</s>"]
["<s>", "@", "Parameterized", ".", "Parameters", "(", "name", "=", "\"", "<STR_LIT>", "\"", ")", "public", "static", "Collection", "<", "Platform", ">", "data", "(", ")", "{", "return", "Arrays", ".", "<", "Platform", ">", "asList", "(", "new", "H2", "(", ")", ",", "new", "SQLite", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setup", "(", ")", "throws", "SQLException", "{", "CommonDataSource", "dataSource", "=", "DatabaseType", ".", "getDataSource", "(", "platform", ")", ";", "EntityModel", "model", "=", "Models", ".", "STATELESS", ";", "Configuration", "configuration", "=", "new", "ConfigurationBuilder", "(", "dataSource", ",", "model", ")", ".", "useDefaultLogging", "(", ")", ".", "setEntityCache", "(", "new", "EmptyEntityCache", "(", ")", ")", ".", "setWriteExecutor", "(", "Executors", ".", "newSingleThreadExecutor", "(", ")", ")", ".", "build", "(", ")", ";", "SchemaModifier", "tables", "=", "new", "SchemaModifier", "(", "configuration", ")", ";", "tables", ".", "createTables", "(", "TableCreationMode", ".", "DROP_CREATE", ")", ";", "System", ".", "out", ".", "println", "(", "tables", ".", "createTablesString", "(", "TableCreationMode", ".", "DROP_CREATE", ")", ")", ";", "data", "=", "new", "EntityDataStore", "<", ">", "(", "configuration", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsert", "(", ")", "{", "Entry", "event", "=", "new", "Entry", "(", ")", ";", "UUID", "id", "=", "UUID", ".", "randomUUID", "(", ")", ";", "event", ".", "setId", "(", "id", ".", "toString", "(", ")", ")", ";", "event", ".", "setCreated", "(", "new", "Date", "(", ")", ")", ";", "event", ".", "setFlag1", "(", "false", ")", ";", "event", ".", "setFlag2", "(", "true", ")", ";", "data", ".", "insert", "(", "event", ")", ";", "Entry", "found", "=", "data", ".", "findByKey", "(", "Entry", ".", "class", ",", "id", ".", "toString", "(", ")", ")", ";", "assertEquals", "(", "event", ".", "getId", "(", ")", ",", "found", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testUpdate", "(", ")", "{", "Entry", "event", "=", "new", "Entry", "(", ")", ";", "UUID", "id", "=", "UUID", ".", "randomUUID", "(", ")", ";", "event", ".", "setId", "(", "id", ".", "toString", "(", ")", ")", ";", "event", ".", "setCreated", "(", "new", "Date", "(", ")", ")", ";", "event", ".", "setFlag1", "(", "false", ")", ";", "event", ".", "setFlag2", "(", "true", ")", ";", "data", ".", "insert", "(", "event", ")", ";", "Entry", "found", "=", "data", ".", "findByKey", "(", "Entry", ".", "class", ",", "id", ".", "toString", "(", ")", ")", ";", "assertEquals", "(", "found", ".", "isFlag1", "(", ")", ",", "false", ")", ";", "assertEquals", "(", "found", ".", "isFlag2", "(", ")", ",", "true", ")", ";", "event", ".", "setFlag1", "(", "true", ")", ";", "event", ".", "setFlag2", "(", "false", ")", ";", "data", ".", "update", "(", "event", ")", ";", "found", "=", "data", ".", "findByKey", "(", "Entry", ".", "class", ",", "id", ".", "toString", "(", ")", ")", ";", "assertEquals", "(", "found", ".", "isFlag1", "(", ")", ",", "true", ")", ";", "assertEquals", "(", "found", ".", "isFlag2", "(", ")", ",", "false", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isEmptyKotlinAnnotationSet", "(", "Set", "<", "?", "extends", "TypeElement", ">", "annotations", ")", "{", "if", "(", "annotations", ".", "size", "(", ")", "=", "=", "1", ")", "{", "TypeElement", "element", "=", "annotations", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "if", "(", "element", ".", "getQualifiedName", "(", ")", ".", "contentEquals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "protected", "static", "Set", "<", "TypeElement", ">", "getAnnotations", "(", ")", "{", "return", "annotations", ";", "}", "</s>"]
["<s>", "public", "TypeBuilder", "<", "T", ">", "setTableUniqueIndexes", "(", "String", "[", "]", "indexes", ")", "{", "this", ".", "tableUniqueIndexes", "=", "indexes", ";", "return", "this", ";", "}", "</s>"]
["<s>", "void", "delete", "(", "Iterable", "<", "E", ">", "entities", ")", "{", "if", "(", "keyCount", "=", "=", "0", ")", "{", "for", "(", "E", "entity", ":", "entities", ")", "{", "delete", "(", "entity", ",", "type", ".", "getProxyProvider", "(", ")", ".", "apply", "(", "entity", ")", ")", ";", "}", "}", "else", "{", "batchDelete", "(", "entities", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryByUUID", "(", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "UUID", "uuid", "=", "person", ".", "getUUID", "(", ")", ";", "Person", "result", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "where", "(", "Person", ".", "UUID", ".", "eq", "(", "uuid", ")", ")", ".", "get", "(", ")", ".", "first", "(", ")", ";", "assertEquals", "(", "person", ",", "result", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "bindBlobLiteral", "(", "int", "index", ",", "byte", "[", "]", "value", ")", "{", "int", "placeHolderIndex", "=", "0", ";", "int", "replace", "=", "0", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "sql", ".", "length", "(", ")", ";", "i", "+", "+", ")", "{", "if", "(", "sql", ".", "charAt", "(", "i", ")", "=", "=", "<CHAR_LIT>", ")", "{", "placeHolderIndex", "+", "+", ";", "if", "(", "placeHolderIndex", "=", "=", "index", ")", "{", "replace", "=", "i", ";", "break", ";", "}", "}", "}", "String", "literal", "=", "\"", "<STR_LIT>", "\"", "+", "byteToHexString", "(", "value", ")", "+", "\"", "'", "\"", ";", "sql", "=", "sql", ".", "substring", "(", "0", ",", "replace", ")", "+", "literal", "+", "sql", ".", "substring", "(", "replace", "+", "1", ",", "sql", ".", "length", "(", ")", "-", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertList", "(", ")", "throws", "Exception", "{", "final", "List", "<", "Person", ">", "items", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "1", ";", "i", "+", "+", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "items", ".", "add", "(", "person", ")", ";", "}", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "data", ".", "insert", "(", "items", ")", ".", "subscribe", "(", "new", "Action1", "<", "Iterable", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "Iterable", "<", "Person", ">", "iterable", ")", "{", "List", "<", "Person", ">", "queried", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "toList", "(", ")", ";", "try", "{", "assertEquals", "(", "queried", ",", "items", ")", ";", "}", "finally", "{", "latch", ".", "countDown", "(", ")", ";", "}", "}", "}", ")", ";", "latch", ".", "await", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "upperCaseUnderscoreRemovePrefixes", "(", "String", "name", ")", "{", "return", "Names", ".", "upperCaseUnderscore", "(", "Names", ".", "removeMemberPrefixes", "(", "name", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryEmpty", "(", ")", "throws", "Exception", "{", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "observable", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Person", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Person", "person", ")", "throws", "Exception", "{", "Assert", ".", "fail", "(", ")", ";", "}", "}", ",", "new", "Consumer", "<", "Throwable", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Throwable", "throwable", ")", "throws", "Exception", "{", "Assert", ".", "fail", "(", ")", ";", "}", "}", ",", "new", "Action", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "throws", "Exception", "{", "latch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "if", "(", "!", "latch", ".", "await", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ")", "{", "Assert", ".", "fail", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "generateEmbeddedAttributes", "(", "AttributeDescriptor", "parent", ",", "EntityDescriptor", "embedded", ",", "TypeSpec", ".", "Builder", "builder", ",", "TypeName", "targetName", ")", "{", "embedded", ".", "attributes", "(", ")", ".", "values", "(", ")", ".", "forEach", "(", "attribute", "-", ">", "{", "String", "fieldName", "=", "Names", ".", "upperCaseUnderscore", "(", "embeddedAttributeName", "(", "parent", ",", "attribute", ")", ")", ";", "TypeMirror", "mirror", "=", "attribute", ".", "typeMirror", "(", ")", ";", "builder", ".", "addField", "(", "generateAttribute", "(", "attribute", ",", "parent", ",", "targetName", ",", "fieldName", ",", "mirror", ",", "false", ")", ")", ";", "attributeNames", ".", "add", "(", "fieldName", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "static", "String", "attributeFieldName", "(", "AttributeDescriptor", "attribute", ")", "{", "return", "\"", "<STR_LIT:$>", "\"", "+", "attribute", ".", "fieldName", "(", ")", ";", "}", "</s>"]
["<s>", "static", "String", "embeddedAttributeName", "(", "AttributeDescriptor", "parent", ",", "AttributeDescriptor", "embedded", ")", "{", "return", "Names", ".", "removeMemberPrefixes", "(", "parent", ".", "fieldName", "(", ")", ")", "+", "\"", "<STR_LIT:_>", "\"", "+", "Names", ".", "removeMemberPrefixes", "(", "embedded", ".", "name", "(", ")", ")", ";", "}", "</s>"]
["<s>", "TypeName", "resolveAttributeType", "(", "AttributeDescriptor", "attribute", ")", "{", "TypeName", "typeName", ";", "if", "(", "attribute", ".", "isIterable", "(", ")", ")", "{", "typeName", "=", "parameterizedCollectionName", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "}", "else", "if", "(", "attribute", ".", "isOptional", "(", ")", ")", "{", "typeName", "=", "TypeName", ".", "get", "(", "tryFirstTypeArgument", "(", "attribute", ".", "typeMirror", "(", ")", ")", ")", ";", "}", "else", "{", "typeName", "=", "nameResolver", ".", "generatedTypeNameOf", "(", "attribute", ".", "typeMirror", "(", ")", ")", ".", "orElse", "(", "null", ")", ";", "}", "if", "(", "typeName", "=", "=", "null", ")", "{", "typeName", "=", "boxedTypeName", "(", "attribute", ".", "typeMirror", "(", ")", ")", ";", "}", "return", "typeName", ";", "}", "</s>"]
["<s>", "public", "static", "String", "checkIfAttributeNameNotForbidden", "(", "CharSequence", "newName", ",", "CharSequence", "fallback", ")", "{", "return", "SourceVersion", ".", "isName", "(", "newName", ")", "?", "newName", ".", "toString", "(", ")", ":", "fallback", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "AttributeBuilder", "<", "T", ",", "V", ">", "setDefinition", "(", "String", "definition", ")", "{", "this", ".", "definition", "=", "definition", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "String", "inlineBlobLiterals", "(", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "String", "[", "]", "parts", "=", "sql", ".", "split", "(", "\"", "<STR_LIT:\\\\>", "<STR_LIT:?>", "\"", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "parts", ".", "length", ";", "i", "+", "+", ")", "{", "sb", ".", "append", "(", "parts", "[", "i", "]", ")", ";", "if", "(", "blobLiterals", ".", "containsKey", "(", "i", "+", "1", ")", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "byteToHexString", "(", "blobLiterals", ".", "get", "(", "i", "+", "1", ")", ")", ")", ".", "append", "(", "\"", "'", "\"", ")", ";", "}", "else", "if", "(", "i", "<", "parts", ".", "length", "-", "1", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT:?>", "\"", ")", ";", "}", "}", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "String", "getSql", "(", ")", "{", "if", "(", "blobLiterals", "!", "=", "null", "&", "&", "!", "blobLiterals", ".", "values", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "return", "inlineBlobLiterals", "(", ")", ";", "}", "return", "sql", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertOneToManyInsert", "(", ")", "{", "Event", "event", "=", "new", "Event", "(", ")", ";", "UUID", "id", "=", "UUID", ".", "randomUUID", "(", ")", ";", "event", ".", "setId", "(", "id", ")", ";", "event", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Tag", "t1", "=", "new", "Tag", "(", ")", ";", "t1", ".", "setId", "(", "UUID", ".", "randomUUID", "(", ")", ")", ";", "Tag", "t2", "=", "new", "Tag", "(", ")", ";", "t2", ".", "setId", "(", "UUID", ".", "randomUUID", "(", ")", ")", ";", "event", ".", "getTags", "(", ")", ".", "add", "(", "t1", ")", ";", "event", ".", "getTags", "(", ")", ".", "add", "(", "t2", ")", ";", "data", ".", "insert", "(", "event", ")", ";", "HashSet", "<", "Tag", ">", "set", "=", "new", "HashSet", "<", ">", "(", "event", ".", "getTags", "(", ")", ")", ";", "assertEquals", "(", "<NUM_LIT:2>", ",", "set", ".", "size", "(", ")", ")", ";", "assertTrue", "(", "set", ".", "containsAll", "(", "Arrays", ".", "asList", "(", "t1", ",", "t2", ")", ")", ")", ";", "assertSame", "(", "<NUM_LIT:2>", ",", "data", ".", "select", "(", "Tag", ".", "class", ")", ".", "get", "(", ")", ".", "toList", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "<", "F", "extends", "E", ">", "QueryElement", "<", "F", ">", "extend", "(", "io", ".", "requery", ".", "util", ".", "function", ".", "Function", "<", "E", ",", "F", ">", "transform", ")", "{", "operator", "=", "new", "ExtendQueryOperation", "<", ">", "(", "transform", ",", "operator", ")", ";", "return", "(", "QueryElement", "<", "F", ">", ")", "this", ";", "}", "</s>"]
["<s>", "@", "CheckReturnValue", "public", "Observable", "<", "ReactiveResult", "<", "E", ">", ">", "observableResult", "(", ")", "{", "return", "ReactiveSupport", ".", "toObservableResult", "(", "this", ")", ";", "}", "</s>"]
["<s>", "static", "<", "T", ">", "Observable", "<", "ReactiveResult", "<", "T", ">", ">", "toObservableResult", "(", "final", "ReactiveResult", "<", "T", ">", "result", ")", "{", "final", "QueryElement", "<", "?", ">", "element", "=", "result", ".", "unwrapQuery", "(", ")", ";", "result", ".", "addTransactionListener", "(", "typeChanges", ")", ";", "return", "typeChanges", ".", "commitSubject", "(", ")", ".", "filter", "(", "new", "Predicate", "<", "Set", "<", "Type", "<", "?", ">", ">", ">", "(", ")", "{", "@", "Override", "public", "boolean", "test", "(", "Set", "<", "Type", "<", "?", ">", ">", "types", ")", "{", "return", "!", "Collections", ".", "disjoint", "(", "element", ".", "entityTypes", "(", ")", ",", "types", ")", "|", "|", "RxSupport", ".", "referencesType", "(", "element", ".", "entityTypes", "(", ")", ",", "types", ")", ";", "}", "}", ")", ".", "map", "(", "new", "Function", "<", "Set", "<", "Type", "<", "?", ">", ">", ",", "ReactiveResult", "<", "T", ">", ">", "(", ")", "{", "@", "Override", "public", "ReactiveResult", "<", "T", ">", "apply", "(", "Set", "<", "Type", "<", "?", ">", ">", "types", ")", "{", "return", "result", ";", "}", "}", ")", ".", "startWith", "(", "result", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "E", ">", "QueryElement", "<", "ReactiveResult", "<", "E", ">", ">", "result", "(", "Return", "<", "?", "extends", "Result", "<", "E", ">", ">", "query", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "QueryElement", "<", "Result", "<", "E", ">", ">", "element", "=", "(", "QueryElement", "<", "Result", "<", "E", ">", ">", ")", "query", ";", "return", "element", ".", "extend", "(", "new", "Function", "<", "Result", "<", "E", ">", ",", "ReactiveResult", "<", "E", ">", ">", "(", ")", "{", "@", "Override", "public", "ReactiveResult", "<", "E", ">", "apply", "(", "Result", "<", "E", ">", "result", ")", "{", "return", "new", "ReactiveResult", "<", ">", "(", "result", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "E", ">", "QueryElement", "<", "ReactiveScalar", "<", "E", ">", ">", "scalar", "(", "Return", "<", "?", "extends", "Scalar", "<", "E", ">", ">", "query", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "QueryElement", "<", "Scalar", "<", "E", ">", ">", "element", "=", "(", "QueryElement", "<", "Scalar", "<", "E", ">", ">", ")", "query", ";", "return", "element", ".", "extend", "(", "new", "Function", "<", "Scalar", "<", "E", ">", ",", "ReactiveScalar", "<", "E", ">", ">", "(", ")", "{", "@", "Override", "public", "ReactiveScalar", "<", "E", ">", "apply", "(", "Scalar", "<", "E", ">", "result", ")", "{", "return", "new", "ReactiveScalar", "<", ">", "(", "result", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "CheckReturnValue", "public", "Observable", "<", "E", ">", "toObservable", "(", ")", "{", "return", "Observable", ".", "create", "(", "new", "OnSubscribeFromQuery", "<", ">", "(", "this", ")", ")", ";", "}", "</s>"]
["<s>", "@", "CheckReturnValue", "public", "Observable", "<", "RxResult", "<", "E", ">", ">", "toSelfObservable", "(", ")", "{", "return", "RxSupport", ".", "toResultObservable", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "CheckReturnValue", "public", "rx", ".", "Single", "<", "E", ">", "toSingle", "(", ")", "{", "return", "Single", ".", "fromCallable", "(", "this", ")", ";", "}", "</s>"]
["<s>", "static", "<", "T", ">", "Observable", "<", "RxResult", "<", "T", ">", ">", "toResultObservable", "(", "final", "RxResult", "<", "T", ">", "result", ")", "{", "final", "QueryElement", "<", "?", ">", "element", "=", "result", ".", "unwrapQuery", "(", ")", ";", "result", ".", "addTransactionListener", "(", "typeChanges", ")", ";", "return", "typeChanges", ".", "commitSubject", "(", ")", ".", "filter", "(", "new", "Func1", "<", "Set", "<", "Type", "<", "?", ">", ">", ",", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "call", "(", "Set", "<", "Type", "<", "?", ">", ">", "types", ")", "{", "return", "!", "Collections", ".", "disjoint", "(", "element", ".", "entityTypes", "(", ")", ",", "types", ")", "|", "|", "referencesType", "(", "element", ".", "entityTypes", "(", ")", ",", "types", ")", ";", "}", "}", ")", ".", "map", "(", "new", "Func1", "<", "Set", "<", "Type", "<", "?", ">", ">", ",", "RxResult", "<", "T", ">", ">", "(", ")", "{", "@", "Override", "public", "RxResult", "<", "T", ">", "call", "(", "Set", "<", "Type", "<", "?", ">", ">", "types", ")", "{", "return", "result", ";", "}", "}", ")", ".", "startWith", "(", "result", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "E", ">", "QueryElement", "<", "RxResult", "<", "E", ">", ">", "result", "(", "Return", "<", "?", "extends", "Result", "<", "E", ">", ">", "query", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "QueryElement", "<", "Result", "<", "E", ">", ">", "element", "=", "(", "QueryElement", "<", "Result", "<", "E", ">", ">", ")", "query", ";", "return", "element", ".", "extend", "(", "new", "Function", "<", "Result", "<", "E", ">", ",", "RxResult", "<", "E", ">", ">", "(", ")", "{", "@", "Override", "public", "RxResult", "<", "E", ">", "apply", "(", "Result", "<", "E", ">", "result", ")", "{", "return", "new", "RxResult", "<", ">", "(", "result", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "E", ">", "QueryElement", "<", "RxScalar", "<", "E", ">", ">", "scalar", "(", "Return", "<", "?", "extends", "Scalar", "<", "E", ">", ">", "query", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "QueryElement", "<", "Scalar", "<", "E", ">", ">", "element", "=", "(", "QueryElement", "<", "Scalar", "<", "E", ">", ">", ")", "query", ";", "return", "element", ".", "extend", "(", "new", "Function", "<", "Scalar", "<", "E", ">", ",", "RxScalar", "<", "E", ">", ">", "(", ")", "{", "@", "Override", "public", "RxScalar", "<", "E", ">", "apply", "(", "Scalar", "<", "E", ">", "result", ")", "{", "return", "new", "RxScalar", "<", ">", "(", "result", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setup", "(", ")", "throws", "SQLException", "{", "Platform", "platform", "=", "new", "HSQL", "(", ")", ";", "CommonDataSource", "dataSource", "=", "DatabaseType", ".", "getDataSource", "(", "platform", ")", ";", "EntityModel", "model", "=", "io", ".", "requery", ".", "test", ".", "model", ".", "Models", ".", "DEFAULT", ";", "CachingProvider", "provider", "=", "Caching", ".", "getCachingProvider", "(", ")", ";", "CacheManager", "cacheManager", "=", "provider", ".", "getCacheManager", "(", ")", ";", "Configuration", "configuration", "=", "new", "ConfigurationBuilder", "(", "dataSource", ",", "model", ")", ".", "useDefaultLogging", "(", ")", ".", "setWriteExecutor", "(", "Executors", ".", "newSingleThreadExecutor", "(", ")", ")", ".", "setEntityCache", "(", "new", "EntityCacheBuilder", "(", "model", ")", ".", "useReferenceCache", "(", "true", ")", ".", "useSerializableCache", "(", "true", ")", ".", "useCacheManager", "(", "cacheManager", ")", ".", "build", "(", ")", ")", ".", "build", "(", ")", ";", "SchemaModifier", "tables", "=", "new", "SchemaModifier", "(", "configuration", ")", ";", "tables", ".", "createTables", "(", "TableCreationMode", ".", "DROP_CREATE", ")", ";", "data", "=", "new", "ReactorEntityStore", "<", ">", "(", "new", "EntityDataStore", "<", "Persistable", ">", "(", "configuration", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelete", "(", ")", "throws", "Exception", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "block", "(", ")", ";", "data", ".", "delete", "(", "person", ")", ".", "block", "(", ")", ";", "Person", "cached", "=", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "where", "(", "Person", ".", "ID", ".", "equal", "(", "person", ".", "getId", "(", ")", ")", ")", ".", "get", "(", ")", ".", "firstOrNull", "(", ")", ";", "assertNull", "(", "cached", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertCount", "(", ")", "throws", "Exception", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "Flux", ".", "just", "(", "person", ")", ".", "concatMap", "(", "new", "Function", "<", "Person", ",", "Flux", "<", "Person", ">", ">", "(", ")", "{", "@", "Override", "public", "Flux", "<", "Person", ">", "apply", "(", "Person", "person", ")", "{", "return", "data", ".", "insert", "(", "person", ")", ".", "flux", "(", ")", ";", "}", "}", ")", ";", "Person", "p", "=", "data", ".", "insert", "(", "person", ")", ".", "block", "(", ")", ";", "assertTrue", "(", "p", ".", "getId", "(", ")", ">", "0", ")", ";", "int", "count", "=", "data", ".", "count", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "mono", "(", ")", ".", "block", "(", ")", ";", "assertEquals", "(", "1", ",", "count", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertOneToMany", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "map", "(", "new", "Function", "<", "Person", ",", "Phone", ">", "(", ")", "{", "@", "Override", "public", "Phone", "apply", "(", "Person", "person", ")", "{", "Phone", "phone1", "=", "randomPhone", "(", ")", ";", "phone1", ".", "setOwner", "(", "person", ")", ";", "return", "phone1", ";", "}", "}", ")", ".", "flatMap", "(", "new", "Function", "<", "Phone", ",", "Mono", "<", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "Mono", "<", "?", ">", "apply", "(", "Phone", "phone", ")", "{", "return", "data", ".", "insert", "(", "phone", ")", ";", "}", "}", ")", ".", "blockFirst", "(", ")", ";", "assertTrue", "(", "person", ".", "getPhoneNumbers", "(", ")", ".", "toList", "(", ")", ".", "size", "(", ")", "=", "=", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryEmpty", "(", ")", "throws", "Exception", "{", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "flux", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Person", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Person", "person", ")", "{", "Assert", ".", "fail", "(", ")", ";", "}", "}", ",", "new", "Consumer", "<", "Throwable", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Throwable", "throwable", ")", "{", "Assert", ".", "fail", "(", ")", ";", "}", "}", ",", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "latch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "if", "(", "!", "latch", ".", "await", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ")", "{", "Assert", ".", "fail", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryObservable", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:30>", ";", "i", "+", "+", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "block", "(", ")", ";", "}", "final", "List", "<", "Person", ">", "people", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "limit", "(", "<NUM_LIT>", ")", ".", "get", "(", ")", ".", "flux", "(", ")", ".", "subscribe", "(", "new", "Consumer", "<", "Person", ">", "(", ")", "{", "@", "Override", "public", "void", "accept", "(", "Person", "person", ")", "{", "people", ".", "add", "(", "person", ")", ";", "}", "}", ")", ";", "assertEquals", "(", "<NUM_LIT:30>", ",", "people", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryObservableFromEntity", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "map", "(", "new", "Function", "<", "Person", ",", "Phone", ">", "(", ")", "{", "@", "Override", "public", "Phone", "apply", "(", "Person", "person", ")", "{", "Phone", "phone1", "=", "randomPhone", "(", ")", ";", "phone1", ".", "setOwner", "(", "person", ")", ";", "return", "phone1", ";", "}", "}", ")", ".", "flatMap", "(", "new", "Function", "<", "Phone", ",", "Mono", "<", "?", ">", ">", "(", ")", "{", "@", "Override", "public", "Mono", "<", "?", ">", "apply", "(", "Phone", "phone", ")", "{", "return", "data", ".", "insert", "(", "phone", ")", ";", "}", "}", ")", ".", "blockFirst", "(", ")", ";", "int", "count", "=", "person", ".", "getPhoneNumbers", "(", ")", ".", "toList", "(", ")", ".", "size", "(", ")", ";", "assertEquals", "(", "1", ",", "count", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryObservablePull", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT>", ";", "i", "+", "+", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ".", "block", "(", ")", ";", "}", "final", "List", "<", "Person", ">", "people", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "flux", "(", ")", ".", "subscribe", "(", "new", "Subscriber", "<", "Person", ">", "(", ")", "{", "Subscription", "s", ";", "@", "Override", "public", "void", "onSubscribe", "(", "Subscription", "s", ")", "{", "this", ".", "s", "=", "s", ";", "s", ".", "request", "(", "<NUM_LIT:10>", ")", ";", "}", "@", "Override", "public", "void", "onComplete", "(", ")", "{", "}", "@", "Override", "public", "void", "onError", "(", "Throwable", "e", ")", "{", "}", "@", "Override", "public", "void", "onNext", "(", "Person", "person", ")", "{", "people", ".", "add", "(", "person", ")", ";", "if", "(", "people", ".", "size", "(", ")", "%", "<NUM_LIT:10>", "=", "=", "0", "&", "&", "people", ".", "size", "(", ")", ">", "1", ")", "{", "s", ".", "request", "(", "<NUM_LIT:10>", ")", ";", "}", "}", "}", ")", ";", "assertEquals", "(", "<NUM_LIT>", ",", "people", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "long", "add", "(", "AtomicLong", "requested", ",", "long", "n", ")", "{", "while", "(", "true", ")", "{", "long", "value", "=", "requested", ".", "get", "(", ")", ";", "if", "(", "value", "=", "=", "Long", ".", "MAX_VALUE", ")", "{", "return", "Long", ".", "MAX_VALUE", ";", "}", "long", "update", "=", "value", "+", "n", ";", "if", "(", "update", "<", "0", "L", ")", "{", "update", "=", "Long", ".", "MAX_VALUE", ";", "}", "if", "(", "requested", ".", "compareAndSet", "(", "value", ",", "update", ")", ")", "{", "return", "value", ";", "}", "}", "}", "</s>"]
["<s>", "private", "static", "<", "E", ">", "QueryElement", "<", "ReactorResult", "<", "E", ">", ">", "result", "(", "Return", "<", "?", "extends", "Result", "<", "E", ">", ">", "query", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "QueryElement", "<", "Result", "<", "E", ">", ">", "element", "=", "(", "QueryElement", "<", "Result", "<", "E", ">", ">", ")", "query", ";", "return", "element", ".", "extend", "(", "new", "Function", "<", "Result", "<", "E", ">", ",", "ReactorResult", "<", "E", ">", ">", "(", ")", "{", "@", "Override", "public", "ReactorResult", "<", "E", ">", "apply", "(", "Result", "<", "E", ">", "result", ")", "{", "return", "new", "ReactorResult", "<", ">", "(", "result", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "E", ">", "QueryElement", "<", "ReactorScalar", "<", "E", ">", ">", "scalar", "(", "Return", "<", "?", "extends", "Scalar", "<", "E", ">", ">", "query", ")", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "QueryElement", "<", "Scalar", "<", "E", ">", ">", "element", "=", "(", "QueryElement", "<", "Scalar", "<", "E", ">", ">", ")", "query", ";", "return", "element", ".", "extend", "(", "new", "Function", "<", "Scalar", "<", "E", ">", ",", "ReactorScalar", "<", "E", ">", ">", "(", ")", "{", "@", "Override", "public", "ReactorScalar", "<", "E", ">", "apply", "(", "Scalar", "<", "E", ">", "result", ")", "{", "return", "new", "ReactorScalar", "<", ">", "(", "result", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "CheckReturnValue", "public", "Flux", "<", "E", ">", "flux", "(", ")", "{", "return", "Flux", ".", "from", "(", "new", "Publisher", "<", "E", ">", "(", ")", "{", "@", "Override", "public", "void", "subscribe", "(", "Subscriber", "<", "?", "super", "E", ">", "s", ")", "{", "s", ".", "onSubscribe", "(", "new", "QuerySubscription", "<", ">", "(", "ReactorResult", ".", "this", ",", "s", ")", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "CheckReturnValue", "public", "Mono", "<", "E", ">", "mono", "(", ")", "{", "return", "Mono", ".", "fromCallable", "(", "this", ")", ";", "}", "</s>"]
["<s>", "private", "void", "generateCopy", "(", "TypeSpec", ".", "Builder", "builder", ")", "{", "if", "(", "!", "Mirrors", ".", "overridesMethod", "(", "types", ",", "typeElement", ",", "\"", "<STR_LIT>", "\"", ")", ")", "{", "MethodSpec", ".", "Builder", "copy", "=", "MethodSpec", ".", "methodBuilder", "(", "\"", "<STR_LIT>", "\"", ")", ".", "addModifiers", "(", "Modifier", ".", "PUBLIC", ")", ".", "returns", "(", "typeName", ")", ".", "addStatement", "(", "\"", "<STR_LIT>", "\"", ",", "PROXY_NAME", ")", ";", "builder", ".", "addMethod", "(", "copy", ".", "build", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCopy", "(", ")", "{", "Address", "address", "=", "new", "Address", "(", ")", ";", "address", ".", "setCity", "(", "\"", "<STR_LIT>", "\"", ")", ";", "address", ".", "setState", "(", "\"", "<STR_LIT>", "\"", ")", ";", "address", ".", "setCountry", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Address", "copy", "=", "address", ".", "copy", "(", ")", ";", "assertEquals", "(", "address", ".", "getCity", "(", ")", ",", "copy", ".", "getCity", "(", ")", ")", ";", "assertEquals", "(", "address", ".", "getState", "(", ")", ",", "copy", ".", "getState", "(", ")", ")", ";", "assertEquals", "(", "address", ".", "getCountry", "(", ")", ",", "copy", ".", "getCountry", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "E", "copy", "(", ")", "{", "E", "copy", "=", "type", ".", "getFactory", "(", ")", ".", "get", "(", ")", ";", "EntityProxy", "<", "E", ">", "proxy", "=", "type", ".", "getProxyProvider", "(", ")", ".", "apply", "(", "copy", ")", ";", "proxy", ".", "link", "(", "loader", ")", ";", "for", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ":", "type", ".", "getAttributes", "(", ")", ")", "{", "if", "(", "!", "attribute", ".", "isAssociation", "(", ")", ")", "{", "PropertyState", "state", "=", "getState", "(", "attribute", ")", ";", "if", "(", "state", "=", "=", "PropertyState", ".", "LOADED", "|", "|", "state", "=", "=", "PropertyState", ".", "MODIFIED", ")", "{", "Object", "value", "=", "get", "(", "attribute", ",", "false", ")", ";", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Attribute", "<", "E", ",", "Object", ">", "a", "=", "(", "Attribute", "<", "E", ",", "Object", ">", ")", "attribute", ";", "proxy", ".", "set", "(", "a", ",", "value", ",", "state", ")", ";", "}", "}", "}", "return", "copy", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testConverter", "(", ")", "{", "Phone", "phone", "=", "randomPhone", "(", ")", ";", "phone", ".", "getExtensions", "(", ")", ".", "add", "(", "1", ")", ";", "phone", ".", "getExtensions", "(", ")", ".", "add", "(", "<NUM_LIT>", ")", ";", "data", ".", "insert", "(", "phone", ")", ";", "Phone", "result", "=", "data", ".", "select", "(", "Phone", ".", "class", ")", ".", "where", "(", "Phone", ".", "EXTENSIONS", ".", "eq", "(", "phone", ".", "getExtensions", "(", ")", ")", ")", ".", "get", "(", ")", ".", "first", "(", ")", ";", "assertSame", "(", "phone", ",", "result", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Object", "getKey", "(", "Attribute", "<", "E", ",", "?", ">", "attribute", ")", "{", "if", "(", "attribute", ".", "isAssociation", "(", ")", ")", "{", "Attribute", "referenced", "=", "attribute", ".", "getReferencedAttribute", "(", ")", ".", "get", "(", ")", ";", "Object", "association", "=", "get", "(", "attribute", ")", ";", "if", "(", "association", "!", "=", "null", ")", "{", "Type", "<", "Object", ">", "type", "=", "referenced", ".", "getDeclaringType", "(", ")", ";", "EntityProxy", "proxy", "=", "type", ".", "getProxyProvider", "(", ")", ".", "apply", "(", "association", ")", ";", "return", "proxy", "=", "=", "null", "?", "null", ":", "proxy", ".", "get", "(", "referenced", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "return", "get", "(", "attribute", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertWithTransactionCallableRollback", "(", ")", "{", "boolean", "rolledBack", "=", "false", ";", "try", "{", "data", ".", "runInTransaction", "(", "new", "Callable", "<", "String", ">", "(", ")", "{", "@", "Override", "public", "String", "call", "(", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "assertTrue", "(", "person", ".", "getId", "(", ")", ">", "0", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ",", "TransactionIsolation", ".", "SERIALIZABLE", ")", ";", "}", "catch", "(", "RollbackException", "e", ")", "{", "rolledBack", "=", "true", ";", "assertSame", "(", "0", ",", "data", ".", "select", "(", "Person", ".", "class", ")", ".", "get", "(", ")", ".", "toList", "(", ")", ".", "size", "(", ")", ")", ";", "}", "assertTrue", "(", "rolledBack", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testVersionUpdate", "(", ")", "{", "Group", "group", "=", "new", "Group", "(", ")", ";", "group", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "data", ".", "insert", "(", "group", ")", ";", "int", "version", "=", "0", ";", "assertTrue", "(", "(", "version", "=", "group", ".", "getVersion", "(", ")", ")", ">", "0", ")", ";", "group", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "data", ".", "update", "(", "group", ")", ";", "assertTrue", "(", "group", ".", "getVersion", "(", ")", ">", "version", ")", ";", "version", "=", "group", ".", "getVersion", "(", ")", ";", "group", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "data", ".", "update", "(", "group", ")", ";", "assertTrue", "(", "group", ".", "getVersion", "(", ")", ">", "version", ")", ";", "}", "</s>"]
["<s>", "public", "TypeBuilder", "<", "T", ">", "setView", "(", "boolean", "isView", ")", "{", "this", ".", "isView", "=", "isView", ";", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testQueryOrderByFunction", "(", ")", "{", "Person", "person", "=", "randomPerson", "(", ")", ";", "person", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "person", "=", "randomPerson", "(", ")", ";", "person", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "person", "=", "randomPerson", "(", ")", ";", "person", ".", "setName", "(", "\"", "<STR_LIT:C>", "\"", ")", ";", "data", ".", "insert", "(", "person", ")", ";", "List", "<", "Tuple", ">", "list", "=", "data", ".", "select", "(", "Person", ".", "NAME", ")", ".", "orderBy", "(", "Upper", ".", "upper", "(", "Person", ".", "NAME", ")", ".", "desc", "(", ")", ")", ".", "get", "(", ")", ".", "toList", "(", ")", ";", "assertTrue", "(", "list", ".", "get", "(", "0", ")", ".", "get", "(", "0", ")", ".", "equals", "(", "\"", "<STR_LIT:C>", "\"", ")", ")", ";", "assertTrue", "(", "list", ".", "get", "(", "1", ")", ".", "get", "(", "0", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertTrue", "(", "list", ".", "get", "(", "<NUM_LIT:2>", ")", ".", "get", "(", "0", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "private", "PropertyName", "getMappedName", "(", "Annotated", "annotated", ")", "{", "if", "(", "annotated", ".", "hasAnnotation", "(", "Table", ".", "class", ")", ")", "{", "Table", "table", "=", "annotated", ".", "getAnnotation", "(", "Table", ".", "class", ")", ";", "return", "new", "PropertyName", "(", "table", ".", "name", "(", ")", ")", ";", "}", "if", "(", "annotated", ".", "hasAnnotation", "(", "View", ".", "class", ")", ")", "{", "View", "view", "=", "annotated", ".", "getAnnotation", "(", "View", ".", "class", ")", ";", "return", "new", "PropertyName", "(", "view", ".", "name", "(", ")", ")", ";", "}", "else", "if", "(", "annotated", ".", "hasAnnotation", "(", "Column", ".", "class", ")", ")", "{", "Column", "column", "=", "annotated", ".", "getAnnotation", "(", "Column", ".", "class", ")", ";", "return", "new", "PropertyName", "(", "column", ".", "name", "(", ")", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setup", "(", ")", "throws", "SQLException", "{", "CommonDataSource", "dataSource", "=", "DatabaseType", ".", "getDataSource", "(", "new", "SQLite", "(", ")", ")", ";", "EntityModel", "model", "=", "Models", ".", "MODEL3", ";", "Configuration", "configuration", "=", "new", "ConfigurationBuilder", "(", "dataSource", ",", "model", ")", ".", "useDefaultLogging", "(", ")", ".", "setEntityCache", "(", "new", "WeakEntityCache", "(", ")", ")", ".", "setWriteExecutor", "(", "Executors", ".", "newSingleThreadExecutor", "(", ")", ")", ".", "build", "(", ")", ";", "SchemaModifier", "tables", "=", "new", "SchemaModifier", "(", "configuration", ")", ";", "tables", ".", "createTables", "(", "TableCreationMode", ".", "DROP_CREATE", ")", ";", "data", "=", "new", "EntityDataStore", "<", ">", "(", "configuration", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testOneToManySerialize", "(", ")", "{", "Event", "event", "=", "new", "Event", "(", ")", ";", "UUID", "id", "=", "UUID", ".", "randomUUID", "(", ")", ";", "event", ".", "setId", "(", "id", ")", ";", "event", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Tag", "t1", "=", "new", "Tag", "(", ")", ";", "t1", ".", "setId", "(", "UUID", ".", "randomUUID", "(", ")", ")", ";", "Tag", "t2", "=", "new", "Tag", "(", ")", ";", "t2", ".", "setId", "(", "UUID", ".", "randomUUID", "(", ")", ")", ";", "event", ".", "getTags", "(", ")", ".", "add", "(", "t1", ")", ";", "event", ".", "getTags", "(", ")", ".", "add", "(", "t2", ")", ";", "Place", "p", "=", "new", "Place", "(", ")", ";", "p", ".", "setId", "(", "\"", "<STR_LIT>", "\"", ")", ";", "p", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "event", ".", "setPlace", "(", "p", ")", ";", "data", ".", "insert", "(", "event", ")", ";", "ObjectMapper", "mapper", "=", "new", "EntityMapper", "(", "Models", ".", "MODEL3", ",", "data", ")", ";", "StringWriter", "writer", "=", "new", "StringWriter", "(", ")", ";", "try", "{", "mapper", ".", "writeValue", "(", "writer", ",", "event", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "String", "value", "=", "writer", ".", "toString", "(", ")", ";", "System", ".", "out", ".", "println", "(", "value", ")", ";", "try", "{", "Event", "read", "=", "mapper", ".", "readValue", "(", "value", ",", "Event", ".", "class", ")", ";", "assertSame", "(", "event", ",", "read", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testManyToManySerialize", "(", ")", "{", "Tag", "t1", "=", "new", "Tag", "(", ")", ";", "t1", ".", "setId", "(", "UUID", ".", "randomUUID", "(", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:3>", ";", "i", "+", "+", ")", "{", "Event", "event", "=", "new", "Event", "(", ")", ";", "UUID", "id", "=", "UUID", ".", "randomUUID", "(", ")", ";", "event", ".", "setId", "(", "id", ")", ";", "event", ".", "setName", "(", "\"", "<STR_LIT>", "\"", "+", "i", ")", ";", "t1", ".", "getEvents", "(", ")", ".", "add", "(", "event", ")", ";", "}", "data", ".", "insert", "(", "t1", ")", ";", "ObjectMapper", "mapper", "=", "new", "EntityMapper", "(", "Models", ".", "MODEL3", ",", "data", ")", ";", "StringWriter", "writer", "=", "new", "StringWriter", "(", ")", ";", "try", "{", "mapper", ".", "writeValue", "(", "writer", ",", "t1", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "String", "value", "=", "writer", ".", "toString", "(", ")", ";", "System", ".", "out", ".", "println", "(", "value", ")", ";", "try", "{", "Tag", "tag", "=", "mapper", ".", "readValue", "(", "value", ",", "Tag", ".", "class", ")", ";", "assertSame", "(", "t1", ",", "tag", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "static", "Optional", "<", "ImmutableAnnotationKind", ">", "of", "(", "Element", "element", ")", "{", "return", "Stream", ".", "of", "(", "ImmutableAnnotationKind", ".", "values", "(", ")", ")", ".", "filter", "(", "type", "-", ">", "type", ".", "isPresent", "(", "element", ")", ")", ".", "findFirst", "(", ")", ";", "}", "</s>"]
["<s>", "String", "getAnnotationName", "(", ")", "{", "return", "annotationName", ";", "}", "</s>"]
