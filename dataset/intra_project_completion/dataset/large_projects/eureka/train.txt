["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "{", "DynamicPropertyFactory", "configInstance", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ";", "ApplicationInfoManager", "applicationInfoManager", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ";", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "initComponent", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ",", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "EurekaClient", "eurekaClient", "=", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ";", "ExampleServiceBase", "exampleServiceBase", "=", "new", "ExampleServiceBase", "(", "applicationInfoManager", ",", "eurekaClient", ",", "configInstance", ")", ";", "try", "{", "exampleServiceBase", ".", "start", "(", ")", ";", "}", "finally", "{", "exampleServiceBase", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Inject", "public", "ExampleServiceBase", "(", "ApplicationInfoManager", "applicationInfoManager", ",", "EurekaClient", "eurekaClient", ",", "DynamicPropertyFactory", "configInstance", ")", "{", "this", ".", "applicationInfoManager", "=", "applicationInfoManager", ";", "this", ".", "eurekaClient", "=", "eurekaClient", ";", "this", ".", "configInstance", "=", "configInstance", ";", "}", "</s>"]
["<s>", "@", "PostConstruct", "public", "void", "start", "(", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "STARTING", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "waitForRegistrationWithEureka", "(", "eurekaClient", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "ServerSocket", "serverSocket", "=", "new", "ServerSocket", "(", "configInstance", ".", "getIntProperty", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ")", ";", "final", "Socket", "s", "=", "serverSocket", ".", "accept", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "processRequest", "(", "s", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "<NUM_LIT:10>", "+", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", "*", "<NUM_LIT:1000>", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "stop", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "PreDestroy", "public", "void", "stop", "(", ")", "{", "if", "(", "eurekaClient", "!", "=", "null", ")", "{", "eurekaClient", ".", "shutdown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "waitForRegistrationWithEureka", "(", "EurekaClient", "eurekaClient", ")", "{", "String", "vipAddress", "=", "configInstance", ".", "getStringProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "InstanceInfo", "nextServerInfo", "=", "null", ";", "while", "(", "nextServerInfo", "=", "=", "null", ")", "{", "try", "{", "nextServerInfo", "=", "eurekaClient", ".", "getNextServerFromEureka", "(", "vipAddress", ",", "false", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "catch", "(", "InterruptedException", "e1", ")", "{", "e1", ".", "printStackTrace", "(", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "void", "processRequest", "(", "final", "Socket", "s", ")", "{", "try", "{", "BufferedReader", "rd", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "s", ".", "getInputStream", "(", ")", ")", ")", ";", "String", "line", "=", "rd", ".", "readLine", "(", ")", ";", "if", "(", "line", "!", "=", "null", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "line", ")", ";", "}", "String", "response", "=", "\"", "<STR_LIT>", "\"", "+", "new", "Date", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "response", ")", ";", "PrintStream", "out", "=", "new", "PrintStream", "(", "s", ".", "getOutputStream", "(", ")", ")", ";", "out", ".", "println", "(", "response", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "if", "(", "s", "!", "=", "null", ")", "{", "try", "{", "s", ".", "close", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "ExampleServiceBase", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "LifecycleInjector", "init", "(", ")", "throws", "Exception", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LifecycleInjector", "injector", "=", "Governator", ".", "createInjector", "(", "Modules", ".", "override", "(", "new", "EurekaModule", "(", ")", ")", ".", "with", "(", "new", "AbstractModule", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "DynamicPropertyFactory", "configInstance", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ";", "bind", "(", "DynamicPropertyFactory", ".", "class", ")", ".", "toInstance", "(", "configInstance", ")", ";", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "to", "(", "MyDataCenterInstanceConfig", ".", "class", ")", ";", "}", "}", ")", ",", "new", "ExampleServiceModule", "(", ")", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "injector", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "DynamicPropertyFactory", "configInstance", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ";", "bind", "(", "DynamicPropertyFactory", ".", "class", ")", ".", "toInstance", "(", "configInstance", ")", ";", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "to", "(", "MyDataCenterInstanceConfig", ".", "class", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "LifecycleInjector", "injector", "=", "null", ";", "try", "{", "injector", "=", "init", "(", ")", ";", "injector", ".", "awaitTermination", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "e", ")", ";", "e", ".", "printStackTrace", "(", ")", ";", "}", "finally", "{", "if", "(", "injector", "!", "=", "null", ")", "{", "injector", ".", "shutdown", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "sendRequestToServiceUsingEureka", "(", ")", "{", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "initComponent", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ",", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "String", "vipAddress", "=", "\"", "<STR_LIT>", "\"", ";", "InstanceInfo", "nextServerInfo", "=", "null", ";", "try", "{", "nextServerInfo", "=", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ".", "getNextServerFromEureka", "(", "vipAddress", ",", "false", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "exit", "(", "-", "1", ")", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "nextServerInfo", ".", "getVIPAddress", "(", ")", "+", "\"", "<STR_LIT::>", "\"", "+", "nextServerInfo", ".", "getPort", "(", ")", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "nextServerInfo", ".", "getHealthCheckUrl", "(", ")", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "nextServerInfo", ".", "getOverriddenStatus", "(", ")", ")", ";", "Socket", "s", "=", "new", "Socket", "(", ")", ";", "int", "serverPort", "=", "nextServerInfo", ".", "getPort", "(", ")", ";", "try", "{", "s", ".", "connect", "(", "new", "InetSocketAddress", "(", "nextServerInfo", ".", "getHostName", "(", ")", ",", "serverPort", ")", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "nextServerInfo", ".", "getHostName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "serverPort", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "nextServerInfo", ".", "getHostName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "serverPort", "+", "\"", "<STR_LIT>", "\"", "+", "e", ")", ";", "}", "try", "{", "String", "request", "=", "\"", "<STR_LIT>", "\"", "+", "new", "Date", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "request", ")", ";", "PrintStream", "out", "=", "new", "PrintStream", "(", "s", ".", "getOutputStream", "(", ")", ")", ";", "out", ".", "println", "(", "request", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "BufferedReader", "rd", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "s", ".", "getInputStream", "(", ")", ")", ")", ";", "String", "str", "=", "rd", ".", "readLine", "(", ")", ";", "if", "(", "str", "!", "=", "null", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "str", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "rd", ".", "close", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "{", "ExampleEurekaClient", "sampleClient", "=", "new", "ExampleEurekaClient", "(", ")", ";", "sampleClient", ".", "sendRequestToServiceUsingEureka", "(", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeClass", "public", "static", "void", "setUp", "(", ")", "throws", "Exception", "{", "injectEurekaConfiguration", "(", ")", ";", "startServer", "(", ")", ";", "createEurekaServerConfig", "(", ")", ";", "jerseyEurekaClient", "=", "new", "JerseyEurekaHttpClient", "(", "eurekaServiceUrl", ")", "{", "public", "EurekaJerseyClient", "jerseyClient", ";", "@", "Override", "protected", "ApacheHttpClient4", "getJerseyClient", "(", ")", "{", "jerseyClient", "=", "new", "EurekaJerseyClientBuilder", "(", ")", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withConnectionTimeout", "(", "<NUM_LIT:1000>", ")", ".", "withReadTimeout", "(", "<NUM_LIT:1000>", ")", ".", "withMaxConnectionsPerHost", "(", "1", ")", ".", "withMaxTotalConnections", "(", "1", ")", ".", "withConnectionIdleTimeout", "(", "<NUM_LIT:1000>", ")", ".", "build", "(", ")", ";", "ApacheHttpClient4", "jerseyApacheClient", "=", "jerseyClient", ".", "getClient", "(", ")", ";", "jerseyApacheClient", ".", "addFilter", "(", "new", "GZIPContentEncodingFilter", "(", "true", ")", ")", ";", "return", "jerseyApacheClient", ";", "}", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "super", ".", "shutdown", "(", ")", ";", "jerseyClient", ".", "destroyResources", "(", ")", ";", "}", "}", ";", "ServerCodecs", "serverCodecs", "=", "new", "DefaultServerCodecs", "(", "eurekaServerConfig", ")", ";", "jerseyReplicationClient", "=", "new", "JerseyReplicationClient", "(", "eurekaServerConfig", ",", "serverCodecs", ",", "eurekaServiceUrl", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "ApacheHttpClient4", "getJerseyClient", "(", ")", "{", "jerseyClient", "=", "new", "EurekaJerseyClientBuilder", "(", ")", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withConnectionTimeout", "(", "<NUM_LIT:1000>", ")", ".", "withReadTimeout", "(", "<NUM_LIT:1000>", ")", ".", "withMaxConnectionsPerHost", "(", "1", ")", ".", "withMaxTotalConnections", "(", "1", ")", ".", "withConnectionIdleTimeout", "(", "<NUM_LIT:1000>", ")", ".", "build", "(", ")", ";", "ApacheHttpClient4", "jerseyApacheClient", "=", "jerseyClient", ".", "getClient", "(", ")", ";", "jerseyApacheClient", ".", "addFilter", "(", "new", "GZIPContentEncodingFilter", "(", "true", ")", ")", ";", "return", "jerseyApacheClient", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "super", ".", "shutdown", "(", ")", ";", "jerseyClient", ".", "destroyResources", "(", ")", ";", "}", "</s>"]
["<s>", "@", "AfterClass", "public", "static", "void", "tearDown", "(", ")", "throws", "Exception", "{", "removeEurekaConfiguration", "(", ")", ";", "if", "(", "jerseyReplicationClient", "!", "=", "null", ")", "{", "jerseyReplicationClient", ".", "shutdown", "(", ")", ";", "}", "if", "(", "server", "!", "=", "null", ")", "{", "server", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRegistration", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "HttpResponse", "<", "Void", ">", "httpResponse", "=", "jerseyEurekaClient", ".", "register", "(", "instanceInfo", ")", ";", "assertThat", "(", "httpResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeat", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "jerseyEurekaClient", ".", "register", "(", "instanceInfo", ")", ";", "HttpResponse", "<", "InstanceInfo", ">", "heartBeatResponse", "=", "jerseyReplicationClient", ".", "sendHeartBeat", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ",", "null", ")", ";", "assertThat", "(", "heartBeatResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "heartBeatResponse", ".", "getEntity", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMissedHeartbeat", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "HttpResponse", "<", "InstanceInfo", ">", "heartBeatResponse", "=", "jerseyReplicationClient", ".", "sendHeartBeat", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ",", "null", ")", ";", "assertThat", "(", "heartBeatResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelForEntryThatExists", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "jerseyEurekaClient", ".", "register", "(", "instanceInfo", ")", ";", "HttpResponse", "<", "Void", ">", "httpResponse", "=", "jerseyEurekaClient", ".", "cancel", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "httpResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelForEntryThatDoesNotExist", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "HttpResponse", "<", "Void", ">", "httpResponse", "=", "jerseyEurekaClient", ".", "cancel", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "httpResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusOverrideUpdateAndDelete", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "jerseyEurekaClient", ".", "register", "(", "instanceInfo", ")", ";", "HttpResponse", "<", "Void", ">", "overrideUpdateResponse", "=", "jerseyEurekaClient", ".", "statusUpdate", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "DOWN", ",", "instanceInfo", ")", ";", "assertThat", "(", "overrideUpdateResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "InstanceInfo", "fetchedInstance", "=", "expectInstanceInfoInRegistry", "(", "instanceInfo", ")", ";", "assertThat", "(", "fetchedInstance", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "InstanceStatus", ".", "DOWN", ")", ")", ")", ";", "HttpResponse", "<", "Void", ">", "deleteOverrideResponse", "=", "jerseyEurekaClient", ".", "deleteStatusOverride", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ")", ";", "assertThat", "(", "deleteOverrideResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "fetchedInstance", "=", "expectInstanceInfoInRegistry", "(", "instanceInfo", ")", ";", "assertThat", "(", "fetchedInstance", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "InstanceStatus", ".", "UNKNOWN", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatch", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "instanceInfoIt", ".", "next", "(", ")", ";", "ReplicationInstance", "replicationInstance", "=", "ReplicationInstance", ".", "replicationInstance", "(", ")", ".", "withAction", "(", "Action", ".", "Register", ")", ".", "withAppName", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ".", "withId", "(", "instanceInfo", ".", "getId", "(", ")", ")", ".", "withInstanceInfo", "(", "instanceInfo", ")", ".", "withLastDirtyTimestamp", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ".", "withStatus", "(", "instanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ")", ".", "build", "(", ")", ";", "HttpResponse", "<", "ReplicationListResponse", ">", "httpResponse", "=", "jerseyReplicationClient", ".", "submitBatchUpdates", "(", "new", "ReplicationList", "(", "replicationInstance", ")", ")", ";", "assertThat", "(", "httpResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "List", "<", "ReplicationInstanceResponse", ">", "replicationListResponse", "=", "httpResponse", ".", "getEntity", "(", ")", ".", "getResponseList", "(", ")", ";", "assertThat", "(", "replicationListResponse", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "assertThat", "(", "replicationListResponse", ".", "get", "(", "0", ")", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "InstanceInfo", "expectInstanceInfoInRegistry", "(", "InstanceInfo", "instanceInfo", ")", "{", "HttpResponse", "<", "InstanceInfo", ">", "queryResponse", "=", "jerseyEurekaClient", ".", "getInstance", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "queryResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "queryResponse", ".", "getEntity", "(", ")", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "queryResponse", ".", "getEntity", "(", ")", ".", "getId", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getId", "(", ")", ")", ")", ")", ";", "return", "queryResponse", ".", "getEntity", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "injectEurekaConfiguration", "(", ")", "throws", "UnknownHostException", "{", "String", "myHostName", "=", "InetAddress", ".", "getLocalHost", "(", ")", ".", "getHostName", "(", ")", ";", "String", "myServiceUrl", "=", "\"", "<STR_LIT>", "\"", "+", "myHostName", "+", "\"", "<STR_LIT>", "\"", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "myServiceUrl", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "myServiceUrl", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "removeEurekaConfiguration", "(", ")", "{", "}", "</s>"]
["<s>", "private", "static", "void", "startServer", "(", ")", "throws", "Exception", "{", "File", "warFile", "=", "findWar", "(", ")", ";", "server", "=", "new", "Server", "(", "<NUM_LIT>", ")", ";", "WebAppContext", "webapp", "=", "new", "WebAppContext", "(", ")", ";", "webapp", ".", "setContextPath", "(", "\"", "<STR_LIT:/>", "\"", ")", ";", "webapp", ".", "setWar", "(", "warFile", ".", "getAbsolutePath", "(", ")", ")", ";", "server", ".", "setHandler", "(", "webapp", ")", ";", "server", ".", "start", "(", ")", ";", "eurekaServiceUrl", "=", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "private", "static", "File", "findWar", "(", ")", "{", "File", "dir", "=", "null", ";", "for", "(", "String", "candidate", ":", "EUREKA1_WAR_DIRS", ")", "{", "File", "candidateFile", "=", "new", "File", "(", "candidate", ")", ";", "if", "(", "candidateFile", ".", "exists", "(", ")", ")", "{", "dir", "=", "candidateFile", ";", "break", ";", "}", "}", "if", "(", "dir", "=", "=", "null", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "EUREKA1_WAR_DIRS", ")", ")", ";", "}", "File", "[", "]", "warFiles", "=", "dir", ".", "listFiles", "(", "new", "FilenameFilter", "(", ")", "{", "@", "Override", "public", "boolean", "accept", "(", "File", "dir", ",", "String", "name", ")", "{", "return", "WAR_PATTERN", ".", "matcher", "(", "name", ")", ".", "matches", "(", ")", ";", "}", "}", ")", ";", "if", "(", "warFiles", ".", "length", "=", "=", "0", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "dir", ")", ";", "}", "if", "(", "warFiles", ".", "length", ">", "1", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "dir", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "warFiles", ")", ")", ";", "}", "return", "warFiles", "[", "0", "]", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "accept", "(", "File", "dir", ",", "String", "name", ")", "{", "return", "WAR_PATTERN", ".", "matcher", "(", "name", ")", ".", "matches", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "createEurekaServerConfig", "(", ")", "{", "eurekaServerConfig", "=", "mock", "(", "EurekaServerConfig", ".", "class", ")", ";", "when", "(", "eurekaServerConfig", ".", "getPeerEurekaNodesUpdateIntervalMs", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT:1000>", ")", ";", "when", "(", "eurekaServerConfig", ".", "shouldSyncWhenTimestampDiffers", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "eurekaServerConfig", ".", "getMaxTimeForReplication", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT:1000>", ")", ";", "when", "(", "eurekaServerConfig", ".", "getMaxElementsInPeerReplicationPool", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT:10>", ")", ";", "when", "(", "eurekaServerConfig", ".", "getMinThreadsForPeerReplication", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "eurekaServerConfig", ".", "getMaxThreadsForPeerReplication", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "eurekaServerConfig", ".", "shouldBatchReplication", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "eurekaServerConfig", ".", "getPeerNodeTotalConnections", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "eurekaServerConfig", ".", "getPeerNodeTotalConnectionsPerHost", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "eurekaServerConfig", ".", "getPeerNodeConnectionIdleTimeoutSeconds", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT:1000>", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "contextInitialized", "(", "ServletContextEvent", "servletContextEvent", ")", "{", "super", ".", "contextInitialized", "(", "servletContextEvent", ")", ";", "ServletContext", "sc", "=", "servletContextEvent", ".", "getServletContext", "(", ")", ";", "sc", ".", "setAttribute", "(", "EurekaServerContext", ".", "class", ".", "getName", "(", ")", ",", "serverContext", ")", ";", "int", "registryCount", "=", "serverContext", ".", "getRegistry", "(", ")", ".", "syncUp", "(", ")", ";", "serverContext", ".", "getRegistry", "(", ")", ".", "openForTraffic", "(", "serverContext", ".", "getApplicationInfoManager", "(", ")", ",", "registryCount", ")", ";", "EurekaMonitors", ".", "registerAllStats", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "contextDestroyed", "(", "ServletContextEvent", "servletContextEvent", ")", "{", "EurekaMonitors", ".", "shutdown", "(", ")", ";", "ServletContext", "sc", "=", "servletContextEvent", ".", "getServletContext", "(", ")", ";", "sc", ".", "removeAttribute", "(", "EurekaServerContext", ".", "class", ".", "getName", "(", ")", ")", ";", "super", ".", "contextDestroyed", "(", "servletContextEvent", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "LifecycleInjector", "createInjector", "(", ")", "{", "JsonXStream", ".", "getInstance", "(", ")", ".", "registerConverter", "(", "new", "V1AwareInstanceInfoConverter", "(", ")", ",", "XStream", ".", "PRIORITY_VERY_HIGH", ")", ";", "XmlXStream", ".", "getInstance", "(", ")", ".", "registerConverter", "(", "new", "V1AwareInstanceInfoConverter", "(", ")", ",", "XStream", ".", "PRIORITY_VERY_HIGH", ")", ";", "LifecycleInjector", "injector", "=", "EurekaInjectorCreator", ".", "createInjector", "(", "false", ")", ";", "serverContext", "=", "injector", ".", "getInstance", "(", "EurekaServerContext", ".", "class", ")", ";", "return", "injector", ";", "}", "</s>"]
["<s>", "public", "static", "LifecycleInjector", "createInjector", "(", "boolean", "embedded", ")", "{", "try", "{", "return", "Karyon", ".", "createInjector", "(", "createInjectorBuilder", "(", "embedded", ")", ".", "build", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "e", ".", "printStackTrace", "(", ")", ";", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "DefaultKaryonConfiguration", ".", "Builder", "<", "?", ">", "createInjectorBuilder", "(", "boolean", "embedded", ")", "{", "return", "ArchaiusKaryonConfiguration", ".", "builder", "(", ")", ".", "withConfigName", "(", "CONFIG_NAME", ")", ".", "disable", "(", "GovernatorFeatures", ".", "SHUTDOWN_ON_ERROR", ")", ".", "addModules", "(", "new", "LocalEurekaServerModule", "(", ")", ",", "new", "ArchaiusModule", "(", ")", ",", "new", "StaticArchaiusBridgeModule", "(", ")", ",", "new", "ProvisionDebugModule", "(", ")", ",", "new", "JerseyServletModule", "(", ")", "{", "@", "Override", "protected", "void", "configureServlets", "(", ")", "{", "filter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "StatusFilter", ".", "class", ")", ";", "filter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "ServerRequestAuthFilter", ".", "class", ")", ";", "filter", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "GzipEncodingEnforcingFilter", ".", "class", ")", ";", "Map", "<", "String", ",", "String", ">", "params", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "params", ".", "put", "(", "PackagesResourceConfig", ".", "PROPERTY_PACKAGES", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "PackagesResourceConfig", ".", "PROPERTY_PACKAGES", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "filter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "GuiceContainer", ".", "class", ",", "params", ")", ";", "bind", "(", "GuiceContainer", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "}", "}", ",", "embedded", "?", "new", "JettyModule", "(", ")", ":", "new", "Bootstrap", ".", "NullModule", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configureServlets", "(", ")", "{", "filter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "StatusFilter", ".", "class", ")", ";", "filter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "ServerRequestAuthFilter", ".", "class", ")", ";", "filter", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "GzipEncodingEnforcingFilter", ".", "class", ")", ";", "Map", "<", "String", ",", "String", ">", "params", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "params", ".", "put", "(", "PackagesResourceConfig", ".", "PROPERTY_PACKAGES", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "PackagesResourceConfig", ".", "PROPERTY_PACKAGES", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "params", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "filter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "through", "(", "GuiceContainer", ".", "class", ",", "params", ")", ";", "bind", "(", "GuiceContainer", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "install", "(", "new", "EurekaModule", "(", ")", ")", ";", "bind", "(", "EurekaServerConfig", ".", "class", ")", ".", "to", "(", "DefaultEurekaServerConfig", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "PeerEurekaNodes", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "AwsBinderDelegate", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "bind", "(", "AwsInstanceRegistry", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "bind", "(", "InstanceRegistry", ".", "class", ")", ".", "to", "(", "AwsInstanceRegistry", ".", "class", ")", ";", "bind", "(", "AbstractInstanceRegistry", ".", "class", ")", ".", "to", "(", "AwsInstanceRegistry", ".", "class", ")", ";", "bind", "(", "PeerAwareInstanceRegistry", ".", "class", ")", ".", "to", "(", "AwsInstanceRegistry", ".", "class", ")", ";", "bind", "(", "ServerCodecs", ".", "class", ")", ".", "to", "(", "DefaultServerCodecs", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaServerContext", ".", "class", ")", ".", "to", "(", "DefaultEurekaServerContext", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "ApplicationInfoManager", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "toProvider", "(", "MyDataCenterInstanceConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaClientConfig", ".", "class", ")", ".", "toProvider", "(", "DefaultEurekaClientConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "InstanceInfo", ".", "class", ")", ".", "toProvider", "(", "EurekaConfigBasedInstanceInfoProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaClient", ".", "class", ")", ".", "to", "(", "DiscoveryClient", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaServerConfig", ".", "class", ")", ".", "to", "(", "DefaultEurekaServerConfig", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "PeerEurekaNodes", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "PeerAwareInstanceRegistryImpl", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "bind", "(", "InstanceRegistry", ".", "class", ")", ".", "to", "(", "PeerAwareInstanceRegistryImpl", ".", "class", ")", ";", "bind", "(", "AbstractInstanceRegistry", ".", "class", ")", ".", "to", "(", "PeerAwareInstanceRegistryImpl", ".", "class", ")", ";", "bind", "(", "PeerAwareInstanceRegistry", ".", "class", ")", ".", "to", "(", "PeerAwareInstanceRegistryImpl", ".", "class", ")", ";", "bind", "(", "ServerCodecs", ".", "class", ")", ".", "to", "(", "DefaultServerCodecs", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaServerContext", ".", "class", ")", ".", "to", "(", "DefaultEurekaServerContext", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "setupProperties", "(", ")", "{", "DiscoveryClientRule", ".", "setupDiscoveryClientConfig", "(", "mockLocalEurekaServer", ".", "getPort", "(", ")", ",", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "setupDiscoveryClient", "(", ")", "{", "setupDiscoveryClient", "(", "<NUM_LIT:30>", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "setupDiscoveryClient", "(", "int", "renewalIntervalInSecs", ")", "{", "InstanceInfo", "instanceInfo", "=", "newInstanceInfoBuilder", "(", "renewalIntervalInSecs", ")", ".", "build", "(", ")", ";", "client", "=", "DiscoveryClientRule", ".", "setupDiscoveryClient", "(", "instanceInfo", ")", ";", "}", "</s>"]
["<s>", "protected", "InstanceInfo", ".", "Builder", "newInstanceInfoBuilder", "(", "int", "renewalIntervalInSecs", ")", "{", "return", "DiscoveryClientRule", ".", "newInstanceInfoBuilder", "(", "renewalIntervalInSecs", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "shutdownDiscoveryClient", "(", ")", "{", "if", "(", "client", "!", "=", "null", ")", "{", "client", ".", "shutdown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "addLocalAppDelta", "(", ")", "{", "Application", "myappDelta", "=", "new", "Application", "(", "LOCAL_REGION_APP3_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createInstance", "(", "LOCAL_REGION_APP3_NAME", ",", "ALL_REGIONS_VIP3_ADDR", ",", "LOCAL_REGION_APP3_INSTANCE1_HOSTNAME", ",", "null", ")", ";", "instanceInfo", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myappDelta", ".", "addInstance", "(", "instanceInfo", ")", ";", "mockLocalEurekaServer", ".", "addLocalRegionAppsDelta", "(", "LOCAL_REGION_APP3_NAME", ",", "myappDelta", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "populateLocalRegistryAtStartup", "(", ")", "{", "for", "(", "Application", "app", ":", "createLocalApps", "(", ")", ")", "{", "mockLocalEurekaServer", ".", "addLocalRegionApps", "(", "app", ".", "getName", "(", ")", ",", "app", ")", ";", "}", "for", "(", "Application", "appDelta", ":", "createLocalAppsDelta", "(", ")", ")", "{", "mockLocalEurekaServer", ".", "addLocalRegionAppsDelta", "(", "appDelta", ".", "getName", "(", ")", ",", "appDelta", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "populateRemoteRegistryAtStartup", "(", ")", "{", "for", "(", "Application", "app", ":", "createRemoteApps", "(", ")", ")", "{", "mockLocalEurekaServer", ".", "addRemoteRegionApps", "(", "app", ".", "getName", "(", ")", ",", "app", ")", ";", "}", "for", "(", "Application", "appDelta", ":", "createRemoteAppsDelta", "(", ")", ")", "{", "mockLocalEurekaServer", ".", "addRemoteRegionAppsDelta", "(", "appDelta", ".", "getName", "(", ")", ",", "appDelta", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "static", "List", "<", "Application", ">", "createRemoteApps", "(", ")", "{", "Application", "myapp1", "=", "new", "Application", "(", "REMOTE_REGION_APP1_NAME", ")", ";", "InstanceInfo", "instanceInfo1", "=", "createInstance", "(", "REMOTE_REGION_APP1_NAME", ",", "ALL_REGIONS_VIP1_ADDR", ",", "REMOTE_REGION_APP1_INSTANCE1_HOSTNAME", ",", "REMOTE_ZONE", ")", ";", "myapp1", ".", "addInstance", "(", "instanceInfo1", ")", ";", "Application", "myapp2", "=", "new", "Application", "(", "REMOTE_REGION_APP2_NAME", ")", ";", "InstanceInfo", "instanceInfo2", "=", "createInstance", "(", "REMOTE_REGION_APP2_NAME", ",", "ALL_REGIONS_VIP2_ADDR", ",", "REMOTE_REGION_APP2_INSTANCE1_HOSTNAME", ",", "REMOTE_ZONE", ")", ";", "myapp2", ".", "addInstance", "(", "instanceInfo2", ")", ";", "return", "Arrays", ".", "asList", "(", "myapp1", ",", "myapp2", ")", ";", "}", "</s>"]
["<s>", "protected", "static", "List", "<", "Application", ">", "createRemoteAppsDelta", "(", ")", "{", "Application", "myapp1", "=", "new", "Application", "(", "REMOTE_REGION_APP1_NAME", ")", ";", "InstanceInfo", "instanceInfo1", "=", "createInstance", "(", "REMOTE_REGION_APP1_NAME", ",", "ALL_REGIONS_VIP1_ADDR", ",", "REMOTE_REGION_APP1_INSTANCE2_HOSTNAME", ",", "REMOTE_ZONE", ")", ";", "instanceInfo1", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myapp1", ".", "addInstance", "(", "instanceInfo1", ")", ";", "Application", "myapp2", "=", "new", "Application", "(", "REMOTE_REGION_APP2_NAME", ")", ";", "InstanceInfo", "instanceInfo2", "=", "createInstance", "(", "REMOTE_REGION_APP2_NAME", ",", "ALL_REGIONS_VIP2_ADDR", ",", "REMOTE_REGION_APP2_INSTANCE2_HOSTNAME", ",", "REMOTE_ZONE", ")", ";", "instanceInfo2", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myapp2", ".", "addInstance", "(", "instanceInfo2", ")", ";", "return", "Arrays", ".", "asList", "(", "myapp1", ",", "myapp2", ")", ";", "}", "</s>"]
["<s>", "protected", "static", "List", "<", "Application", ">", "createLocalApps", "(", ")", "{", "Application", "myapp1", "=", "new", "Application", "(", "LOCAL_REGION_APP1_NAME", ")", ";", "InstanceInfo", "instanceInfo1", "=", "createInstance", "(", "LOCAL_REGION_APP1_NAME", ",", "ALL_REGIONS_VIP1_ADDR", ",", "LOCAL_REGION_APP1_INSTANCE1_HOSTNAME", ",", "null", ")", ";", "myapp1", ".", "addInstance", "(", "instanceInfo1", ")", ";", "Application", "myapp2", "=", "new", "Application", "(", "LOCAL_REGION_APP2_NAME", ")", ";", "InstanceInfo", "instanceInfo2", "=", "createInstance", "(", "LOCAL_REGION_APP2_NAME", ",", "ALL_REGIONS_VIP2_ADDR", ",", "LOCAL_REGION_APP2_INSTANCE1_HOSTNAME", ",", "null", ")", ";", "myapp2", ".", "addInstance", "(", "instanceInfo2", ")", ";", "return", "Arrays", ".", "asList", "(", "myapp1", ",", "myapp2", ")", ";", "}", "</s>"]
["<s>", "protected", "static", "List", "<", "Application", ">", "createLocalAppsDelta", "(", ")", "{", "Application", "myapp1", "=", "new", "Application", "(", "LOCAL_REGION_APP1_NAME", ")", ";", "InstanceInfo", "instanceInfo1", "=", "createInstance", "(", "LOCAL_REGION_APP1_NAME", ",", "ALL_REGIONS_VIP1_ADDR", ",", "LOCAL_REGION_APP1_INSTANCE2_HOSTNAME", ",", "null", ")", ";", "instanceInfo1", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myapp1", ".", "addInstance", "(", "instanceInfo1", ")", ";", "Application", "myapp2", "=", "new", "Application", "(", "LOCAL_REGION_APP2_NAME", ")", ";", "InstanceInfo", "instanceInfo2", "=", "createInstance", "(", "LOCAL_REGION_APP2_NAME", ",", "ALL_REGIONS_VIP2_ADDR", ",", "LOCAL_REGION_APP2_INSTANCE2_HOSTNAME", ",", "null", ")", ";", "instanceInfo2", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myapp2", ".", "addInstance", "(", "instanceInfo2", ")", ";", "return", "Arrays", ".", "asList", "(", "myapp1", ",", "myapp2", ")", ";", "}", "</s>"]
["<s>", "protected", "static", "InstanceInfo", "createInstance", "(", "String", "appName", ",", "String", "vipAddress", ",", "String", "instanceHostName", ",", "String", "zone", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "appName", ")", ";", "instanceBuilder", ".", "setVIPAddress", "(", "vipAddress", ")", ";", "instanceBuilder", ".", "setHostName", "(", "instanceHostName", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "AmazonInfo", "amazonInfo", "=", "getAmazonInfo", "(", "zone", ",", "instanceHostName", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "amazonInfo", ")", ";", "instanceBuilder", ".", "setMetadata", "(", "amazonInfo", ".", "getMetadata", "(", ")", ")", ";", "instanceBuilder", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "build", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "static", "AmazonInfo", "getAmazonInfo", "(", "@", "Nullable", "String", "availabilityZone", ",", "String", "instanceHostName", ")", "{", "AmazonInfo", ".", "Builder", "azBuilder", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "null", "=", "=", "availabilityZone", "?", "\"", "<STR_LIT>", "\"", ":", "availabilityZone", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceId", ",", "instanceHostName", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "amiId", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceType", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "localIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicHostname", ",", "instanceHostName", ")", ";", "return", "azBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "before", "(", ")", "throws", "Throwable", "{", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "after", "(", ")", "{", "try", "{", "stop", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "e", ".", "getMessage", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "start", "(", ")", "throws", "Exception", "{", "server", "=", "new", "Server", "(", "port", ")", ";", "server", ".", "setHandler", "(", "new", "AppsResourceHandler", "(", ")", ")", ";", "server", ".", "start", "(", ")", ";", "port", "=", "server", ".", "getConnectors", "(", ")", "[", "0", "]", ".", "getLocalPort", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getPort", "(", ")", "{", "return", "port", ";", "}", "</s>"]
["<s>", "public", "void", "stop", "(", ")", "throws", "Exception", "{", "server", ".", "stop", "(", ")", ";", "server", "=", "null", ";", "port", "=", "0", ";", "registrationStatuses", ".", "clear", "(", ")", ";", "applicationMap", ".", "clear", "(", ")", ";", "remoteRegionApps", ".", "clear", "(", ")", ";", "remoteRegionAppsDelta", ".", "clear", "(", ")", ";", "applicationDeltaMap", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isSentDelta", "(", ")", "{", "return", "sentDelta", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isSentRegistry", "(", ")", "{", "return", "sentRegistry", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addRemoteRegionApps", "(", "String", "appName", ",", "Application", "app", ")", "{", "remoteRegionApps", ".", "put", "(", "appName", ",", "app", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addRemoteRegionAppsDelta", "(", "String", "appName", ",", "Application", "app", ")", "{", "remoteRegionAppsDelta", ".", "put", "(", "appName", ",", "app", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addLocalRegionApps", "(", "String", "appName", ",", "Application", "app", ")", "{", "applicationMap", ".", "put", "(", "appName", ",", "app", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addLocalRegionAppsDelta", "(", "String", "appName", ",", "Application", "app", ")", "{", "applicationDeltaMap", ".", "put", "(", "appName", ",", "app", ")", ";", "}", "</s>"]
["<s>", "public", "void", "waitForDeltaToBeRetrieved", "(", "int", "refreshRate", ")", "throws", "InterruptedException", "{", "int", "count", "=", "0", ";", "while", "(", "count", "+", "+", "<", "<NUM_LIT:3>", "&", "&", "!", "isSentDelta", "(", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "refreshRate", "+", "\"", "<STR_LIT>", "\"", "+", "count", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:3>", "*", "refreshRate", "*", "<NUM_LIT:1000>", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "isSentDelta", "(", ")", ")", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "refreshRate", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handle", "(", "String", "target", ",", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ",", "int", "dispatch", ")", "throws", "IOException", ",", "ServletException", "{", "String", "authName", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_NAME_HEADER_KEY", ")", ";", "String", "authVersion", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_VERSION_HEADER_KEY", ")", ";", "String", "authId", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_ID_HEADER_KEY", ")", ";", "Assert", ".", "assertEquals", "(", "EurekaClientIdentity", ".", "DEFAULT_CLIENT_NAME", ",", "authName", ")", ";", "Assert", ".", "assertNotNull", "(", "authVersion", ")", ";", "Assert", ".", "assertNotNull", "(", "authId", ")", ";", "String", "pathInfo", "=", "request", ".", "getPathInfo", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "port", "+", "\"", "<STR_LIT>", "\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "pathInfo", "+", "\"", "<STR_LIT>", "\"", "+", "request", ".", "getMethod", "(", ")", "+", "<CHAR_LIT>", "+", "\"", "<STR_LIT>", "\"", "+", "request", ".", "getQueryString", "(", ")", ")", ";", "boolean", "handled", "=", "false", ";", "if", "(", "null", "!", "=", "pathInfo", "&", "&", "pathInfo", ".", "startsWith", "(", "\"", "\"", ")", ")", "{", "pathInfo", "=", "pathInfo", ".", "substring", "(", "EUREKA_API_BASE_PATH", ".", "length", "(", ")", ")", ";", "boolean", "includeRemote", "=", "isRemoteRequest", "(", "request", ")", ";", "if", "(", "pathInfo", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "getDeltaCount", ".", "getAndIncrement", "(", ")", ";", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "<NUM_LIT>", ")", ";", "if", "(", "sentDelta", ".", "compareAndSet", "(", "false", ",", "true", ")", ")", "{", "addDeltaApps", "(", "includeRemote", ",", "apps", ")", ";", "}", "else", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "port", "+", "\"", "<STR_LIT>", "\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "apps", ".", "setAppsHashCode", "(", "getDeltaAppsHashCode", "(", "includeRemote", ")", ")", ";", "sendOkResponseWithContent", "(", "(", "Request", ")", "request", ",", "response", ",", "apps", ")", ";", "handled", "=", "true", ";", "}", "else", "if", "(", "pathInfo", ".", "equals", "(", "\"", "<STR_LIT:/>", "\"", ")", ")", "{", "getFullRegistryCount", ".", "getAndIncrement", "(", ")", ";", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "<NUM_LIT>", ")", ";", "for", "(", "Application", "application", ":", "applicationMap", ".", "values", "(", ")", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "if", "(", "includeRemote", ")", "{", "for", "(", "Application", "application", ":", "remoteRegionApps", ".", "values", "(", ")", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "}", "if", "(", "sentDelta", ".", "get", "(", ")", ")", "{", "addDeltaApps", "(", "includeRemote", ",", "apps", ")", ";", "}", "else", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "port", "+", "\"", "<STR_LIT>", "\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "apps", ".", "setAppsHashCode", "(", "apps", ".", "getReconcileHashCode", "(", ")", ")", ";", "sendOkResponseWithContent", "(", "(", "Request", ")", "request", ",", "response", ",", "apps", ")", ";", "sentRegistry", ".", "set", "(", "true", ")", ";", "handled", "=", "true", ";", "}", "else", "if", "(", "pathInfo", ".", "startsWith", "(", "\"", "<STR_LIT:/>", "\"", ")", ")", "{", "getSingleVipCount", ".", "getAndIncrement", "(", ")", ";", "String", "vipAddress", "=", "pathInfo", ".", "substring", "(", "\"", "<STR_LIT:/>", "\"", ".", "length", "(", ")", ")", ";", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "-", "<NUM_LIT>", ")", ";", "for", "(", "Application", "application", ":", "applicationMap", ".", "values", "(", ")", ")", "{", "Application", "retApp", "=", "new", "Application", "(", "application", ".", "getName", "(", ")", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "application", ".", "getInstances", "(", ")", ")", "{", "if", "(", "vipAddress", ".", "equals", "(", "instance", ".", "getVIPAddress", "(", ")", ")", ")", "{", "retApp", ".", "addInstance", "(", "instance", ")", ";", "}", "}", "if", "(", "retApp", ".", "getInstances", "(", ")", ".", "size", "(", ")", ">", "0", ")", "{", "apps", ".", "addApplication", "(", "retApp", ")", ";", "}", "}", "apps", ".", "setAppsHashCode", "(", "apps", ".", "getReconcileHashCode", "(", ")", ")", ";", "sendOkResponseWithContent", "(", "(", "Request", ")", "request", ",", "response", ",", "apps", ")", ";", "handled", "=", "true", ";", "}", "else", "if", "(", "pathInfo", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "if", "(", "request", ".", "getMethod", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "heartbeatCount", ".", "getAndIncrement", "(", ")", ";", "}", "else", "if", "(", "request", ".", "getMethod", "(", ")", ".", "equals", "(", "\"", "<STR_LIT:POST>", "\"", ")", ")", "{", "registerCount", ".", "getAndIncrement", "(", ")", ";", "String", "statusStr", "=", "null", ";", "String", "hostname", "=", "null", ";", "String", "line", ";", "BufferedReader", "reader", "=", "request", ".", "getReader", "(", ")", ";", "while", "(", "(", "line", "=", "reader", ".", "readLine", "(", ")", ")", "!", "=", "null", ")", "{", "Matcher", "hostNameMatcher", "=", "HOSTNAME_PATTERN", ".", "matcher", "(", "line", ")", ";", "if", "(", "hostname", "=", "=", "null", "&", "&", "hostNameMatcher", ".", "find", "(", ")", ")", "{", "hostname", "=", "hostNameMatcher", ".", "group", "(", "1", ")", ";", "}", "Matcher", "statusMatcher", "=", "STATUS_PATTERN", ".", "matcher", "(", "line", ")", ";", "if", "(", "statusStr", "=", "=", "null", "&", "&", "statusMatcher", ".", "find", "(", ")", ")", "{", "statusStr", "=", "statusMatcher", ".", "group", "(", "1", ")", ";", "}", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "statusStr", ")", ";", "registrationStatuses", ".", "add", "(", "statusStr", ")", ";", "String", "appName", "=", "pathInfo", ".", "substring", "(", "<NUM_LIT:5>", ")", ";", "if", "(", "!", "applicationMap", ".", "containsKey", "(", "appName", ")", ")", "{", "Application", "app", "=", "new", "Application", "(", "appName", ")", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "appName", ")", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setHostName", "(", "hostname", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "toEnum", "(", "statusStr", ")", ")", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ".", "build", "(", ")", ";", "app", ".", "addInstance", "(", "instanceInfo", ")", ";", "applicationMap", ".", "put", "(", "appName", ",", "app", ")", ";", "}", "}", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setAppsHashCode", "(", "\"", "\"", ")", ";", "sendOkResponseWithContent", "(", "(", "Request", ")", "request", ",", "response", ",", "apps", ")", ";", "handled", "=", "true", ";", "}", "else", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "pathInfo", ")", ";", "}", "}", "if", "(", "!", "handled", ")", "{", "response", ".", "sendError", "(", "HttpServletResponse", ".", "SC_NOT_FOUND", ",", "\"", "<STR_LIT>", "\"", "+", "pathInfo", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "protected", "void", "addDeltaApps", "(", "boolean", "includeRemote", ",", "Applications", "apps", ")", "{", "for", "(", "Application", "application", ":", "applicationDeltaMap", ".", "values", "(", ")", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "if", "(", "includeRemote", ")", "{", "for", "(", "Application", "application", ":", "remoteRegionAppsDelta", ".", "values", "(", ")", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "}", "}", "</s>"]
["<s>", "protected", "String", "getDeltaAppsHashCode", "(", "boolean", "includeRemote", ")", "{", "Applications", "allApps", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "applicationMap", ".", "values", "(", ")", ")", "{", "allApps", ".", "addApplication", "(", "application", ")", ";", "}", "if", "(", "includeRemote", ")", "{", "for", "(", "Application", "application", ":", "remoteRegionApps", ".", "values", "(", ")", ")", "{", "allApps", ".", "addApplication", "(", "application", ")", ";", "}", "}", "addDeltaApps", "(", "includeRemote", ",", "allApps", ")", ";", "return", "allApps", ".", "getReconcileHashCode", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isRemoteRequest", "(", "HttpServletRequest", "request", ")", "{", "String", "queryString", "=", "request", ".", "getQueryString", "(", ")", ";", "if", "(", "queryString", "=", "=", "null", ")", "{", "return", "false", ";", "}", "return", "queryString", ".", "contains", "(", "\"", "<STR_LIT:=>", "\"", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "sendOkResponseWithContent", "(", "Request", "request", ",", "HttpServletResponse", "response", ",", "Applications", "apps", ")", "throws", "IOException", "{", "String", "content", "=", "XmlXStream", ".", "getInstance", "(", ")", ".", "toXML", "(", "apps", ")", ";", "response", ".", "setContentType", "(", "\"", "<STR_LIT>", "\"", ")", ";", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_OK", ")", ";", "response", ".", "getWriter", "(", ")", ".", "println", "(", "content", ")", ";", "response", ".", "getWriter", "(", ")", ".", "flush", "(", ")", ";", "request", ".", "setHandled", "(", "true", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "port", "+", "\"", "<STR_LIT>", "\"", "+", "System", ".", "currentTimeMillis", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "request", ".", "getPathInfo", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "apps", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "sleep", "(", "int", "seconds", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "seconds", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testThreadCount", "(", ")", "throws", "InterruptedException", "{", "assertThat", "(", "containsJerseyThread", "(", ")", ",", "equalTo", "(", "true", ")", ")", ";", "client", ".", "shutdown", "(", ")", ";", "Thread", ".", "sleep", "(", "1", ")", ";", "assertThat", "(", "containsJerseyThread", "(", ")", ",", "equalTo", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "containsJerseyThread", "(", ")", "{", "Set", "<", "Thread", ">", "threads", "=", "Thread", ".", "getAllStackTraces", "(", ")", ".", "keySet", "(", ")", ";", "for", "(", "Thread", "t", ":", "threads", ")", "{", "if", "(", "t", ".", "getName", "(", ")", ".", "contains", "(", "THREAD_NAME", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "discoveryClient", "=", "mock", "(", "DiscoveryClient", ".", "class", ")", ";", "HealthCheckHandler", "healthCheckHandler", "=", "mock", "(", "HealthCheckHandler", ".", "class", ")", ";", "when", "(", "discoveryClient", ".", "getHealthCheckHandler", "(", ")", ")", ".", "thenReturn", "(", "healthCheckHandler", ")", ";", "when", "(", "healthCheckHandler", ".", "getStatus", "(", "any", "(", "InstanceInfo", ".", "InstanceStatus", ".", "class", ")", ")", ")", ".", "thenReturn", "(", "null", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setRenewalIntervalInSecs", "(", "<NUM_LIT:30>", ")", ".", "build", "(", ")", ")", ";", "InstanceInfo", "instanceInfo", "=", "builder", ".", "build", "(", ")", ";", "instanceInfo", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "this", ".", "replicator", "=", "new", "InstanceInfoReplicator", "(", "discoveryClient", ",", "instanceInfo", ",", "refreshRateSeconds", ",", "burstSize", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "replicator", ".", "stop", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testOnDemandUpdate", "(", ")", "throws", "Throwable", "{", "assertTrue", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "assertTrue", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", "*", "refreshRateSeconds", "/", "<NUM_LIT:2>", ")", ";", "assertTrue", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "verify", "(", "discoveryClient", ",", "times", "(", "<NUM_LIT:3>", ")", ")", ".", "refreshInstanceInfo", "(", ")", ";", "verify", "(", "discoveryClient", ",", "times", "(", "1", ")", ")", ".", "register", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testOnDemandUpdateRateLimiting", "(", ")", "throws", "Throwable", "{", "assertTrue", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "assertTrue", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "assertFalse", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "verify", "(", "discoveryClient", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "refreshInstanceInfo", "(", ")", ";", "verify", "(", "discoveryClient", ",", "times", "(", "1", ")", ")", ".", "register", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testOnDemandUpdateResetAutomaticRefresh", "(", ")", "throws", "Throwable", "{", "replicator", ".", "start", "(", "0", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", "*", "refreshRateSeconds", "/", "<NUM_LIT:2>", ")", ";", "assertTrue", "(", "replicator", ".", "onDemandUpdate", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", "*", "refreshRateSeconds", "+", "<NUM_LIT>", ")", ";", "verify", "(", "discoveryClient", ",", "times", "(", "<NUM_LIT:3>", ")", ")", ".", "refreshInstanceInfo", "(", ")", ";", "verify", "(", "discoveryClient", ",", "times", "(", "1", ")", ")", ".", "register", "(", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "afterEachTest", "(", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDefaultInstanceConfig", "(", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "Injector", "injector", "=", "LifecycleInjector", ".", "builder", "(", ")", ".", "build", "(", ")", ".", "createInjector", "(", ")", ";", "EurekaClient", "client", "=", "injector", ".", "getInstance", "(", "EurekaClient", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "client", ",", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBackupRegistryInjection", "(", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "Injector", "injector", "=", "LifecycleInjector", ".", "builder", "(", ")", ".", "withAdditionalModules", "(", "new", "AbstractModule", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "BackupRegistry", ".", "class", ")", ".", "to", "(", "MockBackupRegistry", ".", "class", ")", ";", "}", "}", ")", ".", "build", "(", ")", ".", "createInjector", "(", ")", ";", "MockBackupRegistry", "backupRegistry", "=", "(", "MockBackupRegistry", ")", "injector", ".", "getInstance", "(", "BackupRegistry", ".", "class", ")", ";", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "String", "dummyappName", "=", "\"", "<STR_LIT>", "\"", ";", "Application", "dummyapp", "=", "new", "Application", "(", "dummyappName", ")", ";", "apps", ".", "addApplication", "(", "dummyapp", ")", ";", "dummyapp", ".", "addInstance", "(", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setAppName", "(", "dummyappName", ")", ".", "build", "(", ")", ")", ";", "backupRegistry", ".", "setLocalRegionApps", "(", "apps", ")", ";", "EurekaClient", "client", "=", "injector", ".", "getInstance", "(", "EurekaClient", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "client", ",", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "client", ".", "getApplication", "(", "dummyappName", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "BackupRegistry", ".", "class", ")", ".", "to", "(", "MockBackupRegistry", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNamespaceOverride", "(", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "Injector", "injector", "=", "LifecycleInjector", ".", "builder", "(", ")", ".", "withBootstrapModule", "(", "new", "BootstrapModule", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", "BootstrapBinder", "binder", ")", "{", "binder", ".", "bind", "(", "String", ".", "class", ")", ".", "annotatedWith", "(", "EurekaNamespace", ".", "class", ")", ".", "toInstance", "(", "\"", "<STR_LIT:.>", "\"", ")", ";", "}", "}", ")", ".", "build", "(", ")", ".", "createInjector", "(", ")", ";", "EurekaClient", "client", "=", "injector", ".", "getInstance", "(", "EurekaClient", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "client", ",", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "configure", "(", "BootstrapBinder", "binder", ")", "{", "binder", ".", "bind", "(", "String", ".", "class", ")", ".", "annotatedWith", "(", "EurekaNamespace", ".", "class", ")", ".", "toInstance", "(", "\"", "<STR_LIT:.>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "fetchRegistry", "(", ")", "{", "if", "(", "null", "=", "=", "localRegionApps", ")", "{", "return", "new", "Applications", "(", ")", ";", "}", "return", "localRegionApps", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "fetchRegistry", "(", "String", "[", "]", "includeRemoteRegions", ")", "{", "Applications", "toReturn", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "localRegionApps", ".", "getRegisteredApplications", "(", ")", ")", "{", "toReturn", ".", "addApplication", "(", "application", ")", ";", "}", "for", "(", "String", "region", ":", "includeRemoteRegions", ")", "{", "Applications", "applications", "=", "remoteRegionVsApps", ".", "get", "(", "region", ")", ";", "if", "(", "null", "!", "=", "applications", ")", "{", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "toReturn", ".", "addApplication", "(", "application", ")", ";", "}", "}", "}", "return", "toReturn", ";", "}", "</s>"]
["<s>", "public", "Applications", "getLocalRegionApps", "(", ")", "{", "return", "localRegionApps", ";", "}", "</s>"]
["<s>", "public", "Map", "<", "String", ",", "Applications", ">", "getRemoteRegionVsApps", "(", ")", "{", "return", "remoteRegionVsApps", ";", "}", "</s>"]
["<s>", "public", "void", "setRemoteRegionVsApps", "(", "Map", "<", "String", ",", "Applications", ">", "remoteRegionVsApps", ")", "{", "this", ".", "remoteRegionVsApps", "=", "remoteRegionVsApps", ";", "}", "</s>"]
["<s>", "public", "void", "setLocalRegionApps", "(", "Applications", "localRegionApps", ")", "{", "this", ".", "localRegionApps", "=", "localRegionApps", ";", "}", "</s>"]
["<s>", "DiscoveryClientRule", "(", "DiscoveryClientRuleBuilder", "builder", ")", "{", "this", ".", "registrationEnabled", "=", "builder", ".", "registrationEnabled", ";", "this", ".", "registryFetchEnabled", "=", "builder", ".", "registryFetchEnabled", ";", "this", ".", "portResolverCallable", "=", "builder", ".", "portResolverCallable", ";", "this", ".", "instance", "=", "builder", ".", "instance", ";", "}", "</s>"]
["<s>", "public", "EurekaClient", "getClient", "(", ")", "{", "if", "(", "client", "=", "=", "null", ")", "{", "int", "port", ";", "try", "{", "port", "=", "portResolverCallable", ".", "call", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "setupDiscoveryClientConfig", "(", "port", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "valueOf", "(", "registrationEnabled", ")", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "valueOf", "(", "registryFetchEnabled", ")", ")", ";", "InstanceInfo", "clientInstanceInfo", "=", "instance", "=", "=", "null", "?", "newInstanceInfoBuilder", "(", "<NUM_LIT:30>", ")", ".", "build", "(", ")", ":", "instance", ";", "client", "=", "setupDiscoveryClient", "(", "clientInstanceInfo", ")", ";", "}", "return", "client", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "after", "(", ")", "{", "if", "(", "client", "!", "=", "null", ")", "{", "client", ".", "shutdown", "(", ")", ";", "}", "clearDiscoveryClientConfig", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "DiscoveryClientRuleBuilder", "newBuilder", "(", ")", "{", "return", "new", "DiscoveryClientRuleBuilder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "setupDiscoveryClientConfig", "(", "int", "serverPort", ",", "String", "path", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:10>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "CLIENT_REFRESH_RATE", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_ZONE", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "serverPort", "+", "path", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "clearDiscoveryClientConfig", "(", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "static", "EurekaClient", "setupDiscoveryClient", "(", "InstanceInfo", "clientInstanceInfo", ")", "{", "DefaultEurekaClientConfig", "config", "=", "new", "DefaultEurekaClientConfig", "(", ")", ";", "ApplicationInfoManager", "applicationInfoManager", "=", "new", "ApplicationInfoManager", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ",", "clientInstanceInfo", ")", ";", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setEurekaClientConfig", "(", "config", ")", ";", "EurekaClient", "client", "=", "new", "DiscoveryClient", "(", "applicationInfoManager", ",", "config", ")", ";", "return", "client", ";", "}", "</s>"]
["<s>", "public", "static", "EurekaClient", "setupInjector", "(", "InstanceInfo", "clientInstanceInfo", ")", "{", "DefaultEurekaClientConfig", "config", "=", "new", "DefaultEurekaClientConfig", "(", ")", ";", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setEurekaClientConfig", "(", "config", ")", ";", "EurekaClient", "client", "=", "new", "DiscoveryClient", "(", "clientInstanceInfo", ",", "config", ")", ";", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "initComponent", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ")", ";", "return", "client", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfo", ".", "Builder", "newInstanceInfoBuilder", "(", "int", "renewalIntervalInSecs", ")", "{", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "builder", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ";", "builder", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setRenewalIntervalInSecs", "(", "renewalIntervalInSecs", ")", ".", "build", "(", ")", ")", ";", "return", "builder", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClientRuleBuilder", "registration", "(", "boolean", "enabled", ")", "{", "this", ".", "registrationEnabled", "=", "enabled", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClientRuleBuilder", "registryFetch", "(", "boolean", "enabled", ")", "{", "this", ".", "registryFetchEnabled", "=", "enabled", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClientRuleBuilder", "portResolver", "(", "Callable", "<", "Integer", ">", "portResolverCallable", ")", "{", "this", ".", "portResolverCallable", "=", "portResolverCallable", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClientRuleBuilder", "instanceInfo", "(", "InstanceInfo", "instance", ")", "{", "this", ".", "instance", "=", "instance", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClientRule", "build", "(", ")", "{", "return", "new", "DiscoveryClientRule", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "mockLocalEurekaServer", "=", "new", "MockRemoteEurekaServer", "(", ")", ";", "mockLocalEurekaServer", ".", "start", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "mockLocalEurekaServer", ".", "getPort", "(", ")", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "applicationInfoManager", "=", "new", "TestApplicationInfoManager", "(", ")", ";", "applicationInfoManager", ".", "initComponent", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ")", ";", "client", "=", "new", "DiscoveryClient", "(", "applicationInfoManager", ",", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "client", ".", "shutdown", "(", ")", ";", "mockLocalEurekaServer", ".", "stop", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "registerUpdateLifecycleTest", "(", ")", "throws", "Exception", "{", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UNKNOWN", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Assert", ".", "assertEquals", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ",", "mockLocalEurekaServer", ".", "registrationStatuses", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:3>", ",", "mockLocalEurekaServer", ".", "registerCount", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "registerUpdateQuickLifecycleTest", "(", ")", "throws", "Exception", "{", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UNKNOWN", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Assert", ".", "assertEquals", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ",", "mockLocalEurekaServer", ".", "registrationStatuses", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:2>", ",", "mockLocalEurekaServer", ".", "registerCount", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "registerUpdateShutdownTest", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "1", ",", "applicationInfoManager", ".", "getStatusChangeListeners", "(", ")", ".", "size", "(", ")", ")", ";", "client", ".", "shutdown", "(", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "applicationInfoManager", ".", "getStatusChangeListeners", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRegistrationDisabled", "(", ")", "throws", "Exception", "{", "client", ".", "shutdown", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "client", "=", "new", "DiscoveryClient", "(", "applicationInfoManager", ".", "getInfo", "(", ")", ",", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "applicationInfoManager", ".", "getStatusChangeListeners", "(", ")", ".", "size", "(", ")", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "client", ".", "shutdown", "(", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "applicationInfoManager", ".", "getStatusChangeListeners", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "TestApplicationInfoManager", "(", ")", "{", "super", "(", "null", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Map", "<", "String", ",", "StatusChangeListener", ">", "getStatusChangeListeners", "(", ")", "{", "return", "this", ".", "listeners", ";", "}", "</s>"]
["<s>", "public", "void", "setUp", "(", "boolean", "enableRemote", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "CLIENT_REFRESH_RATE", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "enableRemote", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION", ")", ";", "}", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_ZONE", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "MockBackupRegistry", ".", "class", ".", "getName", "(", ")", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "NOT_AVAILABLE_EUREKA_PORT", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "builder", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ";", "ApplicationInfoManager", "applicationInfoManager", "=", "new", "ApplicationInfoManager", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ",", "builder", ".", "build", "(", ")", ")", ";", "backupRegistry", "=", "new", "MockBackupRegistry", "(", ")", ";", "setupBackupMock", "(", ")", ";", "client", "=", "new", "DiscoveryClient", "(", "applicationInfoManager", ",", "new", "DefaultEurekaClientConfig", "(", ")", ",", "null", ",", "Providers", ".", "of", "(", "(", "BackupRegistry", ")", "backupRegistry", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "client", ".", "shutdown", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLocalOnly", "(", ")", "throws", "Exception", "{", "setUp", "(", "false", ")", ";", "Applications", "applications", "=", "client", ".", "getApplications", "(", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "applications", ".", "getRegisteredApplications", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "registeredApplications", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "registeredApplications", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "LOCAL_REGION_APP_NAME", ",", "registeredApplications", ".", "get", "(", "0", ")", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoteEnabledButLocalOnlyQueried", "(", ")", "throws", "Exception", "{", "setUp", "(", "true", ")", ";", "Applications", "applications", "=", "client", ".", "getApplications", "(", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "applications", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "registeredApplications", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Application", "localRegionApp", "=", "null", ";", "Application", "remoteRegionApp", "=", "null", ";", "for", "(", "Application", "registeredApplication", ":", "registeredApplications", ")", "{", "if", "(", "registeredApplication", ".", "getName", "(", ")", ".", "equals", "(", "LOCAL_REGION_APP_NAME", ")", ")", "{", "localRegionApp", "=", "registeredApplication", ";", "}", "else", "if", "(", "registeredApplication", ".", "getName", "(", ")", ".", "equals", "(", "REMOTE_REGION_APP_NAME", ")", ")", "{", "remoteRegionApp", "=", "registeredApplication", ";", "}", "}", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "localRegionApp", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "null", "=", "=", "remoteRegionApp", "|", "|", "remoteRegionApp", ".", "getInstances", "(", ")", ".", "isEmpty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoteEnabledAndQueried", "(", ")", "throws", "Exception", "{", "setUp", "(", "true", ")", ";", "Applications", "applications", "=", "client", ".", "getApplicationsForARegion", "(", "REMOTE_REGION", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "applications", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "registeredApplications", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION_APP_NAME", ",", "registeredApplications", ".", "get", "(", "0", ")", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAppsHashCode", "(", ")", "throws", "Exception", "{", "setUp", "(", "true", ")", ";", "Applications", "applications", "=", "client", ".", "getApplications", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "applications", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setupBackupMock", "(", ")", "{", "Application", "localApp", "=", "createLocalApps", "(", ")", ";", "Applications", "localApps", "=", "new", "Applications", "(", ")", ";", "localApps", ".", "addApplication", "(", "localApp", ")", ";", "backupRegistry", ".", "setLocalRegionApps", "(", "localApps", ")", ";", "Application", "remoteApp", "=", "createRemoteApps", "(", ")", ";", "Applications", "remoteApps", "=", "new", "Applications", "(", ")", ";", "remoteApps", ".", "addApplication", "(", "remoteApp", ")", ";", "backupRegistry", ".", "getRemoteRegionVsApps", "(", ")", ".", "put", "(", "REMOTE_REGION", ",", "remoteApps", ")", ";", "}", "</s>"]
["<s>", "private", "Application", "createLocalApps", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "LOCAL_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "Application", "createRemoteApps", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "REMOTE_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createRemoteInstance", "(", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "createRemoteInstance", "(", "String", "instanceHostName", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "REMOTE_REGION_APP_NAME", ")", ";", "instanceBuilder", ".", "setVIPAddress", "(", "ALL_REGIONS_VIP_ADDR", ")", ";", "instanceBuilder", ".", "setHostName", "(", "instanceHostName", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "AmazonInfo", "amazonInfo", "=", "getAmazonInfo", "(", "REMOTE_ZONE", ",", "instanceHostName", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "amazonInfo", ")", ";", "instanceBuilder", ".", "setMetadata", "(", "amazonInfo", ".", "getMetadata", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "createLocalInstance", "(", "String", "instanceHostName", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "LOCAL_REGION_APP_NAME", ")", ";", "instanceBuilder", ".", "setVIPAddress", "(", "ALL_REGIONS_VIP_ADDR", ")", ";", "instanceBuilder", ".", "setHostName", "(", "instanceHostName", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "AmazonInfo", "amazonInfo", "=", "getAmazonInfo", "(", "null", ",", "instanceHostName", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "amazonInfo", ")", ";", "instanceBuilder", ".", "setMetadata", "(", "amazonInfo", ".", "getMetadata", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "AmazonInfo", "getAmazonInfo", "(", "@", "Nullable", "String", "availabilityZone", ",", "String", "instanceHostName", ")", "{", "AmazonInfo", ".", "Builder", "azBuilder", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "(", "null", "=", "=", "availabilityZone", ")", "?", "\"", "<STR_LIT>", "\"", ":", "availabilityZone", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceId", ",", "instanceHostName", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "amiId", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceType", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "localIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicHostname", ",", "instanceHostName", ")", ";", "return", "azBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Integer", "call", "(", ")", "throws", "Exception", "{", "return", "redirectServerMockRule", ".", "getHttpPort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Integer", "call", "(", ")", "throws", "Exception", "{", "return", "redirectServerMockRule", ".", "getHttpPort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "targetServerBaseUri", "=", "\"", "<STR_LIT>", "\"", "+", "targetServerMockRule", ".", "getHttpPort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testClientQueryFollowsRedirectsAndPinsToTargetServer", "(", ")", "throws", "Exception", "{", "Applications", "fullFetchApps", "=", "dataGenerator", ".", "takeDelta", "(", "1", ")", ";", "String", "fullFetchJson", "=", "toJson", "(", "fullFetchApps", ")", ";", "Applications", "deltaFetchApps", "=", "dataGenerator", ".", "takeDelta", "(", "1", ")", ";", "String", "deltaFetchJson", "=", "toJson", "(", "deltaFetchApps", ")", ";", "redirectServerMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ".", "withHeader", "(", "new", "Header", "(", "\"", "<STR_LIT>", "\"", ",", "targetServerBaseUri", "+", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ".", "withHeader", "(", "new", "Header", "(", "\"", "<STR_LIT:Content-Type>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withBody", "(", "fullFetchJson", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ".", "withHeader", "(", "new", "Header", "(", "\"", "<STR_LIT:Content-Type>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withBody", "(", "deltaFetchJson", ")", ")", ";", "final", "EurekaClient", "client", "=", "registryFetchClientRule", ".", "getClient", "(", ")", ";", "await", "(", "new", "Callable", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "List", "<", "Application", ">", "applicationList", "=", "client", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ";", "return", "!", "applicationList", ".", "isEmpty", "(", ")", "&", "&", "applicationList", ".", "get", "(", "0", ")", ".", "getInstances", "(", ")", ".", "size", "(", ")", "=", "=", "<NUM_LIT:2>", ";", "}", "}", ",", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "redirectServerMockClient", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "exactly", "(", "1", ")", ")", ";", "redirectServerMockClient", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "exactly", "(", "0", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "exactly", "(", "1", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "atLeast", "(", "1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "List", "<", "Application", ">", "applicationList", "=", "client", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ";", "return", "!", "applicationList", ".", "isEmpty", "(", ")", "&", "&", "applicationList", ".", "get", "(", "0", ")", ".", "getInstances", "(", ")", ".", "size", "(", ")", "=", "=", "<NUM_LIT:2>", ";", "}", "</s>"]
["<s>", "@", "Ignore", "@", "Test", "public", "void", "testClientRegistrationFollowsRedirectsAndPinsToTargetServer", "(", ")", "throws", "Exception", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testClientFallsBackToOriginalServerOnError", "(", ")", "throws", "Exception", "{", "Applications", "fullFetchApps1", "=", "dataGenerator", ".", "takeDelta", "(", "1", ")", ";", "String", "fullFetchJson1", "=", "toJson", "(", "fullFetchApps1", ")", ";", "Applications", "fullFetchApps2", "=", "EurekaEntityFunctions", ".", "mergeApplications", "(", "fullFetchApps1", ",", "dataGenerator", ".", "takeDelta", "(", "1", ")", ")", ";", "String", "fullFetchJson2", "=", "toJson", "(", "fullFetchApps2", ")", ";", "redirectServerMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ".", "withHeader", "(", "new", "Header", "(", "\"", "<STR_LIT>", "\"", ",", "targetServerBaseUri", "+", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "Times", ".", "exactly", "(", "1", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ".", "withHeader", "(", "new", "Header", "(", "\"", "<STR_LIT:Content-Type>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withBody", "(", "fullFetchJson1", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ".", "withHeader", "(", "new", "Header", "(", "\"", "<STR_LIT:Content-Type>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withBody", "(", "fullFetchJson2", ")", ")", ";", "final", "EurekaClient", "client", "=", "registryFetchClientRule", ".", "getClient", "(", ")", ";", "await", "(", "new", "Callable", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "List", "<", "Application", ">", "applicationList", "=", "client", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ";", "return", "!", "applicationList", ".", "isEmpty", "(", ")", "&", "&", "applicationList", ".", "get", "(", "0", ")", ".", "getInstances", "(", ")", ".", "size", "(", ")", "=", "=", "<NUM_LIT:2>", ";", "}", "}", ",", "1", ",", "TimeUnit", ".", "MINUTES", ")", ";", "redirectServerMockClient", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "atLeast", "(", "<NUM_LIT:2>", ")", ")", ";", "redirectServerMockClient", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "exactly", "(", "1", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "exactly", "(", "<NUM_LIT:2>", ")", ")", ";", "targetServerMockClient", ".", "client", ".", "verify", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", ")", ",", "exactly", "(", "1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "List", "<", "Application", ">", "applicationList", "=", "client", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ";", "return", "!", "applicationList", ".", "isEmpty", "(", ")", "&", "&", "applicationList", ".", "get", "(", "0", ")", ".", "getInstances", "(", ")", ".", "size", "(", ")", "=", "=", "<NUM_LIT:2>", ";", "}", "</s>"]
["<s>", "private", "static", "String", "toJson", "(", "Applications", "applications", ")", "throws", "IOException", "{", "ByteArrayOutputStream", "os", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "new", "EntityBodyConverter", "(", ")", ".", "write", "(", "applications", ",", "os", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "os", ".", "close", "(", ")", ";", "return", "os", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "await", "(", "Callable", "<", "Boolean", ">", "condition", ",", "long", "time", ",", "TimeUnit", "timeUnit", ")", "throws", "Exception", "{", "long", "timeout", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "timeUnit", ".", "toMillis", "(", "time", ")", ";", "while", "(", "!", "condition", ".", "call", "(", ")", ")", "{", "if", "(", "System", ".", "currentTimeMillis", "(", ")", ">", "=", "timeout", ")", "{", "throw", "new", "TimeoutException", "(", ")", ";", "}", "Thread", ".", "sleep", "(", "<NUM_LIT:100>", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetByVipInLocalRegion", "(", ")", "throws", "Exception", "{", "List", "<", "InstanceInfo", ">", "instancesByVipAddress", "=", "client", ".", "getInstancesByVipAddress", "(", "ALL_REGIONS_VIP1_ADDR", ",", "false", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "instancesByVipAddress", ".", "size", "(", ")", ")", ";", "InstanceInfo", "instance", "=", "instancesByVipAddress", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "LOCAL_REGION_APP1_INSTANCE1_HOSTNAME", ",", "instance", ".", "getHostName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetAllKnownRegions", "(", ")", "throws", "Exception", "{", "Set", "<", "String", ">", "allKnownRegions", "=", "client", ".", "getAllKnownRegions", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", "+", "allKnownRegions", ",", "<NUM_LIT:2>", ",", "allKnownRegions", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", "+", "allKnownRegions", ",", "allKnownRegions", ".", "contains", "(", "REMOTE_REGION", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAllAppsForRegions", "(", ")", "throws", "Exception", "{", "Applications", "appsForRemoteRegion", "=", "client", ".", "getApplicationsForARegion", "(", "REMOTE_REGION", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "null", "!", "=", "appsForRemoteRegion", "&", "&", "!", "appsForRemoteRegion", ".", "getRegisteredApplications", "(", ")", ".", "isEmpty", "(", ")", ")", ";", "Applications", "appsForLocalRegion", "=", "client", ".", "getApplicationsForARegion", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "null", "!", "=", "appsForLocalRegion", "&", "&", "!", "appsForLocalRegion", ".", "getRegisteredApplications", "(", ")", ".", "isEmpty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCacheRefreshSingleAppForLocalRegion", "(", ")", "throws", "Exception", "{", "final", "String", "propertyName", "=", "\"", "<STR_LIT>", "\"", ";", "try", "{", "shutdownDiscoveryClient", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "propertyName", ",", "ALL_REGIONS_VIP1_ADDR", ")", ";", "setupDiscoveryClient", "(", ")", ";", "List", "<", "Application", ">", "registeredApps", "=", "client", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "registeredApps", ".", "size", "(", ")", ")", ";", "Application", "app", "=", "registeredApps", ".", "get", "(", "0", ")", ";", "Assert", ".", "assertEquals", "(", "LOCAL_REGION_APP1_NAME", ",", "app", ".", "getName", "(", ")", ")", ";", "List", "<", "InstanceInfo", ">", "instances", "=", "app", ".", "getInstances", "(", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "instances", ".", "size", "(", ")", ")", ";", "}", "finally", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "propertyName", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEurekaClientPeriodicHeartbeat", "(", ")", "throws", "Exception", "{", "final", "String", "shouldFetchRegistryPropName", "=", "\"", "<STR_LIT>", "\"", ";", "final", "String", "fetchRegistryOrigValue", "=", "(", "String", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getProperty", "(", "shouldFetchRegistryPropName", ")", ";", "final", "String", "enableHeartbeartPropName", "=", "\"", "<STR_LIT>", "\"", ";", "final", "String", "heartbeatOrigValue", "=", "(", "String", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getProperty", "(", "enableHeartbeartPropName", ")", ";", "try", "{", "shutdownDiscoveryClient", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "shouldFetchRegistryPropName", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "enableHeartbeartPropName", ",", "\"", "<STR_LIT>", "\"", ")", ";", "setupDiscoveryClient", "(", "<NUM_LIT:3>", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "mockLocalEurekaServer", ".", "heartbeatCount", ".", "get", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:7>", "*", "<NUM_LIT:1000>", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:2>", ",", "mockLocalEurekaServer", ".", "heartbeatCount", ".", "get", "(", ")", ")", ";", "}", "finally", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "enableHeartbeartPropName", ",", "heartbeatOrigValue", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "shouldFetchRegistryPropName", ",", "fetchRegistryOrigValue", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEurekaClientPeriodicCacheRefresh", "(", ")", "throws", "Exception", "{", "final", "String", "shouldFetchRegistryPropName", "=", "\"", "<STR_LIT>", "\"", ";", "final", "String", "fetchRegistryOrigValue", "=", "(", "String", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getProperty", "(", "shouldFetchRegistryPropName", ")", ";", "final", "String", "fetchRegistryIntervalPropName", "=", "\"", "<STR_LIT>", "\"", ";", "final", "int", "fetchRegistryIntervalOrigValue", "=", "(", "Integer", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getProperty", "(", "fetchRegistryIntervalPropName", ")", ";", "try", "{", "shutdownDiscoveryClient", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "shouldFetchRegistryPropName", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "fetchRegistryIntervalPropName", ",", "<NUM_LIT:3>", ")", ";", "setupDiscoveryClient", "(", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:2>", ",", "mockLocalEurekaServer", ".", "getFullRegistryCount", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "mockLocalEurekaServer", ".", "getDeltaCount", ".", "get", "(", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:7>", "*", "<NUM_LIT:1000>", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:2>", ",", "mockLocalEurekaServer", ".", "getFullRegistryCount", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:2>", ",", "mockLocalEurekaServer", ".", "getDeltaCount", ".", "get", "(", ")", ")", ";", "}", "finally", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "fetchRegistryIntervalPropName", ",", "fetchRegistryIntervalOrigValue", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "shouldFetchRegistryPropName", ",", "fetchRegistryOrigValue", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetInvalidVIP", "(", ")", "throws", "Exception", "{", "List", "<", "InstanceInfo", ">", "instancesByVipAddress", "=", "client", ".", "getInstancesByVipAddress", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "0", ",", "instancesByVipAddress", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetInvalidVIPForRemoteRegion", "(", ")", "throws", "Exception", "{", "List", "<", "InstanceInfo", ">", "instancesByVipAddress", "=", "client", ".", "getInstancesByVipAddress", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "REMOTE_REGION", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "0", ",", "instancesByVipAddress", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetByVipInRemoteRegion", "(", ")", "throws", "Exception", "{", "List", "<", "InstanceInfo", ">", "instancesByVipAddress", "=", "client", ".", "getInstancesByVipAddress", "(", "ALL_REGIONS_VIP1_ADDR", ",", "false", ",", "REMOTE_REGION", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "instancesByVipAddress", ".", "size", "(", ")", ")", ";", "InstanceInfo", "instance", "=", "instancesByVipAddress", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION_APP1_INSTANCE1_HOSTNAME", ",", "instance", ".", "getHostName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDelta", "(", ")", "throws", "Exception", "{", "mockLocalEurekaServer", ".", "waitForDeltaToBeRetrieved", "(", "CLIENT_REFRESH_RATE", ")", ";", "checkInstancesFromARegion", "(", "\"", "<STR_LIT>", "\"", ",", "LOCAL_REGION_APP1_INSTANCE1_HOSTNAME", ",", "LOCAL_REGION_APP1_INSTANCE2_HOSTNAME", ")", ";", "checkInstancesFromARegion", "(", "REMOTE_REGION", ",", "REMOTE_REGION_APP1_INSTANCE1_HOSTNAME", ",", "REMOTE_REGION_APP1_INSTANCE2_HOSTNAME", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAppsHashCodeAfterRefresh", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "client", ".", "getApplications", "(", ")", ".", "getAppsHashCode", "(", ")", ")", ";", "addLocalAppDelta", "(", ")", ";", "mockLocalEurekaServer", ".", "waitForDeltaToBeRetrieved", "(", "CLIENT_REFRESH_RATE", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "client", ".", "getApplications", "(", ")", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "checkInstancesFromARegion", "(", "String", "region", ",", "String", "instance1Hostname", ",", "String", "instance2Hostname", ")", "{", "List", "<", "InstanceInfo", ">", "instancesByVipAddress", ";", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "region", ")", ")", "{", "instancesByVipAddress", "=", "client", ".", "getInstancesByVipAddress", "(", "ALL_REGIONS_VIP1_ADDR", ",", "false", ")", ";", "}", "else", "{", "instancesByVipAddress", "=", "client", ".", "getInstancesByVipAddress", "(", "ALL_REGIONS_VIP1_ADDR", ",", "false", ",", "region", ")", ";", "}", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "instancesByVipAddress", ".", "size", "(", ")", ")", ";", "InstanceInfo", "localInstance1", "=", "null", ";", "InstanceInfo", "localInstance2", "=", "null", ";", "for", "(", "InstanceInfo", "instance", ":", "instancesByVipAddress", ")", "{", "if", "(", "instance", ".", "getHostName", "(", ")", ".", "equals", "(", "instance1Hostname", ")", ")", "{", "localInstance1", "=", "instance", ";", "}", "else", "if", "(", "instance", ".", "getHostName", "(", ")", ".", "equals", "(", "instance2Hostname", ")", ")", "{", "localInstance2", "=", "instance", ";", "}", "}", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ",", "localInstance1", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ",", "localInstance2", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "setupProperties", "(", ")", ";", "populateLocalRegistryAtStartup", "(", ")", ";", "populateRemoteRegistryAtStartup", "(", ")", ";", "setupDiscoveryClient", "(", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "shutdownDiscoveryClient", "(", ")", ";", "DiscoveryClientRule", ".", "clearDiscoveryClientConfig", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDefaults", "(", ")", "throws", "Exception", "{", "PropertyBasedAzToRegionMapper", "azToRegionMapper", "=", "new", "PropertyBasedAzToRegionMapper", "(", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "InstanceRegionChecker", "checker", "=", "new", "InstanceRegionChecker", "(", "azToRegionMapper", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azToRegionMapper", ".", "setRegionsToFetch", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT>", "\"", "}", ")", ";", "AmazonInfo", "dcInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "dcInfo", ")", ".", "build", "(", ")", ";", "String", "instanceRegion", "=", "checker", ".", "getInstanceRegion", "(", "instanceInfo", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "instanceRegion", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDefaultOverride", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PropertyBasedAzToRegionMapper", "azToRegionMapper", "=", "new", "PropertyBasedAzToRegionMapper", "(", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "InstanceRegionChecker", "checker", "=", "new", "InstanceRegionChecker", "(", "azToRegionMapper", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azToRegionMapper", ".", "setRegionsToFetch", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT>", "\"", "}", ")", ";", "AmazonInfo", "dcInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "dcInfo", ")", ".", "build", "(", ")", ";", "String", "instanceRegion", "=", "checker", ".", "getInstanceRegion", "(", "instanceInfo", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "instanceRegion", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceWithNoAZ", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PropertyBasedAzToRegionMapper", "azToRegionMapper", "=", "new", "PropertyBasedAzToRegionMapper", "(", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "InstanceRegionChecker", "checker", "=", "new", "InstanceRegionChecker", "(", "azToRegionMapper", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azToRegionMapper", ".", "setRegionsToFetch", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT>", "\"", "}", ")", ";", "AmazonInfo", "dcInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "\"", "\"", ")", ".", "build", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "dcInfo", ")", ".", "build", "(", ")", ";", "String", "instanceRegion", "=", "checker", ".", "getInstanceRegion", "(", "instanceInfo", ")", ";", "Assert", ".", "assertNull", "(", "\"", "<STR_LIT>", "\"", ",", "instanceRegion", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNotMappedAZ", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PropertyBasedAzToRegionMapper", "azToRegionMapper", "=", "new", "PropertyBasedAzToRegionMapper", "(", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "InstanceRegionChecker", "checker", "=", "new", "InstanceRegionChecker", "(", "azToRegionMapper", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azToRegionMapper", ".", "setRegionsToFetch", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT>", "\"", "}", ")", ";", "AmazonInfo", "dcInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "dcInfo", ")", ".", "build", "(", ")", ";", "String", "instanceRegion", "=", "checker", ".", "getInstanceRegion", "(", "instanceInfo", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "instanceRegion", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNotMappedAZNotFollowingFormat", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PropertyBasedAzToRegionMapper", "azToRegionMapper", "=", "new", "PropertyBasedAzToRegionMapper", "(", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "InstanceRegionChecker", "checker", "=", "new", "InstanceRegionChecker", "(", "azToRegionMapper", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azToRegionMapper", ".", "setRegionsToFetch", "(", "new", "String", "[", "]", "{", "\"", "<STR_LIT>", "\"", "}", ")", ";", "AmazonInfo", "dcInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "dcInfo", ")", ".", "build", "(", ")", ";", "String", "instanceRegion", "=", "checker", ".", "getInstanceRegion", "(", "instanceInfo", ")", ";", "Assert", ".", "assertNull", "(", "\"", "<STR_LIT>", "\"", ",", "instanceRegion", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "mockLocalEurekaServer", "=", "new", "MockRemoteEurekaServer", "(", ")", ";", "mockLocalEurekaServer", ".", "start", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "mockLocalEurekaServer", ".", "getPort", "(", ")", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "builder", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ";", "client", "=", "new", "DiscoveryClient", "(", "builder", ".", "build", "(", ")", ",", "new", "DefaultEurekaClientConfig", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDisableFetchRegistry", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertFalse", "(", "\"", "<STR_LIT>", "\"", ",", "mockLocalEurekaServer", ".", "isSentRegistry", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "final", "int", "eurekaPort", "=", "mockLocalEurekaServer", ".", "getPort", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "CLIENT_REFRESH_RATE", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_ZONE", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "eurekaPort", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "populateLocalRegistryAtStartup", "(", ")", ";", "populateRemoteRegistryAtStartup", "(", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setHostName", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ";", "builder", ".", "setAppName", "(", "LOCAL_REGION_APP_NAME", ")", ";", "builder", ".", "setStatus", "(", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ";", "builder", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ";", "instanceInfo", "=", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "Service", "(", "EurekaClient", "client", ",", "@", "UpStatus", "Supplier", "<", "Boolean", ">", "upStatusSupplier", ",", "@", "DownStatus", "Supplier", "<", "Boolean", ">", "dnStatusSupplier", ",", "EurekaUpStatusResolver", "status", ")", "{", "this", ".", "client", "=", "client", ";", "this", ".", "status", "=", "status", ";", "this", ".", "upStatusSupplier", "=", "upStatusSupplier", ";", "this", ".", "dnStatusSupplier", "=", "dnStatusSupplier", ";", "assertState", "(", "true", ")", ";", "}", "</s>"]
["<s>", "public", "void", "assertState", "(", "boolean", "state", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "status", ".", "getChangeCount", "(", ")", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "upStatusSupplier", ".", "get", "(", ")", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "dnStatusSupplier", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "state", ",", "(", "boolean", ")", "upStatusSupplier", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "state", ",", "!", "dnStatusSupplier", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "@", "Ignore", "public", "void", "testStatus", "(", ")", "throws", "Exception", "{", "Injector", "injector", "=", "LifecycleInjector", ".", "builder", "(", ")", ".", "withMode", "(", "LifecycleInjectorMode", ".", "SIMULATED_CHILD_INJECTORS", ")", ".", "withBootstrapModule", "(", "new", "BootstrapModule", "(", ")", "{", "@", "Override", "public", "void", "configure", "(", "BootstrapBinder", "binder", ")", "{", "Properties", "props", "=", "new", "Properties", "(", ")", ";", "props", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "STATUS_REFRESH_RATE", ")", ";", "binder", ".", "bindConfigurationProvider", "(", ")", ".", "toInstance", "(", "new", "PropertiesConfigurationProvider", "(", "props", ")", ")", ";", "}", "}", ")", ".", "withRootModule", "(", "InternalEurekaStatusModule", ".", "class", ")", ".", "withModules", "(", "new", "AbstractModule", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "EventBus", ".", "class", ")", ".", "toInstance", "(", "eventBus", ")", ";", "bind", "(", "Service", ".", "class", ")", ";", "bind", "(", "InstanceInfo", ".", "class", ")", ".", "toInstance", "(", "instanceInfo", ")", ";", "}", "}", ")", ".", "build", "(", ")", ".", "createInjector", "(", ")", ";", "Service", "service", "=", "injector", ".", "getInstance", "(", "Service", ".", "class", ")", ";", "mockLocalEurekaServer", ".", "waitForDeltaToBeRetrieved", "(", "CLIENT_REFRESH_RATE", ")", ";", "service", ".", "assertState", "(", "true", ")", ";", "DiscoveryClient", "client", "=", "injector", ".", "getInstance", "(", "DiscoveryClient", ".", "class", ")", ";", "client", ".", "unregister", "(", ")", ";", "mockLocalEurekaServer", ".", "waitForDeltaToBeRetrieved", "(", "CLIENT_REFRESH_RATE", ")", ";", "TimeUnit", ".", "SECONDS", ".", "sleep", "(", "CLIENT_REFRESH_RATE", "*", "<NUM_LIT:2>", ")", ";", "service", ".", "assertState", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "configure", "(", "BootstrapBinder", "binder", ")", "{", "Properties", "props", "=", "new", "Properties", "(", ")", ";", "props", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "STATUS_REFRESH_RATE", ")", ";", "binder", ".", "bindConfigurationProvider", "(", ")", ".", "toInstance", "(", "new", "PropertiesConfigurationProvider", "(", "props", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "EventBus", ".", "class", ")", ".", "toInstance", "(", "eventBus", ")", ";", "bind", "(", "Service", ".", "class", ")", ";", "bind", "(", "InstanceInfo", ".", "class", ")", ".", "toInstance", "(", "instanceInfo", ")", ";", "}", "</s>"]
["<s>", "private", "void", "populateLocalRegistryAtStartup", "(", ")", "{", "Application", "myapp", "=", "createLocalApps", "(", ")", ";", "Application", "myappDelta", "=", "createLocalAppsDelta", "(", ")", ";", "mockLocalEurekaServer", ".", "addLocalRegionApps", "(", "LOCAL_REGION_APP_NAME", ",", "myapp", ")", ";", "mockLocalEurekaServer", ".", "addLocalRegionAppsDelta", "(", "LOCAL_REGION_APP_NAME", ",", "myappDelta", ")", ";", "}", "</s>"]
["<s>", "private", "Application", "createLocalApps", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "LOCAL_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "Application", "createLocalAppsDelta", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "LOCAL_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_2_HOSTNAME", ")", ";", "instanceInfo", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "createLocalInstance", "(", "String", "instanceHostName", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "LOCAL_REGION_APP_NAME", ")", ";", "instanceBuilder", ".", "setVIPAddress", "(", "ALL_REGIONS_VIP_ADDR", ")", ";", "instanceBuilder", ".", "setHostName", "(", "instanceHostName", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "AmazonInfo", "amazonInfo", "=", "getAmazonInfo", "(", "null", ",", "instanceHostName", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "amazonInfo", ")", ";", "instanceBuilder", ".", "setMetadata", "(", "amazonInfo", ".", "getMetadata", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "AmazonInfo", "getAmazonInfo", "(", "@", "Nullable", "String", "availabilityZone", ",", "String", "instanceHostName", ")", "{", "AmazonInfo", ".", "Builder", "azBuilder", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "(", "null", "=", "=", "availabilityZone", ")", "?", "\"", "<STR_LIT>", "\"", ":", "availabilityZone", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceId", ",", "instanceHostName", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "amiId", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceType", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "localIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicHostname", ",", "instanceHostName", ")", ";", "return", "azBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "populateRemoteRegistryAtStartup", "(", ")", "{", "Application", "myapp", "=", "createRemoteApps", "(", ")", ";", "Application", "myappDelta", "=", "createRemoteAppsDelta", "(", ")", ";", "mockLocalEurekaServer", ".", "addRemoteRegionApps", "(", "REMOTE_REGION_APP_NAME", ",", "myapp", ")", ";", "mockLocalEurekaServer", ".", "addRemoteRegionAppsDelta", "(", "REMOTE_REGION_APP_NAME", ",", "myappDelta", ")", ";", "}", "</s>"]
["<s>", "private", "Application", "createRemoteApps", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "REMOTE_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createRemoteInstance", "(", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "Application", "createRemoteAppsDelta", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "REMOTE_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createRemoteInstance", "(", "REMOTE_REGION_INSTANCE_2_HOSTNAME", ")", ";", "instanceInfo", ".", "setActionType", "(", "InstanceInfo", ".", "ActionType", ".", "ADDED", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "createRemoteInstance", "(", "String", "instanceHostName", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "REMOTE_REGION_APP_NAME", ")", ";", "instanceBuilder", ".", "setVIPAddress", "(", "ALL_REGIONS_VIP_ADDR", ")", ";", "instanceBuilder", ".", "setHostName", "(", "instanceHostName", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "AmazonInfo", "amazonInfo", "=", "getAmazonInfo", "(", "REMOTE_ZONE", ",", "instanceHostName", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "amazonInfo", ")", ";", "instanceBuilder", ".", "setMetadata", "(", "amazonInfo", ".", "getMetadata", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "scheduler", "=", "Executors", ".", "newScheduledThreadPool", "(", "<NUM_LIT:4>", ",", "new", "ThreadFactoryBuilder", "(", ")", ".", "setNameFormat", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDaemon", "(", "true", ")", ".", "build", "(", ")", ")", ";", "helperExecutor", "=", "MoreExecutors", ".", "listeningDecorator", "(", "Executors", ".", "newFixedThreadPool", "(", "<NUM_LIT:10>", ")", ")", ";", "executor", "=", "new", "ThreadPoolExecutor", "(", "1", ",", "<NUM_LIT:3>", ",", "0", ",", "TimeUnit", ".", "SECONDS", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ")", ";", "testTaskStartCounter", "=", "new", "AtomicLong", "(", "0", ")", ";", "testTaskSuccessfulCounter", "=", "new", "AtomicLong", "(", "0", ")", ";", "testTaskInterruptedCounter", "=", "new", "AtomicLong", "(", "0", ")", ";", "maxConcurrentTestTasks", "=", "new", "AtomicLong", "(", "0", ")", ";", "testTaskCounter", "=", "new", "AtomicLong", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "if", "(", "executor", "!", "=", "null", ")", "{", "executor", ".", "shutdownNow", "(", ")", ";", "}", "if", "(", "helperExecutor", "!", "=", "null", ")", "{", "helperExecutor", ".", "shutdownNow", "(", ")", ";", "}", "if", "(", "scheduler", "!", "=", "null", ")", "{", "scheduler", ".", "shutdownNow", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSupervisorTaskDefaultSingleTestTaskHappyCase", "(", ")", "throws", "Exception", "{", "TestTask", "testTask", "=", "new", "TestTask", "(", "1", ",", "false", ")", ";", "TimedSupervisorTask", "supervisorTask", "=", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "executor", ",", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ",", "EXP_BACK_OFF_BOUND", ",", "testTask", ")", ";", "helperExecutor", ".", "submit", "(", "supervisorTask", ")", ".", "get", "(", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "maxConcurrentTestTasks", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "testTaskStartCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "testTaskSuccessfulCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskInterruptedCounter", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSupervisorTaskCancelsTimedOutTask", "(", ")", "throws", "Exception", "{", "TestTask", "testTask", "=", "new", "TestTask", "(", "<NUM_LIT:5>", ",", "false", ")", ";", "TimedSupervisorTask", "supervisorTask", "=", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "executor", ",", "1", ",", "TimeUnit", ".", "SECONDS", ",", "EXP_BACK_OFF_BOUND", ",", "testTask", ")", ";", "helperExecutor", ".", "submit", "(", "supervisorTask", ")", ".", "get", "(", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "maxConcurrentTestTasks", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "testTaskCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "testTaskStartCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskSuccessfulCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "testTaskInterruptedCounter", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSupervisorRejectNewTasksIfThreadPoolIsFullForIncompleteTasks", "(", ")", "throws", "Exception", "{", "TestTask", "testTask", "=", "new", "TestTask", "(", "<NUM_LIT:4>", ",", "true", ")", ";", "TimedSupervisorTask", "supervisorTask", "=", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "executor", ",", "1", ",", "TimeUnit", ".", "MILLISECONDS", ",", "EXP_BACK_OFF_BOUND", ",", "testTask", ")", ";", "scheduler", ".", "schedule", "(", "supervisorTask", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:3>", ",", "maxConcurrentTestTasks", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:3>", ",", "testTaskCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "<NUM_LIT:3>", ",", "testTaskStartCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskSuccessfulCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskInterruptedCounter", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSupervisorTaskAsPeriodicScheduledJobHappyCase", "(", ")", "throws", "Exception", "{", "TestTask", "testTask", "=", "new", "TestTask", "(", "1", ",", "false", ")", ";", "TimedSupervisorTask", "supervisorTask", "=", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "executor", ",", "<NUM_LIT:4>", ",", "TimeUnit", ".", "SECONDS", ",", "EXP_BACK_OFF_BOUND", ",", "testTask", ")", ";", "scheduler", ".", "schedule", "(", "supervisorTask", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "maxConcurrentTestTasks", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskInterruptedCounter", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSupervisorTaskAsPeriodicScheduledJobTestTaskTimingOut", "(", ")", "throws", "Exception", "{", "TestTask", "testTask", "=", "new", "TestTask", "(", "<NUM_LIT:5>", ",", "false", ")", ";", "TimedSupervisorTask", "supervisorTask", "=", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "executor", ",", "<NUM_LIT:2>", ",", "TimeUnit", ".", "SECONDS", ",", "EXP_BACK_OFF_BOUND", ",", "testTask", ")", ";", "scheduler", ".", "schedule", "(", "supervisorTask", ",", "0", ",", "TimeUnit", ".", "SECONDS", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "maxConcurrentTestTasks", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertTrue", "(", "0", "!", "=", "testTaskCounter", ".", "get", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "0", ",", "testTaskSuccessfulCounter", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "TestTask", "(", "int", "runTimeSecs", ",", "boolean", "blockInterrupt", ")", "{", "this", ".", "runTimeSecs", "=", "runTimeSecs", ";", "this", ".", "blockInterrupt", "=", "blockInterrupt", ";", "}", "</s>"]
["<s>", "public", "void", "run", "(", ")", "{", "testTaskStartCounter", ".", "incrementAndGet", "(", ")", ";", "try", "{", "testTaskCounter", ".", "incrementAndGet", "(", ")", ";", "synchronized", "(", "maxConcurrentTestTasks", ")", "{", "int", "activeCount", "=", "executor", ".", "getActiveCount", "(", ")", ";", "if", "(", "maxConcurrentTestTasks", ".", "get", "(", ")", "<", "activeCount", ")", "{", "maxConcurrentTestTasks", ".", "set", "(", "activeCount", ")", ";", "}", "}", "long", "endTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "runTimeSecs", "*", "<NUM_LIT:1000>", ";", "while", "(", "endTime", ">", "=", "System", ".", "currentTimeMillis", "(", ")", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "runTimeSecs", "*", "<NUM_LIT:1000>", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "if", "(", "!", "blockInterrupt", ")", "{", "throw", "e", ";", "}", "}", "}", "testTaskCounter", ".", "decrementAndGet", "(", ")", ";", "testTaskSuccessfulCounter", ".", "incrementAndGet", "(", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "testTaskInterruptedCounter", ".", "incrementAndGet", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "setupProperties", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:5>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "mockLocalEurekaServer", ".", "getPort", "(", ")", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "populateLocalRegistryAtStartup", "(", ")", ";", "populateRemoteRegistryAtStartup", "(", ")", ";", "LifecycleInjectorBuilder", "builder", "=", "LifecycleInjector", ".", "builder", "(", ")", ".", "withMode", "(", "LifecycleInjectorMode", ".", "SIMULATED_CHILD_INJECTORS", ")", ";", "Module", "testModule", "=", "Modules", ".", "override", "(", "new", "EurekaModule", "(", ")", ")", ".", "with", "(", "new", "AbstractModule", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "toProvider", "(", "MyDataCenterInstanceConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EventBus", ".", "class", ")", ".", "to", "(", "EventBusImpl", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "}", ")", ";", "builder", ".", "withModules", "(", "testModule", ")", ";", "injector", "=", "builder", ".", "build", "(", ")", ".", "createInjector", "(", ")", ";", "lifecycleManager", "=", "injector", ".", "getInstance", "(", "LifecycleManager", ".", "class", ")", ";", "lifecycleManager", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "toProvider", "(", "MyDataCenterInstanceConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EventBus", ".", "class", ")", ".", "to", "(", "EventBusImpl", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "if", "(", "lifecycleManager", "!", "=", "null", ")", "{", "lifecycleManager", ".", "close", "(", ")", ";", "}", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusChangeEvent", "(", ")", "throws", "Exception", "{", "final", "CountDownLatch", "eventLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "List", "<", "StatusChangeEvent", ">", "receivedEvents", "=", "new", "ArrayList", "<", "StatusChangeEvent", ">", "(", ")", ";", "EventBus", "eventBus", "=", "injector", ".", "getInstance", "(", "EventBus", ".", "class", ")", ";", "eventBus", ".", "registerSubscriber", "(", "new", "Object", "(", ")", "{", "@", "Subscribe", "public", "void", "consume", "(", "StatusChangeEvent", "event", ")", "{", "receivedEvents", ".", "add", "(", "event", ")", ";", "eventLatch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "injector", ".", "getInstance", "(", "ApplicationInfoManager", ".", "class", ")", ".", "setInstanceStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "Assert", ".", "assertTrue", "(", "eventLatch", ".", "await", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "receivedEvents", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "receivedEvents", ".", "get", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Subscribe", "public", "void", "consume", "(", "StatusChangeEvent", "event", ")", "{", "receivedEvents", ".", "add", "(", "event", ")", ";", "eventLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCacheRefreshEvent", "(", ")", "throws", "Exception", "{", "final", "CountDownLatch", "eventLatch", "=", "new", "CountDownLatch", "(", "1", ")", ";", "final", "List", "<", "CacheRefreshedEvent", ">", "receivedEvents", "=", "new", "ArrayList", "<", "CacheRefreshedEvent", ">", "(", ")", ";", "EventBus", "eventBus", "=", "injector", ".", "getInstance", "(", "EventBus", ".", "class", ")", ";", "eventBus", ".", "registerSubscriber", "(", "new", "Object", "(", ")", "{", "@", "Subscribe", "public", "void", "consume", "(", "CacheRefreshedEvent", "event", ")", "{", "receivedEvents", ".", "add", "(", "event", ")", ";", "eventLatch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "Assert", ".", "assertTrue", "(", "eventLatch", ".", "await", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ")", ";", "Assert", ".", "assertEquals", "(", "1", ",", "receivedEvents", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "receivedEvents", ".", "get", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Subscribe", "public", "void", "consume", "(", "CacheRefreshedEvent", "event", ")", "{", "receivedEvents", ".", "add", "(", "event", ")", ";", "eventLatch", ".", "countDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "setupProperties", "(", ")", "{", "super", ".", "setupProperties", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "InstanceInfo", ".", "Builder", "newInstanceInfoBuilder", "(", "int", "renewalIntervalInSecs", ")", "{", "InstanceInfo", ".", "Builder", "builder", "=", "super", ".", "newInstanceInfoBuilder", "(", "renewalIntervalInSecs", ")", ";", "builder", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "STARTING", ")", ";", "return", "builder", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCallback", "(", ")", "throws", "Exception", "{", "MyHealthCheckCallback", "myCallback", "=", "new", "MyHealthCheckCallback", "(", "true", ")", ";", "client", ".", "registerHealthCheckCallback", "(", "myCallback", ")", ";", "Assert", ".", "assertTrue", "(", "client", "instanceof", "DiscoveryClient", ")", ";", "DiscoveryClient", "clientImpl", "=", "(", "DiscoveryClient", ")", "client", ";", "InstanceInfoReplicator", "instanceInfoReplicator", "=", "clientImpl", ".", "getInstanceInfoReplicator", "(", ")", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "STARTING", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "Assert", ".", "assertFalse", "(", "\"", "<STR_LIT>", "\"", ",", "myCallback", ".", "isInvoked", "(", ")", ")", ";", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "myCallback", ".", "reset", "(", ")", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertFalse", "(", "\"", "<STR_LIT>", "\"", ",", "myCallback", ".", "isInvoked", "(", ")", ")", ";", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "myCallback", ".", "reset", "(", ")", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "myCallback", ".", "isInvoked", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHandler", "(", ")", "throws", "Exception", "{", "MyHealthCheckHandler", "myHealthCheckHandler", "=", "new", "MyHealthCheckHandler", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "client", ".", "registerHealthCheck", "(", "myHealthCheckHandler", ")", ";", "Assert", ".", "assertTrue", "(", "client", "instanceof", "DiscoveryClient", ")", ";", "DiscoveryClient", "clientImpl", "=", "(", "DiscoveryClient", ")", "client", ";", "InstanceInfoReplicator", "instanceInfoReplicator", "=", "clientImpl", ".", "getInstanceInfoReplicator", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "STARTING", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "myHealthCheckHandler", ".", "isInvoked", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "myHealthCheckHandler", ".", "reset", "(", ")", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "myHealthCheckHandler", ".", "isInvoked", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "myHealthCheckHandler", ".", "reset", "(", ")", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "myHealthCheckHandler", ".", "isInvoked", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "myHealthCheckHandler", ".", "reset", "(", ")", ";", "myHealthCheckHandler", ".", "shouldException", "=", "true", ";", "instanceInfoReplicator", ".", "run", "(", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "myHealthCheckHandler", ".", "isInvoked", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ",", "clientImpl", ".", "getInstanceInfo", "(", ")", ".", "getStatus", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "MyHealthCheckCallback", "(", "boolean", "health", ")", "{", "this", ".", "health", "=", "health", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isHealthy", "(", ")", "{", "invoked", "=", "true", ";", "return", "health", ";", "}", "</s>"]
["<s>", "public", "boolean", "isInvoked", "(", ")", "{", "return", "invoked", ";", "}", "</s>"]
["<s>", "public", "void", "reset", "(", ")", "{", "invoked", "=", "false", ";", "}", "</s>"]
["<s>", "private", "MyHealthCheckHandler", "(", "InstanceInfo", ".", "InstanceStatus", "health", ")", "{", "this", ".", "health", "=", "health", ";", "}", "</s>"]
["<s>", "public", "boolean", "isInvoked", "(", ")", "{", "return", "invoked", ";", "}", "</s>"]
["<s>", "public", "void", "reset", "(", ")", "{", "shouldException", "=", "false", ";", "invoked", "=", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", ".", "InstanceStatus", "getStatus", "(", "InstanceInfo", ".", "InstanceStatus", "currentStatus", ")", "{", "invoked", "=", "true", ";", "if", "(", "shouldException", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "health", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEvenLoad", "(", ")", "{", "RateLimiter", "secondLimiter", "=", "new", "RateLimiter", "(", "TimeUnit", ".", "SECONDS", ")", ";", "long", "secondStep", "=", "<NUM_LIT:1000>", "/", "AVERAGE_RATE", ";", "testEvenLoad", "(", "secondLimiter", ",", "START", ",", "BURST_SIZE", ",", "AVERAGE_RATE", ",", "secondStep", ")", ";", "RateLimiter", "minuteLimiter", "=", "new", "RateLimiter", "(", "TimeUnit", ".", "MINUTES", ")", ";", "long", "minuteStep", "=", "<NUM_LIT>", "*", "<NUM_LIT:1000>", "/", "AVERAGE_RATE", ";", "testEvenLoad", "(", "minuteLimiter", ",", "START", ",", "BURST_SIZE", ",", "AVERAGE_RATE", ",", "minuteStep", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testEvenLoad", "(", "RateLimiter", "rateLimiter", ",", "long", "start", ",", "int", "burstSize", ",", "int", "averageRate", ",", "long", "step", ")", "{", "for", "(", "long", "currentTime", "=", "start", ";", "currentTime", "<", "<NUM_LIT:3>", ";", "currentTime", "+", "=", "step", ")", "{", "assertTrue", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "currentTime", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBursts", "(", ")", "{", "RateLimiter", "secondLimiter", "=", "new", "RateLimiter", "(", "TimeUnit", ".", "SECONDS", ")", ";", "long", "secondStep", "=", "<NUM_LIT:1000>", "/", "AVERAGE_RATE", ";", "testBursts", "(", "secondLimiter", ",", "START", ",", "BURST_SIZE", ",", "AVERAGE_RATE", ",", "secondStep", ")", ";", "RateLimiter", "minuteLimiter", "=", "new", "RateLimiter", "(", "TimeUnit", ".", "MINUTES", ")", ";", "long", "minuteStep", "=", "<NUM_LIT>", "*", "<NUM_LIT:1000>", "/", "AVERAGE_RATE", ";", "testBursts", "(", "minuteLimiter", ",", "START", ",", "BURST_SIZE", ",", "AVERAGE_RATE", ",", "minuteStep", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testBursts", "(", "RateLimiter", "rateLimiter", ",", "long", "start", ",", "int", "burstSize", ",", "int", "averageRate", ",", "long", "step", ")", "{", "assertTrue", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "start", ")", ")", ";", "assertTrue", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "start", ")", ")", ";", "assertFalse", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "start", ")", ")", ";", "assertTrue", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "start", "+", "step", "+", "step", "/", "<NUM_LIT:2>", ")", ")", ";", "assertFalse", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "start", "+", "step", "+", "step", "/", "<NUM_LIT:2>", ")", ")", ";", "assertTrue", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "averageRate", ",", "start", "+", "<NUM_LIT:2>", "*", "step", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRequestedManifestIsLocatedAndLoaded", "(", ")", "throws", "Exception", "{", "DiscoveryBuildInfo", "buildInfo", "=", "new", "DiscoveryBuildInfo", "(", "ObjectMapper", ".", "class", ")", ";", "assertThat", "(", "buildInfo", ".", "getBuildVersion", "(", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "false", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "LifecycleInjectorBuilder", "builder", "=", "LifecycleInjector", ".", "builder", "(", ")", ".", "withMode", "(", "LifecycleInjectorMode", ".", "SIMULATED_CHILD_INJECTORS", ")", ";", "Module", "testModule", "=", "Modules", ".", "override", "(", "new", "EurekaModule", "(", ")", ")", ".", "with", "(", "new", "AbstractModule", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "toProvider", "(", "MyDataCenterInstanceConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "}", ")", ";", "builder", ".", "withModules", "(", "testModule", ")", ";", "injector", "=", "builder", ".", "build", "(", ")", ".", "createInjector", "(", ")", ";", "lifecycleManager", "=", "injector", ".", "getInstance", "(", "LifecycleManager", ".", "class", ")", ";", "lifecycleManager", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "toProvider", "(", "MyDataCenterInstanceConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "if", "(", "lifecycleManager", "!", "=", "null", ")", "{", "lifecycleManager", ".", "close", "(", ")", ";", "}", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Test", "public", "void", "testDI", "(", ")", "{", "InstanceInfo", "instanceInfo", "=", "injector", ".", "getInstance", "(", "InstanceInfo", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ",", "instanceInfo", ")", ";", "EurekaClient", "eurekaClient", "=", "injector", ".", "getInstance", "(", "EurekaClient", ".", "class", ")", ";", "DiscoveryClient", "discoveryClient", "=", "injector", ".", "getInstance", "(", "DiscoveryClient", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClient", "(", ")", ",", "eurekaClient", ")", ";", "Assert", ".", "assertEquals", "(", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getDiscoveryClient", "(", ")", ",", "discoveryClient", ")", ";", "Assert", ".", "assertEquals", "(", "eurekaClient", ",", "discoveryClient", ")", ";", "EurekaClientConfig", "eurekaClientConfig", "=", "injector", ".", "getInstance", "(", "EurekaClientConfig", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClientConfig", "(", ")", ",", "eurekaClientConfig", ")", ";", "EurekaInstanceConfig", "eurekaInstanceConfig", "=", "injector", ".", "getInstance", "(", "EurekaInstanceConfig", ".", "class", ")", ";", "Assert", ".", "assertEquals", "(", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaInstanceConfig", "(", ")", ",", "eurekaInstanceConfig", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testVerifyStringsAreGarbageCollectedIfNotReferenced", "(", ")", "throws", "Exception", "{", "StringCache", "cache", "=", "new", "StringCache", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "CACHE_SIZE", ";", "i", "+", "+", ")", "{", "cache", ".", "cachedValueOf", "(", "\"", "<STR_LIT:#>", "\"", "+", "i", ")", ";", "}", "gc", "(", ")", ";", "assertTrue", "(", "cache", ".", "size", "(", ")", "<", "CACHE_SIZE", "*", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "gc", "(", ")", "{", "System", ".", "gc", "(", ")", ";", "System", ".", "runFinalization", "(", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "public", "CodecLoadTester", "(", "int", "instanceCount", ",", "int", "appCount", ")", "{", "Iterator", "<", "InstanceInfo", ">", "instanceIt", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "instanceCount", ",", "appCount", ")", ".", "withMetaData", "(", "true", ")", ".", "build", "(", ")", ".", "serviceIterator", "(", ")", ";", "applications", "=", "new", "Applications", "(", ")", ";", "int", "appIdx", "=", "0", ";", "while", "(", "instanceIt", ".", "hasNext", "(", ")", ")", "{", "InstanceInfo", "next", "=", "instanceIt", ".", "next", "(", ")", ";", "instanceInfoList", ".", "add", "(", "next", ")", ";", "if", "(", "applicationList", ".", "size", "(", ")", "<", "=", "appIdx", ")", "{", "applicationList", ".", "add", "(", "new", "Application", "(", "next", ".", "getAppName", "(", ")", ")", ")", ";", "}", "applicationList", ".", "get", "(", "appIdx", ")", ".", "addInstance", "(", "next", ")", ";", "appIdx", "=", "(", "appIdx", "+", "1", ")", "%", "appCount", ";", "}", "for", "(", "Application", "app", ":", "applicationList", ")", "{", "applications", ".", "addApplication", "(", "app", ")", ";", "}", "applications", ".", "setAppsHashCode", "(", "applications", ".", "getReconcileHashCode", "(", ")", ")", ";", "firstHolder", ".", "value", "=", "applications", ";", "}", "</s>"]
["<s>", "public", "CodecLoadTester", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "if", "(", "args", ".", "length", "!", "=", "1", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "throw", "new", "IllegalArgumentException", "(", ")", ";", "}", "String", "fileName", "=", "args", "[", "0", "]", ";", "Applications", "applications", ";", "try", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "fileName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "applications", "=", "loadWithCodec", "(", "fileName", ",", "MediaType", ".", "APPLICATION_XML_TYPE", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "fileName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "applications", "=", "loadWithCodec", "(", "fileName", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "}", "this", ".", "applications", "=", "applications", ";", "long", "totalInstances", "=", "0", ";", "for", "(", "Application", "a", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "totalInstances", "+", "=", "a", ".", "getInstances", "(", ")", ".", "size", "(", ")", ";", "}", "System", ".", "out", ".", "printf", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "applications", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", ",", "totalInstances", ")", ";", "firstHolder", ".", "value", "=", "applications", ";", "}", "</s>"]
["<s>", "private", "Applications", "loadWithCodec", "(", "String", "fileName", ",", "MediaType", "mediaType", ")", "throws", "IOException", "{", "FileInputStream", "fis", "=", "new", "FileInputStream", "(", "fileName", ")", ";", "BufferedInputStream", "bis", "=", "new", "BufferedInputStream", "(", "fis", ")", ";", "return", "(", "Applications", ")", "xstreamCodec", ".", "read", "(", "bis", ",", "Applications", ".", "class", ",", "mediaType", ")", ";", "}", "</s>"]
["<s>", "public", "void", "runApplicationsLoadTest", "(", "int", "loops", ",", "Func0", "<", "Applications", ">", "action", ")", "{", "long", "size", "=", "0", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "loops", ";", "i", "+", "+", ")", "{", "size", "+", "=", "action", ".", "call", "(", "applications", ")", ";", "}", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "formatSize", "(", "size", "/", "loops", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "runApplicationLoadTest", "(", "int", "loops", ",", "Func0", "<", "Application", ">", "action", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "loops", ";", "i", "+", "+", ")", "{", "action", ".", "call", "(", "applicationList", ".", "get", "(", "i", "%", "applicationList", ".", "size", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "runInstanceInfoLoadTest", "(", "int", "loops", ",", "Func0", "<", "InstanceInfo", ">", "action", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "loops", ";", "i", "+", "+", ")", "{", "action", ".", "call", "(", "instanceInfoList", ".", "get", "(", "i", "%", "instanceInfoList", ".", "size", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "runInstanceInfoIntervalTest", "(", "int", "batch", ",", "int", "intervalMs", ",", "long", "durationSec", ",", "Func0", "action", ")", "{", "long", "startTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "long", "endTime", "=", "startTime", "+", "durationSec", "*", "<NUM_LIT:1000>", ";", "long", "now", ";", "do", "{", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "runInstanceInfoLoadTest", "(", "batch", ",", "action", ")", ";", "long", "waiting", "=", "intervalMs", "-", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "now", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "waiting", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "waiting", ">", "0", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "waiting", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "}", "}", "while", "(", "now", "<", "endTime", ")", ";", "}", "</s>"]
["<s>", "public", "void", "runApplicationIntervalTest", "(", "int", "batch", ",", "int", "intervalMs", ",", "long", "durationSec", ",", "Func0", "action", ")", "{", "long", "startTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "long", "endTime", "=", "startTime", "+", "durationSec", "*", "<NUM_LIT:1000>", ";", "long", "now", ";", "do", "{", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "runApplicationLoadTest", "(", "batch", ",", "action", ")", ";", "long", "waiting", "=", "intervalMs", "-", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "now", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "waiting", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "waiting", ">", "0", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "waiting", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "}", "}", "while", "(", "now", "<", "endTime", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "formatSize", "(", "long", "size", ")", "{", "if", "(", "size", "<", "<NUM_LIT:1000>", ")", "{", "return", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "size", ")", ";", "}", "if", "(", "size", "<", "<NUM_LIT>", "*", "<NUM_LIT>", ")", "{", "return", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "size", "/", "<NUM_LIT>", "f", ")", ";", "}", "return", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "size", "/", "(", "<NUM_LIT>", "f", "*", "<NUM_LIT>", "f", ")", ")", ";", "}", "</s>"]
["<s>", "int", "call", "(", "T", "data", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "int", "call", "(", "Object", "object", ")", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "try", "{", "legacyJacksonCodec", ".", "writeTo", "(", "object", ",", "captureStream", ")", ";", "byte", "[", "]", "bytes", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "legacyJacksonCodec", ".", "readValue", "(", "object", ".", "getClass", "(", ")", ",", "source", ")", ";", "return", "bytes", ".", "length", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "call", "(", "Object", "object", ")", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "try", "{", "xstreamCodec", ".", "write", "(", "object", ",", "captureStream", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "byte", "[", "]", "bytes", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "xstreamCodec", ".", "read", "(", "source", ",", "InstanceInfo", ".", "class", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "return", "bytes", ".", "length", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "call", "(", "Object", "object", ")", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "try", "{", "xstreamCodec", ".", "write", "(", "object", ",", "captureStream", ",", "MediaType", ".", "APPLICATION_XML_TYPE", ")", ";", "byte", "[", "]", "bytes", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "xstreamCodec", ".", "read", "(", "source", ",", "InstanceInfo", ".", "class", ",", "MediaType", ".", "APPLICATION_XML_TYPE", ")", ";", "return", "bytes", ".", "length", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "Func0", "createJacksonNgAction", "(", "final", "MediaType", "mediaType", ",", "final", "boolean", "compact", ")", "{", "return", "new", "Func0", "<", "Object", ">", "(", ")", "{", "@", "Override", "public", "int", "call", "(", "Object", "object", ")", "{", "AbstractEurekaJacksonCodec", "codec", ";", "if", "(", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ")", "{", "codec", "=", "compact", "?", "jsonCodecNgCompact", ":", "jsonCodecNG", ";", "}", "else", "{", "codec", "=", "compact", "?", "xmlCodecNgCompact", ":", "xmlCodecNG", ";", "}", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "try", "{", "codec", ".", "writeTo", "(", "object", ",", "captureStream", ")", ";", "byte", "[", "]", "bytes", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "Applications", "readValue", "=", "codec", ".", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "readValue", "(", "source", ",", "Applications", ".", "class", ")", ";", "secondHolder", ".", "value", "=", "readValue", ";", "return", "bytes", ".", "length", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "call", "(", "Object", "object", ")", "{", "AbstractEurekaJacksonCodec", "codec", ";", "if", "(", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ")", "{", "codec", "=", "compact", "?", "jsonCodecNgCompact", ":", "jsonCodecNG", ";", "}", "else", "{", "codec", "=", "compact", "?", "xmlCodecNgCompact", ":", "xmlCodecNG", ";", "}", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "try", "{", "codec", ".", "writeTo", "(", "object", ",", "captureStream", ")", ";", "byte", "[", "]", "bytes", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "Applications", "readValue", "=", "codec", ".", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "readValue", "(", "source", ",", "Applications", ".", "class", ")", ";", "secondHolder", ".", "value", "=", "readValue", ";", "return", "bytes", ".", "length", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "runFullSpeed", "(", ")", "{", "int", "loop", "=", "<NUM_LIT:5>", ";", "System", ".", "gc", "(", ")", ";", "long", "start", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "runApplicationsLoadTest", "(", "loop", ",", "createJacksonNgAction", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ",", "false", ")", ")", ";", "long", "executionTime", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "start", ";", "System", ".", "out", ".", "printf", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "executionTime", ")", ";", "}", "</s>"]
["<s>", "public", "void", "runIntervals", "(", ")", "{", "int", "batch", "=", "<NUM_LIT>", ";", "int", "intervalMs", "=", "<NUM_LIT:1000>", ";", "long", "durationSec", "=", "<NUM_LIT>", ";", "runInstanceInfoIntervalTest", "(", "batch", ",", "intervalMs", ",", "durationSec", ",", "xstreamJsonAction", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "CodecLoadTester", "loadTester", ";", "if", "(", "args", ".", "length", "=", "=", "0", ")", "{", "loadTester", "=", "new", "CodecLoadTester", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "}", "else", "{", "loadTester", "=", "new", "CodecLoadTester", "(", "args", ")", ";", "}", "loadTester", ".", "runFullSpeed", "(", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoJacksonEncodeDecode", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "INSTANCE_INFO_1_A1", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "InstanceInfo", "decoded", "=", "codec", ".", "readValue", "(", "InstanceInfo", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "INSTANCE_INFO_1_A1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoJacksonEncodeDecodeWithoutMetaData", "(", ")", "throws", "Exception", "{", "InstanceInfo", "noMetaDataInfo", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "1", ",", "1", ")", ".", "withMetaData", "(", "false", ")", ".", "build", "(", ")", ".", "serviceIterator", "(", ")", ".", "next", "(", ")", ";", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "noMetaDataInfo", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "InstanceInfo", "decoded", "=", "codec", ".", "readValue", "(", "InstanceInfo", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "noMetaDataInfo", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoXStreamEncodeJacksonDecode", "(", ")", "throws", "Exception", "{", "InstanceInfo", "original", "=", "INSTANCE_INFO_1_A1", ";", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "new", "EntityBodyConverter", "(", ")", ".", "write", "(", "original", ",", "captureStream", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "InstanceInfo", "decoded", "=", "codec", ".", "readValue", "(", "InstanceInfo", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "original", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoJacksonEncodeXStreamDecode", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "INSTANCE_INFO_1_A1", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "InstanceInfo", "decoded", "=", "(", "InstanceInfo", ")", "new", "EntityBodyConverter", "(", ")", ".", "read", "(", "source", ",", "InstanceInfo", ".", "class", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "INSTANCE_INFO_1_A1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationJacksonEncodeDecode", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "APPLICATION_1", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "Application", "decoded", "=", "codec", ".", "readValue", "(", "Application", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "APPLICATION_1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationXStreamEncodeJacksonDecode", "(", ")", "throws", "Exception", "{", "Application", "original", "=", "APPLICATION_1", ";", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "new", "EntityBodyConverter", "(", ")", ".", "write", "(", "original", ",", "captureStream", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "Application", "decoded", "=", "codec", ".", "readValue", "(", "Application", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "original", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationJacksonEncodeXStreamDecode", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "APPLICATION_1", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "Application", "decoded", "=", "(", "Application", ")", "new", "EntityBodyConverter", "(", ")", ".", "read", "(", "source", ",", "Application", ".", "class", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "APPLICATION_1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsJacksonEncodeDecode", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "APPLICATIONS", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "Applications", "decoded", "=", "codec", ".", "readValue", "(", "Applications", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "APPLICATIONS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsXStreamEncodeJacksonDecode", "(", ")", "throws", "Exception", "{", "Applications", "original", "=", "APPLICATIONS", ";", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "new", "EntityBodyConverter", "(", ")", ".", "write", "(", "original", ",", "captureStream", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "Applications", "decoded", "=", "codec", ".", "readValue", "(", "Applications", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "original", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsJacksonEncodeXStreamDecode", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "APPLICATIONS", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "Applications", "decoded", "=", "(", "Applications", ")", "new", "EntityBodyConverter", "(", ")", ".", "read", "(", "source", ",", "Applications", ".", "class", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "APPLICATIONS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testJacksonWriteToString", "(", ")", "throws", "Exception", "{", "String", "jsonValue", "=", "codec", ".", "writeToString", "(", "INSTANCE_INFO_1_A1", ")", ";", "InstanceInfo", "decoded", "=", "codec", ".", "readValue", "(", "InstanceInfo", ".", "class", ",", "new", "ByteArrayInputStream", "(", "jsonValue", ".", "getBytes", "(", "Charset", ".", "defaultCharset", "(", ")", ")", ")", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "INSTANCE_INFO_1_A1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testJacksonWrite", "(", ")", "throws", "Exception", "{", "ByteArrayOutputStream", "captureStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "codec", ".", "writeTo", "(", "INSTANCE_INFO_1_A1", ",", "captureStream", ")", ";", "byte", "[", "]", "encoded", "=", "captureStream", ".", "toByteArray", "(", ")", ";", "InputStream", "source", "=", "new", "ByteArrayInputStream", "(", "encoded", ")", ";", "InstanceInfo", "decoded", "=", "codec", ".", "readValue", "(", "InstanceInfo", ".", "class", ",", "source", ")", ";", "assertTrue", "(", "EurekaEntityComparators", ".", "equal", "(", "decoded", ",", "INSTANCE_INFO_1_A1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEncodingDecodingWithoutMetaData", "(", ")", "throws", "Exception", "{", "Applications", "applications", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:2>", ")", ".", "withMetaData", "(", "false", ")", ".", "build", "(", ")", ".", "toApplications", "(", ")", ";", "XStream", "xstream", "=", "XmlXStream", ".", "getInstance", "(", ")", ";", "String", "xmlDocument", "=", "xstream", ".", "toXML", "(", "applications", ")", ";", "Applications", "decodedApplications", "=", "(", "Applications", ")", "xstream", ".", "fromXML", "(", "xmlDocument", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "decodedApplications", ",", "applications", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEncodingDecodingWithMetaData", "(", ")", "throws", "Exception", "{", "Applications", "applications", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:2>", ")", ".", "withMetaData", "(", "true", ")", ".", "build", "(", ")", ".", "toApplications", "(", ")", ";", "XStream", "xstream", "=", "XmlXStream", ".", "getInstance", "(", ")", ";", "String", "xmlDocument", "=", "xstream", ".", "toXML", "(", "applications", ")", ";", "Applications", "decodedApplications", "=", "(", "Applications", ")", "xstream", ".", "fromXML", "(", "xmlDocument", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "decodedApplications", ",", "applications", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", ";", "</s>"]
["<s>", "@", "Deprecated", "@", "Test", "public", "void", "testInstanceInfoEncodeDecodeLegacyJacksonToJackson", "(", ")", "throws", "Exception", "{", "final", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "encodedString", "=", "encodedString", ".", "replaceFirst", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ",", "new", "EurekaEntityComparators", ".", "RawIdEqualFunc", "(", ")", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyForPair", "(", "codingAction", ",", "InstanceInfo", ".", "class", ",", "new", "CodecWrappers", ".", "LegacyJacksonJson", "(", ")", ",", "new", "CodecWrappers", ".", "JacksonJson", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "encodedString", "=", "encodedString", ".", "replaceFirst", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ",", "new", "EurekaEntityComparators", ".", "RawIdEqualFunc", "(", ")", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoEncodeDecodeJsonWithEmptyMetadataMap", "(", ")", "throws", "Exception", "{", "final", "InstanceInfo", "base", "=", "infoIterator", ".", "next", "(", ")", ";", "final", "InstanceInfo", "instanceInfo", "=", "new", "InstanceInfo", ".", "Builder", "(", "base", ")", ".", "setMetadata", "(", "Collections", ".", "EMPTY_MAP", ")", ".", "build", "(", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyAllPairs", "(", "codingAction", ",", "Application", ".", "class", ",", "availableJsonWrappers", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "Application", ".", "class", ",", "availableXmlWrappers", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoFullEncodeMiniDecodeJackson", "(", ")", "throws", "Exception", "{", "final", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyForPair", "(", "codingAction", ",", "InstanceInfo", ".", "class", ",", "new", "CodecWrappers", ".", "JacksonJson", "(", ")", ",", "new", "CodecWrappers", ".", "JacksonJsonMini", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoFullEncodeMiniDecodeJacksonWithMyOwnDataCenterInfo", "(", ")", "throws", "Exception", "{", "final", "InstanceInfo", "base", "=", "infoIterator", ".", "next", "(", ")", ";", "final", "InstanceInfo", "instanceInfo", "=", "new", "InstanceInfo", ".", "Builder", "(", "base", ")", ".", "setDataCenterInfo", "(", "new", "MyDataCenterInfo", "(", "DataCenterInfo", ".", "Name", ".", "MyOwn", ")", ")", ".", "build", "(", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyForPair", "(", "codingAction", ",", "InstanceInfo", ".", "class", ",", "new", "CodecWrappers", ".", "JacksonJson", "(", ")", ",", "new", "CodecWrappers", ".", "JacksonJsonMini", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoMiniEncodeMiniDecodeJackson", "(", ")", "throws", "Exception", "{", "final", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyForPair", "(", "codingAction", ",", "InstanceInfo", ".", "class", ",", "new", "CodecWrappers", ".", "JacksonJsonMini", "(", ")", ",", "new", "CodecWrappers", ".", "JacksonJsonMini", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoEncodeDecode", "(", ")", "throws", "Exception", "{", "final", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ",", "new", "EurekaEntityComparators", ".", "RawIdEqualFunc", "(", ")", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyAllPairs", "(", "codingAction", ",", "InstanceInfo", ".", "class", ",", "availableJsonWrappers", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "InstanceInfo", ".", "class", ",", "availableXmlWrappers", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ",", "new", "EurekaEntityComparators", ".", "RawIdEqualFunc", "(", ")", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationEncodeDecode", "(", ")", "throws", "Exception", "{", "final", "Application", "application", "=", "new", "Application", "(", "\"", "<STR_LIT>", "\"", ")", ";", "application", ".", "addInstance", "(", "infoIterator", ".", "next", "(", ")", ")", ";", "application", ".", "addInstance", "(", "infoIterator", ".", "next", "(", ")", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "application", ")", ";", "Application", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "Application", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "application", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyAllPairs", "(", "codingAction", ",", "Application", ".", "class", ",", "availableJsonWrappers", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "Application", ".", "class", ",", "availableXmlWrappers", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "application", ")", ";", "Application", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "Application", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "application", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsEncodeDecode", "(", ")", "throws", "Exception", "{", "final", "Applications", "applications", "=", "infoGenerator", ".", "takeDelta", "(", "<NUM_LIT:2>", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "applications", ")", ";", "Applications", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "Applications", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "applications", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "verifyAllPairs", "(", "codingAction", ",", "Applications", ".", "class", ",", "availableJsonWrappers", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "Applications", ".", "class", ",", "availableXmlWrappers", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "applications", ")", ";", "Applications", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "Applications", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "applications", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsJsonEncodeDecodeWithSingleAppItem", "(", ")", "throws", "Exception", "{", "final", "Applications", "applications", "=", "infoGenerator", ".", "takeDelta", "(", "1", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "applications", ")", ";", "assertThat", "(", "encodedString", ".", "contains", "(", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ")", ",", "is", "(", "true", ")", ")", ";", "Applications", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "Applications", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "applications", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", ";", "List", "<", "CodecWrapper", ">", "jsonCodes", "=", "Arrays", ".", "asList", "(", "new", "CodecWrappers", ".", "LegacyJacksonJson", "(", ")", ",", "new", "CodecWrappers", ".", "JacksonJson", "(", ")", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "Applications", ".", "class", ",", "jsonCodes", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "applications", ")", ";", "assertThat", "(", "encodedString", ".", "contains", "(", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ")", ",", "is", "(", "true", ")", ")", ";", "Applications", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "Applications", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "applications", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchRequestEncoding", "(", ")", "throws", "Exception", "{", "InstanceInfo", "instance", "=", "InstanceInfoGenerator", ".", "takeOne", "(", ")", ";", "List", "<", "ReplicationInstance", ">", "replicationInstances", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "replicationInstances", ".", "add", "(", "new", "ReplicationInstance", "(", "instance", ".", "getAppName", "(", ")", ",", "instance", ".", "getId", "(", ")", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "null", ",", "instance", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instance", ",", "Action", ".", "Register", ")", ")", ";", "final", "ReplicationList", "replicationList", "=", "new", "ReplicationList", "(", "replicationInstances", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "replicationList", ")", ";", "ReplicationList", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "ReplicationList", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getReplicationList", "(", ")", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "}", "}", ";", "List", "<", "CodecWrapper", ">", "jsonCodes", "=", "Arrays", ".", "asList", "(", "new", "CodecWrappers", ".", "JacksonJson", "(", ")", ",", "new", "CodecWrappers", ".", "LegacyJacksonJson", "(", ")", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "ReplicationList", ".", "class", ",", "jsonCodes", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "replicationList", ")", ";", "ReplicationList", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "ReplicationList", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getReplicationList", "(", ")", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchResponseEncoding", "(", ")", "throws", "Exception", "{", "List", "<", "ReplicationInstanceResponse", ">", "responseList", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "responseList", ".", "add", "(", "new", "ReplicationInstanceResponse", "(", "<NUM_LIT>", ",", "InstanceInfoGenerator", ".", "takeOne", "(", ")", ")", ")", ";", "final", "ReplicationListResponse", "replicationListResponse", "=", "new", "ReplicationListResponse", "(", "responseList", ")", ";", "Action2", "codingAction", "=", "new", "Action2", "(", ")", "{", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "replicationListResponse", ")", ";", "ReplicationListResponse", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "ReplicationListResponse", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getResponseList", "(", ")", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "}", "}", ";", "List", "<", "CodecWrapper", ">", "jsonCodes", "=", "Arrays", ".", "asList", "(", "new", "CodecWrappers", ".", "JacksonJson", "(", ")", ",", "new", "CodecWrappers", ".", "LegacyJacksonJson", "(", ")", ")", ";", "verifyAllPairs", "(", "codingAction", ",", "ReplicationListResponse", ".", "class", ",", "jsonCodes", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "call", "(", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "IOException", "{", "String", "encodedString", "=", "encodingCodec", ".", "encode", "(", "replicationListResponse", ")", ";", "ReplicationListResponse", "decodedValue", "=", "decodingCodec", ".", "decode", "(", "encodedString", ",", "ReplicationListResponse", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getResponseList", "(", ")", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "verifyAllPairs", "(", "Action2", "codingAction", ",", "Class", "<", "?", ">", "typeToEncode", ",", "List", "<", "CodecWrapper", ">", "codecHolders", ")", "throws", "Exception", "{", "for", "(", "EncoderWrapper", "encodingCodec", ":", "codecHolders", ")", "{", "for", "(", "DecoderWrapper", "decodingCodec", ":", "codecHolders", ")", "{", "String", "pair", "=", "\"", "<STR_LIT:{>", "\"", "+", "encodingCodec", ".", "codecName", "(", ")", "+", "<CHAR_LIT:U+002C>", "+", "decodingCodec", ".", "codecName", "(", ")", "+", "<CHAR_LIT:}>", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "typeToEncode", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "pair", ")", ";", "try", "{", "codingAction", ".", "call", "(", "encodingCodec", ",", "decodingCodec", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", "+", "pair", ",", "ex", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "public", "void", "verifyForPair", "(", "Action2", "codingAction", ",", "Class", "<", "?", ">", "typeToEncode", ",", "EncoderWrapper", "encodingCodec", ",", "DecoderWrapper", "decodingCodec", ")", "throws", "Exception", "{", "String", "pair", "=", "\"", "<STR_LIT:{>", "\"", "+", "encodingCodec", ".", "codecName", "(", ")", "+", "<CHAR_LIT:U+002C>", "+", "decodingCodec", ".", "codecName", "(", ")", "+", "<CHAR_LIT:}>", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "typeToEncode", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "pair", ")", ";", "try", "{", "codingAction", ".", "call", "(", "encodingCodec", ",", "decodingCodec", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "Exception", "(", "\"", "<STR_LIT>", "\"", "+", "pair", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAmazonInfoEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doAmazonInfoEncodeDecodeTest", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAmazonInfoEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doAmazonInfoEncodeDecodeTest", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doAmazonInfoEncodeDecodeTest", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "AmazonInfo", "amazonInfo", "=", "(", "AmazonInfo", ")", "infoIterator", ".", "next", "(", ")", ".", "getDataCenterInfo", "(", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "DataCenterInfo", ".", "class", ")", ".", "writeValueAsString", "(", "amazonInfo", ")", ";", "DataCenterInfo", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "DataCenterInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "DataCenterInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "amazonInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAmazonInfoCompactEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doAmazonInfoCompactEncodeDecodeTest", "(", "new", "EurekaJsonJacksonCodec", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAmazonInfoCompactEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doAmazonInfoCompactEncodeDecodeTest", "(", "new", "EurekaXmlJacksonCodec", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doAmazonInfoCompactEncodeDecodeTest", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "AmazonInfo", "amazonInfo", "=", "(", "AmazonInfo", ")", "infoIterator", ".", "next", "(", ")", ".", "getDataCenterInfo", "(", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "DataCenterInfo", ".", "class", ")", ".", "writeValueAsString", "(", "amazonInfo", ")", ";", "AmazonInfo", "decodedValue", "=", "(", "AmazonInfo", ")", "codec", ".", "getObjectMapper", "(", "DataCenterInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "DataCenterInfo", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ",", "is", "(", "equalTo", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMyDataCenterInfoEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doMyDataCenterInfoEncodeDecodeTest", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMyDataCenterInfoEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doMyDataCenterInfoEncodeDecodeTest", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doMyDataCenterInfoEncodeDecodeTest", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "DataCenterInfo", "myDataCenterInfo", "=", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "DataCenterInfo", ".", "class", ")", ".", "writeValueAsString", "(", "myDataCenterInfo", ")", ";", "DataCenterInfo", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "DataCenterInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "DataCenterInfo", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getName", "(", ")", ",", "is", "(", "equalTo", "(", "Name", ".", "MyOwn", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLeaseInfoEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doLeaseInfoEncodeDecode", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLeaseInfoEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doLeaseInfoEncodeDecode", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doLeaseInfoEncodeDecode", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "LeaseInfo", "leaseInfo", "=", "infoIterator", ".", "next", "(", ")", ".", "getLeaseInfo", "(", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "LeaseInfo", ".", "class", ")", ".", "writeValueAsString", "(", "leaseInfo", ")", ";", "LeaseInfo", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "LeaseInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "LeaseInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "leaseInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doInstanceInfoEncodeDecode", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doInstanceInfoEncodeDecode", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doInstanceInfoEncodeDecode", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "writeValueAsString", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "instanceInfo", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoCompactEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doInstanceInfoCompactEncodeDecode", "(", "new", "EurekaJsonJacksonCodec", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "true", ")", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoCompactEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doInstanceInfoCompactEncodeDecode", "(", "new", "EurekaXmlJacksonCodec", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "true", ")", ",", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doInstanceInfoCompactEncodeDecode", "(", "AbstractEurekaJacksonCodec", "codec", ",", "boolean", "isJson", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "writeValueAsString", "(", "instanceInfo", ")", ";", "if", "(", "isJson", ")", "{", "JsonNode", "metadataNode", "=", "new", "ObjectMapper", "(", ")", ".", "readTree", "(", "encodedString", ")", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "metadataNode", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "InstanceInfo", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getId", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getId", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getMetadata", "(", ")", ".", "isEmpty", "(", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoIgnoredFieldsAreFilteredOutDuringDeserializationProcessWithJson", "(", ")", "throws", "Exception", "{", "doInstanceInfoIgnoredFieldsAreFilteredOutDuringDeserializationProcess", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ",", "new", "EurekaJsonJacksonCodec", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoIgnoredFieldsAreFilteredOutDuringDeserializationProcessWithXml", "(", ")", "throws", "Exception", "{", "doInstanceInfoIgnoredFieldsAreFilteredOutDuringDeserializationProcess", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ",", "new", "EurekaXmlJacksonCodec", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "doInstanceInfoIgnoredFieldsAreFilteredOutDuringDeserializationProcess", "(", "AbstractEurekaJacksonCodec", "fullCodec", ",", "AbstractEurekaJacksonCodec", "compactCodec", ")", "throws", "Exception", "{", "InstanceInfo", "instanceInfo", "=", "infoIterator", ".", "next", "(", ")", ";", "String", "encodedString", "=", "fullCodec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "writeValueAsString", "(", "instanceInfo", ")", ";", "InstanceInfo", "decodedValue", "=", "compactCodec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getId", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getId", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getAppName", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getIPAddr", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getIPAddr", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getVIPAddress", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getVIPAddress", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getSecureVipAddress", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getSecureVipAddress", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getHostName", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getHostName", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getStatus", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getActionType", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getActionType", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getASGName", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getASGName", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getLastUpdatedTimestamp", "(", ")", ",", "is", "(", "equalTo", "(", "instanceInfo", ".", "getLastUpdatedTimestamp", "(", ")", ")", ")", ")", ";", "AmazonInfo", "sourceAmazonInfo", "=", "(", "AmazonInfo", ")", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ";", "AmazonInfo", "decodedAmazonInfo", "=", "(", "AmazonInfo", ")", "decodedValue", ".", "getDataCenterInfo", "(", ")", ";", "assertThat", "(", "decodedAmazonInfo", ".", "get", "(", "MetaDataKey", ".", "accountId", ")", ",", "is", "(", "equalTo", "(", "sourceAmazonInfo", ".", "get", "(", "MetaDataKey", ".", "accountId", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoWithNoMetaEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doInstanceInfoWithNoMetaEncodeDecode", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoWithNoMetaEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doInstanceInfoWithNoMetaEncodeDecode", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ",", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doInstanceInfoWithNoMetaEncodeDecode", "(", "AbstractEurekaJacksonCodec", "codec", ",", "boolean", "json", ")", "throws", "Exception", "{", "InstanceInfo", "noMetaDataInfo", "=", "new", "InstanceInfo", ".", "Builder", "(", "infoIterator", ".", "next", "(", ")", ")", ".", "setMetadata", "(", "null", ")", ".", "build", "(", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "writeValueAsString", "(", "noMetaDataInfo", ")", ";", "if", "(", "json", ")", "{", "assertThat", "(", "encodedString", ".", "contains", "(", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "\"", ")", ",", "is", "(", "true", ")", ")", ";", "}", "InstanceInfo", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "InstanceInfo", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "InstanceInfo", ".", "class", ")", ";", "assertThat", "(", "decodedValue", ".", "getId", "(", ")", ",", "is", "(", "equalTo", "(", "noMetaDataInfo", ".", "getId", "(", ")", ")", ")", ")", ";", "assertThat", "(", "decodedValue", ".", "getMetadata", "(", ")", ".", "isEmpty", "(", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doApplicationEncodeDecode", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doApplicationEncodeDecode", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doApplicationEncodeDecode", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "Application", "application", "=", "new", "Application", "(", "\"", "<STR_LIT>", "\"", ")", ";", "application", ".", "addInstance", "(", "infoIterator", ".", "next", "(", ")", ")", ";", "application", ".", "addInstance", "(", "infoIterator", ".", "next", "(", ")", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "Application", ".", "class", ")", ".", "writeValueAsString", "(", "application", ")", ";", "Application", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "Application", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "Application", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "application", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsEncodeDecodeWithJson", "(", ")", "throws", "Exception", "{", "doApplicationsEncodeDecode", "(", "new", "EurekaJsonJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testApplicationsEncodeDecodeWithXml", "(", ")", "throws", "Exception", "{", "doApplicationsEncodeDecode", "(", "new", "EurekaXmlJacksonCodec", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "doApplicationsEncodeDecode", "(", "AbstractEurekaJacksonCodec", "codec", ")", "throws", "Exception", "{", "Applications", "applications", "=", "infoGenerator", ".", "takeDelta", "(", "<NUM_LIT:2>", ")", ";", "String", "encodedString", "=", "codec", ".", "getObjectMapper", "(", "Applications", ".", "class", ")", ".", "writeValueAsString", "(", "applications", ")", ";", "Applications", "decodedValue", "=", "codec", ".", "getObjectMapper", "(", "Applications", ".", "class", ")", ".", "readValue", "(", "encodedString", ",", "Applications", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "applications", ",", "decodedValue", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRegisterNewWrapper", "(", ")", "{", "Assert", ".", "assertNull", "(", "CodecWrappers", ".", "getEncoder", "(", "testWrapperName", ")", ")", ";", "Assert", ".", "assertNull", "(", "CodecWrappers", ".", "getDecoder", "(", "testWrapperName", ")", ")", ";", "CodecWrappers", ".", "registerWrapper", "(", "new", "TestWrapper", "(", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "CodecWrappers", ".", "getEncoder", "(", "testWrapperName", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "CodecWrappers", ".", "getDecoder", "(", "testWrapperName", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "testWrapperName", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shuffleVirtualHostNameMapLastInstanceTest", "(", ")", "{", "DataCenterInfo", "myDCI", "=", "new", "DataCenterInfo", "(", ")", "{", "public", "DataCenterInfo", ".", "Name", "getName", "(", ")", "{", "return", "DataCenterInfo", ".", "Name", ".", "MyOwn", ";", "}", "}", ";", "InstanceInfo", "instanceInfo", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setVIPAddress", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "myDCI", ")", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "Application", "application", "=", "new", "Application", "(", "\"", "<STR_LIT>", "\"", ")", ";", "application", ".", "addInstance", "(", "instanceInfo", ")", ";", "Applications", "applications", "=", "new", "Applications", "(", ")", ";", "applications", ".", "addApplication", "(", "application", ")", ";", "applications", ".", "shuffleInstances", "(", "true", ")", ";", "List", "<", "InstanceInfo", ">", "testApp", "=", "applications", ".", "getInstancesByVirtualHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertEquals", "(", "Iterables", ".", "getOnlyElement", "(", "testApp", ")", ",", "application", ".", "getByInstanceId", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "application", ".", "removeInstance", "(", "instanceInfo", ")", ";", "applications", ".", "shuffleInstances", "(", "true", ")", ";", "testApp", "=", "applications", ".", "getInstancesByVirtualHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertNull", "(", "application", ".", "getByInstanceId", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertTrue", "(", "testApp", ".", "isEmpty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "DataCenterInfo", ".", "Name", "getName", "(", ")", "{", "return", "DataCenterInfo", ".", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "(", "(", "ConcurrentCompositeConfiguration", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ")", ".", "clearOverrideProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "(", "(", "ConcurrentCompositeConfiguration", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ")", ".", "clearOverrideProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCopyConstructor", "(", ")", "{", "DataCenterInfo", "myDCI", "=", "new", "DataCenterInfo", "(", ")", "{", "public", "DataCenterInfo", ".", "Name", "getName", "(", ")", "{", "return", "DataCenterInfo", ".", "Name", ".", "MyOwn", ";", "}", "}", ";", "InstanceInfo", "smallII1", "=", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "myDCI", ")", ".", "build", "(", ")", ";", "InstanceInfo", "smallII2", "=", "new", "InstanceInfo", "(", "smallII1", ")", ";", "assertNotSame", "(", "smallII1", ",", "smallII2", ")", ";", "Assert", ".", "assertEquals", "(", "smallII1", ",", "smallII2", ")", ";", "InstanceInfo", "fullII1", "=", "newBuilder", "(", ")", ".", "setMetadata", "(", "null", ")", ".", "setOverriddenStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UNKNOWN", ")", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setSecureVIPAddress", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setStatus", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UNKNOWN", ")", ".", "setStatusPageUrl", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "setVIPAddress", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setASGName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "myDCI", ")", ".", "setHealthCheckUrls", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "setHomePageUrl", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "setIPAddr", "(", "\"", "<STR_LIT:127.0.0.1>", "\"", ")", ".", "setPort", "(", "<NUM_LIT>", ")", ".", "setSecurePort", "(", "<NUM_LIT>", ")", ".", "build", "(", ")", ";", "InstanceInfo", "fullII2", "=", "new", "InstanceInfo", "(", "fullII1", ")", ";", "assertNotSame", "(", "fullII1", ",", "fullII2", ")", ";", "Assert", ".", "assertEquals", "(", "fullII1", ",", "fullII2", ")", ";", "}", "</s>"]
["<s>", "public", "DataCenterInfo", ".", "Name", "getName", "(", ")", "{", "return", "DataCenterInfo", ".", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAppGroupNameSystemProp", "(", ")", "throws", "Exception", "{", "String", "appGroup", "=", "\"", "<STR_LIT>", "\"", ";", "(", "(", "ConcurrentCompositeConfiguration", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ")", ".", "setOverrideProperty", "(", "\"", "<STR_LIT>", "\"", ",", "appGroup", ")", ";", "MyDataCenterInstanceConfig", "config", "=", "new", "MyDataCenterInstanceConfig", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "appGroup", ",", "config", ".", "getAppGroupName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAppGroupName", "(", ")", "throws", "Exception", "{", "String", "appGroup", "=", "\"", "<STR_LIT>", "\"", ";", "(", "(", "ConcurrentCompositeConfiguration", ")", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ")", ".", "setOverrideProperty", "(", "\"", "<STR_LIT>", "\"", ",", "appGroup", ")", ";", "MyDataCenterInstanceConfig", "config", "=", "new", "MyDataCenterInstanceConfig", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "appGroup", ",", "config", ".", "getAppGroupName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHealthCheckSetContainsValidUrlEntries", "(", ")", "throws", "Exception", "{", "Builder", "builder", "=", "newBuilder", "(", ")", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setNamespace", "(", "\"", "<STR_LIT:.>", "\"", ")", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setPort", "(", "<NUM_LIT>", ")", ".", "setSecurePort", "(", "<NUM_LIT>", ")", ".", "enablePort", "(", "PortType", ".", "SECURE", ",", "true", ")", ";", "InstanceInfo", "noHealtcheckInstanceInfo", "=", "builder", ".", "build", "(", ")", ";", "assertThat", "(", "noHealtcheckInstanceInfo", ".", "getHealthCheckUrls", "(", ")", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "0", ")", ")", ")", ";", "InstanceInfo", "instanceInfo", "=", "builder", ".", "setHealthCheckUrls", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "assertThat", "(", "instanceInfo", ".", "getHealthCheckUrls", "(", ")", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetIdWithInstanceIdUsed", "(", ")", "{", "InstanceInfo", "baseline", "=", "InstanceInfoGenerator", ".", "takeOne", "(", ")", ";", "String", "dataCenterInfoId", "=", "(", "(", "UniqueIdentifier", ")", "baseline", ".", "getDataCenterInfo", "(", ")", ")", ".", "getId", "(", ")", ";", "assertThat", "(", "baseline", ".", "getInstanceId", "(", ")", ",", "is", "(", "baseline", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "dataCenterInfoId", ",", "is", "(", "baseline", ".", "getId", "(", ")", ")", ")", ";", "String", "customInstanceId", "=", "\"", "<STR_LIT>", "\"", ";", "InstanceInfo", "instanceInfo", "=", "new", "InstanceInfo", ".", "Builder", "(", "baseline", ")", ".", "setInstanceId", "(", "customInstanceId", ")", ".", "build", "(", ")", ";", "dataCenterInfoId", "=", "(", "(", "UniqueIdentifier", ")", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "getId", "(", ")", ";", "assertThat", "(", "instanceInfo", ".", "getInstanceId", "(", ")", ",", "is", "(", "instanceInfo", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "customInstanceId", ",", "is", "(", "instanceInfo", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "dataCenterInfoId", ",", "is", "(", "not", "(", "baseline", ".", "getId", "(", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetIdWithInstanceIdNotUsed", "(", ")", "{", "InstanceInfo", "baseline", "=", "InstanceInfoGenerator", ".", "takeOne", "(", ")", ";", "InstanceInfo", "instanceInfo1", "=", "new", "InstanceInfo", ".", "Builder", "(", "baseline", ")", ".", "setInstanceId", "(", "\"", "\"", ")", ".", "build", "(", ")", ";", "String", "dataCenterInfoId", "=", "(", "(", "UniqueIdentifier", ")", "baseline", ".", "getDataCenterInfo", "(", ")", ")", ".", "getId", "(", ")", ";", "assertThat", "(", "instanceInfo1", ".", "getInstanceId", "(", ")", ".", "isEmpty", "(", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "instanceInfo1", ".", "getInstanceId", "(", ")", ",", "is", "(", "not", "(", "instanceInfo1", ".", "getId", "(", ")", ")", ")", ")", ";", "assertThat", "(", "dataCenterInfoId", ",", "is", "(", "instanceInfo1", ".", "getId", "(", ")", ")", ")", ";", "InstanceInfo", "instanceInfo2", "=", "new", "InstanceInfo", ".", "Builder", "(", "baseline", ")", ".", "setInstanceId", "(", "null", ")", ".", "build", "(", ")", ";", "dataCenterInfoId", "=", "(", "(", "UniqueIdentifier", ")", "baseline", ".", "getDataCenterInfo", "(", ")", ")", ".", "getId", "(", ")", ";", "assertThat", "(", "instanceInfo2", ".", "getInstanceId", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertThat", "(", "instanceInfo2", ".", "getInstanceId", "(", ")", ",", "is", "(", "not", "(", "instanceInfo2", ".", "getId", "(", ")", ")", ")", ")", ";", "assertThat", "(", "dataCenterInfoId", ",", "is", "(", "instanceInfo2", ".", "getId", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testExtractAccountId", "(", ")", "throws", "Exception", "{", "String", "json", "=", "\"", "<STR_LIT:{>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:U+002C>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:}>", "\"", ";", "InputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "json", ".", "getBytes", "(", ")", ")", ";", "String", "accountId", "=", "AmazonInfo", ".", "MetaDataKey", ".", "accountId", ".", "read", "(", "inputStream", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "accountId", ")", ";", "}", "</s>"]
["<s>", "public", "DNSBasedAzToRegionMapper", "(", "EurekaClientConfig", "clientConfig", ")", "{", "super", "(", "clientConfig", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Set", "<", "String", ">", "getZonesForARegion", "(", "String", "region", ")", "{", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "zoneBasedDiscoveryUrlsFromRegion", "=", "EndpointUtils", ".", "getZoneBasedDiscoveryUrlsFromRegion", "(", "clientConfig", ",", "region", ")", ";", "if", "(", "null", "!", "=", "zoneBasedDiscoveryUrlsFromRegion", ")", "{", "return", "zoneBasedDiscoveryUrlsFromRegion", ".", "keySet", "(", ")", ";", "}", "return", "Collections", ".", "emptySet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "EurekaUpStatusResolver", "(", "EurekaClient", "client", ",", "EventBus", "eventBus", ")", "{", "this", ".", "eventBus", "=", "eventBus", ";", "this", ".", "client", "=", "client", ";", "}", "</s>"]
["<s>", "@", "Subscribe", "public", "void", "onStatusChange", "(", "StatusChangeEvent", "event", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "event", ".", "getPreviousStatus", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "event", ".", "getStatus", "(", ")", ")", ";", "currentStatus", "=", "event", ".", "getStatus", "(", ")", ";", "counter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "PostConstruct", "public", "void", "init", "(", ")", "{", "try", "{", "currentStatus", "=", "client", ".", "getInstanceRemoteStatus", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "currentStatus", ")", ";", "eventBus", ".", "registerSubscriber", "(", "this", ")", ";", "}", "catch", "(", "InvalidSubscriberException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "PreDestroy", "public", "void", "shutdown", "(", ")", "{", "eventBus", ".", "unregisterSubscriber", "(", "this", ")", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", ".", "InstanceStatus", "getStatus", "(", ")", "{", "return", "currentStatus", ";", "}", "</s>"]
["<s>", "public", "long", "getChangeCount", "(", ")", "{", "return", "counter", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DiscoveryEvent", "(", ")", "{", "super", "(", ")", ";", "this", ".", "timestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getTimestamp", "(", ")", "{", "return", "this", ".", "timestamp", ";", "}", "</s>"]
["<s>", "InstanceInfoReplicator", "(", "DiscoveryClient", "discoveryClient", ",", "InstanceInfo", "instanceInfo", ",", "int", "replicationIntervalSeconds", ",", "int", "burstSize", ")", "{", "this", ".", "discoveryClient", "=", "discoveryClient", ";", "this", ".", "instanceInfo", "=", "instanceInfo", ";", "this", ".", "scheduler", "=", "Executors", ".", "newScheduledThreadPool", "(", "1", ",", "new", "ThreadFactoryBuilder", "(", ")", ".", "setNameFormat", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDaemon", "(", "true", ")", ".", "build", "(", ")", ")", ";", "this", ".", "scheduledPeriodicRef", "=", "new", "AtomicReference", "<", "Future", ">", "(", ")", ";", "this", ".", "started", "=", "new", "AtomicBoolean", "(", "false", ")", ";", "this", ".", "rateLimiter", "=", "new", "RateLimiter", "(", "TimeUnit", ".", "MINUTES", ")", ";", "this", ".", "replicationIntervalSeconds", "=", "replicationIntervalSeconds", ";", "this", ".", "burstSize", "=", "burstSize", ";", "this", ".", "allowedRatePerMinute", "=", "<NUM_LIT>", "*", "this", ".", "burstSize", "/", "this", ".", "replicationIntervalSeconds", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "allowedRatePerMinute", ")", ";", "}", "</s>"]
["<s>", "public", "void", "start", "(", "int", "initialDelayMs", ")", "{", "if", "(", "started", ".", "compareAndSet", "(", "false", ",", "true", ")", ")", "{", "instanceInfo", ".", "setIsDirty", "(", ")", ";", "scheduler", ".", "schedule", "(", "this", ",", "initialDelayMs", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "stop", "(", ")", "{", "scheduler", ".", "shutdownNow", "(", ")", ";", "started", ".", "set", "(", "false", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "onDemandUpdate", "(", ")", "{", "if", "(", "rateLimiter", ".", "acquire", "(", "burstSize", ",", "allowedRatePerMinute", ")", ")", "{", "scheduler", ".", "submit", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Future", "latestPeriodic", "=", "scheduledPeriodicRef", ".", "get", "(", ")", ";", "if", "(", "latestPeriodic", "!", "=", "null", "&", "&", "!", "latestPeriodic", ".", "isDone", "(", ")", ")", "{", "latestPeriodic", ".", "cancel", "(", "false", ")", ";", "}", "InstanceInfoReplicator", ".", "this", ".", "run", "(", ")", ";", "}", "}", ")", ";", "return", "true", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "false", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Future", "latestPeriodic", "=", "scheduledPeriodicRef", ".", "get", "(", ")", ";", "if", "(", "latestPeriodic", "!", "=", "null", "&", "&", "!", "latestPeriodic", ".", "isDone", "(", ")", ")", "{", "latestPeriodic", ".", "cancel", "(", "false", ")", ";", "}", "InstanceInfoReplicator", ".", "this", ".", "run", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "run", "(", ")", "{", "try", "{", "discoveryClient", ".", "refreshInstanceInfo", "(", ")", ";", "Long", "dirtyTimestamp", "=", "instanceInfo", ".", "isDirtyWithTime", "(", ")", ";", "if", "(", "dirtyTimestamp", "!", "=", "null", ")", "{", "discoveryClient", ".", "register", "(", ")", ";", "instanceInfo", ".", "unsetIsDirty", "(", "dirtyTimestamp", ")", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "}", "finally", "{", "Future", "next", "=", "scheduler", ".", "schedule", "(", "this", ",", "replicationIntervalSeconds", ",", "TimeUnit", ".", "SECONDS", ")", ";", "scheduledPeriodicRef", ".", "set", "(", "next", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Supplier", "<", "Boolean", ">", "get", "(", ")", "{", "final", "EurekaUpStatusResolver", "resolver", "=", "upStatus", ".", "get", "(", ")", ";", "return", "new", "Supplier", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "get", "(", ")", "{", "return", "resolver", ".", "getStatus", "(", ")", ".", "equals", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "get", "(", ")", "{", "return", "resolver", ".", "getStatus", "(", ")", ".", "equals", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Supplier", "<", "Boolean", ">", "get", "(", ")", "{", "final", "EurekaUpStatusResolver", "resolver", "=", "upStatus", ".", "get", "(", ")", ";", "return", "new", "Supplier", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "get", "(", ")", "{", "return", "!", "resolver", ".", "getStatus", "(", ")", ".", "equals", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "get", "(", ")", "{", "return", "!", "resolver", ".", "getStatus", "(", ")", ".", "equals", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "new", "TypeLiteral", "<", "Supplier", "<", "Boolean", ">", ">", "(", ")", "{", "}", ")", ".", "annotatedWith", "(", "UpStatus", ".", "class", ")", ".", "toProvider", "(", "UpStatusProvider", ".", "class", ")", ";", "bind", "(", "new", "TypeLiteral", "<", "Supplier", "<", "Boolean", ">", ">", "(", ")", "{", "}", ")", ".", "annotatedWith", "(", "DownStatus", ".", "class", ")", ".", "toProvider", "(", "DownStatusProvider", ".", "class", ")", ";", "}", "</s>"]
["<s>", "public", "DefaultEurekaClientConfig", "(", ")", "{", "init", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DefaultEurekaClientConfig", "(", "String", "namespace", ")", "{", "this", ".", "namespace", "=", "namespace", ";", "init", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "init", "(", ")", "{", "String", "env", "=", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getString", "(", "EUREKA_ENVIRONMENT", ",", "TEST", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "ARCHAIUS_DEPLOYMENT_ENVIRONMENT", ",", "env", ")", ";", "String", "eurekaPropsFile", "=", "EUREKA_PROPS_FILE", ".", "get", "(", ")", ";", "try", "{", "ConfigurationManager", ".", "loadCascadedPropertiesFromResources", "(", "eurekaPropsFile", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "eurekaPropsFile", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRegistryFetchIntervalSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getInstanceInfoReplicationIntervalSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getInitialInstanceInfoReplicationIntervalSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEurekaServiceUrlPollIntervalSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ".", "get", "(", ")", "/", "<NUM_LIT:1000>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getProxyHost", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getProxyPort", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getProxyUserName", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getProxyPassword", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldGZipContent", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEurekaServerReadTimeoutSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:8>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEurekaServerConnectTimeoutSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getBackupRegistryImpl", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEurekaServerTotalConnections", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEurekaServerTotalConnectionsPerHost", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getEurekaServerURLContext", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getEurekaServerPort", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getEurekaServerDNSName", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT:Name>", "\"", ",", "null", ")", ".", "get", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldUseDnsForFetchingServiceUrls", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldRegisterWithEureka", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldPreferSameZoneEureka", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "allowRedirects", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldLogDeltaDiff", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldDisableDelta", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "@", "Override", "public", "String", "fetchRegistryForRemoteRegions", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getRegion", "(", ")", "{", "DynamicStringProperty", "defaultEurekaRegion", "=", "configInstance", ".", "getStringProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "defaultEurekaRegion", ".", "get", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "[", "]", "getAvailabilityZones", "(", "String", "region", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ",", "DEFAULT_ZONE", ")", ".", "get", "(", ")", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "getEurekaServerServiceUrls", "(", "String", "myZone", ")", "{", "String", "serviceUrls", "=", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", "+", "myZone", ",", "null", ")", ".", "get", "(", ")", ";", "if", "(", "serviceUrls", "=", "=", "null", "|", "|", "serviceUrls", ".", "isEmpty", "(", ")", ")", "{", "serviceUrls", "=", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "if", "(", "serviceUrls", "!", "=", "null", ")", "{", "return", "Arrays", ".", "asList", "(", "serviceUrls", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ")", ";", "}", "return", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldFilterOnlyUpInstances", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEurekaConnectionIdleTimeoutSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldFetchRegistry", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getRegistryRefreshSingleVipAddress", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getHeartbeatExecutorThreadPoolSize", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "DEFAULT_EXECUTOR_THREAD_POOL_SIZE", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getHeartbeatExecutorExponentialBackOffBound", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getCacheRefreshExecutorThreadPoolSize", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "DEFAULT_EXECUTOR_THREAD_POOL_SIZE", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getCacheRefreshExecutorExponentialBackOffBound", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getDollarReplacement", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getEscapeCharReplacement", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldOnDemandUpdateStatusChange", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getEncoderName", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT:Name>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getDecoderName", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT:Name>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getClientDataAccept", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "EurekaAccept", ".", "full", ".", "name", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getExperimental", "(", "String", "name", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT:.>", "\"", "+", "name", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "StatusChangeEvent", "(", "InstanceInfo", ".", "InstanceStatus", "previous", ",", "InstanceInfo", ".", "InstanceStatus", "current", ")", "{", "super", "(", ")", ";", "this", ".", "current", "=", "current", ";", "this", ".", "previous", "=", "previous", ";", "}", "</s>"]
["<s>", "public", "boolean", "isUp", "(", ")", "{", "return", "this", ".", "current", ".", "equals", "(", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ")", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", ".", "InstanceStatus", "getStatus", "(", ")", "{", "return", "current", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", ".", "InstanceStatus", "getPreviousStatus", "(", ")", "{", "return", "previous", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "current", "+", "\"", "<STR_LIT>", "\"", "+", "previous", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "</s>"]
["<s>", "private", "DiscoveryManager", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "DiscoveryManager", "getInstance", "(", ")", "{", "return", "s_instance", ";", "}", "</s>"]
["<s>", "public", "void", "setDiscoveryClient", "(", "DiscoveryClient", "discoveryClient", ")", "{", "this", ".", "discoveryClient", "=", "discoveryClient", ";", "}", "</s>"]
["<s>", "public", "void", "setEurekaClientConfig", "(", "EurekaClientConfig", "eurekaClientConfig", ")", "{", "this", ".", "eurekaClientConfig", "=", "eurekaClientConfig", ";", "}", "</s>"]
["<s>", "public", "void", "setEurekaInstanceConfig", "(", "EurekaInstanceConfig", "eurekaInstanceConfig", ")", "{", "this", ".", "eurekaInstanceConfig", "=", "eurekaInstanceConfig", ";", "}", "</s>"]
["<s>", "public", "void", "initComponent", "(", "EurekaInstanceConfig", "config", ",", "EurekaClientConfig", "eurekaConfig", ",", "DiscoveryClientOptionalArgs", "args", ")", "{", "this", ".", "eurekaInstanceConfig", "=", "config", ";", "this", ".", "eurekaClientConfig", "=", "eurekaConfig", ";", "if", "(", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", "=", "=", "null", ")", "{", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "initComponent", "(", "config", ")", ";", "}", "InstanceInfo", "info", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "discoveryClient", "=", "new", "DiscoveryClient", "(", "info", ",", "eurekaConfig", ",", "args", ")", ";", "}", "</s>"]
["<s>", "public", "void", "initComponent", "(", "EurekaInstanceConfig", "config", ",", "EurekaClientConfig", "eurekaConfig", ")", "{", "initComponent", "(", "config", ",", "eurekaConfig", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "void", "shutdownComponent", "(", ")", "{", "if", "(", "discoveryClient", "!", "=", "null", ")", "{", "try", "{", "discoveryClient", ".", "shutdown", "(", ")", ";", "discoveryClient", "=", "null", ";", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "LookupService", "getLookupService", "(", ")", "{", "return", "discoveryClient", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "DiscoveryClient", "getDiscoveryClient", "(", ")", "{", "return", "discoveryClient", ";", "}", "</s>"]
["<s>", "public", "EurekaClient", "getEurekaClient", "(", ")", "{", "return", "discoveryClient", ";", "}", "</s>"]
["<s>", "public", "EurekaClientConfig", "getEurekaClientConfig", "(", ")", "{", "return", "eurekaClientConfig", ";", "}", "</s>"]
["<s>", "public", "EurekaInstanceConfig", "getEurekaInstanceConfig", "(", ")", "{", "return", "eurekaInstanceConfig", ";", "}", "</s>"]
["<s>", "public", "EurekaIdentityHeaderFilter", "(", "AbstractEurekaIdentity", "authInfo", ")", "{", "this", ".", "authInfo", "=", "authInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ClientResponse", "handle", "(", "ClientRequest", "cr", ")", "throws", "ClientHandlerException", "{", "if", "(", "authInfo", "!", "=", "null", ")", "{", "cr", ".", "getHeaders", "(", ")", ".", "putSingle", "(", "AbstractEurekaIdentity", ".", "AUTH_NAME_HEADER_KEY", ",", "authInfo", ".", "getName", "(", ")", ")", ";", "cr", ".", "getHeaders", "(", ")", ".", "putSingle", "(", "AbstractEurekaIdentity", ".", "AUTH_VERSION_HEADER_KEY", ",", "authInfo", ".", "getVersion", "(", ")", ")", ";", "if", "(", "authInfo", ".", "getId", "(", ")", "!", "=", "null", ")", "{", "cr", ".", "getHeaders", "(", ")", ".", "putSingle", "(", "AbstractEurekaIdentity", ".", "AUTH_ID_HEADER_KEY", ",", "authInfo", ".", "getId", "(", ")", ")", ";", "}", "}", "return", "getNext", "(", ")", ".", "handle", "(", "cr", ")", ";", "}", "</s>"]
["<s>", "int", "getRegistryFetchIntervalSeconds", "(", ")", ";", "</s>"]
["<s>", "int", "getInstanceInfoReplicationIntervalSeconds", "(", ")", ";", "</s>"]
["<s>", "int", "getInitialInstanceInfoReplicationIntervalSeconds", "(", ")", ";", "</s>"]
["<s>", "int", "getEurekaServiceUrlPollIntervalSeconds", "(", ")", ";", "</s>"]
["<s>", "String", "getProxyHost", "(", ")", ";", "</s>"]
["<s>", "String", "getProxyPort", "(", ")", ";", "</s>"]
["<s>", "String", "getProxyUserName", "(", ")", ";", "</s>"]
["<s>", "String", "getProxyPassword", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldGZipContent", "(", ")", ";", "</s>"]
["<s>", "int", "getEurekaServerReadTimeoutSeconds", "(", ")", ";", "</s>"]
["<s>", "int", "getEurekaServerConnectTimeoutSeconds", "(", ")", ";", "</s>"]
["<s>", "String", "getBackupRegistryImpl", "(", ")", ";", "</s>"]
["<s>", "int", "getEurekaServerTotalConnections", "(", ")", ";", "</s>"]
["<s>", "int", "getEurekaServerTotalConnectionsPerHost", "(", ")", ";", "</s>"]
["<s>", "String", "getEurekaServerURLContext", "(", ")", ";", "</s>"]
["<s>", "String", "getEurekaServerPort", "(", ")", ";", "</s>"]
["<s>", "String", "getEurekaServerDNSName", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldUseDnsForFetchingServiceUrls", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldRegisterWithEureka", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldPreferSameZoneEureka", "(", ")", ";", "</s>"]
["<s>", "boolean", "allowRedirects", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldLogDeltaDiff", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldDisableDelta", "(", ")", ";", "</s>"]
["<s>", "@", "Nullable", "String", "fetchRegistryForRemoteRegions", "(", ")", ";", "</s>"]
["<s>", "String", "getRegion", "(", ")", ";", "</s>"]
["<s>", "String", "[", "]", "getAvailabilityZones", "(", "String", "region", ")", ";", "</s>"]
["<s>", "List", "<", "String", ">", "getEurekaServerServiceUrls", "(", "String", "myZone", ")", ";", "</s>"]
["<s>", "boolean", "shouldFilterOnlyUpInstances", "(", ")", ";", "</s>"]
["<s>", "int", "getEurekaConnectionIdleTimeoutSeconds", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldFetchRegistry", "(", ")", ";", "</s>"]
["<s>", "@", "Nullable", "String", "getRegistryRefreshSingleVipAddress", "(", ")", ";", "</s>"]
["<s>", "int", "getHeartbeatExecutorThreadPoolSize", "(", ")", ";", "</s>"]
["<s>", "int", "getHeartbeatExecutorExponentialBackOffBound", "(", ")", ";", "</s>"]
["<s>", "int", "getCacheRefreshExecutorThreadPoolSize", "(", ")", ";", "</s>"]
["<s>", "int", "getCacheRefreshExecutorExponentialBackOffBound", "(", ")", ";", "</s>"]
["<s>", "String", "getDollarReplacement", "(", ")", ";", "</s>"]
["<s>", "String", "getEscapeCharReplacement", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldOnDemandUpdateStatusChange", "(", ")", ";", "</s>"]
["<s>", "String", "getEncoderName", "(", ")", ";", "</s>"]
["<s>", "String", "getDecoderName", "(", ")", ";", "</s>"]
["<s>", "String", "getClientDataAccept", "(", ")", ";", "</s>"]
["<s>", "String", "getExperimental", "(", "String", "name", ")", ";", "</s>"]
["<s>", "public", "TimedSupervisorTask", "(", "String", "name", ",", "ScheduledExecutorService", "scheduler", ",", "ThreadPoolExecutor", "executor", ",", "int", "timeout", ",", "TimeUnit", "timeUnit", ",", "int", "expBackOffBound", ",", "Runnable", "task", ")", "{", "this", ".", "scheduler", "=", "scheduler", ";", "this", ".", "executor", "=", "executor", ";", "this", ".", "timeoutMillis", "=", "timeUnit", ".", "toMillis", "(", "timeout", ")", ";", "this", ".", "task", "=", "task", ";", "this", ".", "delay", "=", "new", "AtomicLong", "(", "timeoutMillis", ")", ";", "this", ".", "maxDelay", "=", "timeoutMillis", "*", "expBackOffBound", ";", "timeoutCounter", "=", "Monitors", ".", "newCounter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "rejectedCounter", "=", "Monitors", ".", "newCounter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "throwableCounter", "=", "Monitors", ".", "newCounter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "threadPoolLevelGauge", "=", "new", "LongGauge", "(", "MonitorConfig", ".", "builder", "(", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ")", ";", "Monitors", ".", "registerObject", "(", "name", ",", "this", ")", ";", "}", "</s>"]
["<s>", "public", "void", "run", "(", ")", "{", "Future", "future", "=", "null", ";", "try", "{", "future", "=", "executor", ".", "submit", "(", "task", ")", ";", "threadPoolLevelGauge", ".", "set", "(", "(", "long", ")", "executor", ".", "getActiveCount", "(", ")", ")", ";", "future", ".", "get", "(", "timeoutMillis", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "delay", ".", "set", "(", "timeoutMillis", ")", ";", "threadPoolLevelGauge", ".", "set", "(", "(", "long", ")", "executor", ".", "getActiveCount", "(", ")", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "timeoutCounter", ".", "increment", "(", ")", ";", "long", "currentDelay", "=", "delay", ".", "get", "(", ")", ";", "long", "newDelay", "=", "Math", ".", "min", "(", "maxDelay", ",", "currentDelay", "*", "<NUM_LIT:2>", ")", ";", "delay", ".", "compareAndSet", "(", "currentDelay", ",", "newDelay", ")", ";", "}", "catch", "(", "RejectedExecutionException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "rejectedCounter", ".", "increment", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throwableCounter", ".", "increment", "(", ")", ";", "}", "finally", "{", "if", "(", "future", "!", "=", "null", ")", "{", "future", ".", "cancel", "(", "true", ")", ";", "}", "scheduler", ".", "schedule", "(", "this", ",", "delay", ".", "get", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "}", "</s>"]
["<s>", "private", "EurekaClientNames", "(", ")", "{", "}", "</s>"]
["<s>", "InstanceRegionChecker", "(", "AzToRegionMapper", "azToRegionMapper", ",", "String", "localRegion", ")", "{", "this", ".", "azToRegionMapper", "=", "azToRegionMapper", ";", "this", ".", "localRegion", "=", "localRegion", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "String", "getInstanceRegion", "(", "InstanceInfo", "instanceInfo", ")", "{", "if", "(", "DataCenterInfo", ".", "Name", ".", "Amazon", ".", "equals", "(", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ".", "getName", "(", ")", ")", ")", "{", "AmazonInfo", "amazonInfo", "=", "(", "AmazonInfo", ")", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ";", "Map", "<", "String", ",", "String", ">", "metadata", "=", "amazonInfo", ".", "getMetadata", "(", ")", ";", "String", "availabilityZone", "=", "metadata", ".", "get", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ".", "getName", "(", ")", ")", ";", "if", "(", "null", "!", "=", "availabilityZone", ")", "{", "return", "azToRegionMapper", ".", "getRegionForAvailabilityZone", "(", "availabilityZone", ")", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "boolean", "isLocalRegion", "(", "@", "Nullable", "String", "instanceRegion", ")", "{", "return", "null", "=", "=", "instanceRegion", "|", "|", "instanceRegion", ".", "equals", "(", "localRegion", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getLocalRegion", "(", ")", "{", "return", "localRegion", ";", "}", "</s>"]
["<s>", "public", "AzToRegionMapper", "getAzToRegionMapper", "(", ")", "{", "return", "azToRegionMapper", ";", "}", "</s>"]
["<s>", "public", "Applications", "getApplicationsForARegion", "(", "@", "Nullable", "String", "region", ")", ";", "</s>"]
["<s>", "public", "Applications", "getApplications", "(", "String", "serviceUrl", ")", ";", "</s>"]
["<s>", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVipAddress", "(", "String", "vipAddress", ",", "boolean", "secure", ")", ";", "</s>"]
["<s>", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVipAddress", "(", "String", "vipAddress", ",", "boolean", "secure", ",", "@", "Nullable", "String", "region", ")", ";", "</s>"]
["<s>", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVipAddressAndAppName", "(", "String", "vipAddress", ",", "String", "appName", ",", "boolean", "secure", ")", ";", "</s>"]
["<s>", "public", "Set", "<", "String", ">", "getAllKnownRegions", "(", ")", ";", "</s>"]
["<s>", "public", "InstanceInfo", ".", "InstanceStatus", "getInstanceRemoteStatus", "(", ")", ";", "</s>"]
["<s>", "@", "Deprecated", "public", "List", "<", "String", ">", "getDiscoveryServiceUrls", "(", "String", "zone", ")", ";", "</s>"]
["<s>", "@", "Deprecated", "public", "List", "<", "String", ">", "getServiceUrlsFromConfig", "(", "String", "instanceZone", ",", "boolean", "preferSameZone", ")", ";", "</s>"]
["<s>", "@", "Deprecated", "public", "List", "<", "String", ">", "getServiceUrlsFromDNS", "(", "String", "instanceZone", ",", "boolean", "preferSameZone", ")", ";", "</s>"]
["<s>", "@", "Deprecated", "public", "void", "registerHealthCheckCallback", "(", "HealthCheckCallback", "callback", ")", ";", "</s>"]
["<s>", "public", "void", "registerHealthCheck", "(", "HealthCheckHandler", "healthCheckHandler", ")", ";", "</s>"]
["<s>", "public", "HealthCheckHandler", "getHealthCheckHandler", "(", ")", ";", "</s>"]
["<s>", "public", "void", "shutdown", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "Applications", "fetchRegistry", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "fetchRegistry", "(", "String", "[", "]", "includeRemoteRegions", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClientOptionalArgs", "(", ")", "{", "}", "</s>"]
["<s>", "public", "void", "setEventBus", "(", "EventBus", "eventBus", ")", "{", "this", ".", "eventBus", "=", "eventBus", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthCheckCallbackProvider", "(", "Provider", "<", "HealthCheckCallback", ">", "healthCheckCallbackProvider", ")", "{", "this", ".", "healthCheckCallbackProvider", "=", "healthCheckCallbackProvider", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthCheckHandlerProvider", "(", "Provider", "<", "HealthCheckHandler", ">", "healthCheckHandlerProvider", ")", "{", "this", ".", "healthCheckHandlerProvider", "=", "healthCheckHandlerProvider", ";", "}", "</s>"]
["<s>", "public", "void", "setAdditionalFilters", "(", "Collection", "<", "ClientFilter", ">", "additionalFilters", ")", "{", "this", ".", "additionalFilters", "=", "additionalFilters", ";", "}", "</s>"]
["<s>", "public", "void", "setEurekaJerseyClient", "(", "EurekaJerseyClient", "eurekaJerseyClient", ")", "{", "this", ".", "eurekaJerseyClient", "=", "eurekaJerseyClient", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "DiscoveryClient", "(", "InstanceInfo", "myInfo", ",", "EurekaClientConfig", "config", ")", "{", "this", "(", "myInfo", ",", "config", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "DiscoveryClient", "(", "InstanceInfo", "myInfo", ",", "EurekaClientConfig", "config", ",", "DiscoveryClientOptionalArgs", "args", ")", "{", "this", "(", "ApplicationInfoManager", ".", "getInstance", "(", ")", ",", "config", ",", "args", ")", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClient", "(", "ApplicationInfoManager", "applicationInfoManager", ",", "EurekaClientConfig", "config", ")", "{", "this", "(", "applicationInfoManager", ",", "config", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "DiscoveryClient", "(", "ApplicationInfoManager", "applicationInfoManager", ",", "EurekaClientConfig", "config", ",", "DiscoveryClientOptionalArgs", "args", ")", "{", "this", "(", "applicationInfoManager", ",", "config", ",", "args", ",", "new", "Provider", "<", "BackupRegistry", ">", "(", ")", "{", "private", "volatile", "BackupRegistry", "backupRegistryInstance", ";", "@", "Override", "public", "synchronized", "BackupRegistry", "get", "(", ")", "{", "if", "(", "backupRegistryInstance", "=", "=", "null", ")", "{", "String", "backupRegistryClassName", "=", "clientConfig", ".", "getBackupRegistryImpl", "(", ")", ";", "if", "(", "null", "!", "=", "backupRegistryClassName", ")", "{", "try", "{", "backupRegistryInstance", "=", "(", "BackupRegistry", ")", "Class", ".", "forName", "(", "backupRegistryClassName", ")", ".", "newInstance", "(", ")", ";", "}", "catch", "(", "InstantiationException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "backupRegistryInstance", "=", "new", "NotImplementedRegistryImpl", "(", ")", ";", "}", "return", "backupRegistryInstance", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "BackupRegistry", "get", "(", ")", "{", "if", "(", "backupRegistryInstance", "=", "=", "null", ")", "{", "String", "backupRegistryClassName", "=", "clientConfig", ".", "getBackupRegistryImpl", "(", ")", ";", "if", "(", "null", "!", "=", "backupRegistryClassName", ")", "{", "try", "{", "backupRegistryInstance", "=", "(", "BackupRegistry", ")", "Class", ".", "forName", "(", "backupRegistryClassName", ")", ".", "newInstance", "(", ")", ";", "}", "catch", "(", "InstantiationException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "backupRegistryInstance", "=", "new", "NotImplementedRegistryImpl", "(", ")", ";", "}", "return", "backupRegistryInstance", ";", "}", "</s>"]
["<s>", "@", "Inject", "DiscoveryClient", "(", "ApplicationInfoManager", "applicationInfoManager", ",", "EurekaClientConfig", "config", ",", "DiscoveryClientOptionalArgs", "args", ",", "Provider", "<", "BackupRegistry", ">", "backupRegistryProvider", ")", "{", "if", "(", "args", "!", "=", "null", ")", "{", "this", ".", "healthCheckHandlerProvider", "=", "args", ".", "healthCheckHandlerProvider", ";", "this", ".", "healthCheckCallbackProvider", "=", "args", ".", "healthCheckCallbackProvider", ";", "this", ".", "eventBus", "=", "args", ".", "eventBus", ";", "this", ".", "discoveryJerseyClient", "=", "args", ".", "eurekaJerseyClient", ";", "}", "else", "{", "this", ".", "healthCheckCallbackProvider", "=", "null", ";", "this", ".", "healthCheckHandlerProvider", "=", "null", ";", "this", ".", "eventBus", "=", "null", ";", "this", ".", "discoveryJerseyClient", "=", "null", ";", "}", "this", ".", "applicationInfoManager", "=", "applicationInfoManager", ";", "InstanceInfo", "myInfo", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ";", "this", ".", "backupRegistryProvider", "=", "backupRegistryProvider", ";", "try", "{", "scheduler", "=", "Executors", ".", "newScheduledThreadPool", "(", "<NUM_LIT:3>", ",", "new", "ThreadFactoryBuilder", "(", ")", ".", "setNameFormat", "(", "\"", "<STR_LIT>", "\"", ")", ".", "setDaemon", "(", "true", ")", ".", "build", "(", ")", ")", ";", "clientConfig", "=", "config", ";", "instanceInfo", "=", "myInfo", ";", "if", "(", "myInfo", "!", "=", "null", ")", "{", "appPathIdentifier", "=", "instanceInfo", ".", "getAppName", "(", ")", "+", "\"", "<STR_LIT:/>", "\"", "+", "instanceInfo", ".", "getId", "(", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "this", ".", "urlRandomizer", "=", "new", "EndpointUtils", ".", "InstanceInfoBasedUrlRandomizer", "(", "instanceInfo", ")", ";", "String", "[", "]", "availZones", "=", "clientConfig", ".", "getAvailabilityZones", "(", "clientConfig", ".", "getRegion", "(", ")", ")", ";", "final", "String", "zone", "=", "InstanceInfo", ".", "getZone", "(", "availZones", ",", "myInfo", ")", ";", "eurekaServiceUrls", ".", "set", "(", "timedGetDiscoveryServiceUrls", "(", "zone", ")", ")", ";", "scheduler", ".", "scheduleWithFixedDelay", "(", "getServiceUrlUpdateTask", "(", "zone", ")", ",", "clientConfig", ".", "getEurekaServiceUrlPollIntervalSeconds", "(", ")", ",", "clientConfig", ".", "getEurekaServiceUrlPollIntervalSeconds", "(", ")", ",", "TimeUnit", ".", "SECONDS", ")", ";", "localRegionApps", ".", "set", "(", "new", "Applications", "(", ")", ")", ";", "heartbeatExecutor", "=", "new", "ThreadPoolExecutor", "(", "1", ",", "clientConfig", ".", "getHeartbeatExecutorThreadPoolSize", "(", ")", ",", "0", ",", "TimeUnit", ".", "SECONDS", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ")", ";", "cacheRefreshExecutor", "=", "new", "ThreadPoolExecutor", "(", "1", ",", "clientConfig", ".", "getCacheRefreshExecutorThreadPoolSize", "(", ")", ",", "0", ",", "TimeUnit", ".", "SECONDS", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ")", ";", "fetchRegistryGeneration", "=", "new", "AtomicLong", "(", "0", ")", ";", "clientAccept", "=", "EurekaAccept", ".", "fromString", "(", "clientConfig", ".", "getClientDataAccept", "(", ")", ")", ";", "if", "(", "discoveryJerseyClient", "=", "=", "null", ")", "{", "EurekaJerseyClientBuilder", "clientBuilder", "=", "new", "EurekaJerseyClientBuilder", "(", ")", ".", "withUserAgent", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withConnectionTimeout", "(", "clientConfig", ".", "getEurekaServerConnectTimeoutSeconds", "(", ")", "*", "<NUM_LIT:1000>", ")", ".", "withReadTimeout", "(", "clientConfig", ".", "getEurekaServerReadTimeoutSeconds", "(", ")", "*", "<NUM_LIT:1000>", ")", ".", "withMaxConnectionsPerHost", "(", "clientConfig", ".", "getEurekaServerTotalConnectionsPerHost", "(", ")", ")", ".", "withMaxTotalConnections", "(", "clientConfig", ".", "getEurekaServerTotalConnections", "(", ")", ")", ".", "withConnectionIdleTimeout", "(", "clientConfig", ".", "getEurekaConnectionIdleTimeoutSeconds", "(", ")", ")", ".", "withEncoder", "(", "clientConfig", ".", "getEncoderName", "(", ")", ")", ".", "withDecoder", "(", "clientConfig", ".", "getDecoderName", "(", ")", ",", "clientConfig", ".", "getClientDataAccept", "(", ")", ")", ";", "if", "(", "eurekaServiceUrls", ".", "get", "(", ")", ".", "get", "(", "0", ")", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", "{", "clientBuilder", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withSystemSSLConfiguration", "(", ")", ";", "}", "else", "if", "(", "clientConfig", ".", "getProxyHost", "(", ")", "!", "=", "null", "&", "&", "clientConfig", ".", "getProxyPort", "(", ")", "!", "=", "null", ")", "{", "clientBuilder", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withProxy", "(", "clientConfig", ".", "getProxyHost", "(", ")", ",", "clientConfig", ".", "getProxyPort", "(", ")", ",", "clientConfig", ".", "getProxyUserName", "(", ")", ",", "clientConfig", ".", "getProxyPassword", "(", ")", ")", ";", "}", "else", "{", "clientBuilder", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "discoveryJerseyClient", "=", "clientBuilder", ".", "build", "(", ")", ";", "}", "discoveryApacheClient", "=", "discoveryJerseyClient", ".", "getClient", "(", ")", ";", "remoteRegionsToFetch", "=", "new", "AtomicReference", "<", "String", ">", "(", "clientConfig", ".", "fetchRegistryForRemoteRegions", "(", ")", ")", ";", "AzToRegionMapper", "azToRegionMapper", ";", "if", "(", "clientConfig", ".", "shouldUseDnsForFetchingServiceUrls", "(", ")", ")", "{", "azToRegionMapper", "=", "new", "DNSBasedAzToRegionMapper", "(", "clientConfig", ")", ";", "}", "else", "{", "azToRegionMapper", "=", "new", "PropertyBasedAzToRegionMapper", "(", "clientConfig", ")", ";", "}", "if", "(", "null", "!", "=", "remoteRegionsToFetch", ".", "get", "(", ")", ")", "{", "azToRegionMapper", ".", "setRegionsToFetch", "(", "remoteRegionsToFetch", ".", "get", "(", ")", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ")", ";", "}", "instanceRegionChecker", "=", "new", "InstanceRegionChecker", "(", "azToRegionMapper", ",", "clientConfig", ".", "getRegion", "(", ")", ")", ";", "boolean", "enableGZIPContentEncodingFilter", "=", "config", ".", "shouldGZipContent", "(", ")", ";", "if", "(", "enableGZIPContentEncodingFilter", ")", "{", "discoveryApacheClient", ".", "addFilter", "(", "new", "GZIPContentEncodingFilter", "(", "false", ")", ")", ";", "}", "String", "ip", "=", "instanceInfo", "=", "=", "null", "?", "null", ":", "instanceInfo", ".", "getIPAddr", "(", ")", ";", "EurekaClientIdentity", "identity", "=", "new", "EurekaClientIdentity", "(", "ip", ")", ";", "discoveryApacheClient", ".", "addFilter", "(", "new", "EurekaIdentityHeaderFilter", "(", "identity", ")", ")", ";", "if", "(", "args", "!", "=", "null", "&", "&", "args", ".", "additionalFilters", "!", "=", "null", ")", "{", "for", "(", "ClientFilter", "filter", ":", "args", ".", "additionalFilters", ")", "{", "discoveryApacheClient", ".", "addFilter", "(", "filter", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "if", "(", "clientConfig", ".", "shouldFetchRegistry", "(", ")", "&", "&", "!", "fetchRegistry", "(", "false", ")", ")", "{", "fetchRegistryFromBackup", "(", ")", ";", "}", "initScheduledTasks", "(", ")", ";", "try", "{", "Monitors", ".", "registerObject", "(", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "this", ".", "heartbeatStalenessMonitor", "=", "new", "ThresholdLevelsMetric", "(", "this", ",", "METRIC_REGISTRATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "new", "long", "[", "]", "{", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", "}", ")", ";", "this", ".", "registryStalenessMonitor", "=", "new", "ThresholdLevelsMetric", "(", "this", ",", "METRIC_REGISTRY_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "new", "long", "[", "]", "{", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", "}", ")", ";", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setDiscoveryClient", "(", "this", ")", ";", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setEurekaClientConfig", "(", "config", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Application", "getApplication", "(", "String", "appName", ")", "{", "return", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "appName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "getApplications", "(", ")", "{", "return", "localRegionApps", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "getApplicationsForARegion", "(", "@", "Nullable", "String", "region", ")", "{", "if", "(", "instanceRegionChecker", ".", "isLocalRegion", "(", "region", ")", ")", "{", "return", "localRegionApps", ".", "get", "(", ")", ";", "}", "else", "{", "return", "remoteRegionVsApps", ".", "get", "(", "region", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Set", "<", "String", ">", "getAllKnownRegions", "(", ")", "{", "String", "localRegion", "=", "instanceRegionChecker", ".", "getLocalRegion", "(", ")", ";", "if", "(", "!", "remoteRegionVsApps", ".", "isEmpty", "(", ")", ")", "{", "Set", "<", "String", ">", "regions", "=", "remoteRegionVsApps", ".", "keySet", "(", ")", ";", "Set", "<", "String", ">", "toReturn", "=", "new", "HashSet", "<", "String", ">", "(", "regions", ")", ";", "toReturn", ".", "add", "(", "localRegion", ")", ";", "return", "toReturn", ";", "}", "else", "{", "return", "Collections", ".", "singleton", "(", "localRegion", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "InstanceInfo", ">", "getInstancesById", "(", "String", "id", ")", "{", "List", "<", "InstanceInfo", ">", "instancesList", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "for", "(", "Application", "app", ":", "this", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", "{", "InstanceInfo", "instanceInfo", "=", "app", ".", "getByInstanceId", "(", "id", ")", ";", "if", "(", "instanceInfo", "!", "=", "null", ")", "{", "instancesList", ".", "add", "(", "instanceInfo", ")", ";", "}", "}", "return", "instancesList", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "Override", "public", "void", "registerHealthCheckCallback", "(", "HealthCheckCallback", "callback", ")", "{", "if", "(", "instanceInfo", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "callback", "!", "=", "null", ")", "{", "healthCheckHandler", "=", "new", "HealthCheckCallbackToHandlerBridge", "(", "callback", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "registerHealthCheck", "(", "HealthCheckHandler", "healthCheckHandler", ")", "{", "if", "(", "instanceInfo", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "healthCheckHandler", "!", "=", "null", ")", "{", "this", ".", "healthCheckHandler", "=", "healthCheckHandler", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVipAddress", "(", "String", "vipAddress", ",", "boolean", "secure", ")", "{", "return", "getInstancesByVipAddress", "(", "vipAddress", ",", "secure", ",", "instanceRegionChecker", ".", "getLocalRegion", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVipAddress", "(", "String", "vipAddress", ",", "boolean", "secure", ",", "@", "Nullable", "String", "region", ")", "{", "if", "(", "vipAddress", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Applications", "applications", ";", "if", "(", "instanceRegionChecker", ".", "isLocalRegion", "(", "region", ")", ")", "{", "applications", "=", "this", ".", "localRegionApps", ".", "get", "(", ")", ";", "}", "else", "{", "applications", "=", "remoteRegionVsApps", ".", "get", "(", "region", ")", ";", "if", "(", "null", "=", "=", "applications", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "region", ",", "vipAddress", ")", ";", "return", "Collections", ".", "emptyList", "(", ")", ";", "}", "}", "if", "(", "!", "secure", ")", "{", "return", "applications", ".", "getInstancesByVirtualHostName", "(", "vipAddress", ")", ";", "}", "else", "{", "return", "applications", ".", "getInstancesBySecureVirtualHostName", "(", "vipAddress", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVipAddressAndAppName", "(", "String", "vipAddress", ",", "String", "appName", ",", "boolean", "secure", ")", "{", "List", "<", "InstanceInfo", ">", "result", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "if", "(", "vipAddress", "=", "=", "null", "&", "&", "appName", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "if", "(", "vipAddress", "!", "=", "null", "&", "&", "appName", "=", "=", "null", ")", "{", "return", "getInstancesByVipAddress", "(", "vipAddress", ",", "secure", ")", ";", "}", "else", "if", "(", "vipAddress", "=", "=", "null", "&", "&", "appName", "!", "=", "null", ")", "{", "Application", "application", "=", "getApplication", "(", "appName", ")", ";", "if", "(", "application", "!", "=", "null", ")", "{", "result", "=", "application", ".", "getInstances", "(", ")", ";", "}", "return", "result", ";", "}", "String", "instanceVipAddress", ";", "for", "(", "Application", "app", ":", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "app", ".", "getInstances", "(", ")", ")", "{", "if", "(", "secure", ")", "{", "instanceVipAddress", "=", "instance", ".", "getSecureVipAddress", "(", ")", ";", "}", "else", "{", "instanceVipAddress", "=", "instance", ".", "getVIPAddress", "(", ")", ";", "}", "if", "(", "instanceVipAddress", "=", "=", "null", ")", "{", "continue", ";", "}", "String", "[", "]", "instanceVipAddresses", "=", "instanceVipAddress", ".", "split", "(", "COMMA_STRING", ")", ";", "for", "(", "String", "vipAddressFromList", ":", "instanceVipAddresses", ")", "{", "if", "(", "vipAddress", ".", "equalsIgnoreCase", "(", "vipAddressFromList", ".", "trim", "(", ")", ")", "&", "&", "appName", ".", "equalsIgnoreCase", "(", "instance", ".", "getAppName", "(", ")", ")", ")", "{", "result", ".", "add", "(", "instance", ")", ";", "break", ";", "}", "}", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "getNextServerFromEureka", "(", "String", "virtualHostname", ",", "boolean", "secure", ")", "{", "List", "<", "InstanceInfo", ">", "instanceInfoList", "=", "this", ".", "getInstancesByVipAddress", "(", "virtualHostname", ",", "secure", ")", ";", "if", "(", "instanceInfoList", "=", "=", "null", "|", "|", "instanceInfoList", ".", "isEmpty", "(", ")", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "virtualHostname", ")", ";", "}", "Applications", "apps", "=", "this", ".", "localRegionApps", ".", "get", "(", ")", ";", "int", "index", "=", "(", "int", ")", "(", "apps", ".", "getNextIndex", "(", "virtualHostname", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ",", "secure", ")", ".", "incrementAndGet", "(", ")", "%", "instanceInfoList", ".", "size", "(", ")", ")", ";", "return", "instanceInfoList", ".", "get", "(", "index", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "getApplications", "(", "String", "serviceUrl", ")", "{", "ClientResponse", "response", "=", "null", ";", "Applications", "apps", "=", "null", ";", "try", "{", "response", "=", "makeRemoteCall", "(", "Action", ".", "Refresh", ")", ";", "apps", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "logger", ".", "debug", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", "+", "response", ".", "getStatus", "(", ")", ")", ";", "return", "apps", ";", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", "+", "th", ".", "getMessage", "(", ")", ",", "th", ")", ";", "}", "finally", "{", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "return", "apps", ";", "}", "</s>"]
["<s>", "private", "boolean", "shouldRegister", "(", "InstanceInfo", "myInfo", ")", "{", "if", "(", "!", "clientConfig", ".", "shouldRegisterWithEureka", "(", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "boolean", "register", "(", ")", "throws", "Throwable", "{", "logger", ".", "info", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", ")", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "response", "=", "makeRemoteCall", "(", "Action", ".", "Register", ")", ";", "isRegisteredWithDiscovery", "=", "true", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "PREFIX", "+", "appPathIdentifier", ",", "(", "response", "!", "=", "null", "?", "response", ".", "getStatus", "(", ")", ":", "\"", "<STR_LIT>", "\"", ")", ")", ";", "return", "response", "!", "=", "null", "&", "&", "response", ".", "getStatus", "(", ")", "=", "=", "<NUM_LIT>", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "PREFIX", "+", "appPathIdentifier", ",", "e", ".", "getMessage", "(", ")", ",", "e", ")", ";", "throw", "e", ";", "}", "finally", "{", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "boolean", "renew", "(", ")", "{", "ClientResponse", "response", "=", "null", ";", "try", "{", "response", "=", "makeRemoteCall", "(", "Action", ".", "Renew", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "PREFIX", "+", "appPathIdentifier", ",", "(", "response", "!", "=", "null", "?", "response", ".", "getStatus", "(", ")", ":", "\"", "<STR_LIT>", "\"", ")", ")", ";", "if", "(", "response", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "<NUM_LIT>", ")", "{", "REREGISTER_COUNTER", ".", "increment", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "PREFIX", "+", "appPathIdentifier", ",", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "return", "register", "(", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "PREFIX", "+", "appPathIdentifier", ",", "e", ")", ";", "return", "false", ";", "}", "finally", "{", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "Override", "public", "List", "<", "String", ">", "getServiceUrlsFromConfig", "(", "String", "instanceZone", ",", "boolean", "preferSameZone", ")", "{", "return", "EndpointUtils", ".", "getServiceUrlsFromConfig", "(", "clientConfig", ",", "instanceZone", ",", "preferSameZone", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "List", "<", "String", ">", "getEurekaServiceUrlsFromConfig", "(", "String", "instanceZone", ",", "boolean", "preferSameZone", ")", "{", "return", "EndpointUtils", ".", "getServiceUrlsFromConfig", "(", "clientConfig", ",", "instanceZone", ",", "preferSameZone", ")", ";", "}", "</s>"]
["<s>", "@", "PreDestroy", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "if", "(", "statusChangeListener", "!", "=", "null", "&", "&", "applicationInfoManager", "!", "=", "null", ")", "{", "applicationInfoManager", ".", "unregisterStatusChangeListener", "(", "statusChangeListener", ".", "getId", "(", ")", ")", ";", "}", "cancelScheduledTasks", "(", ")", ";", "if", "(", "instanceInfo", "!", "=", "null", "&", "&", "shouldRegister", "(", "instanceInfo", ")", ")", "{", "instanceInfo", ".", "setStatus", "(", "InstanceStatus", ".", "DOWN", ")", ";", "unregister", "(", ")", ";", "}", "if", "(", "discoveryJerseyClient", "!", "=", "null", ")", "{", "discoveryJerseyClient", ".", "destroyResources", "(", ")", ";", "}", "heartbeatStalenessMonitor", ".", "shutdown", "(", ")", ";", "registryStalenessMonitor", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "void", "unregister", "(", ")", "{", "ClientResponse", "response", "=", "null", ";", "try", "{", "response", "=", "makeRemoteCall", "(", "Action", ".", "Cancel", ")", ";", "logger", ".", "info", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", "+", "(", "response", "!", "=", "null", "?", "response", ".", "getStatus", "(", ")", ":", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", "+", "e", ".", "getMessage", "(", ")", ",", "e", ")", ";", "}", "finally", "{", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "boolean", "fetchRegistry", "(", "boolean", "forceFullRegistryFetch", ")", "{", "ClientResponse", "response", "=", "null", ";", "Stopwatch", "tracer", "=", "FETCH_REGISTRY_TIMER", ".", "start", "(", ")", ";", "try", "{", "Applications", "applications", "=", "getApplications", "(", ")", ";", "if", "(", "clientConfig", ".", "shouldDisableDelta", "(", ")", "|", "|", "(", "!", "Strings", ".", "isNullOrEmpty", "(", "clientConfig", ".", "getRegistryRefreshSingleVipAddress", "(", ")", ")", ")", "|", "|", "forceFullRegistryFetch", "|", "|", "(", "applications", "=", "=", "null", ")", "|", "|", "(", "applications", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", "=", "=", "0", ")", "|", "|", "(", "applications", ".", "getVersion", "(", ")", "=", "=", "-", "1", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "clientConfig", ".", "shouldDisableDelta", "(", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "clientConfig", ".", "getRegistryRefreshSingleVipAddress", "(", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "forceFullRegistryFetch", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "(", "applications", "=", "=", "null", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "(", "applications", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", "=", "=", "0", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "(", "applications", ".", "getVersion", "(", ")", "=", "=", "-", "1", ")", ")", ";", "response", "=", "getAndStoreFullRegistry", "(", ")", ";", "}", "else", "{", "response", "=", "getAndUpdateDelta", "(", "applications", ")", ";", "}", "applications", ".", "setAppsHashCode", "(", "applications", ".", "getReconcileHashCode", "(", ")", ")", ";", "logTotalInstances", "(", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", "+", "response", ".", "getStatus", "(", ")", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "PREFIX", "+", "appPathIdentifier", "+", "\"", "<STR_LIT>", "\"", "+", "e", ".", "getMessage", "(", ")", ",", "e", ")", ";", "return", "false", ";", "}", "finally", "{", "if", "(", "tracer", "!", "=", "null", ")", "{", "tracer", ".", "stop", "(", ")", ";", "}", "closeResponse", "(", "response", ")", ";", "}", "onCacheRefreshed", "(", ")", ";", "updateInstanceRemoteStatus", "(", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "private", "synchronized", "void", "updateInstanceRemoteStatus", "(", ")", "{", "InstanceInfo", ".", "InstanceStatus", "currentRemoteInstanceStatus", "=", "null", ";", "if", "(", "instanceInfo", ".", "getAppName", "(", ")", "!", "=", "null", ")", "{", "Application", "app", "=", "getApplication", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "if", "(", "app", "!", "=", "null", ")", "{", "InstanceInfo", "remoteInstanceInfo", "=", "app", ".", "getByInstanceId", "(", "instanceInfo", ".", "getId", "(", ")", ")", ";", "if", "(", "remoteInstanceInfo", "!", "=", "null", ")", "{", "currentRemoteInstanceStatus", "=", "remoteInstanceInfo", ".", "getStatus", "(", ")", ";", "}", "}", "}", "if", "(", "currentRemoteInstanceStatus", "=", "=", "null", ")", "{", "currentRemoteInstanceStatus", "=", "InstanceInfo", ".", "InstanceStatus", ".", "UNKNOWN", ";", "}", "if", "(", "lastRemoteInstanceStatus", "!", "=", "currentRemoteInstanceStatus", ")", "{", "onRemoteStatusChanged", "(", "lastRemoteInstanceStatus", ",", "currentRemoteInstanceStatus", ")", ";", "lastRemoteInstanceStatus", "=", "currentRemoteInstanceStatus", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", ".", "InstanceStatus", "getInstanceRemoteStatus", "(", ")", "{", "return", "lastRemoteInstanceStatus", ";", "}", "</s>"]
["<s>", "private", "String", "getReconcileHashCode", "(", "Applications", "applications", ")", "{", "TreeMap", "<", "String", ",", "AtomicInteger", ">", "instanceCountMap", "=", "new", "TreeMap", "<", "String", ",", "AtomicInteger", ">", "(", ")", ";", "if", "(", "isFetchingRemoteRegionRegistries", "(", ")", ")", "{", "for", "(", "Applications", "remoteApp", ":", "remoteRegionVsApps", ".", "values", "(", ")", ")", "{", "remoteApp", ".", "populateInstanceCountMap", "(", "instanceCountMap", ")", ";", "}", "}", "applications", ".", "populateInstanceCountMap", "(", "instanceCountMap", ")", ";", "return", "Applications", ".", "getReconcileHashCode", "(", "instanceCountMap", ")", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "getAndStoreFullRegistry", "(", ")", "throws", "Throwable", "{", "long", "currentUpdateGeneration", "=", "fetchRegistryGeneration", ".", "get", "(", ")", ";", "ClientResponse", "response", "=", "makeRemoteCall", "(", "Action", ".", "Refresh", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Applications", "apps", "=", "null", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", ")", "{", "apps", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "}", "if", "(", "apps", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "if", "(", "fetchRegistryGeneration", ".", "compareAndSet", "(", "currentUpdateGeneration", ",", "currentUpdateGeneration", "+", "1", ")", ")", "{", "localRegionApps", ".", "set", "(", "this", ".", "filterAndShuffle", "(", "apps", ")", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "apps", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "response", ".", "getStatus", "(", ")", ")", ";", "return", "response", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "getAndUpdateDelta", "(", "Applications", "applications", ")", "throws", "Throwable", "{", "long", "currentUpdateGeneration", "=", "fetchRegistryGeneration", ".", "get", "(", ")", ";", "ClientResponse", "response", "=", "makeRemoteCall", "(", "Action", ".", "Refresh_Delta", ")", ";", "Applications", "delta", "=", "null", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", ")", "{", "delta", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "}", "if", "(", "delta", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "closeResponse", "(", "response", ")", ";", "response", "=", "getAndStoreFullRegistry", "(", ")", ";", "}", "else", "if", "(", "fetchRegistryGeneration", ".", "compareAndSet", "(", "currentUpdateGeneration", ",", "currentUpdateGeneration", "+", "1", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "delta", ".", "getAppsHashCode", "(", ")", ")", ";", "String", "reconcileHashCode", "=", "\"", "\"", ";", "if", "(", "fetchRegistryUpdateLock", ".", "tryLock", "(", ")", ")", "{", "try", "{", "updateDelta", "(", "delta", ")", ";", "reconcileHashCode", "=", "getReconcileHashCode", "(", "applications", ")", ";", "}", "finally", "{", "fetchRegistryUpdateLock", ".", "unlock", "(", ")", ";", "}", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "response", ";", "}", "if", "(", "(", "!", "reconcileHashCode", ".", "equals", "(", "delta", ".", "getAppsHashCode", "(", ")", ")", ")", "|", "|", "clientConfig", ".", "shouldLogDeltaDiff", "(", ")", ")", "{", "response", "=", "reconcileAndLogDifference", "(", "response", ",", "delta", ",", "reconcileHashCode", ")", ";", "}", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "delta", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "return", "response", ";", "}", "</s>"]
["<s>", "private", "void", "logTotalInstances", "(", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "int", "totInstances", "=", "0", ";", "for", "(", "Application", "application", ":", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", "{", "totInstances", "+", "=", "application", ".", "getInstancesAsIsFromEureka", "(", ")", ".", "size", "(", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "totInstances", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ClientResponse", "reconcileAndLogDifference", "(", "ClientResponse", "response", ",", "Applications", "delta", ",", "String", "reconcileHashCode", ")", "throws", "Throwable", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "reconcileHashCode", ",", "delta", ".", "getAppsHashCode", "(", ")", ")", ";", "RECONCILE_HASH_CODES_MISMATCH", ".", "increment", "(", ")", ";", "this", ".", "closeResponse", "(", "response", ")", ";", "long", "currentUpdateGeneration", "=", "fetchRegistryGeneration", ".", "get", "(", ")", ";", "response", "=", "makeRemoteCall", "(", "Action", ".", "Refresh", ")", ";", "Applications", "serverApps", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "try", "{", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "reconcileDiffMap", "=", "getApplications", "(", ")", ".", "getReconcileMapDiff", "(", "serverApps", ")", ";", "String", "reconcileString", "=", "\"", "\"", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "List", "<", "String", ">", ">", "mapEntry", ":", "reconcileDiffMap", ".", "entrySet", "(", ")", ")", "{", "reconcileString", "=", "reconcileString", "+", "mapEntry", ".", "getKey", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "for", "(", "String", "displayString", ":", "mapEntry", ".", "getValue", "(", ")", ")", "{", "reconcileString", "=", "reconcileString", "+", "displayString", ";", "}", "reconcileString", "=", "reconcileString", "+", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ";", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "reconcileString", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "if", "(", "fetchRegistryGeneration", ".", "compareAndSet", "(", "currentUpdateGeneration", ",", "currentUpdateGeneration", "+", "1", ")", ")", "{", "localRegionApps", ".", "set", "(", "this", ".", "filterAndShuffle", "(", "serverApps", ")", ")", ";", "getApplications", "(", ")", ".", "setVersion", "(", "delta", ".", "getVersion", "(", ")", ")", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getApplications", "(", ")", ".", "getReconcileHashCode", "(", ")", ",", "delta", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "response", ";", "}", "</s>"]
["<s>", "private", "void", "updateDelta", "(", "Applications", "delta", ")", "{", "int", "deltaCount", "=", "0", ";", "for", "(", "Application", "app", ":", "delta", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "app", ".", "getInstances", "(", ")", ")", "{", "Applications", "applications", "=", "getApplications", "(", ")", ";", "String", "instanceRegion", "=", "instanceRegionChecker", ".", "getInstanceRegion", "(", "instance", ")", ";", "if", "(", "!", "instanceRegionChecker", ".", "isLocalRegion", "(", "instanceRegion", ")", ")", "{", "Applications", "remoteApps", "=", "remoteRegionVsApps", ".", "get", "(", "instanceRegion", ")", ";", "if", "(", "null", "=", "=", "remoteApps", ")", "{", "remoteApps", "=", "new", "Applications", "(", ")", ";", "remoteRegionVsApps", ".", "put", "(", "instanceRegion", ",", "remoteApps", ")", ";", "}", "applications", "=", "remoteApps", ";", "}", "+", "+", "deltaCount", ";", "if", "(", "ActionType", ".", "ADDED", ".", "equals", "(", "instance", ".", "getActionType", "(", ")", ")", ")", "{", "Application", "existingApp", "=", "applications", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "existingApp", "=", "=", "null", ")", "{", "applications", ".", "addApplication", "(", "app", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instance", ".", "getId", "(", ")", ",", "instanceRegion", ")", ";", "applications", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ".", "addInstance", "(", "instance", ")", ";", "}", "else", "if", "(", "ActionType", ".", "MODIFIED", ".", "equals", "(", "instance", ".", "getActionType", "(", ")", ")", ")", "{", "Application", "existingApp", "=", "applications", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "existingApp", "=", "=", "null", ")", "{", "applications", ".", "addApplication", "(", "app", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instance", ".", "getId", "(", ")", ")", ";", "applications", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ".", "addInstance", "(", "instance", ")", ";", "}", "else", "if", "(", "ActionType", ".", "DELETED", ".", "equals", "(", "instance", ".", "getActionType", "(", ")", ")", ")", "{", "Application", "existingApp", "=", "applications", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "existingApp", "=", "=", "null", ")", "{", "applications", ".", "addApplication", "(", "app", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instance", ".", "getId", "(", ")", ")", ";", "applications", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ".", "removeInstance", "(", "instance", ")", ";", "}", "}", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "deltaCount", ")", ";", "getApplications", "(", ")", ".", "setVersion", "(", "delta", ".", "getVersion", "(", ")", ")", ";", "getApplications", "(", ")", ".", "shuffleInstances", "(", "clientConfig", ".", "shouldFilterOnlyUpInstances", "(", ")", ")", ";", "for", "(", "Applications", "applications", ":", "remoteRegionVsApps", ".", "values", "(", ")", ")", "{", "applications", ".", "setVersion", "(", "delta", ".", "getVersion", "(", ")", ")", ";", "applications", ".", "shuffleInstances", "(", "clientConfig", ".", "shouldFilterOnlyUpInstances", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ClientResponse", "makeRemoteCall", "(", "Action", "action", ")", "throws", "Throwable", "{", "ClientResponse", "response", ";", "if", "(", "isQueryAction", "(", "action", ")", ")", "{", "response", "=", "makeRemoteCallToRedirectedServer", "(", "lastQueryRedirect", ",", "action", ")", ";", "}", "else", "{", "response", "=", "makeRemoteCallToRedirectedServer", "(", "lastRegisterRedirect", ",", "action", ")", ";", "}", "if", "(", "response", "=", "=", "null", ")", "{", "response", "=", "makeRemoteCall", "(", "action", ",", "0", ")", ";", "}", "return", "response", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "makeRemoteCallToRedirectedServer", "(", "AtomicReference", "<", "String", ">", "lastRedirect", ",", "Action", "action", ")", "{", "String", "lastRedirectUrl", "=", "lastRedirect", ".", "get", "(", ")", ";", "if", "(", "lastRedirectUrl", "!", "=", "null", ")", "{", "try", "{", "ClientResponse", "clientResponse", "=", "makeRemoteCall", "(", "action", ",", "lastRedirectUrl", ")", ";", "int", "status", "=", "clientResponse", ".", "getStatus", "(", ")", ";", "if", "(", "status", ">", "=", "<NUM_LIT>", "&", "&", "status", "<", "<NUM_LIT>", ")", "{", "return", "clientResponse", ";", "}", "SERVER_RETRY_COUNTER", ".", "increment", "(", ")", ";", "lastRedirect", ".", "compareAndSet", "(", "lastRedirectUrl", ",", "null", ")", ";", "}", "catch", "(", "Throwable", "ignored", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "SERVER_RETRY_COUNTER", ".", "increment", "(", ")", ";", "lastRedirect", ".", "compareAndSet", "(", "lastRedirectUrl", ",", "null", ")", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isQueryAction", "(", "Action", "action", ")", "{", "return", "action", "=", "=", "Action", ".", "Refresh", "|", "|", "action", "=", "=", "Action", ".", "Refresh_Delta", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "makeRemoteCall", "(", "Action", "action", ",", "int", "serviceUrlIndex", ")", "throws", "Throwable", "{", "String", "serviceUrl", ";", "try", "{", "serviceUrl", "=", "eurekaServiceUrls", ".", "get", "(", ")", ".", "get", "(", "serviceUrlIndex", ")", ";", "return", "makeRemoteCallWithFollowRedirect", "(", "action", ",", "serviceUrl", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "if", "(", "eurekaServiceUrls", ".", "get", "(", ")", ".", "size", "(", ")", ">", "+", "+", "serviceUrlIndex", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "eurekaServiceUrls", ".", "get", "(", ")", ".", "get", "(", "serviceUrlIndex", ")", ")", ";", "SERVER_RETRY_COUNTER", ".", "increment", "(", ")", ";", "return", "makeRemoteCall", "(", "action", ",", "serviceUrlIndex", ")", ";", "}", "else", "{", "ALL_SERVER_FAILURE_COUNT", ".", "increment", "(", ")", ";", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "throw", "t", ";", "}", "}", "}", "</s>"]
["<s>", "private", "ClientResponse", "makeRemoteCallWithFollowRedirect", "(", "Action", "action", ",", "String", "serviceUrl", ")", "throws", "Throwable", "{", "URI", "targetUrl", "=", "new", "URI", "(", "serviceUrl", ")", ";", "for", "(", "int", "followRedirectCount", "=", "0", ";", "followRedirectCount", "<", "MAX_FOLLOWED_REDIRECTS", ";", "followRedirectCount", "+", "+", ")", "{", "ClientResponse", "clientResponse", "=", "makeRemoteCall", "(", "action", ",", "targetUrl", ".", "toString", "(", ")", ")", ";", "if", "(", "clientResponse", ".", "getStatus", "(", ")", "!", "=", "<NUM_LIT>", ")", "{", "if", "(", "followRedirectCount", ">", "0", ")", "{", "if", "(", "isQueryAction", "(", "action", ")", ")", "{", "lastQueryRedirect", ".", "set", "(", "targetUrl", ".", "toString", "(", ")", ")", ";", "}", "else", "{", "lastRegisterRedirect", ".", "set", "(", "targetUrl", ".", "toString", "(", ")", ")", ";", "}", "}", "return", "clientResponse", ";", "}", "targetUrl", "=", "getRedirectBaseUri", "(", "clientResponse", ".", "getLocation", "(", ")", ")", ";", "if", "(", "targetUrl", "=", "=", "null", ")", "{", "throw", "new", "IOException", "(", "\"", "<STR_LIT>", "\"", "+", "clientResponse", ".", "getLocation", "(", ")", ")", ";", "}", "}", "String", "message", "=", "\"", "<STR_LIT>", "\"", "+", "serviceUrl", ";", "logger", ".", "warn", "(", "message", ")", ";", "throw", "new", "IOException", "(", "message", ")", ";", "}", "</s>"]
["<s>", "private", "static", "URI", "getRedirectBaseUri", "(", "URI", "targetUrl", ")", "{", "Matcher", "pathMatcher", "=", "REDIRECT_PATH_REGEX", ".", "matcher", "(", "targetUrl", ".", "getPath", "(", ")", ")", ";", "if", "(", "pathMatcher", ".", "matches", "(", ")", ")", "{", "return", "UriBuilder", ".", "fromUri", "(", "targetUrl", ")", ".", "host", "(", "DnsResolver", ".", "resolve", "(", "targetUrl", ".", "getHost", "(", ")", ")", ")", ".", "replacePath", "(", "pathMatcher", ".", "group", "(", "1", ")", ")", ".", "replaceQuery", "(", "null", ")", ".", "build", "(", ")", ";", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "targetUrl", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "makeRemoteCall", "(", "Action", "action", ",", "String", "serviceUrl", ")", "throws", "Throwable", "{", "String", "urlPath", "=", "null", ";", "Stopwatch", "tracer", "=", "null", ";", "ClientResponse", "response", "=", "null", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "serviceUrl", ",", "action", ")", ";", "try", "{", "if", "(", "(", "UNKNOWN", ".", "equals", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", "&", "&", "(", "!", "Action", ".", "Refresh", ".", "equals", "(", "action", ")", ")", "&", "&", "(", "!", "Action", ".", "Refresh_Delta", ".", "equals", "(", "action", ")", ")", ")", ")", "{", "return", "null", ";", "}", "WebResource", "r", "=", "discoveryApacheClient", ".", "resource", "(", "serviceUrl", ")", ";", "if", "(", "clientConfig", ".", "allowRedirects", "(", ")", ")", "{", "r", ".", "header", "(", "HTTP_X_DISCOVERY_ALLOW_REDIRECT", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "String", "remoteRegionsToFetchStr", ";", "switch", "(", "action", ")", "{", "case", "Renew", ":", "tracer", "=", "RENEW_TIMER", ".", "start", "(", ")", ";", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appPathIdentifier", ";", "response", "=", "r", ".", "path", "(", "urlPath", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "instanceInfo", ".", "getStatus", "(", ")", ".", "toString", "(", ")", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "instanceInfo", ".", "getLastDirtyTimestamp", "(", ")", ".", "toString", "(", ")", ")", ".", "put", "(", "ClientResponse", ".", "class", ")", ";", "break", ";", "case", "Refresh", ":", "tracer", "=", "REFRESH_TIMER", ".", "start", "(", ")", ";", "final", "String", "vipAddress", "=", "clientConfig", ".", "getRegistryRefreshSingleVipAddress", "(", ")", ";", "urlPath", "=", "vipAddress", "=", "=", "null", "?", "\"", "<STR_LIT:/>", "\"", ":", "\"", "<STR_LIT:/>", "\"", "+", "vipAddress", ";", "remoteRegionsToFetchStr", "=", "remoteRegionsToFetch", ".", "get", "(", ")", ";", "if", "(", "!", "Strings", ".", "isNullOrEmpty", "(", "remoteRegionsToFetchStr", ")", ")", "{", "urlPath", "+", "=", "\"", "<STR_LIT>", "\"", "+", "remoteRegionsToFetchStr", ";", "}", "response", "=", "getUrl", "(", "serviceUrl", "+", "urlPath", ")", ";", "break", ";", "case", "Refresh_Delta", ":", "tracer", "=", "REFRESH_DELTA_TIMER", ".", "start", "(", ")", ";", "urlPath", "=", "\"", "<STR_LIT>", "\"", ";", "remoteRegionsToFetchStr", "=", "remoteRegionsToFetch", ".", "get", "(", ")", ";", "if", "(", "!", "Strings", ".", "isNullOrEmpty", "(", "remoteRegionsToFetchStr", ")", ")", "{", "urlPath", "+", "=", "\"", "<STR_LIT>", "\"", "+", "remoteRegionsToFetchStr", ";", "}", "response", "=", "getUrl", "(", "serviceUrl", "+", "urlPath", ")", ";", "break", ";", "case", "Register", ":", "tracer", "=", "REGISTER_TIMER", ".", "start", "(", ")", ";", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", ";", "response", "=", "r", ".", "path", "(", "urlPath", ")", ".", "type", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "ClientResponse", ".", "class", ",", "instanceInfo", ")", ";", "break", ";", "case", "Cancel", ":", "tracer", "=", "CANCEL_TIMER", ".", "start", "(", ")", ";", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appPathIdentifier", ";", "response", "=", "r", ".", "path", "(", "urlPath", ")", ".", "delete", "(", "ClientResponse", ".", "class", ")", ";", "if", "(", "(", "!", "isRegisteredWithDiscovery", ")", "&", "&", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "NOT_FOUND", ".", "getStatusCode", "(", ")", ")", ")", "{", "return", "response", ";", "}", "break", ";", "}", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "String", "[", "]", "{", "serviceUrl", ",", "urlPath", ",", "String", ".", "valueOf", "(", "response", ".", "getStatus", "(", ")", ")", "}", ")", ";", "}", "if", "(", "isOk", "(", "action", ",", "response", ".", "getStatus", "(", ")", ")", ")", "{", "return", "response", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "action", "+", "\"", "<STR_LIT>", "\"", "+", "response", ".", "getStatus", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "serviceUrl", "+", "urlPath", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "response", ".", "getStatus", "(", ")", ")", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "closeResponse", "(", "response", ")", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "serviceUrl", "+", "urlPath", ",", "t", ")", ";", "throw", "t", ";", "}", "finally", "{", "if", "(", "tracer", "!", "=", "null", ")", "{", "tracer", ".", "stop", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "closeResponse", "(", "ClientResponse", "response", ")", "{", "if", "(", "response", "!", "=", "null", ")", "{", "try", "{", "response", ".", "close", "(", ")", ";", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "initScheduledTasks", "(", ")", "{", "if", "(", "clientConfig", ".", "shouldFetchRegistry", "(", ")", ")", "{", "int", "registryFetchIntervalSeconds", "=", "clientConfig", ".", "getRegistryFetchIntervalSeconds", "(", ")", ";", "int", "expBackOffBound", "=", "clientConfig", ".", "getCacheRefreshExecutorExponentialBackOffBound", "(", ")", ";", "scheduler", ".", "schedule", "(", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "cacheRefreshExecutor", ",", "registryFetchIntervalSeconds", ",", "TimeUnit", ".", "SECONDS", ",", "expBackOffBound", ",", "new", "CacheRefreshThread", "(", ")", ")", ",", "registryFetchIntervalSeconds", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "if", "(", "shouldRegister", "(", "instanceInfo", ")", ")", "{", "int", "renewalIntervalInSecs", "=", "instanceInfo", ".", "getLeaseInfo", "(", ")", ".", "getRenewalIntervalInSecs", "(", ")", ";", "int", "expBackOffBound", "=", "clientConfig", ".", "getHeartbeatExecutorExponentialBackOffBound", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "renewalIntervalInSecs", ")", ";", "scheduler", ".", "schedule", "(", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", ",", "scheduler", ",", "heartbeatExecutor", ",", "renewalIntervalInSecs", ",", "TimeUnit", ".", "SECONDS", ",", "expBackOffBound", ",", "new", "HeartbeatThread", "(", ")", ")", ",", "renewalIntervalInSecs", ",", "TimeUnit", ".", "SECONDS", ")", ";", "instanceInfoReplicator", "=", "new", "InstanceInfoReplicator", "(", "this", ",", "instanceInfo", ",", "clientConfig", ".", "getInstanceInfoReplicationIntervalSeconds", "(", ")", ",", "<NUM_LIT:2>", ")", ";", "statusChangeListener", "=", "new", "ApplicationInfoManager", ".", "StatusChangeListener", "(", ")", "{", "@", "Override", "public", "String", "getId", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "@", "Override", "public", "void", "notify", "(", "StatusChangeEvent", "statusChangeEvent", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "statusChangeEvent", ")", ";", "instanceInfoReplicator", ".", "onDemandUpdate", "(", ")", ";", "}", "}", ";", "if", "(", "clientConfig", ".", "shouldOnDemandUpdateStatusChange", "(", ")", ")", "{", "applicationInfoManager", ".", "registerStatusChangeListener", "(", "statusChangeListener", ")", ";", "}", "instanceInfoReplicator", ".", "start", "(", "clientConfig", ".", "getInitialInstanceInfoReplicationIntervalSeconds", "(", ")", ")", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getId", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "notify", "(", "StatusChangeEvent", "statusChangeEvent", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "statusChangeEvent", ")", ";", "instanceInfoReplicator", ".", "onDemandUpdate", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "cancelScheduledTasks", "(", ")", "{", "if", "(", "instanceInfoReplicator", "!", "=", "null", ")", "{", "instanceInfoReplicator", ".", "stop", "(", ")", ";", "}", "heartbeatExecutor", ".", "shutdownNow", "(", ")", ";", "cacheRefreshExecutor", ".", "shutdownNow", "(", ")", ";", "scheduler", ".", "shutdownNow", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "Override", "public", "List", "<", "String", ">", "getServiceUrlsFromDNS", "(", "String", "instanceZone", ",", "boolean", "preferSameZone", ")", "{", "return", "EndpointUtils", ".", "getServiceUrlsFromDNS", "(", "clientConfig", ",", "instanceZone", ",", "preferSameZone", ",", "urlRandomizer", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "Override", "public", "List", "<", "String", ">", "getDiscoveryServiceUrls", "(", "String", "zone", ")", "{", "return", "EndpointUtils", ".", "getDiscoveryServiceUrls", "(", "clientConfig", ",", "zone", ",", "urlRandomizer", ")", ";", "}", "</s>"]
["<s>", "private", "List", "<", "String", ">", "timedGetDiscoveryServiceUrls", "(", "String", "zone", ")", "{", "boolean", "shouldUseDns", "=", "clientConfig", ".", "shouldUseDnsForFetchingServiceUrls", "(", ")", ";", "if", "(", "shouldUseDns", ")", "{", "Stopwatch", "t", "=", "GET_SERVICE_URLS_DNS_TIMER", ".", "start", "(", ")", ";", "List", "<", "String", ">", "result", "=", "EndpointUtils", ".", "getServiceUrlsFromDNS", "(", "clientConfig", ",", "zone", ",", "clientConfig", ".", "shouldPreferSameZoneEureka", "(", ")", ",", "urlRandomizer", ")", ";", "t", ".", "stop", "(", ")", ";", "return", "result", ";", "}", "return", "EndpointUtils", ".", "getServiceUrlsFromConfig", "(", "clientConfig", ",", "zone", ",", "clientConfig", ".", "shouldPreferSameZoneEureka", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "String", "getZone", "(", "InstanceInfo", "myInfo", ")", "{", "String", "[", "]", "availZones", "=", "clientConfig", ".", "getAvailabilityZones", "(", "clientConfig", ".", "getRegion", "(", ")", ")", ";", "return", "InstanceInfo", ".", "getZone", "(", "availZones", ",", "myInfo", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "String", "getRegion", "(", ")", "{", "String", "region", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "if", "(", "region", "=", "=", "null", ")", "{", "region", "=", "\"", "<STR_LIT>", "\"", ";", "}", "region", "=", "region", ".", "trim", "(", ")", ".", "toLowerCase", "(", ")", ";", "return", "region", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "Set", "<", "String", ">", "getEC2DiscoveryUrlsFromZone", "(", "String", "dnsName", ",", "EndpointUtils", ".", "DiscoveryUrlType", "type", ")", "{", "return", "EndpointUtils", ".", "getEC2DiscoveryUrlsFromZone", "(", "dnsName", ",", "type", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isOk", "(", "Action", "action", ",", "int", "httpStatus", ")", "{", "if", "(", "httpStatus", ">", "=", "<NUM_LIT>", "&", "&", "httpStatus", "<", "<NUM_LIT>", "|", "|", "httpStatus", "=", "=", "<NUM_LIT>", ")", "{", "return", "true", ";", "}", "else", "if", "(", "Action", ".", "Renew", "=", "=", "action", "&", "&", "httpStatus", "=", "=", "<NUM_LIT>", ")", "{", "return", "true", ";", "}", "else", "if", "(", "Action", ".", "Refresh_Delta", "=", "=", "action", "&", "&", "(", "httpStatus", "=", "=", "<NUM_LIT>", "|", "|", "httpStatus", "=", "=", "<NUM_LIT>", ")", ")", "{", "return", "true", ";", "}", "else", "{", "return", "false", ";", "}", "}", "</s>"]
["<s>", "private", "InstanceInfo", "getCoordinatingServer", "(", ")", "{", "Application", "app", "=", "getApplication", "(", "DISCOVERY_APPID", ")", ";", "List", "<", "InstanceInfo", ">", "discoveryInstances", "=", "null", ";", "InstanceInfo", "instanceToReturn", "=", "null", ";", "if", "(", "app", "!", "=", "null", ")", "{", "discoveryInstances", "=", "app", ".", "getInstances", "(", ")", ";", "}", "if", "(", "discoveryInstances", "!", "=", "null", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "discoveryInstances", ")", "{", "if", "(", "(", "instance", "!", "=", "null", ")", "&", "&", "(", "instance", ".", "isCoordinatingDiscoveryServer", "(", ")", ")", ")", "{", "instanceToReturn", "=", "instance", ";", "break", ";", "}", "}", "}", "return", "instanceToReturn", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "getUrl", "(", "String", "fullServiceUrl", ")", "{", "ClientResponse", "cr", "=", "discoveryApacheClient", ".", "resource", "(", "fullServiceUrl", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "header", "(", "EurekaAccept", ".", "HTTP_X_EUREKA_ACCEPT", ",", "clientAccept", ".", "name", "(", ")", ")", ".", "get", "(", "ClientResponse", ".", "class", ")", ";", "return", "cr", ";", "}", "</s>"]
["<s>", "void", "refreshInstanceInfo", "(", ")", "{", "applicationInfoManager", ".", "refreshDataCenterInfoIfRequired", "(", ")", ";", "applicationInfoManager", ".", "refreshLeaseInfoIfRequired", "(", ")", ";", "InstanceStatus", "status", ";", "try", "{", "status", "=", "getHealthCheckHandler", "(", ")", ".", "getStatus", "(", "instanceInfo", ".", "getStatus", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "status", "=", "InstanceStatus", ".", "DOWN", ";", "}", "if", "(", "null", "!", "=", "status", ")", "{", "instanceInfo", ".", "setStatus", "(", "status", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "run", "(", ")", "{", "if", "(", "renew", "(", ")", ")", "{", "lastSuccessfulHeartbeatTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "InstanceInfoReplicator", "getInstanceInfoReplicator", "(", ")", "{", "return", "instanceInfoReplicator", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "InstanceInfo", "getInstanceInfo", "(", ")", "{", "return", "instanceInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HealthCheckHandler", "getHealthCheckHandler", "(", ")", "{", "if", "(", "healthCheckHandler", "=", "=", "null", ")", "{", "if", "(", "null", "!", "=", "healthCheckHandlerProvider", ")", "{", "healthCheckHandler", "=", "healthCheckHandlerProvider", ".", "get", "(", ")", ";", "}", "else", "if", "(", "null", "!", "=", "healthCheckCallbackProvider", ")", "{", "healthCheckHandler", "=", "new", "HealthCheckCallbackToHandlerBridge", "(", "healthCheckCallbackProvider", ".", "get", "(", ")", ")", ";", "}", "if", "(", "null", "=", "=", "healthCheckHandler", ")", "{", "healthCheckHandler", "=", "new", "HealthCheckCallbackToHandlerBridge", "(", "null", ")", ";", "}", "}", "return", "healthCheckHandler", ";", "}", "</s>"]
["<s>", "public", "void", "run", "(", ")", "{", "try", "{", "boolean", "isFetchingRemoteRegionRegistries", "=", "isFetchingRemoteRegionRegistries", "(", ")", ";", "boolean", "remoteRegionsModified", "=", "false", ";", "String", "latestRemoteRegions", "=", "clientConfig", ".", "fetchRegistryForRemoteRegions", "(", ")", ";", "if", "(", "null", "!", "=", "latestRemoteRegions", ")", "{", "String", "currentRemoteRegions", "=", "remoteRegionsToFetch", ".", "get", "(", ")", ";", "if", "(", "!", "latestRemoteRegions", ".", "equals", "(", "currentRemoteRegions", ")", ")", "{", "synchronized", "(", "instanceRegionChecker", ".", "getAzToRegionMapper", "(", ")", ")", "{", "if", "(", "remoteRegionsToFetch", ".", "compareAndSet", "(", "currentRemoteRegions", ",", "latestRemoteRegions", ")", ")", "{", "String", "[", "]", "remoteRegions", "=", "latestRemoteRegions", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "instanceRegionChecker", ".", "getAzToRegionMapper", "(", ")", ".", "setRegionsToFetch", "(", "remoteRegions", ")", ";", "remoteRegionsModified", "=", "true", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "currentRemoteRegions", ",", "latestRemoteRegions", ")", ";", "}", "}", "}", "else", "{", "instanceRegionChecker", ".", "getAzToRegionMapper", "(", ")", ".", "refreshMapping", "(", ")", ";", "}", "}", "boolean", "success", "=", "fetchRegistry", "(", "remoteRegionsModified", ")", ";", "if", "(", "success", ")", "{", "lastSuccessfulRegistryFetchTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "StringBuilder", "allAppsHashCodes", "=", "new", "StringBuilder", "(", ")", ";", "allAppsHashCodes", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allAppsHashCodes", ".", "append", "(", "localRegionApps", ".", "get", "(", ")", ".", "getAppsHashCode", "(", ")", ")", ";", "allAppsHashCodes", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allAppsHashCodes", ".", "append", "(", "isFetchingRemoteRegionRegistries", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Applications", ">", "entry", ":", "remoteRegionVsApps", ".", "entrySet", "(", ")", ")", "{", "allAppsHashCodes", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allAppsHashCodes", ".", "append", "(", "entry", ".", "getKey", "(", ")", ")", ";", "allAppsHashCodes", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allAppsHashCodes", ".", "append", "(", "entry", ".", "getValue", "(", ")", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "allAppsHashCodes", ".", "toString", "(", ")", ")", ";", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "fetchRegistryFromBackup", "(", ")", "{", "try", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "BackupRegistry", "backupRegistryInstance", "=", "newBackupRegistryInstance", "(", ")", ";", "if", "(", "null", "=", "=", "backupRegistryInstance", ")", "{", "backupRegistryInstance", "=", "backupRegistryProvider", ".", "get", "(", ")", ";", "}", "if", "(", "null", "!", "=", "backupRegistryInstance", ")", "{", "Applications", "apps", "=", "null", ";", "if", "(", "isFetchingRemoteRegionRegistries", "(", ")", ")", "{", "String", "remoteRegionsStr", "=", "remoteRegionsToFetch", ".", "get", "(", ")", ";", "if", "(", "null", "!", "=", "remoteRegionsStr", ")", "{", "apps", "=", "backupRegistryInstance", ".", "fetchRegistry", "(", "remoteRegionsStr", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ")", ";", "}", "}", "else", "{", "apps", "=", "backupRegistryInstance", ".", "fetchRegistry", "(", ")", ";", "}", "if", "(", "apps", "!", "=", "null", ")", "{", "final", "Applications", "applications", "=", "this", ".", "filterAndShuffle", "(", "apps", ")", ";", "applications", ".", "setAppsHashCode", "(", "applications", ".", "getReconcileHashCode", "(", ")", ")", ";", "localRegionApps", ".", "set", "(", "applications", ")", ";", "logTotalInstances", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "Nullable", "protected", "BackupRegistry", "newBackupRegistryInstance", "(", ")", "throws", "ClassNotFoundException", ",", "IllegalAccessException", ",", "InstantiationException", "{", "return", "null", ";", "}", "</s>"]
["<s>", "private", "TimerTask", "getServiceUrlUpdateTask", "(", "final", "String", "zone", ")", "{", "return", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "List", "<", "String", ">", "serviceUrlList", "=", "timedGetDiscoveryServiceUrls", "(", "zone", ")", ";", "if", "(", "serviceUrlList", ".", "isEmpty", "(", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "if", "(", "!", "serviceUrlList", ".", "equals", "(", "eurekaServiceUrls", ".", "get", "(", ")", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "eurekaServiceUrls", ".", "get", "(", ")", ".", "toArray", "(", ")", ")", ",", "Arrays", ".", "toString", "(", "serviceUrlList", ".", "toArray", "(", ")", ")", ")", ";", "eurekaServiceUrls", ".", "set", "(", "serviceUrlList", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "List", "<", "String", ">", "serviceUrlList", "=", "timedGetDiscoveryServiceUrls", "(", "zone", ")", ";", "if", "(", "serviceUrlList", ".", "isEmpty", "(", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "if", "(", "!", "serviceUrlList", ".", "equals", "(", "eurekaServiceUrls", ".", "get", "(", ")", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "eurekaServiceUrls", ".", "get", "(", ")", ".", "toArray", "(", ")", ")", ",", "Arrays", ".", "toString", "(", "serviceUrlList", ".", "toArray", "(", ")", ")", ")", ";", "eurekaServiceUrls", ".", "set", "(", "serviceUrlList", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Applications", "filterAndShuffle", "(", "Applications", "apps", ")", "{", "if", "(", "apps", "!", "=", "null", ")", "{", "if", "(", "isFetchingRemoteRegionRegistries", "(", ")", ")", "{", "Map", "<", "String", ",", "Applications", ">", "remoteRegionVsApps", "=", "new", "ConcurrentHashMap", "<", "String", ",", "Applications", ">", "(", ")", ";", "apps", ".", "shuffleAndIndexInstances", "(", "remoteRegionVsApps", ",", "clientConfig", ",", "instanceRegionChecker", ")", ";", "for", "(", "Applications", "applications", ":", "remoteRegionVsApps", ".", "values", "(", ")", ")", "{", "applications", ".", "shuffleInstances", "(", "clientConfig", ".", "shouldFilterOnlyUpInstances", "(", ")", ")", ";", "}", "this", ".", "remoteRegionVsApps", "=", "remoteRegionVsApps", ";", "}", "else", "{", "apps", ".", "shuffleInstances", "(", "clientConfig", ".", "shouldFilterOnlyUpInstances", "(", ")", ")", ";", "}", "}", "return", "apps", ";", "}", "</s>"]
["<s>", "private", "boolean", "isFetchingRemoteRegionRegistries", "(", ")", "{", "return", "null", "!", "=", "remoteRegionsToFetch", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "onRemoteStatusChanged", "(", "InstanceInfo", ".", "InstanceStatus", "oldStatus", ",", "InstanceInfo", ".", "InstanceStatus", "newStatus", ")", "{", "fireEvent", "(", "new", "StatusChangeEvent", "(", "oldStatus", ",", "newStatus", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "onCacheRefreshed", "(", ")", "{", "fireEvent", "(", "new", "CacheRefreshedEvent", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "fireEvent", "(", "DiscoveryEvent", "event", ")", "{", "if", "(", "eventBus", "!", "=", "null", ")", "{", "eventBus", ".", "publish", "(", "event", ")", ";", "}", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "METRIC_REGISTRATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getLastSuccessfulHeartbeatTimePeriod", "(", ")", "{", "long", "delay", "=", "lastSuccessfulHeartbeatTimestamp", "<", "0", "?", "0", ":", "System", ".", "currentTimeMillis", "(", ")", "-", "lastSuccessfulHeartbeatTimestamp", ";", "heartbeatStalenessMonitor", ".", "update", "(", "delay", ")", ";", "return", "delay", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "METRIC_REGISTRY_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getLastSuccessfulRegistryFetchTimePeriod", "(", ")", "{", "long", "delay", "=", "lastSuccessfulRegistryFetchTimestamp", "<", "0", "?", "0", ":", "System", ".", "currentTimeMillis", "(", ")", "-", "lastSuccessfulRegistryFetchTimestamp", ";", "registryStalenessMonitor", ".", "update", "(", "delay", ")", ";", "return", "delay", ";", "}", "</s>"]
["<s>", "public", "PropertyBasedAzToRegionMapper", "(", "EurekaClientConfig", "clientConfig", ")", "{", "super", "(", "clientConfig", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Set", "<", "String", ">", "getZonesForARegion", "(", "String", "region", ")", "{", "return", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "clientConfig", ".", "getAvailabilityZones", "(", "region", ")", ")", ")", ";", "}", "</s>"]
["<s>", "Applications", "fetchRegistry", "(", ")", ";", "</s>"]
["<s>", "Applications", "fetchRegistry", "(", "String", "[", "]", "includeRemoteRegions", ")", ";", "</s>"]
["<s>", "String", "getRegionForAvailabilityZone", "(", "String", "availabilityZone", ")", ";", "</s>"]
["<s>", "void", "setRegionsToFetch", "(", "String", "[", "]", "regionsToFetch", ")", ";", "</s>"]
["<s>", "void", "refreshMapping", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "get", "(", ")", "{", "return", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "AbstractAzToRegionMapper", "(", "EurekaClientConfig", "clientConfig", ")", "{", "this", ".", "clientConfig", "=", "clientConfig", ";", "populateDefaultAZToRegionMap", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "setRegionsToFetch", "(", "String", "[", "]", "regionsToFetch", ")", "{", "if", "(", "null", "!", "=", "regionsToFetch", ")", "{", "this", ".", "regionsToFetch", "=", "regionsToFetch", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "regionsToFetch", ")", ")", ";", "availabilityZoneVsRegion", ".", "clear", "(", ")", ";", "for", "(", "String", "remoteRegion", ":", "regionsToFetch", ")", "{", "Set", "<", "String", ">", "availabilityZones", "=", "getZonesForARegion", "(", "remoteRegion", ")", ";", "if", "(", "null", "=", "=", "availabilityZones", "|", "|", "(", "availabilityZones", ".", "size", "(", ")", "=", "=", "1", "&", "&", "availabilityZones", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "equals", "(", "DEFAULT_ZONE", ")", ")", "|", "|", "availabilityZones", ".", "isEmpty", "(", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "remoteRegion", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "defaultRegionVsAzMap", ".", "containsKey", "(", "remoteRegion", ")", ")", "{", "Collection", "<", "String", ">", "defaultAvailabilityZones", "=", "defaultRegionVsAzMap", ".", "get", "(", "remoteRegion", ")", ";", "for", "(", "String", "defaultAvailabilityZone", ":", "defaultAvailabilityZones", ")", "{", "availabilityZoneVsRegion", ".", "put", "(", "defaultAvailabilityZone", ",", "remoteRegion", ")", ";", "}", "}", "else", "{", "String", "msg", "=", "\"", "<STR_LIT>", "\"", "+", "remoteRegion", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:.>", "\"", ";", "logger", ".", "error", "(", "msg", ")", ";", "throw", "new", "RuntimeException", "(", "msg", ")", ";", "}", "}", "else", "{", "for", "(", "String", "availabilityZone", ":", "availabilityZones", ")", "{", "availabilityZoneVsRegion", ".", "put", "(", "availabilityZone", ",", "remoteRegion", ")", ";", "}", "}", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "availabilityZoneVsRegion", ")", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "availabilityZoneVsRegion", ".", "clear", "(", ")", ";", "this", ".", "regionsToFetch", "=", "EMPTY_STR_ARRAY", ";", "}", "}", "</s>"]
["<s>", "protected", "abstract", "Set", "<", "String", ">", "getZonesForARegion", "(", "String", "region", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "String", "getRegionForAvailabilityZone", "(", "String", "availabilityZone", ")", "{", "String", "region", "=", "availabilityZoneVsRegion", ".", "get", "(", "availabilityZone", ")", ";", "if", "(", "null", "=", "=", "region", ")", "{", "return", "parseAzToGetRegion", "(", "availabilityZone", ")", ";", "}", "return", "region", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "refreshMapping", "(", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "setRegionsToFetch", "(", "regionsToFetch", ")", ";", "}", "</s>"]
["<s>", "protected", "String", "parseAzToGetRegion", "(", "String", "availabilityZone", ")", "{", "if", "(", "!", "availabilityZone", ".", "isEmpty", "(", ")", ")", "{", "String", "possibleRegion", "=", "availabilityZone", ".", "substring", "(", "0", ",", "availabilityZone", ".", "length", "(", ")", "-", "1", ")", ";", "if", "(", "availabilityZoneVsRegion", ".", "containsValue", "(", "possibleRegion", ")", ")", "{", "return", "possibleRegion", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "void", "populateDefaultAZToRegionMap", "(", ")", "{", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "defaultRegionVsAzMap", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "StringCache", "(", ")", "{", "this", "(", "LENGTH_LIMIT", ")", ";", "}", "</s>"]
["<s>", "public", "StringCache", "(", "int", "lengthLimit", ")", "{", "this", ".", "lengthLimit", "=", "lengthLimit", ";", "}", "</s>"]
["<s>", "public", "String", "cachedValueOf", "(", "final", "String", "str", ")", "{", "if", "(", "str", "!", "=", "null", "&", "&", "(", "lengthLimit", "<", "0", "|", "|", "str", ".", "length", "(", ")", "<", "=", "lengthLimit", ")", ")", "{", "try", "{", "lock", ".", "readLock", "(", ")", ".", "lock", "(", ")", ";", "WeakReference", "<", "String", ">", "ref", "=", "cache", ".", "get", "(", "str", ")", ";", "if", "(", "ref", "!", "=", "null", ")", "{", "return", "ref", ".", "get", "(", ")", ";", "}", "}", "finally", "{", "lock", ".", "readLock", "(", ")", ".", "unlock", "(", ")", ";", "}", "try", "{", "lock", ".", "writeLock", "(", ")", ".", "lock", "(", ")", ";", "WeakReference", "<", "String", ">", "ref", "=", "cache", ".", "get", "(", "str", ")", ";", "if", "(", "ref", "!", "=", "null", ")", "{", "return", "ref", ".", "get", "(", ")", ";", "}", "cache", ".", "put", "(", "str", ",", "new", "WeakReference", "<", ">", "(", "str", ")", ")", ";", "}", "finally", "{", "lock", ".", "writeLock", "(", ")", ".", "unlock", "(", ")", ";", "}", "return", "str", ";", "}", "return", "str", ";", "}", "</s>"]
["<s>", "public", "int", "size", "(", ")", "{", "try", "{", "lock", ".", "readLock", "(", ")", ".", "lock", "(", ")", ";", "return", "cache", ".", "size", "(", ")", ";", "}", "finally", "{", "lock", ".", "readLock", "(", ")", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "String", "intern", "(", "String", "original", ")", "{", "return", "INSTANCE", ".", "cachedValueOf", "(", "original", ")", ";", "}", "</s>"]
["<s>", "public", "ThresholdLevelsMetric", "(", "Object", "owner", ",", "String", "prefix", ",", "long", "[", "]", "levels", ")", "{", "this", ".", "levels", "=", "levels", ";", "this", ".", "gauges", "=", "new", "LongGauge", "[", "levels", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "levels", ".", "length", ";", "i", "+", "+", ")", "{", "String", "name", "=", "prefix", "+", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "levels", "[", "i", "]", ")", ";", "MonitorConfig", "config", "=", "new", "MonitorConfig", ".", "Builder", "(", "name", ")", ".", "withTag", "(", "\"", "<STR_LIT>", "\"", ",", "owner", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ".", "build", "(", ")", ";", "gauges", "[", "i", "]", "=", "new", "LongGauge", "(", "config", ")", ";", "try", "{", "DefaultMonitorRegistry", ".", "getInstance", "(", ")", ".", "register", "(", "gauges", "[", "i", "]", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "name", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "update", "(", "long", "delayMs", ")", "{", "long", "delaySec", "=", "delayMs", "/", "<NUM_LIT:1000>", ";", "long", "matchedIdx", ";", "if", "(", "levels", "[", "0", "]", ">", "delaySec", ")", "{", "matchedIdx", "=", "-", "1", ";", "}", "else", "{", "matchedIdx", "=", "levels", ".", "length", "-", "1", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "levels", ".", "length", "-", "1", ";", "i", "+", "+", ")", "{", "if", "(", "levels", "[", "i", "]", "<", "=", "delaySec", "&", "&", "delaySec", "<", "levels", "[", "i", "+", "1", "]", ")", "{", "matchedIdx", "=", "i", ";", "break", ";", "}", "}", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "levels", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "i", "=", "=", "matchedIdx", ")", "{", "gauges", "[", "i", "]", ".", "set", "(", "<NUM_LIT>", ")", ";", "}", "else", "{", "gauges", "[", "i", "]", ".", "set", "(", "0", "L", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "shutdown", "(", ")", "{", "for", "(", "LongGauge", "gauge", ":", "gauges", ")", "{", "try", "{", "DefaultMonitorRegistry", ".", "getInstance", "(", ")", ".", "unregister", "(", "gauge", ")", ";", "}", "catch", "(", "Throwable", "ignore", ")", "{", "}", "}", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "RateLimiter", "(", ")", "{", "this", "(", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "public", "RateLimiter", "(", "TimeUnit", "averageRateUnit", ")", "{", "switch", "(", "averageRateUnit", ")", "{", "case", "SECONDS", ":", "rateToMsConversion", "=", "<NUM_LIT:1000>", ";", "break", ";", "case", "MINUTES", ":", "rateToMsConversion", "=", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ";", "break", ";", "default", ":", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "averageRateUnit", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "acquire", "(", "int", "burstSize", ",", "long", "averageRate", ")", "{", "return", "acquire", "(", "burstSize", ",", "averageRate", ",", "System", ".", "currentTimeMillis", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "acquire", "(", "int", "burstSize", ",", "long", "averageRate", ",", "long", "currentTimeMillis", ")", "{", "if", "(", "burstSize", "<", "=", "0", "|", "|", "averageRate", "<", "=", "0", ")", "{", "return", "true", ";", "}", "refillToken", "(", "burstSize", ",", "averageRate", ",", "currentTimeMillis", ")", ";", "return", "consumeToken", "(", "burstSize", ")", ";", "}", "</s>"]
["<s>", "private", "void", "refillToken", "(", "int", "burstSize", ",", "long", "averageRate", ",", "long", "currentTimeMillis", ")", "{", "long", "refillTime", "=", "lastRefillTime", ".", "get", "(", ")", ";", "long", "timeDelta", "=", "currentTimeMillis", "-", "refillTime", ";", "long", "newTokens", "=", "timeDelta", "*", "averageRate", "/", "rateToMsConversion", ";", "if", "(", "newTokens", ">", "0", ")", "{", "long", "newRefillTime", "=", "refillTime", "=", "=", "0", "?", "currentTimeMillis", ":", "refillTime", "+", "newTokens", "*", "rateToMsConversion", "/", "averageRate", ";", "if", "(", "lastRefillTime", ".", "compareAndSet", "(", "refillTime", ",", "newRefillTime", ")", ")", "{", "while", "(", "true", ")", "{", "int", "currentLevel", "=", "consumedTokens", ".", "get", "(", ")", ";", "int", "adjustedLevel", "=", "Math", ".", "min", "(", "currentLevel", ",", "burstSize", ")", ";", "int", "newLevel", "=", "(", "int", ")", "Math", ".", "max", "(", "0", ",", "adjustedLevel", "-", "newTokens", ")", ";", "if", "(", "consumedTokens", ".", "compareAndSet", "(", "currentLevel", ",", "newLevel", ")", ")", "{", "return", ";", "}", "}", "}", "}", "}", "</s>"]
["<s>", "private", "boolean", "consumeToken", "(", "int", "burstSize", ")", "{", "while", "(", "true", ")", "{", "int", "currentLevel", "=", "consumedTokens", ".", "get", "(", ")", ";", "if", "(", "currentLevel", ">", "=", "burstSize", ")", "{", "return", "false", ";", "}", "if", "(", "consumedTokens", ".", "compareAndSet", "(", "currentLevel", ",", "currentLevel", "+", "1", ")", ")", "{", "return", "true", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "reset", "(", ")", "{", "consumedTokens", ".", "set", "(", "0", ")", ";", "lastRefillTime", ".", "set", "(", "0", ")", ";", "}", "</s>"]
["<s>", "T", "apply", "(", "T", "value", ")", ";", "</s>"]
["<s>", "public", "static", "<", "T", ">", "Transformer", "<", "T", ">", "identity", "(", ")", "{", "return", "(", "Transformer", "<", "T", ">", ")", "IDENTITY_TRANSFORMER", ";", "}", "</s>"]
["<s>", "public", "static", "Transformer", "<", "InstanceInfo", ">", "actionTypeSetter", "(", "ActionType", "actionType", ")", "{", "switch", "(", "actionType", ")", "{", "case", "ADDED", ":", "return", "ADD_ACTION_SETTER_TRANSFORMER", ";", "case", "MODIFIED", ":", "return", "MODIFIED_ACTION_SETTER_TRANSFORMER", ";", "case", "DELETED", ":", "return", "DELETED_ACTION_SETTER_TRANSFORMER", ";", "}", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "actionType", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "apply", "(", "Object", "value", ")", "{", "return", "value", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "apply", "(", "InstanceInfo", "instance", ")", "{", "InstanceInfo", "copy", "=", "new", "InstanceInfo", "(", "instance", ")", ";", "copy", ".", "setActionType", "(", "ActionType", ".", "ADDED", ")", ";", "return", "copy", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "apply", "(", "InstanceInfo", "instance", ")", "{", "InstanceInfo", "copy", "=", "new", "InstanceInfo", "(", "instance", ")", ";", "copy", ".", "setActionType", "(", "ActionType", ".", "MODIFIED", ")", ";", "return", "copy", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "apply", "(", "InstanceInfo", "instance", ")", "{", "InstanceInfo", "copy", "=", "new", "InstanceInfo", "(", "instance", ")", ";", "copy", ".", "setActionType", "(", "ActionType", ".", "DELETED", ")", ";", "return", "copy", ";", "}", "</s>"]
["<s>", "private", "EurekaEntityFunctions", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "Set", "<", "String", ">", "selectApplicationNames", "(", "Applications", "applications", ")", "{", "Set", "<", "String", ">", "result", "=", "new", "HashSet", "<", ">", "(", ")", ";", "for", "(", "Application", "app", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "result", ".", "add", "(", "app", ".", "getName", "(", ")", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "Map", "<", "String", ",", "InstanceInfo", ">", "selectInstancesMappedById", "(", "Application", "application", ")", "{", "Map", "<", "String", ",", "InstanceInfo", ">", "result", "=", "new", "HashMap", "<", ">", "(", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "application", ".", "getInstances", "(", ")", ")", "{", "result", ".", "put", "(", "instance", ".", "getId", "(", ")", ",", "instance", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfo", "selectInstance", "(", "Applications", "applications", ",", "String", "id", ")", "{", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "application", ".", "getInstances", "(", ")", ")", "{", "if", "(", "instance", ".", "getId", "(", ")", ".", "equals", "(", "id", ")", ")", "{", "return", "instance", ";", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfo", "selectInstance", "(", "Applications", "applications", ",", "String", "appName", ",", "String", "id", ")", "{", "Application", "application", "=", "applications", ".", "getRegisteredApplications", "(", "appName", ")", ";", "if", "(", "application", "!", "=", "null", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "application", ".", "getInstances", "(", ")", ")", "{", "if", "(", "instance", ".", "getId", "(", ")", ".", "equals", "(", "id", ")", ")", "{", "return", "instance", ";", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "static", "Collection", "<", "InstanceInfo", ">", "selectAll", "(", "Applications", "applications", ")", "{", "List", "<", "InstanceInfo", ">", "all", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", "Application", "a", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "all", ".", "addAll", "(", "a", ".", "getInstances", "(", ")", ")", ";", "}", "return", "all", ";", "}", "</s>"]
["<s>", "public", "static", "Map", "<", "String", ",", "Application", ">", "toApplicationMap", "(", "List", "<", "InstanceInfo", ">", "instances", ")", "{", "Map", "<", "String", ",", "Application", ">", "applicationMap", "=", "new", "HashMap", "<", "String", ",", "Application", ">", "(", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "instances", ")", "{", "String", "appName", "=", "instance", ".", "getAppName", "(", ")", ";", "Application", "application", "=", "applicationMap", ".", "get", "(", "appName", ")", ";", "if", "(", "application", "=", "=", "null", ")", "{", "applicationMap", ".", "put", "(", "appName", ",", "application", "=", "new", "Application", "(", "appName", ")", ")", ";", "}", "application", ".", "addInstance", "(", "instance", ")", ";", "}", "return", "applicationMap", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "toApplications", "(", "Map", "<", "String", ",", "Application", ">", "applicationMap", ")", "{", "Applications", "applications", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "applicationMap", ".", "values", "(", ")", ")", "{", "applications", ".", "addApplication", "(", "application", ")", ";", "}", "return", "updateMeta", "(", "applications", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "toApplications", "(", "InstanceInfo", ".", ".", ".", "instances", ")", "{", "return", "toApplications", "(", "Arrays", ".", "asList", "(", "instances", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "toApplications", "(", "List", "<", "InstanceInfo", ">", "instances", ")", "{", "Applications", "result", "=", "new", "Applications", "(", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "instances", ")", "{", "Application", "app", "=", "result", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "result", ".", "addApplication", "(", "app", ")", ";", "}", "app", ".", "addInstance", "(", "instance", ")", ";", "}", "return", "updateMeta", "(", "result", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "copyApplications", "(", "Applications", "source", ")", "{", "Applications", "result", "=", "new", "Applications", "(", ")", ";", "copyApplications", "(", "source", ",", "result", ")", ";", "return", "updateMeta", "(", "result", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "copyApplications", "(", "Applications", "source", ",", "Applications", "result", ")", "{", "if", "(", "source", "!", "=", "null", ")", "{", "for", "(", "Application", "app", ":", "source", ".", "getRegisteredApplications", "(", ")", ")", "{", "result", ".", "addApplication", "(", "new", "Application", "(", "app", ".", "getName", "(", ")", ",", "app", ".", "getInstances", "(", ")", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "static", "Application", "copyApplication", "(", "Application", "application", ")", "{", "Application", "copy", "=", "new", "Application", "(", "application", ".", "getName", "(", ")", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "application", ".", "getInstances", "(", ")", ")", "{", "copy", ".", "addInstance", "(", "instance", ")", ";", "}", "return", "copy", ";", "}", "</s>"]
["<s>", "public", "static", "void", "copyApplication", "(", "Application", "source", ",", "Application", "result", ")", "{", "if", "(", "source", "!", "=", "null", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "source", ".", "getInstances", "(", ")", ")", "{", "result", ".", "addInstance", "(", "instance", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "static", "void", "copyInstances", "(", "Collection", "<", "InstanceInfo", ">", "instances", ",", "Applications", "result", ")", "{", "if", "(", "instances", "!", "=", "null", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "instances", ")", "{", "Application", "app", "=", "result", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "result", ".", "addApplication", "(", "app", ")", ";", "}", "app", ".", "addInstance", "(", "instance", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "static", "Collection", "<", "InstanceInfo", ">", "copyInstances", "(", "Collection", "<", "InstanceInfo", ">", "instances", ",", "ActionType", "actionType", ")", "{", "List", "<", "InstanceInfo", ">", "result", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "instances", ")", "{", "result", ".", "add", "(", "copyInstance", "(", "instance", ",", "actionType", ")", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfo", "copyInstance", "(", "InstanceInfo", "original", ",", "ActionType", "actionType", ")", "{", "InstanceInfo", "copy", "=", "new", "InstanceInfo", "(", "original", ")", ";", "copy", ".", "setActionType", "(", "actionType", ")", ";", "return", "copy", ";", "}", "</s>"]
["<s>", "public", "static", "void", "deepCopyApplication", "(", "Application", "source", ",", "Application", "result", ",", "Transformer", "<", "InstanceInfo", ">", "transformer", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "source", ".", "getInstances", "(", ")", ")", "{", "InstanceInfo", "copy", "=", "transformer", ".", "apply", "(", "instance", ")", ";", "if", "(", "copy", "=", "=", "instance", ")", "{", "copy", "=", "new", "InstanceInfo", "(", "instance", ")", ";", "}", "result", ".", "addInstance", "(", "copy", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Application", "deepCopyApplication", "(", "Application", "source", ")", "{", "Application", "result", "=", "new", "Application", "(", "source", ".", "getName", "(", ")", ")", ";", "deepCopyApplication", "(", "source", ",", "result", ",", "EurekaEntityTransformers", ".", "<", "InstanceInfo", ">", "identity", "(", ")", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "deepCopyApplications", "(", "Applications", "source", ")", "{", "Applications", "result", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "source", ".", "getRegisteredApplications", "(", ")", ")", "{", "result", ".", "addApplication", "(", "deepCopyApplication", "(", "application", ")", ")", ";", "}", "return", "updateMeta", "(", "result", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "mergeApplications", "(", "Applications", "first", ",", "Applications", "second", ")", "{", "Set", "<", "String", ">", "firstNames", "=", "selectApplicationNames", "(", "first", ")", ";", "Set", "<", "String", ">", "secondNames", "=", "selectApplicationNames", "(", "second", ")", ";", "Set", "<", "String", ">", "allNames", "=", "new", "HashSet", "<", "String", ">", "(", "firstNames", ")", ";", "allNames", ".", "addAll", "(", "secondNames", ")", ";", "Applications", "merged", "=", "new", "Applications", "(", ")", ";", "for", "(", "String", "appName", ":", "allNames", ")", "{", "if", "(", "firstNames", ".", "contains", "(", "appName", ")", ")", "{", "if", "(", "secondNames", ".", "contains", "(", "appName", ")", ")", "{", "merged", ".", "addApplication", "(", "mergeApplication", "(", "first", ".", "getRegisteredApplications", "(", "appName", ")", ",", "second", ".", "getRegisteredApplications", "(", "appName", ")", ")", ")", ";", "}", "else", "{", "merged", ".", "addApplication", "(", "copyApplication", "(", "first", ".", "getRegisteredApplications", "(", "appName", ")", ")", ")", ";", "}", "}", "else", "{", "merged", ".", "addApplication", "(", "copyApplication", "(", "second", ".", "getRegisteredApplications", "(", "appName", ")", ")", ")", ";", "}", "}", "return", "updateMeta", "(", "merged", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Application", "mergeApplication", "(", "Application", "first", ",", "Application", "second", ")", "{", "if", "(", "!", "first", ".", "getName", "(", ")", ".", "equals", "(", "second", ".", "getName", "(", ")", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Application", "merged", "=", "copyApplication", "(", "first", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "second", ".", "getInstances", "(", ")", ")", "{", "switch", "(", "instance", ".", "getActionType", "(", ")", ")", "{", "case", "ADDED", ":", "case", "MODIFIED", ":", "merged", ".", "addInstance", "(", "instance", ")", ";", "break", ";", "case", "DELETED", ":", "merged", ".", "removeInstance", "(", "instance", ")", ";", "}", "}", "return", "merged", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "updateMeta", "(", "Applications", "applications", ")", "{", "applications", ".", "setVersion", "(", "<NUM_LIT>", ")", ";", "applications", ".", "setAppsHashCode", "(", "applications", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "applications", ";", "}", "</s>"]
["<s>", "public", "static", "int", "countInstances", "(", "Applications", "applications", ")", "{", "int", "count", "=", "0", ";", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "count", "+", "=", "application", ".", "getInstances", "(", ")", ".", "size", "(", ")", ";", "}", "return", "count", ";", "}", "</s>"]
["<s>", "public", "static", "Comparator", "<", "InstanceInfo", ">", "comparatorByAppNameAndId", "(", ")", "{", "return", "INSTANCE_APP_ID_COMPARATOR", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "compare", "(", "InstanceInfo", "o1", ",", "InstanceInfo", "o2", ")", "{", "int", "ac", "=", "compareStrings", "(", "o1", ".", "getAppName", "(", ")", ",", "o2", ".", "getAppName", "(", ")", ")", ";", "if", "(", "ac", "!", "=", "0", ")", "{", "return", "ac", ";", "}", "return", "compareStrings", "(", "o1", ".", "getId", "(", ")", ",", "o2", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "int", "compareStrings", "(", "String", "s1", ",", "String", "s2", ")", "{", "if", "(", "s1", "=", "=", "null", ")", "{", "if", "(", "s2", "!", "=", "null", ")", "{", "return", "-", "1", ";", "}", "}", "if", "(", "s2", "=", "=", "null", ")", "{", "return", "1", ";", "}", "return", "s1", ".", "compareTo", "(", "s2", ")", ";", "}", "</s>"]
["<s>", "DiscoveryBuildInfo", "(", "Class", "<", "?", ">", "clazz", ")", "{", "Manifest", "resolvedManifest", "=", "null", ";", "try", "{", "String", "jarUrl", "=", "resolveJarUrl", "(", "clazz", ")", ";", "if", "(", "jarUrl", "!", "=", "null", ")", "{", "resolvedManifest", "=", "loadManifest", "(", "jarUrl", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "this", ".", "manifest", "=", "resolvedManifest", ";", "}", "</s>"]
["<s>", "String", "getBuildVersion", "(", ")", "{", "return", "getManifestAttribute", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "String", "getManifestAttribute", "(", "String", "name", ",", "String", "defaultValue", ")", "{", "if", "(", "manifest", "=", "=", "null", ")", "{", "return", "defaultValue", ";", "}", "Name", "attrName", "=", "new", "Name", "(", "name", ")", ";", "Object", "value", "=", "manifest", ".", "getMainAttributes", "(", ")", ".", "get", "(", "attrName", ")", ";", "return", "value", "=", "=", "null", "?", "defaultValue", ":", "value", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "buildVersion", "(", ")", "{", "return", "INSTANCE", ".", "getBuildVersion", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Manifest", "loadManifest", "(", "String", "jarUrl", ")", "throws", "Exception", "{", "InputStream", "is", "=", "new", "URL", "(", "jarUrl", "+", "\"", "<STR_LIT>", "\"", ")", ".", "openStream", "(", ")", ";", "try", "{", "return", "new", "Manifest", "(", "is", ")", ";", "}", "finally", "{", "is", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "String", "resolveJarUrl", "(", "Class", "<", "?", ">", "clazz", ")", "{", "URL", "location", "=", "clazz", ".", "getResource", "(", "<CHAR_LIT:/>", "+", "clazz", ".", "getName", "(", ")", ".", "replace", "(", "<CHAR_LIT:.>", ",", "<CHAR_LIT:/>", ")", "+", "\"", "<STR_LIT:.class>", "\"", ")", ";", "if", "(", "location", "!", "=", "null", ")", "{", "Matcher", "matcher", "=", "Pattern", ".", "compile", "(", "\"", "<STR_LIT>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ".", "matcher", "(", "location", ".", "toString", "(", ")", ")", ";", "if", "(", "matcher", ".", "matches", "(", ")", ")", "{", "return", "matcher", ".", "group", "(", "1", ")", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "EurekaEntityComparators", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "DataCenterInfo", "first", ",", "DataCenterInfo", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getClass", "(", ")", "!", "=", "second", ".", "getClass", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", "instanceof", "AmazonInfo", ")", "{", "return", "equal", "(", "(", "AmazonInfo", ")", "first", ",", "(", "AmazonInfo", ")", "second", ")", ";", "}", "return", "first", ".", "getName", "(", ")", "=", "=", "second", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "AmazonInfo", "first", ",", "AmazonInfo", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "return", "first", ".", "getMetadata", "(", ")", ".", "equals", "(", "second", ".", "getMetadata", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "subsetOf", "(", "DataCenterInfo", "first", ",", "DataCenterInfo", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getClass", "(", ")", "!", "=", "second", ".", "getClass", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", "instanceof", "AmazonInfo", ")", "{", "return", "subsetOf", "(", "(", "AmazonInfo", ")", "first", ",", "(", "AmazonInfo", ")", "second", ")", ";", "}", "return", "first", ".", "getName", "(", ")", "=", "=", "second", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "subsetOf", "(", "AmazonInfo", "first", ",", "AmazonInfo", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "return", "first", ".", "getMetadata", "(", ")", ".", "entrySet", "(", ")", ".", "containsAll", "(", "second", ".", "getMetadata", "(", ")", ".", "entrySet", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "LeaseInfo", "first", ",", "LeaseInfo", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getDurationInSecs", "(", ")", "!", "=", "second", ".", "getDurationInSecs", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getEvictionTimestamp", "(", ")", "!", "=", "second", ".", "getEvictionTimestamp", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getRegistrationTimestamp", "(", ")", "!", "=", "second", ".", "getRegistrationTimestamp", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getRenewalIntervalInSecs", "(", ")", "!", "=", "second", ".", "getRenewalIntervalInSecs", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getRenewalTimestamp", "(", ")", "!", "=", "second", ".", "getRenewalTimestamp", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getServiceUpTimestamp", "(", ")", "!", "=", "second", ".", "getServiceUpTimestamp", "(", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ")", "{", "return", "equal", "(", "first", ",", "second", ",", "new", "ResolvedIdEqualFunc", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ",", "EqualFunc", "<", "InstanceInfo", ">", "idEqualFunc", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getCountryId", "(", ")", "!", "=", "second", ".", "getCountryId", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getPort", "(", ")", "!", "=", "second", ".", "getPort", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getSecurePort", "(", ")", "!", "=", "second", ".", "getSecurePort", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getActionType", "(", ")", "!", "=", "second", ".", "getActionType", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getAppGroupName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getAppGroupName", "(", ")", ".", "equals", "(", "second", ".", "getAppGroupName", "(", ")", ")", ":", "second", ".", "getAppGroupName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "!", "idEqualFunc", ".", "equals", "(", "first", ",", "second", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getSID", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getSID", "(", ")", ".", "equals", "(", "second", ".", "getSID", "(", ")", ")", ":", "second", ".", "getSID", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getAppName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getAppName", "(", ")", ".", "equals", "(", "second", ".", "getAppName", "(", ")", ")", ":", "second", ".", "getAppName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getASGName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getASGName", "(", ")", ".", "equals", "(", "second", ".", "getASGName", "(", ")", ")", ":", "second", ".", "getASGName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "!", "equal", "(", "first", ".", "getDataCenterInfo", "(", ")", ",", "second", ".", "getDataCenterInfo", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getHealthCheckUrls", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getHealthCheckUrls", "(", ")", ".", "equals", "(", "second", ".", "getHealthCheckUrls", "(", ")", ")", ":", "second", ".", "getHealthCheckUrls", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getHomePageUrl", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getHomePageUrl", "(", ")", ".", "equals", "(", "second", ".", "getHomePageUrl", "(", ")", ")", ":", "second", ".", "getHomePageUrl", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getHostName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getHostName", "(", ")", ".", "equals", "(", "second", ".", "getHostName", "(", ")", ")", ":", "second", ".", "getHostName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getIPAddr", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getIPAddr", "(", ")", ".", "equals", "(", "second", ".", "getIPAddr", "(", ")", ")", ":", "second", ".", "getIPAddr", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "!", "equal", "(", "first", ".", "getLeaseInfo", "(", ")", ",", "second", ".", "getLeaseInfo", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "equal", "(", "first", ".", "getMetadata", "(", ")", ",", "second", ".", "getMetadata", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getHealthCheckUrls", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getHealthCheckUrls", "(", ")", ".", "equals", "(", "second", ".", "getHealthCheckUrls", "(", ")", ")", ":", "second", ".", "getHealthCheckUrls", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getVIPAddress", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getVIPAddress", "(", ")", ".", "equals", "(", "second", ".", "getVIPAddress", "(", ")", ")", ":", "second", ".", "getVIPAddress", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getSecureVipAddress", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getSecureVipAddress", "(", ")", ".", "equals", "(", "second", ".", "getSecureVipAddress", "(", ")", ")", ":", "second", ".", "getSecureVipAddress", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getStatus", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getStatus", "(", ")", ".", "equals", "(", "second", ".", "getStatus", "(", ")", ")", ":", "second", ".", "getStatus", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getStatusPageUrl", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getStatusPageUrl", "(", ")", ".", "equals", "(", "second", ".", "getStatusPageUrl", "(", ")", ")", ":", "second", ".", "getStatusPageUrl", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getLastDirtyTimestamp", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getLastDirtyTimestamp", "(", ")", ".", "equals", "(", "second", ".", "getLastDirtyTimestamp", "(", ")", ")", ":", "second", ".", "getLastDirtyTimestamp", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getLastUpdatedTimestamp", "(", ")", "!", "=", "second", ".", "getLastUpdatedTimestamp", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "isCoordinatingDiscoveryServer", "(", ")", "!", "=", "null", "?", "!", "first", ".", "isCoordinatingDiscoveryServer", "(", ")", ".", "equals", "(", "second", ".", "isCoordinatingDiscoveryServer", "(", ")", ")", ":", "second", ".", "isCoordinatingDiscoveryServer", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "idEqual", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ")", "{", "return", "first", ".", "getId", "(", ")", ".", "equals", "(", "second", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equalMini", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getPort", "(", ")", "!", "=", "second", ".", "getPort", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getSecurePort", "(", ")", "!", "=", "second", ".", "getSecurePort", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getActionType", "(", ")", "!", "=", "second", ".", "getActionType", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getInstanceId", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getInstanceId", "(", ")", ".", "equals", "(", "second", ".", "getInstanceId", "(", ")", ")", ":", "second", ".", "getInstanceId", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getAppName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getAppName", "(", ")", ".", "equals", "(", "second", ".", "getAppName", "(", ")", ")", ":", "second", ".", "getAppName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getASGName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getASGName", "(", ")", ".", "equals", "(", "second", ".", "getASGName", "(", ")", ")", ":", "second", ".", "getASGName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "!", "subsetOf", "(", "first", ".", "getDataCenterInfo", "(", ")", ",", "second", ".", "getDataCenterInfo", "(", ")", ")", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getHostName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getHostName", "(", ")", ".", "equals", "(", "second", ".", "getHostName", "(", ")", ")", ":", "second", ".", "getHostName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getIPAddr", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getIPAddr", "(", ")", ".", "equals", "(", "second", ".", "getIPAddr", "(", ")", ")", ":", "second", ".", "getIPAddr", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getVIPAddress", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getVIPAddress", "(", ")", ".", "equals", "(", "second", ".", "getVIPAddress", "(", ")", ")", ":", "second", ".", "getVIPAddress", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getSecureVipAddress", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getSecureVipAddress", "(", ")", ".", "equals", "(", "second", ".", "getSecureVipAddress", "(", ")", ")", ":", "second", ".", "getSecureVipAddress", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getStatus", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getStatus", "(", ")", ".", "equals", "(", "second", ".", "getStatus", "(", ")", ")", ":", "second", ".", "getStatus", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getLastUpdatedTimestamp", "(", ")", "!", "=", "second", ".", "getLastUpdatedTimestamp", "(", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "Application", "first", ",", "Application", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "first", ".", "getName", "(", ")", "!", "=", "null", "?", "!", "first", ".", "getName", "(", ")", ".", "equals", "(", "second", ".", "getName", "(", ")", ")", ":", "second", ".", "getName", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "List", "<", "InstanceInfo", ">", "firstInstanceInfos", "=", "first", ".", "getInstances", "(", ")", ";", "List", "<", "InstanceInfo", ">", "secondInstanceInfos", "=", "second", ".", "getInstances", "(", ")", ";", "if", "(", "firstInstanceInfos", "=", "=", "null", "&", "&", "secondInstanceInfos", "=", "=", "null", ")", "{", "return", "true", ";", "}", "if", "(", "firstInstanceInfos", "=", "=", "null", "|", "|", "secondInstanceInfos", "=", "=", "null", "|", "|", "firstInstanceInfos", ".", "size", "(", ")", "!", "=", "secondInstanceInfos", ".", "size", "(", ")", ")", "{", "return", "false", ";", "}", "for", "(", "InstanceInfo", "firstInstanceInfo", ":", "firstInstanceInfos", ")", "{", "InstanceInfo", "secondInstanceInfo", "=", "second", ".", "getByInstanceId", "(", "firstInstanceInfo", ".", "getId", "(", ")", ")", ";", "if", "(", "!", "equal", "(", "firstInstanceInfo", ",", "secondInstanceInfo", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "equal", "(", "Applications", "first", ",", "Applications", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", ")", "{", "return", "false", ";", "}", "List", "<", "Application", ">", "firstApps", "=", "first", ".", "getRegisteredApplications", "(", ")", ";", "List", "<", "Application", ">", "secondApps", "=", "second", ".", "getRegisteredApplications", "(", ")", ";", "if", "(", "firstApps", "=", "=", "null", "&", "&", "secondApps", "=", "=", "null", ")", "{", "return", "true", ";", "}", "if", "(", "firstApps", "=", "=", "null", "|", "|", "secondApps", "=", "=", "null", "|", "|", "firstApps", ".", "size", "(", ")", "!", "=", "secondApps", ".", "size", "(", ")", ")", "{", "return", "false", ";", "}", "for", "(", "Application", "firstApp", ":", "firstApps", ")", "{", "Application", "secondApp", "=", "second", ".", "getRegisteredApplications", "(", "firstApp", ".", "getName", "(", ")", ")", ";", "if", "(", "!", "equal", "(", "firstApp", ",", "secondApp", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "equal", "(", "Map", "<", "String", ",", "String", ">", "first", ",", "Map", "<", "String", ",", "String", ">", "second", ")", "{", "if", "(", "first", "=", "=", "second", ")", "{", "return", "true", ";", "}", "if", "(", "first", "=", "=", "null", "|", "|", "first", "=", "=", "null", "&", "&", "second", "!", "=", "null", "|", "|", "first", ".", "size", "(", ")", "!", "=", "second", ".", "size", "(", ")", ")", "{", "return", "false", ";", "}", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "entry", ":", "first", ".", "entrySet", "(", ")", ")", "{", "if", "(", "!", "second", ".", "containsKey", "(", "entry", ".", "getKey", "(", ")", ")", ")", "{", "return", "false", ";", "}", "String", "firstValue", "=", "entry", ".", "getValue", "(", ")", ";", "String", "secondValue", "=", "second", ".", "get", "(", "entry", ".", "getKey", "(", ")", ")", ";", "if", "(", "!", "firstValue", ".", "equals", "(", "secondValue", ")", ")", "{", "return", "false", ";", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "boolean", "equals", "(", "T", "first", ",", "T", "second", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ")", "{", "return", "first", ".", "getInstanceId", "(", ")", "!", "=", "null", "?", "first", ".", "getInstanceId", "(", ")", ".", "equals", "(", "second", ".", "getInstanceId", "(", ")", ")", ":", "second", ".", "getInstanceId", "(", ")", "=", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ")", "{", "String", "firstId", "=", "(", "first", ".", "getInstanceId", "(", ")", "=", "=", "null", "|", "|", "first", ".", "getInstanceId", "(", ")", ".", "isEmpty", "(", ")", ")", "?", "null", ":", "first", ".", "getInstanceId", "(", ")", ";", "String", "secondId", "=", "(", "second", ".", "getInstanceId", "(", ")", "=", "=", "null", "|", "|", "second", ".", "getInstanceId", "(", ")", ".", "isEmpty", "(", ")", ")", "?", "null", ":", "second", ".", "getInstanceId", "(", ")", ";", "return", "firstId", "!", "=", "null", "?", "firstId", ".", "equals", "(", "secondId", ")", ":", "secondId", "=", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "InstanceInfo", "first", ",", "InstanceInfo", "second", ")", "{", "return", "first", ".", "getId", "(", ")", "!", "=", "null", "?", "first", ".", "getId", "(", ")", ".", "equals", "(", "second", ".", "getId", "(", ")", ")", ":", "second", ".", "getId", "(", ")", "=", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "EurekaClientConfig", "get", "(", ")", "{", "if", "(", "config", "=", "=", "null", ")", "{", "config", "=", "(", "namespace", "=", "=", "null", ")", "?", "new", "DefaultEurekaClientConfig", "(", ")", ":", "new", "DefaultEurekaClientConfig", "(", "namespace", ")", ";", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setEurekaClientConfig", "(", "config", ")", ";", "}", "return", "config", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "ApplicationInfoManager", ".", "class", ")", ".", "asEagerSingleton", "(", ")", ";", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "toProvider", "(", "CloudInstanceConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaClientConfig", ".", "class", ")", ".", "toProvider", "(", "DefaultEurekaClientConfigProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "InstanceInfo", ".", "class", ")", ".", "toProvider", "(", "EurekaConfigBasedInstanceInfoProvider", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "bind", "(", "EurekaClient", ".", "class", ")", ".", "to", "(", "DiscoveryClient", ".", "class", ")", ".", "in", "(", "Scopes", ".", "SINGLETON", ")", ";", "}", "</s>"]
["<s>", "public", "DiscoveryJerseyProvider", "(", ")", "{", "this", "(", "null", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "DiscoveryJerseyProvider", "(", "EncoderWrapper", "encoder", ",", "DecoderWrapper", "decoder", ")", "{", "this", ".", "encoder", "=", "encoder", "=", "=", "null", "?", "CodecWrappers", ".", "getEncoder", "(", "LegacyJacksonJson", ".", "class", ")", ":", "encoder", ";", "this", ".", "decoder", "=", "decoder", "=", "=", "null", "?", "CodecWrappers", ".", "getDecoder", "(", "LegacyJacksonJson", ".", "class", ")", ":", "decoder", ";", "if", "(", "encoder", "instanceof", "CodecWrappers", ".", "JacksonJsonMini", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", "+", "encoder", ".", "codecName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "LOGGER", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ".", "encoder", ".", "codecName", "(", ")", ")", ";", "LOGGER", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ".", "decoder", ".", "codecName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "EncoderWrapper", "getEncoder", "(", ")", "{", "return", "encoder", ";", "}", "</s>"]
["<s>", "public", "DecoderWrapper", "getDecoder", "(", ")", "{", "return", "decoder", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isReadable", "(", "Class", "serializableClass", ",", "Type", "type", ",", "Annotation", "[", "]", "annotations", ",", "MediaType", "mediaType", ")", "{", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "mediaType", ".", "getType", "(", ")", ")", "&", "&", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "mediaType", ".", "getSubtype", "(", ")", ")", "|", "|", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "mediaType", ".", "getSubtype", "(", ")", ")", ")", ")", "{", "return", "checkForAnnotation", "(", "serializableClass", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "readFrom", "(", "Class", "serializableClass", ",", "Type", "type", ",", "Annotation", "[", "]", "annotations", ",", "MediaType", "mediaType", ",", "MultivaluedMap", "headers", ",", "InputStream", "inputStream", ")", "throws", "IOException", "{", "if", "(", "decoder", ".", "support", "(", "mediaType", ")", ")", "{", "try", "{", "return", "decoder", ".", "decode", "(", "inputStream", ",", "serializableClass", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "if", "(", "e", "instanceof", "Error", ")", "{", "closeInputOnError", "(", "inputStream", ")", ";", "throw", "new", "WebApplicationException", "(", "createErrorReply", "(", "<NUM_LIT>", ",", "e", ",", "mediaType", ")", ")", ";", "}", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "WebApplicationException", "(", "createErrorReply", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "mediaType", ")", ")", ";", "}", "}", "ISerializer", "serializer", "=", "getSerializer", "(", "serializableClass", ")", ";", "if", "(", "null", "!", "=", "serializer", ")", "{", "try", "{", "return", "serializer", ".", "read", "(", "inputStream", ",", "serializableClass", ",", "mediaType", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "if", "(", "e", "instanceof", "Error", ")", "{", "closeInputOnError", "(", "inputStream", ")", ";", "throw", "new", "WebApplicationException", "(", "createErrorReply", "(", "<NUM_LIT>", ",", "e", ",", "mediaType", ")", ")", ";", "}", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "WebApplicationException", "(", "createErrorReply", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "mediaType", ")", ")", ";", "}", "}", "else", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "serializableClass", ")", ";", "throw", "new", "WebApplicationException", "(", "createErrorReply", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", "+", "serializableClass", ",", "mediaType", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getSize", "(", "Object", "serializableObject", ",", "Class", "serializableClass", ",", "Type", "type", ",", "Annotation", "[", "]", "annotations", ",", "MediaType", "mediaType", ")", "{", "return", "-", "1", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isWriteable", "(", "Class", "serializableClass", ",", "Type", "type", ",", "Annotation", "[", "]", "annotations", ",", "MediaType", "mediaType", ")", "{", "return", "checkForAnnotation", "(", "serializableClass", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeTo", "(", "Object", "serializableObject", ",", "Class", "serializableClass", ",", "Type", "type", ",", "Annotation", "[", "]", "annotations", ",", "MediaType", "mediaType", ",", "MultivaluedMap", "headers", ",", "OutputStream", "outputStream", ")", "throws", "IOException", ",", "WebApplicationException", "{", "if", "(", "encoder", ".", "support", "(", "mediaType", ")", ")", "{", "encoder", ".", "encode", "(", "serializableObject", ",", "outputStream", ")", ";", "}", "else", "{", "ISerializer", "serializer", "=", "getSerializer", "(", "serializableClass", ")", ";", "if", "(", "null", "!", "=", "serializer", ")", "{", "serializer", ".", "write", "(", "serializableObject", ",", "outputStream", ",", "mediaType", ")", ";", "}", "else", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "serializableClass", "+", "\"", "<STR_LIT>", "\"", ")", ";", "throw", "new", "IOException", "(", "\"", "<STR_LIT>", "\"", "+", "serializableClass", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "boolean", "checkForAnnotation", "(", "Class", "serializableClass", ")", "{", "try", "{", "Annotation", "annotation", "=", "serializableClass", ".", "getAnnotation", "(", "Serializer", ".", "class", ")", ";", "if", "(", "annotation", "!", "=", "null", ")", "{", "return", "true", ";", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "LOGGER", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Nullable", "private", "static", "ISerializer", "getSerializer", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "serializableClass", ")", "{", "ISerializer", "converter", "=", "null", ";", "Annotation", "annotation", "=", "serializableClass", ".", "getAnnotation", "(", "Serializer", ".", "class", ")", ";", "if", "(", "annotation", "!", "=", "null", ")", "{", "Serializer", "payloadConverter", "=", "(", "Serializer", ")", "annotation", ";", "String", "serializer", "=", "payloadConverter", ".", "value", "(", ")", ";", "if", "(", "serializer", "!", "=", "null", ")", "{", "converter", "=", "serializers", ".", "get", "(", "serializableClass", ")", ";", "if", "(", "converter", "=", "=", "null", ")", "{", "try", "{", "converter", "=", "(", "ISerializer", ")", "Class", ".", "forName", "(", "serializer", ")", ".", "newInstance", "(", ")", ";", "}", "catch", "(", "InstantiationException", "e", ")", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "if", "(", "null", "!", "=", "converter", ")", "{", "serializers", ".", "put", "(", "serializableClass", ",", "converter", ")", ";", "}", "}", "}", "}", "return", "converter", ";", "}", "</s>"]
["<s>", "private", "static", "Response", "createErrorReply", "(", "int", "status", ",", "Throwable", "cause", ",", "MediaType", "mediaType", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "cause", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "if", "(", "cause", ".", "getMessage", "(", ")", "!", "=", "null", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "cause", ".", "getMessage", "(", ")", ")", ";", "}", "return", "createErrorReply", "(", "status", ",", "sb", ".", "toString", "(", ")", ",", "mediaType", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Response", "createErrorReply", "(", "int", "status", ",", "String", "errorMessage", ",", "MediaType", "mediaType", ")", "{", "String", "message", ";", "if", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ".", "equals", "(", "mediaType", ")", ")", "{", "message", "=", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "\"", "+", "errorMessage", "+", "\"", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ";", "}", "else", "{", "message", "=", "\"", "<STR_LIT>", "\"", "+", "errorMessage", "+", "\"", "<STR_LIT>", "\"", ";", "}", "return", "Response", ".", "status", "(", "status", ")", ".", "entity", "(", "message", ")", ".", "type", "(", "mediaType", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "closeInputOnError", "(", "InputStream", "inputStream", ")", "{", "if", "(", "inputStream", "!", "=", "null", ")", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "inputStream", ".", "close", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "Object", "read", "(", "InputStream", "is", ",", "Class", "type", ",", "MediaType", "mediaType", ")", "throws", "IOException", ";", "</s>"]
["<s>", "void", "write", "(", "Object", "object", ",", "OutputStream", "os", ",", "MediaType", "mediaType", ")", "throws", "IOException", ";", "</s>"]
["<s>", "public", "XmlXStream", "(", ")", "{", "super", "(", "new", "DomDriver", "(", "null", ",", "initializeNameCoder", "(", ")", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "ApplicationConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "ApplicationsConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "DataCenterInfoConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "InstanceInfoConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "LeaseInfoConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "MetadataConverter", "(", ")", ")", ";", "setMode", "(", "XStream", ".", "NO_REFERENCES", ")", ";", "processAnnotations", "(", "new", "Class", "[", "]", "{", "InstanceInfo", ".", "class", ",", "Application", ".", "class", ",", "Applications", ".", "class", "}", ")", ";", "}", "</s>"]
["<s>", "public", "static", "XmlXStream", "getInstance", "(", ")", "{", "return", "s_instance", ";", "}", "</s>"]
["<s>", "private", "static", "XmlFriendlyNameCoder", "initializeNameCoder", "(", ")", "{", "EurekaClientConfig", "clientConfig", "=", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClientConfig", "(", ")", ";", "if", "(", "clientConfig", "=", "=", "null", ")", "{", "return", "new", "XmlFriendlyNameCoder", "(", ")", ";", "}", "return", "new", "XmlFriendlyNameCoder", "(", "clientConfig", ".", "getDollarReplacement", "(", ")", ",", "clientConfig", ".", "getEscapeCharReplacement", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "canConvert", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "clazz", ")", "{", "return", "Applications", ".", "class", "=", "=", "clazz", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "Applications", "apps", "=", "(", "Applications", ")", "source", ";", "writer", ".", "startNode", "(", "VERSIONS_DELTA", ")", ";", "writer", ".", "setValue", "(", "apps", ".", "getVersion", "(", ")", ".", "toString", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "APPS_HASHCODE", ")", ";", "writer", ".", "setValue", "(", "apps", ".", "getAppsHashCode", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "for", "(", "Application", "app", ":", "apps", ".", "getRegisteredApplications", "(", ")", ")", "{", "writer", ".", "startNode", "(", "NODE_APP", ")", ";", "context", ".", "convertAnother", "(", "app", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "while", "(", "reader", ".", "hasMoreChildren", "(", ")", ")", "{", "reader", ".", "moveDown", "(", ")", ";", "String", "nodeName", "=", "reader", ".", "getNodeName", "(", ")", ";", "if", "(", "NODE_APP", ".", "equals", "(", "nodeName", ")", ")", "{", "apps", ".", "addApplication", "(", "(", "Application", ")", "context", ".", "convertAnother", "(", "apps", ",", "Application", ".", "class", ")", ")", ";", "}", "else", "if", "(", "VERSIONS_DELTA", ".", "equals", "(", "nodeName", ")", ")", "{", "apps", ".", "setVersion", "(", "Long", ".", "valueOf", "(", "reader", ".", "getValue", "(", ")", ")", ")", ";", "}", "else", "if", "(", "APPS_HASHCODE", ".", "equals", "(", "nodeName", ")", ")", "{", "apps", ".", "setAppsHashCode", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "reader", ".", "moveUp", "(", ")", ";", "}", "return", "apps", ";", "}", "</s>"]
["<s>", "public", "boolean", "canConvert", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "clazz", ")", "{", "return", "Application", ".", "class", "=", "=", "clazz", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "Application", "app", "=", "(", "Application", ")", "source", ";", "writer", ".", "startNode", "(", "ELEM_NAME", ")", ";", "writer", ".", "setValue", "(", "app", ".", "getName", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "app", ".", "getInstances", "(", ")", ")", "{", "writer", ".", "startNode", "(", "NODE_INSTANCE", ")", ";", "context", ".", "convertAnother", "(", "instanceInfo", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "Application", "app", "=", "new", "Application", "(", ")", ";", "while", "(", "reader", ".", "hasMoreChildren", "(", ")", ")", "{", "reader", ".", "moveDown", "(", ")", ";", "String", "nodeName", "=", "reader", ".", "getNodeName", "(", ")", ";", "if", "(", "ELEM_NAME", ".", "equals", "(", "nodeName", ")", ")", "{", "app", ".", "setName", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "else", "if", "(", "NODE_INSTANCE", ".", "equals", "(", "nodeName", ")", ")", "{", "app", ".", "addInstance", "(", "(", "InstanceInfo", ")", "context", ".", "convertAnother", "(", "app", ",", "InstanceInfo", ".", "class", ")", ")", ";", "}", "reader", ".", "moveUp", "(", ")", ";", "}", "return", "app", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "canConvert", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "clazz", ")", "{", "return", "InstanceInfo", ".", "class", "=", "=", "clazz", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "InstanceInfo", "info", "=", "(", "InstanceInfo", ")", "source", ";", "if", "(", "info", ".", "getInstanceId", "(", ")", "!", "=", "null", ")", "{", "writer", ".", "startNode", "(", "ELEM_INSTANCE_ID", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getInstanceId", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "writer", ".", "startNode", "(", "ELEM_HOST", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getHostName", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_APP", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getAppName", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_IP", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getIPAddr", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "if", "(", "!", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "info", ".", "getSID", "(", ")", ")", "|", "|", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "info", ".", "getSID", "(", ")", ")", ")", ")", "{", "writer", ".", "startNode", "(", "ELEM_SID", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getSID", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "writer", ".", "startNode", "(", "ELEM_STATUS", ")", ";", "writer", ".", "setValue", "(", "getStatus", "(", "info", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_OVERRIDDEN_STATUS", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getOverriddenStatus", "(", ")", ".", "name", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_PORT", ")", ";", "writer", ".", "addAttribute", "(", "ATTR_ENABLED", ",", "String", ".", "valueOf", "(", "info", ".", "isPortEnabled", "(", "PortType", ".", "UNSECURE", ")", ")", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getPort", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_SECURE_PORT", ")", ";", "writer", ".", "addAttribute", "(", "ATTR_ENABLED", ",", "String", ".", "valueOf", "(", "info", ".", "isPortEnabled", "(", "PortType", ".", "SECURE", ")", ")", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getSecurePort", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_COUNTRY_ID", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getCountryId", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "if", "(", "info", ".", "getDataCenterInfo", "(", ")", "!", "=", "null", ")", "{", "writer", ".", "startNode", "(", "NODE_DATACENTER", ")", ";", "if", "(", "info", ".", "getDataCenterInfo", "(", ")", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "writer", ".", "addAttribute", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "writer", ".", "addAttribute", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "context", ".", "convertAnother", "(", "info", ".", "getDataCenterInfo", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "if", "(", "info", ".", "getLeaseInfo", "(", ")", "!", "=", "null", ")", "{", "writer", ".", "startNode", "(", "NODE_LEASE", ")", ";", "context", ".", "convertAnother", "(", "info", ".", "getLeaseInfo", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "if", "(", "info", ".", "getMetadata", "(", ")", "!", "=", "null", ")", "{", "writer", ".", "startNode", "(", "NODE_METADATA", ")", ";", "if", "(", "info", ".", "getMetadata", "(", ")", ".", "size", "(", ")", "=", "=", "0", ")", "{", "writer", ".", "addAttribute", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "context", ".", "convertAnother", "(", "info", ".", "getMetadata", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "autoMarshalEligible", "(", "source", ",", "writer", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getStatus", "(", "InstanceInfo", "info", ")", "{", "return", "info", ".", "getStatus", "(", ")", ".", "name", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "while", "(", "reader", ".", "hasMoreChildren", "(", ")", ")", "{", "reader", ".", "moveDown", "(", ")", ";", "String", "nodeName", "=", "reader", ".", "getNodeName", "(", ")", ";", "if", "(", "ELEM_HOST", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setHostName", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_INSTANCE_ID", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setInstanceId", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_APP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setAppName", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_IP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setIPAddr", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_SID", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setSID", "(", "reader", ".", "getValue", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_IDENTIFYING_ATTR", ".", "equals", "(", "nodeName", ")", ")", "{", "}", "else", "if", "(", "ELEM_STATUS", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setStatus", "(", "InstanceStatus", ".", "toEnum", "(", "reader", ".", "getValue", "(", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_OVERRIDDEN_STATUS", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setOverriddenStatus", "(", "InstanceStatus", ".", "toEnum", "(", "reader", ".", "getValue", "(", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_PORT", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setPort", "(", "Integer", ".", "valueOf", "(", "reader", ".", "getValue", "(", ")", ")", ".", "intValue", "(", ")", ")", ";", "builder", ".", "enablePort", "(", "PortType", ".", "UNSECURE", ",", "!", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "reader", ".", "getAttribute", "(", "ATTR_ENABLED", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_SECURE_PORT", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setSecurePort", "(", "Integer", ".", "valueOf", "(", "reader", ".", "getValue", "(", ")", ")", ".", "intValue", "(", ")", ")", ";", "builder", ".", "enablePort", "(", "PortType", ".", "SECURE", ",", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "reader", ".", "getAttribute", "(", "ATTR_ENABLED", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_COUNTRY_ID", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setCountryId", "(", "Integer", ".", "valueOf", "(", "reader", ".", "getValue", "(", ")", ")", ".", "intValue", "(", ")", ")", ";", "}", "else", "if", "(", "NODE_DATACENTER", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setDataCenterInfo", "(", "(", "DataCenterInfo", ")", "context", ".", "convertAnother", "(", "builder", ",", "DataCenterInfo", ".", "class", ")", ")", ";", "}", "else", "if", "(", "NODE_LEASE", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setLeaseInfo", "(", "(", "LeaseInfo", ")", "context", ".", "convertAnother", "(", "builder", ",", "LeaseInfo", ".", "class", ")", ")", ";", "}", "else", "if", "(", "NODE_METADATA", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setMetadata", "(", "(", "Map", "<", "String", ",", "String", ">", ")", "context", ".", "convertAnother", "(", "builder", ",", "Map", ".", "class", ")", ")", ";", "}", "else", "{", "autoUnmarshalEligible", "(", "reader", ",", "builder", ".", "getRawInstance", "(", ")", ")", ";", "}", "reader", ".", "moveUp", "(", ")", ";", "}", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "canConvert", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "clazz", ")", "{", "return", "DataCenterInfo", ".", "class", ".", "isAssignableFrom", "(", "clazz", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "DataCenterInfo", "info", "=", "(", "DataCenterInfo", ")", "source", ";", "writer", ".", "startNode", "(", "ELEM_NAME", ")", ";", "writer", ".", "setValue", "(", "info", ".", "getName", "(", ")", ".", "name", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "if", "(", "info", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "AmazonInfo", "aInfo", "=", "(", "AmazonInfo", ")", "info", ";", "writer", ".", "startNode", "(", "NODE_METADATA", ")", ";", "if", "(", "aInfo", ".", "getMetadata", "(", ")", ".", "size", "(", ")", "=", "=", "0", ")", "{", "writer", ".", "addAttribute", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "context", ".", "convertAnother", "(", "aInfo", ".", "getMetadata", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "DataCenterInfo", "info", "=", "null", ";", "while", "(", "reader", ".", "hasMoreChildren", "(", ")", ")", "{", "reader", ".", "moveDown", "(", ")", ";", "if", "(", "ELEM_NAME", ".", "equals", "(", "reader", ".", "getNodeName", "(", ")", ")", ")", "{", "final", "String", "dataCenterName", "=", "reader", ".", "getValue", "(", ")", ";", "if", "(", "DataCenterInfo", ".", "Name", ".", "Amazon", ".", "name", "(", ")", ".", "equalsIgnoreCase", "(", "dataCenterName", ")", ")", "{", "info", "=", "new", "AmazonInfo", "(", ")", ";", "}", "else", "{", "final", "DataCenterInfo", ".", "Name", "name", "=", "DataCenterInfo", ".", "Name", ".", "valueOf", "(", "dataCenterName", ")", ";", "info", "=", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "name", ";", "}", "}", ";", "}", "}", "else", "if", "(", "NODE_METADATA", ".", "equals", "(", "reader", ".", "getNodeName", "(", ")", ")", ")", "{", "if", "(", "info", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "Map", "<", "String", ",", "String", ">", "metadataMap", "=", "(", "Map", "<", "String", ",", "String", ">", ")", "context", ".", "convertAnother", "(", "info", ",", "Map", ".", "class", ")", ";", "Map", "<", "String", ",", "String", ">", "metadataMapInter", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", "metadataMap", ".", "size", "(", ")", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "entry", ":", "metadataMap", ".", "entrySet", "(", ")", ")", "{", "metadataMapInter", ".", "put", "(", "StringCache", ".", "intern", "(", "entry", ".", "getKey", "(", ")", ")", ",", "StringCache", ".", "intern", "(", "entry", ".", "getValue", "(", ")", ")", ")", ";", "}", "(", "(", "AmazonInfo", ")", "info", ")", ".", "setMetadata", "(", "metadataMapInter", ")", ";", "}", "}", "reader", ".", "moveUp", "(", ")", ";", "}", "return", "info", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "canConvert", "(", "Class", "clazz", ")", "{", "return", "LeaseInfo", ".", "class", "=", "=", "clazz", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "LeaseInfo", "info", "=", "(", "LeaseInfo", ")", "source", ";", "writer", ".", "startNode", "(", "ELEM_RENEW_INT", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getRenewalIntervalInSecs", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_DURATION", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getDurationInSecs", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_REG_TIMESTAMP", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getRegistrationTimestamp", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_LAST_RENEW_TIMETSTAMP", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getRenewalTimestamp", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_EVICTION_TIMESTAMP", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getEvictionTimestamp", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "writer", ".", "startNode", "(", "ELEM_SERVICE_UP_TIMESTAMP", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "info", ".", "getServiceUpTimestamp", "(", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "LeaseInfo", ".", "Builder", "builder", "=", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "while", "(", "reader", ".", "hasMoreChildren", "(", ")", ")", "{", "reader", ".", "moveDown", "(", ")", ";", "String", "nodeName", "=", "reader", ".", "getNodeName", "(", ")", ";", "String", "nodeValue", "=", "reader", ".", "getValue", "(", ")", ";", "if", "(", "nodeValue", "=", "=", "null", ")", "{", "continue", ";", "}", "long", "longValue", "=", "0", ";", "try", "{", "longValue", "=", "Long", ".", "valueOf", "(", "nodeValue", ")", ".", "longValue", "(", ")", ";", "}", "catch", "(", "NumberFormatException", "ne", ")", "{", "continue", ";", "}", "if", "(", "ELEM_DURATION", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setDurationInSecs", "(", "(", "int", ")", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_EVICTION_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setEvictionTimestamp", "(", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_LAST_RENEW_TIMETSTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setRenewalTimestamp", "(", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_REG_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setRegistrationTimestamp", "(", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_RENEW_INT", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setRenewalIntervalInSecs", "(", "(", "int", ")", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_SERVICE_UP_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setServiceUpTimestamp", "(", "longValue", ")", ";", "}", "reader", ".", "moveUp", "(", ")", ";", "}", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "canConvert", "(", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "type", ")", "{", "return", "Map", ".", "class", ".", "isAssignableFrom", "(", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "marshal", "(", "Object", "source", ",", "HierarchicalStreamWriter", "writer", ",", "MarshallingContext", "context", ")", "{", "Map", "<", "String", ",", "String", ">", "map", "=", "(", "Map", "<", "String", ",", "String", ">", ")", "source", ";", "for", "(", "Iterator", "<", "Entry", "<", "String", ",", "String", ">", ">", "iter", "=", "map", ".", "entrySet", "(", ")", ".", "iterator", "(", ")", ";", "iter", ".", "hasNext", "(", ")", ";", ")", "{", "Entry", "<", "String", ",", "String", ">", "entry", "=", "iter", ".", "next", "(", ")", ";", "writer", ".", "startNode", "(", "entry", ".", "getKey", "(", ")", ")", ";", "writer", ".", "setValue", "(", "entry", ".", "getValue", "(", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "unmarshal", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "return", "unmarshalMap", "(", "reader", ",", "context", ")", ";", "}", "</s>"]
["<s>", "private", "Map", "<", "String", ",", "String", ">", "unmarshalMap", "(", "HierarchicalStreamReader", "reader", ",", "UnmarshallingContext", "context", ")", "{", "Map", "<", "String", ",", "String", ">", "map", "=", "Collections", ".", "emptyMap", "(", ")", ";", "while", "(", "reader", ".", "hasMoreChildren", "(", ")", ")", "{", "if", "(", "map", "=", "=", "Collections", ".", "EMPTY_MAP", ")", "{", "map", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "}", "reader", ".", "moveDown", "(", ")", ";", "String", "key", "=", "reader", ".", "getNodeName", "(", ")", ";", "String", "value", "=", "reader", ".", "getValue", "(", ")", ";", "reader", ".", "moveUp", "(", ")", ";", "map", ".", "put", "(", "StringCache", ".", "intern", "(", "key", ")", ",", "value", ")", ";", "}", "return", "map", ";", "}", "</s>"]
["<s>", "private", "static", "void", "autoMarshalEligible", "(", "Object", "o", ",", "HierarchicalStreamWriter", "writer", ")", "{", "try", "{", "Class", "c", "=", "o", ".", "getClass", "(", ")", ";", "Field", "[", "]", "fields", "=", "c", ".", "getDeclaredFields", "(", ")", ";", "Annotation", "annotation", "=", "null", ";", "for", "(", "Field", "f", ":", "fields", ")", "{", "annotation", "=", "f", ".", "getAnnotation", "(", "Auto", ".", "class", ")", ";", "if", "(", "annotation", "!", "=", "null", ")", "{", "f", ".", "setAccessible", "(", "true", ")", ";", "if", "(", "f", ".", "get", "(", "o", ")", "!", "=", "null", ")", "{", "writer", ".", "startNode", "(", "f", ".", "getName", "(", ")", ")", ";", "writer", ".", "setValue", "(", "String", ".", "valueOf", "(", "f", ".", "get", "(", "o", ")", ")", ")", ";", "writer", ".", "endNode", "(", ")", ";", "}", "}", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "void", "autoUnmarshalEligible", "(", "HierarchicalStreamReader", "reader", ",", "Object", "o", ")", "{", "try", "{", "String", "nodeName", "=", "reader", ".", "getNodeName", "(", ")", ";", "Class", "c", "=", "o", ".", "getClass", "(", ")", ";", "Field", "f", "=", "null", ";", "try", "{", "f", "=", "c", ".", "getDeclaredField", "(", "nodeName", ")", ";", "}", "catch", "(", "NoSuchFieldException", "e", ")", "{", "UNMARSHALL_ERROR_COUNTER", ".", "increment", "(", ")", ";", "}", "if", "(", "f", "=", "=", "null", ")", "{", "return", ";", "}", "Annotation", "annotation", "=", "f", ".", "getAnnotation", "(", "Auto", ".", "class", ")", ";", "if", "(", "annotation", "=", "=", "null", ")", "{", "return", ";", "}", "f", ".", "setAccessible", "(", "true", ")", ";", "String", "value", "=", "reader", ".", "getValue", "(", ")", ";", "Class", "returnClass", "=", "f", ".", "getType", "(", ")", ";", "if", "(", "value", "!", "=", "null", ")", "{", "if", "(", "!", "String", ".", "class", ".", "equals", "(", "returnClass", ")", ")", "{", "Method", "method", "=", "returnClass", ".", "getDeclaredMethod", "(", "\"", "<STR_LIT>", "\"", ",", "java", ".", "lang", ".", "String", ".", "class", ")", ";", "Object", "valueObject", "=", "method", ".", "invoke", "(", "returnClass", ",", "value", ")", ";", "f", ".", "set", "(", "o", ",", "valueObject", ")", ";", "}", "else", "{", "f", ".", "set", "(", "o", ",", "value", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "</s>"]
["<s>", "public", "EurekaJacksonCodec", "(", ")", "{", "this", ".", "versionDeltaKey", "=", "formatKey", "(", "VERSIONS_DELTA_TEMPLATE", ")", ";", "this", ".", "appHashCodeKey", "=", "formatKey", "(", "APPS_HASHCODE_TEMPTE", ")", ";", "this", ".", "mapper", "=", "new", "ObjectMapper", "(", ")", ";", "this", ".", "mapper", ".", "setSerializationInclusion", "(", "Include", ".", "NON_NULL", ")", ";", "SimpleModule", "module", "=", "new", "SimpleModule", "(", "\"", "<STR_LIT>", "\"", ",", "VERSION", ")", ";", "module", ".", "addSerializer", "(", "DataCenterInfo", ".", "class", ",", "new", "DataCenterInfoSerializer", "(", ")", ")", ";", "module", ".", "addSerializer", "(", "InstanceInfo", ".", "class", ",", "new", "InstanceInfoSerializer", "(", ")", ")", ";", "module", ".", "addSerializer", "(", "Application", ".", "class", ",", "new", "ApplicationSerializer", "(", ")", ")", ";", "module", ".", "addSerializer", "(", "Applications", ".", "class", ",", "new", "ApplicationsSerializer", "(", "this", ".", "versionDeltaKey", ",", "this", ".", "appHashCodeKey", ")", ")", ";", "module", ".", "addDeserializer", "(", "DataCenterInfo", ".", "class", ",", "new", "DataCenterInfoDeserializer", "(", ")", ")", ";", "module", ".", "addDeserializer", "(", "LeaseInfo", ".", "class", ",", "new", "LeaseInfoDeserializer", "(", ")", ")", ";", "module", ".", "addDeserializer", "(", "InstanceInfo", ".", "class", ",", "new", "InstanceInfoDeserializer", "(", "this", ".", "mapper", ")", ")", ";", "module", ".", "addDeserializer", "(", "Application", ".", "class", ",", "new", "ApplicationDeserializer", "(", "this", ".", "mapper", ")", ")", ";", "module", ".", "addDeserializer", "(", "Applications", ".", "class", ",", "new", "ApplicationsDeserializer", "(", "this", ".", "mapper", ",", "this", ".", "versionDeltaKey", ",", "this", ".", "appHashCodeKey", ")", ")", ";", "this", ".", "mapper", ".", "registerModule", "(", "module", ")", ";", "HashMap", "<", "Class", "<", "?", ">", ",", "ObjectReader", ">", "readers", "=", "new", "HashMap", "<", ">", "(", ")", ";", "readers", ".", "put", "(", "InstanceInfo", ".", "class", ",", "mapper", ".", "reader", "(", ")", ".", "withType", "(", "InstanceInfo", ".", "class", ")", ".", "withRootName", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "readers", ".", "put", "(", "Application", ".", "class", ",", "mapper", ".", "reader", "(", ")", ".", "withType", "(", "Application", ".", "class", ")", ".", "withRootName", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "readers", ".", "put", "(", "Applications", ".", "class", ",", "mapper", ".", "reader", "(", ")", ".", "withType", "(", "Applications", ".", "class", ")", ".", "withRootName", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "this", ".", "objectReaderByClass", "=", "readers", ";", "HashMap", "<", "Class", "<", "?", ">", ",", "ObjectWriter", ">", "writers", "=", "new", "HashMap", "<", ">", "(", ")", ";", "writers", ".", "put", "(", "InstanceInfo", ".", "class", ",", "mapper", ".", "writer", "(", ")", ".", "withType", "(", "InstanceInfo", ".", "class", ")", ".", "withRootName", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "writers", ".", "put", "(", "Application", ".", "class", ",", "mapper", ".", "writer", "(", ")", ".", "withType", "(", "Application", ".", "class", ")", ".", "withRootName", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "writers", ".", "put", "(", "Applications", ".", "class", ",", "mapper", ".", "writer", "(", ")", ".", "withType", "(", "Applications", ".", "class", ")", ".", "withRootName", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "this", ".", "objectWriterByClass", "=", "writers", ";", "}", "</s>"]
["<s>", "protected", "ObjectMapper", "getMapper", "(", ")", "{", "return", "mapper", ";", "}", "</s>"]
["<s>", "protected", "String", "getVersionDeltaKey", "(", ")", "{", "return", "versionDeltaKey", ";", "}", "</s>"]
["<s>", "protected", "String", "getAppHashCodeKey", "(", ")", "{", "return", "appHashCodeKey", ";", "}", "</s>"]
["<s>", "protected", "static", "String", "formatKey", "(", "String", "keyTemplate", ")", "{", "EurekaClientConfig", "clientConfig", "=", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClientConfig", "(", ")", ";", "String", "replacement", ";", "if", "(", "clientConfig", "=", "=", "null", ")", "{", "replacement", "=", "\"", "<STR_LIT>", "\"", ";", "}", "else", "{", "replacement", "=", "clientConfig", ".", "getEscapeCharReplacement", "(", ")", ";", "}", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "keyTemplate", ".", "length", "(", ")", "+", "1", ")", ";", "for", "(", "char", "c", ":", "keyTemplate", ".", "toCharArray", "(", ")", ")", "{", "if", "(", "c", "=", "=", "<CHAR_LIT:_>", ")", "{", "sb", ".", "append", "(", "replacement", ")", ";", "}", "else", "{", "sb", ".", "append", "(", "c", ")", ";", "}", "}", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "readValue", "(", "Class", "<", "T", ">", "type", ",", "InputStream", "entityStream", ")", "throws", "IOException", "{", "ObjectReader", "reader", "=", "objectReaderByClass", ".", "get", "(", "type", ")", ";", "if", "(", "reader", "=", "=", "null", ")", "{", "return", "mapper", ".", "readValue", "(", "entityStream", ",", "type", ")", ";", "}", "return", "reader", ".", "readValue", "(", "entityStream", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "readValue", "(", "Class", "<", "T", ">", "type", ",", "String", "text", ")", "throws", "IOException", "{", "ObjectReader", "reader", "=", "objectReaderByClass", ".", "get", "(", "type", ")", ";", "if", "(", "reader", "=", "=", "null", ")", "{", "return", "mapper", ".", "readValue", "(", "text", ",", "type", ")", ";", "}", "return", "reader", ".", "readValue", "(", "text", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "void", "writeTo", "(", "T", "object", ",", "OutputStream", "entityStream", ")", "throws", "IOException", "{", "ObjectWriter", "writer", "=", "objectWriterByClass", ".", "get", "(", "object", ".", "getClass", "(", ")", ")", ";", "if", "(", "writer", "=", "=", "null", ")", "{", "mapper", ".", "writeValue", "(", "entityStream", ",", "object", ")", ";", "}", "else", "{", "writer", ".", "writeValue", "(", "entityStream", ",", "object", ")", ";", "}", "}", "</s>"]
["<s>", "public", "<", "T", ">", "String", "writeToString", "(", "T", "object", ")", "{", "try", "{", "ObjectWriter", "writer", "=", "objectWriterByClass", ".", "get", "(", "object", ".", "getClass", "(", ")", ")", ";", "if", "(", "writer", "=", "=", "null", ")", "{", "return", "mapper", ".", "writeValueAsString", "(", "object", ")", ";", "}", "return", "writer", ".", "writeValueAsString", "(", "object", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "EurekaJacksonCodec", "getInstance", "(", ")", "{", "return", "INSTANCE", ";", "}", "</s>"]
["<s>", "public", "static", "void", "setInstance", "(", "EurekaJacksonCodec", "instance", ")", "{", "INSTANCE", "=", "instance", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "serializeWithType", "(", "DataCenterInfo", "dataCenterInfo", ",", "JsonGenerator", "jgen", ",", "SerializerProvider", "provider", ",", "TypeSerializer", "typeSer", ")", "throws", "IOException", ",", "JsonProcessingException", "{", "jgen", ".", "writeStartObject", "(", ")", ";", "if", "(", "dataCenterInfo", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "jgen", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "jgen", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "jgen", ".", "writeStringField", "(", "ELEM_NAME", ",", "dataCenterInfo", ".", "getName", "(", ")", ".", "name", "(", ")", ")", ";", "if", "(", "dataCenterInfo", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "AmazonInfo", "aInfo", "=", "(", "AmazonInfo", ")", "dataCenterInfo", ";", "jgen", ".", "writeObjectField", "(", "DATACENTER_METADATA", ",", "aInfo", ".", "getMetadata", "(", ")", ")", ";", "}", "jgen", ".", "writeEndObject", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "serialize", "(", "DataCenterInfo", "dataCenterInfo", ",", "JsonGenerator", "jgen", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "serializeWithType", "(", "dataCenterInfo", ",", "jgen", ",", "provider", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "DataCenterInfo", "deserialize", "(", "JsonParser", "jp", ",", "DeserializationContext", "context", ")", "throws", "IOException", "{", "JsonNode", "node", "=", "jp", ".", "getCodec", "(", ")", ".", "readTree", "(", "jp", ")", ";", "final", "Name", "name", "=", "Name", ".", "valueOf", "(", "node", ".", "get", "(", "ELEM_NAME", ")", ".", "asText", "(", ")", ")", ";", "if", "(", "name", "!", "=", "Name", ".", "Amazon", ")", "{", "return", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "name", ";", "}", "}", ";", "}", "Map", "<", "String", ",", "String", ">", "metaData", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "JsonNode", "metaNode", "=", "node", ".", "get", "(", "DATACENTER_METADATA", ")", ";", "Iterator", "<", "String", ">", "metaNamesIt", "=", "metaNode", ".", "fieldNames", "(", ")", ";", "while", "(", "metaNamesIt", ".", "hasNext", "(", ")", ")", "{", "String", "key", "=", "metaNamesIt", ".", "next", "(", ")", ";", "String", "value", "=", "metaNode", ".", "get", "(", "key", ")", ".", "asText", "(", ")", ";", "metaData", ".", "put", "(", "StringCache", ".", "intern", "(", "key", ")", ",", "StringCache", ".", "intern", "(", "value", ")", ")", ";", "}", "AmazonInfo", "amazonInfo", "=", "new", "AmazonInfo", "(", ")", ";", "amazonInfo", ".", "setMetadata", "(", "metaData", ")", ";", "return", "amazonInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "LeaseInfo", "deserialize", "(", "JsonParser", "jp", ",", "DeserializationContext", "ctxt", ")", "throws", "IOException", "{", "LeaseInfo", ".", "Builder", "builder", "=", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "JsonNode", "node", "=", "jp", ".", "getCodec", "(", ")", ".", "readTree", "(", "jp", ")", ";", "Iterator", "<", "String", ">", "fieldNames", "=", "node", ".", "fieldNames", "(", ")", ";", "while", "(", "fieldNames", ".", "hasNext", "(", ")", ")", "{", "String", "nodeName", "=", "fieldNames", ".", "next", "(", ")", ";", "if", "(", "!", "node", ".", "get", "(", "nodeName", ")", ".", "isNull", "(", ")", ")", "{", "long", "longValue", "=", "node", ".", "get", "(", "nodeName", ")", ".", "asLong", "(", ")", ";", "if", "(", "ELEM_DURATION", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setDurationInSecs", "(", "(", "int", ")", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_EVICTION_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setEvictionTimestamp", "(", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_LAST_RENEW_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setRenewalTimestamp", "(", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_REG_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setRegistrationTimestamp", "(", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_RENEW_INT", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setRenewalIntervalInSecs", "(", "(", "int", ")", "longValue", ")", ";", "}", "else", "if", "(", "ELEM_SERVICE_UP_TIMESTAMP", ".", "equals", "(", "nodeName", ")", ")", "{", "builder", ".", "setServiceUpTimestamp", "(", "longValue", ")", ";", "}", "}", "}", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "serialize", "(", "InstanceInfo", "info", ",", "JsonGenerator", "jgen", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "jgen", ".", "writeStartObject", "(", ")", ";", "if", "(", "info", ".", "getInstanceId", "(", ")", "!", "=", "null", ")", "{", "jgen", ".", "writeStringField", "(", "ELEM_INSTANCE_ID", ",", "info", ".", "getInstanceId", "(", ")", ")", ";", "}", "jgen", ".", "writeStringField", "(", "ELEM_HOST", ",", "info", ".", "getHostName", "(", ")", ")", ";", "jgen", ".", "writeStringField", "(", "ELEM_APP", ",", "info", ".", "getAppName", "(", ")", ")", ";", "jgen", ".", "writeStringField", "(", "ELEM_IP", ",", "info", ".", "getIPAddr", "(", ")", ")", ";", "if", "(", "!", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "info", ".", "getSID", "(", ")", ")", "|", "|", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "info", ".", "getSID", "(", ")", ")", ")", ")", "{", "jgen", ".", "writeStringField", "(", "ELEM_SID", ",", "info", ".", "getSID", "(", ")", ")", ";", "}", "jgen", ".", "writeStringField", "(", "ELEM_STATUS", ",", "info", ".", "getStatus", "(", ")", ".", "name", "(", ")", ")", ";", "jgen", ".", "writeStringField", "(", "ELEM_OVERRIDDEN_STATUS", ",", "info", ".", "getOverriddenStatus", "(", ")", ".", "name", "(", ")", ")", ";", "jgen", ".", "writeFieldName", "(", "ELEM_PORT", ")", ";", "jgen", ".", "writeStartObject", "(", ")", ";", "jgen", ".", "writeNumberField", "(", "\"", "<STR_LIT:$>", "\"", ",", "info", ".", "getPort", "(", ")", ")", ";", "jgen", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "toString", "(", "info", ".", "isPortEnabled", "(", "PortType", ".", "UNSECURE", ")", ")", ")", ";", "jgen", ".", "writeEndObject", "(", ")", ";", "jgen", ".", "writeFieldName", "(", "ELEM_SECURE_PORT", ")", ";", "jgen", ".", "writeStartObject", "(", ")", ";", "jgen", ".", "writeNumberField", "(", "\"", "<STR_LIT:$>", "\"", ",", "info", ".", "getSecurePort", "(", ")", ")", ";", "jgen", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "toString", "(", "info", ".", "isPortEnabled", "(", "PortType", ".", "SECURE", ")", ")", ")", ";", "jgen", ".", "writeEndObject", "(", ")", ";", "jgen", ".", "writeNumberField", "(", "ELEM_COUNTRY_ID", ",", "info", ".", "getCountryId", "(", ")", ")", ";", "if", "(", "info", ".", "getDataCenterInfo", "(", ")", "!", "=", "null", ")", "{", "jgen", ".", "writeObjectField", "(", "NODE_DATACENTER", ",", "info", ".", "getDataCenterInfo", "(", ")", ")", ";", "}", "if", "(", "info", ".", "getLeaseInfo", "(", ")", "!", "=", "null", ")", "{", "jgen", ".", "writeObjectField", "(", "NODE_LEASE", ",", "info", ".", "getLeaseInfo", "(", ")", ")", ";", "}", "Map", "<", "String", ",", "String", ">", "metadata", "=", "info", ".", "getMetadata", "(", ")", ";", "if", "(", "metadata", "!", "=", "null", ")", "{", "if", "(", "metadata", ".", "isEmpty", "(", ")", ")", "{", "jgen", ".", "writeObjectField", "(", "NODE_METADATA", ",", "EMPTY_METADATA", ")", ";", "}", "else", "{", "jgen", ".", "writeObjectField", "(", "NODE_METADATA", ",", "metadata", ")", ";", "}", "}", "autoMarshalEligible", "(", "info", ",", "jgen", ")", ";", "jgen", ".", "writeEndObject", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "autoMarshalEligible", "(", "Object", "o", ",", "JsonGenerator", "jgen", ")", "{", "try", "{", "Class", "c", "=", "o", ".", "getClass", "(", ")", ";", "Field", "[", "]", "fields", "=", "c", ".", "getDeclaredFields", "(", ")", ";", "Annotation", "annotation", ";", "for", "(", "Field", "f", ":", "fields", ")", "{", "annotation", "=", "f", ".", "getAnnotation", "(", "Auto", ".", "class", ")", ";", "if", "(", "annotation", "!", "=", "null", ")", "{", "f", ".", "setAccessible", "(", "true", ")", ";", "if", "(", "f", ".", "get", "(", "o", ")", "!", "=", "null", ")", "{", "jgen", ".", "writeStringField", "(", "f", ".", "getName", "(", ")", ",", "String", ".", "valueOf", "(", "f", ".", "get", "(", "o", ")", ")", ")", ";", "}", "}", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "InstanceInfoDeserializer", "(", "ObjectMapper", "mapper", ")", "{", "this", ".", "mapper", "=", "mapper", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "deserialize", "(", "JsonParser", "jp", ",", "DeserializationContext", "context", ")", "throws", "IOException", "{", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "JsonNode", "node", "=", "jp", ".", "getCodec", "(", ")", ".", "readTree", "(", "jp", ")", ";", "String", "healthChecUrl", "=", "null", ";", "String", "healthCheckSecureUrl", "=", "null", ";", "Iterator", "<", "String", ">", "fieldNames", "=", "node", ".", "fieldNames", "(", ")", ";", "while", "(", "fieldNames", ".", "hasNext", "(", ")", ")", "{", "String", "fieldName", "=", "fieldNames", ".", "next", "(", ")", ";", "JsonNode", "fieldNode", "=", "node", ".", "get", "(", "fieldName", ")", ";", "if", "(", "!", "fieldNode", ".", "isNull", "(", ")", ")", "{", "if", "(", "ELEM_HOST", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setHostName", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_INSTANCE_ID", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setInstanceId", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_APP", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setAppName", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_IP", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setIPAddr", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_SID", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setSID", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_IDENTIFYING_ATTR", ".", "equals", "(", "fieldName", ")", ")", "{", "}", "else", "if", "(", "ELEM_STATUS", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setStatus", "(", "InstanceStatus", ".", "toEnum", "(", "fieldNode", ".", "asText", "(", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_OVERRIDDEN_STATUS", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setOverriddenStatus", "(", "InstanceStatus", ".", "toEnum", "(", "fieldNode", ".", "asText", "(", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_PORT", ".", "equals", "(", "fieldName", ")", ")", "{", "int", "port", "=", "fieldNode", ".", "get", "(", "\"", "<STR_LIT:$>", "\"", ")", ".", "asInt", "(", ")", ";", "boolean", "enabled", "=", "fieldNode", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asBoolean", "(", ")", ";", "builder", ".", "setPort", "(", "port", ")", ";", "builder", ".", "enablePort", "(", "PortType", ".", "UNSECURE", ",", "enabled", ")", ";", "}", "else", "if", "(", "ELEM_SECURE_PORT", ".", "equals", "(", "fieldName", ")", ")", "{", "int", "port", "=", "fieldNode", ".", "get", "(", "\"", "<STR_LIT:$>", "\"", ")", ".", "asInt", "(", ")", ";", "boolean", "enabled", "=", "fieldNode", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asBoolean", "(", ")", ";", "builder", ".", "setSecurePort", "(", "port", ")", ";", "builder", ".", "enablePort", "(", "PortType", ".", "SECURE", ",", "enabled", ")", ";", "}", "else", "if", "(", "ELEM_COUNTRY_ID", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setCountryId", "(", "Integer", ".", "valueOf", "(", "fieldNode", ".", "asText", "(", ")", ")", ".", "intValue", "(", ")", ")", ";", "}", "else", "if", "(", "NODE_DATACENTER", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setDataCenterInfo", "(", "mapper", ".", "treeToValue", "(", "fieldNode", ",", "DataCenterInfo", ".", "class", ")", ")", ";", "}", "else", "if", "(", "NODE_LEASE", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setLeaseInfo", "(", "mapper", ".", "treeToValue", "(", "fieldNode", ",", "LeaseInfo", ".", "class", ")", ")", ";", "}", "else", "if", "(", "NODE_METADATA", ".", "equals", "(", "fieldName", ")", ")", "{", "Map", "<", "String", ",", "String", ">", "meta", "=", "null", ";", "Iterator", "<", "String", ">", "metaNameIt", "=", "fieldNode", ".", "fieldNames", "(", ")", ";", "while", "(", "metaNameIt", ".", "hasNext", "(", ")", ")", "{", "String", "key", "=", "StringCache", ".", "intern", "(", "metaNameIt", ".", "next", "(", ")", ")", ";", "if", "(", "key", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "if", "(", "meta", "=", "=", "null", "&", "&", "!", "metaNameIt", ".", "hasNext", "(", ")", ")", "{", "meta", "=", "Collections", ".", "emptyMap", "(", ")", ";", "}", "}", "else", "{", "if", "(", "meta", "=", "=", "null", ")", "{", "meta", "=", "new", "ConcurrentHashMap", "<", "String", ",", "String", ">", "(", ")", ";", "}", "String", "value", "=", "StringCache", ".", "intern", "(", "fieldNode", ".", "get", "(", "key", ")", ".", "asText", "(", ")", ")", ";", "meta", ".", "put", "(", "key", ",", "value", ")", ";", "}", "}", "if", "(", "meta", "=", "=", "null", ")", "{", "meta", "=", "Collections", ".", "emptyMap", "(", ")", ";", "}", "builder", ".", "setMetadata", "(", "meta", ")", ";", "}", "else", "if", "(", "ELEM_HEALTHCHECKURL", ".", "equals", "(", "fieldName", ")", ")", "{", "healthChecUrl", "=", "fieldNode", ".", "asText", "(", ")", ";", "}", "else", "if", "(", "ELEM_SECHEALTHCHECKURL", ".", "equals", "(", "fieldName", ")", ")", "{", "healthCheckSecureUrl", "=", "fieldNode", ".", "asText", "(", ")", ";", "}", "else", "if", "(", "ELEM_APPGROUPNAME", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setAppGroupName", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_HOMEPAGEURL", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setHomePageUrlForDeser", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_STATUSPAGEURL", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setStatusPageUrlForDeser", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_VIPADDRESS", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setVIPAddressDeser", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_SECVIPADDRESS", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setSecureVIPAddressDeser", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_ISCOORDINATINGDISCSOERVER", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setIsCoordinatingDiscoveryServer", "(", "fieldNode", ".", "asBoolean", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_LASTUPDATEDTS", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setLastUpdatedTimestamp", "(", "fieldNode", ".", "asLong", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_LASTDIRTYTS", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setLastDirtyTimestamp", "(", "fieldNode", ".", "asLong", "(", ")", ")", ";", "}", "else", "if", "(", "ELEM_ACTIONTYPE", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setActionType", "(", "ActionType", ".", "valueOf", "(", "fieldNode", ".", "asText", "(", ")", ")", ")", ";", "}", "else", "if", "(", "ELEM_ASGNAME", ".", "equals", "(", "fieldName", ")", ")", "{", "builder", ".", "setASGName", "(", "fieldNode", ".", "asText", "(", ")", ")", ";", "}", "else", "{", "autoUnmarshalEligible", "(", "fieldName", ",", "fieldNode", ".", "asText", "(", ")", ",", "builder", ".", "getRawInstance", "(", ")", ")", ";", "}", "}", "}", "builder", ".", "setHealthCheckUrlsForDeser", "(", "healthChecUrl", ",", "healthCheckSecureUrl", ")", ";", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "autoUnmarshalEligible", "(", "String", "fieldName", ",", "String", "value", ",", "Object", "o", ")", "{", "try", "{", "Class", "c", "=", "o", ".", "getClass", "(", ")", ";", "Field", "f", "=", "null", ";", "try", "{", "f", "=", "c", ".", "getDeclaredField", "(", "fieldName", ")", ";", "}", "catch", "(", "NoSuchFieldException", "e", ")", "{", "}", "if", "(", "f", "=", "=", "null", ")", "{", "return", ";", "}", "Annotation", "annotation", "=", "f", ".", "getAnnotation", "(", "Auto", ".", "class", ")", ";", "if", "(", "annotation", "=", "=", "null", ")", "{", "return", ";", "}", "f", ".", "setAccessible", "(", "true", ")", ";", "Class", "returnClass", "=", "f", ".", "getType", "(", ")", ";", "if", "(", "value", "!", "=", "null", ")", "{", "if", "(", "!", "String", ".", "class", ".", "equals", "(", "returnClass", ")", ")", "{", "Method", "method", "=", "returnClass", ".", "getDeclaredMethod", "(", "\"", "<STR_LIT>", "\"", ",", "java", ".", "lang", ".", "String", ".", "class", ")", ";", "Object", "valueObject", "=", "method", ".", "invoke", "(", "returnClass", ",", "value", ")", ";", "f", ".", "set", "(", "o", ",", "valueObject", ")", ";", "}", "else", "{", "f", ".", "set", "(", "o", ",", "value", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "serialize", "(", "Application", "value", ",", "JsonGenerator", "jgen", ",", "SerializerProvider", "provider", ")", "throws", "IOException", ",", "JsonProcessingException", "{", "jgen", ".", "writeStartObject", "(", ")", ";", "jgen", ".", "writeStringField", "(", "ELEM_NAME", ",", "value", ".", "getName", "(", ")", ")", ";", "jgen", ".", "writeObjectField", "(", "ELEM_INSTANCE", ",", "value", ".", "getInstances", "(", ")", ")", ";", "jgen", ".", "writeEndObject", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ApplicationDeserializer", "(", "ObjectMapper", "mapper", ")", "{", "this", ".", "mapper", "=", "mapper", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Application", "deserialize", "(", "JsonParser", "jp", ",", "DeserializationContext", "context", ")", "throws", "IOException", "{", "JsonNode", "node", "=", "jp", ".", "getCodec", "(", ")", ".", "readTree", "(", "jp", ")", ";", "Application", "application", "=", "new", "Application", "(", "node", ".", "get", "(", "ELEM_NAME", ")", ".", "asText", "(", ")", ")", ";", "JsonNode", "instanceNode", "=", "node", ".", "get", "(", "ELEM_INSTANCE", ")", ";", "if", "(", "instanceNode", "!", "=", "null", ")", "{", "if", "(", "instanceNode", "instanceof", "ArrayNode", ")", "{", "ArrayNode", "instancesNode", "=", "(", "ArrayNode", ")", "instanceNode", ";", "if", "(", "instancesNode", "!", "=", "null", ")", "{", "for", "(", "JsonNode", "nextNode", ":", "instancesNode", ")", "{", "application", ".", "addInstance", "(", "mapper", ".", "treeToValue", "(", "nextNode", ",", "InstanceInfo", ".", "class", ")", ")", ";", "}", "}", "}", "else", "{", "application", ".", "addInstance", "(", "mapper", ".", "treeToValue", "(", "instanceNode", ",", "InstanceInfo", ".", "class", ")", ")", ";", "}", "}", "return", "application", ";", "}", "</s>"]
["<s>", "public", "ApplicationsSerializer", "(", "String", "versionDeltaKey", ",", "String", "appHashCodeKey", ")", "{", "this", ".", "versionDeltaKey", "=", "versionDeltaKey", ";", "this", ".", "appHashCodeKey", "=", "appHashCodeKey", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "serialize", "(", "Applications", "applications", ",", "JsonGenerator", "jgen", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "jgen", ".", "writeStartObject", "(", ")", ";", "jgen", ".", "writeStringField", "(", "versionDeltaKey", ",", "applications", ".", "getVersion", "(", ")", ".", "toString", "(", ")", ")", ";", "jgen", ".", "writeStringField", "(", "appHashCodeKey", ",", "applications", ".", "getAppsHashCode", "(", ")", ")", ";", "jgen", ".", "writeObjectField", "(", "NODE_APP", ",", "applications", ".", "getRegisteredApplications", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "ApplicationsDeserializer", "(", "ObjectMapper", "mapper", ",", "String", "versionDeltaKey", ",", "String", "appHashCodeKey", ")", "{", "this", ".", "mapper", "=", "mapper", ";", "this", ".", "versionDeltaKey", "=", "versionDeltaKey", ";", "this", ".", "appHashCodeKey", "=", "appHashCodeKey", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "deserialize", "(", "JsonParser", "jp", ",", "DeserializationContext", "context", ")", "throws", "IOException", "{", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "JsonNode", "node", "=", "jp", ".", "getCodec", "(", ")", ".", "readTree", "(", "jp", ")", ";", "if", "(", "node", ".", "get", "(", "versionDeltaKey", ")", "!", "=", "null", ")", "{", "apps", ".", "setVersion", "(", "node", ".", "get", "(", "versionDeltaKey", ")", ".", "asLong", "(", ")", ")", ";", "}", "if", "(", "node", ".", "get", "(", "appHashCodeKey", ")", "!", "=", "null", ")", "{", "apps", ".", "setAppsHashCode", "(", "node", ".", "get", "(", "appHashCodeKey", ")", ".", "asText", "(", ")", ")", ";", "}", "JsonNode", "appNode", "=", "node", ".", "get", "(", "NODE_APP", ")", ";", "if", "(", "appNode", "!", "=", "null", ")", "{", "if", "(", "appNode", "instanceof", "ArrayNode", ")", "{", "ArrayNode", "appsNode", "=", "(", "ArrayNode", ")", "appNode", ";", "for", "(", "JsonNode", "item", ":", "appsNode", ")", "{", "apps", ".", "addApplication", "(", "mapper", ".", "treeToValue", "(", "item", ",", "Application", ".", "class", ")", ")", ";", "}", "}", "else", "{", "apps", ".", "addApplication", "(", "mapper", ".", "treeToValue", "(", "appNode", ",", "Application", ".", "class", ")", ")", ";", "}", "}", "return", "apps", ";", "}", "</s>"]
["<s>", "public", "KeyFormatter", "(", "String", "replacement", ")", "{", "this", ".", "replacement", "=", "replacement", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "KeyFormatter", "(", "EurekaClientConfig", "eurekaClientConfig", ")", "{", "if", "(", "eurekaClientConfig", "=", "=", "null", ")", "{", "this", ".", "replacement", "=", "DEFAULT_REPLACEMENT", ";", "}", "else", "{", "this", ".", "replacement", "=", "eurekaClientConfig", ".", "getEscapeCharReplacement", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "String", "formatKey", "(", "String", "keyTemplate", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "keyTemplate", ".", "length", "(", ")", "+", "1", ")", ";", "for", "(", "char", "c", ":", "keyTemplate", ".", "toCharArray", "(", ")", ")", "{", "if", "(", "c", "=", "=", "<CHAR_LIT:_>", ")", "{", "sb", ".", "append", "(", "replacement", ")", ";", "}", "else", "{", "sb", ".", "append", "(", "c", ")", ";", "}", "}", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "KeyFormatter", "defaultKeyFormatter", "(", ")", "{", "return", "DEFAULT_KEY_FORMATTER", ";", "}", "</s>"]
["<s>", "public", "Object", "read", "(", "InputStream", "is", ",", "Class", "type", ",", "MediaType", "mediaType", ")", "throws", "IOException", "{", "XStream", "xstream", "=", "getXStreamInstance", "(", "mediaType", ")", ";", "if", "(", "xstream", "!", "=", "null", ")", "{", "return", "xstream", ".", "fromXML", "(", "is", ")", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "mediaType", ".", "getType", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "type", ".", "getName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "write", "(", "Object", "object", ",", "OutputStream", "os", ",", "MediaType", "mediaType", ")", "throws", "IOException", "{", "XStream", "xstream", "=", "getXStreamInstance", "(", "mediaType", ")", ";", "if", "(", "xstream", "!", "=", "null", ")", "{", "xstream", ".", "toXML", "(", "object", ",", "os", ")", ";", "}", "else", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "mediaType", ".", "getType", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "object", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "XStream", "getXStreamInstance", "(", "MediaType", "mediaType", ")", "{", "XStream", "xstream", "=", "null", ";", "if", "(", "JSON", ".", "equalsIgnoreCase", "(", "mediaType", ".", "getSubtype", "(", ")", ")", ")", "{", "xstream", "=", "JsonXStream", ".", "getInstance", "(", ")", ";", "}", "else", "if", "(", "XML", ".", "equalsIgnoreCase", "(", "mediaType", ".", "getSubtype", "(", ")", ")", ")", "{", "xstream", "=", "XmlXStream", ".", "getInstance", "(", ")", ";", "}", "return", "xstream", ";", "}", "</s>"]
["<s>", "public", "JsonXStream", "(", ")", "{", "super", "(", "new", "JettisonMappedXmlDriver", "(", ")", "{", "private", "final", "NameCoder", "coder", "=", "initializeNameCoder", "(", ")", ";", "protected", "NameCoder", "getNameCoder", "(", ")", "{", "return", "this", ".", "coder", ";", "}", "}", ")", ";", "registerConverter", "(", "new", "Converters", ".", "ApplicationConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "ApplicationsConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "DataCenterInfoConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "InstanceInfoConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "LeaseInfoConverter", "(", ")", ")", ";", "registerConverter", "(", "new", "Converters", ".", "MetadataConverter", "(", ")", ")", ";", "setMode", "(", "XStream", ".", "NO_REFERENCES", ")", ";", "processAnnotations", "(", "new", "Class", "[", "]", "{", "InstanceInfo", ".", "class", ",", "Application", ".", "class", ",", "Applications", ".", "class", "}", ")", ";", "}", "</s>"]
["<s>", "protected", "NameCoder", "getNameCoder", "(", ")", "{", "return", "this", ".", "coder", ";", "}", "</s>"]
["<s>", "public", "static", "JsonXStream", "getInstance", "(", ")", "{", "return", "s_instance", ";", "}", "</s>"]
["<s>", "private", "static", "XmlFriendlyNameCoder", "initializeNameCoder", "(", ")", "{", "EurekaClientConfig", "clientConfig", "=", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "getEurekaClientConfig", "(", ")", ";", "if", "(", "clientConfig", "=", "=", "null", ")", "{", "return", "new", "XmlFriendlyNameCoder", "(", ")", ";", "}", "return", "new", "XmlFriendlyNameCoder", "(", "clientConfig", ".", "getDollarReplacement", "(", ")", ",", "clientConfig", ".", "getEscapeCharReplacement", "(", ")", ")", ";", "}", "</s>"]
["<s>", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", ";", "</s>"]
["<s>", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", ";", "</s>"]
["<s>", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", ";", "</s>"]
["<s>", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", ";", "</s>"]
["<s>", "String", "codecName", "(", ")", ";", "</s>"]
["<s>", "boolean", "support", "(", "MediaType", "mediaType", ")", ";", "</s>"]
["<s>", "public", "static", "void", "registerWrapper", "(", "CodecWrapper", "wrapper", ")", "{", "CODECS", ".", "put", "(", "wrapper", ".", "codecName", "(", ")", ",", "wrapper", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", "extends", "CodecWrapperBase", ">", "String", "getCodecName", "(", "Class", "<", "T", ">", "clazz", ")", "{", "return", "clazz", ".", "getSimpleName", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", "extends", "CodecWrapper", ">", "CodecWrapper", "getCodec", "(", "Class", "<", "T", ">", "clazz", ")", "{", "return", "getCodec", "(", "getCodecName", "(", "clazz", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "synchronized", "CodecWrapper", "getCodec", "(", "String", "name", ")", "{", "if", "(", "name", "=", "=", "null", ")", "{", "return", "null", ";", "}", "if", "(", "!", "CODECS", ".", "containsKey", "(", "name", ")", ")", "{", "CodecWrapper", "wrapper", "=", "create", "(", "name", ")", ";", "if", "(", "wrapper", "!", "=", "null", ")", "{", "CODECS", ".", "put", "(", "wrapper", ".", "codecName", "(", ")", ",", "wrapper", ")", ";", "}", "}", "return", "CODECS", ".", "get", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", "extends", "EncoderWrapper", ">", "EncoderWrapper", "getEncoder", "(", "Class", "<", "T", ">", "clazz", ")", "{", "return", "getEncoder", "(", "getCodecName", "(", "clazz", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "synchronized", "EncoderWrapper", "getEncoder", "(", "String", "name", ")", "{", "if", "(", "name", "=", "=", "null", ")", "{", "return", "null", ";", "}", "if", "(", "!", "CODECS", ".", "containsKey", "(", "name", ")", ")", "{", "CodecWrapper", "wrapper", "=", "create", "(", "name", ")", ";", "if", "(", "wrapper", "!", "=", "null", ")", "{", "CODECS", ".", "put", "(", "wrapper", ".", "codecName", "(", ")", ",", "wrapper", ")", ";", "}", "}", "return", "CODECS", ".", "get", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", "extends", "DecoderWrapper", ">", "DecoderWrapper", "getDecoder", "(", "Class", "<", "T", ">", "clazz", ")", "{", "return", "getDecoder", "(", "getCodecName", "(", "clazz", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "synchronized", "DecoderWrapper", "resolveDecoder", "(", "String", "name", ",", "String", "eurekaAccept", ")", "{", "EurekaAccept", "accept", "=", "EurekaAccept", ".", "fromString", "(", "eurekaAccept", ")", ";", "switch", "(", "accept", ")", "{", "case", "compact", ":", "return", "getDecoder", "(", "JacksonJsonMini", ".", "class", ")", ";", "case", "full", ":", "default", ":", "return", "getDecoder", "(", "name", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "synchronized", "DecoderWrapper", "getDecoder", "(", "String", "name", ")", "{", "if", "(", "name", "=", "=", "null", ")", "{", "return", "null", ";", "}", "if", "(", "!", "CODECS", ".", "containsKey", "(", "name", ")", ")", "{", "CodecWrapper", "wrapper", "=", "create", "(", "name", ")", ";", "if", "(", "wrapper", "!", "=", "null", ")", "{", "CODECS", ".", "put", "(", "wrapper", ".", "codecName", "(", ")", ",", "wrapper", ")", ";", "}", "}", "return", "CODECS", ".", "get", "(", "name", ")", ";", "}", "</s>"]
["<s>", "private", "static", "CodecWrapper", "create", "(", "String", "name", ")", "{", "if", "(", "getCodecName", "(", "JacksonJson", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "JacksonJson", "(", ")", ";", "}", "else", "if", "(", "getCodecName", "(", "JacksonJsonMini", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "JacksonJsonMini", "(", ")", ";", "}", "else", "if", "(", "getCodecName", "(", "LegacyJacksonJson", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "LegacyJacksonJson", "(", ")", ";", "}", "else", "if", "(", "getCodecName", "(", "XStreamJson", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "XStreamJson", "(", ")", ";", "}", "else", "if", "(", "getCodecName", "(", "JacksonXml", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "JacksonXml", "(", ")", ";", "}", "else", "if", "(", "getCodecName", "(", "JacksonXmlMini", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "JacksonXmlMini", "(", ")", ";", "}", "else", "if", "(", "getCodecName", "(", "XStreamXml", ".", "class", ")", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "XStreamXml", "(", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "writeValueAsString", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "writeTo", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "textValue", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "inputStream", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "writeValueAsString", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "writeTo", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "textValue", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "inputStream", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_XML_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "writeValueAsString", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "writeTo", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "textValue", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "inputStream", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_XML_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "writeValueAsString", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "writeTo", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "textValue", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "getObjectMapper", "(", "type", ")", ".", "readValue", "(", "inputStream", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "writeToString", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "writeTo", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "readValue", "(", "type", ",", "textValue", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "codec", ".", "readValue", "(", "type", ",", "inputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "toXML", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "toXML", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "(", "T", ")", "codec", ".", "fromXML", "(", "textValue", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "(", "T", ")", "codec", ".", "fromXML", "(", "inputStream", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "codecName", "(", ")", "{", "return", "CodecWrappers", ".", "getCodecName", "(", "this", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "support", "(", "MediaType", "mediaType", ")", "{", "return", "mediaType", ".", "equals", "(", "MediaType", ".", "APPLICATION_XML_TYPE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "String", "encode", "(", "T", "object", ")", "throws", "IOException", "{", "return", "codec", ".", "toXML", "(", "object", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "encode", "(", "T", "object", ",", "OutputStream", "outputStream", ")", "throws", "IOException", "{", "codec", ".", "toXML", "(", "object", ",", "outputStream", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "String", "textValue", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "(", "T", ")", "codec", ".", "fromXML", "(", "textValue", ",", "type", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "decode", "(", "InputStream", "inputStream", ",", "Class", "<", "T", ">", "type", ")", "throws", "IOException", "{", "return", "(", "T", ")", "codec", ".", "fromXML", "(", "inputStream", ",", "type", ")", ";", "}", "</s>"]
["<s>", "public", "DataCenterTypeInfoResolver", "(", ")", "{", "super", "(", "TypeFactory", ".", "defaultInstance", "(", ")", ".", "constructType", "(", "DataCenterInfo", ".", "class", ")", ",", "TypeFactory", ".", "defaultInstance", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JavaType", "typeFromId", "(", "DatabindContext", "context", ",", "String", "id", ")", "{", "if", "(", "MY_DATA_CENTER_INFO_TYPE_MARKER", ".", "equals", "(", "id", ")", ")", "{", "return", "context", ".", "getTypeFactory", "(", ")", ".", "constructType", "(", "MyDataCenterInfo", ".", "class", ")", ";", "}", "return", "super", ".", "typeFromId", "(", "context", ",", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "idFromValue", "(", "Object", "value", ")", "{", "if", "(", "value", ".", "getClass", "(", ")", ".", "equals", "(", "AmazonInfo", ".", "class", ")", ")", "{", "return", "AmazonInfo", ".", "class", ".", "getName", "(", ")", ";", "}", "return", "MY_DATA_CENTER_INFO_TYPE_MARKER", ";", "}", "</s>"]
["<s>", "public", "EurekaXmlJacksonCodec", "(", ")", "{", "this", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "EurekaXmlJacksonCodec", "(", "final", "KeyFormatter", "keyFormatter", ",", "boolean", "compact", ")", "{", "xmlMapper", "=", "new", "XmlMapper", "(", ")", "{", "public", "ObjectMapper", "registerModule", "(", "Module", "module", ")", "{", "setSerializerFactory", "(", "getSerializerFactory", "(", ")", ".", "withSerializerModifier", "(", "EurekaJacksonXmlModifiers", ".", "createXmlSerializerModifier", "(", "keyFormatter", ")", ")", ")", ";", "return", "super", ".", "registerModule", "(", "module", ")", ";", "}", "}", ";", "xmlMapper", ".", "setSerializationInclusion", "(", "Include", ".", "NON_NULL", ")", ";", "xmlMapper", ".", "addMixIn", "(", "DataCenterInfo", ".", "class", ",", "DataCenterInfoXmlMixIn", ".", "class", ")", ";", "xmlMapper", ".", "addMixIn", "(", "Application", ".", "class", ",", "ApplicationXmlMixIn", ".", "class", ")", ";", "xmlMapper", ".", "addMixIn", "(", "Applications", ".", "class", ",", "ApplicationsXmlMixIn", ".", "class", ")", ";", "SimpleModule", "xmlModule", "=", "new", "SimpleModule", "(", ")", ";", "xmlModule", ".", "setDeserializerModifier", "(", "EurekaJacksonXmlModifiers", ".", "createXmlDeserializerModifier", "(", "keyFormatter", ",", "compact", ")", ")", ";", "xmlMapper", ".", "registerModule", "(", "xmlModule", ")", ";", "if", "(", "compact", ")", "{", "addMiniConfig", "(", "xmlMapper", ")", ";", "}", "}", "</s>"]
["<s>", "public", "ObjectMapper", "registerModule", "(", "Module", "module", ")", "{", "setSerializerFactory", "(", "getSerializerFactory", "(", ")", ".", "withSerializerModifier", "(", "EurekaJacksonXmlModifiers", ".", "createXmlSerializerModifier", "(", "keyFormatter", ")", ")", ")", ";", "return", "super", ".", "registerModule", "(", "module", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "ObjectMapper", "getObjectMapper", "(", "Class", "<", "T", ">", "type", ")", "{", "return", "xmlMapper", ";", "}", "</s>"]
["<s>", "private", "EurekaJacksonXmlModifiers", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "BeanDeserializerModifier", "createXmlDeserializerModifier", "(", "final", "KeyFormatter", "keyFormatter", ",", "final", "boolean", "compactMode", ")", "{", "return", "new", "BeanDeserializerModifier", "(", ")", "{", "@", "Override", "public", "JsonDeserializer", "<", "?", ">", "modifyDeserializer", "(", "DeserializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonDeserializer", "<", "?", ">", "deserializer", ")", "{", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoXmlBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "compactMode", ")", ";", "}", "return", "super", ".", "modifyDeserializer", "(", "config", ",", "beanDesc", ",", "deserializer", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JsonDeserializer", "<", "?", ">", "modifyDeserializer", "(", "DeserializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonDeserializer", "<", "?", ">", "deserializer", ")", "{", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoXmlBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "compactMode", ")", ";", "}", "return", "super", ".", "modifyDeserializer", "(", "config", ",", "beanDesc", ",", "deserializer", ")", ";", "}", "</s>"]
["<s>", "public", "static", "BeanSerializerModifier", "createXmlSerializerModifier", "(", "final", "KeyFormatter", "keyFormatter", ")", "{", "return", "new", "BeanSerializerModifier", "(", ")", "{", "@", "Override", "public", "JsonSerializer", "<", "?", ">", "modifySerializer", "(", "SerializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonSerializer", "<", "?", ">", "serializer", ")", "{", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsXmlBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoXmlBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ")", ";", "}", "return", "serializer", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JsonSerializer", "<", "?", ">", "modifySerializer", "(", "SerializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonSerializer", "<", "?", ">", "serializer", ")", "{", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsXmlBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoXmlBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ")", ";", "}", "return", "serializer", ";", "}", "</s>"]
["<s>", "public", "StringInterningAmazonInfoBuilder", "withName", "(", "String", "name", ")", "{", "return", "this", ";", "}", "</s>"]
["<s>", "public", "StringInterningAmazonInfoBuilder", "withMetadata", "(", "HashMap", "<", "String", ",", "String", ">", "metadata", ")", "{", "if", "(", "metadata", ".", "isEmpty", "(", ")", ")", "{", "this", ".", "metadata", "=", "metadata", ";", "return", "this", ";", "}", "this", ".", "metadata", "=", "new", "HashMap", "<", ">", "(", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "entry", ":", "metadata", ".", "entrySet", "(", ")", ")", "{", "String", "key", "=", "entry", ".", "getKey", "(", ")", ".", "intern", "(", ")", ";", "String", "value", "=", "entry", ".", "getValue", "(", ")", ";", "if", "(", "VALUE_INTERN_KEYS", ".", "contains", "(", "key", ")", ")", "{", "value", "=", "StringCache", ".", "intern", "(", "value", ")", ";", "}", "this", ".", "metadata", ".", "put", "(", "key", ",", "value", ")", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "AmazonInfo", "build", "(", ")", "{", "return", "new", "AmazonInfo", "(", "Name", ".", "Amazon", ".", "name", "(", ")", ",", "metadata", ")", ";", "}", "</s>"]
["<s>", "protected", "AbstractInstanceInfoDeserializer", "(", "BeanDeserializerBase", "src", ",", "boolean", "compactMode", ")", "{", "super", "(", "src", ")", ";", "this", ".", "compactMode", "=", "compactMode", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isCustomField", "(", "String", "propName", ")", "{", "return", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "propName", ")", "|", "|", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "propName", ")", "|", "|", "compactMode", "&", "&", "!", "MiniInstanceInfoMixIn", ".", "AllowedFields", ".", "ALLOWED_FIELDS", ".", "contains", "(", "propName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "handleCustomField", "(", "PropertyBasedCreator", "creator", ",", "PropertyValueBuffer", "buffer", ",", "String", "propName", ",", "JsonParser", "jp", ",", "DeserializationContext", "ctxt", ")", "throws", "IOException", "{", "boolean", "isComplete", "=", "false", ";", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "propName", ")", ")", "{", "isComplete", "=", "deserializePortSection", "(", "creator", ",", "buffer", ",", "jp", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "propName", ")", ")", "{", "isComplete", "=", "deserializePortSection", "(", "creator", ",", "buffer", ",", "jp", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "skipField", "(", "jp", ")", ";", "}", "return", "isComplete", ";", "}", "</s>"]
["<s>", "protected", "abstract", "boolean", "deserializePortSection", "(", "PropertyBasedCreator", "creator", ",", "PropertyValueBuffer", "buffer", ",", "JsonParser", "jp", ",", "String", "portProperty", ",", "String", "portEnabledProperty", ")", "throws", "IOException", ";", "</s>"]
["<s>", "private", "void", "skipField", "(", "JsonParser", "jp", ")", "throws", "IOException", "{", "JsonToken", "token", "=", "jp", ".", "getCurrentToken", "(", ")", ";", "if", "(", "token", "=", "=", "JsonToken", ".", "VALUE_STRING", "|", "|", "token", "=", "=", "JsonToken", ".", "VALUE_NUMBER_INT", "|", "|", "token", "=", "=", "JsonToken", ".", "VALUE_TRUE", "|", "|", "token", "=", "=", "JsonToken", ".", "VALUE_FALSE", ")", "{", "return", ";", "}", "if", "(", "token", "=", "=", "JsonToken", ".", "START_OBJECT", ")", "{", "int", "expectedEndObjects", "=", "1", ";", "while", "(", "expectedEndObjects", ">", "0", ")", "{", "switch", "(", "jp", ".", "nextToken", "(", ")", ")", "{", "case", "START_OBJECT", ":", "expectedEndObjects", "+", "+", ";", "break", ";", "case", "END_OBJECT", ":", "expectedEndObjects", "-", "-", ";", "}", "}", "}", "}", "</s>"]
["<s>", "InstanceInfoJsonBeanDeserializer", "(", "BeanDeserializerBase", "src", ",", "boolean", "compactMode", ")", "{", "super", "(", "src", ",", "compactMode", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "deserializePortSection", "(", "PropertyBasedCreator", "creator", ",", "PropertyValueBuffer", "buffer", ",", "JsonParser", "jp", ",", "String", "portProperty", ",", "String", "portEnabledProperty", ")", "throws", "IOException", "{", "Boolean", "enabled", "=", "null", ";", "Integer", "port", "=", "null", ";", "while", "(", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "FIELD_NAME", ")", "{", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "jp", ".", "getCurrentName", "(", ")", ")", ")", "{", "if", "(", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_STRING", ")", "{", "enabled", "=", "Boolean", ".", "valueOf", "(", "jp", ".", "getText", "(", ")", ")", ";", "}", "else", "{", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "}", "else", "if", "(", "\"", "<STR_LIT:$>", "\"", ".", "equals", "(", "jp", ".", "getCurrentName", "(", ")", ")", ")", "{", "if", "(", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_STRING", ")", "{", "port", "=", "Integer", ".", "valueOf", "(", "jp", ".", "getText", "(", ")", ")", ";", "}", "else", "if", "(", "jp", ".", "getCurrentToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_NUMBER_INT", ")", "{", "port", "=", "jp", ".", "getIntValue", "(", ")", ";", "}", "else", "{", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "}", "else", "{", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "}", "boolean", "last", "=", "false", ";", "if", "(", "port", "!", "=", "null", ")", "{", "SettableBeanProperty", "portProp", "=", "creator", ".", "findCreatorProperty", "(", "portProperty", ")", ";", "last", "|", "=", "buffer", ".", "assignParameter", "(", "portProp", ".", "getCreatorIndex", "(", ")", ",", "port", ")", ";", "}", "if", "(", "enabled", "!", "=", "null", ")", "{", "SettableBeanProperty", "enabledProp", "=", "creator", ".", "findCreatorProperty", "(", "portEnabledProperty", ")", ";", "last", "|", "=", "buffer", ".", "assignParameter", "(", "enabledProp", ".", "getCreatorIndex", "(", ")", ",", "enabled", ")", ";", "}", "return", "last", ";", "}", "</s>"]
["<s>", "InstanceInfoXmlBeanDeserializer", "(", "BeanDeserializerBase", "src", ",", "boolean", "compactMode", ")", "{", "super", "(", "src", ",", "compactMode", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "deserializePortSection", "(", "PropertyBasedCreator", "creator", ",", "PropertyValueBuffer", "buffer", ",", "JsonParser", "jp", ",", "String", "portProperty", ",", "String", "portEnabledProperty", ")", "throws", "IOException", "{", "if", "(", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "FIELD_NAME", "&", "&", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "jp", ".", "getCurrentName", "(", ")", ")", ")", "{", "if", "(", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_STRING", ")", "{", "boolean", "enabled", "=", "Boolean", ".", "valueOf", "(", "jp", ".", "getText", "(", ")", ")", ";", "if", "(", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "FIELD_NAME", "&", "&", "jp", ".", "nextToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_STRING", ")", "{", "int", "port", "=", "Integer", ".", "parseInt", "(", "jp", ".", "getText", "(", ")", ")", ";", "SettableBeanProperty", "portProp", "=", "creator", ".", "findCreatorProperty", "(", "portProperty", ")", ";", "buffer", ".", "assignParameter", "(", "portProp", ".", "getCreatorIndex", "(", ")", ",", "port", ")", ";", "SettableBeanProperty", "enabledProp", "=", "creator", ".", "findCreatorProperty", "(", "portEnabledProperty", ")", ";", "jp", ".", "nextToken", "(", ")", ";", "return", "buffer", ".", "assignParameter", "(", "enabledProp", ".", "getCreatorIndex", "(", ")", ",", "enabled", ")", ";", "}", "}", "}", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "</s>"]
["<s>", "InstanceInfoJsonBeanSerializer", "(", "BeanSerializerBase", "src", ",", "boolean", "compactMode", ")", "{", "super", "(", "src", ")", ";", "this", ".", "compactMode", "=", "compactMode", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "serializeFields", "(", "Object", "bean", ",", "JsonGenerator", "jgen0", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "super", ".", "serializeFields", "(", "bean", ",", "jgen0", ",", "provider", ")", ";", "InstanceInfo", "instanceInfo", "=", "(", "InstanceInfo", ")", "bean", ";", "jgen0", ".", "writeFieldName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "jgen0", ".", "writeStartObject", "(", ")", ";", "jgen0", ".", "writeNumberField", "(", "\"", "<STR_LIT:$>", "\"", ",", "instanceInfo", ".", "getPort", "(", ")", ")", ";", "jgen0", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "toString", "(", "instanceInfo", ".", "isPortEnabled", "(", "PortType", ".", "UNSECURE", ")", ")", ")", ";", "jgen0", ".", "writeEndObject", "(", ")", ";", "jgen0", ".", "writeFieldName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "jgen0", ".", "writeStartObject", "(", ")", ";", "jgen0", ".", "writeNumberField", "(", "\"", "<STR_LIT:$>", "\"", ",", "instanceInfo", ".", "getSecurePort", "(", ")", ")", ";", "jgen0", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "toString", "(", "instanceInfo", ".", "isPortEnabled", "(", "PortType", ".", "SECURE", ")", ")", ")", ";", "jgen0", ".", "writeEndObject", "(", ")", ";", "if", "(", "!", "compactMode", ")", "{", "jgen0", ".", "writeFieldName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "instanceInfo", ".", "getMetadata", "(", ")", "=", "=", "null", "|", "|", "instanceInfo", ".", "getMetadata", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "stringMapObjectMapper", ".", "writeValue", "(", "jgen0", ",", "EMPTY_MAP", ")", ";", "}", "else", "{", "stringMapObjectMapper", ".", "writeValue", "(", "jgen0", ",", "instanceInfo", ".", "getMetadata", "(", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "EurekaJacksonJsonModifiers", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "BeanDeserializerModifier", "createJsonDeserializerModifier", "(", "final", "KeyFormatter", "keyFormatter", ",", "final", "boolean", "compactMode", ")", "{", "return", "new", "BeanDeserializerModifier", "(", ")", "{", "@", "Override", "public", "JsonDeserializer", "<", "?", ">", "modifyDeserializer", "(", "DeserializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonDeserializer", "<", "?", ">", "deserializer", ")", "{", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoJsonBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "compactMode", ")", ";", "}", "return", "super", ".", "modifyDeserializer", "(", "config", ",", "beanDesc", ",", "deserializer", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JsonDeserializer", "<", "?", ">", "modifyDeserializer", "(", "DeserializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonDeserializer", "<", "?", ">", "deserializer", ")", "{", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getType", "(", ")", ".", "getRawClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoJsonBeanDeserializer", "(", "(", "BeanDeserializerBase", ")", "deserializer", ",", "compactMode", ")", ";", "}", "return", "super", ".", "modifyDeserializer", "(", "config", ",", "beanDesc", ",", "deserializer", ")", ";", "}", "</s>"]
["<s>", "public", "static", "BeanSerializerModifier", "createJsonSerializerModifier", "(", "final", "KeyFormatter", "keyFormatter", ",", "final", "boolean", "compactMode", ")", "{", "return", "new", "BeanSerializerModifier", "(", ")", "{", "@", "Override", "public", "JsonSerializer", "<", "?", ">", "modifySerializer", "(", "SerializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonSerializer", "<", "?", ">", "serializer", ")", "{", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsJsonBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoJsonBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ",", "compactMode", ")", ";", "}", "return", "serializer", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JsonSerializer", "<", "?", ">", "modifySerializer", "(", "SerializationConfig", "config", ",", "BeanDescription", "beanDesc", ",", "JsonSerializer", "<", "?", ">", "serializer", ")", "{", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "Applications", ".", "class", ")", ")", "{", "return", "new", "ApplicationsJsonBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ",", "keyFormatter", ")", ";", "}", "if", "(", "beanDesc", ".", "getBeanClass", "(", ")", ".", "isAssignableFrom", "(", "InstanceInfo", ".", "class", ")", ")", "{", "return", "new", "InstanceInfoJsonBeanSerializer", "(", "(", "BeanSerializerBase", ")", "serializer", ",", "compactMode", ")", ";", "}", "return", "serializer", ";", "}", "</s>"]
["<s>", "protected", "CustomizableBeanDeserializer", "(", "BeanDeserializerBase", "src", ")", "{", "super", "(", "src", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "protected", "Object", "_deserializeUsingPropertyBased", "(", "final", "JsonParser", "jp", ",", "final", "DeserializationContext", "ctxt", ")", "throws", "IOException", "{", "final", "PropertyBasedCreator", "creator", "=", "_propertyBasedCreator", ";", "PropertyValueBuffer", "buffer", "=", "creator", ".", "startBuilding", "(", "jp", ",", "ctxt", ",", "_objectIdReader", ")", ";", "TokenBuffer", "unknown", "=", "null", ";", "JsonToken", "t", "=", "jp", ".", "getCurrentToken", "(", ")", ";", "for", "(", ";", "t", "=", "=", "JsonToken", ".", "FIELD_NAME", ";", "t", "=", "jp", ".", "nextToken", "(", ")", ")", "{", "String", "propName", "=", "jp", ".", "getCurrentName", "(", ")", ";", "jp", ".", "nextToken", "(", ")", ";", "boolean", "isComplete", "=", "false", ";", "if", "(", "isCustomField", "(", "propName", ")", ")", "{", "isComplete", "=", "handleCustomField", "(", "creator", ",", "buffer", ",", "propName", ",", "jp", ",", "ctxt", ")", ";", "if", "(", "!", "isComplete", ")", "{", "continue", ";", "}", "}", "else", "{", "SettableBeanProperty", "creatorProp", "=", "creator", ".", "findCreatorProperty", "(", "propName", ")", ";", "if", "(", "creatorProp", "!", "=", "null", ")", "{", "try", "{", "Object", "value", "=", "creatorProp", ".", "deserialize", "(", "jp", ",", "ctxt", ")", ";", "isComplete", "=", "buffer", ".", "assignParameter", "(", "creatorProp", ".", "getCreatorIndex", "(", ")", ",", "value", ")", ";", "if", "(", "!", "isComplete", ")", "{", "continue", ";", "}", "}", "catch", "(", "UnrecognizedPropertyException", "e", ")", "{", "}", "}", "}", "if", "(", "isComplete", ")", "{", "jp", ".", "nextToken", "(", ")", ";", "Object", "bean", ";", "try", "{", "bean", "=", "creator", ".", "build", "(", "ctxt", ",", "buffer", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "wrapAndThrow", "(", "e", ",", "_beanType", ".", "getRawClass", "(", ")", ",", "propName", ",", "ctxt", ")", ";", "bean", "=", "null", ";", "}", "if", "(", "bean", ".", "getClass", "(", ")", "!", "=", "_beanType", ".", "getRawClass", "(", ")", ")", "{", "return", "handlePolymorphic", "(", "jp", ",", "ctxt", ",", "bean", ",", "unknown", ")", ";", "}", "if", "(", "unknown", "!", "=", "null", ")", "{", "bean", "=", "handleUnknownProperties", "(", "ctxt", ",", "bean", ",", "unknown", ")", ";", "}", "return", "deserialize", "(", "jp", ",", "ctxt", ",", "bean", ")", ";", "}", "if", "(", "buffer", ".", "readIdProperty", "(", "propName", ")", ")", "{", "continue", ";", "}", "SettableBeanProperty", "prop", "=", "_beanProperties", ".", "find", "(", "propName", ")", ";", "if", "(", "prop", "!", "=", "null", ")", "{", "buffer", ".", "bufferProperty", "(", "prop", ",", "prop", ".", "deserialize", "(", "jp", ",", "ctxt", ")", ")", ";", "continue", ";", "}", "if", "(", "_ignorableProps", "!", "=", "null", "&", "&", "_ignorableProps", ".", "contains", "(", "propName", ")", ")", "{", "handleIgnoredProperty", "(", "jp", ",", "ctxt", ",", "handledType", "(", ")", ",", "propName", ")", ";", "continue", ";", "}", "if", "(", "_anySetter", "!", "=", "null", ")", "{", "buffer", ".", "bufferAnyProperty", "(", "_anySetter", ",", "propName", ",", "_anySetter", ".", "deserialize", "(", "jp", ",", "ctxt", ")", ")", ";", "continue", ";", "}", "if", "(", "unknown", "=", "=", "null", ")", "{", "unknown", "=", "new", "TokenBuffer", "(", "jp", ")", ";", "}", "unknown", ".", "writeFieldName", "(", "propName", ")", ";", "unknown", ".", "copyCurrentStructure", "(", "jp", ")", ";", "}", "Object", "bean", ";", "try", "{", "bean", "=", "creator", ".", "build", "(", "ctxt", ",", "buffer", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "wrapInstantiationProblem", "(", "e", ",", "ctxt", ")", ";", "bean", "=", "null", ";", "}", "if", "(", "unknown", "!", "=", "null", ")", "{", "if", "(", "bean", ".", "getClass", "(", ")", "!", "=", "_beanType", ".", "getRawClass", "(", ")", ")", "{", "return", "handlePolymorphic", "(", "null", ",", "ctxt", ",", "bean", ",", "unknown", ")", ";", "}", "return", "handleUnknownProperties", "(", "ctxt", ",", "bean", ",", "unknown", ")", ";", "}", "return", "bean", ";", "}", "</s>"]
["<s>", "protected", "abstract", "boolean", "isCustomField", "(", "String", "propName", ")", ";", "</s>"]
["<s>", "protected", "abstract", "boolean", "handleCustomField", "(", "PropertyBasedCreator", "creator", ",", "PropertyValueBuffer", "buffer", ",", "String", "propName", ",", "JsonParser", "jp", ",", "DeserializationContext", "ctxt", ")", "throws", "IOException", ";", "</s>"]
["<s>", "protected", "ApplicationsBeanDeserializer", "(", "BeanDeserializerBase", "src", ",", "KeyFormatter", "keyFormatter", ")", "{", "super", "(", "src", ")", ";", "versionKey", "=", "keyFormatter", ".", "formatKey", "(", "\"", "<STR_LIT>", "\"", ")", ";", "appsHashCodeKey", "=", "keyFormatter", ".", "formatKey", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isCustomField", "(", "String", "propName", ")", "{", "return", "versionKey", ".", "equals", "(", "propName", ")", "|", "|", "appsHashCodeKey", ".", "equals", "(", "propName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "handleCustomField", "(", "PropertyBasedCreator", "creator", ",", "PropertyValueBuffer", "buffer", ",", "String", "propName", ",", "JsonParser", "jp", ",", "DeserializationContext", "ctxt", ")", "throws", "IOException", "{", "if", "(", "versionKey", ".", "equals", "(", "propName", ")", ")", "{", "long", "versionDelta", ";", "if", "(", "jp", ".", "getCurrentToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_STRING", ")", "{", "versionDelta", "=", "Long", ".", "valueOf", "(", "jp", ".", "getText", "(", ")", ")", ";", "}", "else", "if", "(", "jp", ".", "getCurrentToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_NUMBER_INT", ")", "{", "versionDelta", "=", "jp", ".", "getLongValue", "(", ")", ";", "}", "else", "{", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "SettableBeanProperty", "versionProp", "=", "creator", ".", "findCreatorProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "buffer", ".", "assignParameter", "(", "versionProp", ".", "getCreatorIndex", "(", ")", ",", "versionDelta", ")", ";", "}", "else", "if", "(", "appsHashCodeKey", ".", "equals", "(", "propName", ")", ")", "{", "String", "appsHashCode", ";", "if", "(", "jp", ".", "getCurrentToken", "(", ")", "=", "=", "JsonToken", ".", "VALUE_STRING", ")", "{", "appsHashCode", "=", "jp", ".", "getText", "(", ")", ";", "}", "else", "{", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "SettableBeanProperty", "appsHashCodeProp", "=", "creator", ".", "findCreatorProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "buffer", ".", "assignParameter", "(", "appsHashCodeProp", ".", "getCreatorIndex", "(", ")", ",", "appsHashCode", ")", ";", "}", "else", "{", "throw", "new", "JsonParseException", "(", "\"", "<STR_LIT>", "\"", ",", "jp", ".", "getCurrentLocation", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "ApplicationsJsonBeanSerializer", "(", "BeanSerializerBase", "src", ",", "KeyFormatter", "keyFormatter", ")", "{", "super", "(", "src", ")", ";", "versionKey", "=", "keyFormatter", ".", "formatKey", "(", "\"", "<STR_LIT>", "\"", ")", ";", "appsHashCodeKey", "=", "keyFormatter", ".", "formatKey", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "serializeFields", "(", "Object", "bean", ",", "JsonGenerator", "jgen0", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "super", ".", "serializeFields", "(", "bean", ",", "jgen0", ",", "provider", ")", ";", "Applications", "applications", "=", "(", "Applications", ")", "bean", ";", "if", "(", "applications", ".", "getVersion", "(", ")", "!", "=", "null", ")", "{", "jgen0", ".", "writeStringField", "(", "versionKey", ",", "Long", ".", "toString", "(", "applications", ".", "getVersion", "(", ")", ")", ")", ";", "}", "if", "(", "applications", ".", "getAppsHashCode", "(", ")", "!", "=", "null", ")", "{", "jgen0", ".", "writeStringField", "(", "appsHashCodeKey", ",", "applications", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "ApplicationsXmlBeanSerializer", "(", "BeanSerializerBase", "src", ",", "KeyFormatter", "keyFormatter", ")", "{", "super", "(", "src", ")", ";", "versionKey", "=", "keyFormatter", ".", "formatKey", "(", "\"", "<STR_LIT>", "\"", ")", ";", "appsHashCodeKey", "=", "keyFormatter", ".", "formatKey", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "serializeFields", "(", "Object", "bean", ",", "JsonGenerator", "jgen0", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "super", ".", "serializeFields", "(", "bean", ",", "jgen0", ",", "provider", ")", ";", "Applications", "applications", "=", "(", "Applications", ")", "bean", ";", "if", "(", "applications", ".", "getVersion", "(", ")", "!", "=", "null", ")", "{", "jgen0", ".", "writeStringField", "(", "versionKey", ",", "Long", ".", "toString", "(", "applications", ".", "getVersion", "(", ")", ")", ")", ";", "}", "if", "(", "applications", ".", "getAppsHashCode", "(", ")", "!", "=", "null", ")", "{", "jgen0", ".", "writeStringField", "(", "appsHashCodeKey", ",", "applications", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "EurekaJsonJacksonCodec", "(", ")", "{", "this", "(", "KeyFormatter", ".", "defaultKeyFormatter", "(", ")", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "EurekaJsonJacksonCodec", "(", "final", "KeyFormatter", "keyFormatter", ",", "boolean", "compact", ")", "{", "this", ".", "unwrappedJsonMapper", "=", "createObjectMapper", "(", "keyFormatter", ",", "compact", ",", "false", ")", ";", "this", ".", "wrappedJsonMapper", "=", "createObjectMapper", "(", "keyFormatter", ",", "compact", ",", "true", ")", ";", "}", "</s>"]
["<s>", "private", "ObjectMapper", "createObjectMapper", "(", "KeyFormatter", "keyFormatter", ",", "boolean", "compact", ",", "boolean", "wrapped", ")", "{", "ObjectMapper", "newMapper", "=", "new", "ObjectMapper", "(", ")", ";", "SimpleModule", "jsonModule", "=", "new", "SimpleModule", "(", ")", ";", "jsonModule", ".", "setSerializerModifier", "(", "EurekaJacksonJsonModifiers", ".", "createJsonSerializerModifier", "(", "keyFormatter", ",", "compact", ")", ")", ";", "jsonModule", ".", "setDeserializerModifier", "(", "EurekaJacksonJsonModifiers", ".", "createJsonDeserializerModifier", "(", "keyFormatter", ",", "compact", ")", ")", ";", "newMapper", ".", "registerModule", "(", "jsonModule", ")", ";", "newMapper", ".", "setSerializationInclusion", "(", "Include", ".", "NON_NULL", ")", ";", "newMapper", ".", "configure", "(", "SerializationFeature", ".", "WRAP_ROOT_VALUE", ",", "wrapped", ")", ";", "newMapper", ".", "configure", "(", "SerializationFeature", ".", "WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED", ",", "false", ")", ";", "newMapper", ".", "configure", "(", "DeserializationFeature", ".", "UNWRAP_ROOT_VALUE", ",", "wrapped", ")", ";", "newMapper", ".", "configure", "(", "DeserializationFeature", ".", "ACCEPT_SINGLE_VALUE_AS_ARRAY", ",", "true", ")", ";", "if", "(", "compact", ")", "{", "addMiniConfig", "(", "newMapper", ")", ";", "}", "else", "{", "newMapper", ".", "addMixIn", "(", "InstanceInfo", ".", "class", ",", "InstanceInfoJsonMixIn", ".", "class", ")", ";", "}", "return", "newMapper", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "ObjectMapper", "getObjectMapper", "(", "Class", "<", "T", ">", "type", ")", "{", "ObjectMapper", "mapper", "=", "mappers", ".", "get", "(", "type", ")", ";", "if", "(", "mapper", "=", "=", "null", ")", "{", "mapper", "=", "hasJsonRootName", "(", "type", ")", "?", "wrappedJsonMapper", ":", "unwrappedJsonMapper", ";", "mappers", ".", "put", "(", "type", ",", "mapper", ")", ";", "}", "return", "mapper", ";", "}", "</s>"]
["<s>", "public", "abstract", "<", "T", ">", "ObjectMapper", "getObjectMapper", "(", "Class", "<", "T", ">", "type", ")", ";", "</s>"]
["<s>", "public", "<", "T", ">", "void", "writeTo", "(", "T", "object", ",", "OutputStream", "entityStream", ")", "throws", "IOException", "{", "getObjectMapper", "(", "object", ".", "getClass", "(", ")", ")", ".", "writeValue", "(", "entityStream", ",", "object", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "addMiniConfig", "(", "ObjectMapper", "mapper", ")", "{", "mapper", ".", "addMixIn", "(", "InstanceInfo", ".", "class", ",", "MiniInstanceInfoMixIn", ".", "class", ")", ";", "bindAmazonInfoFilter", "(", "mapper", ")", ";", "}", "</s>"]
["<s>", "private", "void", "bindAmazonInfoFilter", "(", "ObjectMapper", "mapper", ")", "{", "SimpleFilterProvider", "filters", "=", "new", "SimpleFilterProvider", "(", ")", ";", "final", "String", "filterName", "=", "\"", "<STR_LIT>", "\"", ";", "mapper", ".", "setAnnotationIntrospector", "(", "new", "JacksonAnnotationIntrospector", "(", ")", "{", "@", "Override", "public", "Object", "findFilterId", "(", "Annotated", "a", ")", "{", "if", "(", "Map", ".", "class", ".", "isAssignableFrom", "(", "a", ".", "getRawType", "(", ")", ")", ")", "{", "return", "filterName", ";", "}", "return", "super", ".", "findFilterId", "(", "a", ")", ";", "}", "}", ")", ";", "filters", ".", "addFilter", "(", "filterName", ",", "new", "SimpleBeanPropertyFilter", "(", ")", "{", "@", "Override", "protected", "boolean", "include", "(", "BeanPropertyWriter", "writer", ")", "{", "return", "true", ";", "}", "@", "Override", "protected", "boolean", "include", "(", "PropertyWriter", "writer", ")", "{", "return", "MINI_AMAZON_INFO_INCLUDE_KEYS", ".", "contains", "(", "writer", ".", "getName", "(", ")", ")", ";", "}", "}", ")", ";", "mapper", ".", "setFilters", "(", "filters", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "findFilterId", "(", "Annotated", "a", ")", "{", "if", "(", "Map", ".", "class", ".", "isAssignableFrom", "(", "a", ".", "getRawType", "(", ")", ")", ")", "{", "return", "filterName", ";", "}", "return", "super", ".", "findFilterId", "(", "a", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "include", "(", "BeanPropertyWriter", "writer", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "include", "(", "PropertyWriter", "writer", ")", "{", "return", "MINI_AMAZON_INFO_INCLUDE_KEYS", ".", "contains", "(", "writer", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "static", "boolean", "hasJsonRootName", "(", "Class", "<", "?", ">", "type", ")", "{", "return", "type", ".", "getAnnotation", "(", "JsonRootName", ".", "class", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "InstanceInfoXmlBeanSerializer", "(", "BeanSerializerBase", "src", ")", "{", "super", "(", "src", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "serializeFields", "(", "Object", "bean", ",", "JsonGenerator", "jgen0", ",", "SerializerProvider", "provider", ")", "throws", "IOException", "{", "super", ".", "serializeFields", "(", "bean", ",", "jgen0", ",", "provider", ")", ";", "InstanceInfo", "instanceInfo", "=", "(", "InstanceInfo", ")", "bean", ";", "ToXmlGenerator", "xgen", "=", "(", "ToXmlGenerator", ")", "jgen0", ";", "xgen", ".", "writeFieldName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "xgen", ".", "writeStartObject", "(", ")", ";", "xgen", ".", "setNextIsAttribute", "(", "true", ")", ";", "xgen", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "toString", "(", "instanceInfo", ".", "isPortEnabled", "(", "PortType", ".", "UNSECURE", ")", ")", ")", ";", "xgen", ".", "setNextIsAttribute", "(", "false", ")", ";", "xgen", ".", "setNextIsUnwrapped", "(", "true", ")", ";", "xgen", ".", "writeString", "(", "Integer", ".", "toString", "(", "instanceInfo", ".", "getPort", "(", ")", ")", ")", ";", "xgen", ".", "writeEndObject", "(", ")", ";", "xgen", ".", "writeFieldName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "xgen", ".", "writeStartObject", "(", ")", ";", "xgen", ".", "setNextIsAttribute", "(", "true", ")", ";", "xgen", ".", "writeStringField", "(", "\"", "<STR_LIT>", "\"", ",", "Boolean", ".", "toString", "(", "instanceInfo", ".", "isPortEnabled", "(", "PortType", ".", "SECURE", ")", ")", ")", ";", "xgen", ".", "setNextIsAttribute", "(", "false", ")", ";", "xgen", ".", "setNextIsUnwrapped", "(", "true", ")", ";", "xgen", ".", "writeString", "(", "Integer", ".", "toString", "(", "instanceInfo", ".", "getSecurePort", "(", ")", ")", ")", ";", "xgen", ".", "writeEndObject", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JacksonXmlElementWrapper", "(", "useWrapping", "=", "false", ")", "List", "<", "Application", ">", "getRegisteredApplications", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "Map", "<", "String", ",", "String", ">", "getMetadata", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "String", "getAppGroupName", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "InstanceStatus", "getOverriddenStatus", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "String", "getSID", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "int", "getCountryId", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "String", "getHomePageUrl", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "String", "getStatusPageUrl", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "String", "getHealthCheckUrl", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "String", "getSecureHealthCheckUrl", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "boolean", "isCoordinatingDiscoveryServer", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "Long", "getLastDirtyTimestamp", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "LeaseInfo", "getLeaseInfo", "(", ")", ";", "</s>"]
["<s>", "@", "JsonIgnore", "Map", "<", "String", ",", "String", ">", "getMetadata", "(", ")", ";", "</s>"]
["<s>", "@", "JacksonXmlElementWrapper", "(", "useWrapping", "=", "false", ")", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "List", "<", "InstanceInfo", ">", "getInstances", "(", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "Void", ">", "register", "(", "InstanceInfo", "info", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "Void", ">", "cancel", "(", "String", "appName", ",", "String", "id", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "InstanceInfo", ">", "sendHeartBeat", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceStatus", "overriddenStatus", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "Void", ">", "statusUpdate", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "InstanceInfo", "info", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "Void", ">", "deleteStatusOverride", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "Applications", ">", "getApplications", "(", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "Applications", ">", "getDelta", "(", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "InstanceInfo", ">", "getInstance", "(", "String", "appName", ",", "String", "id", ")", ";", "</s>"]
["<s>", "void", "shutdown", "(", ")", ";", "</s>"]
["<s>", "public", "HttpResponse", "(", "int", "statusCode", ")", "{", "this", "(", "statusCode", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "HttpResponse", "(", "int", "statusCode", ",", "T", "entity", ")", "{", "this", ".", "statusCode", "=", "statusCode", ";", "this", ".", "entity", "=", "entity", ";", "}", "</s>"]
["<s>", "public", "int", "getStatusCode", "(", ")", "{", "return", "statusCode", ";", "}", "</s>"]
["<s>", "public", "T", "getEntity", "(", ")", "{", "return", "entity", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "HttpResponse", "<", "T", ">", "responseWith", "(", "int", "status", ")", "{", "return", "new", "HttpResponse", "<", ">", "(", "status", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "HttpResponse", "<", "T", ">", "responseWith", "(", "int", "status", ",", "T", "entity", ")", "{", "return", "new", "HttpResponse", "<", ">", "(", "status", ",", "entity", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", "+", "isDirty", "+", "\"", "<STR_LIT>", "\"", "+", "instances", "+", "\"", "<STR_LIT>", "\"", "+", "shuffledInstances", "+", "\"", "<STR_LIT>", "\"", "+", "instancesMap", "+", "\"", "<STR_LIT:]>", "\"", ";", "}", "</s>"]
["<s>", "public", "Application", "(", ")", "{", "instances", "=", "new", "LinkedHashSet", "<", "InstanceInfo", ">", "(", ")", ";", "instancesMap", "=", "new", "ConcurrentHashMap", "<", "String", ",", "InstanceInfo", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Application", "(", "String", "name", ")", "{", "this", ".", "name", "=", "StringCache", ".", "intern", "(", "name", ")", ";", "instancesMap", "=", "new", "ConcurrentHashMap", "<", "String", ",", "InstanceInfo", ">", "(", ")", ";", "instances", "=", "new", "LinkedHashSet", "<", "InstanceInfo", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "Application", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "name", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "List", "<", "InstanceInfo", ">", "instances", ")", "{", "this", "(", "name", ")", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "instances", ")", "{", "addInstance", "(", "instanceInfo", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "addInstance", "(", "InstanceInfo", "i", ")", "{", "instancesMap", ".", "put", "(", "i", ".", "getId", "(", ")", ",", "i", ")", ";", "synchronized", "(", "instances", ")", "{", "instances", ".", "remove", "(", "i", ")", ";", "instances", ".", "add", "(", "i", ")", ";", "isDirty", "=", "true", ";", "}", "}", "</s>"]
["<s>", "public", "void", "removeInstance", "(", "InstanceInfo", "i", ")", "{", "removeInstance", "(", "i", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "List", "<", "InstanceInfo", ">", "getInstances", "(", ")", "{", "if", "(", "this", ".", "shuffledInstances", ".", "get", "(", ")", "=", "=", "null", ")", "{", "return", "this", ".", "getInstancesAsIsFromEureka", "(", ")", ";", "}", "else", "{", "return", "this", ".", "shuffledInstances", ".", "get", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "List", "<", "InstanceInfo", ">", "getInstancesAsIsFromEureka", "(", ")", "{", "return", "new", "ArrayList", "<", "InstanceInfo", ">", "(", "this", ".", "instances", ")", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getByInstanceId", "(", "String", "id", ")", "{", "return", "instancesMap", ".", "get", "(", "id", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "public", "void", "setName", "(", "String", "name", ")", "{", "this", ".", "name", "=", "StringCache", ".", "intern", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "void", "shuffleAndStoreInstances", "(", "boolean", "filterUpInstances", ")", "{", "_shuffleAndStoreInstances", "(", "filterUpInstances", ",", "false", ",", "null", ",", "null", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "void", "shuffleAndStoreInstances", "(", "Map", "<", "String", ",", "Applications", ">", "remoteRegionsRegistry", ",", "EurekaClientConfig", "clientConfig", ",", "InstanceRegionChecker", "instanceRegionChecker", ")", "{", "_shuffleAndStoreInstances", "(", "clientConfig", ".", "shouldFilterOnlyUpInstances", "(", ")", ",", "true", ",", "remoteRegionsRegistry", ",", "clientConfig", ",", "instanceRegionChecker", ")", ";", "}", "</s>"]
["<s>", "private", "void", "_shuffleAndStoreInstances", "(", "boolean", "filterUpInstances", ",", "boolean", "indexByRemoteRegions", ",", "@", "Nullable", "Map", "<", "String", ",", "Applications", ">", "remoteRegionsRegistry", ",", "@", "Nullable", "EurekaClientConfig", "clientConfig", ",", "@", "Nullable", "InstanceRegionChecker", "instanceRegionChecker", ")", "{", "List", "<", "InstanceInfo", ">", "instanceInfoList", ";", "synchronized", "(", "instances", ")", "{", "instanceInfoList", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", "instances", ")", ";", "}", "if", "(", "indexByRemoteRegions", "|", "|", "filterUpInstances", ")", "{", "Iterator", "<", "InstanceInfo", ">", "it", "=", "instanceInfoList", ".", "iterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "InstanceInfo", "instanceInfo", "=", "it", ".", "next", "(", ")", ";", "if", "(", "filterUpInstances", "&", "&", "!", "InstanceStatus", ".", "UP", ".", "equals", "(", "instanceInfo", ".", "getStatus", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "else", "if", "(", "indexByRemoteRegions", "&", "&", "null", "!", "=", "instanceRegionChecker", "&", "&", "null", "!", "=", "clientConfig", "&", "&", "null", "!", "=", "remoteRegionsRegistry", ")", "{", "String", "instanceRegion", "=", "instanceRegionChecker", ".", "getInstanceRegion", "(", "instanceInfo", ")", ";", "if", "(", "!", "instanceRegionChecker", ".", "isLocalRegion", "(", "instanceRegion", ")", ")", "{", "Applications", "appsForRemoteRegion", "=", "remoteRegionsRegistry", ".", "get", "(", "instanceRegion", ")", ";", "if", "(", "null", "=", "=", "appsForRemoteRegion", ")", "{", "appsForRemoteRegion", "=", "new", "Applications", "(", ")", ";", "remoteRegionsRegistry", ".", "put", "(", "instanceRegion", ",", "appsForRemoteRegion", ")", ";", "}", "Application", "remoteApp", "=", "appsForRemoteRegion", ".", "getRegisteredApplications", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "if", "(", "null", "=", "=", "remoteApp", ")", "{", "remoteApp", "=", "new", "Application", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "appsForRemoteRegion", ".", "addApplication", "(", "remoteApp", ")", ";", "}", "remoteApp", ".", "addInstance", "(", "instanceInfo", ")", ";", "this", ".", "removeInstance", "(", "instanceInfo", ",", "false", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "}", "Collections", ".", "shuffle", "(", "instanceInfoList", ")", ";", "this", ".", "shuffledInstances", ".", "set", "(", "instanceInfoList", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removeInstance", "(", "InstanceInfo", "i", ",", "boolean", "markAsDirty", ")", "{", "instancesMap", ".", "remove", "(", "i", ".", "getId", "(", ")", ")", ";", "synchronized", "(", "instances", ")", "{", "instances", ".", "remove", "(", "i", ")", ";", "if", "(", "markAsDirty", ")", "{", "isDirty", "=", "true", ";", "}", "}", "}", "</s>"]
["<s>", "public", "Applications", "(", ")", "{", "this", ".", "applications", "=", "new", "ConcurrentLinkedQueue", "<", "Application", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "Applications", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "appsHashCode", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Long", "versionDelta", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "List", "<", "Application", ">", "registeredApplications", ")", "{", "this", ".", "applications", "=", "new", "ConcurrentLinkedQueue", "<", "Application", ">", "(", ")", ";", "for", "(", "Application", "app", ":", "registeredApplications", ")", "{", "this", ".", "addApplication", "(", "app", ")", ";", "}", "this", ".", "appsHashCode", "=", "appsHashCode", ";", "this", ".", "versionDelta", "=", "versionDelta", ";", "}", "</s>"]
["<s>", "public", "Applications", "(", "List", "<", "Application", ">", "apps", ")", "{", "this", ".", "applications", "=", "new", "ConcurrentLinkedQueue", "<", "Application", ">", "(", ")", ";", "this", ".", "applications", ".", "addAll", "(", "apps", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addApplication", "(", "Application", "app", ")", "{", "appNameApplicationMap", ".", "put", "(", "app", ".", "getName", "(", ")", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ",", "app", ")", ";", "addInstancesToVIPMaps", "(", "app", ")", ";", "applications", ".", "add", "(", "app", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "List", "<", "Application", ">", "getRegisteredApplications", "(", ")", "{", "List", "<", "Application", ">", "list", "=", "new", "ArrayList", "<", "Application", ">", "(", ")", ";", "list", ".", "addAll", "(", "this", ".", "applications", ")", ";", "return", "list", ";", "}", "</s>"]
["<s>", "public", "Application", "getRegisteredApplications", "(", "String", "appName", ")", "{", "return", "appNameApplicationMap", ".", "get", "(", "appName", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "InstanceInfo", ">", "getInstancesByVirtualHostName", "(", "String", "virtualHostName", ")", "{", "AtomicReference", "<", "List", "<", "InstanceInfo", ">", ">", "ref", "=", "this", ".", "shuffleVirtualHostNameMap", ".", "get", "(", "virtualHostName", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ")", ";", "if", "(", "ref", "=", "=", "null", "|", "|", "ref", ".", "get", "(", ")", "=", "=", "null", ")", "{", "return", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "}", "else", "{", "return", "ref", ".", "get", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "List", "<", "InstanceInfo", ">", "getInstancesBySecureVirtualHostName", "(", "String", "secureVirtualHostName", ")", "{", "AtomicReference", "<", "List", "<", "InstanceInfo", ">", ">", "ref", "=", "this", ".", "shuffledSecureVirtualHostNameMap", ".", "get", "(", "secureVirtualHostName", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ")", ";", "if", "(", "ref", "=", "=", "null", "|", "|", "ref", ".", "get", "(", ")", "=", "=", "null", ")", "{", "return", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "}", "else", "{", "return", "ref", ".", "get", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "void", "setVersion", "(", "Long", "version", ")", "{", "this", ".", "versionDelta", "=", "version", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "JsonIgnore", "public", "Long", "getVersion", "(", ")", "{", "return", "this", ".", "versionDelta", ";", "}", "</s>"]
["<s>", "public", "void", "setAppsHashCode", "(", "String", "hashCode", ")", "{", "this", ".", "appsHashCode", "=", "hashCode", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "String", "getAppsHashCode", "(", ")", "{", "return", "this", ".", "appsHashCode", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "String", "getReconcileHashCode", "(", ")", "{", "TreeMap", "<", "String", ",", "AtomicInteger", ">", "instanceCountMap", "=", "new", "TreeMap", "<", "String", ",", "AtomicInteger", ">", "(", ")", ";", "populateInstanceCountMap", "(", "instanceCountMap", ")", ";", "return", "getReconcileHashCode", "(", "instanceCountMap", ")", ";", "}", "</s>"]
["<s>", "public", "void", "populateInstanceCountMap", "(", "TreeMap", "<", "String", ",", "AtomicInteger", ">", "instanceCountMap", ")", "{", "for", "(", "Application", "app", ":", "this", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "info", ":", "app", ".", "getInstancesAsIsFromEureka", "(", ")", ")", "{", "AtomicInteger", "instanceCount", "=", "instanceCountMap", ".", "get", "(", "info", ".", "getStatus", "(", ")", ".", "name", "(", ")", ")", ";", "if", "(", "instanceCount", "=", "=", "null", ")", "{", "instanceCount", "=", "new", "AtomicInteger", "(", "0", ")", ";", "instanceCountMap", ".", "put", "(", "info", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instanceCount", ")", ";", "}", "instanceCount", ".", "incrementAndGet", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "static", "String", "getReconcileHashCode", "(", "TreeMap", "<", "String", ",", "AtomicInteger", ">", "instanceCountMap", ")", "{", "String", "reconcileHashCode", "=", "\"", "\"", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "AtomicInteger", ">", "mapEntry", ":", "instanceCountMap", ".", "entrySet", "(", ")", ")", "{", "reconcileHashCode", "=", "reconcileHashCode", "+", "mapEntry", ".", "getKey", "(", ")", "+", "STATUS_DELIMITER", "+", "mapEntry", ".", "getValue", "(", ")", ".", "get", "(", ")", "+", "STATUS_DELIMITER", ";", "}", "return", "reconcileHashCode", ";", "}", "</s>"]
["<s>", "public", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "getReconcileMapDiff", "(", "Applications", "apps", ")", "{", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "diffMap", "=", "new", "TreeMap", "<", "String", ",", "List", "<", "String", ">", ">", "(", ")", ";", "Set", "<", "Pair", ">", "allInstanceAppInstanceIds", "=", "new", "HashSet", "<", "Pair", ">", "(", ")", ";", "for", "(", "Application", "otherApp", ":", "apps", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "thisApp", "=", "this", ".", "getRegisteredApplications", "(", "otherApp", ".", "getName", "(", ")", ")", ";", "if", "(", "thisApp", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "otherApp", ".", "getName", "(", ")", ")", ";", "continue", ";", "}", "for", "(", "InstanceInfo", "instanceInfo", ":", "thisApp", ".", "getInstancesAsIsFromEureka", "(", ")", ")", "{", "allInstanceAppInstanceIds", ".", "add", "(", "new", "Pair", "(", "thisApp", ".", "getName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ")", ")", ";", "}", "for", "(", "InstanceInfo", "otherInstanceInfo", ":", "otherApp", ".", "getInstancesAsIsFromEureka", "(", ")", ")", "{", "InstanceInfo", "thisInstanceInfo", "=", "thisApp", ".", "getByInstanceId", "(", "otherInstanceInfo", ".", "getId", "(", ")", ")", ";", "if", "(", "thisInstanceInfo", "=", "=", "null", ")", "{", "List", "<", "String", ">", "diffList", "=", "diffMap", ".", "get", "(", "ActionType", ".", "DELETED", ".", "name", "(", ")", ")", ";", "if", "(", "diffList", "=", "=", "null", ")", "{", "diffList", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "diffMap", ".", "put", "(", "ActionType", ".", "DELETED", ".", "name", "(", ")", ",", "diffList", ")", ";", "}", "diffList", ".", "add", "(", "otherInstanceInfo", ".", "getId", "(", ")", ")", ";", "}", "else", "if", "(", "!", "thisInstanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ".", "equalsIgnoreCase", "(", "otherInstanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ")", ")", "{", "List", "<", "String", ">", "diffList", "=", "diffMap", ".", "get", "(", "ActionType", ".", "MODIFIED", ".", "name", "(", ")", ")", ";", "if", "(", "diffList", "=", "=", "null", ")", "{", "diffList", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "diffMap", ".", "put", "(", "ActionType", ".", "MODIFIED", ".", "name", "(", ")", ",", "diffList", ")", ";", "}", "diffList", ".", "add", "(", "thisInstanceInfo", ".", "getId", "(", ")", "+", "APP_INSTANCEID_DELIMITER", "+", "thisInstanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", "+", "APP_INSTANCEID_DELIMITER", "+", "otherInstanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ")", ";", "}", "allInstanceAppInstanceIds", ".", "remove", "(", "new", "Pair", "(", "otherApp", ".", "getName", "(", ")", ",", "otherInstanceInfo", ".", "getId", "(", ")", ")", ")", ";", "}", "}", "for", "(", "Pair", "pair", ":", "allInstanceAppInstanceIds", ")", "{", "Application", "app", "=", "new", "Application", "(", "pair", ".", "getItem1", "(", ")", ")", ";", "InstanceInfo", "thisInstanceInfo", "=", "app", ".", "getByInstanceId", "(", "pair", ".", "getItem2", "(", ")", ")", ";", "if", "(", "thisInstanceInfo", "!", "=", "null", ")", "{", "List", "<", "String", ">", "diffList", "=", "diffMap", ".", "get", "(", "ActionType", ".", "ADDED", ".", "name", "(", ")", ")", ";", "if", "(", "diffList", "=", "=", "null", ")", "{", "diffList", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "diffMap", ".", "put", "(", "ActionType", ".", "ADDED", ".", "name", "(", ")", ",", "diffList", ")", ";", "}", "diffList", ".", "add", "(", "thisInstanceInfo", ".", "getId", "(", ")", ")", ";", "}", "}", "return", "diffMap", ";", "}", "</s>"]
["<s>", "public", "Pair", "(", "String", "item1", ",", "String", "item2", ")", "{", "super", "(", ")", ";", "this", ".", "item1", "=", "item1", ";", "this", ".", "item2", "=", "item2", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "final", "int", "prime", "=", "<NUM_LIT:31>", ";", "int", "result", "=", "1", ";", "result", "=", "prime", "*", "result", "+", "(", "(", "item1", "=", "=", "null", ")", "?", "0", ":", "item1", ".", "hashCode", "(", ")", ")", ";", "result", "=", "prime", "*", "result", "+", "(", "(", "item2", "=", "=", "null", ")", "?", "0", ":", "item2", ".", "hashCode", "(", ")", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "this", "=", "=", "obj", ")", "{", "return", "true", ";", "}", "if", "(", "obj", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "getClass", "(", ")", "!", "=", "obj", ".", "getClass", "(", ")", ")", "{", "return", "false", ";", "}", "Pair", "other", "=", "(", "Pair", ")", "obj", ";", "if", "(", "item1", "=", "=", "null", ")", "{", "if", "(", "other", ".", "item1", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "!", "item1", ".", "equals", "(", "other", ".", "item1", ")", ")", "{", "return", "false", ";", "}", "if", "(", "item2", "=", "=", "null", ")", "{", "if", "(", "other", ".", "item2", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "!", "item2", ".", "equals", "(", "other", ".", "item2", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "String", "getItem1", "(", ")", "{", "return", "item1", ";", "}", "</s>"]
["<s>", "public", "String", "getItem2", "(", ")", "{", "return", "item2", ";", "}", "</s>"]
["<s>", "public", "void", "shuffleInstances", "(", "boolean", "filterUpInstances", ")", "{", "shuffleInstances", "(", "filterUpInstances", ",", "false", ",", "null", ",", "null", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "void", "shuffleAndIndexInstances", "(", "Map", "<", "String", ",", "Applications", ">", "remoteRegionsRegistry", ",", "EurekaClientConfig", "clientConfig", ",", "InstanceRegionChecker", "instanceRegionChecker", ")", "{", "shuffleInstances", "(", "clientConfig", ".", "shouldFilterOnlyUpInstances", "(", ")", ",", "true", ",", "remoteRegionsRegistry", ",", "clientConfig", ",", "instanceRegionChecker", ")", ";", "}", "</s>"]
["<s>", "private", "void", "shuffleInstances", "(", "boolean", "filterUpInstances", ",", "boolean", "indexByRemoteRegions", ",", "@", "Nullable", "Map", "<", "String", ",", "Applications", ">", "remoteRegionsRegistry", ",", "@", "Nullable", "EurekaClientConfig", "clientConfig", ",", "@", "Nullable", "InstanceRegionChecker", "instanceRegionChecker", ")", "{", "this", ".", "virtualHostNameAppMap", ".", "clear", "(", ")", ";", "this", ".", "secureVirtualHostNameAppMap", ".", "clear", "(", ")", ";", "for", "(", "Application", "application", ":", "appNameApplicationMap", ".", "values", "(", ")", ")", "{", "if", "(", "indexByRemoteRegions", ")", "{", "application", ".", "shuffleAndStoreInstances", "(", "remoteRegionsRegistry", ",", "clientConfig", ",", "instanceRegionChecker", ")", ";", "}", "else", "{", "application", ".", "shuffleAndStoreInstances", "(", "filterUpInstances", ")", ";", "}", "this", ".", "addInstancesToVIPMaps", "(", "application", ")", ";", "}", "shuffleAndFilterInstances", "(", "this", ".", "virtualHostNameAppMap", ",", "this", ".", "shuffleVirtualHostNameMap", ",", "virtualHostNameIndexMap", ",", "filterUpInstances", ")", ";", "shuffleAndFilterInstances", "(", "this", ".", "secureVirtualHostNameAppMap", ",", "this", ".", "shuffledSecureVirtualHostNameMap", ",", "secureVirtualHostNameIndexMap", ",", "filterUpInstances", ")", ";", "}", "</s>"]
["<s>", "public", "AtomicLong", "getNextIndex", "(", "String", "virtualHostname", ",", "boolean", "secure", ")", "{", "if", "(", "secure", ")", "{", "return", "this", ".", "secureVirtualHostNameIndexMap", ".", "get", "(", "virtualHostname", ")", ";", "}", "else", "{", "return", "this", ".", "virtualHostNameIndexMap", ".", "get", "(", "virtualHostname", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "shuffleAndFilterInstances", "(", "Map", "<", "String", ",", "AbstractQueue", "<", "InstanceInfo", ">", ">", "srcMap", ",", "Map", "<", "String", ",", "AtomicReference", "<", "List", "<", "InstanceInfo", ">", ">", ">", "destMap", ",", "Map", "<", "String", ",", "AtomicLong", ">", "vipIndexMap", ",", "boolean", "filterUpInstances", ")", "{", "for", "(", "Map", ".", "Entry", "<", "String", ",", "AbstractQueue", "<", "InstanceInfo", ">", ">", "entries", ":", "srcMap", ".", "entrySet", "(", ")", ")", "{", "AbstractQueue", "<", "InstanceInfo", ">", "instanceInfoQueue", "=", "entries", ".", "getValue", "(", ")", ";", "List", "<", "InstanceInfo", ">", "l", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", "instanceInfoQueue", ")", ";", "if", "(", "filterUpInstances", ")", "{", "Iterator", "<", "InstanceInfo", ">", "it", "=", "l", ".", "iterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "InstanceInfo", "instanceInfo", "=", "it", ".", "next", "(", ")", ";", "if", "(", "!", "InstanceStatus", ".", "UP", ".", "equals", "(", "instanceInfo", ".", "getStatus", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "Collections", ".", "shuffle", "(", "l", ")", ";", "AtomicReference", "<", "List", "<", "InstanceInfo", ">", ">", "instanceInfoList", "=", "destMap", ".", "get", "(", "entries", ".", "getKey", "(", ")", ")", ";", "if", "(", "instanceInfoList", "=", "=", "null", ")", "{", "instanceInfoList", "=", "new", "AtomicReference", "<", "List", "<", "InstanceInfo", ">", ">", "(", "l", ")", ";", "destMap", ".", "put", "(", "entries", ".", "getKey", "(", ")", ",", "instanceInfoList", ")", ";", "}", "instanceInfoList", ".", "set", "(", "l", ")", ";", "vipIndexMap", ".", "put", "(", "entries", ".", "getKey", "(", ")", ",", "new", "AtomicLong", "(", "0", ")", ")", ";", "}", "Set", "<", "String", ">", "srcVips", "=", "srcMap", ".", "keySet", "(", ")", ";", "Set", "<", "String", ">", "destVips", "=", "destMap", ".", "keySet", "(", ")", ";", "destVips", ".", "retainAll", "(", "srcVips", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addInstanceToMap", "(", "InstanceInfo", "info", ",", "String", "vipAddresses", ",", "Map", "<", "String", ",", "AbstractQueue", "<", "InstanceInfo", ">", ">", "vipMap", ")", "{", "if", "(", "vipAddresses", "!", "=", "null", ")", "{", "String", "[", "]", "vipAddressArray", "=", "vipAddresses", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "for", "(", "String", "vipAddress", ":", "vipAddressArray", ")", "{", "String", "vipName", "=", "vipAddress", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ";", "AbstractQueue", "<", "InstanceInfo", ">", "instanceInfoList", "=", "vipMap", ".", "get", "(", "vipName", ")", ";", "if", "(", "instanceInfoList", "=", "=", "null", ")", "{", "instanceInfoList", "=", "new", "ConcurrentLinkedQueue", "<", "InstanceInfo", ">", "(", ")", ";", "vipMap", ".", "put", "(", "vipName", ",", "instanceInfoList", ")", ";", "}", "instanceInfoList", ".", "add", "(", "info", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "addInstancesToVIPMaps", "(", "Application", "app", ")", "{", "for", "(", "InstanceInfo", "info", ":", "app", ".", "getInstances", "(", ")", ")", "{", "String", "vipAddresses", "=", "info", ".", "getVIPAddress", "(", ")", ";", "String", "secureVipAddresses", "=", "info", ".", "getSecureVipAddress", "(", ")", ";", "if", "(", "(", "vipAddresses", "=", "=", "null", ")", "&", "&", "(", "secureVipAddresses", "=", "=", "null", ")", ")", "{", "continue", ";", "}", "addInstanceToMap", "(", "info", ",", "vipAddresses", ",", "virtualHostNameAppMap", ")", ";", "addInstanceToMap", "(", "info", ",", "secureVipAddresses", ",", "secureVirtualHostNameAppMap", ")", ";", "}", "}", "</s>"]
["<s>", "public", "E1", "first", "(", ")", "{", "return", "first", ";", "}", "</s>"]
["<s>", "public", "void", "setFirst", "(", "E1", "first", ")", "{", "this", ".", "first", "=", "first", ";", "}", "</s>"]
["<s>", "public", "E2", "second", "(", ")", "{", "return", "second", ";", "}", "</s>"]
["<s>", "public", "void", "setSecond", "(", "E2", "second", ")", "{", "this", ".", "second", "=", "second", ";", "}", "</s>"]
["<s>", "public", "Pair", "(", "E1", "first", ",", "E2", "second", ")", "{", "this", ".", "first", "=", "first", ";", "this", ".", "second", "=", "second", ";", "}", "</s>"]
["<s>", "public", "MonitoredConnectionManager", "(", "String", "name", ")", "{", "super", "(", ")", ";", "initMonitors", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "MonitoredConnectionManager", "(", "String", "name", ",", "SchemeRegistry", "schreg", ",", "long", "connTTL", ",", "TimeUnit", "connTTLTimeUnit", ")", "{", "super", "(", "schreg", ",", "connTTL", ",", "connTTLTimeUnit", ")", ";", "initMonitors", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "MonitoredConnectionManager", "(", "String", "name", ",", "SchemeRegistry", "schreg", ")", "{", "super", "(", "schreg", ")", ";", "initMonitors", "(", "name", ")", ";", "}", "</s>"]
["<s>", "void", "initMonitors", "(", "String", "name", ")", "{", "if", "(", "this", ".", "pool", "instanceof", "NamedConnectionPool", ")", "{", "(", "(", "NamedConnectionPool", ")", "this", ".", "pool", ")", ".", "initMonitors", "(", "name", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "@", "Deprecated", "protected", "AbstractConnPool", "createConnectionPool", "(", "HttpParams", "params", ")", "{", "return", "new", "NamedConnectionPool", "(", "connOperator", ",", "params", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "ConnPoolByRoute", "createConnectionPool", "(", "long", "connTTL", ",", "TimeUnit", "connTTLTimeUnit", ")", "{", "return", "new", "NamedConnectionPool", "(", "connOperator", ",", "connPerRoute", ",", "<NUM_LIT:20>", ",", "connTTL", ",", "connTTLTimeUnit", ")", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "ConnPoolByRoute", "getConnectionPool", "(", ")", "{", "return", "this", ".", "pool", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ClientConnectionRequest", "requestConnection", "(", "HttpRoute", "route", ",", "Object", "state", ")", "{", "return", "super", ".", "requestConnection", "(", "route", ",", "state", ")", ";", "}", "</s>"]
["<s>", "public", "NamedConnectionPool", "(", "String", "name", ",", "ClientConnectionOperator", "operator", ",", "ConnPerRoute", "connPerRoute", ",", "int", "maxTotalConnections", ",", "long", "connTTL", ",", "TimeUnit", "connTTLTimeUnit", ")", "{", "super", "(", "operator", ",", "connPerRoute", ",", "maxTotalConnections", ",", "connTTL", ",", "connTTLTimeUnit", ")", ";", "initMonitors", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "NamedConnectionPool", "(", "String", "name", ",", "ClientConnectionOperator", "operator", ",", "ConnPerRoute", "connPerRoute", ",", "int", "maxTotalConnections", ")", "{", "super", "(", "operator", ",", "connPerRoute", ",", "maxTotalConnections", ")", ";", "initMonitors", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "NamedConnectionPool", "(", "String", "name", ",", "ClientConnectionOperator", "operator", ",", "HttpParams", "params", ")", "{", "super", "(", "operator", ",", "params", ")", ";", "initMonitors", "(", "name", ")", ";", "}", "</s>"]
["<s>", "NamedConnectionPool", "(", "ClientConnectionOperator", "operator", ",", "ConnPerRoute", "connPerRoute", ",", "int", "maxTotalConnections", ",", "long", "connTTL", ",", "TimeUnit", "connTTLTimeUnit", ")", "{", "super", "(", "operator", ",", "connPerRoute", ",", "maxTotalConnections", ",", "connTTL", ",", "connTTLTimeUnit", ")", ";", "}", "</s>"]
["<s>", "NamedConnectionPool", "(", "ClientConnectionOperator", "operator", ",", "ConnPerRoute", "connPerRoute", ",", "int", "maxTotalConnections", ")", "{", "super", "(", "operator", ",", "connPerRoute", ",", "maxTotalConnections", ")", ";", "}", "</s>"]
["<s>", "NamedConnectionPool", "(", "ClientConnectionOperator", "operator", ",", "HttpParams", "params", ")", "{", "super", "(", "operator", ",", "params", ")", ";", "}", "</s>"]
["<s>", "void", "initMonitors", "(", "String", "name", ")", "{", "Preconditions", ".", "checkNotNull", "(", "name", ")", ";", "freeEntryCounter", "=", "Monitors", ".", "newCounter", "(", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "createEntryCounter", "=", "Monitors", ".", "newCounter", "(", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "requestCounter", "=", "Monitors", ".", "newCounter", "(", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "releaseCounter", "=", "Monitors", ".", "newCounter", "(", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "deleteCounter", "=", "Monitors", ".", "newCounter", "(", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "requestTimer", "=", "Monitors", ".", "newTimer", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "creationTimer", "=", "Monitors", ".", "newTimer", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "this", ".", "name", "=", "name", ";", "Monitors", ".", "registerObject", "(", "name", ",", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PoolEntryRequest", "requestPoolEntry", "(", "HttpRoute", "route", ",", "Object", "state", ")", "{", "requestCounter", ".", "increment", "(", ")", ";", "return", "super", ".", "requestPoolEntry", "(", "route", ",", "state", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "BasicPoolEntry", "getFreeEntry", "(", "RouteSpecificPool", "rospl", ",", "Object", "state", ")", "{", "BasicPoolEntry", "entry", "=", "super", ".", "getFreeEntry", "(", "rospl", ",", "state", ")", ";", "if", "(", "entry", "!", "=", "null", ")", "{", "freeEntryCounter", ".", "increment", "(", ")", ";", "}", "return", "entry", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "BasicPoolEntry", "createEntry", "(", "RouteSpecificPool", "rospl", ",", "ClientConnectionOperator", "op", ")", "{", "createEntryCounter", ".", "increment", "(", ")", ";", "Stopwatch", "stopWatch", "=", "creationTimer", ".", "start", "(", ")", ";", "try", "{", "return", "super", ".", "createEntry", "(", "rospl", ",", "op", ")", ";", "}", "finally", "{", "stopWatch", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "BasicPoolEntry", "getEntryBlocking", "(", "HttpRoute", "route", ",", "Object", "state", ",", "long", "timeout", ",", "TimeUnit", "tunit", ",", "WaitingThreadAborter", "aborter", ")", "throws", "ConnectionPoolTimeoutException", ",", "InterruptedException", "{", "Stopwatch", "stopWatch", "=", "requestTimer", ".", "start", "(", ")", ";", "try", "{", "return", "super", ".", "getEntryBlocking", "(", "route", ",", "state", ",", "timeout", ",", "tunit", ",", "aborter", ")", ";", "}", "finally", "{", "stopWatch", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "freeEntry", "(", "BasicPoolEntry", "entry", ",", "boolean", "reusable", ",", "long", "validDuration", ",", "TimeUnit", "timeUnit", ")", "{", "releaseCounter", ".", "increment", "(", ")", ";", "super", ".", "freeEntry", "(", "entry", ",", "reusable", ",", "validDuration", ",", "timeUnit", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "deleteEntry", "(", "BasicPoolEntry", "entry", ")", "{", "deleteCounter", ".", "increment", "(", ")", ";", "super", ".", "deleteEntry", "(", "entry", ")", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getFreeEntryCount", "(", ")", "{", "return", "freeEntryCounter", ".", "getValue", "(", ")", ".", "longValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getCreatedEntryCount", "(", ")", "{", "return", "createEntryCounter", ".", "getValue", "(", ")", ".", "longValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getRequestsCount", "(", ")", "{", "return", "requestCounter", ".", "getValue", "(", ")", ".", "longValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getReleaseCount", "(", ")", "{", "return", "releaseCounter", ".", "getValue", "(", ")", ".", "longValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "final", "long", "getDeleteCount", "(", ")", "{", "return", "deleteCounter", ".", "getValue", "(", ")", ".", "longValue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "int", "getConnectionCount", "(", ")", "{", "return", "this", ".", "getConnectionsInPool", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "super", ".", "shutdown", "(", ")", ";", "Monitors", ".", "unregisterObject", "(", "name", ",", "this", ")", ";", "}", "</s>"]
["<s>", "Application", "getApplication", "(", "String", "appName", ")", ";", "</s>"]
["<s>", "Applications", "getApplications", "(", ")", ";", "</s>"]
["<s>", "List", "<", "InstanceInfo", ">", "getInstancesById", "(", "String", "id", ")", ";", "</s>"]
["<s>", "InstanceInfo", "getNextServerFromEureka", "(", "String", "virtualHostname", ",", "boolean", "secure", ")", ";", "</s>"]
["<s>", "ApacheHttpClient4", "getClient", "(", ")", ";", "</s>"]
["<s>", "void", "destroyResources", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "Thread", "thread", "=", "new", "Thread", "(", "r", ",", "\"", "<STR_LIT>", "\"", "+", "threadNumber", ".", "incrementAndGet", "(", ")", ")", ";", "thread", ".", "setDaemon", "(", "true", ")", ";", "return", "thread", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientImpl", "(", "int", "connectionTimeout", ",", "int", "readTimeout", ",", "final", "int", "connectionIdleTimeout", ",", "ClientConfig", "clientConfig", ")", "{", "try", "{", "jerseyClientConfig", "=", "clientConfig", ";", "apacheHttpClient", "=", "ApacheHttpClient4", ".", "create", "(", "jerseyClientConfig", ")", ";", "HttpParams", "params", "=", "apacheHttpClient", ".", "getClientHandler", "(", ")", ".", "getHttpClient", "(", ")", ".", "getParams", "(", ")", ";", "HttpConnectionParams", ".", "setConnectionTimeout", "(", "params", ",", "connectionTimeout", ")", ";", "HttpConnectionParams", ".", "setSoTimeout", "(", "params", ",", "readTimeout", ")", ";", "eurekaConnCleaner", ".", "scheduleWithFixedDelay", "(", "new", "ConnectionCleanerTask", "(", "connectionIdleTimeout", ")", ",", "HTTP_CONNECTION_CLEANER_INTERVAL_MS", ",", "HTTP_CONNECTION_CLEANER_INTERVAL_MS", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "ApacheHttpClient4", "getClient", "(", ")", "{", "return", "apacheHttpClient", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "destroyResources", "(", ")", "{", "if", "(", "eurekaConnCleaner", "!", "=", "null", ")", "{", "eurekaConnCleaner", ".", "shutdown", "(", ")", ";", "}", "if", "(", "apacheHttpClient", "!", "=", "null", ")", "{", "apacheHttpClient", ".", "destroy", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withClientName", "(", "String", "clientName", ")", "{", "this", ".", "clientName", "=", "clientName", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withUserAgent", "(", "String", "userAgent", ")", "{", "this", ".", "userAgent", "=", "userAgent", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withConnectionTimeout", "(", "int", "connectionTimeout", ")", "{", "this", ".", "connectionTimeout", "=", "connectionTimeout", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withReadTimeout", "(", "int", "readTimeout", ")", "{", "this", ".", "readTimeout", "=", "readTimeout", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withConnectionIdleTimeout", "(", "int", "connectionIdleTimeout", ")", "{", "this", ".", "connectionIdleTimeout", "=", "connectionIdleTimeout", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withMaxConnectionsPerHost", "(", "int", "maxConnectionsPerHost", ")", "{", "this", ".", "maxConnectionsPerHost", "=", "maxConnectionsPerHost", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withMaxTotalConnections", "(", "int", "maxTotalConnections", ")", "{", "this", ".", "maxTotalConnections", "=", "maxTotalConnections", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withProxy", "(", "String", "proxyHost", ",", "String", "proxyPort", ",", "String", "user", ",", "String", "password", ")", "{", "this", ".", "proxyHost", "=", "proxyHost", ";", "this", ".", "proxyPort", "=", "proxyPort", ";", "this", ".", "proxyUserName", "=", "user", ";", "this", ".", "proxyPassword", "=", "password", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withSystemSSLConfiguration", "(", ")", "{", "this", ".", "systemSSL", "=", "true", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withTrustStoreFile", "(", "String", "trustStoreFileName", ",", "String", "trustStorePassword", ")", "{", "this", ".", "trustStoreFileName", "=", "trustStoreFileName", ";", "this", ".", "trustStorePassword", "=", "trustStorePassword", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withEncoder", "(", "String", "encoderName", ")", "{", "return", "this", ".", "withEncoderWrapper", "(", "CodecWrappers", ".", "getEncoder", "(", "encoderName", ")", ")", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withEncoderWrapper", "(", "EncoderWrapper", "encoderWrapper", ")", "{", "this", ".", "encoderWrapper", "=", "encoderWrapper", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withDecoder", "(", "String", "decoderName", ",", "String", "clientDataAccept", ")", "{", "return", "this", ".", "withDecoderWrapper", "(", "CodecWrappers", ".", "resolveDecoder", "(", "decoderName", ",", "clientDataAccept", ")", ")", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClientBuilder", "withDecoderWrapper", "(", "DecoderWrapper", "decoderWrapper", ")", "{", "this", ".", "decoderWrapper", "=", "decoderWrapper", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "EurekaJerseyClient", "build", "(", ")", "{", "MyDefaultApacheHttpClient4Config", "config", "=", "new", "MyDefaultApacheHttpClient4Config", "(", ")", ";", "try", "{", "return", "new", "EurekaJerseyClientImpl", "(", "connectionTimeout", ",", "readTimeout", ",", "connectionIdleTimeout", ",", "config", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "MyDefaultApacheHttpClient4Config", "(", ")", "{", "MonitoredConnectionManager", "cm", ";", "if", "(", "systemSSL", ")", "{", "cm", "=", "createSystemSslCM", "(", ")", ";", "}", "else", "if", "(", "trustStoreFileName", "!", "=", "null", ")", "{", "cm", "=", "createCustomSslCM", "(", ")", ";", "}", "else", "{", "cm", "=", "new", "MonitoredConnectionManager", "(", "clientName", ")", ";", "}", "if", "(", "proxyHost", "!", "=", "null", ")", "{", "addProxyConfiguration", "(", "cm", ")", ";", "}", "DiscoveryJerseyProvider", "discoveryJerseyProvider", "=", "new", "DiscoveryJerseyProvider", "(", "encoderWrapper", ",", "decoderWrapper", ")", ";", "getSingletons", "(", ")", ".", "add", "(", "discoveryJerseyProvider", ")", ";", "cm", ".", "setDefaultMaxPerRoute", "(", "maxConnectionsPerHost", ")", ";", "cm", ".", "setMaxTotal", "(", "maxTotalConnections", ")", ";", "getProperties", "(", ")", ".", "put", "(", "ApacheHttpClient4Config", ".", "PROPERTY_CONNECTION_MANAGER", ",", "cm", ")", ";", "String", "fullUserAgentName", "=", "(", "userAgent", "=", "=", "null", "?", "clientName", ":", "userAgent", ")", "+", "\"", "<STR_LIT>", "\"", "+", "buildVersion", "(", ")", ";", "getProperties", "(", ")", ".", "put", "(", "CoreProtocolPNames", ".", "USER_AGENT", ",", "fullUserAgentName", ")", ";", "getProperties", "(", ")", ".", "put", "(", "PROPERTY_FOLLOW_REDIRECTS", ",", "Boolean", ".", "FALSE", ")", ";", "getProperties", "(", ")", ".", "put", "(", "ClientPNames", ".", "HANDLE_REDIRECTS", ",", "Boolean", ".", "FALSE", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addProxyConfiguration", "(", "MonitoredConnectionManager", "cm", ")", "{", "if", "(", "proxyUserName", "!", "=", "null", "&", "&", "proxyPassword", "!", "=", "null", ")", "{", "getProperties", "(", ")", ".", "put", "(", "ApacheHttpClient4Config", ".", "PROPERTY_PROXY_USERNAME", ",", "proxyUserName", ")", ";", "getProperties", "(", ")", ".", "put", "(", "ApacheHttpClient4Config", ".", "PROPERTY_PROXY_PASSWORD", ",", "proxyPassword", ")", ";", "}", "else", "{", "getProperties", "(", ")", ".", "put", "(", "ApacheHttpClient4Config", ".", "PROPERTY_PROXY_USERNAME", ",", "\"", "<STR_LIT>", "\"", ")", ";", "getProperties", "(", ")", ".", "put", "(", "ApacheHttpClient4Config", ".", "PROPERTY_PROXY_PASSWORD", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "getProperties", "(", ")", ".", "put", "(", "DefaultApacheHttpClient4Config", ".", "PROPERTY_PROXY_URI", ",", "\"", "<STR_LIT>", "\"", "+", "proxyHost", "+", "\"", "<STR_LIT::>", "\"", "+", "proxyPort", ")", ";", "}", "</s>"]
["<s>", "private", "MonitoredConnectionManager", "createSystemSslCM", "(", ")", "{", "MonitoredConnectionManager", "cm", ";", "SSLSocketFactory", "sslSocketFactory", "=", "SSLSocketFactory", ".", "getSystemSocketFactory", "(", ")", ";", "SchemeRegistry", "sslSchemeRegistry", "=", "new", "SchemeRegistry", "(", ")", ";", "sslSchemeRegistry", ".", "register", "(", "new", "Scheme", "(", "PROTOCOL", ",", "HTTPS_PORT", ",", "sslSocketFactory", ")", ")", ";", "cm", "=", "new", "MonitoredConnectionManager", "(", "clientName", ",", "sslSchemeRegistry", ")", ";", "return", "cm", ";", "}", "</s>"]
["<s>", "private", "MonitoredConnectionManager", "createCustomSslCM", "(", ")", "{", "FileInputStream", "fin", "=", "null", ";", "try", "{", "SSLContext", "sslContext", "=", "SSLContext", ".", "getInstance", "(", "PROTOCOL_SCHEME", ")", ";", "KeyStore", "sslKeyStore", "=", "KeyStore", ".", "getInstance", "(", "KEYSTORE_TYPE", ")", ";", "fin", "=", "new", "FileInputStream", "(", "trustStoreFileName", ")", ";", "sslKeyStore", ".", "load", "(", "fin", ",", "trustStorePassword", ".", "toCharArray", "(", ")", ")", ";", "TrustManagerFactory", "factory", "=", "TrustManagerFactory", ".", "getInstance", "(", "TrustManagerFactory", ".", "getDefaultAlgorithm", "(", ")", ")", ";", "factory", ".", "init", "(", "sslKeyStore", ")", ";", "TrustManager", "[", "]", "trustManagers", "=", "factory", ".", "getTrustManagers", "(", ")", ";", "sslContext", ".", "init", "(", "null", ",", "trustManagers", ",", "null", ")", ";", "SSLSocketFactory", "sslSocketFactory", "=", "new", "SSLSocketFactory", "(", "sslContext", ")", ";", "sslSocketFactory", ".", "setHostnameVerifier", "(", "SSLSocketFactory", ".", "ALLOW_ALL_HOSTNAME_VERIFIER", ")", ";", "SchemeRegistry", "sslSchemeRegistry", "=", "new", "SchemeRegistry", "(", ")", ";", "sslSchemeRegistry", ".", "register", "(", "new", "Scheme", "(", "PROTOCOL", ",", "HTTPS_PORT", ",", "sslSocketFactory", ")", ")", ";", "return", "new", "MonitoredConnectionManager", "(", "clientName", ",", "sslSchemeRegistry", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "finally", "{", "if", "(", "fin", "!", "=", "null", ")", "{", "try", "{", "fin", ".", "close", "(", ")", ";", "}", "catch", "(", "IOException", "ignore", ")", "{", "}", "}", "}", "}", "</s>"]
["<s>", "private", "ConnectionCleanerTask", "(", "int", "connectionIdleTimeout", ")", "{", "this", ".", "connectionIdleTimeout", "=", "connectionIdleTimeout", ";", "MonitorConfig", ".", "Builder", "monitorConfigBuilder", "=", "MonitorConfig", ".", "builder", "(", "\"", "<STR_LIT>", "\"", ")", ";", "executionTimeStats", "=", "new", "BasicTimer", "(", "monitorConfigBuilder", ".", "build", "(", ")", ")", ";", "cleanupFailed", "=", "new", "BasicCounter", "(", "MonitorConfig", ".", "builder", "(", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ")", ";", "try", "{", "Monitors", ".", "registerObject", "(", "this", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "s_logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "Stopwatch", "start", "=", "executionTimeStats", ".", "start", "(", ")", ";", "try", "{", "apacheHttpClient", ".", "getClientHandler", "(", ")", ".", "getHttpClient", "(", ")", ".", "getConnectionManager", "(", ")", ".", "closeIdleConnections", "(", "connectionIdleTimeout", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "s_logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "cleanupFailed", ".", "increment", "(", ")", ";", "}", "finally", "{", "if", "(", "null", "!", "=", "start", ")", "{", "start", ".", "stop", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "protected", "JerseyEurekaHttpClient", "(", "String", "serviceUrl", ")", "{", "this", ".", "serviceUrl", "=", "serviceUrl", ";", "}", "</s>"]
["<s>", "protected", "abstract", "Client", "getJerseyClient", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "register", "(", "InstanceInfo", "info", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "info", ".", "getAppName", "(", ")", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "resourceBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "resourceBuilder", ")", ";", "response", "=", "resourceBuilder", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "type", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "post", "(", "ClientResponse", ".", "class", ",", "info", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "info", ".", "getId", "(", ")", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "cancel", "(", "String", "appName", ",", "String", "id", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appName", "+", "<CHAR_LIT:/>", "+", "id", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "resourceBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "resourceBuilder", ")", ";", "response", "=", "resourceBuilder", ".", "delete", "(", "ClientResponse", ".", "class", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "sendHeartBeat", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceStatus", "overriddenStatus", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appName", "+", "<CHAR_LIT:/>", "+", "id", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "WebResource", "webResource", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getStatus", "(", ")", ".", "toString", "(", ")", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getLastDirtyTimestamp", "(", ")", ".", "toString", "(", ")", ")", ";", "if", "(", "overriddenStatus", "!", "=", "null", ")", "{", "webResource", "=", "webResource", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "overriddenStatus", ".", "name", "(", ")", ")", ";", "}", "Builder", "requestBuilder", "=", "webResource", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "statusUpdate", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "InstanceInfo", "info", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appName", "+", "\"", "<STR_LIT:/>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "requestBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "newStatus", ".", "name", "(", ")", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getLastDirtyTimestamp", "(", ")", ".", "toString", "(", ")", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "response", "=", "requestBuilder", ".", "put", "(", "ClientResponse", ".", "class", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "deleteStatusOverride", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appName", "+", "<CHAR_LIT:/>", "+", "id", "+", "\"", "<STR_LIT>", "\"", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "requestBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getLastDirtyTimestamp", "(", ")", ".", "toString", "(", ")", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "response", "=", "requestBuilder", ".", "delete", "(", "ClientResponse", ".", "class", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Applications", ">", "getApplications", "(", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "requestBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "response", "=", "requestBuilder", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "get", "(", "ClientResponse", ".", "class", ")", ";", "Applications", "applications", "=", "null", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", "&", "&", "response", ".", "hasEntity", "(", ")", ")", "{", "applications", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "}", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ",", "applications", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Applications", ">", "getDelta", "(", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT>", "\"", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "requestBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "response", "=", "requestBuilder", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "get", "(", "ClientResponse", ".", "class", ")", ";", "Applications", "applications", "=", "null", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", "&", "&", "response", ".", "hasEntity", "(", ")", ")", "{", "applications", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "}", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ",", "applications", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "getInstance", "(", "String", "appName", ",", "String", "id", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appName", "+", "<CHAR_LIT:/>", "+", "id", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "Builder", "requestBuilder", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "response", "=", "requestBuilder", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "get", "(", "ClientResponse", ".", "class", ")", ";", "InstanceInfo", "infoFromPeer", "=", "null", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", "&", "&", "response", ".", "hasEntity", "(", ")", ")", "{", "infoFromPeer", "=", "response", ".", "getEntity", "(", "InstanceInfo", ".", "class", ")", ";", "}", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ",", "infoFromPeer", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "getJerseyClient", "(", ")", ".", "destroy", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "addExtraHeaders", "(", "Builder", "webResource", ")", "{", "}", "</s>"]
["<s>", "private", "DnsResolver", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "DirContext", "getDirContext", "(", ")", "{", "Hashtable", "<", "String", ",", "String", ">", "env", "=", "new", "Hashtable", "<", "String", ",", "String", ">", "(", ")", ";", "env", ".", "put", "(", "JAVA_NAMING_FACTORY_INITIAL", ",", "DNS_NAMING_FACTORY", ")", ";", "env", ".", "put", "(", "JAVA_NAMING_PROVIDER_URL", ",", "DNS_PROVIDER_URL", ")", ";", "try", "{", "return", "new", "InitialDirContext", "(", "env", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "String", "resolve", "(", "String", "originalHost", ")", "{", "String", "currentHost", "=", "originalHost", ";", "if", "(", "isLocalOrIp", "(", "currentHost", ")", ")", "{", "return", "originalHost", ";", "}", "try", "{", "String", "targetHost", "=", "null", ";", "do", "{", "Attributes", "attrs", "=", "dirContext", ".", "getAttributes", "(", "currentHost", ",", "new", "String", "[", "]", "{", "A_RECORD_TYPE", ",", "CNAME_RECORD_TYPE", "}", ")", ";", "Attribute", "attr", "=", "attrs", ".", "get", "(", "A_RECORD_TYPE", ")", ";", "if", "(", "attr", "!", "=", "null", ")", "{", "targetHost", "=", "attr", ".", "get", "(", ")", ".", "toString", "(", ")", ";", "}", "attr", "=", "attrs", ".", "get", "(", "CNAME_RECORD_TYPE", ")", ";", "if", "(", "attr", "!", "=", "null", ")", "{", "currentHost", "=", "attr", ".", "get", "(", ")", ".", "toString", "(", ")", ";", "}", "else", "{", "targetHost", "=", "currentHost", ";", "}", "}", "while", "(", "targetHost", "=", "=", "null", ")", ";", "return", "targetHost", ";", "}", "catch", "(", "NamingException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "currentHost", "+", "\"", "<STR_LIT>", "\"", "+", "originalHost", ",", "e", ")", ";", "return", "originalHost", ";", "}", "}", "</s>"]
["<s>", "private", "static", "boolean", "isLocalOrIp", "(", "String", "currentHost", ")", "{", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "currentHost", ")", ")", "{", "return", "true", ";", "}", "if", "(", "\"", "<STR_LIT:127.0.0.1>", "\"", ".", "equals", "(", "currentHost", ")", ")", "{", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "static", "Set", "<", "String", ">", "getCNamesFromTxtRecord", "(", "String", "discoveryDnsName", ")", "throws", "NamingException", "{", "Attributes", "attrs", "=", "dirContext", ".", "getAttributes", "(", "discoveryDnsName", ",", "new", "String", "[", "]", "{", "TXT_RECORD_TYPE", "}", ")", ";", "Attribute", "attr", "=", "attrs", ".", "get", "(", "TXT_RECORD_TYPE", ")", ";", "String", "txtRecord", "=", "null", ";", "if", "(", "attr", "!", "=", "null", ")", "{", "txtRecord", "=", "attr", ".", "get", "(", ")", ".", "toString", "(", ")", ";", "}", "Set", "<", "String", ">", "cnamesSet", "=", "new", "TreeSet", "<", "String", ">", "(", ")", ";", "if", "(", "txtRecord", "=", "=", "null", "|", "|", "txtRecord", ".", "trim", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "return", "cnamesSet", ";", "}", "String", "[", "]", "cnames", "=", "txtRecord", ".", "split", "(", "\"", "\"", ")", ";", "Collections", ".", "addAll", "(", "cnamesSet", ",", "cnames", ")", ";", "return", "cnamesSet", ";", "}", "</s>"]
["<s>", "void", "randomize", "(", "List", "<", "String", ">", "urlList", ")", ";", "</s>"]
["<s>", "public", "InstanceInfoBasedUrlRandomizer", "(", "InstanceInfo", "instanceInfo", ")", "{", "this", ".", "instanceInfo", "=", "instanceInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "randomize", "(", "List", "<", "String", ">", "urlList", ")", "{", "int", "listSize", "=", "0", ";", "if", "(", "urlList", "!", "=", "null", ")", "{", "listSize", "=", "urlList", ".", "size", "(", ")", ";", "}", "if", "(", "(", "instanceInfo", "=", "=", "null", ")", "|", "|", "(", "listSize", "=", "=", "0", ")", ")", "{", "return", ";", "}", "int", "instanceHashcode", "=", "instanceInfo", ".", "getHostName", "(", ")", ".", "hashCode", "(", ")", ";", "if", "(", "instanceHashcode", "<", "0", ")", "{", "instanceHashcode", "=", "instanceHashcode", "*", "-", "1", ";", "}", "int", "backupInstance", "=", "instanceHashcode", "%", "listSize", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "backupInstance", ";", "i", "+", "+", ")", "{", "String", "zone", "=", "urlList", ".", "remove", "(", "0", ")", ";", "urlList", ".", "add", "(", "zone", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "List", "<", "String", ">", "getDiscoveryServiceUrls", "(", "EurekaClientConfig", "clientConfig", ",", "String", "zone", ",", "ServiceUrlRandomizer", "randomizer", ")", "{", "boolean", "shouldUseDns", "=", "clientConfig", ".", "shouldUseDnsForFetchingServiceUrls", "(", ")", ";", "if", "(", "shouldUseDns", ")", "{", "return", "getServiceUrlsFromDNS", "(", "clientConfig", ",", "zone", ",", "clientConfig", ".", "shouldPreferSameZoneEureka", "(", ")", ",", "randomizer", ")", ";", "}", "return", "getServiceUrlsFromConfig", "(", "clientConfig", ",", "zone", ",", "clientConfig", ".", "shouldPreferSameZoneEureka", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "List", "<", "String", ">", "getServiceUrlsFromDNS", "(", "EurekaClientConfig", "clientConfig", ",", "String", "instanceZone", ",", "boolean", "preferSameZone", ",", "ServiceUrlRandomizer", "randomizer", ")", "{", "String", "region", "=", "getRegion", "(", "clientConfig", ")", ";", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "zoneDnsNamesMap", "=", "getZoneBasedDiscoveryUrlsFromRegion", "(", "clientConfig", ",", "region", ")", ";", "Set", "<", "String", ">", "availableZones", "=", "zoneDnsNamesMap", ".", "keySet", "(", ")", ";", "List", "<", "String", ">", "zones", "=", "new", "ArrayList", "<", "String", ">", "(", "availableZones", ")", ";", "if", "(", "zones", ".", "isEmpty", "(", ")", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "instanceZone", ")", ";", "}", "int", "zoneIndex", "=", "0", ";", "boolean", "zoneFound", "=", "false", ";", "for", "(", "String", "zone", ":", "zones", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instanceZone", ",", "zone", ")", ";", "if", "(", "preferSameZone", ")", "{", "if", "(", "instanceZone", ".", "equalsIgnoreCase", "(", "zone", ")", ")", "{", "zoneFound", "=", "true", ";", "}", "}", "else", "{", "if", "(", "!", "instanceZone", ".", "equalsIgnoreCase", "(", "zone", ")", ")", "{", "zoneFound", "=", "true", ";", "}", "}", "if", "(", "zoneFound", ")", "{", "Object", "[", "]", "args", "=", "{", "zones", ",", "instanceZone", ",", "zoneIndex", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "break", ";", "}", "zoneIndex", "+", "+", ";", "}", "if", "(", "zoneIndex", ">", "=", "zones", ".", "size", "(", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "instanceZone", ",", "Arrays", ".", "toString", "(", "zones", ".", "toArray", "(", ")", ")", ")", ";", "}", "else", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "zoneIndex", ";", "i", "+", "+", ")", "{", "String", "zone", "=", "zones", ".", "remove", "(", "0", ")", ";", "zones", ".", "add", "(", "zone", ")", ";", "}", "}", "List", "<", "String", ">", "serviceUrls", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "for", "(", "String", "zone", ":", "zones", ")", "{", "for", "(", "String", "zoneCname", ":", "zoneDnsNamesMap", ".", "get", "(", "zone", ")", ")", "{", "List", "<", "String", ">", "ec2Urls", "=", "new", "ArrayList", "<", "String", ">", "(", "getEC2DiscoveryUrlsFromZone", "(", "zoneCname", ",", "DiscoveryUrlType", ".", "CNAME", ")", ")", ";", "if", "(", "ec2Urls", ".", "size", "(", ")", ">", "1", ")", "{", "randomizer", ".", "randomize", "(", "ec2Urls", ")", ";", "}", "for", "(", "String", "ec2Url", ":", "ec2Urls", ")", "{", "String", "serviceUrl", "=", "\"", "<STR_LIT>", "\"", "+", "ec2Url", "+", "\"", "<STR_LIT::>", "\"", "+", "clientConfig", ".", "getEurekaServerPort", "(", ")", "+", "\"", "<STR_LIT:/>", "\"", "+", "clientConfig", ".", "getEurekaServerURLContext", "(", ")", "+", "\"", "<STR_LIT:/>", "\"", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "serviceUrl", ")", ";", "serviceUrls", ".", "add", "(", "serviceUrl", ")", ";", "}", "}", "}", "String", "primaryServiceUrl", "=", "serviceUrls", ".", "remove", "(", "0", ")", ";", "randomizer", ".", "randomize", "(", "serviceUrls", ")", ";", "serviceUrls", ".", "add", "(", "0", ",", "primaryServiceUrl", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "serviceUrls", ".", "toArray", "(", ")", ")", ")", ";", "return", "serviceUrls", ";", "}", "</s>"]
["<s>", "public", "static", "List", "<", "String", ">", "getServiceUrlsFromConfig", "(", "EurekaClientConfig", "clientConfig", ",", "String", "instanceZone", ",", "boolean", "preferSameZone", ")", "{", "List", "<", "String", ">", "orderedUrls", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "String", "region", "=", "getRegion", "(", "clientConfig", ")", ";", "String", "[", "]", "availZones", "=", "clientConfig", ".", "getAvailabilityZones", "(", "clientConfig", ".", "getRegion", "(", ")", ")", ";", "if", "(", "availZones", "=", "=", "null", "|", "|", "availZones", ".", "length", "=", "=", "0", ")", "{", "availZones", "=", "new", "String", "[", "1", "]", ";", "availZones", "[", "0", "]", "=", "DEFAULT_ZONE", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "region", ",", "Arrays", ".", "toString", "(", "availZones", ")", ")", ";", "int", "myZoneOffset", "=", "getZoneOffset", "(", "instanceZone", ",", "preferSameZone", ",", "availZones", ")", ";", "List", "<", "String", ">", "serviceUrls", "=", "clientConfig", ".", "getEurekaServerServiceUrls", "(", "availZones", "[", "myZoneOffset", "]", ")", ";", "if", "(", "serviceUrls", "!", "=", "null", ")", "{", "orderedUrls", ".", "addAll", "(", "serviceUrls", ")", ";", "}", "int", "currentOffset", "=", "myZoneOffset", "=", "=", "(", "availZones", ".", "length", "-", "1", ")", "?", "0", ":", "(", "myZoneOffset", "+", "1", ")", ";", "while", "(", "currentOffset", "!", "=", "myZoneOffset", ")", "{", "serviceUrls", "=", "clientConfig", ".", "getEurekaServerServiceUrls", "(", "availZones", "[", "currentOffset", "]", ")", ";", "if", "(", "serviceUrls", "!", "=", "null", ")", "{", "orderedUrls", ".", "addAll", "(", "serviceUrls", ")", ";", "}", "if", "(", "currentOffset", "=", "=", "(", "availZones", ".", "length", "-", "1", ")", ")", "{", "currentOffset", "=", "0", ";", "}", "else", "{", "currentOffset", "+", "+", ";", "}", "}", "if", "(", "orderedUrls", ".", "size", "(", ")", "<", "1", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "orderedUrls", ";", "}", "</s>"]
["<s>", "public", "static", "Set", "<", "String", ">", "getEC2DiscoveryUrlsFromZone", "(", "String", "dnsName", ",", "DiscoveryUrlType", "type", ")", "{", "Set", "<", "String", ">", "eipsForZone", "=", "null", ";", "try", "{", "dnsName", "=", "\"", "<STR_LIT:.>", "\"", "+", "dnsName", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "dnsName", ")", ";", "Set", "<", "String", ">", "ec2UrlsForZone", "=", "DnsResolver", ".", "getCNamesFromTxtRecord", "(", "dnsName", ")", ";", "for", "(", "String", "ec2Url", ":", "ec2UrlsForZone", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "dnsName", ",", "ec2Url", ")", ";", "ec2UrlsForZone", ".", "add", "(", "ec2Url", ")", ";", "}", "if", "(", "DiscoveryUrlType", ".", "CNAME", ".", "equals", "(", "type", ")", ")", "{", "return", "ec2UrlsForZone", ";", "}", "eipsForZone", "=", "new", "TreeSet", "<", "String", ">", "(", ")", ";", "for", "(", "String", "cname", ":", "ec2UrlsForZone", ")", "{", "String", "[", "]", "tokens", "=", "cname", ".", "split", "(", "\"", "<STR_LIT:\\\\>", "<STR_LIT:.>", "\"", ")", ";", "String", "ec2HostName", "=", "tokens", "[", "0", "]", ";", "String", "[", "]", "ips", "=", "ec2HostName", ".", "split", "(", "\"", "<STR_LIT:->", "\"", ")", ";", "StringBuilder", "eipBuffer", "=", "new", "StringBuilder", "(", ")", ";", "for", "(", "int", "ipCtr", "=", "1", ";", "ipCtr", "<", "<NUM_LIT:5>", ";", "ipCtr", "+", "+", ")", "{", "eipBuffer", ".", "append", "(", "ips", "[", "ipCtr", "]", ")", ";", "if", "(", "ipCtr", "<", "<NUM_LIT:4>", ")", "{", "eipBuffer", ".", "append", "(", "\"", "<STR_LIT:.>", "\"", ")", ";", "}", "}", "eipsForZone", ".", "add", "(", "eipBuffer", ".", "toString", "(", ")", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "dnsName", ",", "eipsForZone", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "dnsName", ",", "e", ")", ";", "}", "return", "eipsForZone", ";", "}", "</s>"]
["<s>", "public", "static", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "getZoneBasedDiscoveryUrlsFromRegion", "(", "EurekaClientConfig", "clientConfig", ",", "String", "region", ")", "{", "String", "discoveryDnsName", "=", "null", ";", "try", "{", "discoveryDnsName", "=", "\"", "<STR_LIT:.>", "\"", "+", "region", "+", "\"", "<STR_LIT:.>", "\"", "+", "clientConfig", ".", "getEurekaServerDNSName", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "discoveryDnsName", ")", ";", "Set", "<", "String", ">", "zoneCnamesForRegion", "=", "new", "TreeSet", "<", "String", ">", "(", "DnsResolver", ".", "getCNamesFromTxtRecord", "(", "discoveryDnsName", ")", ")", ";", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "zoneCnameMapForRegion", "=", "new", "TreeMap", "<", "String", ",", "List", "<", "String", ">", ">", "(", ")", ";", "for", "(", "String", "zoneCname", ":", "zoneCnamesForRegion", ")", "{", "String", "zone", "=", "null", ";", "if", "(", "isEC2Url", "(", "zoneCname", ")", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "discoveryDnsName", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "String", "[", "]", "cnameTokens", "=", "zoneCname", ".", "split", "(", "\"", "<STR_LIT:\\\\>", "<STR_LIT:.>", "\"", ")", ";", "zone", "=", "cnameTokens", "[", "0", "]", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "region", ",", "zone", ")", ";", "}", "List", "<", "String", ">", "zoneCnamesSet", "=", "zoneCnameMapForRegion", ".", "get", "(", "zone", ")", ";", "if", "(", "zoneCnamesSet", "=", "=", "null", ")", "{", "zoneCnamesSet", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "zoneCnameMapForRegion", ".", "put", "(", "zone", ",", "zoneCnamesSet", ")", ";", "}", "zoneCnamesSet", ".", "add", "(", "zoneCname", ")", ";", "}", "return", "zoneCnameMapForRegion", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "discoveryDnsName", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "String", "getRegion", "(", "EurekaClientConfig", "clientConfig", ")", "{", "String", "region", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "if", "(", "region", "=", "=", "null", ")", "{", "region", "=", "DEFAULT_REGION", ";", "}", "region", "=", "region", ".", "trim", "(", ")", ".", "toLowerCase", "(", ")", ";", "return", "region", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isEC2Url", "(", "String", "zoneCname", ")", "{", "return", "zoneCname", ".", "startsWith", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getZoneOffset", "(", "String", "myZone", ",", "boolean", "preferSameZone", ",", "String", "[", "]", "availZones", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "availZones", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "myZone", "!", "=", "null", "&", "&", "(", "availZones", "[", "i", "]", ".", "equalsIgnoreCase", "(", "myZone", ".", "trim", "(", ")", ")", "=", "=", "preferSameZone", ")", ")", "{", "return", "i", ";", "}", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "availZones", "[", "0", "]", ",", "myZone", ",", "preferSameZone", ")", ";", "return", "0", ";", "}", "</s>"]
["<s>", "public", "abstract", "String", "getName", "(", ")", ";", "</s>"]
["<s>", "public", "abstract", "String", "getVersion", "(", ")", ";", "</s>"]
["<s>", "@", "Nullable", "public", "abstract", "String", "getId", "(", ")", ";", "</s>"]
["<s>", "public", "PropertiesInstanceConfig", "(", ")", "{", "init", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "public", "PropertiesInstanceConfig", "(", "String", "namespace", ",", "DataCenterInfo", "info", ")", "{", "super", "(", "info", ")", ";", "init", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "public", "PropertiesInstanceConfig", "(", "String", "namespace", ")", "{", "init", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isInstanceEnabledOnit", "(", ")", "{", "return", "INSTANCE", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "super", ".", "isInstanceEnabledOnit", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNonSecurePort", "(", ")", "{", "return", "INSTANCE", ".", "getIntProperty", "(", "propNonSecurePort", ",", "super", ".", "getNonSecurePort", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getSecurePort", "(", ")", "{", "return", "INSTANCE", ".", "getIntProperty", "(", "propSecurePort", ",", "super", ".", "getSecurePort", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isNonSecurePortEnabled", "(", ")", "{", "return", "INSTANCE", ".", "getBooleanProperty", "(", "propPortEnabled", ",", "super", ".", "isNonSecurePortEnabled", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "getSecurePortEnabled", "(", ")", "{", "return", "INSTANCE", ".", "getBooleanProperty", "(", "propSecurePortEnabled", ",", "super", ".", "getSecurePortEnabled", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLeaseRenewalIntervalInSeconds", "(", ")", "{", "return", "INSTANCE", ".", "getIntProperty", "(", "propLeaseRenewalIntervalInSeconds", ",", "super", ".", "getLeaseRenewalIntervalInSeconds", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLeaseExpirationDurationInSeconds", "(", ")", "{", "return", "INSTANCE", ".", "getIntProperty", "(", "propLeaseExpirationDurationInSeconds", ",", "super", ".", "getLeaseExpirationDurationInSeconds", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getVirtualHostName", "(", ")", "{", "if", "(", "this", ".", "isNonSecurePortEnabled", "(", ")", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "propVirtualHostname", ",", "super", ".", "getVirtualHostName", "(", ")", ")", ".", "get", "(", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getSecureVirtualHostName", "(", ")", "{", "if", "(", "this", ".", "getSecurePortEnabled", "(", ")", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "propSecureVirtualHostname", ",", "super", ".", "getSecureVirtualHostName", "(", ")", ")", ".", "get", "(", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getASGName", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "propASGName", ",", "super", ".", "getASGName", "(", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getMetadataMap", "(", ")", "{", "Map", "<", "String", ",", "String", ">", "metadataMap", "=", "new", "LinkedHashMap", "<", "String", ",", "String", ">", "(", ")", ";", "Configuration", "config", "=", "(", "Configuration", ")", "INSTANCE", ".", "getBackingConfigurationSource", "(", ")", ";", "String", "subsetPrefix", "=", "propMetadataNamespace", ".", "charAt", "(", "propMetadataNamespace", ".", "length", "(", ")", "-", "1", ")", "=", "=", "<CHAR_LIT:.>", "?", "propMetadataNamespace", ".", "substring", "(", "0", ",", "propMetadataNamespace", ".", "length", "(", ")", "-", "1", ")", ":", "propMetadataNamespace", ";", "for", "(", "Iterator", "<", "String", ">", "iter", "=", "config", ".", "subset", "(", "subsetPrefix", ")", ".", "getKeys", "(", ")", ";", "iter", ".", "hasNext", "(", ")", ";", ")", "{", "String", "key", "=", "iter", ".", "next", "(", ")", ";", "String", "value", "=", "config", ".", "getString", "(", "subsetPrefix", "+", "\"", "<STR_LIT:.>", "\"", "+", "key", ")", ";", "metadataMap", ".", "put", "(", "key", ",", "value", ")", ";", "}", "return", "metadataMap", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getInstanceId", "(", ")", "{", "String", "result", "=", "INSTANCE", ".", "getStringProperty", "(", "idPropName", ",", "null", ")", ".", "get", "(", ")", ";", "return", "result", "=", "=", "null", "?", "null", ":", "result", ".", "trim", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAppname", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "propName", ",", "UNKNOWN_APPLICATION", ")", ".", "get", "(", ")", ".", "trim", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAppGroupName", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "propAppGroupName", ",", "appGrpNameFromEnv", ")", ".", "get", "(", ")", ".", "trim", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getIpAddress", "(", ")", "{", "return", "super", ".", "getIpAddress", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getStatusPageUrlPath", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "DEFAULT_STATUSPAGE_URLPATH", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getStatusPageUrl", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHomePageUrlPath", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "DEFAULT_HOMEPAGE_URLPATH", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHomePageUrl", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHealthCheckUrlPath", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "DEFAULT_HEALTHCHECK_URLPATH", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHealthCheckUrl", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getSecureHealthCheckUrl", "(", ")", "{", "return", "INSTANCE", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getNamespace", "(", ")", "{", "return", "this", ".", "namespace", ";", "}", "</s>"]
["<s>", "private", "void", "init", "(", "String", "namespace", ")", "{", "this", ".", "namespace", "=", "namespace", ";", "propSecurePort", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propSecurePortEnabled", "=", "propSecurePort", "+", "\"", "<STR_LIT>", "\"", ";", "propNonSecurePort", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "idPropName", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propName", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propPortEnabled", "=", "propNonSecurePort", "+", "\"", "<STR_LIT>", "\"", ";", "propLeaseRenewalIntervalInSeconds", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propLeaseExpirationDurationInSeconds", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propSecureVirtualHostname", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propVirtualHostname", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "propMetadataNamespace", "=", "namespace", "+", "\"", "<STR_LIT:.>", "\"", ";", "propASGName", "=", "namespace", "+", "\"", "<STR_LIT:Name>", "\"", ";", "propAppGroupName", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "appGrpNameFromEnv", "=", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getString", "(", "APP_GROUP_ENV_VAR_NAME", ",", "UNKNOWN_APPLICATION", ")", ";", "String", "env", "=", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getString", "(", "EUREKA_ENVIRONMENT", ",", "TEST", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "ARCHAIUS_DEPLOYMENT_ENVIRONMENT", ",", "env", ")", ";", "String", "eurekaPropsFile", "=", "EUREKA_PROPS_FILE", ".", "get", "(", ")", ";", "try", "{", "ConfigurationManager", ".", "loadCascadedPropertiesFromResources", "(", "eurekaPropsFile", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "eurekaPropsFile", ")", ";", "}", "}", "</s>"]
["<s>", "InstanceInfo", ".", "InstanceStatus", "getStatus", "(", "InstanceInfo", ".", "InstanceStatus", "currentStatus", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "protected", "AbstractInstanceConfig", "(", ")", "{", "}", "</s>"]
["<s>", "protected", "AbstractInstanceConfig", "(", "DataCenterInfo", "info", ")", "{", "this", ".", "info", "=", "info", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isInstanceEnabledOnit", "(", ")", "{", "return", "INSTANCE_ENABLED_ON_INIT", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNonSecurePort", "(", ")", "{", "return", "NON_SECURE_PORT", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getSecurePort", "(", ")", "{", "return", "SECURE_PORT", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isNonSecurePortEnabled", "(", ")", "{", "return", "NON_SECURE_PORT_ENABLED", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "getSecurePortEnabled", "(", ")", "{", "return", "SECURE_PORT_ENABLED", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLeaseRenewalIntervalInSeconds", "(", ")", "{", "return", "LEASE_RENEWAL_INTERVAL_SECONDS", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLeaseExpirationDurationInSeconds", "(", ")", "{", "return", "LEASE_EXPIRATION_DURATION_SECONDS", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getVirtualHostName", "(", ")", "{", "return", "(", "getHostName", "(", "false", ")", "+", "\"", "<STR_LIT::>", "\"", "+", "getNonSecurePort", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getSecureVirtualHostName", "(", ")", "{", "return", "(", "getHostName", "(", "false", ")", "+", "\"", "<STR_LIT::>", "\"", "+", "getSecurePort", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getASGName", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHostName", "(", "boolean", "refresh", ")", "{", "return", "hostInfo", ".", "second", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getMetadataMap", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "DataCenterInfo", "getDataCenterInfo", "(", ")", "{", "return", "info", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getIpAddress", "(", ")", "{", "return", "hostInfo", ".", "first", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Pair", "<", "String", ",", "String", ">", "getHostInfo", "(", ")", "{", "Pair", "<", "String", ",", "String", ">", "pair", "=", "new", "Pair", "<", "String", ",", "String", ">", "(", "\"", "\"", ",", "\"", "\"", ")", ";", "try", "{", "pair", ".", "setFirst", "(", "InetAddress", ".", "getLocalHost", "(", ")", ".", "getHostAddress", "(", ")", ")", ";", "pair", ".", "setSecond", "(", "InetAddress", ".", "getLocalHost", "(", ")", ".", "getHostName", "(", ")", ")", ";", "}", "catch", "(", "UnknownHostException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "return", "pair", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "Response", "doHealthCheck", "(", ")", "{", "try", "{", "InstanceInfo", "myInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "switch", "(", "myInfo", ".", "getStatus", "(", ")", ")", "{", "case", "UP", ":", "return", "Response", ".", "status", "(", "Status", ".", "OK", ")", ".", "build", "(", ")", ";", "case", "STARTING", ":", "return", "Response", ".", "status", "(", "Status", ".", "NO_CONTENT", ")", ".", "build", "(", ")", ";", "case", "OUT_OF_SERVICE", ":", "return", "Response", ".", "status", "(", "Status", ".", "SERVICE_UNAVAILABLE", ")", ".", "build", "(", ")", ";", "default", ":", "return", "Response", ".", "status", "(", "Status", ".", "INTERNAL_SERVER_ERROR", ")", ".", "build", "(", ")", ";", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "s_logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "INTERNAL_SERVER_ERROR", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ApplicationInfoManager", "(", ")", "{", "listeners", "=", "new", "ConcurrentHashMap", "<", "String", ",", "StatusChangeListener", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "ApplicationInfoManager", "(", "EurekaInstanceConfig", "config", ",", "InstanceInfo", "instanceInfo", ")", "{", "this", ".", "config", "=", "config", ";", "this", ".", "instanceInfo", "=", "instanceInfo", ";", "this", ".", "listeners", "=", "new", "ConcurrentHashMap", "<", "String", ",", "StatusChangeListener", ">", "(", ")", ";", "instance", "=", "this", ";", "}", "</s>"]
["<s>", "public", "ApplicationInfoManager", "(", "EurekaInstanceConfig", "config", ")", "{", "this", "(", "config", ",", "new", "EurekaConfigBasedInstanceInfoProvider", "(", "config", ")", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "ApplicationInfoManager", "getInstance", "(", ")", "{", "return", "instance", ";", "}", "</s>"]
["<s>", "public", "void", "initComponent", "(", "EurekaInstanceConfig", "config", ")", "{", "try", "{", "this", ".", "config", "=", "config", ";", "this", ".", "instanceInfo", "=", "new", "EurekaConfigBasedInstanceInfoProvider", "(", "config", ")", ".", "get", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getInfo", "(", ")", "{", "return", "instanceInfo", ";", "}", "</s>"]
["<s>", "public", "void", "registerAppMetadata", "(", "Map", "<", "String", ",", "String", ">", "appMetadata", ")", "{", "instanceInfo", ".", "registerRuntimeMetadata", "(", "appMetadata", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setInstanceStatus", "(", "InstanceStatus", "status", ")", "{", "InstanceStatus", "prev", "=", "instanceInfo", ".", "setStatus", "(", "status", ")", ";", "if", "(", "prev", "!", "=", "null", ")", "{", "for", "(", "StatusChangeListener", "listener", ":", "listeners", ".", "values", "(", ")", ")", "{", "try", "{", "listener", ".", "notify", "(", "new", "StatusChangeEvent", "(", "prev", ",", "status", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "listener", ".", "getId", "(", ")", ",", "e", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "public", "void", "registerStatusChangeListener", "(", "StatusChangeListener", "listener", ")", "{", "listeners", ".", "put", "(", "listener", ".", "getId", "(", ")", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "unregisterStatusChangeListener", "(", "String", "listenerId", ")", "{", "listeners", ".", "remove", "(", "listenerId", ")", ";", "}", "</s>"]
["<s>", "public", "void", "refreshDataCenterInfoIfRequired", "(", ")", "{", "String", "existingHostname", "=", "instanceInfo", ".", "getHostName", "(", ")", ";", "String", "newHostname", "=", "config", ".", "getHostName", "(", "true", ")", ";", "if", "(", "newHostname", "!", "=", "null", "&", "&", "!", "newHostname", ".", "equals", "(", "existingHostname", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "existingHostname", "+", "\"", "<STR_LIT>", "\"", "+", "newHostname", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "new", "InstanceInfo", ".", "Builder", "(", "instanceInfo", ")", ";", "builder", ".", "setHostName", "(", "newHostname", ")", ".", "setDataCenterInfo", "(", "config", ".", "getDataCenterInfo", "(", ")", ")", ";", "instanceInfo", ".", "setIsDirty", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "refreshLeaseInfoIfRequired", "(", ")", "{", "LeaseInfo", "leaseInfo", "=", "instanceInfo", ".", "getLeaseInfo", "(", ")", ";", "if", "(", "leaseInfo", "=", "=", "null", ")", "{", "return", ";", "}", "int", "currentLeaseDuration", "=", "config", ".", "getLeaseExpirationDurationInSeconds", "(", ")", ";", "int", "currentLeaseRenewal", "=", "config", ".", "getLeaseRenewalIntervalInSeconds", "(", ")", ";", "if", "(", "leaseInfo", ".", "getDurationInSecs", "(", ")", "!", "=", "currentLeaseDuration", "|", "|", "leaseInfo", ".", "getRenewalIntervalInSecs", "(", ")", "!", "=", "currentLeaseRenewal", ")", "{", "LeaseInfo", "newLeaseInfo", "=", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setRenewalIntervalInSecs", "(", "currentLeaseRenewal", ")", ".", "setDurationInSecs", "(", "currentLeaseDuration", ")", ".", "build", "(", ")", ";", "instanceInfo", ".", "setLeaseInfo", "(", "newLeaseInfo", ")", ";", "instanceInfo", ".", "setIsDirty", "(", ")", ";", "}", "}", "</s>"]
["<s>", "String", "getId", "(", ")", ";", "</s>"]
["<s>", "void", "notify", "(", "StatusChangeEvent", "statusChangeEvent", ")", ";", "</s>"]
["<s>", "public", "MyDataCenterInstanceConfig", "(", ")", "{", "}", "</s>"]
["<s>", "public", "MyDataCenterInstanceConfig", "(", "String", "namespace", ")", "{", "super", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "public", "MyDataCenterInstanceConfig", "(", "String", "namespace", ",", "DataCenterInfo", "dataCenterInfo", ")", "{", "super", "(", "namespace", ",", "dataCenterInfo", ")", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "(", ")", "{", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "InstanceInfo", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "instanceId", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "appName", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "appGroupName", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "ipAddr", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "sid", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "int", "port", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "boolean", "portEnabled", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "int", "securePort", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "boolean", "securePortEnabled", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "homePageUrl", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "statusPageUrl", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "healthCheckUrl", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "secureHealthCheckUrl", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "vipAddress", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "secureVipAddress", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "int", "countryId", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "DataCenterInfo", "dataCenterInfo", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT:Name>", "\"", ")", "String", "hostName", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "InstanceStatus", "status", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "InstanceStatus", "overriddenstatus", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "LeaseInfo", "leaseInfo", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Boolean", "isCoordinatingDiscoveryServer", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "HashMap", "<", "String", ",", "String", ">", "metadata", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Long", "lastUpdatedTimestamp", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Long", "lastDirtyTimestamp", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "ActionType", "actionType", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT:Name>", "\"", ")", "String", "asgName", ")", "{", "this", ".", "instanceId", "=", "instanceId", ";", "this", ".", "sid", "=", "sid", ";", "this", ".", "appName", "=", "StringCache", ".", "intern", "(", "appName", ")", ";", "this", ".", "appGroupName", "=", "StringCache", ".", "intern", "(", "appGroupName", ")", ";", "this", ".", "ipAddr", "=", "ipAddr", ";", "this", ".", "port", "=", "port", ";", "this", ".", "isUnsecurePortEnabled", "=", "portEnabled", ";", "this", ".", "securePort", "=", "securePort", ";", "this", ".", "isSecurePortEnabled", "=", "securePortEnabled", ";", "this", ".", "homePageUrl", "=", "homePageUrl", ";", "this", ".", "statusPageUrl", "=", "statusPageUrl", ";", "this", ".", "healthCheckUrl", "=", "healthCheckUrl", ";", "this", ".", "secureHealthCheckUrl", "=", "secureHealthCheckUrl", ";", "this", ".", "vipAddress", "=", "StringCache", ".", "intern", "(", "vipAddress", ")", ";", "this", ".", "secureVipAddress", "=", "StringCache", ".", "intern", "(", "secureVipAddress", ")", ";", "this", ".", "countryId", "=", "countryId", ";", "this", ".", "dataCenterInfo", "=", "dataCenterInfo", ";", "this", ".", "hostName", "=", "hostName", ";", "this", ".", "status", "=", "status", ";", "this", ".", "overriddenstatus", "=", "overriddenstatus", ";", "this", ".", "leaseInfo", "=", "leaseInfo", ";", "this", ".", "isCoordinatingDiscoveryServer", "=", "isCoordinatingDiscoveryServer", ";", "this", ".", "lastUpdatedTimestamp", "=", "lastUpdatedTimestamp", ";", "this", ".", "lastDirtyTimestamp", "=", "lastDirtyTimestamp", ";", "this", ".", "actionType", "=", "actionType", ";", "this", ".", "asgName", "=", "StringCache", ".", "intern", "(", "asgName", ")", ";", "if", "(", "metadata", "=", "=", "null", ")", "{", "this", ".", "metadata", "=", "Collections", ".", "emptyMap", "(", ")", ";", "}", "else", "if", "(", "metadata", ".", "size", "(", ")", "=", "=", "1", ")", "{", "this", ".", "metadata", "=", "removeMetadataMapLegacyValues", "(", "metadata", ")", ";", "}", "else", "{", "this", ".", "metadata", "=", "metadata", ";", "}", "if", "(", "sid", "=", "=", "null", ")", "{", "this", ".", "sid", "=", "SID_DEFAULT", ";", "}", "}", "</s>"]
["<s>", "private", "Map", "<", "String", ",", "String", ">", "removeMetadataMapLegacyValues", "(", "Map", "<", "String", ",", "String", ">", "metadata", ")", "{", "if", "(", "InstanceInfoSerializer", ".", "METADATA_COMPATIBILITY_VALUE", ".", "equals", "(", "metadata", ".", "get", "(", "InstanceInfoSerializer", ".", "METADATA_COMPATIBILITY_KEY", ")", ")", ")", "{", "metadata", ".", "remove", "(", "InstanceInfoSerializer", ".", "METADATA_COMPATIBILITY_KEY", ")", ";", "}", "else", "if", "(", "InstanceInfoSerializer", ".", "METADATA_COMPATIBILITY_VALUE", ".", "equals", "(", "metadata", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", "{", "metadata", ".", "remove", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "metadata", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "(", "InstanceInfo", "ii", ")", "{", "this", ".", "instanceId", "=", "ii", ".", "instanceId", ";", "this", ".", "appName", "=", "ii", ".", "appName", ";", "this", ".", "appGroupName", "=", "ii", ".", "appGroupName", ";", "this", ".", "ipAddr", "=", "ii", ".", "ipAddr", ";", "this", ".", "sid", "=", "ii", ".", "sid", ";", "this", ".", "port", "=", "ii", ".", "port", ";", "this", ".", "securePort", "=", "ii", ".", "securePort", ";", "this", ".", "homePageUrl", "=", "ii", ".", "homePageUrl", ";", "this", ".", "statusPageUrl", "=", "ii", ".", "statusPageUrl", ";", "this", ".", "healthCheckUrl", "=", "ii", ".", "healthCheckUrl", ";", "this", ".", "secureHealthCheckUrl", "=", "ii", ".", "secureHealthCheckUrl", ";", "this", ".", "vipAddress", "=", "ii", ".", "vipAddress", ";", "this", ".", "secureVipAddress", "=", "ii", ".", "secureVipAddress", ";", "this", ".", "statusPageRelativeUrl", "=", "ii", ".", "statusPageRelativeUrl", ";", "this", ".", "statusPageExplicitUrl", "=", "ii", ".", "statusPageExplicitUrl", ";", "this", ".", "healthCheckRelativeUrl", "=", "ii", ".", "healthCheckRelativeUrl", ";", "this", ".", "healthCheckSecureExplicitUrl", "=", "ii", ".", "healthCheckSecureExplicitUrl", ";", "this", ".", "vipAddressUnresolved", "=", "ii", ".", "vipAddressUnresolved", ";", "this", ".", "secureVipAddressUnresolved", "=", "ii", ".", "secureVipAddressUnresolved", ";", "this", ".", "healthCheckExplicitUrl", "=", "ii", ".", "healthCheckExplicitUrl", ";", "this", ".", "countryId", "=", "ii", ".", "countryId", ";", "this", ".", "isSecurePortEnabled", "=", "ii", ".", "isSecurePortEnabled", ";", "this", ".", "isUnsecurePortEnabled", "=", "ii", ".", "isUnsecurePortEnabled", ";", "this", ".", "dataCenterInfo", "=", "ii", ".", "dataCenterInfo", ";", "this", ".", "hostName", "=", "ii", ".", "hostName", ";", "this", ".", "status", "=", "ii", ".", "status", ";", "this", ".", "overriddenstatus", "=", "ii", ".", "overriddenstatus", ";", "this", ".", "isInstanceInfoDirty", "=", "ii", ".", "isInstanceInfoDirty", ";", "this", ".", "leaseInfo", "=", "ii", ".", "leaseInfo", ";", "this", ".", "isCoordinatingDiscoveryServer", "=", "ii", ".", "isCoordinatingDiscoveryServer", ";", "this", ".", "metadata", "=", "ii", ".", "metadata", ";", "this", ".", "lastUpdatedTimestamp", "=", "ii", ".", "lastUpdatedTimestamp", ";", "this", ".", "lastDirtyTimestamp", "=", "ii", ".", "lastDirtyTimestamp", ";", "this", ".", "actionType", "=", "ii", ".", "actionType", ";", "this", ".", "asgName", "=", "ii", ".", "asgName", ";", "this", ".", "version", "=", "ii", ".", "version", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceStatus", "toEnum", "(", "String", "s", ")", "{", "for", "(", "InstanceStatus", "e", ":", "InstanceStatus", ".", "values", "(", ")", ")", "{", "if", "(", "e", ".", "name", "(", ")", ".", "equalsIgnoreCase", "(", "s", ")", ")", "{", "return", "e", ";", "}", "}", "return", "UNKNOWN", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "final", "int", "prime", "=", "<NUM_LIT:31>", ";", "int", "result", "=", "1", ";", "result", "=", "prime", "*", "result", "+", "(", "(", "getId", "(", ")", "=", "=", "null", ")", "?", "0", ":", "getId", "(", ")", ".", "hashCode", "(", ")", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "this", "=", "=", "obj", ")", "{", "return", "true", ";", "}", "if", "(", "obj", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "getClass", "(", ")", "!", "=", "obj", ".", "getClass", "(", ")", ")", "{", "return", "false", ";", "}", "InstanceInfo", "other", "=", "(", "InstanceInfo", ")", "obj", ";", "if", "(", "getId", "(", ")", "=", "=", "null", ")", "{", "if", "(", "other", ".", "getId", "(", ")", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "!", "getId", "(", ")", ".", "equals", "(", "other", ".", "getId", "(", ")", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "private", "Builder", "(", ")", "{", "result", "=", "new", "InstanceInfo", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "(", "InstanceInfo", "instanceInfo", ")", "{", "result", "=", "instanceInfo", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "newBuilder", "(", ")", "{", "return", "new", "Builder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "setInstanceId", "(", "String", "instanceId", ")", "{", "result", ".", "instanceId", "=", "instanceId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setAppName", "(", "String", "appName", ")", "{", "result", ".", "appName", "=", "StringCache", ".", "intern", "(", "appName", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setAppGroupName", "(", "String", "appGroupName", ")", "{", "if", "(", "appGroupName", "!", "=", "null", ")", "{", "result", ".", "appGroupName", "=", "appGroupName", ".", "toUpperCase", "(", "Locale", ".", "ROOT", ")", ";", "}", "else", "{", "result", ".", "appGroupName", "=", "null", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setHostName", "(", "String", "hostName", ")", "{", "String", "existingHostName", "=", "result", ".", "hostName", ";", "result", ".", "hostName", "=", "hostName", ";", "if", "(", "(", "existingHostName", "!", "=", "null", ")", "&", "&", "!", "(", "hostName", ".", "equals", "(", "existingHostName", ")", ")", ")", "{", "refreshStatusPageUrl", "(", ")", ".", "refreshHealthCheckUrl", "(", ")", ".", "refreshVIPAddress", "(", ")", ".", "refreshSecureVIPAddress", "(", ")", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setStatus", "(", "InstanceStatus", "status", ")", "{", "result", ".", "status", "=", "status", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setOverriddenStatus", "(", "InstanceStatus", "status", ")", "{", "result", ".", "overriddenstatus", "=", "status", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setIPAddr", "(", "String", "ip", ")", "{", "result", ".", "ipAddr", "=", "ip", ";", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "Builder", "setSID", "(", "String", "sid", ")", "{", "result", ".", "sid", "=", "sid", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setPort", "(", "int", "port", ")", "{", "result", ".", "port", "=", "port", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setSecurePort", "(", "int", "port", ")", "{", "result", ".", "securePort", "=", "port", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "enablePort", "(", "PortType", "type", ",", "boolean", "isEnabled", ")", "{", "if", "(", "type", "=", "=", "PortType", ".", "SECURE", ")", "{", "result", ".", "isSecurePortEnabled", "=", "isEnabled", ";", "}", "else", "{", "result", ".", "isUnsecurePortEnabled", "=", "isEnabled", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "Builder", "setCountryId", "(", "int", "id", ")", "{", "result", ".", "countryId", "=", "id", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setHomePageUrl", "(", "String", "relativeUrl", ",", "String", "explicitUrl", ")", "{", "String", "hostNameInterpolationExpression", "=", "\"", "<STR_LIT>", "\"", "+", "namespace", "+", "\"", "<STR_LIT:}>", "\"", ";", "if", "(", "explicitUrl", "!", "=", "null", ")", "{", "result", ".", "homePageUrl", "=", "explicitUrl", ".", "replace", "(", "hostNameInterpolationExpression", ",", "result", ".", "hostName", ")", ";", "}", "else", "if", "(", "relativeUrl", "!", "=", "null", ")", "{", "result", ".", "homePageUrl", "=", "HTTP_PROTOCOL", "+", "result", ".", "hostName", "+", "COLON", "+", "result", ".", "port", "+", "relativeUrl", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setHomePageUrlForDeser", "(", "String", "homePageUrl", ")", "{", "result", ".", "homePageUrl", "=", "homePageUrl", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setStatusPageUrl", "(", "String", "relativeUrl", ",", "String", "explicitUrl", ")", "{", "String", "hostNameInterpolationExpression", "=", "\"", "<STR_LIT>", "\"", "+", "namespace", "+", "\"", "<STR_LIT:}>", "\"", ";", "result", ".", "statusPageRelativeUrl", "=", "relativeUrl", ";", "result", ".", "statusPageExplicitUrl", "=", "explicitUrl", ";", "if", "(", "explicitUrl", "!", "=", "null", ")", "{", "result", ".", "statusPageUrl", "=", "explicitUrl", ".", "replace", "(", "hostNameInterpolationExpression", ",", "result", ".", "hostName", ")", ";", "}", "else", "if", "(", "relativeUrl", "!", "=", "null", ")", "{", "result", ".", "statusPageUrl", "=", "HTTP_PROTOCOL", "+", "result", ".", "hostName", "+", "COLON", "+", "result", ".", "port", "+", "relativeUrl", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setStatusPageUrlForDeser", "(", "String", "statusPageUrl", ")", "{", "result", ".", "statusPageUrl", "=", "statusPageUrl", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setHealthCheckUrls", "(", "String", "relativeUrl", ",", "String", "explicitUrl", ",", "String", "secureExplicitUrl", ")", "{", "String", "hostNameInterpolationExpression", "=", "\"", "<STR_LIT>", "\"", "+", "namespace", "+", "\"", "<STR_LIT:}>", "\"", ";", "result", ".", "healthCheckRelativeUrl", "=", "relativeUrl", ";", "result", ".", "healthCheckExplicitUrl", "=", "explicitUrl", ";", "result", ".", "healthCheckSecureExplicitUrl", "=", "secureExplicitUrl", ";", "if", "(", "explicitUrl", "!", "=", "null", ")", "{", "result", ".", "healthCheckUrl", "=", "explicitUrl", ".", "replace", "(", "hostNameInterpolationExpression", ",", "result", ".", "hostName", ")", ";", "}", "else", "if", "(", "result", ".", "isUnsecurePortEnabled", ")", "{", "result", ".", "healthCheckUrl", "=", "HTTP_PROTOCOL", "+", "result", ".", "hostName", "+", "COLON", "+", "result", ".", "port", "+", "relativeUrl", ";", "}", "if", "(", "secureExplicitUrl", "!", "=", "null", ")", "{", "result", ".", "secureHealthCheckUrl", "=", "secureExplicitUrl", ".", "replace", "(", "hostNameInterpolationExpression", ",", "result", ".", "hostName", ")", ";", "}", "else", "if", "(", "result", ".", "isSecurePortEnabled", ")", "{", "result", ".", "secureHealthCheckUrl", "=", "HTTPS_PROTOCOL", "+", "result", ".", "hostName", "+", "COLON", "+", "result", ".", "securePort", "+", "relativeUrl", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setHealthCheckUrlsForDeser", "(", "String", "healthCheckUrl", ",", "String", "secureHealthCheckUrl", ")", "{", "if", "(", "healthCheckUrl", "!", "=", "null", ")", "{", "result", ".", "healthCheckUrl", "=", "healthCheckUrl", ";", "}", "if", "(", "secureHealthCheckUrl", "!", "=", "null", ")", "{", "result", ".", "secureHealthCheckUrl", "=", "secureHealthCheckUrl", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setVIPAddress", "(", "String", "vipAddress", ")", "{", "result", ".", "vipAddressUnresolved", "=", "StringCache", ".", "intern", "(", "vipAddress", ")", ";", "result", ".", "vipAddress", "=", "StringCache", ".", "intern", "(", "resolveDeploymentContextBasedVipAddresses", "(", "vipAddress", ")", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setVIPAddressDeser", "(", "String", "vipAddress", ")", "{", "result", ".", "vipAddress", "=", "StringCache", ".", "intern", "(", "vipAddress", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setSecureVIPAddress", "(", "String", "secureVIPAddress", ")", "{", "result", ".", "secureVipAddressUnresolved", "=", "StringCache", ".", "intern", "(", "secureVIPAddress", ")", ";", "result", ".", "secureVipAddress", "=", "StringCache", ".", "intern", "(", "resolveDeploymentContextBasedVipAddresses", "(", "secureVIPAddress", ")", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setSecureVIPAddressDeser", "(", "String", "secureVIPAddress", ")", "{", "result", ".", "secureVipAddress", "=", "StringCache", ".", "intern", "(", "secureVIPAddress", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setDataCenterInfo", "(", "DataCenterInfo", "datacenter", ")", "{", "result", ".", "dataCenterInfo", "=", "datacenter", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setLeaseInfo", "(", "LeaseInfo", "info", ")", "{", "result", ".", "leaseInfo", "=", "info", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "add", "(", "String", "key", ",", "String", "val", ")", "{", "result", ".", "metadata", ".", "put", "(", "key", ",", "val", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setMetadata", "(", "Map", "<", "String", ",", "String", ">", "mt", ")", "{", "result", ".", "metadata", "=", "mt", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getRawInstance", "(", ")", "{", "return", "result", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "build", "(", ")", "{", "if", "(", "!", "isInitialized", "(", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "boolean", "isInitialized", "(", ")", "{", "return", "(", "result", ".", "appName", "!", "=", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "setASGName", "(", "String", "asgName", ")", "{", "result", ".", "asgName", "=", "StringCache", ".", "intern", "(", "asgName", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "Builder", "refreshStatusPageUrl", "(", ")", "{", "setStatusPageUrl", "(", "result", ".", "statusPageRelativeUrl", ",", "result", ".", "statusPageExplicitUrl", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "Builder", "refreshHealthCheckUrl", "(", ")", "{", "setHealthCheckUrls", "(", "result", ".", "healthCheckRelativeUrl", ",", "result", ".", "healthCheckExplicitUrl", ",", "result", ".", "healthCheckSecureExplicitUrl", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "Builder", "refreshSecureVIPAddress", "(", ")", "{", "setSecureVIPAddress", "(", "result", ".", "secureVipAddressUnresolved", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "private", "Builder", "refreshVIPAddress", "(", ")", "{", "setVIPAddress", "(", "result", ".", "vipAddressUnresolved", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setIsCoordinatingDiscoveryServer", "(", "boolean", "isCoordinatingDiscoveryServer", ")", "{", "result", ".", "isCoordinatingDiscoveryServer", "=", "isCoordinatingDiscoveryServer", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setLastUpdatedTimestamp", "(", "long", "lastUpdatedTimestamp", ")", "{", "result", ".", "lastUpdatedTimestamp", "=", "lastUpdatedTimestamp", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setLastDirtyTimestamp", "(", "long", "lastDirtyTimestamp", ")", "{", "result", ".", "lastDirtyTimestamp", "=", "lastDirtyTimestamp", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setActionType", "(", "ActionType", "actionType", ")", "{", "result", ".", "actionType", "=", "actionType", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setNamespace", "(", "String", "namespace", ")", "{", "this", ".", "namespace", "=", "namespace", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "String", "getInstanceId", "(", ")", "{", "return", "instanceId", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getAppName", "(", ")", "{", "return", "appName", ";", "}", "</s>"]
["<s>", "public", "String", "getAppGroupName", "(", ")", "{", "return", "appGroupName", ";", "}", "</s>"]
["<s>", "public", "String", "getHostName", "(", ")", "{", "return", "hostName", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "void", "setSID", "(", "String", "sid", ")", "{", "this", ".", "sid", "=", "sid", ";", "setIsDirty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Deprecated", "public", "String", "getSID", "(", ")", "{", "return", "sid", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "String", "getId", "(", ")", "{", "if", "(", "instanceId", "!", "=", "null", "&", "&", "!", "instanceId", ".", "isEmpty", "(", ")", ")", "{", "return", "instanceId", ";", "}", "else", "if", "(", "dataCenterInfo", "instanceof", "UniqueIdentifier", ")", "{", "return", "(", "(", "UniqueIdentifier", ")", "dataCenterInfo", ")", ".", "getId", "(", ")", ";", "}", "else", "{", "return", "hostName", ";", "}", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getIPAddr", "(", ")", "{", "return", "ipAddr", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "int", "getPort", "(", ")", "{", "return", "port", ";", "}", "</s>"]
["<s>", "public", "InstanceStatus", "getStatus", "(", ")", "{", "return", "status", ";", "}", "</s>"]
["<s>", "public", "InstanceStatus", "getOverriddenStatus", "(", ")", "{", "return", "overriddenstatus", ";", "}", "</s>"]
["<s>", "public", "DataCenterInfo", "getDataCenterInfo", "(", ")", "{", "return", "dataCenterInfo", ";", "}", "</s>"]
["<s>", "public", "LeaseInfo", "getLeaseInfo", "(", ")", "{", "return", "leaseInfo", ";", "}", "</s>"]
["<s>", "public", "void", "setLeaseInfo", "(", "LeaseInfo", "info", ")", "{", "leaseInfo", "=", "info", ";", "}", "</s>"]
["<s>", "public", "Map", "<", "String", ",", "String", ">", "getMetadata", "(", ")", "{", "return", "metadata", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "int", "getCountryId", "(", ")", "{", "return", "countryId", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "int", "getSecurePort", "(", ")", "{", "return", "securePort", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "boolean", "isPortEnabled", "(", "PortType", "type", ")", "{", "if", "(", "type", "=", "=", "PortType", ".", "SECURE", ")", "{", "return", "isSecurePortEnabled", ";", "}", "else", "{", "return", "isUnsecurePortEnabled", ";", "}", "}", "</s>"]
["<s>", "public", "long", "getLastUpdatedTimestamp", "(", ")", "{", "return", "lastUpdatedTimestamp", ";", "}", "</s>"]
["<s>", "public", "void", "setLastUpdatedTimestamp", "(", ")", "{", "this", ".", "lastUpdatedTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getHomePageUrl", "(", ")", "{", "return", "homePageUrl", ";", "}", "</s>"]
["<s>", "public", "String", "getStatusPageUrl", "(", ")", "{", "return", "statusPageUrl", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "Set", "<", "String", ">", "getHealthCheckUrls", "(", ")", "{", "Set", "<", "String", ">", "healthCheckUrlSet", "=", "new", "LinkedHashSet", "<", "String", ">", "(", ")", ";", "if", "(", "this", ".", "isUnsecurePortEnabled", "&", "&", "healthCheckUrl", "!", "=", "null", "&", "&", "!", "healthCheckUrl", ".", "isEmpty", "(", ")", ")", "{", "healthCheckUrlSet", ".", "add", "(", "healthCheckUrl", ")", ";", "}", "if", "(", "this", ".", "isSecurePortEnabled", "&", "&", "secureHealthCheckUrl", "!", "=", "null", "&", "&", "!", "secureHealthCheckUrl", ".", "isEmpty", "(", ")", ")", "{", "healthCheckUrlSet", ".", "add", "(", "secureHealthCheckUrl", ")", ";", "}", "return", "healthCheckUrlSet", ";", "}", "</s>"]
["<s>", "public", "String", "getHealthCheckUrl", "(", ")", "{", "return", "healthCheckUrl", ";", "}", "</s>"]
["<s>", "public", "String", "getSecureHealthCheckUrl", "(", ")", "{", "return", "secureHealthCheckUrl", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getVIPAddress", "(", ")", "{", "return", "vipAddress", ";", "}", "</s>"]
["<s>", "public", "String", "getSecureVipAddress", "(", ")", "{", "return", "secureVipAddress", ";", "}", "</s>"]
["<s>", "public", "Long", "getLastDirtyTimestamp", "(", ")", "{", "return", "lastDirtyTimestamp", ";", "}", "</s>"]
["<s>", "public", "void", "setLastDirtyTimestamp", "(", "Long", "lastDirtyTimestamp", ")", "{", "this", ".", "lastDirtyTimestamp", "=", "lastDirtyTimestamp", ";", "}", "</s>"]
["<s>", "public", "synchronized", "InstanceStatus", "setStatus", "(", "InstanceStatus", "status", ")", "{", "if", "(", "this", ".", "status", "!", "=", "status", ")", "{", "InstanceStatus", "prev", "=", "this", ".", "status", ";", "this", ".", "status", "=", "status", ";", "setIsDirty", "(", ")", ";", "return", "prev", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setStatusWithoutDirty", "(", "InstanceStatus", "status", ")", "{", "if", "(", "this", ".", "status", "!", "=", "status", ")", "{", "this", ".", "status", "=", "status", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setOverriddenStatus", "(", "InstanceStatus", "status", ")", "{", "if", "(", "this", ".", "overriddenstatus", "!", "=", "status", ")", "{", "this", ".", "overriddenstatus", "=", "status", ";", "}", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "boolean", "isDirty", "(", ")", "{", "return", "isInstanceInfoDirty", ";", "}", "</s>"]
["<s>", "public", "synchronized", "Long", "isDirtyWithTime", "(", ")", "{", "if", "(", "isInstanceInfoDirty", ")", "{", "return", "lastDirtyTimestamp", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "synchronized", "void", "setIsDirty", "(", "boolean", "isDirty", ")", "{", "if", "(", "isDirty", ")", "{", "setIsDirty", "(", ")", ";", "}", "else", "{", "isInstanceInfoDirty", "=", "false", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setIsDirty", "(", ")", "{", "isInstanceInfoDirty", "=", "true", ";", "lastDirtyTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "unsetIsDirty", "(", "long", "unsetDirtyTimestamp", ")", "{", "if", "(", "lastDirtyTimestamp", "<", "=", "unsetDirtyTimestamp", ")", "{", "isInstanceInfoDirty", "=", "false", ";", "}", "else", "{", "}", "}", "</s>"]
["<s>", "public", "void", "setIsCoordinatingDiscoveryServer", "(", ")", "{", "String", "instanceId", "=", "getId", "(", ")", ";", "if", "(", "(", "instanceId", "!", "=", "null", ")", "&", "&", "(", "instanceId", ".", "equals", "(", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ".", "getId", "(", ")", ")", ")", ")", "{", "isCoordinatingDiscoveryServer", "=", "Boolean", ".", "TRUE", ";", "}", "else", "{", "isCoordinatingDiscoveryServer", "=", "Boolean", ".", "FALSE", ";", "}", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Boolean", "isCoordinatingDiscoveryServer", "(", ")", "{", "return", "isCoordinatingDiscoveryServer", ";", "}", "</s>"]
["<s>", "public", "ActionType", "getActionType", "(", ")", "{", "return", "actionType", ";", "}", "</s>"]
["<s>", "public", "void", "setActionType", "(", "ActionType", "actionType", ")", "{", "this", ".", "actionType", "=", "actionType", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT:Name>", "\"", ")", "public", "String", "getASGName", "(", ")", "{", "return", "this", ".", "asgName", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "JsonIgnore", "public", "String", "getVersion", "(", ")", "{", "return", "version", ";", "}", "</s>"]
["<s>", "synchronized", "void", "registerRuntimeMetadata", "(", "Map", "<", "String", ",", "String", ">", "runtimeMetadata", ")", "{", "metadata", ".", "putAll", "(", "runtimeMetadata", ")", ";", "setIsDirty", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "resolveDeploymentContextBasedVipAddresses", "(", "String", "vipAddressMacro", ")", "{", "String", "result", "=", "vipAddressMacro", ";", "if", "(", "vipAddressMacro", "=", "=", "null", ")", "{", "return", "null", ";", "}", "Matcher", "matcher", "=", "VIP_ATTRIBUTES_PATTERN", ".", "matcher", "(", "result", ")", ";", "while", "(", "matcher", ".", "find", "(", ")", ")", "{", "String", "key", "=", "matcher", ".", "group", "(", "1", ")", ";", "String", "value", "=", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ".", "getStringProperty", "(", "key", ",", "\"", "\"", ")", ".", "get", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT::>", "\"", "+", "matcher", ".", "group", "(", ")", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "key", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "value", ")", ";", "logger", ".", "debug", "(", "\"", "\"", ")", ";", "result", "=", "result", ".", "replaceAll", "(", "\"", "<STR_LIT:\\\\>", "<STR_LIT:$>", "<STR_LIT:\\\\>", "<STR_LIT:{>", "\"", "+", "key", "+", "\"", "<STR_LIT:\\\\>", "<STR_LIT:}>", "\"", ",", "value", ")", ";", "matcher", "=", "VIP_ATTRIBUTES_PATTERN", ".", "matcher", "(", "result", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "String", "getZone", "(", "String", "[", "]", "availZones", ",", "InstanceInfo", "myInfo", ")", "{", "String", "instanceZone", "=", "(", "(", "availZones", "=", "=", "null", "|", "|", "availZones", ".", "length", "=", "=", "0", ")", "?", "\"", "<STR_LIT>", "\"", ":", "availZones", "[", "0", "]", ")", ";", "if", "(", "myInfo", "!", "=", "null", "&", "&", "myInfo", ".", "getDataCenterInfo", "(", ")", ".", "getName", "(", ")", "=", "=", "DataCenterInfo", ".", "Name", ".", "Amazon", ")", "{", "String", "awsInstanceZone", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ")", ";", "if", "(", "awsInstanceZone", "!", "=", "null", ")", "{", "instanceZone", "=", "awsInstanceZone", ";", "}", "}", "return", "instanceZone", ";", "}", "</s>"]
["<s>", "String", "getId", "(", ")", ";", "</s>"]
["<s>", "public", "static", "EurekaAccept", "getClientAccept", "(", "DecoderWrapper", "decoderWrapper", ")", "{", "return", "decoderNameToAcceptMap", ".", "get", "(", "decoderWrapper", ".", "codecName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "EurekaAccept", "fromString", "(", "String", "name", ")", "{", "if", "(", "name", "=", "=", "null", "|", "|", "name", ".", "isEmpty", "(", ")", ")", "{", "return", "full", ";", "}", "try", "{", "return", "EurekaAccept", ".", "valueOf", "(", "name", ".", "toLowerCase", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "return", "full", ";", "}", "}", "</s>"]
["<s>", "private", "Builder", "(", ")", "{", "result", "=", "new", "LeaseInfo", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "newBuilder", "(", ")", "{", "return", "new", "Builder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "setRegistrationTimestamp", "(", "long", "ts", ")", "{", "result", ".", "registrationTimestamp", "=", "ts", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setRenewalTimestamp", "(", "long", "ts", ")", "{", "result", ".", "lastRenewalTimestamp", "=", "ts", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setEvictionTimestamp", "(", "long", "ts", ")", "{", "result", ".", "evictionTimestamp", "=", "ts", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setServiceUpTimestamp", "(", "long", "ts", ")", "{", "result", ".", "serviceUpTimestamp", "=", "ts", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setDurationInSecs", "(", "int", "d", ")", "{", "if", "(", "d", "<", "=", "0", ")", "{", "result", ".", "durationInSecs", "=", "DEFAULT_LEASE_DURATION", ";", "}", "else", "{", "result", ".", "durationInSecs", "=", "d", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setRenewalIntervalInSecs", "(", "int", "i", ")", "{", "if", "(", "i", "<", "=", "0", ")", "{", "result", ".", "renewalIntervalInSecs", "=", "DEFAULT_LEASE_RENEWAL_INTERVAL", ";", "}", "else", "{", "result", ".", "renewalIntervalInSecs", "=", "i", ";", "}", "return", "this", ";", "}", "</s>"]
["<s>", "public", "LeaseInfo", "build", "(", ")", "{", "return", "result", ";", "}", "</s>"]
["<s>", "private", "LeaseInfo", "(", ")", "{", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "LeaseInfo", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "int", "renewalIntervalInSecs", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "int", "durationInSecs", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "long", "registrationTimestamp", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Long", "lastRenewalTimestamp", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "long", "lastRenewalTimestampLegacy", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "long", "evictionTimestamp", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "long", "serviceUpTimestamp", ")", "{", "this", ".", "renewalIntervalInSecs", "=", "renewalIntervalInSecs", ";", "this", ".", "durationInSecs", "=", "durationInSecs", ";", "this", ".", "registrationTimestamp", "=", "registrationTimestamp", ";", "this", ".", "evictionTimestamp", "=", "evictionTimestamp", ";", "this", ".", "serviceUpTimestamp", "=", "serviceUpTimestamp", ";", "if", "(", "lastRenewalTimestamp", "=", "=", "null", ")", "{", "this", ".", "lastRenewalTimestamp", "=", "lastRenewalTimestampLegacy", ";", "}", "else", "{", "this", ".", "lastRenewalTimestamp", "=", "lastRenewalTimestamp", ";", "}", "}", "</s>"]
["<s>", "public", "long", "getRegistrationTimestamp", "(", ")", "{", "return", "registrationTimestamp", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "long", "getRenewalTimestamp", "(", ")", "{", "return", "lastRenewalTimestamp", ";", "}", "</s>"]
["<s>", "public", "long", "getEvictionTimestamp", "(", ")", "{", "return", "evictionTimestamp", ";", "}", "</s>"]
["<s>", "public", "long", "getServiceUpTimestamp", "(", ")", "{", "return", "serviceUpTimestamp", ";", "}", "</s>"]
["<s>", "public", "int", "getRenewalIntervalInSecs", "(", ")", "{", "return", "renewalIntervalInSecs", ";", "}", "</s>"]
["<s>", "public", "int", "getDurationInSecs", "(", ")", "{", "return", "durationInSecs", ";", "}", "</s>"]
["<s>", "String", "getInstanceId", "(", ")", ";", "</s>"]
["<s>", "String", "getAppname", "(", ")", ";", "</s>"]
["<s>", "String", "getAppGroupName", "(", ")", ";", "</s>"]
["<s>", "boolean", "isInstanceEnabledOnit", "(", ")", ";", "</s>"]
["<s>", "int", "getNonSecurePort", "(", ")", ";", "</s>"]
["<s>", "int", "getSecurePort", "(", ")", ";", "</s>"]
["<s>", "boolean", "isNonSecurePortEnabled", "(", ")", ";", "</s>"]
["<s>", "boolean", "getSecurePortEnabled", "(", ")", ";", "</s>"]
["<s>", "int", "getLeaseRenewalIntervalInSeconds", "(", ")", ";", "</s>"]
["<s>", "int", "getLeaseExpirationDurationInSeconds", "(", ")", ";", "</s>"]
["<s>", "String", "getVirtualHostName", "(", ")", ";", "</s>"]
["<s>", "String", "getSecureVirtualHostName", "(", ")", ";", "</s>"]
["<s>", "String", "getASGName", "(", ")", ";", "</s>"]
["<s>", "String", "getHostName", "(", "boolean", "refresh", ")", ";", "</s>"]
["<s>", "Map", "<", "String", ",", "String", ">", "getMetadataMap", "(", ")", ";", "</s>"]
["<s>", "DataCenterInfo", "getDataCenterInfo", "(", ")", ";", "</s>"]
["<s>", "String", "getIpAddress", "(", ")", ";", "</s>"]
["<s>", "String", "getStatusPageUrlPath", "(", ")", ";", "</s>"]
["<s>", "String", "getStatusPageUrl", "(", ")", ";", "</s>"]
["<s>", "String", "getHomePageUrlPath", "(", ")", ";", "</s>"]
["<s>", "String", "getHomePageUrl", "(", ")", ";", "</s>"]
["<s>", "String", "getHealthCheckUrlPath", "(", ")", ";", "</s>"]
["<s>", "String", "getHealthCheckUrl", "(", ")", ";", "</s>"]
["<s>", "String", "getSecureHealthCheckUrl", "(", ")", ";", "</s>"]
["<s>", "String", "getNamespace", "(", ")", ";", "</s>"]
["<s>", "boolean", "isHealthy", "(", ")", ";", "</s>"]
["<s>", "public", "CloudInstanceConfig", "(", ")", "{", "initCloudInstanceConfig", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "public", "CloudInstanceConfig", "(", "String", "namespace", ")", "{", "super", "(", "namespace", ")", ";", "initCloudInstanceConfig", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "private", "void", "initCloudInstanceConfig", "(", "String", "namespace", ")", "{", "propValidateInstanceId", "=", "INSTANCE", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "info", "=", "initDataCenterInfo", "(", ")", ";", "}", "</s>"]
["<s>", "private", "DataCenterInfo", "initDataCenterInfo", "(", ")", "{", "DataCenterInfo", "info", ";", "try", "{", "info", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "autoBuild", "(", "namespace", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "Name", ".", "Amazon", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "AmazonInfo", "amazonInfo", "=", "(", "AmazonInfo", ")", "info", ";", "if", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "instanceId", ")", "=", "=", "null", ")", "{", "if", "(", "propValidateInstanceId", ".", "get", "(", ")", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "namespace", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "Map", "<", "String", ",", "String", ">", "metadataMap", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "metadataMap", ".", "put", "(", "MetaDataKey", ".", "instanceId", ".", "getName", "(", ")", ",", "super", ".", "getIpAddress", "(", ")", ")", ";", "metadataMap", ".", "put", "(", "MetaDataKey", ".", "publicHostname", ".", "getName", "(", ")", ",", "super", ".", "getHostName", "(", "false", ")", ")", ";", "amazonInfo", ".", "setMetadata", "(", "metadataMap", ")", ";", "}", "}", "else", "if", "(", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", "=", "=", "null", ")", "&", "&", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "localIpv4", ")", "!", "=", "null", ")", ")", "{", "amazonInfo", ".", "getMetadata", "(", ")", ".", "put", "(", "MetaDataKey", ".", "publicHostname", ".", "getName", "(", ")", ",", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "localIpv4", ")", ")", ")", ";", "}", "return", "info", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHostName", "(", "boolean", "refresh", ")", "{", "if", "(", "refresh", ")", "{", "refreshAmazonInfo", "(", ")", ";", "}", "return", "(", "(", "AmazonInfo", ")", "info", ")", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "DataCenterInfo", "getDataCenterInfo", "(", ")", "{", "return", "info", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "refreshAmazonInfo", "(", ")", "{", "try", "{", "AmazonInfo", "newInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "autoBuild", "(", "namespace", ")", ";", "String", "newHostname", "=", "newInfo", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ";", "String", "existingHostname", "=", "(", "(", "AmazonInfo", ")", "info", ")", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ";", "if", "(", "newHostname", "!", "=", "null", "&", "&", "!", "newHostname", ".", "equals", "(", "existingHostname", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "existingHostname", ",", "newHostname", ")", ";", "this", ".", "info", "=", "newInfo", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "}", "}", "</s>"]
["<s>", "Name", "getName", "(", ")", ";", "</s>"]
["<s>", "public", "HealthCheckCallbackToHandlerBridge", "(", ")", "{", "callback", "=", "null", ";", "}", "</s>"]
["<s>", "public", "HealthCheckCallbackToHandlerBridge", "(", "HealthCheckCallback", "callback", ")", "{", "this", ".", "callback", "=", "callback", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", ".", "InstanceStatus", "getStatus", "(", "InstanceInfo", ".", "InstanceStatus", "currentStatus", ")", "{", "if", "(", "null", "=", "=", "callback", "|", "|", "InstanceInfo", ".", "InstanceStatus", ".", "STARTING", "=", "=", "currentStatus", "|", "|", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", "=", "=", "currentStatus", ")", "{", "return", "currentStatus", ";", "}", "return", "callback", ".", "isHealthy", "(", ")", "?", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ":", "InstanceInfo", ".", "InstanceStatus", ".", "DOWN", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "MyDataCenterInfo", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Name", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "public", "EurekaClientIdentity", "(", "String", "id", ")", "{", "this", ".", "id", "=", "id", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "DEFAULT_CLIENT_NAME", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getVersion", "(", ")", "{", "return", "clientVersion", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "URL", "getURL", "(", "String", "prepend", ",", "String", "mac", ")", "throws", "MalformedURLException", "{", "return", "new", "URL", "(", "AWS_METADATA_URL", "+", "this", ".", "path", "+", "mac", "+", "\"", "<STR_LIT:/>", "\"", "+", "this", ".", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "URL", "getURL", "(", "String", "prepend", ",", "String", "append", ")", "throws", "MalformedURLException", "{", "return", "new", "URL", "(", "\"", "<STR_LIT>", "\"", "+", "AWS_API_VERSION", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "String", "read", "(", "InputStream", "inputStream", ")", "throws", "IOException", "{", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "inputStream", ")", ")", ";", "try", "{", "String", "toReturn", "=", "null", ";", "String", "inputLine", ";", "while", "(", "(", "inputLine", "=", "br", ".", "readLine", "(", ")", ")", "!", "=", "null", ")", "{", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "inputLine", ")", ";", "if", "(", "toReturn", "=", "=", "null", "&", "&", "matcher", ".", "find", "(", ")", ")", "{", "toReturn", "=", "matcher", ".", "group", "(", "1", ")", ";", "}", "}", "return", "toReturn", ";", "}", "finally", "{", "br", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "MetaDataKey", "(", "String", "name", ")", "{", "this", "(", "name", ",", "\"", "\"", ")", ";", "}", "</s>"]
["<s>", "MetaDataKey", "(", "String", "name", ",", "String", "path", ")", "{", "this", ".", "name", "=", "name", ";", "this", ".", "path", "=", "path", ";", "}", "</s>"]
["<s>", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "public", "URL", "getURL", "(", "String", "prepend", ",", "String", "append", ")", "throws", "MalformedURLException", "{", "return", "new", "URL", "(", "AWS_METADATA_URL", "+", "path", "+", "name", ")", ";", "}", "</s>"]
["<s>", "protected", "String", "read", "(", "InputStream", "inputStream", ")", "throws", "IOException", "{", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "inputStream", ")", ")", ";", "String", "toReturn", ";", "try", "{", "String", "line", "=", "br", ".", "readLine", "(", ")", ";", "toReturn", "=", "line", ";", "while", "(", "line", "!", "=", "null", ")", "{", "line", "=", "br", ".", "readLine", "(", ")", ";", "}", "return", "toReturn", ";", "}", "finally", "{", "br", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Builder", "(", ")", "{", "result", "=", "new", "AmazonInfo", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "newBuilder", "(", ")", "{", "return", "new", "Builder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "addMetadata", "(", "MetaDataKey", "key", ",", "String", "value", ")", "{", "result", ".", "metadata", ".", "put", "(", "key", ".", "getName", "(", ")", ",", "value", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "AmazonInfo", "build", "(", ")", "{", "return", "result", ";", "}", "</s>"]
["<s>", "public", "AmazonInfo", "autoBuild", "(", "String", "namespace", ")", "{", "initProperties", "(", "namespace", ")", ";", "for", "(", "MetaDataKey", "key", ":", "MetaDataKey", ".", "values", "(", ")", ")", "{", "int", "numOfRetries", "=", "awsMetaDataRetries", ".", "get", "(", ")", ";", "while", "(", "numOfRetries", "-", "-", ">", "0", ")", "{", "try", "{", "String", "mac", "=", "null", ";", "if", "(", "key", "=", "=", "MetaDataKey", ".", "vpcId", ")", "{", "mac", "=", "result", ".", "metadata", ".", "get", "(", "MetaDataKey", ".", "mac", ".", "name", "(", ")", ")", ";", "}", "URL", "url", "=", "key", ".", "getURL", "(", "null", ",", "mac", ")", ";", "HttpURLConnection", "uc", "=", "(", "HttpURLConnection", ")", "url", ".", "openConnection", "(", ")", ";", "uc", ".", "setConnectTimeout", "(", "awsMetaDataConnectTimeout", ".", "get", "(", ")", ")", ";", "uc", ".", "setReadTimeout", "(", "awsMetaDataReadTimeout", ".", "get", "(", ")", ")", ";", "if", "(", "uc", ".", "getResponseCode", "(", ")", "!", "=", "HttpURLConnection", ".", "HTTP_OK", ")", "{", "BufferedReader", "br", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "uc", ".", "getErrorStream", "(", ")", ")", ")", ";", "try", "{", "while", "(", "br", ".", "readLine", "(", ")", "!", "=", "null", ")", "{", "}", "}", "finally", "{", "br", ".", "close", "(", ")", ";", "}", "}", "else", "{", "String", "value", "=", "key", ".", "read", "(", "uc", ".", "getInputStream", "(", ")", ")", ";", "if", "(", "value", "!", "=", "null", ")", "{", "result", ".", "metadata", ".", "put", "(", "key", ".", "getName", "(", ")", ",", "value", ")", ";", "}", "}", "break", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "if", "(", "shouldLogAWSMetadataError", ".", "get", "(", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "key", "+", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "if", "(", "numOfRetries", ">", "=", "0", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "SLEEP_TIME_MS", ")", ";", "}", "catch", "(", "InterruptedException", "e1", ")", "{", "}", "continue", ";", "}", "}", "}", "}", "return", "result", ";", "}", "</s>"]
["<s>", "private", "void", "initProperties", "(", "String", "namespace", ")", "{", "if", "(", "shouldLogAWSMetadataError", "=", "=", "null", ")", "{", "shouldLogAWSMetadataError", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "}", "if", "(", "awsMetaDataReadTimeout", "=", "=", "null", ")", "{", "awsMetaDataReadTimeout", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "}", "if", "(", "awsMetaDataConnectTimeout", "=", "=", "null", ")", "{", "awsMetaDataConnectTimeout", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "}", "if", "(", "awsMetaDataRetries", "=", "=", "null", ")", "{", "awsMetaDataRetries", "=", "com", ".", "netflix", ".", "config", ".", "DynamicPropertyFactory", ".", "getInstance", "(", ")", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:3>", ")", ";", "}", "}", "</s>"]
["<s>", "public", "AmazonInfo", "(", ")", "{", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "AmazonInfo", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "name", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "HashMap", "<", "String", ",", "String", ">", "metadata", ")", "{", "this", ".", "metadata", "=", "metadata", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "Amazon", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Map", "<", "String", ",", "String", ">", "getMetadata", "(", ")", "{", "return", "metadata", ";", "}", "</s>"]
["<s>", "public", "void", "setMetadata", "(", "Map", "<", "String", ",", "String", ">", "metadataMap", ")", "{", "this", ".", "metadata", "=", "metadataMap", ";", "}", "</s>"]
["<s>", "public", "String", "get", "(", "MetaDataKey", "key", ")", "{", "return", "metadata", ".", "get", "(", "key", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "JsonIgnore", "public", "String", "getId", "(", ")", "{", "return", "get", "(", "MetaDataKey", ".", "instanceId", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "EurekaConfigBasedInstanceInfoProvider", "(", "EurekaInstanceConfig", "config", ")", "{", "this", ".", "config", "=", "config", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "InstanceInfo", "get", "(", ")", "{", "if", "(", "instanceInfo", "=", "=", "null", ")", "{", "LeaseInfo", ".", "Builder", "leaseInfoBuilder", "=", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setRenewalIntervalInSecs", "(", "config", ".", "getLeaseRenewalIntervalInSeconds", "(", ")", ")", ".", "setDurationInSecs", "(", "config", ".", "getLeaseExpirationDurationInSeconds", "(", ")", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "String", "instanceId", "=", "config", ".", "getInstanceId", "(", ")", ";", "DataCenterInfo", "dataCenterInfo", "=", "config", ".", "getDataCenterInfo", "(", ")", ";", "if", "(", "instanceId", "=", "=", "null", "|", "|", "instanceId", ".", "isEmpty", "(", ")", ")", "{", "if", "(", "dataCenterInfo", "instanceof", "UniqueIdentifier", ")", "{", "instanceId", "=", "(", "(", "UniqueIdentifier", ")", "dataCenterInfo", ")", ".", "getId", "(", ")", ";", "}", "else", "{", "instanceId", "=", "config", ".", "getHostName", "(", "false", ")", ";", "}", "}", "builder", ".", "setNamespace", "(", "config", ".", "getNamespace", "(", ")", ")", ".", "setInstanceId", "(", "instanceId", ")", ".", "setAppName", "(", "config", ".", "getAppname", "(", ")", ")", ".", "setAppGroupName", "(", "config", ".", "getAppGroupName", "(", ")", ")", ".", "setDataCenterInfo", "(", "config", ".", "getDataCenterInfo", "(", ")", ")", ".", "setIPAddr", "(", "config", ".", "getIpAddress", "(", ")", ")", ".", "setHostName", "(", "config", ".", "getHostName", "(", "false", ")", ")", ".", "setPort", "(", "config", ".", "getNonSecurePort", "(", ")", ")", ".", "enablePort", "(", "PortType", ".", "UNSECURE", ",", "config", ".", "isNonSecurePortEnabled", "(", ")", ")", ".", "setSecurePort", "(", "config", ".", "getSecurePort", "(", ")", ")", ".", "enablePort", "(", "PortType", ".", "SECURE", ",", "config", ".", "getSecurePortEnabled", "(", ")", ")", ".", "setVIPAddress", "(", "config", ".", "getVirtualHostName", "(", ")", ")", ".", "setSecureVIPAddress", "(", "config", ".", "getSecureVirtualHostName", "(", ")", ")", ".", "setHomePageUrl", "(", "config", ".", "getHomePageUrlPath", "(", ")", ",", "config", ".", "getHomePageUrl", "(", ")", ")", ".", "setStatusPageUrl", "(", "config", ".", "getStatusPageUrlPath", "(", ")", ",", "config", ".", "getStatusPageUrl", "(", ")", ")", ".", "setASGName", "(", "config", ".", "getASGName", "(", ")", ")", ".", "setHealthCheckUrls", "(", "config", ".", "getHealthCheckUrlPath", "(", ")", ",", "config", ".", "getHealthCheckUrl", "(", ")", ",", "config", ".", "getSecureHealthCheckUrl", "(", ")", ")", ";", "if", "(", "!", "config", ".", "isInstanceEnabledOnit", "(", ")", ")", "{", "InstanceStatus", "initialStatus", "=", "InstanceStatus", ".", "STARTING", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "initialStatus", ")", ";", "builder", ".", "setStatus", "(", "initialStatus", ")", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "InstanceStatus", ".", "UP", ")", ";", "}", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "mapEntry", ":", "config", ".", "getMetadataMap", "(", ")", ".", "entrySet", "(", ")", ")", "{", "String", "key", "=", "mapEntry", ".", "getKey", "(", ")", ";", "String", "value", "=", "mapEntry", ".", "getValue", "(", ")", ";", "builder", ".", "add", "(", "key", ",", "value", ")", ";", "}", "instanceInfo", "=", "builder", ".", "build", "(", ")", ";", "instanceInfo", ".", "setLeaseInfo", "(", "leaseInfoBuilder", ".", "build", "(", ")", ")", ";", "}", "return", "instanceInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "CloudInstanceConfig", "get", "(", ")", "{", "if", "(", "config", "=", "=", "null", ")", "{", "if", "(", "namespace", "=", "=", "null", ")", "{", "config", "=", "new", "CloudInstanceConfig", "(", ")", ";", "}", "else", "{", "config", "=", "new", "CloudInstanceConfig", "(", "namespace", ")", ";", "}", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setEurekaInstanceConfig", "(", "config", ")", ";", "}", "return", "config", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "MyDataCenterInstanceConfig", "get", "(", ")", "{", "if", "(", "config", "=", "=", "null", ")", "{", "if", "(", "namespace", "=", "=", "null", ")", "{", "config", "=", "new", "MyDataCenterInstanceConfig", "(", ")", ";", "}", "else", "{", "config", "=", "new", "MyDataCenterInstanceConfig", "(", "namespace", ")", ";", "}", "DiscoveryManager", ".", "getInstance", "(", ")", ".", "setEurekaInstanceConfig", "(", "config", ")", ";", "}", "return", "config", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "Ec2EurekaArchaius2InstanceConfig", "(", "Config", "config", ")", "{", "this", "(", "config", ",", "DEFAULT_NAMESPACE", ")", ";", "}", "</s>"]
["<s>", "public", "Ec2EurekaArchaius2InstanceConfig", "(", "Config", "config", ",", "String", "namespace", ")", "{", "super", "(", "config", ",", "namespace", ")", ";", "try", "{", "this", ".", "info", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "autoBuild", "(", "namespace", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "Name", ".", "Amazon", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "AmazonInfo", "amazonInfo", "=", "(", "AmazonInfo", ")", "info", ";", "if", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "instanceId", ")", "=", "=", "null", ")", "{", "if", "(", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "Map", "<", "String", ",", "String", ">", "metadataMap", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "metadataMap", ".", "put", "(", "MetaDataKey", ".", "instanceId", ".", "getName", "(", ")", ",", "super", ".", "getIpAddress", "(", ")", ")", ";", "metadataMap", ".", "put", "(", "MetaDataKey", ".", "publicHostname", ".", "getName", "(", ")", ",", "super", ".", "getHostName", "(", "false", ")", ")", ";", "amazonInfo", ".", "setMetadata", "(", "metadataMap", ")", ";", "}", "}", "else", "if", "(", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", "=", "=", "null", ")", "&", "&", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "localIpv4", ")", "!", "=", "null", ")", ")", "{", "amazonInfo", ".", "getMetadata", "(", ")", ".", "put", "(", "MetaDataKey", ".", "publicHostname", ".", "getName", "(", ")", ",", "(", "amazonInfo", ".", "get", "(", "MetaDataKey", ".", "localIpv4", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHostName", "(", "boolean", "refresh", ")", "{", "if", "(", "refresh", ")", "{", "refreshAmazonInfo", "(", ")", ";", "}", "return", "(", "(", "AmazonInfo", ")", "info", ")", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "DataCenterInfo", "getDataCenterInfo", "(", ")", "{", "return", "info", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "refreshAmazonInfo", "(", ")", "{", "try", "{", "AmazonInfo", "newInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "autoBuild", "(", "DEFAULT_NAMESPACE", ")", ";", "String", "newHostname", "=", "newInfo", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ";", "String", "existingHostname", "=", "(", "(", "AmazonInfo", ")", "info", ")", ".", "get", "(", "MetaDataKey", ".", "publicHostname", ")", ";", "if", "(", "newHostname", "!", "=", "null", "&", "&", "!", "newHostname", ".", "equals", "(", "existingHostname", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "existingHostname", ",", "newHostname", ")", ";", "this", ".", "info", "=", "newInfo", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Inject", "public", "EurekaArchaius2InstanceConfig", "(", "Config", "config", ")", "{", "this", "(", "config", ",", "DEFAULT_NAMESPACE", ")", ";", "}", "</s>"]
["<s>", "public", "EurekaArchaius2InstanceConfig", "(", "Config", "config", ",", "String", "namespace", ")", "{", "this", "(", "config", ",", "namespace", ",", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "public", "EurekaArchaius2InstanceConfig", "(", "Config", "config", ",", "String", "namespace", ",", "DataCenterInfo", "dcInfo", ")", "{", "this", ".", "defaultAppGroup", "=", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "this", ".", "namespace", "=", "namespace", ";", "this", ".", "config", "=", "config", ".", "getPrefixedView", "(", "namespace", ")", ";", "this", ".", "dcInfo", "=", "dcInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getInstanceId", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAppname", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "UNKNOWN_APPLICATION", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAppGroupName", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "defaultAppGroup", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isInstanceEnabledOnit", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "isInstanceEnabledOnit", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNonSecurePort", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "getNonSecurePort", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getSecurePort", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "getSecurePort", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isNonSecurePortEnabled", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "isNonSecurePortEnabled", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "getSecurePortEnabled", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "getSecurePortEnabled", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLeaseRenewalIntervalInSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "getLeaseRenewalIntervalInSeconds", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLeaseExpirationDurationInSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "getLeaseExpirationDurationInSeconds", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getVirtualHostName", "(", ")", "{", "return", "this", ".", "isNonSecurePortEnabled", "(", ")", "?", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "super", ".", "getVirtualHostName", "(", ")", ")", ":", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getSecureVirtualHostName", "(", ")", "{", "return", "this", ".", "getSecurePortEnabled", "(", ")", "?", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ":", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getASGName", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT:Name>", "\"", ",", "super", ".", "getASGName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getMetadataMap", "(", ")", "{", "Map", "<", "String", ",", "String", ">", "meta", "=", "new", "HashMap", "<", ">", "(", ")", ";", "Config", "config", "=", "this", ".", "config", ".", "getPrefixedView", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "String", "key", ":", "Sets", ".", "newHashSet", "(", "config", ".", "getKeys", "(", ")", ")", ")", "{", "meta", ".", "put", "(", "key", ",", "config", ".", "getString", "(", "key", ")", ")", ";", "}", "return", "meta", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "DataCenterInfo", "getDataCenterInfo", "(", ")", "{", "return", "dcInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getStatusPageUrlPath", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getStatusPageUrl", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHomePageUrlPath", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:/>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHomePageUrl", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHealthCheckUrlPath", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHealthCheckUrl", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getSecureHealthCheckUrl", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getNamespace", "(", ")", "{", "return", "namespace", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "requireBinding", "(", "Config", ".", "class", ")", ";", "bind", "(", "EurekaInstanceConfig", ".", "class", ")", ".", "to", "(", "CloudInstanceConfig", ".", "class", ")", ";", "bind", "(", "EurekaArchaius2ClientConfig", ".", "class", ")", ".", "to", "(", "EurekaArchaius2ClientConfig", ".", "class", ")", ";", "bind", "(", "InstanceInfo", ".", "class", ")", ".", "toProvider", "(", "EurekaConfigBasedInstanceInfoProvider", ".", "class", ")", ";", "bind", "(", "EurekaClient", ".", "class", ")", ".", "to", "(", "DiscoveryClient", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "return", "EurekaArchaius2Module", ".", "class", ".", "equals", "(", "obj", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "EurekaArchaius2Module", ".", "class", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "EurekaArchaius2ClientConfig", "(", "Config", "config", ")", "{", "this", "(", "config", ",", "DEFAULT_NAMESPACE", ")", ";", "}", "</s>"]
["<s>", "public", "EurekaArchaius2ClientConfig", "(", "Config", "config", ",", "String", "namespace", ")", "{", "this", ".", "defaultRegion", "=", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "this", ".", "config", "=", "config", ".", "getPrefixedView", "(", "namespace", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getRegistryFetchIntervalSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getInstanceInfoReplicationIntervalSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getInitialInstanceInfoReplicationIntervalSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getEurekaServiceUrlPollIntervalSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getProxyHost", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getProxyPort", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getProxyUserName", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getProxyPassword", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldGZipContent", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getEurekaServerReadTimeoutSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:8>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getEurekaServerConnectTimeoutSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getBackupRegistryImpl", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getEurekaServerTotalConnections", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getEurekaServerTotalConnectionsPerHost", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getEurekaServerURLContext", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getEurekaServerPort", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getEurekaServerDNSName", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldUseDnsForFetchingServiceUrls", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldRegisterWithEureka", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldPreferSameZoneEureka", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "allowRedirects", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldLogDeltaDiff", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldDisableDelta", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "String", "fetchRegistryForRemoteRegions", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getRegion", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "defaultRegion", ")", ";", "}", "</s>"]
["<s>", "public", "String", "[", "]", "getAvailabilityZones", "(", "String", "region", ")", "{", "return", "config", ".", "getString", "(", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "region", ")", ",", "DEFAULT_ZONE", ")", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getEurekaServerServiceUrls", "(", "String", "myZone", ")", "{", "String", "serviceUrls", "=", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", "+", "myZone", ",", "null", ")", ";", "if", "(", "serviceUrls", "=", "=", "null", "|", "|", "serviceUrls", ".", "isEmpty", "(", ")", ")", "{", "serviceUrls", "=", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "return", "serviceUrls", "!", "=", "null", "?", "Arrays", ".", "asList", "(", "serviceUrls", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ")", ":", "Collections", ".", "<", "String", ">", "emptyList", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldFilterOnlyUpInstances", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getEurekaConnectionIdleTimeoutSeconds", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldFetchRegistry", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getRegistryRefreshSingleVipAddress", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getHeartbeatExecutorThreadPoolSize", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getHeartbeatExecutorExponentialBackOffBound", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getCacheRefreshExecutorThreadPoolSize", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getCacheRefreshExecutorExponentialBackOffBound", "(", ")", "{", "return", "config", ".", "getInteger", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getDollarReplacement", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getEscapeCharReplacement", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldOnDemandUpdateStatusChange", "(", ")", "{", "return", "config", ".", "getBoolean", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getEncoderName", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getDecoderName", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getClientDataAccept", "(", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ",", "EurekaAccept", ".", "full", ".", "name", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getExperimental", "(", "String", "name", ")", "{", "return", "config", ".", "getString", "(", "\"", "<STR_LIT:.>", "\"", "+", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ")", ";", "doReturn", "(", "<NUM_LIT:10>", ")", ".", "when", "(", "serverConfig", ")", ".", "getWaitTimeInMsWhenSyncEmpty", "(", ")", ";", "doReturn", "(", "1", ")", ".", "when", "(", "serverConfig", ")", ".", "getRegistrySyncRetries", "(", ")", ";", "doReturn", "(", "<NUM_LIT>", ")", ".", "when", "(", "serverConfig", ")", ".", "getRegistrySyncRetryWaitMs", "(", ")", ";", "registry", ".", "syncUp", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSoftDepRemoteDown", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "registry", ".", "shouldAllowAccess", "(", "false", ")", ")", ";", "Assert", ".", "assertFalse", "(", "\"", "<STR_LIT>", "\"", ",", "registry", ".", "shouldAllowAccess", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "MockRemoteEurekaServer", "newMockRemoteServer", "(", ")", "{", "MockRemoteEurekaServer", "server", "=", "super", ".", "newMockRemoteServer", "(", ")", ";", "server", ".", "simulateNotReady", "(", "true", ")", ";", "return", "server", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "RateLimitingFilter", ".", "reset", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "PYTHON_CLIENT", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "1", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "1", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "ApplicationInfoManager", "applicationInfoManager", "=", "new", "ApplicationInfoManager", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ")", ";", "DefaultEurekaServerConfig", "config", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "EurekaServerContext", "mockServer", "=", "mock", "(", "EurekaServerContext", ".", "class", ")", ";", "when", "(", "mockServer", ".", "getServerConfig", "(", ")", ")", ".", "thenReturn", "(", "config", ")", ";", "filter", "=", "new", "RateLimitingFilter", "(", "mockServer", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPrivilegedClientAlwaysServed", "(", ")", "throws", "Exception", "{", "whenRequest", "(", "FULL_FETCH", ",", "PYTHON_CLIENT", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "whenRequest", "(", "DELTA_FETCH", ",", "EurekaClientIdentity", ".", "DEFAULT_CLIENT_NAME", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "whenRequest", "(", "APP_FETCH", ",", "EurekaServerIdentity", ".", "DEFAULT_SERVER_NAME", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "verify", "(", "filterChain", ",", "times", "(", "<NUM_LIT:3>", ")", ")", ".", "doFilter", "(", "request", ",", "response", ")", ";", "verify", "(", "response", ",", "never", "(", ")", ")", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStandardClientsThrottlingEnforceable", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "whenRequest", "(", "FULL_FETCH", ",", "EurekaClientIdentity", ".", "DEFAULT_CLIENT_NAME", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "verify", "(", "filterChain", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "doFilter", "(", "request", ",", "response", ")", ";", "long", "rateLimiterCounter", "=", "EurekaMonitors", ".", "RATE_LIMITED", ".", "getCount", "(", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "rateLimiterCounter", "+", "1", ",", "EurekaMonitors", ".", "RATE_LIMITED", ".", "getCount", "(", ")", ")", ";", "verify", "(", "response", ",", "times", "(", "1", ")", ")", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCustomClientShedding", "(", ")", "throws", "Exception", "{", "whenRequest", "(", "FULL_FETCH", ",", "CUSTOM_CLIENT", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "verify", "(", "filterChain", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "doFilter", "(", "request", ",", "response", ")", ";", "long", "rateLimiterCounter", "=", "EurekaMonitors", ".", "RATE_LIMITED", ".", "getCount", "(", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "rateLimiterCounter", "+", "1", ",", "EurekaMonitors", ".", "RATE_LIMITED", ".", "getCount", "(", ")", ")", ";", "verify", "(", "response", ",", "times", "(", "1", ")", ")", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCustomClientThrottlingCandidatesCounter", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "whenRequest", "(", "FULL_FETCH", ",", "CUSTOM_CLIENT", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "verify", "(", "filterChain", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "doFilter", "(", "request", ",", "response", ")", ";", "long", "rateLimiterCounter", "=", "EurekaMonitors", ".", "RATE_LIMITED_CANDIDATES", ".", "getCount", "(", ")", ";", "filter", ".", "doFilter", "(", "request", ",", "response", ",", "filterChain", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "rateLimiterCounter", "+", "1", ",", "EurekaMonitors", ".", "RATE_LIMITED_CANDIDATES", ".", "getCount", "(", ")", ")", ";", "verify", "(", "response", ",", "times", "(", "0", ")", ")", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "}", "</s>"]
["<s>", "private", "void", "whenRequest", "(", "String", "path", ",", "String", "client", ")", "{", "when", "(", "request", ".", "getMethod", "(", ")", ")", ".", "thenReturn", "(", "\"", "<STR_LIT:GET>", "\"", ")", ";", "when", "(", "request", ".", "getRequestURI", "(", ")", ")", ".", "thenReturn", "(", "path", ")", ";", "when", "(", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_NAME_HEADER_KEY", ")", ")", ".", "thenReturn", "(", "client", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoteRegionUrlsWithName2Regions", "(", ")", "throws", "Exception", "{", "String", "region1", "=", "\"", "<STR_LIT:1>", "\"", ";", "String", "region1url", "=", "\"", "<STR_LIT>", "\"", ";", "String", "region2", "=", "\"", "<STR_LIT:2>", "\"", ";", "String", "region2url", "=", "\"", "<STR_LIT>", "\"", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "region1", "+", "<CHAR_LIT:;>", "+", "region1url", "+", "<CHAR_LIT:U+002C>", "+", "region2", "+", "<CHAR_LIT:;>", "+", "region2url", ")", ";", "DefaultEurekaServerConfig", "config", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "Map", "<", "String", ",", "String", ">", "remoteRegionUrlsWithName", "=", "config", ".", "getRemoteRegionUrlsWithName", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "remoteRegionUrlsWithName", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "remoteRegionUrlsWithName", ".", "containsKey", "(", "region1", ")", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "remoteRegionUrlsWithName", ".", "containsKey", "(", "region2", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "region1url", ",", "remoteRegionUrlsWithName", ".", "get", "(", "region1", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "region2url", ",", "remoteRegionUrlsWithName", ".", "get", "(", "region2", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRemoteRegionUrlsWithName1Region", "(", ")", "throws", "Exception", "{", "String", "region1", "=", "\"", "<STR_LIT:1>", "\"", ";", "String", "region1url", "=", "\"", "<STR_LIT>", "\"", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "region1", "+", "<CHAR_LIT:;>", "+", "region1url", ")", ";", "DefaultEurekaServerConfig", "config", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "Map", "<", "String", ",", "String", ">", "remoteRegionUrlsWithName", "=", "config", ".", "getRemoteRegionUrlsWithName", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "remoteRegionUrlsWithName", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "remoteRegionUrlsWithName", ".", "containsKey", "(", "region1", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "region1url", ",", "remoteRegionUrlsWithName", ".", "get", "(", "region1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetGlobalAppWhiteList", "(", ")", "throws", "Exception", "{", "String", "whitelistApp", "=", "\"", "<STR_LIT>", "\"", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "whitelistApp", ")", ";", "DefaultEurekaServerConfig", "config", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "Set", "<", "String", ">", "globalList", "=", "config", ".", "getRemoteRegionAppWhitelist", "(", "null", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "globalList", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "globalList", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "whitelistApp", ",", "globalList", ".", "iterator", "(", ")", ".", "next", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetRegionAppWhiteList", "(", ")", "throws", "Exception", "{", "String", "globalWhiteListApp", "=", "\"", "<STR_LIT>", "\"", ";", "String", "regionWhiteListApp", "=", "\"", "<STR_LIT>", "\"", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "globalWhiteListApp", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "regionWhiteListApp", ")", ";", "DefaultEurekaServerConfig", "config", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "Set", "<", "String", ">", "regionList", "=", "config", ".", "getRemoteRegionAppWhitelist", "(", "null", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "regionList", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "regionList", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "regionWhiteListApp", ",", "regionList", ".", "iterator", "(", ")", ".", "next", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:10>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", "+", "REMOTE_REGION_NAME", "+", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:5>", "\"", ")", ";", "populateRemoteRegistryAtStartup", "(", ")", ";", "mockRemoteEurekaServer", "=", "newMockRemoteServer", "(", ")", ";", "mockRemoteEurekaServer", ".", "start", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION_NAME", "+", "\"", "<STR_LIT>", "\"", "+", "mockRemoteEurekaServer", ".", "getPort", "(", ")", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "serverConfig", "=", "spy", "(", "new", "DefaultEurekaServerConfig", "(", ")", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setAppName", "(", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "builder", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "build", "(", ")", ")", ";", "builder", ".", "setDataCenterInfo", "(", "new", "DataCenterInfo", "(", ")", "{", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "}", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "+", "mockRemoteEurekaServer", ".", "getPort", "(", ")", "+", "MockRemoteEurekaServer", ".", "EUREKA_API_BASE_PATH", ")", ";", "DefaultEurekaClientConfig", "clientConfig", "=", "new", "DefaultEurekaClientConfig", "(", ")", ";", "ApplicationInfoManager", "applicationInfoManager", "=", "new", "ApplicationInfoManager", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ",", "builder", ".", "build", "(", ")", ")", ";", "client", "=", "new", "DiscoveryClient", "(", "applicationInfoManager", ",", "clientConfig", ")", ";", "ServerCodecs", "serverCodecs", "=", "new", "DefaultServerCodecs", "(", "serverConfig", ")", ";", "registry", "=", "new", "TestPeerAwareInstanceRegistry", "(", "serverConfig", ",", "clientConfig", ",", "serverCodecs", ",", "client", ")", ";", "serverContext", "=", "new", "DefaultEurekaServerContext", "(", "serverConfig", ",", "serverCodecs", ",", "registry", ",", "mock", "(", "PeerEurekaNodes", ".", "class", ")", ",", "applicationInfoManager", ")", ";", "serverContext", ".", "initialize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Name", "getName", "(", ")", "{", "return", "Name", ".", "MyOwn", ";", "}", "</s>"]
["<s>", "protected", "MockRemoteEurekaServer", "newMockRemoteServer", "(", ")", "{", "return", "new", "MockRemoteEurekaServer", "(", "0", ",", "remoteRegionApps", ",", "remoteRegionAppsDelta", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "for", "(", "Pair", "<", "String", ",", "String", ">", "registeredApp", ":", "registeredApps", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "registeredApp", ".", "first", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "registry", ".", "cancel", "(", "registeredApp", ".", "first", "(", ")", ",", "registeredApp", ".", "second", "(", ")", ",", "false", ")", ";", "}", "serverContext", ".", "shutdown", "(", ")", ";", "mockRemoteEurekaServer", ".", "stop", "(", ")", ";", "remoteRegionApps", ".", "clear", "(", ")", ";", "remoteRegionAppsDelta", ".", "clear", "(", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Application", "createRemoteApps", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "REMOTE_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createRemoteInstance", "(", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "private", "static", "Application", "createRemoteAppsDelta", "(", ")", "{", "Application", "myapp", "=", "new", "Application", "(", "REMOTE_REGION_APP_NAME", ")", ";", "InstanceInfo", "instanceInfo", "=", "createRemoteInstance", "(", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ")", ";", "myapp", ".", "addInstance", "(", "instanceInfo", ")", ";", "return", "myapp", ";", "}", "</s>"]
["<s>", "protected", "static", "InstanceInfo", "createRemoteInstance", "(", "String", "instanceHostName", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "REMOTE_REGION_APP_NAME", ")", ";", "instanceBuilder", ".", "setHostName", "(", "instanceHostName", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "getAmazonInfo", "(", "REMOTE_ZONE", ",", "instanceHostName", ")", ")", ";", "instanceBuilder", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "build", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "static", "InstanceInfo", "createLocalInstance", "(", "String", "hostname", ")", "{", "InstanceInfo", ".", "Builder", "instanceBuilder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "instanceBuilder", ".", "setAppName", "(", "LOCAL_REGION_APP_NAME", ")", ";", "instanceBuilder", ".", "setHostName", "(", "hostname", ")", ";", "instanceBuilder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "instanceBuilder", ".", "setDataCenterInfo", "(", "getAmazonInfo", "(", "null", ",", "hostname", ")", ")", ";", "instanceBuilder", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "build", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "AmazonInfo", "getAmazonInfo", "(", "@", "Nullable", "String", "availabilityZone", ",", "String", "instanceHostName", ")", "{", "AmazonInfo", ".", "Builder", "azBuilder", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ",", "null", "=", "=", "availabilityZone", "?", "\"", "<STR_LIT>", "\"", ":", "availabilityZone", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceId", ",", "instanceHostName", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "amiId", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "instanceType", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "localIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicIpv4", ",", "\"", "<STR_LIT>", "\"", ")", ";", "azBuilder", ".", "addMetadata", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicHostname", ",", "instanceHostName", ")", ";", "return", "azBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "populateRemoteRegistryAtStartup", "(", ")", "{", "Application", "myapp", "=", "createRemoteApps", "(", ")", ";", "Application", "myappDelta", "=", "createRemoteAppsDelta", "(", ")", ";", "remoteRegionApps", ".", "put", "(", "REMOTE_REGION_APP_NAME", ",", "myapp", ")", ";", "remoteRegionAppsDelta", ".", "put", "(", "REMOTE_REGION_APP_NAME", ",", "myappDelta", ")", ";", "}", "</s>"]
["<s>", "public", "TestPeerAwareInstanceRegistry", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "ServerCodecs", "serverCodecs", ",", "EurekaClient", "eurekaClient", ")", "{", "super", "(", "serverConfig", ",", "clientConfig", ",", "serverCodecs", ",", "eurekaClient", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isLeaseExpirationEnabled", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "getNextServerFromEureka", "(", "String", "virtualHostname", ",", "boolean", "secure", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "httpReplicationClient", ".", "withNetworkStatusCode", "(", "<NUM_LIT>", ")", ";", "httpReplicationClient", ".", "withBatchReply", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "if", "(", "peerEurekaNode", "!", "=", "null", ")", "{", "peerEurekaNode", ".", "shutDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRegistrationBatchReplication", "(", ")", "throws", "Exception", "{", "createPeerEurekaNode", "(", ")", ".", "register", "(", "instanceInfo", ")", ";", "ReplicationInstance", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "Register", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelBatchReplication", "(", ")", "throws", "Exception", "{", "createPeerEurekaNode", "(", ")", ".", "cancel", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ")", ";", "ReplicationInstance", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "Cancel", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeatBatchReplication", "(", ")", "throws", "Throwable", "{", "createPeerEurekaNode", "(", ")", ".", "heartbeat", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ",", "null", ",", "false", ")", ";", "ReplicationInstance", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "Heartbeat", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeatReplicationFailure", "(", ")", "throws", "Throwable", "{", "httpReplicationClient", ".", "withNetworkStatusCode", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "httpReplicationClient", ".", "withBatchReply", "(", "<NUM_LIT>", ")", ";", "createPeerEurekaNode", "(", ")", ".", "heartbeat", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ",", "null", ",", "false", ")", ";", "ReplicationInstance", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "Heartbeat", ")", ")", ")", ";", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "Register", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeatWithInstanceInfoFromPeer", "(", ")", "throws", "Throwable", "{", "InstanceInfo", "instanceInfoFromPeer", "=", "ClusterSampleData", ".", "newInstanceInfo", "(", "<NUM_LIT:2>", ")", ";", "httpReplicationClient", ".", "withNetworkStatusCode", "(", "<NUM_LIT>", ")", ";", "httpReplicationClient", ".", "withBatchReply", "(", "<NUM_LIT>", ")", ";", "httpReplicationClient", ".", "withInstanceInfo", "(", "instanceInfoFromPeer", ")", ";", "createPeerEurekaNode", "(", ")", ".", "heartbeat", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ",", "null", ",", "false", ")", ";", "expectRequestType", "(", "RequestType", ".", "Batch", ")", ";", "verify", "(", "registry", ",", "timeout", "(", "<NUM_LIT:1000>", ")", ".", "times", "(", "1", ")", ")", ".", "register", "(", "instanceInfoFromPeer", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAsgStatusUpdate", "(", ")", "throws", "Throwable", "{", "createPeerEurekaNode", "(", ")", ".", "statusUpdate", "(", "instanceInfo", ".", "getASGName", "(", ")", ",", "ASGStatus", ".", "DISABLED", ")", ";", "Object", "newAsgStatus", "=", "expectRequestType", "(", "RequestType", ".", "AsgStatusUpdate", ")", ";", "assertThat", "(", "newAsgStatus", ",", "is", "(", "equalTo", "(", "(", "Object", ")", "ASGStatus", ".", "DISABLED", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusUpdateBatchReplication", "(", ")", "throws", "Throwable", "{", "createPeerEurekaNode", "(", ")", ".", "statusUpdate", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "DOWN", ",", "instanceInfo", ")", ";", "ReplicationInstance", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "StatusUpdate", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDeleteStatusOverrideBatchReplication", "(", ")", "throws", "Throwable", "{", "createPeerEurekaNode", "(", ")", ".", "deleteStatusOverride", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ")", ";", "ReplicationInstance", "replicationInstance", "=", "expectSingleBatchRequest", "(", ")", ";", "assertThat", "(", "replicationInstance", ".", "getAction", "(", ")", ",", "is", "(", "equalTo", "(", "Action", ".", "DeleteStatusOverride", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "PeerEurekaNode", "createPeerEurekaNode", "(", ")", "{", "EurekaServerConfig", "config", "=", "ClusterSampleData", ".", "newEurekaServerConfig", "(", ")", ";", "peerEurekaNode", "=", "new", "PeerEurekaNode", "(", "registry", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "httpReplicationClient", ",", "config", ",", "BATCH_SIZE", ",", "MAX_BATCHING_DELAY_MS", ",", "RETRY_SLEEP_TIME_MS", ",", "SERVER_UNAVAILABLE_SLEEP_TIME_MS", ")", ";", "return", "peerEurekaNode", ";", "}", "</s>"]
["<s>", "private", "Object", "expectRequestType", "(", "RequestType", "requestType", ")", "throws", "InterruptedException", "{", "HandledRequest", "handledRequest", "=", "httpReplicationClient", ".", "nextHandledRequest", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "handledRequest", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "handledRequest", ".", "getRequestType", "(", ")", ",", "is", "(", "equalTo", "(", "requestType", ")", ")", ")", ";", "return", "handledRequest", ".", "getData", "(", ")", ";", "}", "</s>"]
["<s>", "private", "ReplicationInstance", "expectSingleBatchRequest", "(", ")", "throws", "InterruptedException", "{", "HandledRequest", "handledRequest", "=", "httpReplicationClient", ".", "nextHandledRequest", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "handledRequest", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "handledRequest", ".", "getRequestType", "(", ")", ",", "is", "(", "equalTo", "(", "RequestType", ".", "Batch", ")", ")", ")", ";", "Object", "data", "=", "handledRequest", ".", "getData", "(", ")", ";", "assertThat", "(", "data", ",", "is", "(", "instanceOf", "(", "ReplicationList", ".", "class", ")", ")", ")", ";", "List", "<", "ReplicationInstance", ">", "replications", "=", "(", "(", "ReplicationList", ")", "data", ")", ".", "getReplicationList", "(", ")", ";", "assertThat", "(", "replications", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "return", "replications", ".", "get", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "replicationTaskProcessor", "=", "new", "ReplicationTaskProcessor", "(", "\"", "<STR_LIT>", "\"", ",", "replicationClient", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNonBatchableTaskExecution", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "withAction", "(", "Action", ".", "Heartbeat", ")", ".", "withReplyStatusCode", "(", "<NUM_LIT>", ")", ".", "build", "(", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "task", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "Success", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNonBatchableTaskCongestionFailureHandling", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "withAction", "(", "Action", ".", "Heartbeat", ")", ".", "withReplyStatusCode", "(", "<NUM_LIT>", ")", ".", "build", "(", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "task", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "Congestion", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Pending", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNonBatchableTaskNetworkFailureHandling", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "withAction", "(", "Action", ".", "Heartbeat", ")", ".", "withNetworkFailures", "(", "1", ")", ".", "build", "(", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "task", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "TransientError", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Pending", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNonBatchableTaskPermanentFailureHandling", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "withAction", "(", "Action", ".", "Heartbeat", ")", ".", "withReplyStatusCode", "(", "<NUM_LIT>", ")", ".", "build", "(", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "task", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "PermanentError", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Failed", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchableTaskListExecution", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "build", "(", ")", ";", "replicationClient", ".", "withBatchReply", "(", "<NUM_LIT>", ")", ";", "replicationClient", ".", "withNetworkStatusCode", "(", "<NUM_LIT>", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "Collections", ".", "<", "ReplicationTask", ">", "singletonList", "(", "task", ")", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "Success", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Finished", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchableTaskCongestionFailureHandling", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "build", "(", ")", ";", "replicationClient", ".", "withNetworkStatusCode", "(", "<NUM_LIT>", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "Collections", ".", "<", "ReplicationTask", ">", "singletonList", "(", "task", ")", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "Congestion", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Pending", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchableTaskNetworkFailureHandling", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "build", "(", ")", ";", "replicationClient", ".", "withNetworkError", "(", "1", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "Collections", ".", "<", "ReplicationTask", ">", "singletonList", "(", "task", ")", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "TransientError", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Pending", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchableTaskPermanentFailureHandling", "(", ")", "throws", "Exception", "{", "TestableInstanceReplicationTask", "task", "=", "aReplicationTask", "(", ")", ".", "build", "(", ")", ";", "InstanceInfo", "instanceInfoFromPeer", "=", "InstanceInfoGenerator", ".", "takeOne", "(", ")", ";", "replicationClient", ".", "withNetworkStatusCode", "(", "<NUM_LIT>", ")", ";", "replicationClient", ".", "withBatchReply", "(", "<NUM_LIT>", ")", ";", "replicationClient", ".", "withInstanceInfo", "(", "instanceInfoFromPeer", ")", ";", "ProcessingResult", "status", "=", "replicationTaskProcessor", ".", "process", "(", "Collections", ".", "<", "ReplicationTask", ">", "singletonList", "(", "task", ")", ")", ";", "assertThat", "(", "status", ",", "is", "(", "ProcessingResult", ".", "Success", ")", ")", ";", "assertThat", "(", "task", ".", "getProcessingState", "(", ")", ",", "is", "(", "ProcessingState", ".", "Failed", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "replicationClient", "=", "new", "JerseyReplicationClient", "(", "config", ",", "serverCodecs", ",", "\"", "<STR_LIT>", "\"", "+", "serverMockRule", ".", "getHttpPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRegistrationReplication", "(", ")", "throws", "Exception", "{", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT:POST>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ")", ";", "HttpResponse", "<", "Void", ">", "response", "=", "replicationClient", ".", "register", "(", "instanceInfo", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelReplication", "(", ")", "throws", "Exception", "{", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", "+", "<CHAR_LIT:/>", "+", "instanceInfo", ".", "getId", "(", ")", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ")", ";", "HttpResponse", "<", "Void", ">", "response", "=", "replicationClient", ".", "cancel", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeatReplicationWithNoResponseBody", "(", ")", "throws", "Exception", "{", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", "+", "<CHAR_LIT:/>", "+", "instanceInfo", ".", "getId", "(", ")", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ")", ";", "HttpResponse", "<", "InstanceInfo", ">", "response", "=", "replicationClient", ".", "sendHeartBeat", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ",", "InstanceStatus", ".", "DOWN", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getEntity", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeatReplicationWithResponseBody", "(", ")", "throws", "Exception", "{", "InstanceInfo", "remoteInfo", "=", "new", "InstanceInfo", "(", "this", ".", "instanceInfo", ")", ";", "remoteInfo", ".", "setStatus", "(", "InstanceStatus", ".", "DOWN", ")", ";", "byte", "[", "]", "responseBody", "=", "toGzippedJson", "(", "remoteInfo", ")", ";", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "this", ".", "instanceInfo", ".", "getAppName", "(", ")", "+", "<CHAR_LIT:/>", "+", "this", ".", "instanceInfo", ".", "getId", "(", ")", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "Status", ".", "CONFLICT", ".", "getStatusCode", "(", ")", ")", ".", "withHeader", "(", "header", "(", "\"", "<STR_LIT:Content-Type>", "\"", ",", "MediaType", ".", "APPLICATION_JSON", ")", ")", ".", "withHeader", "(", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withBody", "(", "responseBody", ")", ")", ";", "HttpResponse", "<", "InstanceInfo", ">", "response", "=", "replicationClient", ".", "sendHeartBeat", "(", "this", ".", "instanceInfo", ".", "getAppName", "(", ")", ",", "this", ".", "instanceInfo", ".", "getId", "(", ")", ",", "this", ".", "instanceInfo", ",", "null", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "Status", ".", "CONFLICT", ".", "getStatusCode", "(", ")", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getEntity", "(", ")", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAsgStatusUpdateReplication", "(", ")", "throws", "Exception", "{", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getASGName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ")", ";", "HttpResponse", "<", "Void", ">", "response", "=", "replicationClient", ".", "statusUpdate", "(", "instanceInfo", ".", "getASGName", "(", ")", ",", "ASGStatus", ".", "ENABLED", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusUpdateReplication", "(", ")", "throws", "Exception", "{", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", "+", "<CHAR_LIT:/>", "+", "instanceInfo", ".", "getId", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ")", ";", "HttpResponse", "<", "Void", ">", "response", "=", "replicationClient", ".", "statusUpdate", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "DOWN", ",", "instanceInfo", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDeleteStatusOverrideReplication", "(", ")", "throws", "Exception", "{", "serverMockClient", ".", "when", "(", "request", "(", ")", ".", "withMethod", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withHeader", "(", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ")", ".", "withPath", "(", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", "+", "<CHAR_LIT:/>", "+", "instanceInfo", ".", "getId", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ")", ".", "respond", "(", "response", "(", ")", ".", "withStatusCode", "(", "<NUM_LIT>", ")", ")", ";", "HttpResponse", "<", "Void", ">", "response", "=", "replicationClient", ".", "deleteStatusOverride", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ")", ";", "assertThat", "(", "response", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "byte", "[", "]", "toGzippedJson", "(", "InstanceInfo", "remoteInfo", ")", "throws", "IOException", "{", "ByteArrayOutputStream", "bos", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "GZIPOutputStream", "gos", "=", "new", "GZIPOutputStream", "(", "bos", ")", ";", "EurekaJacksonCodec", ".", "getInstance", "(", ")", ".", "writeTo", "(", "remoteInfo", ",", "gos", ")", ";", "gos", ".", "flush", "(", ")", ";", "return", "bos", ".", "toByteArray", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "withNetworkStatusCode", "(", "int", ".", ".", ".", "networkStatusCodes", ")", "{", "this", ".", "networkStatusCodes", "=", "networkStatusCodes", ";", "}", "</s>"]
["<s>", "public", "void", "withInstanceInfo", "(", "InstanceInfo", "instanceInfoFromPeer", ")", "{", "this", ".", "instanceInfoFromPeer", "=", "instanceInfoFromPeer", ";", "}", "</s>"]
["<s>", "public", "void", "withBatchReply", "(", "int", "batchStatusCode", ")", "{", "this", ".", "batchStatusCode", "=", "batchStatusCode", ";", "}", "</s>"]
["<s>", "public", "void", "withNetworkError", "(", "int", "networkFailuresRepeatCount", ")", "{", "this", ".", "networkFailuresRepeatCount", "=", "networkFailuresRepeatCount", ";", "}", "</s>"]
["<s>", "public", "void", "withProcessingDelay", "(", "long", "processingDelay", ",", "TimeUnit", "timeUnit", ")", "{", "this", ".", "processingDelayMs", "=", "timeUnit", ".", "toMillis", "(", "processingDelay", ")", ";", "}", "</s>"]
["<s>", "public", "HandledRequest", "nextHandledRequest", "(", "long", "timeout", ",", "TimeUnit", "timeUnit", ")", "throws", "InterruptedException", "{", "return", "handledRequests", ".", "poll", "(", "timeout", ",", "timeUnit", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "register", "(", "InstanceInfo", "info", ")", "{", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "Register", ",", "info", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "cancel", "(", "String", "appName", ",", "String", "id", ")", "{", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "Cancel", ",", "id", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "sendHeartBeat", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceStatus", "overriddenStatus", ")", "{", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "Heartbeat", ",", "instanceInfoFromPeer", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "instanceInfoFromPeer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "statusUpdate", "(", "String", "asgName", ",", "ASGStatus", "newStatus", ")", "{", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "AsgStatusUpdate", ",", "newStatus", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "statusUpdate", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "InstanceInfo", "info", ")", "{", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "StatusUpdate", ",", "newStatus", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "deleteStatusOverride", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ")", "{", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "DeleteStatusOverride", ",", "null", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Applications", ">", "getApplications", "(", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Applications", ">", "getDelta", "(", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "getInstance", "(", "String", "appName", ",", "String", "id", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "ReplicationListResponse", ">", "submitBatchUpdates", "(", "ReplicationList", "replicationList", ")", "{", "if", "(", "networkFailureCounter", ".", "get", "(", ")", "<", "networkFailuresRepeatCount", ")", "{", "networkFailureCounter", ".", "incrementAndGet", "(", ")", ";", "throw", "new", "RuntimeException", "(", "new", "IOException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "if", "(", "processingDelayMs", ">", "0", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "processingDelayMs", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "List", "<", "ReplicationInstanceResponse", ">", "responseList", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "responseList", ".", "add", "(", "new", "ReplicationInstanceResponse", "(", "batchStatusCode", ",", "instanceInfoFromPeer", ")", ")", ";", "ReplicationListResponse", "replicationListResponse", "=", "new", "ReplicationListResponse", "(", "responseList", ")", ";", "handledRequests", ".", "add", "(", "new", "HandledRequest", "(", "RequestType", ".", "Batch", ",", "replicationList", ")", ")", ";", "return", "new", "HttpResponse", "<", ">", "(", "networkStatusCodes", "[", "callCounter", ".", "getAndIncrement", "(", ")", "]", ",", "replicationListResponse", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "}", "</s>"]
["<s>", "public", "HandledRequest", "(", "RequestType", "requestType", ",", "Object", "data", ")", "{", "this", ".", "requestType", "=", "requestType", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "public", "RequestType", "getRequestType", "(", ")", "{", "return", "requestType", ";", "}", "</s>"]
["<s>", "public", "Object", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInitialStartupShutdown", "(", ")", "throws", "Exception", "{", "peerEurekaNodes", ".", "withPeerUrls", "(", "PEER_EUREKA_URL_A", ")", ";", "peerEurekaNodes", ".", "start", "(", ")", ";", "PeerEurekaNode", "peerNode", "=", "getPeerNode", "(", "PEER_EUREKA_URL_A", ")", ";", "assertThat", "(", "peerNode", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "peerEurekaNodes", ".", "shutdown", "(", ")", ";", "verify", "(", "peerNode", ",", "times", "(", "1", ")", ")", ".", "shutDown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReloadWithNoPeerChange", "(", ")", "throws", "Exception", "{", "peerEurekaNodes", ".", "withPeerUrls", "(", "PEER_EUREKA_URL_A", ")", ";", "peerEurekaNodes", ".", "start", "(", ")", ";", "PeerEurekaNode", "peerNode", "=", "getPeerNode", "(", "PEER_EUREKA_URL_A", ")", ";", "assertThat", "(", "peerEurekaNodes", ".", "awaitNextReload", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "getPeerNode", "(", "PEER_EUREKA_URL_A", ")", ",", "is", "(", "equalTo", "(", "peerNode", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReloadWithPeerUpdates", "(", ")", "throws", "Exception", "{", "peerEurekaNodes", ".", "withPeerUrls", "(", "PEER_EUREKA_URL_A", ")", ";", "peerEurekaNodes", ".", "start", "(", ")", ";", "PeerEurekaNode", "peerNodeA", "=", "getPeerNode", "(", "PEER_EUREKA_URL_A", ")", ";", "peerEurekaNodes", ".", "withPeerUrls", "(", "PEER_EUREKA_URL_A", ",", "PEER_EUREKA_URL_B", ")", ";", "assertThat", "(", "peerEurekaNodes", ".", "awaitNextReload", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "getPeerNode", "(", "PEER_EUREKA_URL_A", ")", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "getPeerNode", "(", "PEER_EUREKA_URL_B", ")", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "peerEurekaNodes", ".", "withPeerUrls", "(", "PEER_EUREKA_URL_B", ",", "PEER_EUREKA_URL_C", ")", ";", "assertThat", "(", "peerEurekaNodes", ".", "awaitNextReload", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "getPeerNode", "(", "PEER_EUREKA_URL_A", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertThat", "(", "getPeerNode", "(", "PEER_EUREKA_URL_B", ")", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "getPeerNode", "(", "PEER_EUREKA_URL_C", ")", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "verify", "(", "peerNodeA", ",", "times", "(", "1", ")", ")", ".", "shutDown", "(", ")", ";", "}", "</s>"]
["<s>", "private", "PeerEurekaNode", "getPeerNode", "(", "String", "peerEurekaUrl", ")", "{", "for", "(", "PeerEurekaNode", "node", ":", "peerEurekaNodes", ".", "getPeerEurekaNodes", "(", ")", ")", "{", "if", "(", "node", ".", "getServiceUrl", "(", ")", ".", "equals", "(", "peerEurekaUrl", ")", ")", "{", "return", "node", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "TestablePeerEurekaNodes", "(", "PeerAwareInstanceRegistry", "registry", ",", "EurekaServerConfig", "serverConfig", ")", "{", "super", "(", "registry", ",", "serverConfig", ",", "new", "DefaultEurekaClientConfig", "(", ")", ",", "new", "DefaultServerCodecs", "(", "serverConfig", ")", ",", "mock", "(", "ApplicationInfoManager", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "void", "withPeerUrls", "(", "String", ".", ".", ".", "peerUrls", ")", "{", "this", ".", "peerUrls", "=", "Arrays", ".", "asList", "(", "peerUrls", ")", ";", "}", "</s>"]
["<s>", "boolean", "awaitNextReload", "(", "long", "timeout", ",", "TimeUnit", "timeUnit", ")", "throws", "InterruptedException", "{", "int", "lastReloadCounter", "=", "reloadCounter", ".", "get", "(", ")", ";", "long", "endTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "timeUnit", ".", "toMillis", "(", "timeout", ")", ";", "while", "(", "endTime", ">", "System", ".", "currentTimeMillis", "(", ")", "&", "&", "lastReloadCounter", "=", "=", "reloadCounter", ".", "get", "(", ")", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "}", "return", "lastReloadCounter", "!", "=", "reloadCounter", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "updatePeerEurekaNodes", "(", "List", "<", "String", ">", "newPeerUrls", ")", "{", "super", ".", "updatePeerEurekaNodes", "(", "newPeerUrls", ")", ";", "reloadCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "List", "<", "String", ">", "resolvePeerUrls", "(", ")", "{", "return", "peerUrls", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "PeerEurekaNode", "createPeerEurekaNode", "(", "String", "peerEurekaNodeUrl", ")", "{", "if", "(", "peerEurekaNodeByUrl", ".", "containsKey", "(", "peerEurekaNodeUrl", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "peerEurekaNodeUrl", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "PeerEurekaNode", "peerEurekaNode", "=", "mock", "(", "PeerEurekaNode", ".", "class", ")", ";", "when", "(", "peerEurekaNode", ".", "getServiceUrl", "(", ")", ")", ".", "thenReturn", "(", "peerEurekaNodeUrl", ")", ";", "return", "peerEurekaNode", ";", "}", "</s>"]
["<s>", "private", "ClusterSampleData", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "EurekaServerConfig", "newEurekaServerConfig", "(", ")", "{", "EurekaServerConfig", "config", "=", "mock", "(", "EurekaServerConfig", ".", "class", ")", ";", "when", "(", "config", ".", "getPeerEurekaNodesUpdateIntervalMs", "(", ")", ")", ".", "thenReturn", "(", "(", "int", ")", "EUREKA_NODES_UPDATE_INTERVAL_MS", ")", ";", "when", "(", "config", ".", "shouldSyncWhenTimestampDiffers", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "config", ".", "getMaxTimeForReplication", "(", ")", ")", ".", "thenReturn", "(", "(", "int", ")", "REPLICATION_EXPIRY_TIME_MS", ")", ";", "when", "(", "config", ".", "getMaxElementsInPeerReplicationPool", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT:10>", ")", ";", "when", "(", "config", ".", "getMaxElementsInStatusReplicationPool", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT:10>", ")", ";", "when", "(", "config", ".", "getMaxThreadsForPeerReplication", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "config", ".", "getMaxThreadsForStatusReplication", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "return", "config", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfo", "newInstanceInfo", "(", "int", "index", ")", "{", "Iterator", "<", "InstanceInfo", ">", "instanceGenerator", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:10>", ")", ".", "withMetaData", "(", "true", ")", ".", "build", "(", ")", ".", "serviceIterator", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "index", ";", "i", "+", "+", ")", "{", "instanceGenerator", ".", "next", "(", ")", ";", "}", "return", "instanceGenerator", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ReplicationInstance", "newReplicationInstance", "(", ")", "{", "return", "newReplicationInstanceOf", "(", "Action", ".", "Register", ",", "newInstanceInfo", "(", "0", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ReplicationInstance", "newReplicationInstanceOf", "(", "Action", "action", ",", "InstanceInfo", "instance", ")", "{", "switch", "(", "action", ")", "{", "case", "Register", ":", "return", "new", "ReplicationInstance", "(", "instance", ".", "getAppName", "(", ")", ",", "instance", ".", "getId", "(", ")", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "null", ",", "instance", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instance", ",", "action", ")", ";", "case", "Cancel", ":", "return", "new", "ReplicationInstance", "(", "instance", ".", "getAppName", "(", ")", ",", "instance", ".", "getId", "(", ")", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "null", ",", "null", ",", "null", ",", "action", ")", ";", "case", "Heartbeat", ":", "return", "new", "ReplicationInstance", "(", "instance", ".", "getAppName", "(", ")", ",", "instance", ".", "getId", "(", ")", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "name", "(", ")", ",", "instance", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instance", ",", "action", ")", ";", "case", "StatusUpdate", ":", "return", "new", "ReplicationInstance", "(", "instance", ".", "getAppName", "(", ")", ",", "instance", ".", "getId", "(", ")", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "name", "(", ")", ",", "null", ",", "null", ",", "action", ")", ";", "case", "DeleteStatusOverride", ":", "return", "new", "ReplicationInstance", "(", "instance", ".", "getAppName", "(", ")", ",", "instance", ".", "getId", "(", ")", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "name", "(", ")", ",", "null", ",", "null", ",", "action", ")", ";", "}", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "action", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ReplicationInstanceResponse", "newReplicationInstanceResponse", "(", "boolean", "withInstanceInfo", ")", "{", "return", "new", "ReplicationInstanceResponse", "(", "<NUM_LIT>", ",", "withInstanceInfo", "?", "newInstanceInfo", "(", "1", ")", ":", "null", ")", ";", "}", "</s>"]
["<s>", "TestableInstanceReplicationTask", "(", "String", "peerNodeName", ",", "String", "appName", ",", "String", "id", ",", "Action", "action", ",", "int", "replyStatusCode", ",", "int", "networkFailuresRepeatCount", ")", "{", "super", "(", "peerNodeName", ",", "action", ",", "appName", ",", "id", ")", ";", "this", ".", "replyStatusCode", "=", "replyStatusCode", ";", "this", ".", "networkFailuresRepeatCount", "=", "networkFailuresRepeatCount", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "throws", "Throwable", "{", "if", "(", "triggeredNetworkFailures", "<", "networkFailuresRepeatCount", ")", "{", "triggeredNetworkFailures", "+", "+", ";", "throw", "new", "IOException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "new", "HttpResponse", "<", ">", "(", "replyStatusCode", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleSuccess", "(", ")", "{", "processingState", ".", "compareAndSet", "(", "ProcessingState", ".", "Pending", ",", "ProcessingState", ".", "Finished", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleFailure", "(", "int", "statusCode", ",", "Object", "responseEntity", ")", "throws", "Throwable", "{", "processingState", ".", "compareAndSet", "(", "ProcessingState", ".", "Pending", ",", "ProcessingState", ".", "Failed", ")", ";", "}", "</s>"]
["<s>", "public", "ProcessingState", "getProcessingState", "(", ")", "{", "return", "processingState", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "TestableReplicationTaskBuilder", "aReplicationTask", "(", ")", "{", "return", "new", "TestableReplicationTaskBuilder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "TestableReplicationTaskBuilder", "withReplyStatusCode", "(", "int", "replyStatusCode", ")", "{", "this", ".", "replyStatusCode", "=", "replyStatusCode", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "TestableReplicationTaskBuilder", "withAction", "(", "Action", "action", ")", "{", "this", ".", "action", "=", "action", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "TestableReplicationTaskBuilder", "withNetworkFailures", "(", "int", "networkFailuresRepeatCount", ")", "{", "this", ".", "networkFailuresRepeatCount", "=", "networkFailuresRepeatCount", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "TestableInstanceReplicationTask", "build", "(", ")", "{", "return", "new", "TestableInstanceReplicationTask", "(", "\"", "<STR_LIT>", "\"", ",", "APP_NAME", ",", "\"", "<STR_LIT:#>", "\"", "+", "autoId", "+", "+", ",", "action", ",", "replyStatusCode", ",", "networkFailuresRepeatCount", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReplicationInstanceEncoding", "(", ")", "throws", "Exception", "{", "ReplicationInstance", "replicationInstance", "=", "ClusterSampleData", ".", "newReplicationInstance", "(", ")", ";", "String", "jsonText", "=", "jacksonCodec", ".", "writeToString", "(", "replicationInstance", ")", ";", "ReplicationInstance", "decodedValue", "=", "jacksonCodec", ".", "readValue", "(", "ReplicationInstance", ".", "class", ",", "jsonText", ")", ";", "assertThat", "(", "decodedValue", ",", "is", "(", "equalTo", "(", "replicationInstance", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReplicationInstanceResponseEncoding", "(", ")", "throws", "Exception", "{", "ReplicationInstanceResponse", "replicationInstanceResponse", "=", "ClusterSampleData", ".", "newReplicationInstanceResponse", "(", "true", ")", ";", "String", "jsonText", "=", "jacksonCodec", ".", "writeToString", "(", "replicationInstanceResponse", ")", ";", "ReplicationInstanceResponse", "decodedValue", "=", "jacksonCodec", ".", "readValue", "(", "ReplicationInstanceResponse", ".", "class", ",", "jsonText", ")", ";", "assertThat", "(", "decodedValue", ",", "is", "(", "equalTo", "(", "replicationInstanceResponse", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReplicationListEncoding", "(", ")", "throws", "Exception", "{", "ReplicationList", "replicationList", "=", "new", "ReplicationList", "(", ")", ";", "replicationList", ".", "addReplicationInstance", "(", "ClusterSampleData", ".", "newReplicationInstance", "(", ")", ")", ";", "String", "jsonText", "=", "jacksonCodec", ".", "writeToString", "(", "replicationList", ")", ";", "ReplicationList", "decodedValue", "=", "jacksonCodec", ".", "readValue", "(", "ReplicationList", ".", "class", ",", "jsonText", ")", ";", "assertThat", "(", "decodedValue", ",", "is", "(", "equalTo", "(", "replicationList", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testReplicationListResponseEncoding", "(", ")", "throws", "Exception", "{", "ReplicationListResponse", "replicationListResponse", "=", "new", "ReplicationListResponse", "(", ")", ";", "replicationListResponse", ".", "addResponse", "(", "ClusterSampleData", ".", "newReplicationInstanceResponse", "(", "false", ")", ")", ";", "String", "jsonText", "=", "jacksonCodec", ".", "writeToString", "(", "replicationListResponse", ")", ";", "ReplicationListResponse", "decodedValue", "=", "jacksonCodec", ".", "readValue", "(", "ReplicationListResponse", ".", "class", ",", "jsonText", ")", ";", "assertThat", "(", "decodedValue", ",", "is", "(", "equalTo", "(", "replicationListResponse", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "AmazonInfo", "dataCenterInfo", "=", "mock", "(", "AmazonInfo", ".", "class", ")", ";", "EurekaServerConfig", "serverConfig", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setIPAddr", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setHostName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "builder", ".", "setAppName", "(", "\"", "<STR_LIT:->", "\"", "+", "UUID", ".", "randomUUID", "(", ")", ")", ";", "builder", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "build", "(", ")", ")", ";", "builder", ".", "setDataCenterInfo", "(", "dataCenterInfo", ")", ";", "applicationInfoManager", "=", "new", "ApplicationInfoManager", "(", "new", "MyDataCenterInstanceConfig", "(", ")", ",", "builder", ".", "build", "(", ")", ")", ";", "DefaultEurekaClientConfig", "clientConfig", "=", "new", "DefaultEurekaClientConfig", "(", ")", ";", "client", "=", "mock", "(", "DiscoveryClient", ".", "class", ")", ";", "registry", "=", "mock", "(", "PeerAwareInstanceRegistry", ".", "class", ")", ";", "awsAsgUtil", "=", "spy", "(", "new", "AwsAsgUtil", "(", "serverConfig", ",", "clientConfig", ",", "registry", ")", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAsyncLoadingFromCache", "(", ")", "{", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "if", "(", "dispatcher", "!", "=", "null", ")", "{", "dispatcher", ".", "shutdown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSingleTaskDispatcher", "(", ")", "throws", "Exception", "{", "dispatcher", "=", "TaskDispatchers", ".", "createNonBatchingTaskDispatcher", "(", "\"", "<STR_LIT>", "\"", ",", "MAX_BUFFER_SIZE", ",", "1", ",", "MAX_BATCHING_DELAY_MS", ",", "SERVER_UNAVAILABLE_SLEEP_TIME_MS", ",", "RETRY_SLEEP_TIME_MS", ",", "processor", ")", ";", "dispatcher", ".", "process", "(", "1", ",", "ProcessingResult", ".", "Success", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "ProcessingResult", "result", "=", "processor", ".", "completedTasks", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "result", ",", "is", "(", "equalTo", "(", "ProcessingResult", ".", "Success", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchingDispatcher", "(", ")", "throws", "Exception", "{", "dispatcher", "=", "TaskDispatchers", ".", "createBatchingTaskDispatcher", "(", "\"", "<STR_LIT>", "\"", ",", "MAX_BUFFER_SIZE", ",", "WORK_LOAD_SIZE", ",", "1", ",", "MAX_BATCHING_DELAY_MS", ",", "SERVER_UNAVAILABLE_SLEEP_TIME_MS", ",", "RETRY_SLEEP_TIME_MS", ",", "processor", ")", ";", "dispatcher", ".", "process", "(", "1", ",", "ProcessingResult", ".", "Success", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "dispatcher", ".", "process", "(", "<NUM_LIT:2>", ",", "ProcessingResult", ".", "Success", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "processor", ".", "expectSuccesses", "(", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testTasksAreDistributedAcrossAllWorkerThreads", "(", ")", "throws", "Exception", "{", "int", "threadCount", "=", "<NUM_LIT:5>", ";", "CountingTaskProcessor", "countingProcessor", "=", "new", "CountingTaskProcessor", "(", ")", ";", "TaskDispatcher", "<", "Integer", ",", "Boolean", ">", "dispatcher", "=", "TaskDispatchers", ".", "createBatchingTaskDispatcher", "(", "\"", "<STR_LIT>", "\"", ",", "MAX_BUFFER_SIZE", ",", "WORK_LOAD_SIZE", ",", "threadCount", ",", "MAX_BATCHING_DELAY_MS", ",", "SERVER_UNAVAILABLE_SLEEP_TIME_MS", ",", "RETRY_SLEEP_TIME_MS", ",", "countingProcessor", ")", ";", "try", "{", "int", "loops", "=", "<NUM_LIT:1000>", ";", "while", "(", "true", ")", "{", "countingProcessor", ".", "resetTo", "(", "loops", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "loops", ";", "i", "+", "+", ")", "{", "dispatcher", ".", "process", "(", "i", ",", "true", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "}", "countingProcessor", ".", "awaitCompletion", "(", ")", ";", "int", "minHitPerThread", "=", "(", "int", ")", "(", "loops", "/", "threadCount", "*", "<NUM_LIT>", ")", ";", "if", "(", "countingProcessor", ".", "lowestHit", "(", ")", "<", "minHitPerThread", ")", "{", "loops", "*", "=", "<NUM_LIT:2>", ";", "}", "else", "{", "break", ";", "}", "if", "(", "loops", ">", "MAX_BUFFER_SIZE", ")", "{", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", "finally", "{", "dispatcher", ".", "shutdown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "ProcessingResult", "process", "(", "Boolean", "task", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ProcessingResult", "process", "(", "List", "<", "Boolean", ">", "tasks", ")", "{", "Thread", "currentThread", "=", "Thread", ".", "currentThread", "(", ")", ";", "Integer", "current", "=", "threadHits", ".", "get", "(", "currentThread", ")", ";", "if", "(", "current", "=", "=", "null", ")", "{", "threadHits", ".", "put", "(", "currentThread", ",", "tasks", ".", "size", "(", ")", ")", ";", "}", "else", "{", "threadHits", ".", "put", "(", "currentThread", ",", "tasks", ".", "size", "(", ")", "+", "current", ")", ";", "}", "completionGuard", ".", "release", "(", "tasks", ".", "size", "(", ")", ")", ";", "return", "ProcessingResult", ".", "Success", ";", "}", "</s>"]
["<s>", "void", "resetTo", "(", "int", "expectedTasks", ")", "{", "completionGuard", "=", "new", "Semaphore", "(", "-", "expectedTasks", "+", "1", ")", ";", "}", "</s>"]
["<s>", "void", "awaitCompletion", "(", ")", "throws", "InterruptedException", "{", "assertThat", "(", "completionGuard", ".", "tryAcquire", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "int", "lowestHit", "(", ")", "{", "return", "Collections", ".", "min", "(", "threadHits", ".", "values", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "acceptorExecutor", "=", "new", "AcceptorExecutor", "<", ">", "(", "\"", "<STR_LIT>", "\"", ",", "MAX_BUFFER_SIZE", ",", "WORK_LOAD_SIZE", ",", "MAX_BATCHING_DELAY_MS", ",", "SERVER_UNAVAILABLE_SLEEP_TIME_MS", ",", "RETRY_SLEEP_TIME_MS", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "acceptorExecutor", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testTasksAreDispatchedToWorkers", "(", ")", "throws", "Exception", "{", "acceptorExecutor", ".", "process", "(", "1", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "TaskHolder", "<", "Integer", ",", "String", ">", "taskHolder", "=", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "verifyTaskHolder", "(", "taskHolder", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "acceptorExecutor", ".", "process", "(", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "List", "<", "TaskHolder", "<", "Integer", ",", "String", ">", ">", "taskHolders", "=", "acceptorExecutor", ".", "requestWorkItems", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "taskHolders", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "1", ")", ")", ")", ";", "verifyTaskHolder", "(", "taskHolders", ".", "get", "(", "0", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchSizeIsConstrainedByConfiguredMaxSize", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "=", "MAX_BUFFER_SIZE", ";", "i", "+", "+", ")", "{", "acceptorExecutor", ".", "process", "(", "i", ",", "\"", "<STR_LIT>", "\"", "+", "i", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "}", "List", "<", "TaskHolder", "<", "Integer", ",", "String", ">", ">", "taskHolders", "=", "acceptorExecutor", ".", "requestWorkItems", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "taskHolders", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "WORK_LOAD_SIZE", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNewTaskOverridesOldOne", "(", ")", "throws", "Exception", "{", "acceptorExecutor", ".", "process", "(", "1", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "acceptorExecutor", ".", "process", "(", "1", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "TaskHolder", "<", "Integer", ",", "String", ">", "taskHolder", "=", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "verifyTaskHolder", "(", "taskHolder", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRepublishedTaskIsHandledFirst", "(", ")", "throws", "Exception", "{", "acceptorExecutor", ".", "process", "(", "1", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "acceptorExecutor", ".", "process", "(", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "TaskHolder", "<", "Integer", ",", "String", ">", "firstTaskHolder", "=", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "verifyTaskHolder", "(", "firstTaskHolder", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "acceptorExecutor", ".", "reprocess", "(", "firstTaskHolder", ",", "ProcessingResult", ".", "TransientError", ")", ";", "TaskHolder", "<", "Integer", ",", "String", ">", "secondTaskHolder", "=", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "verifyTaskHolder", "(", "secondTaskHolder", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "TaskHolder", "<", "Integer", ",", "String", ">", "thirdTaskHolder", "=", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "verifyTaskHolder", "(", "thirdTaskHolder", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testWhenBufferOverflowsOldestTasksAreRemoved", "(", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "=", "MAX_BUFFER_SIZE", ";", "i", "+", "+", ")", "{", "acceptorExecutor", ".", "process", "(", "i", ",", "\"", "<STR_LIT>", "\"", "+", "i", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "}", "TaskHolder", "<", "Integer", ",", "String", ">", "firstTaskHolder", "=", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "verifyTaskHolder", "(", "firstTaskHolder", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testTasksAreDelayToMaximizeBatchSize", "(", ")", "throws", "Exception", "{", "BlockingQueue", "<", "List", "<", "TaskHolder", "<", "Integer", ",", "String", ">", ">", ">", "taskQueue", "=", "acceptorExecutor", ".", "requestWorkItems", "(", ")", ";", "acceptorExecutor", ".", "process", "(", "1", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "Thread", ".", "sleep", "(", "MAX_BATCHING_DELAY_MS", "/", "<NUM_LIT:2>", ")", ";", "acceptorExecutor", ".", "process", "(", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "List", "<", "TaskHolder", "<", "Integer", ",", "String", ">", ">", "taskHolders", "=", "taskQueue", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "taskHolders", ".", "size", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT:2>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "verifyTaskHolder", "(", "TaskHolder", "<", "Integer", ",", "String", ">", "taskHolder", ",", "int", "id", ",", "String", "task", ")", "{", "assertThat", "(", "taskHolder", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "taskHolder", ".", "getId", "(", ")", ",", "is", "(", "equalTo", "(", "id", ")", ")", ")", ";", "assertThat", "(", "taskHolder", ".", "getTask", "(", ")", ",", "is", "(", "equalTo", "(", "task", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ProcessingResult", "process", "(", "ProcessingResult", "task", ")", "{", "switch", "(", "task", ")", "{", "case", "Success", ":", "completedTasks", ".", "add", "(", "task", ")", ";", "break", ";", "case", "PermanentError", ":", "permanentErrorTasks", ".", "add", "(", "task", ")", ";", "break", ";", "case", "TransientError", ":", "transientErrorTasks", ".", "add", "(", "task", ")", ";", "break", ";", "}", "return", "task", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ProcessingResult", "process", "(", "List", "<", "ProcessingResult", ">", "tasks", ")", "{", "for", "(", "ProcessingResult", "task", ":", "tasks", ")", "{", "process", "(", "task", ")", ";", "}", "return", "tasks", ".", "get", "(", "0", ")", ";", "}", "</s>"]
["<s>", "public", "static", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", "successfulTaskHolder", "(", "int", "id", ")", "{", "return", "new", "TaskHolder", "<", ">", "(", "id", ",", "ProcessingResult", ".", "Success", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "}", "</s>"]
["<s>", "public", "static", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", "transientErrorTaskHolder", "(", "int", "id", ")", "{", "return", "new", "TaskHolder", "<", ">", "(", "id", ",", "ProcessingResult", ".", "TransientError", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "}", "</s>"]
["<s>", "public", "static", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", "permanentErrorTaskHolder", "(", "int", "id", ")", "{", "return", "new", "TaskHolder", "<", ">", "(", "id", ",", "ProcessingResult", ".", "PermanentError", ",", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ";", "}", "</s>"]
["<s>", "public", "void", "expectSuccesses", "(", "int", "count", ")", "throws", "InterruptedException", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "ProcessingResult", "task", "=", "completedTasks", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "task", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "expectTransientErrors", "(", "int", "count", ")", "throws", "InterruptedException", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "ProcessingResult", "task", "=", "transientErrorTasks", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "task", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "expectPermanentErrors", "(", "int", "count", ")", "throws", "InterruptedException", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "ProcessingResult", "task", "=", "permanentErrorTasks", ".", "poll", "(", "<NUM_LIT:5>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "assertThat", "(", "task", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "when", "(", "acceptorExecutor", ".", "requestWorkItem", "(", ")", ")", ".", "thenReturn", "(", "taskQueue", ")", ";", "when", "(", "acceptorExecutor", ".", "requestWorkItems", "(", ")", ")", ".", "thenReturn", "(", "taskBatchQueue", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "taskExecutors", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSingleItemSuccessfulProcessing", "(", ")", "throws", "Exception", "{", "taskExecutors", "=", "TaskExecutors", ".", "singleItemExecutors", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "processor", ",", "acceptorExecutor", ")", ";", "taskQueue", ".", "add", "(", "successfulTaskHolder", "(", "1", ")", ")", ";", "processor", ".", "expectSuccesses", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchSuccessfulProcessing", "(", ")", "throws", "Exception", "{", "taskExecutors", "=", "TaskExecutors", ".", "batchExecutors", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "processor", ",", "acceptorExecutor", ")", ";", "taskBatchQueue", ".", "add", "(", "asList", "(", "successfulTaskHolder", "(", "1", ")", ",", "successfulTaskHolder", "(", "<NUM_LIT:2>", ")", ")", ")", ";", "processor", ".", "expectSuccesses", "(", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSingleItemProcessingWithTransientError", "(", ")", "throws", "Exception", "{", "taskExecutors", "=", "TaskExecutors", ".", "singleItemExecutors", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "processor", ",", "acceptorExecutor", ")", ";", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", "taskHolder", "=", "transientErrorTaskHolder", "(", "1", ")", ";", "taskQueue", ".", "add", "(", "taskHolder", ")", ";", "processor", ".", "expectTransientErrors", "(", "1", ")", ";", "verify", "(", "acceptorExecutor", ",", "timeout", "(", "<NUM_LIT>", ")", ".", "times", "(", "1", ")", ")", ".", "reprocess", "(", "taskHolder", ",", "ProcessingResult", ".", "TransientError", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchProcessingWithTransientError", "(", ")", "throws", "Exception", "{", "taskExecutors", "=", "TaskExecutors", ".", "batchExecutors", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "processor", ",", "acceptorExecutor", ")", ";", "List", "<", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", ">", "taskHolderBatch", "=", "asList", "(", "transientErrorTaskHolder", "(", "1", ")", ",", "transientErrorTaskHolder", "(", "<NUM_LIT:2>", ")", ")", ";", "taskBatchQueue", ".", "add", "(", "taskHolderBatch", ")", ";", "processor", ".", "expectTransientErrors", "(", "<NUM_LIT:2>", ")", ";", "verify", "(", "acceptorExecutor", ",", "timeout", "(", "<NUM_LIT>", ")", ".", "times", "(", "1", ")", ")", ".", "reprocess", "(", "taskHolderBatch", ",", "ProcessingResult", ".", "TransientError", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSingleItemProcessingWithPermanentError", "(", ")", "throws", "Exception", "{", "taskExecutors", "=", "TaskExecutors", ".", "singleItemExecutors", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "processor", ",", "acceptorExecutor", ")", ";", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", "taskHolder", "=", "permanentErrorTaskHolder", "(", "1", ")", ";", "taskQueue", ".", "add", "(", "taskHolder", ")", ";", "processor", ".", "expectPermanentErrors", "(", "1", ")", ";", "verify", "(", "acceptorExecutor", ",", "never", "(", ")", ")", ".", "reprocess", "(", "taskHolder", ",", "ProcessingResult", ".", "TransientError", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBatchProcessingWithPermanentError", "(", ")", "throws", "Exception", "{", "taskExecutors", "=", "TaskExecutors", ".", "batchExecutors", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "processor", ",", "acceptorExecutor", ")", ";", "List", "<", "TaskHolder", "<", "Integer", ",", "ProcessingResult", ">", ">", "taskHolderBatch", "=", "asList", "(", "permanentErrorTaskHolder", "(", "1", ")", ",", "permanentErrorTaskHolder", "(", "<NUM_LIT:2>", ")", ")", ";", "taskBatchQueue", ".", "add", "(", "taskHolderBatch", ")", ";", "processor", ".", "expectPermanentErrors", "(", "<NUM_LIT:2>", ")", ";", "verify", "(", "acceptorExecutor", ",", "never", "(", ")", ")", ".", "reprocess", "(", "taskHolderBatch", ",", "ProcessingResult", ".", "TransientError", ")", ";", "}", "</s>"]
["<s>", "public", "MockRemoteEurekaServer", "(", "int", "port", ",", "Map", "<", "String", ",", "Application", ">", "applicationMap", ",", "Map", "<", "String", ",", "Application", ">", "applicationDeltaMap", ")", "{", "this", ".", "applicationMap", "=", "applicationMap", ";", "this", ".", "applicationDeltaMap", "=", "applicationDeltaMap", ";", "ServletHandler", "handler", "=", "new", "AppsResourceHandler", "(", ")", ";", "EurekaServerConfig", "serverConfig", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "EurekaServerContext", "serverContext", "=", "mock", "(", "EurekaServerContext", ".", "class", ")", ";", "when", "(", "serverContext", ".", "getServerConfig", "(", ")", ")", ".", "thenReturn", "(", "serverConfig", ")", ";", "handler", ".", "addFilterWithMapping", "(", "ServerRequestAuthFilter", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "1", ")", ".", "setFilter", "(", "new", "ServerRequestAuthFilter", "(", "serverContext", ")", ")", ";", "handler", ".", "addFilterWithMapping", "(", "RateLimitingFilter", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "1", ")", ".", "setFilter", "(", "new", "RateLimitingFilter", "(", "serverContext", ")", ")", ";", "server", "=", "new", "Server", "(", "port", ")", ";", "server", ".", "addHandler", "(", "handler", ")", ";", "System", ".", "out", ".", "println", "(", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "stringifyAppMap", "(", "applicationMap", ")", ",", "stringifyAppMap", "(", "applicationDeltaMap", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "before", "(", ")", "throws", "Throwable", "{", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "after", "(", ")", "{", "try", "{", "stop", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "Assert", ".", "fail", "(", "e", ".", "getMessage", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "start", "(", ")", "throws", "Exception", "{", "server", ".", "start", "(", ")", ";", "port", "=", "server", ".", "getConnectors", "(", ")", "[", "0", "]", ".", "getLocalPort", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "stop", "(", ")", "throws", "Exception", "{", "server", ".", "stop", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isSentDelta", "(", ")", "{", "return", "sentDelta", ";", "}", "</s>"]
["<s>", "public", "int", "getPort", "(", ")", "{", "return", "port", ";", "}", "</s>"]
["<s>", "public", "void", "simulateNotReady", "(", "boolean", "simulateNotReady", ")", "{", "this", ".", "simulateNotReady", "=", "simulateNotReady", ";", "}", "</s>"]
["<s>", "private", "static", "String", "stringifyAppMap", "(", "Map", "<", "String", ",", "Application", ">", "applicationMap", ")", "{", "StringBuilder", "builder", "=", "new", "StringBuilder", "(", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Application", ">", "entry", ":", "applicationMap", ".", "entrySet", "(", ")", ")", "{", "String", "entryAsString", "=", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "entry", ".", "getKey", "(", ")", ",", "entry", ".", "getValue", "(", ")", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "builder", ".", "append", "(", "entryAsString", ")", ";", "}", "return", "builder", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handle", "(", "String", "target", ",", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ",", "int", "dispatch", ")", "throws", "IOException", ",", "ServletException", "{", "if", "(", "simulateNotReady", ")", "{", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_FORBIDDEN", ")", ";", "return", ";", "}", "String", "authName", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_NAME_HEADER_KEY", ")", ";", "String", "authVersion", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_VERSION_HEADER_KEY", ")", ";", "String", "authId", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_ID_HEADER_KEY", ")", ";", "Assert", ".", "assertNotNull", "(", "authName", ")", ";", "Assert", ".", "assertNotNull", "(", "authVersion", ")", ";", "Assert", ".", "assertNotNull", "(", "authId", ")", ";", "Assert", ".", "assertTrue", "(", "!", "authName", ".", "equals", "(", "ServerRequestAuthFilter", ".", "UNKNOWN", ")", ")", ";", "Assert", ".", "assertTrue", "(", "!", "authVersion", ".", "equals", "(", "ServerRequestAuthFilter", ".", "UNKNOWN", ")", ")", ";", "Assert", ".", "assertTrue", "(", "!", "authId", ".", "equals", "(", "ServerRequestAuthFilter", ".", "UNKNOWN", ")", ")", ";", "for", "(", "FilterHolder", "filterHolder", ":", "this", ".", "getFilters", "(", ")", ")", "{", "filterHolder", ".", "getFilter", "(", ")", ".", "doFilter", "(", "request", ",", "response", ",", "new", "FilterChain", "(", ")", "{", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ")", "throws", "IOException", ",", "ServletException", "{", "}", "}", ")", ";", "}", "String", "pathInfo", "=", "request", ".", "getPathInfo", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "pathInfo", "+", "\"", "<STR_LIT>", "\"", "+", "request", ".", "getMethod", "(", ")", "+", "<CHAR_LIT>", ")", ";", "boolean", "handled", "=", "false", ";", "if", "(", "null", "!", "=", "pathInfo", "&", "&", "pathInfo", ".", "startsWith", "(", "\"", "\"", ")", ")", "{", "pathInfo", "=", "pathInfo", ".", "substring", "(", "EUREKA_API_BASE_PATH", ".", "length", "(", ")", ")", ";", "if", "(", "pathInfo", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "applicationDeltaMap", ".", "values", "(", ")", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "apps", ".", "setAppsHashCode", "(", "apps", ".", "getReconcileHashCode", "(", ")", ")", ";", "sendOkResponseWithContent", "(", "(", "Request", ")", "request", ",", "response", ",", "XmlXStream", ".", "getInstance", "(", ")", ".", "toXML", "(", "apps", ")", ")", ";", "handled", "=", "true", ";", "sentDelta", "=", "true", ";", "}", "else", "if", "(", "pathInfo", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "applicationMap", ".", "values", "(", ")", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "apps", ".", "setAppsHashCode", "(", "apps", ".", "getReconcileHashCode", "(", ")", ")", ";", "sendOkResponseWithContent", "(", "(", "Request", ")", "request", ",", "response", ",", "XmlXStream", ".", "getInstance", "(", ")", ".", "toXML", "(", "apps", ")", ")", ";", "handled", "=", "true", ";", "}", "}", "if", "(", "!", "handled", ")", "{", "response", ".", "sendError", "(", "HttpServletResponse", ".", "SC_NOT_FOUND", ",", "\"", "<STR_LIT>", "\"", "+", "pathInfo", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ")", "throws", "IOException", ",", "ServletException", "{", "}", "</s>"]
["<s>", "private", "void", "sendOkResponseWithContent", "(", "Request", "request", ",", "HttpServletResponse", "response", ",", "String", "content", ")", "throws", "IOException", "{", "response", ".", "setContentType", "(", "\"", "<STR_LIT>", "\"", ")", ";", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_OK", ")", ";", "response", ".", "getWriter", "(", ")", ".", "println", "(", "content", ")", ";", "response", ".", "getWriter", "(", ")", ".", "flush", "(", ")", ";", "request", ".", "setHandled", "(", "true", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "request", ".", "getPathInfo", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "content", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ")", ";", "InstanceInfoGenerator", "instanceInfos", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:20>", ",", "<NUM_LIT:6>", ")", ".", "build", "(", ")", ";", "testApplications", "=", "instanceInfos", ".", "toApplications", "(", ")", ";", "applicationsResource", "=", "new", "ApplicationsResource", "(", "serverContext", ")", ";", "for", "(", "Application", "application", ":", "testApplications", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instanceInfo", ":", "application", ".", "getInstances", "(", ")", ")", "{", "registry", ".", "register", "(", "instanceInfo", ",", "false", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFullAppsGetJson", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "applicationsResource", ".", "getContainers", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "MediaType", ".", "APPLICATION_JSON", ",", "null", ",", "EurekaAccept", ".", "full", ".", "name", "(", ")", ",", "null", ",", "null", ")", ";", "String", "json", "=", "String", ".", "valueOf", "(", "response", ".", "getEntity", "(", ")", ")", ";", "DecoderWrapper", "decoder", "=", "CodecWrappers", ".", "getDecoder", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "Applications", "decoded", "=", "decoder", ".", "decode", "(", "json", ",", "Applications", ".", "class", ")", ";", "for", "(", "Application", "application", ":", "testApplications", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "decodedApp", "=", "decoded", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "application", ",", "decodedApp", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFullAppsGetGzipJsonHeaderType", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "applicationsResource", ".", "getContainers", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "MediaType", ".", "APPLICATION_JSON", ",", "\"", "<STR_LIT>", "\"", ",", "EurekaAccept", ".", "full", ".", "name", "(", ")", ",", "null", ",", "null", ")", ";", "assertThat", "(", "response", ".", "getMetadata", "(", ")", ".", "getFirst", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toString", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "response", ".", "getMetadata", "(", ")", ".", "getFirst", "(", "\"", "<STR_LIT:Content-Type>", "\"", ")", ".", "toString", "(", ")", ",", "is", "(", "MediaType", ".", "APPLICATION_JSON", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFullAppsGetGzipXmlHeaderType", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "applicationsResource", ".", "getContainers", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "MediaType", ".", "APPLICATION_XML", ",", "\"", "<STR_LIT>", "\"", ",", "EurekaAccept", ".", "full", ".", "name", "(", ")", ",", "null", ",", "null", ")", ";", "assertThat", "(", "response", ".", "getMetadata", "(", ")", ".", "getFirst", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toString", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "response", ".", "getMetadata", "(", ")", ".", "getFirst", "(", "\"", "<STR_LIT:Content-Type>", "\"", ")", ".", "toString", "(", ")", ",", "is", "(", "MediaType", ".", "APPLICATION_XML", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMiniAppsGet", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "applicationsResource", ".", "getContainers", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "MediaType", ".", "APPLICATION_JSON", ",", "null", ",", "EurekaAccept", ".", "compact", ".", "name", "(", ")", ",", "null", ",", "null", ")", ";", "String", "json", "=", "String", ".", "valueOf", "(", "response", ".", "getEntity", "(", ")", ")", ";", "DecoderWrapper", "decoder", "=", "CodecWrappers", ".", "getDecoder", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "Applications", "decoded", "=", "decoder", ".", "decode", "(", "json", ",", "Applications", ".", "class", ")", ";", "for", "(", "Application", "application", ":", "testApplications", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "decodedApp", "=", "decoded", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "application", ",", "decodedApp", ")", ",", "is", "(", "false", ")", ")", ";", "}", "for", "(", "Application", "application", ":", "testApplications", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "decodedApp", "=", "decoded", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "assertThat", "(", "application", ".", "getName", "(", ")", ",", "is", "(", "decodedApp", ".", "getName", "(", ")", ")", ")", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "application", ".", "getInstances", "(", ")", ")", "{", "InstanceInfo", "decodedInfo", "=", "decodedApp", ".", "getByInstanceId", "(", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedInfo", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "ApplicationResource", "createApplicationResource", "(", "ReplicationInstance", "instanceInfo", ")", "{", "return", "applicationResource", ";", "}", "</s>"]
["<s>", "@", "Override", "InstanceResource", "createInstanceResource", "(", "ReplicationInstance", "instanceInfo", ",", "ApplicationResource", "applicationResource", ")", "{", "return", "instanceResource", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRegisterBatching", "(", ")", "throws", "Exception", "{", "ReplicationList", "replicationList", "=", "new", "ReplicationList", "(", "newReplicationInstanceOf", "(", "Action", ".", "Register", ",", "instanceInfo", ")", ")", ";", "Response", "response", "=", "peerReplicationResource", ".", "batchReplication", "(", "replicationList", ")", ";", "assertStatusOkReply", "(", "response", ")", ";", "verify", "(", "applicationResource", ",", "times", "(", "1", ")", ")", ".", "addInstance", "(", "instanceInfo", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCancelBatching", "(", ")", "throws", "Exception", "{", "when", "(", "instanceResource", ".", "cancelLease", "(", "anyString", "(", ")", ")", ")", ".", "thenReturn", "(", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ")", ";", "ReplicationList", "replicationList", "=", "new", "ReplicationList", "(", "newReplicationInstanceOf", "(", "Action", ".", "Cancel", ",", "instanceInfo", ")", ")", ";", "Response", "response", "=", "peerReplicationResource", ".", "batchReplication", "(", "replicationList", ")", ";", "assertStatusOkReply", "(", "response", ")", ";", "verify", "(", "instanceResource", ",", "times", "(", "1", ")", ")", ".", "cancelLease", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHeartbeat", "(", ")", "throws", "Exception", "{", "when", "(", "instanceResource", ".", "renewLease", "(", "anyString", "(", ")", ",", "anyString", "(", ")", ",", "anyString", "(", ")", ",", "anyString", "(", ")", ")", ")", ".", "thenReturn", "(", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ")", ";", "ReplicationInstance", "replicationInstance", "=", "newReplicationInstanceOf", "(", "Action", ".", "Heartbeat", ",", "instanceInfo", ")", ";", "Response", "response", "=", "peerReplicationResource", ".", "batchReplication", "(", "new", "ReplicationList", "(", "replicationInstance", ")", ")", ";", "assertStatusOkReply", "(", "response", ")", ";", "verify", "(", "instanceResource", ",", "times", "(", "1", ")", ")", ".", "renewLease", "(", "\"", "<STR_LIT>", "\"", ",", "replicationInstance", ".", "getOverriddenStatus", "(", ")", ",", "instanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "Long", ".", "toString", "(", "replicationInstance", ".", "getLastDirtyTimestamp", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusUpdate", "(", ")", "throws", "Exception", "{", "when", "(", "instanceResource", ".", "statusUpdate", "(", "anyString", "(", ")", ",", "anyString", "(", ")", ",", "anyString", "(", ")", ")", ")", ".", "thenReturn", "(", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ")", ";", "ReplicationInstance", "replicationInstance", "=", "newReplicationInstanceOf", "(", "Action", ".", "StatusUpdate", ",", "instanceInfo", ")", ";", "Response", "response", "=", "peerReplicationResource", ".", "batchReplication", "(", "new", "ReplicationList", "(", "replicationInstance", ")", ")", ";", "assertStatusOkReply", "(", "response", ")", ";", "verify", "(", "instanceResource", ",", "times", "(", "1", ")", ")", ".", "statusUpdate", "(", "replicationInstance", ".", "getStatus", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "Long", ".", "toString", "(", "replicationInstance", ".", "getLastDirtyTimestamp", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDeleteStatusOverride", "(", ")", "throws", "Exception", "{", "when", "(", "instanceResource", ".", "deleteStatusUpdate", "(", "anyString", "(", ")", ",", "anyString", "(", ")", ",", "anyString", "(", ")", ")", ")", ".", "thenReturn", "(", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ")", ";", "ReplicationInstance", "replicationInstance", "=", "newReplicationInstanceOf", "(", "Action", ".", "DeleteStatusOverride", ",", "instanceInfo", ")", ";", "Response", "response", "=", "peerReplicationResource", ".", "batchReplication", "(", "new", "ReplicationList", "(", "replicationInstance", ")", ")", ";", "assertStatusOkReply", "(", "response", ")", ";", "verify", "(", "instanceResource", ",", "times", "(", "1", ")", ")", ".", "deleteStatusUpdate", "(", "\"", "<STR_LIT>", "\"", ",", "replicationInstance", ".", "getStatus", "(", ")", ",", "Long", ".", "toString", "(", "replicationInstance", ".", "getLastDirtyTimestamp", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "assertStatusOkReply", "(", "Response", "httpResponse", ")", "{", "ReplicationListResponse", "entity", "=", "(", "ReplicationListResponse", ")", "httpResponse", ".", "getEntity", "(", ")", ";", "assertThat", "(", "entity", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "ReplicationInstanceResponse", "replicationResponse", "=", "entity", ".", "getResponseList", "(", ")", ".", "get", "(", "0", ")", ";", "assertThat", "(", "replicationResponse", ".", "getStatusCode", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ")", ";", "InstanceInfoGenerator", "instanceInfos", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:6>", ",", "1", ")", ".", "build", "(", ")", ";", "testApplication", "=", "instanceInfos", ".", "toApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ".", "get", "(", "0", ")", ";", "resource", "=", "new", "AbstractVIPResource", "(", "serverContext", ")", "{", "@", "Override", "protected", "Response", "getVipResponse", "(", "String", "version", ",", "String", "entityName", ",", "String", "acceptHeader", ",", "EurekaAccept", "eurekaAccept", ",", "Key", ".", "EntityType", "entityType", ")", "{", "return", "super", ".", "getVipResponse", "(", "version", ",", "entityName", ",", "acceptHeader", ",", "eurekaAccept", ",", "entityType", ")", ";", "}", "}", ";", "vipName", "=", "testApplication", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "testApplication", ".", "getInstances", "(", ")", ")", "{", "InstanceInfo", "changed", "=", "new", "InstanceInfo", ".", "Builder", "(", "instanceInfo", ")", ".", "setASGName", "(", "null", ")", ".", "setVIPAddress", "(", "vipName", ")", ".", "build", "(", ")", ";", "registry", ".", "register", "(", "changed", ",", "false", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "Response", "getVipResponse", "(", "String", "version", ",", "String", "entityName", ",", "String", "acceptHeader", ",", "EurekaAccept", "eurekaAccept", ",", "Key", ".", "EntityType", "entityType", ")", "{", "return", "super", ".", "getVipResponse", "(", "version", ",", "entityName", ",", "acceptHeader", ",", "eurekaAccept", ",", "entityType", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFullVipGet", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "resource", ".", "getVipResponse", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "vipName", ",", "MediaType", ".", "APPLICATION_JSON", ",", "EurekaAccept", ".", "full", ",", "Key", ".", "EntityType", ".", "VIP", ")", ";", "String", "json", "=", "String", ".", "valueOf", "(", "response", ".", "getEntity", "(", ")", ")", ";", "DecoderWrapper", "decoder", "=", "CodecWrappers", ".", "getDecoder", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "Applications", "decodedApps", "=", "decoder", ".", "decode", "(", "json", ",", "Applications", ".", "class", ")", ";", "Application", "decodedApp", "=", "decodedApps", ".", "getRegisteredApplications", "(", "testApplication", ".", "getName", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "testApplication", ",", "decodedApp", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMiniVipGet", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "resource", ".", "getVipResponse", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "vipName", ",", "MediaType", ".", "APPLICATION_JSON", ",", "EurekaAccept", ".", "compact", ",", "Key", ".", "EntityType", ".", "VIP", ")", ";", "String", "json", "=", "String", ".", "valueOf", "(", "response", ".", "getEntity", "(", ")", ")", ";", "DecoderWrapper", "decoder", "=", "CodecWrappers", ".", "getDecoder", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "Applications", "decodedApps", "=", "decoder", ".", "decode", "(", "json", ",", "Applications", ".", "class", ")", ";", "Application", "decodedApp", "=", "decodedApps", ".", "getRegisteredApplications", "(", "testApplication", ".", "getName", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "testApplication", ",", "decodedApp", ")", ",", "is", "(", "false", ")", ")", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "testApplication", ".", "getInstances", "(", ")", ")", "{", "InstanceInfo", "decodedInfo", "=", "decodedApp", ".", "getByInstanceId", "(", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedInfo", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ")", ";", "InstanceInfoGenerator", "instanceInfos", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:6>", ",", "1", ")", ".", "build", "(", ")", ";", "testApplication", "=", "instanceInfos", ".", "toApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ".", "get", "(", "0", ")", ";", "applicationResource", "=", "new", "ApplicationResource", "(", "testApplication", ".", "getName", "(", ")", ",", "serverContext", ".", "getServerConfig", "(", ")", ",", "serverContext", ".", "getRegistry", "(", ")", ")", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "testApplication", ".", "getInstances", "(", ")", ")", "{", "registry", ".", "register", "(", "instanceInfo", ",", "false", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFullAppGet", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "applicationResource", ".", "getApplication", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "MediaType", ".", "APPLICATION_JSON", ",", "EurekaAccept", ".", "full", ".", "name", "(", ")", ")", ";", "String", "json", "=", "String", ".", "valueOf", "(", "response", ".", "getEntity", "(", ")", ")", ";", "DecoderWrapper", "decoder", "=", "CodecWrappers", ".", "getDecoder", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "Application", "decodedApp", "=", "decoder", ".", "decode", "(", "json", ",", "Application", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "testApplication", ",", "decodedApp", ")", ",", "is", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMiniAppGet", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "applicationResource", ".", "getApplication", "(", "Version", ".", "V2", ".", "name", "(", ")", ",", "MediaType", ".", "APPLICATION_JSON", ",", "EurekaAccept", ".", "compact", ".", "name", "(", ")", ")", ";", "String", "json", "=", "String", ".", "valueOf", "(", "response", ".", "getEntity", "(", ")", ")", ";", "DecoderWrapper", "decoder", "=", "CodecWrappers", ".", "getDecoder", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "Application", "decodedApp", "=", "decoder", ".", "decode", "(", "json", ",", "Application", ".", "class", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equal", "(", "testApplication", ",", "decodedApp", ")", ",", "is", "(", "false", ")", ")", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "testApplication", ".", "getInstances", "(", ")", ")", "{", "InstanceInfo", "decodedInfo", "=", "decodedApp", ".", "getByInstanceId", "(", "instanceInfo", ".", "getId", "(", ")", ")", ";", "assertThat", "(", "EurekaEntityComparators", ".", "equalMini", "(", "instanceInfo", ",", "decodedInfo", ")", ",", "is", "(", "true", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ")", ";", "applicationResource", "=", "new", "ApplicationResource", "(", "testInstanceInfo", ".", "getAppName", "(", ")", ",", "serverContext", ".", "getServerConfig", "(", ")", ",", "serverContext", ".", "getRegistry", "(", ")", ")", ";", "instanceResource", "=", "new", "InstanceResource", "(", "applicationResource", ",", "testInstanceInfo", ".", "getId", "(", ")", ",", "serverContext", ".", "getServerConfig", "(", ")", ",", "serverContext", ".", "getRegistry", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusOverrideReturnsNotFoundErrorCodeIfInstanceNotRegistered", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "instanceResource", ".", "statusUpdate", "(", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "name", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "Status", ".", "NOT_FOUND", ".", "getStatusCode", "(", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusOverrideDeleteReturnsNotFoundErrorCodeIfInstanceNotRegistered", "(", ")", "throws", "Exception", "{", "Response", "response", "=", "instanceResource", ".", "deleteStatusUpdate", "(", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "name", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "Status", ".", "NOT_FOUND", ".", "getStatusCode", "(", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusOverrideDeleteIsAppliedToRegistry", "(", ")", "throws", "Exception", "{", "registry", ".", "register", "(", "testInstanceInfo", ",", "false", ")", ";", "registry", ".", "statusUpdate", "(", "testInstanceInfo", ".", "getAppName", "(", ")", ",", "testInstanceInfo", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ",", "\"", "<STR_LIT:0>", "\"", ",", "false", ")", ";", "assertThat", "(", "testInstanceInfo", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ")", ")", ";", "Response", "response", "=", "instanceResource", ".", "deleteStatusUpdate", "(", "\"", "<STR_LIT>", "\"", ",", "null", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "testInstanceInfo", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "InstanceStatus", ".", "UNKNOWN", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusOverrideDeleteIsAppliedToRegistryAndProvidedStatusIsSet", "(", ")", "throws", "Exception", "{", "registry", ".", "register", "(", "testInstanceInfo", ",", "false", ")", ";", "registry", ".", "statusUpdate", "(", "testInstanceInfo", ".", "getAppName", "(", ")", ",", "testInstanceInfo", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ",", "\"", "<STR_LIT:0>", "\"", ",", "false", ")", ";", "assertThat", "(", "testInstanceInfo", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ")", ")", ";", "Response", "response", "=", "instanceResource", ".", "deleteStatusUpdate", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "testInstanceInfo", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "InstanceStatus", ".", "DOWN", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSoftDepRemoteUp", "(", ")", "throws", "Exception", "{", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "registry", ".", "shouldAllowAccess", "(", "false", ")", ")", ";", "Assert", ".", "assertTrue", "(", "\"", "<STR_LIT>", "\"", ",", "registry", ".", "shouldAllowAccess", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetAppsFromAllRemoteRegions", "(", ")", "throws", "Exception", "{", "Applications", "apps", "=", "registry", ".", "getApplicationsFromAllRemoteRegions", "(", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "apps", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Application", "app", "=", "registeredApplications", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "REMOTE_REGION_APP_NAME", ",", "app", ".", "getName", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "app", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetAppsDeltaFromAllRemoteRegions", "(", ")", "throws", "Exception", "{", "registerInstanceLocally", "(", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_2_HOSTNAME", ")", ")", ";", "waitForDeltaToBeRetrieved", "(", ")", ";", "Applications", "appDelta", "=", "registry", ".", "getApplicationDeltasFromMultipleRegions", "(", "null", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "appDelta", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Application", "localApplication", "=", "null", ";", "Application", "remApplication", "=", "null", ";", "for", "(", "Application", "registeredApplication", ":", "registeredApplications", ")", "{", "if", "(", "registeredApplication", ".", "getName", "(", ")", ".", "equalsIgnoreCase", "(", "LOCAL_REGION_APP_NAME", ")", ")", "{", "localApplication", "=", "registeredApplication", ";", "}", "if", "(", "registeredApplication", ".", "getName", "(", ")", ".", "equalsIgnoreCase", "(", "REMOTE_REGION_APP_NAME", ")", ")", "{", "remApplication", "=", "registeredApplication", ";", "}", "}", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "localApplication", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "localApplication", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "remApplication", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "remApplication", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAppsHashCodeAfterRefresh", "(", ")", "throws", "InterruptedException", "{", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "registry", ".", "getApplicationsFromAllRemoteRegions", "(", ")", ".", "getAppsHashCode", "(", ")", ")", ";", "registerInstanceLocally", "(", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_2_HOSTNAME", ")", ")", ";", "waitForDeltaToBeRetrieved", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "registry", ".", "getApplicationsFromAllRemoteRegions", "(", ")", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "waitForDeltaToBeRetrieved", "(", ")", "throws", "InterruptedException", "{", "int", "count", "=", "0", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "while", "(", "count", "+", "+", "<", "<NUM_LIT>", "&", "&", "!", "mockRemoteEurekaServer", ".", "isSentDelta", "(", ")", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "}", "if", "(", "!", "mockRemoteEurekaServer", ".", "isSentDelta", "(", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetAppsFromLocalRegionOnly", "(", ")", "throws", "Exception", "{", "registerInstanceLocally", "(", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ")", ";", "Applications", "apps", "=", "registry", ".", "getApplicationsFromLocalRegionOnly", "(", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "apps", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Application", "app", "=", "registeredApplications", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "LOCAL_REGION_APP_NAME", ",", "app", ".", "getName", "(", ")", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "app", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGetAppsFromBothRegions", "(", ")", "throws", "Exception", "{", "registerInstanceLocally", "(", "createRemoteInstance", "(", "LOCAL_REGION_INSTANCE_2_HOSTNAME", ")", ")", ";", "registerInstanceLocally", "(", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ")", ";", "Applications", "apps", "=", "registry", ".", "getApplicationsFromAllRemoteRegions", "(", ")", ";", "List", "<", "Application", ">", "registeredApplications", "=", "apps", ".", "getRegisteredApplications", "(", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "registeredApplications", ".", "size", "(", ")", ")", ";", "Application", "locaApplication", "=", "null", ";", "Application", "remApplication", "=", "null", ";", "for", "(", "Application", "registeredApplication", ":", "registeredApplications", ")", "{", "if", "(", "registeredApplication", ".", "getName", "(", ")", ".", "equalsIgnoreCase", "(", "LOCAL_REGION_APP_NAME", ")", ")", "{", "locaApplication", "=", "registeredApplication", ";", "}", "if", "(", "registeredApplication", ".", "getName", "(", ")", ".", "equalsIgnoreCase", "(", "REMOTE_REGION_APP_NAME", ")", ")", "{", "remApplication", "=", "registeredApplication", ";", "}", "}", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "locaApplication", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "locaApplication", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "remApplication", ")", ";", "Assert", ".", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "remApplication", ".", "getInstances", "(", ")", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStatusOverrideSetAndRemoval", "(", ")", "throws", "Exception", "{", "InstanceInfo", "myInstance", "=", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ";", "registerInstanceLocally", "(", "myInstance", ")", ";", "verifyLocalInstanceStatus", "(", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "UP", ")", ";", "boolean", "statusResult", "=", "registry", ".", "statusUpdate", "(", "LOCAL_REGION_APP_NAME", ",", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ",", "\"", "<STR_LIT:0>", "\"", ",", "false", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "statusResult", ",", "is", "(", "true", ")", ")", ";", "verifyLocalInstanceStatus", "(", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ";", "registry", ".", "register", "(", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ",", "<NUM_LIT>", ",", "false", ")", ";", "verifyLocalInstanceStatus", "(", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "OUT_OF_SERVICE", ")", ";", "statusResult", "=", "registry", ".", "deleteStatusOverride", "(", "LOCAL_REGION_APP_NAME", ",", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "DOWN", ",", "\"", "<STR_LIT:0>", "\"", ",", "false", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "statusResult", ",", "is", "(", "true", ")", ")", ";", "verifyLocalInstanceStatus", "(", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "DOWN", ")", ";", "registry", ".", "register", "(", "createLocalInstance", "(", "LOCAL_REGION_INSTANCE_1_HOSTNAME", ")", ",", "<NUM_LIT>", ",", "false", ")", ";", "verifyLocalInstanceStatus", "(", "myInstance", ".", "getId", "(", ")", ",", "InstanceStatus", ".", "UP", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEvictionTaskCompensationTime", "(", ")", "throws", "Exception", "{", "long", "evictionTaskPeriodNanos", "=", "serverConfig", ".", "getEvictionIntervalTimerInMs", "(", ")", "*", "<NUM_LIT>", ";", "AbstractInstanceRegistry", ".", "EvictionTask", "testTask", "=", "spy", "(", "registry", ".", "new", "EvictionTask", "(", ")", ")", ";", "when", "(", "testTask", ".", "getCurrentTimeNano", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT>", ")", ".", "thenReturn", "(", "<NUM_LIT>", "+", "evictionTaskPeriodNanos", ")", ".", "thenReturn", "(", "<NUM_LIT>", "+", "evictionTaskPeriodNanos", "*", "<NUM_LIT:2>", "+", "<NUM_LIT>", ")", ".", "thenReturn", "(", "<NUM_LIT>", "+", "evictionTaskPeriodNanos", "*", "<NUM_LIT:3>", "-", "<NUM_LIT>", ")", ";", "assertThat", "(", "testTask", ".", "getCompensationTimeMs", "(", ")", ",", "is", "(", "0", "l", ")", ")", ";", "assertThat", "(", "testTask", ".", "getCompensationTimeMs", "(", ")", ",", "is", "(", "0", "l", ")", ")", ";", "assertThat", "(", "testTask", ".", "getCompensationTimeMs", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "testTask", ".", "getCompensationTimeMs", "(", ")", ",", "is", "(", "0", "l", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "verifyLocalInstanceStatus", "(", "String", "id", ",", "InstanceStatus", "status", ")", "{", "InstanceInfo", "instanceInfo", "=", "registry", ".", "getApplication", "(", "LOCAL_REGION_APP_NAME", ")", ".", "getByInstanceId", "(", "id", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", ",", "instanceInfo", ",", "is", "(", "notNullValue", "(", ")", ")", ")", ";", "assertThat", "(", "\"", "<STR_LIT>", "\"", ",", "instanceInfo", ".", "getStatus", "(", ")", ",", "is", "(", "equalTo", "(", "status", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "registerInstanceLocally", "(", "InstanceInfo", "remoteInstance", ")", "{", "registry", ".", "register", "(", "remoteInstance", ",", "<NUM_LIT>", ",", "false", ")", ";", "registeredApps", ".", "add", "(", "new", "Pair", "<", "String", ",", "String", ">", "(", "LOCAL_REGION_APP_NAME", ",", "LOCAL_REGION_APP_NAME", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "super", ".", "setUp", "(", ")", ";", "EurekaServerConfig", "serverConfig", "=", "spy", "(", "new", "DefaultEurekaServerConfig", "(", ")", ")", ";", "doReturn", "(", "true", ")", ".", "when", "(", "serverConfig", ")", ".", "disableTransparentFallbackToOtherRegion", "(", ")", ";", "testRegistry", "=", "new", "PeerAwareInstanceRegistryImpl", "(", "serverConfig", ",", "new", "DefaultEurekaClientConfig", "(", ")", ",", "new", "DefaultServerCodecs", "(", "serverConfig", ")", ",", "client", ")", ";", "testRegistry", ".", "init", "(", "serverContext", ".", "getPeerEurekaNodes", "(", ")", ")", ";", "testRegistry", ".", "syncUp", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvalidate", "(", ")", "throws", "Exception", "{", "ResponseCacheImpl", "cache", "=", "(", "ResponseCacheImpl", ")", "testRegistry", ".", "getResponseCache", "(", ")", ";", "Key", "key", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "REMOTE_REGION_APP_NAME", ",", "Key", ".", "KeyType", ".", "JSON", ",", "Version", ".", "V1", ",", "EurekaAccept", ".", "full", ")", ";", "String", "response", "=", "cache", ".", "get", "(", "key", ",", "false", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "response", ")", ";", "testRegistry", ".", "cancel", "(", "REMOTE_REGION_APP_NAME", ",", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ",", "true", ")", ";", "Assert", ".", "assertNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvalidateWithRemoteRegion", "(", ")", "throws", "Exception", "{", "ResponseCacheImpl", "cache", "=", "(", "ResponseCacheImpl", ")", "testRegistry", ".", "getResponseCache", "(", ")", ";", "Key", "key", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "REMOTE_REGION_APP_NAME", ",", "Key", ".", "KeyType", ".", "JSON", ",", "Version", ".", "V1", ",", "EurekaAccept", ".", "full", ",", "new", "String", "[", "]", "{", "REMOTE_REGION", "}", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key", ",", "false", ")", ")", ";", "testRegistry", ".", "cancel", "(", "REMOTE_REGION_APP_NAME", ",", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ",", "true", ")", ";", "Assert", ".", "assertNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvalidateWithMultipleRemoteRegions", "(", ")", "throws", "Exception", "{", "ResponseCacheImpl", "cache", "=", "(", "ResponseCacheImpl", ")", "testRegistry", ".", "getResponseCache", "(", ")", ";", "Key", "key1", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "REMOTE_REGION_APP_NAME", ",", "Key", ".", "KeyType", ".", "JSON", ",", "Version", ".", "V1", ",", "EurekaAccept", ".", "full", ",", "new", "String", "[", "]", "{", "REMOTE_REGION", ",", "\"", "<STR_LIT:2>", "\"", "}", ")", ";", "Key", "key2", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "REMOTE_REGION_APP_NAME", ",", "Key", ".", "KeyType", ".", "JSON", ",", "Version", ".", "V1", ",", "EurekaAccept", ".", "full", ",", "new", "String", "[", "]", "{", "REMOTE_REGION", "}", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key1", ",", "false", ")", ")", ";", "Assert", ".", "assertNotNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key2", ",", "false", ")", ")", ";", "testRegistry", ".", "cancel", "(", "REMOTE_REGION_APP_NAME", ",", "REMOTE_REGION_INSTANCE_1_HOSTNAME", ",", "true", ")", ";", "Assert", ".", "assertNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key1", ",", "true", ")", ")", ";", "Assert", ".", "assertNull", "(", "\"", "<STR_LIT>", "\"", ",", "cache", ".", "get", "(", "key2", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "void", "initialize", "(", ")", "throws", "Exception", ";", "</s>"]
["<s>", "void", "shutdown", "(", ")", "throws", "Exception", ";", "</s>"]
["<s>", "EurekaServerConfig", "getServerConfig", "(", ")", ";", "</s>"]
["<s>", "PeerEurekaNodes", "getPeerEurekaNodes", "(", ")", ";", "</s>"]
["<s>", "ServerCodecs", "getServerCodecs", "(", ")", ";", "</s>"]
["<s>", "PeerAwareInstanceRegistry", "getRegistry", "(", ")", ";", "</s>"]
["<s>", "ApplicationInfoManager", "getApplicationInfoManager", "(", ")", ";", "</s>"]
["<s>", "@", "Inject", "public", "RateLimitingFilter", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "serverConfig", "=", "server", ".", "getServerConfig", "(", ")", ";", "}", "</s>"]
["<s>", "public", "RateLimitingFilter", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", "FilterConfig", "filterConfig", ")", "throws", "ServletException", "{", "if", "(", "serverConfig", "=", "=", "null", ")", "{", "EurekaServerContext", "serverContext", "=", "(", "EurekaServerContext", ")", "filterConfig", ".", "getServletContext", "(", ")", ".", "getAttribute", "(", "EurekaServerContext", ".", "class", ".", "getName", "(", ")", ")", ";", "serverConfig", "=", "serverContext", ".", "getServerConfig", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterChain", "chain", ")", "throws", "IOException", ",", "ServletException", "{", "Target", "target", "=", "getTarget", "(", "request", ")", ";", "if", "(", "target", "=", "=", "Target", ".", "Other", ")", "{", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "return", ";", "}", "HttpServletRequest", "httpRequest", "=", "(", "HttpServletRequest", ")", "request", ";", "if", "(", "isRateLimited", "(", "httpRequest", ",", "target", ")", ")", "{", "incrementStats", "(", "target", ")", ";", "if", "(", "serverConfig", ".", "isRateLimiterEnabled", "(", ")", ")", "{", "(", "(", "HttpServletResponse", ")", "response", ")", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "return", ";", "}", "}", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Target", "getTarget", "(", "ServletRequest", "request", ")", "{", "Target", "target", "=", "Target", ".", "Other", ";", "if", "(", "request", "instanceof", "HttpServletRequest", ")", "{", "HttpServletRequest", "httpRequest", "=", "(", "HttpServletRequest", ")", "request", ";", "String", "pathInfo", "=", "httpRequest", ".", "getRequestURI", "(", ")", ";", "if", "(", "\"", "<STR_LIT:GET>", "\"", ".", "equals", "(", "httpRequest", ".", "getMethod", "(", ")", ")", "&", "&", "pathInfo", "!", "=", "null", ")", "{", "Matcher", "matcher", "=", "TARGET_RE", ".", "matcher", "(", "pathInfo", ")", ";", "if", "(", "matcher", ".", "matches", "(", ")", ")", "{", "if", "(", "matcher", ".", "groupCount", "(", ")", "=", "=", "0", "|", "|", "matcher", ".", "group", "(", "1", ")", "=", "=", "null", "|", "|", "\"", "<STR_LIT:/>", "\"", ".", "equals", "(", "matcher", ".", "group", "(", "1", ")", ")", ")", "{", "target", "=", "Target", ".", "FullFetch", ";", "}", "else", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "matcher", ".", "group", "(", "1", ")", ")", ")", "{", "target", "=", "Target", ".", "DeltaFetch", ";", "}", "else", "{", "target", "=", "Target", ".", "Application", ";", "}", "}", "}", "if", "(", "target", "=", "=", "Target", ".", "Other", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "pathInfo", ")", ";", "}", "}", "return", "target", ";", "}", "</s>"]
["<s>", "private", "boolean", "isRateLimited", "(", "HttpServletRequest", "request", ",", "Target", "target", ")", "{", "if", "(", "isPrivileged", "(", "request", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "target", ")", ";", "return", "false", ";", "}", "if", "(", "isOverloaded", "(", "target", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "target", ")", ";", "return", "true", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "target", ")", ";", "return", "false", ";", "}", "</s>"]
["<s>", "private", "boolean", "isPrivileged", "(", "HttpServletRequest", "request", ")", "{", "if", "(", "serverConfig", ".", "isRateLimiterThrottleStandardClients", "(", ")", ")", "{", "return", "false", ";", "}", "Set", "<", "String", ">", "privilegedClients", "=", "serverConfig", ".", "getRateLimiterPrivilegedClients", "(", ")", ";", "String", "clientName", "=", "request", ".", "getHeader", "(", "AbstractEurekaIdentity", ".", "AUTH_NAME_HEADER_KEY", ")", ";", "return", "privilegedClients", ".", "contains", "(", "clientName", ")", "|", "|", "DEFAULT_PRIVILEGED_CLIENTS", ".", "contains", "(", "clientName", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isOverloaded", "(", "Target", "target", ")", "{", "int", "maxInWindow", "=", "serverConfig", ".", "getRateLimiterBurstSize", "(", ")", ";", "int", "fetchWindowSize", "=", "serverConfig", ".", "getRateLimiterRegistryFetchAverageRate", "(", ")", ";", "boolean", "overloaded", "=", "!", "registryFetchRateLimiter", ".", "acquire", "(", "maxInWindow", ",", "fetchWindowSize", ")", ";", "if", "(", "target", "=", "=", "Target", ".", "FullFetch", ")", "{", "int", "fullFetchWindowSize", "=", "serverConfig", ".", "getRateLimiterFullFetchAverageRate", "(", ")", ";", "overloaded", "|", "=", "!", "registryFullFetchRateLimiter", ".", "acquire", "(", "maxInWindow", ",", "fullFetchWindowSize", ")", ";", "}", "return", "overloaded", ";", "}", "</s>"]
["<s>", "private", "void", "incrementStats", "(", "Target", "target", ")", "{", "if", "(", "serverConfig", ".", "isRateLimiterEnabled", "(", ")", ")", "{", "EurekaMonitors", ".", "RATE_LIMITED", ".", "increment", "(", ")", ";", "if", "(", "target", "=", "=", "Target", ".", "FullFetch", ")", "{", "EurekaMonitors", ".", "RATE_LIMITED_FULL_FETCH", ".", "increment", "(", ")", ";", "}", "}", "else", "{", "EurekaMonitors", ".", "RATE_LIMITED_CANDIDATES", ".", "increment", "(", ")", ";", "if", "(", "target", "=", "=", "Target", ".", "FullFetch", ")", "{", "EurekaMonitors", ".", "RATE_LIMITED_FULL_FETCH_CANDIDATES", ".", "increment", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "destroy", "(", ")", "{", "}", "</s>"]
["<s>", "static", "void", "reset", "(", ")", "{", "registryFetchRateLimiter", ".", "reset", "(", ")", ";", "registryFullFetchRateLimiter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "contextInitialized", "(", "ServletContextEvent", "event", ")", "{", "try", "{", "initEurekaEnvironment", "(", ")", ";", "initEurekaServerContext", "(", ")", ";", "ServletContext", "sc", "=", "event", ".", "getServletContext", "(", ")", ";", "sc", ".", "setAttribute", "(", "EurekaServerContext", ".", "class", ".", "getName", "(", ")", ",", "serverContext", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "initEurekaEnvironment", "(", ")", "throws", "Exception", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LoggingConfiguration", ".", "getInstance", "(", ")", ".", "configure", "(", ")", ";", "String", "dataCenter", "=", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getString", "(", "EUREKA_DATACENTER", ")", ";", "if", "(", "dataCenter", "=", "=", "null", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "ARCHAIUS_DEPLOYMENT_DATACENTER", ",", "DEFAULT", ")", ";", "}", "else", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "ARCHAIUS_DEPLOYMENT_DATACENTER", ",", "dataCenter", ")", ";", "}", "String", "environment", "=", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getString", "(", "EUREKA_ENVIRONMENT", ")", ";", "if", "(", "environment", "=", "=", "null", ")", "{", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "ARCHAIUS_DEPLOYMENT_ENVIRONMENT", ",", "TEST", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "initEurekaServerContext", "(", ")", "throws", "Exception", "{", "EurekaServerConfig", "eurekaServerConfig", "=", "new", "DefaultEurekaServerConfig", "(", ")", ";", "JsonXStream", ".", "getInstance", "(", ")", ".", "registerConverter", "(", "new", "V1AwareInstanceInfoConverter", "(", ")", ",", "XStream", ".", "PRIORITY_VERY_HIGH", ")", ";", "XmlXStream", ".", "getInstance", "(", ")", ".", "registerConverter", "(", "new", "V1AwareInstanceInfoConverter", "(", ")", ",", "XStream", ".", "PRIORITY_VERY_HIGH", ")", ";", "EurekaInstanceConfig", "instanceConfig", "=", "isCloud", "(", "ConfigurationManager", ".", "getDeploymentContext", "(", ")", ")", "?", "new", "CloudInstanceConfig", "(", ")", ":", "new", "MyDataCenterInstanceConfig", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ServerCodecs", "serverCodecs", "=", "new", "DefaultServerCodecs", "(", "eurekaServerConfig", ")", ";", "ApplicationInfoManager", "applicationInfoManager", "=", "new", "ApplicationInfoManager", "(", "instanceConfig", ",", "new", "EurekaConfigBasedInstanceInfoProvider", "(", "instanceConfig", ")", ".", "get", "(", ")", ")", ";", "EurekaClientConfig", "eurekaClientConfig", "=", "new", "DefaultEurekaClientConfig", "(", ")", ";", "EurekaClient", "eurekaClient", "=", "new", "DiscoveryClient", "(", "applicationInfoManager", ",", "eurekaClientConfig", ")", ";", "PeerAwareInstanceRegistry", "registry", ";", "if", "(", "isAws", "(", "applicationInfoManager", ".", "getInfo", "(", ")", ")", ")", "{", "registry", "=", "new", "AwsInstanceRegistry", "(", "eurekaServerConfig", ",", "eurekaClientConfig", ",", "serverCodecs", ",", "eurekaClient", ")", ";", "awsBinder", "=", "new", "AwsBinderDelegate", "(", "eurekaServerConfig", ",", "eurekaClientConfig", ",", "registry", ",", "applicationInfoManager", ")", ";", "awsBinder", ".", "start", "(", ")", ";", "}", "else", "{", "registry", "=", "new", "PeerAwareInstanceRegistryImpl", "(", "eurekaServerConfig", ",", "eurekaClientConfig", ",", "serverCodecs", ",", "eurekaClient", ")", ";", "}", "PeerEurekaNodes", "peerEurekaNodes", "=", "new", "PeerEurekaNodes", "(", "registry", ",", "eurekaServerConfig", ",", "eurekaClientConfig", ",", "serverCodecs", ",", "applicationInfoManager", ")", ";", "serverContext", "=", "new", "DefaultEurekaServerContext", "(", "eurekaServerConfig", ",", "serverCodecs", ",", "registry", ",", "peerEurekaNodes", ",", "applicationInfoManager", ")", ";", "EurekaServerContextHolder", ".", "initialize", "(", "serverContext", ")", ";", "serverContext", ".", "initialize", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "int", "registryCount", "=", "registry", ".", "syncUp", "(", ")", ";", "registry", ".", "openForTraffic", "(", "applicationInfoManager", ",", "registryCount", ")", ";", "EurekaMonitors", ".", "registerAllStats", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "contextDestroyed", "(", "ServletContextEvent", "event", ")", "{", "try", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Date", "(", ")", ".", "toString", "(", ")", ")", ";", "ServletContext", "sc", "=", "event", ".", "getServletContext", "(", ")", ";", "sc", ".", "removeAttribute", "(", "EurekaServerContext", ".", "class", ".", "getName", "(", ")", ")", ";", "destroyEurekaServerContext", "(", ")", ";", "destroyEurekaEnvironment", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Date", "(", ")", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "destroyEurekaServerContext", "(", ")", "throws", "Exception", "{", "EurekaMonitors", ".", "shutdown", "(", ")", ";", "if", "(", "awsBinder", "!", "=", "null", ")", "{", "awsBinder", ".", "shutdown", "(", ")", ";", "}", "if", "(", "serverContext", "!", "=", "null", ")", "{", "serverContext", ".", "shutdown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "destroyEurekaEnvironment", "(", ")", "throws", "Exception", "{", "}", "</s>"]
["<s>", "protected", "boolean", "isAws", "(", "InstanceInfo", "selfInstanceInfo", ")", "{", "boolean", "result", "=", "DataCenterInfo", ".", "Name", ".", "Amazon", "=", "=", "selfInstanceInfo", ".", "getDataCenterInfo", "(", ")", ".", "getName", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "result", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isCloud", "(", "DeploymentContext", "deploymentContext", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "deploymentContext", ".", "getDeploymentDatacenter", "(", ")", ")", ";", "return", "CLOUD", ".", "equals", "(", "deploymentContext", ".", "getDeploymentDatacenter", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "ServerRequestAuthFilter", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "serverConfig", "=", "server", ".", "getServerConfig", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ServerRequestAuthFilter", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", "FilterConfig", "filterConfig", ")", "throws", "ServletException", "{", "if", "(", "serverConfig", "=", "=", "null", ")", "{", "EurekaServerContext", "serverContext", "=", "(", "EurekaServerContext", ")", "filterConfig", ".", "getServletContext", "(", ")", ".", "getAttribute", "(", "EurekaServerContext", ".", "class", ".", "getName", "(", ")", ")", ";", "serverConfig", "=", "serverContext", ".", "getServerConfig", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterChain", "chain", ")", "throws", "IOException", ",", "ServletException", "{", "logAuth", "(", "request", ")", ";", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "destroy", "(", ")", "{", "}", "</s>"]
["<s>", "protected", "void", "logAuth", "(", "ServletRequest", "request", ")", "{", "if", "(", "serverConfig", ".", "shouldLogIdentityHeaders", "(", ")", ")", "{", "if", "(", "request", "instanceof", "HttpServletRequest", ")", "{", "HttpServletRequest", "httpRequest", "=", "(", "HttpServletRequest", ")", "request", ";", "String", "clientName", "=", "getHeader", "(", "httpRequest", ",", "AbstractEurekaIdentity", ".", "AUTH_NAME_HEADER_KEY", ")", ";", "String", "clientVersion", "=", "getHeader", "(", "httpRequest", ",", "AbstractEurekaIdentity", ".", "AUTH_VERSION_HEADER_KEY", ")", ";", "DynamicCounter", ".", "increment", "(", "MonitorConfig", ".", "builder", "(", "NAME_PREFIX", "+", "clientName", "+", "\"", "<STR_LIT:->", "\"", "+", "clientVersion", ")", ".", "build", "(", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "protected", "String", "getHeader", "(", "HttpServletRequest", "request", ",", "String", "headerKey", ")", "{", "String", "value", "=", "request", ".", "getHeader", "(", "headerKey", ")", ";", "return", "Strings", ".", "isNullOrEmpty", "(", "value", ")", "?", "UNKNOWN", ":", "value", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "DefaultEurekaServerContext", "(", "EurekaServerConfig", "serverConfig", ",", "ServerCodecs", "serverCodecs", ",", "PeerAwareInstanceRegistry", "registry", ",", "PeerEurekaNodes", "peerEurekaNodes", ",", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "serverCodecs", "=", "serverCodecs", ";", "this", ".", "registry", "=", "registry", ";", "this", ".", "peerEurekaNodes", "=", "peerEurekaNodes", ";", "this", ".", "applicationInfoManager", "=", "applicationInfoManager", ";", "}", "</s>"]
["<s>", "@", "PostConstruct", "@", "Override", "public", "void", "initialize", "(", ")", "throws", "Exception", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "peerEurekaNodes", ".", "start", "(", ")", ";", "registry", ".", "init", "(", "peerEurekaNodes", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "PreDestroy", "@", "Override", "public", "void", "shutdown", "(", ")", "throws", "Exception", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "registry", ".", "shutdown", "(", ")", ";", "peerEurekaNodes", ".", "shutdown", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "EurekaServerConfig", "getServerConfig", "(", ")", "{", "return", "serverConfig", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PeerEurekaNodes", "getPeerEurekaNodes", "(", ")", "{", "return", "peerEurekaNodes", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ServerCodecs", "getServerCodecs", "(", ")", "{", "return", "serverCodecs", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PeerAwareInstanceRegistry", "getRegistry", "(", ")", "{", "return", "registry", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ApplicationInfoManager", "getApplicationInfoManager", "(", ")", "{", "return", "applicationInfoManager", ";", "}", "</s>"]
["<s>", "String", "getAWSAccessId", "(", ")", ";", "</s>"]
["<s>", "String", "getAWSSecretKey", "(", ")", ";", "</s>"]
["<s>", "int", "getEIPBindRebindRetries", "(", ")", ";", "</s>"]
["<s>", "int", "getEIPBindingRetryIntervalMs", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldEnableSelfPreservation", "(", ")", ";", "</s>"]
["<s>", "double", "getRenewalPercentThreshold", "(", ")", ";", "</s>"]
["<s>", "int", "getRenewalThresholdUpdateIntervalMs", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerEurekaNodesUpdateIntervalMs", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldEnableReplicatedRequestCompression", "(", ")", ";", "</s>"]
["<s>", "int", "getNumberOfReplicationRetries", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerEurekaStatusRefreshTimeIntervalMs", "(", ")", ";", "</s>"]
["<s>", "int", "getWaitTimeInMsWhenSyncEmpty", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerNodeConnectTimeoutMs", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerNodeReadTimeoutMs", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerNodeTotalConnections", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerNodeTotalConnectionsPerHost", "(", ")", ";", "</s>"]
["<s>", "int", "getPeerNodeConnectionIdleTimeoutSeconds", "(", ")", ";", "</s>"]
["<s>", "long", "getRetentionTimeInMSInDeltaQueue", "(", ")", ";", "</s>"]
["<s>", "long", "getDeltaRetentionTimerIntervalInMs", "(", ")", ";", "</s>"]
["<s>", "long", "getEvictionIntervalTimerInMs", "(", ")", ";", "</s>"]
["<s>", "int", "getASGQueryTimeoutMs", "(", ")", ";", "</s>"]
["<s>", "long", "getASGUpdateIntervalMs", "(", ")", ";", "</s>"]
["<s>", "long", "getASGCacheExpiryTimeoutMs", "(", ")", ";", "</s>"]
["<s>", "long", "getResponseCacheAutoExpirationInSeconds", "(", ")", ";", "</s>"]
["<s>", "long", "getResponseCacheUpdateIntervalMs", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldUseReadOnlyResponseCache", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldDisableDelta", "(", ")", ";", "</s>"]
["<s>", "long", "getMaxIdleThreadInMinutesAgeForStatusReplication", "(", ")", ";", "</s>"]
["<s>", "int", "getMinThreadsForStatusReplication", "(", ")", ";", "</s>"]
["<s>", "int", "getMaxThreadsForStatusReplication", "(", ")", ";", "</s>"]
["<s>", "int", "getMaxElementsInStatusReplicationPool", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldSyncWhenTimestampDiffers", "(", ")", ";", "</s>"]
["<s>", "int", "getRegistrySyncRetries", "(", ")", ";", "</s>"]
["<s>", "long", "getRegistrySyncRetryWaitMs", "(", ")", ";", "</s>"]
["<s>", "int", "getMaxElementsInPeerReplicationPool", "(", ")", ";", "</s>"]
["<s>", "long", "getMaxIdleThreadAgeInMinutesForPeerReplication", "(", ")", ";", "</s>"]
["<s>", "int", "getMinThreadsForPeerReplication", "(", ")", ";", "</s>"]
["<s>", "int", "getMaxThreadsForPeerReplication", "(", ")", ";", "</s>"]
["<s>", "int", "getMaxTimeForReplication", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldPrimeAwsReplicaConnections", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldDisableDeltaForRemoteRegions", "(", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionConnectTimeoutMs", "(", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionReadTimeoutMs", "(", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionTotalConnections", "(", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionTotalConnectionsPerHost", "(", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionConnectionIdleTimeoutSeconds", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldGZipContentFromRemoteRegion", "(", ")", ";", "</s>"]
["<s>", "Map", "<", "String", ",", "String", ">", "getRemoteRegionUrlsWithName", "(", ")", ";", "</s>"]
["<s>", "String", "[", "]", "getRemoteRegionUrls", "(", ")", ";", "</s>"]
["<s>", "@", "Nullable", "Set", "<", "String", ">", "getRemoteRegionAppWhitelist", "(", "@", "Nullable", "String", "regionName", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionRegistryFetchInterval", "(", ")", ";", "</s>"]
["<s>", "int", "getRemoteRegionFetchThreadPoolSize", "(", ")", ";", "</s>"]
["<s>", "String", "getRemoteRegionTrustStore", "(", ")", ";", "</s>"]
["<s>", "String", "getRemoteRegionTrustStorePassword", "(", ")", ";", "</s>"]
["<s>", "boolean", "disableTransparentFallbackToOtherRegion", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldBatchReplication", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldLogIdentityHeaders", "(", ")", ";", "</s>"]
["<s>", "boolean", "isRateLimiterEnabled", "(", ")", ";", "</s>"]
["<s>", "boolean", "isRateLimiterThrottleStandardClients", "(", ")", ";", "</s>"]
["<s>", "Set", "<", "String", ">", "getRateLimiterPrivilegedClients", "(", ")", ";", "</s>"]
["<s>", "int", "getRateLimiterBurstSize", "(", ")", ";", "</s>"]
["<s>", "int", "getRateLimiterRegistryFetchAverageRate", "(", ")", ";", "</s>"]
["<s>", "int", "getRateLimiterFullFetchAverageRate", "(", ")", ";", "</s>"]
["<s>", "String", "getListAutoScalingGroupsRoleName", "(", ")", ";", "</s>"]
["<s>", "String", "getJsonCodecName", "(", ")", ";", "</s>"]
["<s>", "String", "getXmlCodecName", "(", ")", ";", "</s>"]
["<s>", "String", "getExperimental", "(", "String", "name", ")", ";", "</s>"]
["<s>", "AwsBindingStrategy", "getBindingStrategy", "(", ")", ";", "</s>"]
["<s>", "long", "getRoute53DomainTTL", "(", ")", ";", "</s>"]
["<s>", "int", "getRoute53BindRebindRetries", "(", ")", ";", "</s>"]
["<s>", "int", "getRoute53BindingRetryIntervalMs", "(", ")", ";", "</s>"]
["<s>", "public", "DefaultEurekaServerConfig", "(", ")", "{", "init", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DefaultEurekaServerConfig", "(", "String", "namespace", ")", "{", "this", ".", "namespace", "=", "namespace", ";", "init", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "init", "(", ")", "{", "String", "env", "=", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "getString", "(", "EUREKA_ENVIRONMENT", ",", "TEST", ")", ";", "ConfigurationManager", ".", "getConfigInstance", "(", ")", ".", "setProperty", "(", "ARCHAIUS_DEPLOYMENT_ENVIRONMENT", ",", "env", ")", ";", "String", "eurekaPropsFile", "=", "EUREKA_PROPS_FILE", ".", "get", "(", ")", ";", "try", "{", "ConfigurationManager", ".", "loadCascadedPropertiesFromResources", "(", "eurekaPropsFile", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "eurekaPropsFile", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAWSAccessId", "(", ")", "{", "String", "aWSAccessId", "=", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "if", "(", "null", "!", "=", "aWSAccessId", ")", "{", "return", "aWSAccessId", ".", "trim", "(", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAWSSecretKey", "(", ")", "{", "String", "aWSSecretKey", "=", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "if", "(", "null", "!", "=", "aWSSecretKey", ")", "{", "return", "aWSSecretKey", ".", "trim", "(", ")", ";", "}", "else", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEIPBindRebindRetries", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:3>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getEIPBindingRetryIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:5>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldEnableSelfPreservation", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerEurekaNodesUpdateIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:10>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRenewalThresholdUpdateIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:15>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "double", "getRenewalPercentThreshold", "(", ")", "{", "return", "configInstance", ".", "getDoubleProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldEnableReplicatedRequestCompression", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumberOfReplicationRetries", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerEurekaStatusRefreshTimeIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:30>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getWaitTimeInMsWhenSyncEmpty", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:1000>", "*", "<NUM_LIT>", "*", "<NUM_LIT:5>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerNodeConnectTimeoutMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerNodeReadTimeoutMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerNodeTotalConnections", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:1000>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerNodeTotalConnectionsPerHost", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPeerNodeConnectionIdleTimeoutSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getRetentionTimeInMSInDeltaQueue", "(", ")", "{", "return", "configInstance", ".", "getLongProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:3>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getDeltaRetentionTimerIntervalInMs", "(", ")", "{", "return", "configInstance", ".", "getLongProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:30>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getEvictionIntervalTimerInMs", "(", ")", "{", "return", "configInstance", ".", "getLongProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getASGQueryTimeoutMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getASGUpdateIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:5>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getASGCacheExpiryTimeoutMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:10>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getResponseCacheAutoExpirationInSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getResponseCacheUpdateIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:30>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldUseReadOnlyResponseCache", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldDisableDelta", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getMaxIdleThreadInMinutesAgeForStatusReplication", "(", ")", "{", "return", "configInstance", ".", "getLongProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMinThreadsForStatusReplication", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "1", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaxThreadsForStatusReplication", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "1", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaxElementsInStatusReplicationPool", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldSyncWhenTimestampDiffers", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRegistrySyncRetries", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getRegistrySyncRetryWaitMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", "*", "<NUM_LIT:1000>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaxElementsInPeerReplicationPool", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getMaxIdleThreadAgeInMinutesForPeerReplication", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:15>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMinThreadsForPeerReplication", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaxThreadsForPeerReplication", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaxTimeForReplication", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "TIME_TO_WAIT_FOR_REPLICATION", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldPrimeAwsReplicaConnections", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldDisableDeltaForRemoteRegions", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionConnectTimeoutMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:1000>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionReadTimeoutMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:1000>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionTotalConnections", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:1000>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionTotalConnectionsPerHost", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionConnectionIdleTimeoutSeconds", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldGZipContentFromRemoteRegion", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getRemoteRegionUrlsWithName", "(", ")", "{", "String", "propName", "=", "namespace", "+", "\"", "<STR_LIT>", "\"", ";", "String", "remoteRegionUrlWithNameString", "=", "configInstance", ".", "getStringProperty", "(", "propName", ",", "null", ")", ".", "get", "(", ")", ";", "if", "(", "null", "=", "=", "remoteRegionUrlWithNameString", ")", "{", "return", "Collections", ".", "emptyMap", "(", ")", ";", "}", "String", "[", "]", "remoteRegionUrlWithNamePairs", "=", "remoteRegionUrlWithNameString", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "Map", "<", "String", ",", "String", ">", "toReturn", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", "remoteRegionUrlWithNamePairs", ".", "length", ")", ";", "final", "String", "pairSplitChar", "=", "\"", "<STR_LIT:;>", "\"", ";", "for", "(", "String", "remoteRegionUrlWithNamePair", ":", "remoteRegionUrlWithNamePairs", ")", "{", "String", "[", "]", "pairSplit", "=", "remoteRegionUrlWithNamePair", ".", "split", "(", "pairSplitChar", ")", ";", "if", "(", "pairSplit", ".", "length", "<", "<NUM_LIT:2>", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "new", "String", "[", "]", "{", "propName", ",", "remoteRegionUrlWithNamePair", ",", "pairSplitChar", "}", ")", ";", "}", "else", "{", "String", "regionName", "=", "pairSplit", "[", "0", "]", ";", "String", "regionUrl", "=", "pairSplit", "[", "1", "]", ";", "if", "(", "pairSplit", ".", "length", ">", "<NUM_LIT:2>", ")", "{", "StringBuilder", "regionUrlAssembler", "=", "new", "StringBuilder", "(", ")", ";", "for", "(", "int", "i", "=", "1", ";", "i", "<", "pairSplit", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "regionUrlAssembler", ".", "length", "(", ")", "!", "=", "0", ")", "{", "regionUrlAssembler", ".", "append", "(", "pairSplitChar", ")", ";", "}", "regionUrlAssembler", ".", "append", "(", "pairSplit", "[", "i", "]", ")", ";", "}", "regionUrl", "=", "regionUrlAssembler", ".", "toString", "(", ")", ";", "}", "toReturn", ".", "put", "(", "regionName", ",", "regionUrl", ")", ";", "}", "}", "return", "toReturn", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "[", "]", "getRemoteRegionUrls", "(", ")", "{", "String", "remoteRegionUrlString", "=", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "String", "[", "]", "remoteRegionUrl", "=", "null", ";", "if", "(", "remoteRegionUrlString", "!", "=", "null", ")", "{", "remoteRegionUrl", "=", "remoteRegionUrlString", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "}", "return", "remoteRegionUrl", ";", "}", "</s>"]
["<s>", "@", "Nullable", "@", "Override", "public", "Set", "<", "String", ">", "getRemoteRegionAppWhitelist", "(", "@", "Nullable", "String", "regionName", ")", "{", "if", "(", "null", "=", "=", "regionName", ")", "{", "regionName", "=", "\"", "<STR_LIT>", "\"", ";", "}", "else", "{", "regionName", "=", "regionName", ".", "trim", "(", ")", ".", "toLowerCase", "(", ")", ";", "}", "DynamicStringProperty", "appWhiteListProp", "=", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", "+", "regionName", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "if", "(", "null", "=", "=", "appWhiteListProp", "|", "|", "null", "=", "=", "appWhiteListProp", ".", "get", "(", ")", ")", "{", "return", "null", ";", "}", "else", "{", "String", "appWhiteListStr", "=", "appWhiteListProp", ".", "get", "(", ")", ";", "String", "[", "]", "whitelistEntries", "=", "appWhiteListStr", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "return", "new", "HashSet", "<", "String", ">", "(", "Arrays", ".", "asList", "(", "whitelistEntries", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionRegistryFetchInterval", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRemoteRegionFetchThreadPoolSize", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getRemoteRegionTrustStore", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getRemoteRegionTrustStorePassword", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "disableTransparentFallbackToOtherRegion", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldBatchReplication", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldLogIdentityHeaders", "(", ")", "{", "return", "configInstance", ".", "getBooleanProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getJsonCodecName", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getXmlCodecName", "(", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isRateLimiterEnabled", "(", ")", "{", "return", "rateLimiterEnabled", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isRateLimiterThrottleStandardClients", "(", ")", "{", "return", "rateLimiterThrottleStandardClients", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "<", "String", ">", "getRateLimiterPrivilegedClients", "(", ")", "{", "return", "rateLimiterPrivilegedClients", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRateLimiterBurstSize", "(", ")", "{", "return", "rateLimiterBurstSize", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRateLimiterRegistryFetchAverageRate", "(", ")", "{", "return", "rateLimiterRegistryFetchAverageRate", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRateLimiterFullFetchAverageRate", "(", ")", "{", "return", "rateLimiterFullFetchAverageRate", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getListAutoScalingGroupsRoleName", "(", ")", "{", "return", "listAutoScalingGroupsRoleName", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getExperimental", "(", "String", "name", ")", "{", "return", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT:.>", "\"", "+", "name", ",", "null", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRoute53BindRebindRetries", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:3>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getRoute53BindingRetryIntervalMs", "(", ")", "{", "return", "configInstance", ".", "getIntProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "(", "<NUM_LIT:5>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getRoute53DomainTTL", "(", ")", "{", "return", "configInstance", ".", "getLongProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "AwsBindingStrategy", "getBindingStrategy", "(", ")", "{", "return", "AwsBindingStrategy", ".", "valueOf", "(", "configInstance", ".", "getStringProperty", "(", "namespace", "+", "\"", "<STR_LIT>", "\"", ",", "AwsBindingStrategy", ".", "EIP", ".", "name", "(", ")", ")", ".", "get", "(", ")", ".", "toUpperCase", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getStatus", "(", "InstanceInfo", "info", ")", "{", "Version", "version", "=", "CurrentRequestVersion", ".", "get", "(", ")", ";", "if", "(", "version", "=", "=", "null", "|", "|", "version", "=", "=", "Version", ".", "V1", ")", "{", "InstanceStatus", "status", "=", "info", ".", "getStatus", "(", ")", ";", "switch", "(", "status", ")", "{", "case", "DOWN", ":", "case", "STARTING", ":", "case", "UP", ":", "break", ";", "default", ":", "status", "=", "InstanceStatus", ".", "DOWN", ";", "break", ";", "}", "return", "status", ".", "name", "(", ")", ";", "}", "else", "{", "return", "super", ".", "getStatus", "(", "info", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", "FilterConfig", "filterConfig", ")", "throws", "ServletException", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterChain", "chain", ")", "throws", "IOException", ",", "ServletException", "{", "HttpServletRequest", "httpRequest", "=", "(", "HttpServletRequest", ")", "request", ";", "if", "(", "\"", "<STR_LIT:GET>", "\"", ".", "equals", "(", "httpRequest", ".", "getMethod", "(", ")", ")", ")", "{", "String", "acceptEncoding", "=", "httpRequest", ".", "getHeader", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ")", ";", "if", "(", "acceptEncoding", "=", "=", "null", ")", "{", "chain", ".", "doFilter", "(", "addGzipAcceptEncoding", "(", "httpRequest", ")", ",", "response", ")", ";", "return", ";", "}", "if", "(", "!", "acceptEncoding", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "(", "(", "HttpServletResponse", ")", "response", ")", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_NOT_ACCEPTABLE", ")", ";", "return", ";", "}", "}", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "destroy", "(", ")", "{", "}", "</s>"]
["<s>", "private", "static", "HttpServletRequest", "addGzipAcceptEncoding", "(", "HttpServletRequest", "request", ")", "{", "return", "new", "HttpServletRequestWrapper", "(", "request", ")", "{", "@", "Override", "public", "Enumeration", "<", "String", ">", "getHeaders", "(", "String", "name", ")", "{", "if", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "EnumWrapper", "<", "String", ">", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "new", "EnumWrapper", "<", "String", ">", "(", "super", ".", "getHeaders", "(", "name", ")", ",", "HttpHeaders", ".", "ACCEPT_ENCODING", ")", ";", "}", "@", "Override", "public", "Enumeration", "<", "String", ">", "getHeaderNames", "(", ")", "{", "return", "new", "EnumWrapper", "<", "String", ">", "(", "super", ".", "getHeaderNames", "(", ")", ",", "HttpHeaders", ".", "ACCEPT_ENCODING", ")", ";", "}", "@", "Override", "public", "String", "getHeader", "(", "String", "name", ")", "{", "if", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ".", "equals", "(", "name", ")", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "return", "super", ".", "getHeader", "(", "name", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Enumeration", "<", "String", ">", "getHeaders", "(", "String", "name", ")", "{", "if", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ".", "equals", "(", "name", ")", ")", "{", "return", "new", "EnumWrapper", "<", "String", ">", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "new", "EnumWrapper", "<", "String", ">", "(", "super", ".", "getHeaders", "(", "name", ")", ",", "HttpHeaders", ".", "ACCEPT_ENCODING", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Enumeration", "<", "String", ">", "getHeaderNames", "(", ")", "{", "return", "new", "EnumWrapper", "<", "String", ">", "(", "super", ".", "getHeaderNames", "(", ")", ",", "HttpHeaders", ".", "ACCEPT_ENCODING", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getHeader", "(", "String", "name", ")", "{", "if", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ".", "equals", "(", "name", ")", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "return", "super", ".", "getHeader", "(", "name", ")", ";", "}", "</s>"]
["<s>", "private", "EnumWrapper", "(", "E", "extraElement", ")", "{", "this", "(", "null", ",", "extraElement", ")", ";", "}", "</s>"]
["<s>", "private", "EnumWrapper", "(", "Enumeration", "<", "E", ">", "delegate", ",", "E", "extraElement", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "this", ".", "extraElementRef", "=", "new", "AtomicReference", "<", ">", "(", "extraElement", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasMoreElements", "(", ")", "{", "return", "extraElementRef", ".", "get", "(", ")", "!", "=", "null", "|", "|", "delegate", "!", "=", "null", "&", "&", "delegate", ".", "hasMoreElements", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "E", "nextElement", "(", ")", "{", "E", "extra", "=", "extraElementRef", ".", "getAndSet", "(", "null", ")", ";", "if", "(", "extra", "!", "=", "null", ")", "{", "return", "extra", ";", "}", "if", "(", "delegate", "=", "=", "null", ")", "{", "throw", "new", "NoSuchElementException", "(", ")", ";", "}", "return", "delegate", ".", "nextElement", "(", ")", ";", "}", "</s>"]
["<s>", "private", "EurekaServerContextHolder", "(", "EurekaServerContext", "serverContext", ")", "{", "this", ".", "serverContext", "=", "serverContext", ";", "}", "</s>"]
["<s>", "public", "EurekaServerContext", "getServerContext", "(", ")", "{", "return", "this", ".", "serverContext", ";", "}", "</s>"]
["<s>", "public", "static", "synchronized", "void", "initialize", "(", "EurekaServerContext", "serverContext", ")", "{", "holder", "=", "new", "EurekaServerContextHolder", "(", "serverContext", ")", ";", "}", "</s>"]
["<s>", "public", "static", "EurekaServerContextHolder", "getInstance", "(", ")", "{", "return", "holder", ";", "}", "</s>"]
["<s>", "public", "void", "destroy", "(", ")", "{", "}", "</s>"]
["<s>", "public", "void", "doFilter", "(", "ServletRequest", "request", ",", "ServletResponse", "response", ",", "FilterChain", "chain", ")", "throws", "IOException", ",", "ServletException", "{", "InstanceInfo", "myInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "InstanceStatus", "status", "=", "myInfo", ".", "getStatus", "(", ")", ";", "if", "(", "status", "!", "=", "InstanceStatus", ".", "UP", "&", "&", "response", "instanceof", "HttpServletResponse", ")", "{", "HttpServletResponse", "httpRespone", "=", "(", "HttpServletResponse", ")", "response", ";", "httpRespone", ".", "sendError", "(", "SC_TEMPORARY_REDIRECT", ",", "\"", "<STR_LIT>", "\"", "+", "status", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "chain", ".", "doFilter", "(", "request", ",", "response", ")", ";", "}", "</s>"]
["<s>", "public", "void", "init", "(", "FilterConfig", "arg0", ")", "throws", "ServletException", "{", "}", "</s>"]
["<s>", "public", "EurekaServerIdentity", "(", "String", "id", ")", "{", "this", ".", "id", "=", "id", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "DEFAULT_SERVER_NAME", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getVersion", "(", ")", "{", "return", "serverVersion", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "static", "Version", "toEnum", "(", "String", "v", ")", "{", "for", "(", "Version", "version", ":", "Version", ".", "values", "(", ")", ")", "{", "if", "(", "version", ".", "name", "(", ")", ".", "equalsIgnoreCase", "(", "v", ")", ")", "{", "return", "version", ";", "}", "}", "return", "V2", ";", "}", "</s>"]
["<s>", "protected", "InstanceReplicationTask", "(", "String", "peerNodeName", ",", "Action", "action", ",", "String", "appName", ",", "String", "id", ")", "{", "super", "(", "peerNodeName", ",", "action", ")", ";", "this", ".", "appName", "=", "appName", ";", "this", ".", "id", "=", "id", ";", "this", ".", "instanceInfo", "=", "null", ";", "this", ".", "overriddenStatus", "=", "null", ";", "this", ".", "replicateInstanceInfo", "=", "false", ";", "}", "</s>"]
["<s>", "protected", "InstanceReplicationTask", "(", "String", "peerNodeName", ",", "Action", "action", ",", "InstanceInfo", "instanceInfo", ",", "InstanceStatus", "overriddenStatus", ",", "boolean", "replicateInstanceInfo", ")", "{", "super", "(", "peerNodeName", ",", "action", ")", ";", "this", ".", "appName", "=", "instanceInfo", ".", "getAppName", "(", ")", ";", "this", ".", "id", "=", "instanceInfo", ".", "getId", "(", ")", ";", "this", ".", "instanceInfo", "=", "instanceInfo", ";", "this", ".", "overriddenStatus", "=", "overriddenStatus", ";", "this", ".", "replicateInstanceInfo", "=", "replicateInstanceInfo", ";", "}", "</s>"]
["<s>", "public", "String", "getTaskName", "(", ")", "{", "return", "appName", "+", "<CHAR_LIT:/>", "+", "id", "+", "<CHAR_LIT::>", "+", "action", "+", "<CHAR_LIT>", "+", "peerNodeName", ";", "}", "</s>"]
["<s>", "public", "String", "getAppName", "(", ")", "{", "return", "appName", ";", "}", "</s>"]
["<s>", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getInstanceInfo", "(", ")", "{", "return", "instanceInfo", ";", "}", "</s>"]
["<s>", "public", "InstanceStatus", "getOverriddenStatus", "(", ")", "{", "return", "overriddenStatus", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldReplicateInstanceInfo", "(", ")", "{", "return", "replicateInstanceInfo", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "PeerEurekaNodes", "(", "PeerAwareInstanceRegistry", "registry", ",", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "ServerCodecs", "serverCodecs", ",", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "this", ".", "registry", "=", "registry", ";", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "clientConfig", "=", "clientConfig", ";", "this", ".", "serverCodecs", "=", "serverCodecs", ";", "this", ".", "applicationInfoManager", "=", "applicationInfoManager", ";", "}", "</s>"]
["<s>", "public", "List", "<", "PeerEurekaNode", ">", "getPeerNodesView", "(", ")", "{", "return", "Collections", ".", "unmodifiableList", "(", "peerEurekaNodes", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "PeerEurekaNode", ">", "getPeerEurekaNodes", "(", ")", "{", "return", "peerEurekaNodes", ";", "}", "</s>"]
["<s>", "public", "void", "start", "(", ")", "{", "taskExecutor", "=", "Executors", ".", "newSingleThreadScheduledExecutor", "(", "new", "ThreadFactory", "(", ")", "{", "@", "Override", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "Thread", "thread", "=", "new", "Thread", "(", "r", ",", "\"", "<STR_LIT>", "\"", ")", ";", "thread", ".", "setDaemon", "(", "true", ")", ";", "return", "thread", ";", "}", "}", ")", ";", "try", "{", "updatePeerEurekaNodes", "(", "resolvePeerUrls", "(", ")", ")", ";", "Runnable", "peersUpdateTask", "=", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "updatePeerEurekaNodes", "(", "resolvePeerUrls", "(", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ";", "taskExecutor", ".", "scheduleWithFixedDelay", "(", "peersUpdateTask", ",", "serverConfig", ".", "getPeerEurekaNodesUpdateIntervalMs", "(", ")", ",", "serverConfig", ".", "getPeerEurekaNodesUpdateIntervalMs", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "e", ")", ";", "}", "for", "(", "PeerEurekaNode", "node", ":", "peerEurekaNodes", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "node", ".", "getServiceUrl", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "Thread", "thread", "=", "new", "Thread", "(", "r", ",", "\"", "<STR_LIT>", "\"", ")", ";", "thread", ".", "setDaemon", "(", "true", ")", ";", "return", "thread", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "updatePeerEurekaNodes", "(", "resolvePeerUrls", "(", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "shutdown", "(", ")", "{", "taskExecutor", ".", "shutdown", "(", ")", ";", "List", "<", "PeerEurekaNode", ">", "toRemove", "=", "this", ".", "peerEurekaNodes", ";", "this", ".", "peerEurekaNodes", "=", "Collections", ".", "emptyList", "(", ")", ";", "this", ".", "peerEurekaNodeUrls", "=", "Collections", ".", "emptySet", "(", ")", ";", "for", "(", "PeerEurekaNode", "node", ":", "toRemove", ")", "{", "node", ".", "shutDown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "List", "<", "String", ">", "resolvePeerUrls", "(", ")", "{", "InstanceInfo", "myInfo", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ";", "String", "zone", "=", "InstanceInfo", ".", "getZone", "(", "clientConfig", ".", "getAvailabilityZones", "(", "clientConfig", ".", "getRegion", "(", ")", ")", ",", "myInfo", ")", ";", "List", "<", "String", ">", "replicaUrls", "=", "EndpointUtils", ".", "getDiscoveryServiceUrls", "(", "clientConfig", ",", "zone", ",", "new", "EndpointUtils", ".", "InstanceInfoBasedUrlRandomizer", "(", "myInfo", ")", ")", ";", "int", "idx", "=", "0", ";", "while", "(", "idx", "<", "replicaUrls", ".", "size", "(", ")", ")", "{", "if", "(", "isThisMe", "(", "replicaUrls", ".", "get", "(", "idx", ")", ")", ")", "{", "replicaUrls", ".", "remove", "(", "idx", ")", ";", "}", "else", "{", "idx", "+", "+", ";", "}", "}", "return", "replicaUrls", ";", "}", "</s>"]
["<s>", "protected", "void", "updatePeerEurekaNodes", "(", "List", "<", "String", ">", "newPeerUrls", ")", "{", "if", "(", "newPeerUrls", ".", "isEmpty", "(", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "Set", "<", "String", ">", "toShutdown", "=", "new", "HashSet", "<", ">", "(", "peerEurekaNodeUrls", ")", ";", "toShutdown", ".", "removeAll", "(", "newPeerUrls", ")", ";", "Set", "<", "String", ">", "toAdd", "=", "new", "HashSet", "<", ">", "(", "newPeerUrls", ")", ";", "toAdd", ".", "removeAll", "(", "peerEurekaNodeUrls", ")", ";", "if", "(", "toShutdown", ".", "isEmpty", "(", ")", "&", "&", "toAdd", ".", "isEmpty", "(", ")", ")", "{", "return", ";", "}", "List", "<", "PeerEurekaNode", ">", "newNodeList", "=", "new", "ArrayList", "<", ">", "(", "peerEurekaNodes", ")", ";", "if", "(", "!", "toShutdown", ".", "isEmpty", "(", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "toShutdown", ")", ";", "int", "i", "=", "0", ";", "while", "(", "i", "<", "newNodeList", ".", "size", "(", ")", ")", "{", "PeerEurekaNode", "eurekaNode", "=", "newNodeList", ".", "get", "(", "i", ")", ";", "if", "(", "toShutdown", ".", "contains", "(", "eurekaNode", ".", "getServiceUrl", "(", ")", ")", ")", "{", "newNodeList", ".", "remove", "(", "i", ")", ";", "eurekaNode", ".", "shutDown", "(", ")", ";", "}", "else", "{", "i", "+", "+", ";", "}", "}", "}", "if", "(", "!", "toAdd", ".", "isEmpty", "(", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "toAdd", ")", ";", "for", "(", "String", "peerUrl", ":", "toAdd", ")", "{", "newNodeList", ".", "add", "(", "createPeerEurekaNode", "(", "peerUrl", ")", ")", ";", "}", "}", "this", ".", "peerEurekaNodes", "=", "newNodeList", ";", "this", ".", "peerEurekaNodeUrls", "=", "new", "HashSet", "<", ">", "(", "newPeerUrls", ")", ";", "}", "</s>"]
["<s>", "protected", "PeerEurekaNode", "createPeerEurekaNode", "(", "String", "peerEurekaNodeUrl", ")", "{", "HttpReplicationClient", "replicationClient", "=", "new", "JerseyReplicationClient", "(", "serverConfig", ",", "serverCodecs", ",", "peerEurekaNodeUrl", ")", ";", "String", "targetHost", "=", "hostFromUrl", "(", "peerEurekaNodeUrl", ")", ";", "if", "(", "targetHost", "=", "=", "null", ")", "{", "targetHost", "=", "\"", "<STR_LIT>", "\"", ";", "}", "return", "new", "PeerEurekaNode", "(", "registry", ",", "targetHost", ",", "peerEurekaNodeUrl", ",", "replicationClient", ",", "serverConfig", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "isThisMe", "(", "String", "url", ")", "{", "InstanceInfo", "myInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "String", "hostName", "=", "hostFromUrl", "(", "url", ")", ";", "return", "hostName", "!", "=", "null", "&", "&", "hostName", ".", "equals", "(", "myInfo", ".", "getHostName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "hostFromUrl", "(", "String", "url", ")", "{", "URI", "uri", ";", "try", "{", "uri", "=", "new", "URI", "(", "url", ")", ";", "}", "catch", "(", "URISyntaxException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "url", ",", "e", ")", ";", "return", "null", ";", "}", "return", "uri", ".", "getHost", "(", ")", ";", "}", "</s>"]
["<s>", "HttpResponse", "<", "Void", ">", "statusUpdate", "(", "String", "asgName", ",", "ASGStatus", "newStatus", ")", ";", "</s>"]
["<s>", "HttpResponse", "<", "ReplicationListResponse", ">", "submitBatchUpdates", "(", "ReplicationList", "replicationList", ")", ";", "</s>"]
["<s>", "public", "DynamicGZIPContentEncodingFilter", "(", "EurekaServerConfig", "config", ")", "{", "this", ".", "config", "=", "config", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ClientResponse", "handle", "(", "ClientRequest", "request", ")", "throws", "ClientHandlerException", "{", "if", "(", "!", "request", ".", "getHeaders", "(", ")", ".", "containsKey", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ")", ")", "{", "request", ".", "getHeaders", "(", ")", ".", "add", "(", "HttpHeaders", ".", "ACCEPT_ENCODING", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "request", ".", "getEntity", "(", ")", "!", "=", "null", ")", "{", "Object", "o", "=", "request", ".", "getHeaders", "(", ")", ".", "getFirst", "(", "HttpHeaders", ".", "CONTENT_ENCODING", ")", ";", "if", "(", "o", "!", "=", "null", "&", "&", "o", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "request", ".", "setAdapter", "(", "new", "Adapter", "(", "request", ".", "getAdapter", "(", ")", ")", ")", ";", "}", "else", "if", "(", "isCompressionEnabled", "(", ")", ")", "{", "request", ".", "getHeaders", "(", ")", ".", "add", "(", "HttpHeaders", ".", "CONTENT_ENCODING", ",", "\"", "<STR_LIT>", "\"", ")", ";", "request", ".", "setAdapter", "(", "new", "Adapter", "(", "request", ".", "getAdapter", "(", ")", ")", ")", ";", "}", "}", "ClientResponse", "response", "=", "getNext", "(", ")", ".", "handle", "(", "request", ")", ";", "if", "(", "response", ".", "hasEntity", "(", ")", "&", "&", "response", ".", "getHeaders", "(", ")", ".", "containsKey", "(", "HttpHeaders", ".", "CONTENT_ENCODING", ")", ")", "{", "String", "encodings", "=", "response", ".", "getHeaders", "(", ")", ".", "getFirst", "(", "HttpHeaders", ".", "CONTENT_ENCODING", ")", ";", "if", "(", "encodings", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "response", ".", "getHeaders", "(", ")", ".", "remove", "(", "HttpHeaders", ".", "CONTENT_ENCODING", ")", ";", "try", "{", "response", ".", "setEntityInputStream", "(", "new", "GZIPInputStream", "(", "response", ".", "getEntityInputStream", "(", ")", ")", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "ClientHandlerException", "(", "ex", ")", ";", "}", "}", "}", "return", "response", ";", "}", "</s>"]
["<s>", "private", "boolean", "isCompressionEnabled", "(", ")", "{", "return", "config", ".", "shouldEnableReplicatedRequestCompression", "(", ")", ";", "}", "</s>"]
["<s>", "Adapter", "(", "ClientRequestAdapter", "cra", ")", "{", "super", "(", "cra", ")", ";", "}", "</s>"]
["<s>", "public", "OutputStream", "adapt", "(", "ClientRequest", "request", ",", "OutputStream", "out", ")", "throws", "IOException", "{", "return", "new", "GZIPOutputStream", "(", "getAdapter", "(", ")", ".", "adapt", "(", "request", ",", "out", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "AsgReplicationTask", "(", "String", "peerNodeName", ",", "Action", "action", ",", "String", "asgName", ",", "ASGStatus", "newStatus", ")", "{", "super", "(", "peerNodeName", ",", "action", ")", ";", "this", ".", "asgName", "=", "asgName", ";", "this", ".", "newStatus", "=", "newStatus", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getTaskName", "(", ")", "{", "return", "asgName", "+", "<CHAR_LIT::>", "+", "action", "+", "<CHAR_LIT>", "+", "peerNodeName", ";", "}", "</s>"]
["<s>", "public", "String", "getAsgName", "(", ")", "{", "return", "asgName", ";", "}", "</s>"]
["<s>", "public", "ASGStatus", "getNewStatus", "(", ")", "{", "return", "newStatus", ";", "}", "</s>"]
["<s>", "ReplicationTaskProcessor", "(", "String", "peerId", ",", "HttpReplicationClient", "replicationClient", ")", "{", "this", ".", "replicationClient", "=", "replicationClient", ";", "this", ".", "peerId", "=", "peerId", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ProcessingResult", "process", "(", "ReplicationTask", "task", ")", "{", "try", "{", "HttpResponse", "<", "?", ">", "httpResponse", "=", "task", ".", "execute", "(", ")", ";", "int", "statusCode", "=", "httpResponse", ".", "getStatusCode", "(", ")", ";", "Object", "entity", "=", "httpResponse", ".", "getEntity", "(", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "task", ".", "getTaskName", "(", ")", ",", "statusCode", ",", "entity", "!", "=", "null", ")", ";", "}", "if", "(", "isSuccess", "(", "statusCode", ")", ")", "{", "task", ".", "handleSuccess", "(", ")", ";", "}", "else", "if", "(", "statusCode", "=", "=", "<NUM_LIT>", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "task", ".", "getTaskName", "(", ")", ")", ";", "return", "ProcessingResult", ".", "Congestion", ";", "}", "else", "{", "task", ".", "handleFailure", "(", "statusCode", ",", "entity", ")", ";", "return", "ProcessingResult", ".", "PermanentError", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "if", "(", "isNetworkConnectException", "(", "e", ")", ")", "{", "logNetworkErrorSample", "(", "task", ",", "e", ")", ";", "return", "ProcessingResult", ".", "TransientError", ";", "}", "else", "{", "logger", ".", "error", "(", "peerId", "+", "\"", "<STR_LIT>", "\"", "+", "task", ".", "getTaskName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "return", "ProcessingResult", ".", "PermanentError", ";", "}", "}", "return", "ProcessingResult", ".", "Success", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ProcessingResult", "process", "(", "List", "<", "ReplicationTask", ">", "tasks", ")", "{", "ReplicationList", "list", "=", "createReplicationListOf", "(", "tasks", ")", ";", "try", "{", "HttpResponse", "<", "ReplicationListResponse", ">", "response", "=", "replicationClient", ".", "submitBatchUpdates", "(", "list", ")", ";", "int", "statusCode", "=", "response", ".", "getStatusCode", "(", ")", ";", "if", "(", "!", "isSuccess", "(", "statusCode", ")", ")", "{", "if", "(", "statusCode", "=", "=", "<NUM_LIT>", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "peerId", ")", ";", "return", "ProcessingResult", ".", "Congestion", ";", "}", "else", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "statusCode", ",", "tasks", ".", "size", "(", ")", ")", ";", "return", "ProcessingResult", ".", "PermanentError", ";", "}", "}", "else", "{", "handleBatchResponse", "(", "tasks", ",", "response", ".", "getEntity", "(", ")", ".", "getResponseList", "(", ")", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "if", "(", "isNetworkConnectException", "(", "e", ")", ")", "{", "logNetworkErrorSample", "(", "null", ",", "e", ")", ";", "return", "ProcessingResult", ".", "TransientError", ";", "}", "else", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "return", "ProcessingResult", ".", "PermanentError", ";", "}", "}", "return", "ProcessingResult", ".", "Success", ";", "}", "</s>"]
["<s>", "private", "void", "logNetworkErrorSample", "(", "ReplicationTask", "task", ",", "Throwable", "e", ")", "{", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "if", "(", "now", "-", "lastNetworkErrorTime", ">", "<NUM_LIT>", ")", "{", "lastNetworkErrorTime", "=", "now", ";", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "peerId", ")", ";", "if", "(", "task", "!", "=", "null", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "task", ".", "getTaskName", "(", ")", ")", ";", "}", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "logger", ".", "error", "(", "sb", ".", "toString", "(", ")", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleBatchResponse", "(", "List", "<", "ReplicationTask", ">", "tasks", ",", "List", "<", "ReplicationInstanceResponse", ">", "responseList", ")", "{", "if", "(", "tasks", ".", "size", "(", ")", "!", "=", "responseList", ".", "size", "(", ")", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "responseList", ".", "size", "(", ")", ",", "tasks", ".", "size", "(", ")", ")", ";", "return", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "tasks", ".", "size", "(", ")", ";", "i", "+", "+", ")", "{", "handleBatchResponse", "(", "tasks", ".", "get", "(", "i", ")", ",", "responseList", ".", "get", "(", "i", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleBatchResponse", "(", "ReplicationTask", "task", ",", "ReplicationInstanceResponse", "response", ")", "{", "int", "statusCode", "=", "response", ".", "getStatusCode", "(", ")", ";", "if", "(", "isSuccess", "(", "statusCode", ")", ")", "{", "task", ".", "handleSuccess", "(", ")", ";", "return", ";", "}", "try", "{", "task", ".", "handleFailure", "(", "response", ".", "getStatusCode", "(", ")", ",", "response", ".", "getResponseEntity", "(", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "task", ".", "getTaskName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ReplicationList", "createReplicationListOf", "(", "List", "<", "ReplicationTask", ">", "tasks", ")", "{", "ReplicationList", "list", "=", "new", "ReplicationList", "(", ")", ";", "for", "(", "ReplicationTask", "task", ":", "tasks", ")", "{", "list", ".", "addReplicationInstance", "(", "createReplicationInstanceOf", "(", "(", "InstanceReplicationTask", ")", "task", ")", ")", ";", "}", "return", "list", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isSuccess", "(", "int", "statusCode", ")", "{", "return", "statusCode", ">", "=", "<NUM_LIT>", "&", "&", "statusCode", "<", "<NUM_LIT>", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isNetworkConnectException", "(", "Throwable", "e", ")", "{", "do", "{", "if", "(", "IOException", ".", "class", ".", "isInstance", "(", "e", ")", ")", "{", "return", "true", ";", "}", "e", "=", "e", ".", "getCause", "(", ")", ";", "}", "while", "(", "e", "!", "=", "null", ")", ";", "return", "false", ";", "}", "</s>"]
["<s>", "private", "static", "ReplicationInstance", "createReplicationInstanceOf", "(", "InstanceReplicationTask", "task", ")", "{", "ReplicationInstanceBuilder", "instanceBuilder", "=", "aReplicationInstance", "(", ")", ";", "instanceBuilder", ".", "withAppName", "(", "task", ".", "getAppName", "(", ")", ")", ";", "instanceBuilder", ".", "withId", "(", "task", ".", "getId", "(", ")", ")", ";", "InstanceInfo", "instanceInfo", "=", "task", ".", "getInstanceInfo", "(", ")", ";", "if", "(", "instanceInfo", "!", "=", "null", ")", "{", "String", "overriddenStatus", "=", "task", ".", "getOverriddenStatus", "(", ")", "=", "=", "null", "?", "null", ":", "task", ".", "getOverriddenStatus", "(", ")", ".", "name", "(", ")", ";", "instanceBuilder", ".", "withOverriddenStatus", "(", "overriddenStatus", ")", ";", "instanceBuilder", ".", "withLastDirtyTimestamp", "(", "instanceInfo", ".", "getLastDirtyTimestamp", "(", ")", ")", ";", "if", "(", "task", ".", "shouldReplicateInstanceInfo", "(", ")", ")", "{", "instanceBuilder", ".", "withInstanceInfo", "(", "instanceInfo", ")", ";", "}", "String", "instanceStatus", "=", "instanceInfo", ".", "getStatus", "(", ")", "=", "=", "null", "?", "null", ":", "instanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ";", "instanceBuilder", ".", "withStatus", "(", "instanceStatus", ")", ";", "}", "instanceBuilder", ".", "withAction", "(", "task", ".", "getAction", "(", ")", ")", ";", "return", "instanceBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "ReplicationTask", "(", "String", "peerNodeName", ",", "Action", "action", ")", "{", "this", ".", "peerNodeName", "=", "peerNodeName", ";", "this", ".", "action", "=", "action", ";", "}", "</s>"]
["<s>", "public", "abstract", "String", "getTaskName", "(", ")", ";", "</s>"]
["<s>", "public", "Action", "getAction", "(", ")", "{", "return", "action", ";", "}", "</s>"]
["<s>", "public", "abstract", "HttpResponse", "<", "?", ">", "execute", "(", ")", "throws", "Throwable", ";", "</s>"]
["<s>", "public", "void", "handleSuccess", "(", ")", "{", "}", "</s>"]
["<s>", "public", "void", "handleFailure", "(", "int", "statusCode", ",", "Object", "responseEntity", ")", "throws", "Throwable", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ",", "statusCode", ")", ";", "}", "</s>"]
["<s>", "public", "JerseyReplicationClient", "(", "EurekaServerConfig", "config", ",", "ServerCodecs", "serverCodecs", ",", "String", "serviceUrl", ")", "{", "super", "(", "serviceUrl", ")", ";", "String", "name", "=", "getClass", "(", ")", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "serviceUrl", "+", "\"", "<STR_LIT>", "\"", ";", "try", "{", "String", "hostname", ";", "try", "{", "hostname", "=", "new", "URL", "(", "serviceUrl", ")", ".", "getHost", "(", ")", ";", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "hostname", "=", "serviceUrl", ";", "}", "String", "jerseyClientName", "=", "\"", "<STR_LIT>", "\"", "+", "hostname", ";", "EurekaJerseyClientBuilder", "clientBuilder", "=", "new", "EurekaJerseyClientBuilder", "(", ")", ".", "withClientName", "(", "jerseyClientName", ")", ".", "withUserAgent", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withEncoderWrapper", "(", "serverCodecs", ".", "getFullJsonCodec", "(", ")", ")", ".", "withDecoderWrapper", "(", "serverCodecs", ".", "getFullJsonCodec", "(", ")", ")", ".", "withConnectionTimeout", "(", "config", ".", "getPeerNodeConnectTimeoutMs", "(", ")", ")", ".", "withReadTimeout", "(", "config", ".", "getPeerNodeReadTimeoutMs", "(", ")", ")", ".", "withMaxConnectionsPerHost", "(", "config", ".", "getPeerNodeTotalConnectionsPerHost", "(", ")", ")", ".", "withMaxTotalConnections", "(", "config", ".", "getPeerNodeTotalConnections", "(", ")", ")", ".", "withConnectionIdleTimeout", "(", "config", ".", "getPeerNodeConnectionIdleTimeoutSeconds", "(", ")", ")", ";", "if", "(", "serviceUrl", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", "{", "clientBuilder", ".", "withSystemSSLConfiguration", "(", ")", ";", "}", "jerseyClient", "=", "clientBuilder", ".", "build", "(", ")", ";", "jerseyApacheClient", "=", "jerseyClient", ".", "getClient", "(", ")", ";", "jerseyApacheClient", ".", "addFilter", "(", "new", "DynamicGZIPContentEncodingFilter", "(", "config", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "name", ",", "e", ")", ";", "}", "String", "ip", "=", "null", ";", "try", "{", "ip", "=", "InetAddress", ".", "getLocalHost", "(", ")", ".", "getHostAddress", "(", ")", ";", "}", "catch", "(", "UnknownHostException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "EurekaServerIdentity", "identity", "=", "new", "EurekaServerIdentity", "(", "ip", ")", ";", "jerseyApacheClient", ".", "addFilter", "(", "new", "EurekaIdentityHeaderFilter", "(", "identity", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Client", "getJerseyClient", "(", ")", "{", "return", "jerseyApacheClient", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "addExtraHeaders", "(", "Builder", "webResource", ")", "{", "webResource", ".", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "sendHeartBeat", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceStatus", "overriddenStatus", ")", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "appName", "+", "<CHAR_LIT:/>", "+", "id", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "WebResource", "webResource", "=", "getJerseyClient", "(", ")", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getStatus", "(", ")", ".", "toString", "(", ")", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getLastDirtyTimestamp", "(", ")", ".", "toString", "(", ")", ")", ";", "if", "(", "overriddenStatus", "!", "=", "null", ")", "{", "webResource", "=", "webResource", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "overriddenStatus", ".", "name", "(", ")", ")", ";", "}", "Builder", "requestBuilder", "=", "webResource", ".", "getRequestBuilder", "(", ")", ";", "addExtraHeaders", "(", "requestBuilder", ")", ";", "response", "=", "requestBuilder", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "put", "(", "ClientResponse", ".", "class", ")", ";", "InstanceInfo", "infoFromPeer", "=", "null", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "CONFLICT", ".", "getStatusCode", "(", ")", "&", "&", "response", ".", "hasEntity", "(", ")", ")", "{", "infoFromPeer", "=", "response", ".", "getEntity", "(", "InstanceInfo", ".", "class", ")", ";", "}", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ",", "infoFromPeer", ")", ";", "}", "finally", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "urlPath", ",", "response", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "statusUpdate", "(", "String", "asgName", ",", "ASGStatus", "newStatus", ")", "{", "ClientResponse", "response", "=", "null", ";", "try", "{", "String", "urlPath", "=", "\"", "<STR_LIT:/>", "\"", "+", "asgName", "+", "\"", "<STR_LIT>", "\"", ";", "response", "=", "jerseyApacheClient", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "urlPath", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "newStatus", ".", "name", "(", ")", ")", ".", "header", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ",", "\"", "<STR_LIT>", "\"", ")", ".", "put", "(", "ClientResponse", ".", "class", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "finally", "{", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "ReplicationListResponse", ">", "submitBatchUpdates", "(", "ReplicationList", "replicationList", ")", "{", "ClientResponse", "response", "=", "null", ";", "try", "{", "response", "=", "jerseyApacheClient", ".", "resource", "(", "serviceUrl", ")", ".", "path", "(", "PeerEurekaNode", ".", "BATCH_URL_PATH", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "type", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "ClientResponse", ".", "class", ",", "replicationList", ")", ";", "if", "(", "!", "isSuccess", "(", "response", ".", "getStatus", "(", ")", ")", ")", "{", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "ReplicationListResponse", "batchResponse", "=", "response", ".", "getEntity", "(", "ReplicationListResponse", ".", "class", ")", ";", "return", "HttpResponse", ".", "responseWith", "(", "response", ".", "getStatus", "(", ")", ",", "batchResponse", ")", ";", "}", "finally", "{", "if", "(", "response", "!", "=", "null", ")", "{", "response", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "super", ".", "shutdown", "(", ")", ";", "jerseyClient", ".", "destroyResources", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isSuccess", "(", "int", "statusCode", ")", "{", "return", "statusCode", ">", "=", "<NUM_LIT>", "&", "&", "statusCode", "<", "<NUM_LIT>", ";", "}", "</s>"]
["<s>", "public", "PeerEurekaNode", "(", "PeerAwareInstanceRegistry", "registry", ",", "String", "targetHost", ",", "String", "serviceUrl", ",", "HttpReplicationClient", "replicationClient", ",", "EurekaServerConfig", "config", ")", "{", "this", "(", "registry", ",", "targetHost", ",", "serviceUrl", ",", "replicationClient", ",", "config", ",", "BATCH_SIZE", ",", "MAX_BATCHING_DELAY_MS", ",", "RETRY_SLEEP_TIME_MS", ",", "SERVER_UNAVAILABLE_SLEEP_TIME_MS", ")", ";", "}", "</s>"]
["<s>", "PeerEurekaNode", "(", "PeerAwareInstanceRegistry", "registry", ",", "String", "targetHost", ",", "String", "serviceUrl", ",", "HttpReplicationClient", "replicationClient", ",", "EurekaServerConfig", "config", ",", "int", "batchSize", ",", "long", "maxBatchingDelayMs", ",", "long", "retrySleepTimeMs", ",", "long", "serverUnavailableSleepTimeMs", ")", "{", "this", ".", "registry", "=", "registry", ";", "this", ".", "targetHost", "=", "targetHost", ";", "this", ".", "replicationClient", "=", "replicationClient", ";", "this", ".", "serviceUrl", "=", "serviceUrl", ";", "this", ".", "config", "=", "config", ";", "this", ".", "maxProcessingDelayMs", "=", "config", ".", "getMaxTimeForReplication", "(", ")", ";", "String", "batcherName", "=", "getBatcherName", "(", ")", ";", "ReplicationTaskProcessor", "taskProcessor", "=", "new", "ReplicationTaskProcessor", "(", "targetHost", ",", "replicationClient", ")", ";", "this", ".", "batchingDispatcher", "=", "TaskDispatchers", ".", "createBatchingTaskDispatcher", "(", "batcherName", ",", "config", ".", "getMaxElementsInPeerReplicationPool", "(", ")", ",", "batchSize", ",", "config", ".", "getMaxThreadsForPeerReplication", "(", ")", ",", "maxBatchingDelayMs", ",", "serverUnavailableSleepTimeMs", ",", "retrySleepTimeMs", ",", "taskProcessor", ")", ";", "this", ".", "nonBatchingDispatcher", "=", "TaskDispatchers", ".", "createNonBatchingTaskDispatcher", "(", "targetHost", ",", "config", ".", "getMaxElementsInStatusReplicationPool", "(", ")", ",", "config", ".", "getMaxThreadsForStatusReplication", "(", ")", ",", "maxBatchingDelayMs", ",", "serverUnavailableSleepTimeMs", ",", "retrySleepTimeMs", ",", "taskProcessor", ")", ";", "}", "</s>"]
["<s>", "public", "void", "register", "(", "final", "InstanceInfo", "info", ")", "throws", "Exception", "{", "long", "expiryTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "getLeaseRenewalOf", "(", "info", ")", ";", "batchingDispatcher", ".", "process", "(", "taskId", "(", "\"", "<STR_LIT>", "\"", ",", "info", ")", ",", "new", "InstanceReplicationTask", "(", "targetHost", ",", "Action", ".", "Register", ",", "info", ",", "null", ",", "true", ")", "{", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "register", "(", "info", ")", ";", "}", "}", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "register", "(", "info", ")", ";", "}", "</s>"]
["<s>", "public", "void", "cancel", "(", "final", "String", "appName", ",", "final", "String", "id", ")", "throws", "Exception", "{", "long", "expiryTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "maxProcessingDelayMs", ";", "batchingDispatcher", ".", "process", "(", "taskId", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ")", ",", "new", "InstanceReplicationTask", "(", "targetHost", ",", "Action", ".", "Cancel", ",", "appName", ",", "id", ")", "{", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "cancel", "(", "appName", ",", "id", ")", ";", "}", "@", "Override", "public", "void", "handleFailure", "(", "int", "statusCode", ",", "Object", "responseEntity", ")", "throws", "Throwable", "{", "super", ".", "handleFailure", "(", "statusCode", ",", "responseEntity", ")", ";", "if", "(", "statusCode", "=", "=", "<NUM_LIT>", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ")", ";", "}", "}", "}", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "cancel", "(", "appName", ",", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleFailure", "(", "int", "statusCode", ",", "Object", "responseEntity", ")", "throws", "Throwable", "{", "super", ".", "handleFailure", "(", "statusCode", ",", "responseEntity", ")", ";", "if", "(", "statusCode", "=", "=", "<NUM_LIT>", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "heartbeat", "(", "final", "String", "appName", ",", "final", "String", "id", ",", "final", "InstanceInfo", "info", ",", "final", "InstanceStatus", "overriddenStatus", ",", "boolean", "primeConnection", ")", "throws", "Throwable", "{", "if", "(", "primeConnection", ")", "{", "replicationClient", ".", "sendHeartBeat", "(", "appName", ",", "id", ",", "info", ",", "overriddenStatus", ")", ";", "return", ";", "}", "ReplicationTask", "replicationTask", "=", "new", "InstanceReplicationTask", "(", "targetHost", ",", "Action", ".", "Heartbeat", ",", "info", ",", "overriddenStatus", ",", "false", ")", "{", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "execute", "(", ")", "throws", "Throwable", "{", "return", "replicationClient", ".", "sendHeartBeat", "(", "appName", ",", "id", ",", "info", ",", "overriddenStatus", ")", ";", "}", "@", "Override", "public", "void", "handleFailure", "(", "int", "statusCode", ",", "Object", "responseEntity", ")", "throws", "Throwable", "{", "super", ".", "handleFailure", "(", "statusCode", ",", "responseEntity", ")", ";", "if", "(", "statusCode", "=", "=", "<NUM_LIT>", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ")", ";", "if", "(", "info", "!", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ",", "info", ".", "getId", "(", ")", ",", "info", ".", "getStatus", "(", ")", ")", ";", "register", "(", "info", ")", ";", "}", "}", "else", "if", "(", "config", ".", "shouldSyncWhenTimestampDiffers", "(", ")", ")", "{", "InstanceInfo", "peerInstanceInfo", "=", "(", "InstanceInfo", ")", "responseEntity", ";", "if", "(", "peerInstanceInfo", "!", "=", "null", ")", "{", "syncInstancesIfTimestampDiffers", "(", "appName", ",", "id", ",", "info", ",", "peerInstanceInfo", ")", ";", "}", "}", "}", "}", ";", "long", "expiryTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "getLeaseRenewalOf", "(", "info", ")", ";", "batchingDispatcher", ".", "process", "(", "taskId", "(", "\"", "<STR_LIT>", "\"", ",", "info", ")", ",", "replicationTask", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "InstanceInfo", ">", "execute", "(", ")", "throws", "Throwable", "{", "return", "replicationClient", ".", "sendHeartBeat", "(", "appName", ",", "id", ",", "info", ",", "overriddenStatus", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleFailure", "(", "int", "statusCode", ",", "Object", "responseEntity", ")", "throws", "Throwable", "{", "super", ".", "handleFailure", "(", "statusCode", ",", "responseEntity", ")", ";", "if", "(", "statusCode", "=", "=", "<NUM_LIT>", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ")", ";", "if", "(", "info", "!", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getTaskName", "(", ")", ",", "info", ".", "getId", "(", ")", ",", "info", ".", "getStatus", "(", ")", ")", ";", "register", "(", "info", ")", ";", "}", "}", "else", "if", "(", "config", ".", "shouldSyncWhenTimestampDiffers", "(", ")", ")", "{", "InstanceInfo", "peerInstanceInfo", "=", "(", "InstanceInfo", ")", "responseEntity", ";", "if", "(", "peerInstanceInfo", "!", "=", "null", ")", "{", "syncInstancesIfTimestampDiffers", "(", "appName", ",", "id", ",", "info", ",", "peerInstanceInfo", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "statusUpdate", "(", "final", "String", "asgName", ",", "final", "ASGStatus", "newStatus", ")", "{", "long", "expiryTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "maxProcessingDelayMs", ";", "nonBatchingDispatcher", ".", "process", "(", "asgName", ",", "new", "AsgReplicationTask", "(", "targetHost", ",", "Action", ".", "StatusUpdate", ",", "asgName", ",", "newStatus", ")", "{", "public", "HttpResponse", "<", "?", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "statusUpdate", "(", "asgName", ",", "newStatus", ")", ";", "}", "}", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "public", "HttpResponse", "<", "?", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "statusUpdate", "(", "asgName", ",", "newStatus", ")", ";", "}", "</s>"]
["<s>", "public", "void", "statusUpdate", "(", "final", "String", "appName", ",", "final", "String", "id", ",", "final", "InstanceStatus", "newStatus", ",", "final", "InstanceInfo", "info", ")", "{", "long", "expiryTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "maxProcessingDelayMs", ";", "batchingDispatcher", ".", "process", "(", "taskId", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ")", ",", "new", "InstanceReplicationTask", "(", "targetHost", ",", "Action", ".", "StatusUpdate", ",", "info", ",", "null", ",", "false", ")", "{", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "statusUpdate", "(", "appName", ",", "id", ",", "newStatus", ",", "info", ")", ";", "}", "}", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "statusUpdate", "(", "appName", ",", "id", ",", "newStatus", ",", "info", ")", ";", "}", "</s>"]
["<s>", "public", "void", "deleteStatusOverride", "(", "final", "String", "appName", ",", "final", "String", "id", ",", "final", "InstanceInfo", "info", ")", "{", "long", "expiryTime", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "maxProcessingDelayMs", ";", "batchingDispatcher", ".", "process", "(", "taskId", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ")", ",", "new", "InstanceReplicationTask", "(", "targetHost", ",", "Action", ".", "DeleteStatusOverride", ",", "info", ",", "null", ",", "false", ")", "{", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "deleteStatusOverride", "(", "appName", ",", "id", ",", "info", ")", ";", "}", "}", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpResponse", "<", "Void", ">", "execute", "(", ")", "{", "return", "replicationClient", ".", "deleteStatusOverride", "(", "appName", ",", "id", ",", "info", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getServiceUrl", "(", ")", "{", "return", "serviceUrl", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "final", "int", "prime", "=", "<NUM_LIT:31>", ";", "int", "result", "=", "1", ";", "result", "=", "prime", "*", "result", "+", "(", "(", "serviceUrl", "=", "=", "null", ")", "?", "0", ":", "serviceUrl", ".", "hashCode", "(", ")", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "this", "=", "=", "obj", ")", "{", "return", "true", ";", "}", "if", "(", "obj", "=", "=", "null", ")", "{", "return", "false", ";", "}", "if", "(", "getClass", "(", ")", "!", "=", "obj", ".", "getClass", "(", ")", ")", "{", "return", "false", ";", "}", "PeerEurekaNode", "other", "=", "(", "PeerEurekaNode", ")", "obj", ";", "if", "(", "serviceUrl", "=", "=", "null", ")", "{", "if", "(", "other", ".", "serviceUrl", "!", "=", "null", ")", "{", "return", "false", ";", "}", "}", "else", "if", "(", "!", "serviceUrl", ".", "equals", "(", "other", ".", "serviceUrl", ")", ")", "{", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "void", "shutDown", "(", ")", "{", "batchingDispatcher", ".", "shutdown", "(", ")", ";", "nonBatchingDispatcher", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "syncInstancesIfTimestampDiffers", "(", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceInfo", "infoFromPeer", ")", "{", "try", "{", "if", "(", "infoFromPeer", "!", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "id", ",", "info", ".", "getLastDirtyTimestamp", "(", ")", ",", "infoFromPeer", ".", "getLastDirtyTimestamp", "(", ")", ")", ";", "if", "(", "infoFromPeer", ".", "getOverriddenStatus", "(", ")", "!", "=", "null", "&", "&", "!", "InstanceStatus", ".", "UNKNOWN", ".", "equals", "(", "infoFromPeer", ".", "getOverriddenStatus", "(", ")", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "info", ".", "getOverriddenStatus", "(", ")", ",", "infoFromPeer", ".", "getOverriddenStatus", "(", ")", ")", ";", "registry", ".", "storeOverriddenStatusIfRequired", "(", "appName", ",", "id", ",", "infoFromPeer", ".", "getOverriddenStatus", "(", ")", ")", ";", "}", "registry", ".", "register", "(", "infoFromPeer", ",", "true", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "String", "getBatcherName", "(", ")", "{", "String", "batcherName", ";", "try", "{", "batcherName", "=", "new", "URL", "(", "serviceUrl", ")", ".", "getHost", "(", ")", ";", "}", "catch", "(", "MalformedURLException", "e1", ")", "{", "batcherName", "=", "serviceUrl", ";", "}", "return", "\"", "<STR_LIT:_>", "\"", "+", "batcherName", ";", "}", "</s>"]
["<s>", "private", "static", "String", "taskId", "(", "String", "requestType", ",", "String", "appName", ",", "String", "id", ")", "{", "return", "requestType", "+", "<CHAR_LIT>", "+", "appName", "+", "<CHAR_LIT:/>", "+", "id", ";", "}", "</s>"]
["<s>", "private", "static", "String", "taskId", "(", "String", "requestType", ",", "InstanceInfo", "info", ")", "{", "return", "taskId", "(", "requestType", ",", "info", ".", "getAppName", "(", ")", ",", "info", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getLeaseRenewalOf", "(", "InstanceInfo", "info", ")", "{", "return", "(", "info", ".", "getLeaseInfo", "(", ")", "=", "=", "null", "?", "Lease", ".", "DEFAULT_DURATION_IN_SECS", ":", "info", ".", "getLeaseInfo", "(", ")", ".", "getRenewalIntervalInSecs", "(", ")", ")", "*", "<NUM_LIT:1000>", ";", "}", "</s>"]
["<s>", "public", "ReplicationList", "(", ")", "{", "this", ".", "replicationList", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "ReplicationList", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "List", "<", "ReplicationInstance", ">", "replicationList", ")", "{", "this", ".", "replicationList", "=", "replicationList", ";", "}", "</s>"]
["<s>", "public", "ReplicationList", "(", "ReplicationInstance", "replicationInstance", ")", "{", "this", "(", "Collections", ".", "singletonList", "(", "replicationInstance", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addReplicationInstance", "(", "ReplicationInstance", "instance", ")", "{", "replicationList", ".", "add", "(", "instance", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "ReplicationInstance", ">", "getReplicationList", "(", ")", "{", "return", "this", ".", "replicationList", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "ReplicationList", "that", "=", "(", "ReplicationList", ")", "o", ";", "return", "!", "(", "replicationList", "!", "=", "null", "?", "!", "replicationList", ".", "equals", "(", "that", ".", "replicationList", ")", ":", "that", ".", "replicationList", "!", "=", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "replicationList", "!", "=", "null", "?", "replicationList", ".", "hashCode", "(", ")", ":", "0", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "ReplicationInstanceResponse", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "int", "statusCode", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "InstanceInfo", "responseEntity", ")", "{", "this", ".", "statusCode", "=", "statusCode", ";", "this", ".", "responseEntity", "=", "responseEntity", ";", "}", "</s>"]
["<s>", "public", "int", "getStatusCode", "(", ")", "{", "return", "statusCode", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getResponseEntity", "(", ")", "{", "return", "responseEntity", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "ReplicationInstanceResponse", "that", "=", "(", "ReplicationInstanceResponse", ")", "o", ";", "if", "(", "statusCode", "!", "=", "that", ".", "statusCode", ")", "return", "false", ";", "if", "(", "responseEntity", "!", "=", "null", "?", "!", "responseEntity", ".", "equals", "(", "that", ".", "responseEntity", ")", ":", "that", ".", "responseEntity", "!", "=", "null", ")", "return", "false", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "int", "result", "=", "statusCode", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "responseEntity", "!", "=", "null", "?", "responseEntity", ".", "hashCode", "(", ")", ":", "0", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "public", "Builder", "setStatusCode", "(", "int", "statusCode", ")", "{", "this", ".", "statusCode", "=", "statusCode", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "setResponseEntity", "(", "InstanceInfo", "entity", ")", "{", "this", ".", "responseEntity", "=", "entity", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceResponse", "build", "(", ")", "{", "return", "new", "ReplicationInstanceResponse", "(", "statusCode", ",", "responseEntity", ")", ";", "}", "</s>"]
["<s>", "public", "ReplicationListResponse", "(", ")", "{", "this", ".", "responseList", "=", "new", "ArrayList", "<", "ReplicationInstanceResponse", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "ReplicationListResponse", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "List", "<", "ReplicationInstanceResponse", ">", "responseList", ")", "{", "this", ".", "responseList", "=", "responseList", ";", "}", "</s>"]
["<s>", "public", "List", "<", "ReplicationInstanceResponse", ">", "getResponseList", "(", ")", "{", "return", "responseList", ";", "}", "</s>"]
["<s>", "public", "void", "addResponse", "(", "ReplicationInstanceResponse", "singleResponse", ")", "{", "responseList", ".", "add", "(", "singleResponse", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "ReplicationListResponse", "that", "=", "(", "ReplicationListResponse", ")", "o", ";", "return", "!", "(", "responseList", "!", "=", "null", "?", "!", "responseList", ".", "equals", "(", "that", ".", "responseList", ")", ":", "that", ".", "responseList", "!", "=", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "responseList", "!", "=", "null", "?", "responseList", ".", "hashCode", "(", ")", ":", "0", ";", "}", "</s>"]
["<s>", "@", "JsonCreator", "public", "ReplicationInstance", "(", "@", "JsonProperty", "(", "\"", "<STR_LIT:Name>", "\"", ")", "String", "appName", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "id", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Long", "lastDirtyTimestamp", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "overriddenStatus", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "String", "status", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "InstanceInfo", "instanceInfo", ",", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "Action", "action", ")", "{", "this", ".", "appName", "=", "appName", ";", "this", ".", "id", "=", "id", ";", "this", ".", "lastDirtyTimestamp", "=", "lastDirtyTimestamp", ";", "this", ".", "overriddenStatus", "=", "overriddenStatus", ";", "this", ".", "status", "=", "status", ";", "this", ".", "instanceInfo", "=", "instanceInfo", ";", "this", ".", "action", "=", "action", ";", "}", "</s>"]
["<s>", "public", "String", "getAppName", "(", ")", "{", "return", "appName", ";", "}", "</s>"]
["<s>", "public", "String", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "Long", "getLastDirtyTimestamp", "(", ")", "{", "return", "lastDirtyTimestamp", ";", "}", "</s>"]
["<s>", "public", "String", "getOverriddenStatus", "(", ")", "{", "return", "overriddenStatus", ";", "}", "</s>"]
["<s>", "public", "String", "getStatus", "(", ")", "{", "return", "status", ";", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getInstanceInfo", "(", ")", "{", "return", "instanceInfo", ";", "}", "</s>"]
["<s>", "public", "Action", "getAction", "(", ")", "{", "return", "action", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "ReplicationInstance", "that", "=", "(", "ReplicationInstance", ")", "o", ";", "if", "(", "appName", "!", "=", "null", "?", "!", "appName", ".", "equals", "(", "that", ".", "appName", ")", ":", "that", ".", "appName", "!", "=", "null", ")", "return", "false", ";", "if", "(", "id", "!", "=", "null", "?", "!", "id", ".", "equals", "(", "that", ".", "id", ")", ":", "that", ".", "id", "!", "=", "null", ")", "return", "false", ";", "if", "(", "lastDirtyTimestamp", "!", "=", "null", "?", "!", "lastDirtyTimestamp", ".", "equals", "(", "that", ".", "lastDirtyTimestamp", ")", ":", "that", ".", "lastDirtyTimestamp", "!", "=", "null", ")", "return", "false", ";", "if", "(", "overriddenStatus", "!", "=", "null", "?", "!", "overriddenStatus", ".", "equals", "(", "that", ".", "overriddenStatus", ")", ":", "that", ".", "overriddenStatus", "!", "=", "null", ")", "return", "false", ";", "if", "(", "status", "!", "=", "null", "?", "!", "status", ".", "equals", "(", "that", ".", "status", ")", ":", "that", ".", "status", "!", "=", "null", ")", "return", "false", ";", "if", "(", "instanceInfo", "!", "=", "null", "?", "!", "instanceInfo", ".", "equals", "(", "that", ".", "instanceInfo", ")", ":", "that", ".", "instanceInfo", "!", "=", "null", ")", "return", "false", ";", "return", "action", "=", "=", "that", ".", "action", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "int", "result", "=", "appName", "!", "=", "null", "?", "appName", ".", "hashCode", "(", ")", ":", "0", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "id", "!", "=", "null", "?", "id", ".", "hashCode", "(", ")", ":", "0", ")", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "lastDirtyTimestamp", "!", "=", "null", "?", "lastDirtyTimestamp", ".", "hashCode", "(", ")", ":", "0", ")", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "overriddenStatus", "!", "=", "null", "?", "overriddenStatus", ".", "hashCode", "(", ")", ":", "0", ")", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "status", "!", "=", "null", "?", "status", ".", "hashCode", "(", ")", ":", "0", ")", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "instanceInfo", "!", "=", "null", "?", "instanceInfo", ".", "hashCode", "(", ")", ":", "0", ")", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "action", "!", "=", "null", "?", "action", ".", "hashCode", "(", ")", ":", "0", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "ReplicationInstanceBuilder", "replicationInstance", "(", ")", "{", "return", "ReplicationInstanceBuilder", ".", "aReplicationInstance", "(", ")", ";", "}", "</s>"]
["<s>", "private", "ReplicationInstanceBuilder", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "ReplicationInstanceBuilder", "aReplicationInstance", "(", ")", "{", "return", "new", "ReplicationInstanceBuilder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withAppName", "(", "String", "appName", ")", "{", "this", ".", "appName", "=", "appName", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withId", "(", "String", "id", ")", "{", "this", ".", "id", "=", "id", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withLastDirtyTimestamp", "(", "Long", "lastDirtyTimestamp", ")", "{", "this", ".", "lastDirtyTimestamp", "=", "lastDirtyTimestamp", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withOverriddenStatus", "(", "String", "overriddenStatus", ")", "{", "this", ".", "overriddenStatus", "=", "overriddenStatus", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withStatus", "(", "String", "status", ")", "{", "this", ".", "status", "=", "status", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withInstanceInfo", "(", "InstanceInfo", "instanceInfo", ")", "{", "this", ".", "instanceInfo", "=", "instanceInfo", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "withAction", "(", "Action", "action", ")", "{", "this", ".", "action", "=", "action", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstanceBuilder", "but", "(", ")", "{", "return", "aReplicationInstance", "(", ")", ".", "withAppName", "(", "appName", ")", ".", "withId", "(", "id", ")", ".", "withLastDirtyTimestamp", "(", "lastDirtyTimestamp", ")", ".", "withOverriddenStatus", "(", "overriddenStatus", ")", ".", "withStatus", "(", "status", ")", ".", "withInstanceInfo", "(", "instanceInfo", ")", ".", "withAction", "(", "action", ")", ";", "}", "</s>"]
["<s>", "public", "ReplicationInstance", "build", "(", ")", "{", "return", "new", "ReplicationInstance", "(", "appName", ",", "id", ",", "lastDirtyTimestamp", ",", "overriddenStatus", ",", "status", ",", "instanceInfo", ",", "action", ")", ";", "}", "</s>"]
["<s>", "private", "Builder", "(", ")", "{", "result", "=", "new", "StatusInfo", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Builder", "newBuilder", "(", ")", "{", "return", "new", "Builder", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Builder", "isHealthy", "(", "boolean", "b", ")", "{", "result", ".", "isHeathly", "=", "Boolean", ".", "valueOf", "(", "b", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "add", "(", "String", "key", ",", "String", "value", ")", "{", "if", "(", "result", ".", "applicationStats", "=", "=", "null", ")", "{", "result", ".", "applicationStats", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "}", "result", ".", "applicationStats", ".", "put", "(", "key", ",", "value", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "StatusInfo", "build", "(", ")", "{", "result", ".", "generalStats", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "getUpTime", "(", ")", ")", ";", "result", ".", "generalStats", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "ConfigurationManager", ".", "getDeploymentContext", "(", ")", ".", "getDeploymentEnvironment", "(", ")", ")", ";", "Runtime", "runtime", "=", "Runtime", ".", "getRuntime", "(", ")", ";", "int", "totalMem", "=", "(", "int", ")", "(", "runtime", ".", "totalMemory", "(", ")", "/", "<NUM_LIT>", ")", ";", "int", "freeMem", "=", "(", "int", ")", "(", "runtime", ".", "freeMemory", "(", ")", "/", "<NUM_LIT>", ")", ";", "int", "usedPercent", "=", "(", "int", ")", "(", "(", "(", "float", ")", "totalMem", "-", "freeMem", ")", "/", "(", "totalMem", ")", "*", "<NUM_LIT>", ")", ";", "result", ".", "generalStats", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "String", ".", "valueOf", "(", "runtime", ".", "availableProcessors", "(", ")", ")", ")", ";", "result", ".", "generalStats", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "String", ".", "valueOf", "(", "totalMem", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "result", ".", "generalStats", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "String", ".", "valueOf", "(", "totalMem", "-", "freeMem", ")", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "usedPercent", "+", "\"", "<STR_LIT>", "\"", ")", ";", "result", ".", "instanceInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "private", "StatusInfo", "(", ")", "{", "}", "</s>"]
["<s>", "public", "InstanceInfo", "getInstanceInfo", "(", ")", "{", "return", "instanceInfo", ";", "}", "</s>"]
["<s>", "public", "boolean", "isHealthy", "(", ")", "{", "return", "isHeathly", ".", "booleanValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Map", "<", "String", ",", "String", ">", "getGeneralStats", "(", ")", "{", "return", "generalStats", ";", "}", "</s>"]
["<s>", "public", "Map", "<", "String", ",", "String", ">", "getApplicationStats", "(", ")", "{", "return", "applicationStats", ";", "}", "</s>"]
["<s>", "public", "static", "String", "getUpTime", "(", ")", "{", "long", "diff", "=", "ManagementFactory", ".", "getRuntimeMXBean", "(", ")", ".", "getUptime", "(", ")", ";", "diff", "/", "=", "<NUM_LIT:1000>", "*", "<NUM_LIT>", ";", "long", "minutes", "=", "diff", "%", "<NUM_LIT>", ";", "diff", "/", "=", "<NUM_LIT>", ";", "long", "hours", "=", "diff", "%", "<NUM_LIT:24>", ";", "diff", "/", "=", "<NUM_LIT:24>", ";", "long", "days", "=", "diff", ";", "StringBuilder", "buf", "=", "new", "StringBuilder", "(", ")", ";", "if", "(", "days", "=", "=", "1", ")", "{", "buf", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "if", "(", "days", ">", "1", ")", "{", "buf", ".", "append", "(", "Long", ".", "valueOf", "(", "days", ")", ".", "toString", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "DecimalFormat", "format", "=", "new", "DecimalFormat", "(", ")", ";", "format", ".", "setMinimumIntegerDigits", "(", "<NUM_LIT:2>", ")", ";", "buf", ".", "append", "(", "format", ".", "format", "(", "hours", ")", ")", ".", "append", "(", "\"", "<STR_LIT::>", "\"", ")", ".", "append", "(", "format", ".", "format", "(", "minutes", ")", ")", ";", "return", "buf", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "getCurrentTimeAsString", "(", ")", "{", "SimpleDateFormat", "format", "=", "new", "SimpleDateFormat", "(", "DATE_FORMAT", ")", ";", "return", "format", ".", "format", "(", "new", "Date", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "MeasuredRate", "(", "long", "sampleInterval", ")", "{", "this", ".", "sampleInterval", "=", "sampleInterval", ";", "timer", ".", "schedule", "(", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "lastBucket", ".", "set", "(", "currentBucket", ".", "getAndSet", "(", "0", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ",", "sampleInterval", ",", "sampleInterval", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "lastBucket", ".", "set", "(", "currentBucket", ".", "getAndSet", "(", "0", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "long", "getCount", "(", ")", "{", "return", "lastBucket", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "increment", "(", ")", "{", "currentBucket", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "public", "StatusUtil", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "myAppName", "=", "server", ".", "getApplicationInfoManager", "(", ")", ".", "getInfo", "(", ")", ".", "getAppName", "(", ")", ";", "this", ".", "registry", "=", "server", ".", "getRegistry", "(", ")", ";", "this", ".", "peerEurekaNodes", "=", "server", ".", "getPeerEurekaNodes", "(", ")", ";", "}", "</s>"]
["<s>", "public", "StatusInfo", "getStatusInfo", "(", ")", "{", "StatusInfo", ".", "Builder", "builder", "=", "StatusInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "StringBuilder", "upReplicas", "=", "new", "StringBuilder", "(", ")", ";", "StringBuilder", "downReplicas", "=", "new", "StringBuilder", "(", ")", ";", "StringBuilder", "replicaHostNames", "=", "new", "StringBuilder", "(", ")", ";", "for", "(", "PeerEurekaNode", "node", ":", "peerEurekaNodes", ".", "getPeerEurekaNodes", "(", ")", ")", "{", "if", "(", "replicaHostNames", ".", "length", "(", ")", ">", "0", ")", "{", "replicaHostNames", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "replicaHostNames", ".", "append", "(", "node", ".", "getServiceUrl", "(", ")", ")", ";", "if", "(", "isReplicaAvailable", "(", "myAppName", ",", "node", ".", "getServiceUrl", "(", ")", ")", ")", "{", "upReplicas", ".", "append", "(", "node", ".", "getServiceUrl", "(", ")", ")", ".", "append", "(", "<CHAR_LIT:U+002C>", ")", ";", "}", "else", "{", "downReplicas", ".", "append", "(", "node", ".", "getServiceUrl", "(", ")", ")", ".", "append", "(", "<CHAR_LIT:U+002C>", ")", ";", "}", "}", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "replicaHostNames", ".", "toString", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "upReplicas", ".", "toString", "(", ")", ")", ";", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "downReplicas", ".", "toString", "(", ")", ")", ";", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isReplicaAvailable", "(", "String", "myAppName", ",", "String", "url", ")", "{", "try", "{", "String", "givenHostName", "=", "new", "URI", "(", "url", ")", ".", "getHost", "(", ")", ";", "Application", "app", "=", "registry", ".", "getApplication", "(", "myAppName", ",", "false", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "return", "false", ";", "}", "for", "(", "InstanceInfo", "info", ":", "app", ".", "getInstances", "(", ")", ")", "{", "if", "(", "info", ".", "getHostName", "(", ")", ".", "equals", "(", "givenHostName", ")", ")", "{", "return", "true", ";", "}", "}", "givenHostName", "=", "new", "URI", "(", "url", ")", ".", "getHost", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "EurekaMonitors", "(", "String", "name", ",", "String", "description", ")", "{", "this", ".", "name", "=", "name", ";", "this", ".", "description", "=", "description", ";", "DataCenterInfo", "dcInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ".", "getDataCenterInfo", "(", ")", ";", "if", "(", "dcInfo", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "myZoneCounterName", "=", "(", "(", "AmazonInfo", ")", "dcInfo", ")", ".", "get", "(", "MetaDataKey", ".", "availabilityZone", ")", "+", "\"", "<STR_LIT:.>", "\"", "+", "name", ";", "}", "else", "{", "myZoneCounterName", "=", "\"", "<STR_LIT:.>", "\"", "+", "name", ";", "}", "}", "</s>"]
["<s>", "public", "void", "increment", "(", ")", "{", "increment", "(", "false", ")", ";", "}", "</s>"]
["<s>", "public", "void", "increment", "(", "boolean", "isReplication", ")", "{", "counter", ".", "incrementAndGet", "(", ")", ";", "if", "(", "!", "isReplication", ")", "{", "myZoneCounter", ".", "incrementAndGet", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "public", "String", "getZoneSpecificName", "(", ")", "{", "return", "myZoneCounterName", ";", "}", "</s>"]
["<s>", "public", "String", "getDescription", "(", ")", "{", "return", "description", ";", "}", "</s>"]
["<s>", "public", "long", "getCount", "(", ")", "{", "return", "counter", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getZoneSpecificCount", "(", ")", "{", "return", "myZoneCounter", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "registerAllStats", "(", ")", "{", "for", "(", "EurekaMonitors", "c", ":", "EurekaMonitors", ".", "values", "(", ")", ")", "{", "Monitors", ".", "registerObject", "(", "c", ".", "getName", "(", ")", ",", "c", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "void", "shutdown", "(", ")", "{", "for", "(", "EurekaMonitors", "c", ":", "EurekaMonitors", ".", "values", "(", ")", ")", "{", "DefaultMonitorRegistry", ".", "getInstance", "(", ")", ".", "unregister", "(", "Monitors", ".", "newObjectMonitor", "(", "c", ".", "getName", "(", ")", ",", "c", ")", ")", ";", "}", "}", "</s>"]
["<s>", "void", "process", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", ";", "</s>"]
["<s>", "void", "shutdown", "(", ")", ";", "</s>"]
["<s>", "AcceptorExecutor", "(", "String", "id", ",", "int", "maxBufferSize", ",", "int", "maxBatchingSize", ",", "long", "maxBatchingDelay", ",", "long", "congestionRetryDelayMs", ",", "long", "networkFailureRetryMs", ")", "{", "this", ".", "maxBufferSize", "=", "maxBufferSize", ";", "this", ".", "maxBatchingSize", "=", "maxBatchingSize", ";", "this", ".", "maxBatchingDelay", "=", "maxBatchingDelay", ";", "this", ".", "trafficShaper", "=", "new", "TrafficShaper", "(", "congestionRetryDelayMs", ",", "networkFailureRetryMs", ")", ";", "ThreadGroup", "threadGroup", "=", "new", "ThreadGroup", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "acceptorThread", "=", "new", "Thread", "(", "threadGroup", ",", "new", "AcceptorRunner", "(", ")", ",", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "this", ".", "acceptorThread", ".", "setDaemon", "(", "true", ")", ";", "this", ".", "acceptorThread", ".", "start", "(", ")", ";", "final", "double", "[", "]", "percentiles", "=", "{", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", "}", ";", "final", "StatsConfig", "statsConfig", "=", "new", "StatsConfig", ".", "Builder", "(", ")", ".", "withSampleSize", "(", "<NUM_LIT:1000>", ")", ".", "withPercentiles", "(", "percentiles", ")", ".", "withPublishStdDev", "(", "true", ")", ".", "build", "(", ")", ";", "final", "MonitorConfig", "config", "=", "MonitorConfig", ".", "builder", "(", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "this", ".", "batchSizeMetric", "=", "new", "StatsTimer", "(", "config", ",", "statsConfig", ")", ";", "try", "{", "Monitors", ".", "registerObject", "(", "id", ",", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "void", "process", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", "{", "acceptorQueue", ".", "add", "(", "new", "TaskHolder", "<", "ID", ",", "T", ">", "(", "id", ",", "task", ",", "expiryTime", ")", ")", ";", "acceptedTasks", "+", "+", ";", "}", "</s>"]
["<s>", "void", "reprocess", "(", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "holders", ",", "ProcessingResult", "processingResult", ")", "{", "reprocessQueue", ".", "addAll", "(", "holders", ")", ";", "replayedTasks", "+", "=", "holders", ".", "size", "(", ")", ";", "trafficShaper", ".", "registerFailure", "(", "processingResult", ")", ";", "}", "</s>"]
["<s>", "void", "reprocess", "(", "TaskHolder", "<", "ID", ",", "T", ">", "taskHolder", ",", "ProcessingResult", "processingResult", ")", "{", "reprocessQueue", ".", "add", "(", "taskHolder", ")", ";", "replayedTasks", "+", "+", ";", "trafficShaper", ".", "registerFailure", "(", "processingResult", ")", ";", "}", "</s>"]
["<s>", "BlockingQueue", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "requestWorkItem", "(", ")", "{", "singleItemWorkRequests", ".", "release", "(", ")", ";", "return", "singleItemWorkQueue", ";", "}", "</s>"]
["<s>", "BlockingQueue", "<", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", ">", "requestWorkItems", "(", ")", "{", "batchWorkRequests", ".", "release", "(", ")", ";", "return", "batchWorkQueue", ";", "}", "</s>"]
["<s>", "void", "shutdown", "(", ")", "{", "if", "(", "isShutdown", ".", "compareAndSet", "(", "false", ",", "true", ")", ")", "{", "acceptorThread", ".", "interrupt", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getAcceptorQueueSize", "(", ")", "{", "return", "acceptorQueue", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getReprocessQueueSize", "(", ")", "{", "return", "reprocessQueue", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getQueueSize", "(", ")", "{", "return", "pendingTasks", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getPendingJobRequests", "(", ")", "{", "return", "singleItemWorkRequests", ".", "availablePermits", "(", ")", "+", "batchWorkRequests", ".", "availablePermits", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "workerTaskQueueSize", "(", ")", "{", "return", "singleItemWorkQueue", ".", "size", "(", ")", "+", "batchWorkQueue", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "long", "scheduleTime", "=", "0", ";", "while", "(", "!", "isShutdown", ".", "get", "(", ")", ")", "{", "try", "{", "drainInputQueues", "(", ")", ";", "int", "totalItems", "=", "processingOrder", ".", "size", "(", ")", ";", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "if", "(", "scheduleTime", "<", "now", ")", "{", "scheduleTime", "=", "now", "+", "trafficShaper", ".", "transmissionDelay", "(", ")", ";", "}", "if", "(", "scheduleTime", "<", "=", "now", ")", "{", "assignBatchWork", "(", ")", ";", "assignSingleItemWork", "(", ")", ";", "}", "if", "(", "totalItems", "=", "=", "processingOrder", ".", "size", "(", ")", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:10>", ")", ";", "}", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "boolean", "isFull", "(", ")", "{", "return", "pendingTasks", ".", "size", "(", ")", ">", "=", "maxBufferSize", ";", "}", "</s>"]
["<s>", "private", "void", "drainInputQueues", "(", ")", "throws", "InterruptedException", "{", "do", "{", "drainReprocessQueue", "(", ")", ";", "drainAcceptorQueue", "(", ")", ";", "if", "(", "!", "isShutdown", ".", "get", "(", ")", ")", "{", "if", "(", "reprocessQueue", ".", "isEmpty", "(", ")", "&", "&", "acceptorQueue", ".", "isEmpty", "(", ")", "&", "&", "pendingTasks", ".", "isEmpty", "(", ")", ")", "{", "TaskHolder", "<", "ID", ",", "T", ">", "taskHolder", "=", "acceptorQueue", ".", "poll", "(", "<NUM_LIT:10>", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "if", "(", "taskHolder", "!", "=", "null", ")", "{", "appendTaskHolder", "(", "taskHolder", ")", ";", "}", "}", "}", "}", "while", "(", "!", "reprocessQueue", ".", "isEmpty", "(", ")", "|", "|", "!", "acceptorQueue", ".", "isEmpty", "(", ")", "|", "|", "pendingTasks", ".", "isEmpty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "drainAcceptorQueue", "(", ")", "{", "while", "(", "!", "acceptorQueue", ".", "isEmpty", "(", ")", ")", "{", "appendTaskHolder", "(", "acceptorQueue", ".", "poll", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "drainReprocessQueue", "(", ")", "{", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "while", "(", "!", "reprocessQueue", ".", "isEmpty", "(", ")", "&", "&", "!", "isFull", "(", ")", ")", "{", "TaskHolder", "<", "ID", ",", "T", ">", "taskHolder", "=", "reprocessQueue", ".", "pollLast", "(", ")", ";", "ID", "id", "=", "taskHolder", ".", "getId", "(", ")", ";", "if", "(", "taskHolder", ".", "getExpiryTime", "(", ")", "<", "=", "now", ")", "{", "expiredTasks", "+", "+", ";", "}", "else", "if", "(", "pendingTasks", ".", "containsKey", "(", "id", ")", ")", "{", "overriddenTasks", "+", "+", ";", "}", "else", "{", "pendingTasks", ".", "put", "(", "id", ",", "taskHolder", ")", ";", "processingOrder", ".", "addFirst", "(", "id", ")", ";", "}", "}", "if", "(", "isFull", "(", ")", ")", "{", "queueOverflows", "+", "=", "reprocessQueue", ".", "size", "(", ")", ";", "reprocessQueue", ".", "clear", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "appendTaskHolder", "(", "TaskHolder", "<", "ID", ",", "T", ">", "taskHolder", ")", "{", "if", "(", "isFull", "(", ")", ")", "{", "pendingTasks", ".", "remove", "(", "processingOrder", ".", "poll", "(", ")", ")", ";", "queueOverflows", "+", "+", ";", "}", "TaskHolder", "<", "ID", ",", "T", ">", "previousTask", "=", "pendingTasks", ".", "put", "(", "taskHolder", ".", "getId", "(", ")", ",", "taskHolder", ")", ";", "if", "(", "previousTask", "=", "=", "null", ")", "{", "processingOrder", ".", "add", "(", "taskHolder", ".", "getId", "(", ")", ")", ";", "}", "else", "{", "overriddenTasks", "+", "+", ";", "}", "}", "</s>"]
["<s>", "void", "assignSingleItemWork", "(", ")", "{", "if", "(", "!", "processingOrder", ".", "isEmpty", "(", ")", ")", "{", "if", "(", "singleItemWorkRequests", ".", "tryAcquire", "(", "1", ")", ")", "{", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "while", "(", "!", "processingOrder", ".", "isEmpty", "(", ")", ")", "{", "ID", "id", "=", "processingOrder", ".", "poll", "(", ")", ";", "TaskHolder", "<", "ID", ",", "T", ">", "holder", "=", "pendingTasks", ".", "remove", "(", "id", ")", ";", "if", "(", "holder", ".", "getExpiryTime", "(", ")", ">", "now", ")", "{", "singleItemWorkQueue", ".", "add", "(", "holder", ")", ";", "return", ";", "}", "expiredTasks", "+", "+", ";", "}", "singleItemWorkRequests", ".", "release", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "void", "assignBatchWork", "(", ")", "{", "if", "(", "hasEnoughTasksForNextBatch", "(", ")", ")", "{", "if", "(", "batchWorkRequests", ".", "tryAcquire", "(", "1", ")", ")", "{", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "int", "len", "=", "Math", ".", "min", "(", "maxBatchingSize", ",", "processingOrder", ".", "size", "(", ")", ")", ";", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "holders", "=", "new", "ArrayList", "<", ">", "(", "len", ")", ";", "while", "(", "holders", ".", "size", "(", ")", "<", "len", "&", "&", "!", "processingOrder", ".", "isEmpty", "(", ")", ")", "{", "ID", "id", "=", "processingOrder", ".", "poll", "(", ")", ";", "TaskHolder", "<", "ID", ",", "T", ">", "holder", "=", "pendingTasks", ".", "remove", "(", "id", ")", ";", "if", "(", "holder", ".", "getExpiryTime", "(", ")", ">", "now", ")", "{", "holders", ".", "add", "(", "holder", ")", ";", "}", "else", "{", "expiredTasks", "+", "+", ";", "}", "}", "if", "(", "holders", ".", "isEmpty", "(", ")", ")", "{", "batchWorkRequests", ".", "release", "(", ")", ";", "}", "else", "{", "batchSizeMetric", ".", "record", "(", "holders", ".", "size", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "batchWorkQueue", ".", "add", "(", "holders", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "boolean", "hasEnoughTasksForNextBatch", "(", ")", "{", "if", "(", "processingOrder", ".", "isEmpty", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "pendingTasks", ".", "size", "(", ")", ">", "=", "maxBufferSize", ")", "{", "return", "true", ";", "}", "TaskHolder", "<", "ID", ",", "T", ">", "nextHolder", "=", "pendingTasks", ".", "get", "(", "processingOrder", ".", "peek", "(", ")", ")", ";", "long", "delay", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "nextHolder", ".", "getSubmitTimestamp", "(", ")", ";", "return", "delay", ">", "=", "maxBatchingDelay", ";", "}", "</s>"]
["<s>", "public", "static", "<", "ID", ",", "T", ">", "TaskDispatcher", "<", "ID", ",", "T", ">", "createNonBatchingTaskDispatcher", "(", "String", "id", ",", "int", "maxBufferSize", ",", "int", "workerCount", ",", "long", "maxBatchingDelay", ",", "long", "congestionRetryDelayMs", ",", "long", "networkFailureRetryMs", ",", "TaskProcessor", "<", "T", ">", "taskProcessor", ")", "{", "final", "AcceptorExecutor", "<", "ID", ",", "T", ">", "acceptorExecutor", "=", "new", "AcceptorExecutor", "<", ">", "(", "id", ",", "maxBufferSize", ",", "1", ",", "maxBatchingDelay", ",", "congestionRetryDelayMs", ",", "networkFailureRetryMs", ")", ";", "final", "TaskExecutors", "<", "ID", ",", "T", ">", "taskExecutor", "=", "TaskExecutors", ".", "singleItemExecutors", "(", "id", ",", "workerCount", ",", "taskProcessor", ",", "acceptorExecutor", ")", ";", "return", "new", "TaskDispatcher", "<", "ID", ",", "T", ">", "(", ")", "{", "@", "Override", "public", "void", "process", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", "{", "acceptorExecutor", ".", "process", "(", "id", ",", "task", ",", "expiryTime", ")", ";", "}", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "acceptorExecutor", ".", "shutdown", "(", ")", ";", "taskExecutor", ".", "shutdown", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "process", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", "{", "acceptorExecutor", ".", "process", "(", "id", ",", "task", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "acceptorExecutor", ".", "shutdown", "(", ")", ";", "taskExecutor", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "ID", ",", "T", ">", "TaskDispatcher", "<", "ID", ",", "T", ">", "createBatchingTaskDispatcher", "(", "String", "id", ",", "int", "maxBufferSize", ",", "int", "workloadSize", ",", "int", "workerCount", ",", "long", "maxBatchingDelay", ",", "long", "congestionRetryDelayMs", ",", "long", "networkFailureRetryMs", ",", "TaskProcessor", "<", "T", ">", "taskProcessor", ")", "{", "final", "AcceptorExecutor", "<", "ID", ",", "T", ">", "acceptorExecutor", "=", "new", "AcceptorExecutor", "<", ">", "(", "id", ",", "maxBufferSize", ",", "workloadSize", ",", "maxBatchingDelay", ",", "congestionRetryDelayMs", ",", "networkFailureRetryMs", ")", ";", "final", "TaskExecutors", "<", "ID", ",", "T", ">", "taskExecutor", "=", "TaskExecutors", ".", "batchExecutors", "(", "id", ",", "workerCount", ",", "taskProcessor", ",", "acceptorExecutor", ")", ";", "return", "new", "TaskDispatcher", "<", "ID", ",", "T", ">", "(", ")", "{", "@", "Override", "public", "void", "process", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", "{", "acceptorExecutor", ".", "process", "(", "id", ",", "task", ",", "expiryTime", ")", ";", "}", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "acceptorExecutor", ".", "shutdown", "(", ")", ";", "taskExecutor", ".", "shutdown", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "process", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", "{", "acceptorExecutor", ".", "process", "(", "id", ",", "task", ",", "expiryTime", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "acceptorExecutor", ".", "shutdown", "(", ")", ";", "taskExecutor", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "TaskHolder", "(", "ID", "id", ",", "T", "task", ",", "long", "expiryTime", ")", "{", "this", ".", "id", "=", "id", ";", "this", ".", "expiryTime", "=", "expiryTime", ";", "this", ".", "task", "=", "task", ";", "this", ".", "submitTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ID", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "public", "T", "getTask", "(", ")", "{", "return", "task", ";", "}", "</s>"]
["<s>", "public", "long", "getExpiryTime", "(", ")", "{", "return", "expiryTime", ";", "}", "</s>"]
["<s>", "public", "long", "getSubmitTimestamp", "(", ")", "{", "return", "submitTimestamp", ";", "}", "</s>"]
["<s>", "TaskExecutors", "(", "WorkerRunnableFactory", "<", "ID", ",", "T", ">", "workerRunnableFactory", ",", "int", "workerCount", ",", "AtomicBoolean", "isShutdown", ")", "{", "this", ".", "isShutdown", "=", "isShutdown", ";", "this", ".", "workerThreads", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "ThreadGroup", "threadGroup", "=", "new", "ThreadGroup", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "workerCount", ";", "i", "+", "+", ")", "{", "WorkerRunnable", "<", "ID", ",", "T", ">", "runnable", "=", "workerRunnableFactory", ".", "create", "(", "i", ")", ";", "Thread", "workerThread", "=", "new", "Thread", "(", "threadGroup", ",", "runnable", ",", "runnable", ".", "getWorkerName", "(", ")", ")", ";", "workerThreads", ".", "add", "(", "workerThread", ")", ";", "workerThread", ".", "setDaemon", "(", "true", ")", ";", "workerThread", ".", "start", "(", ")", ";", "}", "}", "</s>"]
["<s>", "void", "shutdown", "(", ")", "{", "if", "(", "isShutdown", ".", "compareAndSet", "(", "false", ",", "true", ")", ")", "{", "for", "(", "Thread", "workerThread", ":", "workerThreads", ")", "{", "workerThread", ".", "interrupt", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "static", "<", "ID", ",", "T", ">", "TaskExecutors", "<", "ID", ",", "T", ">", "singleItemExecutors", "(", "final", "String", "name", ",", "int", "workerCount", ",", "final", "TaskProcessor", "<", "T", ">", "processor", ",", "final", "AcceptorExecutor", "<", "ID", ",", "T", ">", "acceptorExecutor", ")", "{", "final", "AtomicBoolean", "isShutdown", "=", "new", "AtomicBoolean", "(", ")", ";", "final", "TaskExecutorMetrics", "metrics", "=", "new", "TaskExecutorMetrics", "(", "name", ")", ";", "return", "new", "TaskExecutors", "<", ">", "(", "new", "WorkerRunnableFactory", "<", "ID", ",", "T", ">", "(", ")", "{", "@", "Override", "public", "WorkerRunnable", "<", "ID", ",", "T", ">", "create", "(", "int", "idx", ")", "{", "return", "new", "SingleTaskWorkerRunnable", "<", ">", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "<CHAR_LIT:->", "+", "idx", ",", "isShutdown", ",", "metrics", ",", "processor", ",", "acceptorExecutor", ")", ";", "}", "}", ",", "workerCount", ",", "isShutdown", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "WorkerRunnable", "<", "ID", ",", "T", ">", "create", "(", "int", "idx", ")", "{", "return", "new", "SingleTaskWorkerRunnable", "<", ">", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "<CHAR_LIT:->", "+", "idx", ",", "isShutdown", ",", "metrics", ",", "processor", ",", "acceptorExecutor", ")", ";", "}", "</s>"]
["<s>", "static", "<", "ID", ",", "T", ">", "TaskExecutors", "<", "ID", ",", "T", ">", "batchExecutors", "(", "final", "String", "name", ",", "int", "workerCount", ",", "final", "TaskProcessor", "<", "T", ">", "processor", ",", "final", "AcceptorExecutor", "<", "ID", ",", "T", ">", "acceptorExecutor", ")", "{", "final", "AtomicBoolean", "isShutdown", "=", "new", "AtomicBoolean", "(", ")", ";", "final", "TaskExecutorMetrics", "metrics", "=", "new", "TaskExecutorMetrics", "(", "name", ")", ";", "return", "new", "TaskExecutors", "<", ">", "(", "new", "WorkerRunnableFactory", "<", "ID", ",", "T", ">", "(", ")", "{", "@", "Override", "public", "WorkerRunnable", "<", "ID", ",", "T", ">", "create", "(", "int", "idx", ")", "{", "return", "new", "BatchWorkerRunnable", "<", ">", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "<CHAR_LIT:->", "+", "idx", ",", "isShutdown", ",", "metrics", ",", "processor", ",", "acceptorExecutor", ")", ";", "}", "}", ",", "workerCount", ",", "isShutdown", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "WorkerRunnable", "<", "ID", ",", "T", ">", "create", "(", "int", "idx", ")", "{", "return", "new", "BatchWorkerRunnable", "<", ">", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "<CHAR_LIT:->", "+", "idx", ",", "isShutdown", ",", "metrics", ",", "processor", ",", "acceptorExecutor", ")", ";", "}", "</s>"]
["<s>", "TaskExecutorMetrics", "(", "String", "id", ")", "{", "final", "double", "[", "]", "percentiles", "=", "{", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", "}", ";", "final", "StatsConfig", "statsConfig", "=", "new", "StatsConfig", ".", "Builder", "(", ")", ".", "withSampleSize", "(", "<NUM_LIT:1000>", ")", ".", "withPercentiles", "(", "percentiles", ")", ".", "withPublishStdDev", "(", "true", ")", ".", "build", "(", ")", ";", "final", "MonitorConfig", "config", "=", "MonitorConfig", ".", "builder", "(", "METRIC_REPLICATION_PREFIX", "+", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ";", "taskWaitingTimeForProcessing", "=", "new", "StatsTimer", "(", "config", ",", "statsConfig", ")", ";", "try", "{", "Monitors", ".", "registerObject", "(", "id", ",", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "void", "registerTaskResult", "(", "ProcessingResult", "result", ",", "int", "count", ")", "{", "switch", "(", "result", ")", "{", "case", "Success", ":", "numberOfSuccessfulExecutions", "+", "=", "count", ";", "break", ";", "case", "TransientError", ":", "numberOfTransientError", "+", "=", "count", ";", "break", ";", "case", "PermanentError", ":", "numberOfPermanentError", "+", "=", "count", ";", "break", ";", "}", "}", "</s>"]
["<s>", "<", "ID", ",", "T", ">", "void", "registerExpiryTime", "(", "TaskHolder", "<", "ID", ",", "T", ">", "holder", ")", "{", "taskWaitingTimeForProcessing", ".", "record", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "holder", ".", "getSubmitTimestamp", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "</s>"]
["<s>", "<", "ID", ",", "T", ">", "void", "registerExpiryTimes", "(", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "holders", ")", "{", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "for", "(", "TaskHolder", "<", "ID", ",", "T", ">", "holder", ":", "holders", ")", "{", "taskWaitingTimeForProcessing", ".", "record", "(", "now", "-", "holder", ".", "getSubmitTimestamp", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "}", "</s>"]
["<s>", "WorkerRunnable", "<", "ID", ",", "T", ">", "create", "(", "int", "idx", ")", ";", "</s>"]
["<s>", "WorkerRunnable", "(", "String", "workerName", ",", "AtomicBoolean", "isShutdown", ",", "TaskExecutorMetrics", "metrics", ",", "TaskProcessor", "<", "T", ">", "processor", ",", "AcceptorExecutor", "<", "ID", ",", "T", ">", "taskDispatcher", ")", "{", "this", ".", "workerName", "=", "workerName", ";", "this", ".", "isShutdown", "=", "isShutdown", ";", "this", ".", "metrics", "=", "metrics", ";", "this", ".", "processor", "=", "processor", ";", "this", ".", "taskDispatcher", "=", "taskDispatcher", ";", "}", "</s>"]
["<s>", "String", "getWorkerName", "(", ")", "{", "return", "workerName", ";", "}", "</s>"]
["<s>", "BatchWorkerRunnable", "(", "String", "workerName", ",", "AtomicBoolean", "isShutdown", ",", "TaskExecutorMetrics", "metrics", ",", "TaskProcessor", "<", "T", ">", "processor", ",", "AcceptorExecutor", "<", "ID", ",", "T", ">", "acceptorExecutor", ")", "{", "super", "(", "workerName", ",", "isShutdown", ",", "metrics", ",", "processor", ",", "acceptorExecutor", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "while", "(", "!", "isShutdown", ".", "get", "(", ")", ")", "{", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "holders", "=", "getWork", "(", ")", ";", "metrics", ".", "registerExpiryTimes", "(", "holders", ")", ";", "List", "<", "T", ">", "tasks", "=", "getTasksOf", "(", "holders", ")", ";", "ProcessingResult", "result", "=", "processor", ".", "process", "(", "tasks", ")", ";", "switch", "(", "result", ")", "{", "case", "Success", ":", "break", ";", "case", "Congestion", ":", "case", "TransientError", ":", "taskDispatcher", ".", "reprocess", "(", "holders", ",", "result", ")", ";", "break", ";", "case", "PermanentError", ":", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "holders", ".", "size", "(", ")", ",", "workerName", ")", ";", "}", "metrics", ".", "registerTaskResult", "(", "result", ",", "tasks", ".", "size", "(", ")", ")", ";", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "getWork", "(", ")", "throws", "InterruptedException", "{", "BlockingQueue", "<", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", ">", "workQueue", "=", "taskDispatcher", ".", "requestWorkItems", "(", ")", ";", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "result", ";", "do", "{", "result", "=", "workQueue", ".", "poll", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "while", "(", "!", "isShutdown", ".", "get", "(", ")", "&", "&", "result", "=", "=", "null", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "private", "List", "<", "T", ">", "getTasksOf", "(", "List", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "holders", ")", "{", "List", "<", "T", ">", "tasks", "=", "new", "ArrayList", "<", ">", "(", "holders", ".", "size", "(", ")", ")", ";", "for", "(", "TaskHolder", "<", "ID", ",", "T", ">", "holder", ":", "holders", ")", "{", "tasks", ".", "add", "(", "holder", ".", "getTask", "(", ")", ")", ";", "}", "return", "tasks", ";", "}", "</s>"]
["<s>", "SingleTaskWorkerRunnable", "(", "String", "workerName", ",", "AtomicBoolean", "isShutdown", ",", "TaskExecutorMetrics", "metrics", ",", "TaskProcessor", "<", "T", ">", "processor", ",", "AcceptorExecutor", "<", "ID", ",", "T", ">", "acceptorExecutor", ")", "{", "super", "(", "workerName", ",", "isShutdown", ",", "metrics", ",", "processor", ",", "acceptorExecutor", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "while", "(", "!", "isShutdown", ".", "get", "(", ")", ")", "{", "BlockingQueue", "<", "TaskHolder", "<", "ID", ",", "T", ">", ">", "workQueue", "=", "taskDispatcher", ".", "requestWorkItem", "(", ")", ";", "TaskHolder", "<", "ID", ",", "T", ">", "taskHolder", ";", "while", "(", "(", "taskHolder", "=", "workQueue", ".", "poll", "(", "1", ",", "TimeUnit", ".", "SECONDS", ")", ")", "=", "=", "null", ")", "{", "if", "(", "isShutdown", ".", "get", "(", ")", ")", "{", "return", ";", "}", "}", "metrics", ".", "registerExpiryTime", "(", "taskHolder", ")", ";", "if", "(", "taskHolder", "!", "=", "null", ")", "{", "ProcessingResult", "result", "=", "processor", ".", "process", "(", "taskHolder", ".", "getTask", "(", ")", ")", ";", "switch", "(", "result", ")", "{", "case", "Success", ":", "break", ";", "case", "Congestion", ":", "case", "TransientError", ":", "taskDispatcher", ".", "reprocess", "(", "taskHolder", ",", "result", ")", ";", "break", ";", "case", "PermanentError", ":", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "workerName", ")", ";", "}", "metrics", ".", "registerTaskResult", "(", "result", ",", "1", ")", ";", "}", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "ProcessingResult", "process", "(", "T", "task", ")", ";", "</s>"]
["<s>", "ProcessingResult", "process", "(", "List", "<", "T", ">", "tasks", ")", ";", "</s>"]
["<s>", "TrafficShaper", "(", "long", "congestionRetryDelayMs", ",", "long", "networkFailureRetryMs", ")", "{", "this", ".", "congestionRetryDelayMs", "=", "Math", ".", "min", "(", "MAX_DELAY", ",", "congestionRetryDelayMs", ")", ";", "this", ".", "networkFailureRetryMs", "=", "Math", ".", "min", "(", "MAX_DELAY", ",", "networkFailureRetryMs", ")", ";", "}", "</s>"]
["<s>", "void", "registerFailure", "(", "ProcessingResult", "processingResult", ")", "{", "if", "(", "processingResult", "=", "=", "ProcessingResult", ".", "Congestion", ")", "{", "lastCongestionError", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "else", "if", "(", "processingResult", "=", "=", "ProcessingResult", ".", "TransientError", ")", "{", "lastNetworkFailure", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "}", "</s>"]
["<s>", "long", "transmissionDelay", "(", ")", "{", "if", "(", "lastCongestionError", "=", "=", "-", "1", "&", "&", "lastNetworkFailure", "=", "=", "-", "1", ")", "{", "return", "0", ";", "}", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "if", "(", "lastCongestionError", "!", "=", "-", "1", ")", "{", "long", "congestionDelay", "=", "now", "-", "lastCongestionError", ";", "if", "(", "congestionDelay", ">", "=", "0", "&", "&", "congestionDelay", "<", "congestionRetryDelayMs", ")", "{", "return", "congestionRetryDelayMs", "-", "congestionDelay", ";", "}", "lastCongestionError", "=", "-", "1", ";", "}", "if", "(", "lastNetworkFailure", "!", "=", "-", "1", ")", "{", "long", "failureDelay", "=", "now", "-", "lastNetworkFailure", ";", "if", "(", "failureDelay", ">", "=", "0", "&", "&", "failureDelay", "<", "networkFailureRetryMs", ")", "{", "return", "networkFailureRetryMs", "-", "failureDelay", ";", "}", "lastNetworkFailure", "=", "-", "1", ";", "}", "return", "0", ";", "}", "</s>"]
["<s>", "private", "static", "CodecWrapper", "getFullJson", "(", "EurekaServerConfig", "serverConfig", ")", "{", "CodecWrapper", "codec", "=", "CodecWrappers", ".", "getCodec", "(", "serverConfig", ".", "getJsonCodecName", "(", ")", ")", ";", "return", "codec", "=", "=", "null", "?", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ":", "codec", ";", "}", "</s>"]
["<s>", "private", "static", "CodecWrapper", "getFullXml", "(", "EurekaServerConfig", "serverConfig", ")", "{", "CodecWrapper", "codec", "=", "CodecWrappers", ".", "getCodec", "(", "serverConfig", ".", "getXmlCodecName", "(", ")", ")", ";", "return", "codec", "=", "=", "null", "?", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "XStreamXml", ".", "class", ")", ":", "codec", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "DefaultServerCodecs", "(", "EurekaServerConfig", "serverConfig", ")", "{", "this", "(", "getFullJson", "(", "serverConfig", ")", ",", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "JacksonJsonMini", ".", "class", ")", ",", "getFullXml", "(", "serverConfig", ")", ",", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "JacksonXmlMini", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "DefaultServerCodecs", "(", "CodecWrapper", "fullJsonCodec", ",", "CodecWrapper", "compactJsonCodec", ",", "CodecWrapper", "fullXmlCodec", ",", "CodecWrapper", "compactXmlCodec", ")", "{", "this", ".", "fullJsonCodec", "=", "fullJsonCodec", ";", "this", ".", "compactJsonCodec", "=", "compactJsonCodec", ";", "this", ".", "fullXmlCodec", "=", "fullXmlCodec", ";", "this", ".", "compactXmlCodec", "=", "compactXmlCodec", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CodecWrapper", "getFullJsonCodec", "(", ")", "{", "return", "fullJsonCodec", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CodecWrapper", "getCompactJsonCodec", "(", ")", "{", "return", "compactJsonCodec", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CodecWrapper", "getFullXmlCodec", "(", ")", "{", "return", "fullXmlCodec", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CodecWrapper", "getCompactXmlCodecr", "(", ")", "{", "return", "compactXmlCodec", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "EncoderWrapper", "getEncoder", "(", "Key", ".", "KeyType", "keyType", ",", "boolean", "compact", ")", "{", "switch", "(", "keyType", ")", "{", "case", "JSON", ":", "return", "compact", "?", "compactJsonCodec", ":", "fullJsonCodec", ";", "case", "XML", ":", "default", ":", "return", "compact", "?", "compactXmlCodec", ":", "fullXmlCodec", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "EncoderWrapper", "getEncoder", "(", "Key", ".", "KeyType", "keyType", ",", "EurekaAccept", "eurekaAccept", ")", "{", "switch", "(", "eurekaAccept", ")", "{", "case", "compact", ":", "return", "getEncoder", "(", "keyType", ",", "true", ")", ";", "case", "full", ":", "default", ":", "return", "getEncoder", "(", "keyType", ",", "false", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Builder", "builder", "(", ")", "{", "return", "new", "Builder", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "Builder", "(", ")", "{", "}", "</s>"]
["<s>", "public", "Builder", "withFullJsonCodec", "(", "CodecWrapper", "fullJsonCodec", ")", "{", "this", ".", "fullJsonCodec", "=", "fullJsonCodec", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "withCompactJsonCodec", "(", "CodecWrapper", "compactJsonCodec", ")", "{", "this", ".", "compactJsonCodec", "=", "compactJsonCodec", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "withFullXmlCodec", "(", "CodecWrapper", "fullXmlCodec", ")", "{", "this", ".", "fullXmlCodec", "=", "fullXmlCodec", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "withCompactXmlCodec", "(", "CodecWrapper", "compactXmlEncoder", ")", "{", "this", ".", "compactXmlCodec", "=", "compactXmlEncoder", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Builder", "withEurekaServerConfig", "(", "EurekaServerConfig", "config", ")", "{", "fullJsonCodec", "=", "CodecWrappers", ".", "getCodec", "(", "config", ".", "getJsonCodecName", "(", ")", ")", ";", "fullXmlCodec", "=", "CodecWrappers", ".", "getCodec", "(", "config", ".", "getXmlCodecName", "(", ")", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "ServerCodecs", "build", "(", ")", "{", "if", "(", "fullJsonCodec", "=", "=", "null", ")", "{", "fullJsonCodec", "=", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "LegacyJacksonJson", ".", "class", ")", ";", "}", "if", "(", "compactJsonCodec", "=", "=", "null", ")", "{", "compactJsonCodec", "=", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "JacksonJsonMini", ".", "class", ")", ";", "}", "if", "(", "fullXmlCodec", "=", "=", "null", ")", "{", "fullXmlCodec", "=", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "XStreamXml", ".", "class", ")", ";", "}", "if", "(", "compactXmlCodec", "=", "=", "null", ")", "{", "compactXmlCodec", "=", "CodecWrappers", ".", "getCodec", "(", "CodecWrappers", ".", "JacksonXmlMini", ".", "class", ")", ";", "}", "return", "new", "DefaultServerCodecs", "(", "fullJsonCodec", ",", "compactJsonCodec", ",", "fullXmlCodec", ",", "compactXmlCodec", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "ServerInfoResource", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "registry", "=", "server", ".", "getRegistry", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ServerInfoResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "getOverrides", "(", ")", "throws", "Exception", "{", "Map", "<", "String", ",", "InstanceInfo", ".", "InstanceStatus", ">", "result", "=", "registry", ".", "overriddenInstanceStatusesSnapshot", "(", ")", ";", "ObjectMapper", "objectMapper", "=", "new", "ObjectMapper", "(", ")", ";", "String", "responseStr", "=", "objectMapper", ".", "writeValueAsString", "(", "result", ")", ";", "return", "Response", ".", "ok", "(", "responseStr", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "VIPResource", "(", "EurekaServerContext", "server", ")", "{", "super", "(", "server", ")", ";", "}", "</s>"]
["<s>", "public", "VIPResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "statusUpdate", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "vipAddress", ",", "@", "HeaderParam", "(", "\"", "<STR_LIT>", "\"", ")", "final", "String", "acceptHeader", ",", "@", "HeaderParam", "(", "EurekaAccept", ".", "HTTP_X_EUREKA_ACCEPT", ")", "String", "eurekaAccept", ")", "{", "return", "getVipResponse", "(", "version", ",", "vipAddress", ",", "acceptHeader", ",", "EurekaAccept", ".", "fromString", "(", "eurekaAccept", ")", ",", "Key", ".", "EntityType", ".", "VIP", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "StatusResource", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "statusUtil", "=", "new", "StatusUtil", "(", "server", ")", ";", "}", "</s>"]
["<s>", "public", "StatusResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "StatusInfo", "getStatusInfo", "(", ")", "{", "return", "statusUtil", ".", "getStatusInfo", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "getCurrentTimeAsString", "(", ")", "{", "SimpleDateFormat", "format", "=", "new", "SimpleDateFormat", "(", "DATE_FORMAT", ")", ";", "return", "format", ".", "format", "(", "new", "Date", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "SecureVIPResource", "(", "EurekaServerContext", "server", ")", "{", "super", "(", "server", ")", ";", "}", "</s>"]
["<s>", "public", "SecureVIPResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "statusUpdate", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "svipAddress", ",", "@", "HeaderParam", "(", "\"", "<STR_LIT>", "\"", ")", "final", "String", "acceptHeader", ",", "@", "HeaderParam", "(", "EurekaAccept", ".", "HTTP_X_EUREKA_ACCEPT", ")", "String", "eurekaAccept", ")", "{", "return", "getVipResponse", "(", "version", ",", "svipAddress", ",", "acceptHeader", ",", "EurekaAccept", ".", "fromString", "(", "eurekaAccept", ")", ",", "Key", ".", "EntityType", ".", "SVIP", ")", ";", "}", "</s>"]
["<s>", "InstanceResource", "(", "ApplicationResource", "app", ",", "String", "id", ",", "EurekaServerConfig", "serverConfig", ",", "PeerAwareInstanceRegistry", "registry", ")", "{", "this", ".", "app", "=", "app", ";", "this", ".", "id", "=", "id", ";", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "registry", "=", "registry", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "Response", "getInstanceInfo", "(", ")", "{", "InstanceInfo", "appInfo", "=", "registry", ".", "getInstanceByAppAndId", "(", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "if", "(", "appInfo", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "return", "Response", ".", "ok", "(", "appInfo", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "PUT", "public", "Response", "renewLease", "(", "@", "HeaderParam", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ")", "String", "isReplication", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "overriddenStatus", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "status", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "lastDirtyTimestamp", ")", "{", "boolean", "isFromReplicaNode", "=", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "isReplication", ")", ";", "boolean", "isSuccess", "=", "registry", ".", "renew", "(", "app", ".", "getName", "(", ")", ",", "id", ",", "isFromReplicaNode", ")", ";", "if", "(", "!", "isSuccess", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "Response", "response", "=", "null", ";", "if", "(", "lastDirtyTimestamp", "!", "=", "null", "&", "&", "serverConfig", ".", "shouldSyncWhenTimestampDiffers", "(", ")", ")", "{", "response", "=", "this", ".", "validateDirtyTimestamp", "(", "Long", ".", "valueOf", "(", "lastDirtyTimestamp", ")", ",", "isFromReplicaNode", ")", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Response", ".", "Status", ".", "NOT_FOUND", ".", "getStatusCode", "(", ")", "&", "&", "(", "overriddenStatus", "!", "=", "null", ")", "&", "&", "!", "(", "InstanceStatus", ".", "UNKNOWN", ".", "name", "(", ")", ".", "equals", "(", "overriddenStatus", ")", ")", "&", "&", "isFromReplicaNode", ")", "{", "registry", ".", "storeOverriddenStatusIfRequired", "(", "app", ".", "getAppName", "(", ")", ",", "id", ",", "InstanceStatus", ".", "valueOf", "(", "overriddenStatus", ")", ")", ";", "}", "}", "else", "{", "response", "=", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", ",", "id", ",", "response", ".", "getStatus", "(", ")", ")", ";", "return", "response", ";", "}", "</s>"]
["<s>", "@", "PUT", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "statusUpdate", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "newStatus", ",", "@", "HeaderParam", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ")", "String", "isReplication", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "lastDirtyTimestamp", ")", "{", "try", "{", "if", "(", "registry", ".", "getInstanceByAppAndId", "(", "app", ".", "getName", "(", ")", ",", "id", ")", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "boolean", "isSuccess", "=", "registry", ".", "statusUpdate", "(", "app", ".", "getName", "(", ")", ",", "id", ",", "InstanceStatus", ".", "valueOf", "(", "newStatus", ")", ",", "lastDirtyTimestamp", ",", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "isReplication", ")", ")", ";", "if", "(", "isSuccess", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", "+", "newStatus", ")", ";", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", "+", "newStatus", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "newStatus", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "DELETE", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "deleteStatusUpdate", "(", "@", "HeaderParam", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ")", "String", "isReplication", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "newStatusValue", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "lastDirtyTimestamp", ")", "{", "try", "{", "if", "(", "registry", ".", "getInstanceByAppAndId", "(", "app", ".", "getName", "(", ")", ",", "id", ")", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "InstanceStatus", "newStatus", "=", "newStatusValue", "=", "=", "null", "?", "InstanceStatus", ".", "UNKNOWN", ":", "InstanceStatus", ".", "valueOf", "(", "newStatusValue", ")", ";", "boolean", "isSuccess", "=", "registry", ".", "deleteStatusOverride", "(", "app", ".", "getName", "(", ")", ",", "id", ",", "newStatus", ",", "lastDirtyTimestamp", ",", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "isReplication", ")", ")", ";", "if", "(", "isSuccess", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "PUT", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "updateMetadata", "(", "@", "Context", "UriInfo", "uriInfo", ")", "{", "try", "{", "InstanceInfo", "instanceInfo", "=", "registry", ".", "getInstanceByAppAndId", "(", "app", ".", "getName", "(", ")", ",", "id", ")", ";", "if", "(", "instanceInfo", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "MultivaluedMap", "<", "String", ",", "String", ">", "queryParams", "=", "uriInfo", ".", "getQueryParameters", "(", ")", ";", "Set", "<", "Entry", "<", "String", ",", "List", "<", "String", ">", ">", ">", "entrySet", "=", "queryParams", ".", "entrySet", "(", ")", ";", "Map", "<", "String", ",", "String", ">", "metadataMap", "=", "instanceInfo", ".", "getMetadata", "(", ")", ";", "if", "(", "Collections", ".", "emptyMap", "(", ")", ".", "getClass", "(", ")", ".", "equals", "(", "metadataMap", ".", "getClass", "(", ")", ")", ")", "{", "metadataMap", "=", "new", "ConcurrentHashMap", "<", "String", ",", "String", ">", "(", ")", ";", "InstanceInfo", ".", "Builder", "builder", "=", "new", "InstanceInfo", ".", "Builder", "(", "instanceInfo", ")", ";", "builder", ".", "setMetadata", "(", "metadataMap", ")", ";", "instanceInfo", "=", "builder", ".", "build", "(", ")", ";", "}", "for", "(", "Entry", "<", "String", ",", "List", "<", "String", ">", ">", "entry", ":", "entrySet", ")", "{", "metadataMap", ".", "put", "(", "entry", ".", "getKey", "(", ")", ",", "entry", ".", "getValue", "(", ")", ".", "get", "(", "0", ")", ")", ";", "}", "registry", ".", "register", "(", "instanceInfo", ",", "false", ")", ";", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "id", ",", "e", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "DELETE", "public", "Response", "cancelLease", "(", "@", "HeaderParam", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ")", "String", "isReplication", ")", "{", "boolean", "isSuccess", "=", "registry", ".", "cancel", "(", "app", ".", "getName", "(", ")", ",", "id", ",", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "isReplication", ")", ")", ";", "if", "(", "isSuccess", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "app", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Response", "validateDirtyTimestamp", "(", "Long", "lastDirtyTimestamp", ",", "boolean", "isReplication", ")", "{", "InstanceInfo", "appInfo", "=", "registry", ".", "getInstanceByAppAndId", "(", "app", ".", "getName", "(", ")", ",", "id", ",", "false", ")", ";", "if", "(", "appInfo", "!", "=", "null", ")", "{", "if", "(", "(", "lastDirtyTimestamp", "!", "=", "null", ")", "&", "&", "(", "!", "lastDirtyTimestamp", ".", "equals", "(", "appInfo", ".", "getLastDirtyTimestamp", "(", ")", ")", ")", ")", "{", "Object", "[", "]", "args", "=", "{", "id", ",", "appInfo", ".", "getLastDirtyTimestamp", "(", ")", ",", "lastDirtyTimestamp", ",", "isReplication", "}", ";", "if", "(", "lastDirtyTimestamp", ">", "appInfo", ".", "getLastDirtyTimestamp", "(", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "else", "if", "(", "appInfo", ".", "getLastDirtyTimestamp", "(", ")", ">", "lastDirtyTimestamp", ")", "{", "if", "(", "isReplication", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "CONFLICT", ")", ".", "entity", "(", "appInfo", ")", ".", "build", "(", ")", ";", "}", "else", "{", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "}", "}", "}", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "PeerReplicationResource", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "serverConfig", "=", "server", ".", "getServerConfig", "(", ")", ";", "this", ".", "registry", "=", "server", ".", "getRegistry", "(", ")", ";", "}", "</s>"]
["<s>", "public", "PeerReplicationResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "POST", "public", "Response", "batchReplication", "(", "ReplicationList", "replicationList", ")", "{", "try", "{", "ReplicationListResponse", "batchResponse", "=", "new", "ReplicationListResponse", "(", ")", ";", "for", "(", "ReplicationInstance", "instanceInfo", ":", "replicationList", ".", "getReplicationList", "(", ")", ")", "{", "try", "{", "batchResponse", ".", "addResponse", "(", "dispatch", "(", "instanceInfo", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "batchResponse", ".", "addResponse", "(", "new", "ReplicationInstanceResponse", "(", "Status", ".", "INTERNAL_SERVER_ERROR", ".", "getStatusCode", "(", ")", ",", "null", ")", ")", ";", "logger", ".", "error", "(", "instanceInfo", ".", "getAction", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "instanceInfo", ".", "getAppName", "(", ")", "+", "<CHAR_LIT:/>", "+", "instanceInfo", ".", "getId", "(", ")", ",", "e", ")", ";", "}", "}", "return", "Response", ".", "ok", "(", "batchResponse", ")", ".", "build", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "INTERNAL_SERVER_ERROR", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ReplicationInstanceResponse", "dispatch", "(", "ReplicationInstance", "instanceInfo", ")", "{", "ApplicationResource", "applicationResource", "=", "createApplicationResource", "(", "instanceInfo", ")", ";", "InstanceResource", "resource", "=", "createInstanceResource", "(", "instanceInfo", ",", "applicationResource", ")", ";", "String", "lastDirtyTimestamp", "=", "toString", "(", "instanceInfo", ".", "getLastDirtyTimestamp", "(", ")", ")", ";", "String", "overriddenStatus", "=", "toString", "(", "instanceInfo", ".", "getOverriddenStatus", "(", ")", ")", ";", "String", "instanceStatus", "=", "toString", "(", "instanceInfo", ".", "getStatus", "(", ")", ")", ";", "Builder", "singleResponseBuilder", "=", "new", "Builder", "(", ")", ";", "switch", "(", "instanceInfo", ".", "getAction", "(", ")", ")", "{", "case", "Register", ":", "singleResponseBuilder", "=", "handleRegister", "(", "instanceInfo", ",", "applicationResource", ")", ";", "break", ";", "case", "Heartbeat", ":", "singleResponseBuilder", "=", "handleHeartbeat", "(", "resource", ",", "lastDirtyTimestamp", ",", "overriddenStatus", ",", "instanceStatus", ")", ";", "break", ";", "case", "Cancel", ":", "singleResponseBuilder", "=", "handleCancel", "(", "resource", ")", ";", "break", ";", "case", "StatusUpdate", ":", "singleResponseBuilder", "=", "handleStatusUpdate", "(", "instanceInfo", ",", "resource", ")", ";", "break", ";", "case", "DeleteStatusOverride", ":", "singleResponseBuilder", "=", "handleDeleteStatusOverride", "(", "instanceInfo", ",", "resource", ")", ";", "break", ";", "}", "return", "singleResponseBuilder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "ApplicationResource", "createApplicationResource", "(", "ReplicationInstance", "instanceInfo", ")", "{", "return", "new", "ApplicationResource", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "serverConfig", ",", "registry", ")", ";", "}", "</s>"]
["<s>", "InstanceResource", "createInstanceResource", "(", "ReplicationInstance", "instanceInfo", ",", "ApplicationResource", "applicationResource", ")", "{", "return", "new", "InstanceResource", "(", "applicationResource", ",", "instanceInfo", ".", "getId", "(", ")", ",", "serverConfig", ",", "registry", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Builder", "handleRegister", "(", "ReplicationInstance", "instanceInfo", ",", "ApplicationResource", "applicationResource", ")", "{", "applicationResource", ".", "addInstance", "(", "instanceInfo", ".", "getInstanceInfo", "(", ")", ",", "REPLICATION", ")", ";", "return", "new", "Builder", "(", ")", ".", "setStatusCode", "(", "Status", ".", "OK", ".", "getStatusCode", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Builder", "handleCancel", "(", "InstanceResource", "resource", ")", "{", "Response", "response", "=", "resource", ".", "cancelLease", "(", "REPLICATION", ")", ";", "return", "new", "Builder", "(", ")", ".", "setStatusCode", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Builder", "handleHeartbeat", "(", "InstanceResource", "resource", ",", "String", "lastDirtyTimestamp", ",", "String", "overriddenStatus", ",", "String", "instanceStatus", ")", "{", "Response", "response", "=", "resource", ".", "renewLease", "(", "REPLICATION", ",", "overriddenStatus", ",", "instanceStatus", ",", "lastDirtyTimestamp", ")", ";", "Builder", "responseBuilder", "=", "new", "Builder", "(", ")", ".", "setStatusCode", "(", "response", ".", "getStatus", "(", ")", ")", ";", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", "&", "&", "response", ".", "getEntity", "(", ")", "!", "=", "null", ")", "{", "responseBuilder", ".", "setResponseEntity", "(", "(", "InstanceInfo", ")", "response", ".", "getEntity", "(", ")", ")", ";", "}", "return", "responseBuilder", ";", "}", "</s>"]
["<s>", "private", "static", "Builder", "handleStatusUpdate", "(", "ReplicationInstance", "instanceInfo", ",", "InstanceResource", "resource", ")", "{", "Response", "response", "=", "resource", ".", "statusUpdate", "(", "instanceInfo", ".", "getStatus", "(", ")", ",", "REPLICATION", ",", "toString", "(", "instanceInfo", ".", "getLastDirtyTimestamp", "(", ")", ")", ")", ";", "return", "new", "Builder", "(", ")", ".", "setStatusCode", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Builder", "handleDeleteStatusOverride", "(", "ReplicationInstance", "instanceInfo", ",", "InstanceResource", "resource", ")", "{", "Response", "response", "=", "resource", ".", "deleteStatusUpdate", "(", "REPLICATION", ",", "instanceInfo", ".", "getStatus", "(", ")", ",", "instanceInfo", ".", "getLastDirtyTimestamp", "(", ")", ".", "toString", "(", ")", ")", ";", "return", "new", "Builder", "(", ")", ".", "setStatusCode", "(", "response", ".", "getStatus", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "T", ">", "String", "toString", "(", "T", "value", ")", "{", "if", "(", "value", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "value", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "ApplicationsResource", "(", "EurekaServerContext", "eurekaServer", ")", "{", "this", ".", "serverConfig", "=", "eurekaServer", ".", "getServerConfig", "(", ")", ";", "this", ".", "registry", "=", "eurekaServer", ".", "getRegistry", "(", ")", ";", "this", ".", "responseCache", "=", "registry", ".", "getResponseCache", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ApplicationsResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "ApplicationResource", "getApplicationResource", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "appId", ")", "{", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "toEnum", "(", "version", ")", ")", ";", "return", "new", "ApplicationResource", "(", "appId", ",", "serverConfig", ",", "registry", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "Response", "getContainers", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "HeaderParam", "(", "HEADER_ACCEPT", ")", "String", "acceptHeader", ",", "@", "HeaderParam", "(", "HEADER_ACCEPT_ENCODING", ")", "String", "acceptEncoding", ",", "@", "HeaderParam", "(", "EurekaAccept", ".", "HTTP_X_EUREKA_ACCEPT", ")", "String", "eurekaAccept", ",", "@", "Context", "UriInfo", "uriInfo", ",", "@", "Nullable", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "regionsStr", ")", "{", "boolean", "isRemoteRegionRequested", "=", "null", "!", "=", "regionsStr", "&", "&", "!", "regionsStr", ".", "isEmpty", "(", ")", ";", "String", "[", "]", "regions", "=", "null", ";", "if", "(", "!", "isRemoteRegionRequested", ")", "{", "EurekaMonitors", ".", "GET_ALL", ".", "increment", "(", ")", ";", "}", "else", "{", "regions", "=", "regionsStr", ".", "toLowerCase", "(", ")", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "Arrays", ".", "sort", "(", "regions", ")", ";", "EurekaMonitors", ".", "GET_ALL_WITH_REMOTE_REGIONS", ".", "increment", "(", ")", ";", "}", "if", "(", "!", "registry", ".", "shouldAllowAccess", "(", "isRemoteRegionRequested", ")", ")", "{", "return", "Response", ".", "status", "(", "Status", ".", "FORBIDDEN", ")", ".", "build", "(", ")", ";", "}", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "toEnum", "(", "version", ")", ")", ";", "KeyType", "keyType", "=", "Key", ".", "KeyType", ".", "JSON", ";", "String", "returnMediaType", "=", "MediaType", ".", "APPLICATION_JSON", ";", "if", "(", "acceptHeader", "=", "=", "null", "|", "|", "!", "acceptHeader", ".", "contains", "(", "HEADER_JSON_VALUE", ")", ")", "{", "keyType", "=", "Key", ".", "KeyType", ".", "XML", ";", "returnMediaType", "=", "MediaType", ".", "APPLICATION_XML", ";", "}", "Key", "cacheKey", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "ResponseCacheImpl", ".", "ALL_APPS", ",", "keyType", ",", "CurrentRequestVersion", ".", "get", "(", ")", ",", "EurekaAccept", ".", "fromString", "(", "eurekaAccept", ")", ",", "regions", ")", ";", "Response", "response", ";", "if", "(", "acceptEncoding", "!", "=", "null", "&", "&", "acceptEncoding", ".", "contains", "(", "HEADER_GZIP_VALUE", ")", ")", "{", "response", "=", "Response", ".", "ok", "(", "responseCache", ".", "getGZIP", "(", "cacheKey", ")", ")", ".", "header", "(", "HEADER_CONTENT_ENCODING", ",", "HEADER_GZIP_VALUE", ")", ".", "header", "(", "HEADER_CONTENT_TYPE", ",", "returnMediaType", ")", ".", "build", "(", ")", ";", "}", "else", "{", "response", "=", "Response", ".", "ok", "(", "responseCache", ".", "get", "(", "cacheKey", ")", ")", ".", "build", "(", ")", ";", "}", "return", "response", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "Response", "getContainerDifferential", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "HeaderParam", "(", "HEADER_ACCEPT", ")", "String", "acceptHeader", ",", "@", "HeaderParam", "(", "HEADER_ACCEPT_ENCODING", ")", "String", "acceptEncoding", ",", "@", "HeaderParam", "(", "EurekaAccept", ".", "HTTP_X_EUREKA_ACCEPT", ")", "String", "eurekaAccept", ",", "@", "Context", "UriInfo", "uriInfo", ",", "@", "Nullable", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "regionsStr", ")", "{", "boolean", "isRemoteRegionRequested", "=", "null", "!", "=", "regionsStr", "&", "&", "!", "regionsStr", ".", "isEmpty", "(", ")", ";", "if", "(", "(", "serverConfig", ".", "shouldDisableDelta", "(", ")", ")", "|", "|", "(", "!", "registry", ".", "shouldAllowAccess", "(", "isRemoteRegionRequested", ")", ")", ")", "{", "return", "Response", ".", "status", "(", "Status", ".", "FORBIDDEN", ")", ".", "build", "(", ")", ";", "}", "String", "[", "]", "regions", "=", "null", ";", "if", "(", "!", "isRemoteRegionRequested", ")", "{", "EurekaMonitors", ".", "GET_ALL_DELTA", ".", "increment", "(", ")", ";", "}", "else", "{", "regions", "=", "regionsStr", ".", "toLowerCase", "(", ")", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "Arrays", ".", "sort", "(", "regions", ")", ";", "EurekaMonitors", ".", "GET_ALL_DELTA_WITH_REMOTE_REGIONS", ".", "increment", "(", ")", ";", "}", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "toEnum", "(", "version", ")", ")", ";", "KeyType", "keyType", "=", "Key", ".", "KeyType", ".", "JSON", ";", "String", "returnMediaType", "=", "MediaType", ".", "APPLICATION_JSON", ";", "if", "(", "acceptHeader", "=", "=", "null", "|", "|", "!", "acceptHeader", ".", "contains", "(", "HEADER_JSON_VALUE", ")", ")", "{", "keyType", "=", "Key", ".", "KeyType", ".", "XML", ";", "returnMediaType", "=", "MediaType", ".", "APPLICATION_XML", ";", "}", "Key", "cacheKey", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "ResponseCacheImpl", ".", "ALL_APPS_DELTA", ",", "keyType", ",", "CurrentRequestVersion", ".", "get", "(", ")", ",", "EurekaAccept", ".", "fromString", "(", "eurekaAccept", ")", ",", "regions", ")", ";", "if", "(", "acceptEncoding", "!", "=", "null", "&", "&", "acceptEncoding", ".", "contains", "(", "HEADER_GZIP_VALUE", ")", ")", "{", "return", "Response", ".", "ok", "(", "responseCache", ".", "getGZIP", "(", "cacheKey", ")", ")", ".", "header", "(", "HEADER_CONTENT_ENCODING", ",", "HEADER_GZIP_VALUE", ")", ".", "header", "(", "HEADER_CONTENT_TYPE", ",", "returnMediaType", ")", ".", "build", "(", ")", ";", "}", "else", "{", "return", "Response", ".", "ok", "(", "responseCache", ".", "get", "(", "cacheKey", ")", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Inject", "InstancesResource", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "registry", "=", "server", ".", "getRegistry", "(", ")", ";", "}", "</s>"]
["<s>", "public", "InstancesResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "getById", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "id", ")", "{", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "toEnum", "(", "version", ")", ")", ";", "List", "<", "InstanceInfo", ">", "list", "=", "registry", ".", "getInstancesById", "(", "id", ")", ";", "if", "(", "list", "!", "=", "null", "&", "&", "list", ".", "size", "(", ")", ">", "0", ")", "{", "return", "Response", ".", "ok", "(", "list", ".", "get", "(", "0", ")", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "AbstractVIPResource", "(", "EurekaServerContext", "server", ")", "{", "this", ".", "registry", "=", "server", ".", "getRegistry", "(", ")", ";", "this", ".", "responseCache", "=", "registry", ".", "getResponseCache", "(", ")", ";", "}", "</s>"]
["<s>", "AbstractVIPResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "Response", "getVipResponse", "(", "String", "version", ",", "String", "entityName", ",", "String", "acceptHeader", ",", "EurekaAccept", "eurekaAccept", ",", "Key", ".", "EntityType", "entityType", ")", "{", "if", "(", "!", "registry", ".", "shouldAllowAccess", "(", "false", ")", ")", "{", "return", "Response", ".", "status", "(", "Response", ".", "Status", ".", "FORBIDDEN", ")", ".", "build", "(", ")", ";", "}", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "toEnum", "(", "version", ")", ")", ";", "Key", ".", "KeyType", "keyType", "=", "Key", ".", "KeyType", ".", "JSON", ";", "if", "(", "acceptHeader", "=", "=", "null", "|", "|", "!", "acceptHeader", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "keyType", "=", "Key", ".", "KeyType", ".", "XML", ";", "}", "Key", "cacheKey", "=", "new", "Key", "(", "entityType", ",", "entityName", ",", "keyType", ",", "CurrentRequestVersion", ".", "get", "(", ")", ",", "eurekaAccept", ")", ";", "String", "payLoad", "=", "responseCache", ".", "get", "(", "cacheKey", ")", ";", "if", "(", "payLoad", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "entityName", ")", ";", "return", "Response", ".", "ok", "(", "payLoad", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "entityName", ")", ";", "return", "Response", ".", "status", "(", "Response", ".", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "ASGStatus", "toEnum", "(", "String", "s", ")", "{", "for", "(", "ASGStatus", "e", ":", "ASGStatus", ".", "values", "(", ")", ")", "{", "if", "(", "e", ".", "name", "(", ")", ".", "equalsIgnoreCase", "(", "s", ")", ")", "{", "return", "e", ";", "}", "}", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "s", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "ASGResource", "(", "EurekaServerContext", "eurekaServer", ")", "{", "this", ".", "registry", "=", "eurekaServer", ".", "getRegistry", "(", ")", ";", "if", "(", "registry", "instanceof", "AwsInstanceRegistry", ")", "{", "this", ".", "awsAsgUtil", "=", "(", "(", "AwsInstanceRegistry", ")", "registry", ")", ".", "getAwsAsgUtil", "(", ")", ";", "}", "else", "{", "this", ".", "awsAsgUtil", "=", "null", ";", "}", "}", "</s>"]
["<s>", "public", "ASGResource", "(", ")", "{", "this", "(", "EurekaServerContextHolder", ".", "getInstance", "(", ")", ".", "getServerContext", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "PUT", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "statusUpdate", "(", "@", "PathParam", "(", "\"", "<STR_LIT:Name>", "\"", ")", "String", "asgName", ",", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "newStatus", ",", "@", "HeaderParam", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ")", "String", "isReplication", ")", "{", "if", "(", "awsAsgUtil", "=", "=", "null", ")", "{", "return", "Response", ".", "status", "(", "<NUM_LIT>", ")", ".", "build", "(", ")", ";", "}", "try", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "asgName", ",", "newStatus", ")", ";", "ASGStatus", "asgStatus", "=", "ASGStatus", ".", "valueOf", "(", "newStatus", ".", "toUpperCase", "(", ")", ")", ";", "awsAsgUtil", ".", "setStatus", "(", "asgName", ",", "(", "!", "ASGStatus", ".", "DISABLED", ".", "equals", "(", "asgStatus", ")", ")", ")", ";", "registry", ".", "statusUpdate", "(", "asgName", ",", "asgStatus", ",", "Boolean", ".", "valueOf", "(", "isReplication", ")", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "asgName", ",", "asgStatus", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "newStatus", ",", "asgName", ",", "e", ")", ";", "return", "Response", ".", "serverError", "(", ")", ".", "build", "(", ")", ";", "}", "return", "Response", ".", "ok", "(", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "private", "CurrentRequestVersion", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "Version", "get", "(", ")", "{", "return", "CURRENT_REQ_VERSION", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "set", "(", "Version", "version", ")", "{", "CURRENT_REQ_VERSION", ".", "set", "(", "version", ")", ";", "}", "</s>"]
["<s>", "CodecWrapper", "getFullJsonCodec", "(", ")", ";", "</s>"]
["<s>", "CodecWrapper", "getCompactJsonCodec", "(", ")", ";", "</s>"]
["<s>", "CodecWrapper", "getFullXmlCodec", "(", ")", ";", "</s>"]
["<s>", "CodecWrapper", "getCompactXmlCodecr", "(", ")", ";", "</s>"]
["<s>", "EncoderWrapper", "getEncoder", "(", "Key", ".", "KeyType", "keyType", ",", "boolean", "compact", ")", ";", "</s>"]
["<s>", "EncoderWrapper", "getEncoder", "(", "Key", ".", "KeyType", "keyType", ",", "EurekaAccept", "eurekaAccept", ")", ";", "</s>"]
["<s>", "ApplicationResource", "(", "String", "appName", ",", "EurekaServerConfig", "serverConfig", ",", "PeerAwareInstanceRegistry", "registry", ")", "{", "this", ".", "appName", "=", "appName", ".", "toUpperCase", "(", ")", ";", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "registry", "=", "registry", ";", "this", ".", "responseCache", "=", "registry", ".", "getResponseCache", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getAppName", "(", ")", "{", "return", "appName", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "Response", "getApplication", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "version", ",", "@", "HeaderParam", "(", "\"", "<STR_LIT>", "\"", ")", "final", "String", "acceptHeader", ",", "@", "HeaderParam", "(", "EurekaAccept", ".", "HTTP_X_EUREKA_ACCEPT", ")", "String", "eurekaAccept", ")", "{", "if", "(", "!", "registry", ".", "shouldAllowAccess", "(", "false", ")", ")", "{", "return", "Response", ".", "status", "(", "Status", ".", "FORBIDDEN", ")", ".", "build", "(", ")", ";", "}", "EurekaMonitors", ".", "GET_APPLICATION", ".", "increment", "(", ")", ";", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "toEnum", "(", "version", ")", ")", ";", "KeyType", "keyType", "=", "Key", ".", "KeyType", ".", "JSON", ";", "if", "(", "acceptHeader", "=", "=", "null", "|", "|", "!", "acceptHeader", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "keyType", "=", "Key", ".", "KeyType", ".", "XML", ";", "}", "Key", "cacheKey", "=", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "appName", ",", "keyType", ",", "CurrentRequestVersion", ".", "get", "(", ")", ",", "EurekaAccept", ".", "fromString", "(", "eurekaAccept", ")", ")", ";", "String", "payLoad", "=", "responseCache", ".", "get", "(", "cacheKey", ")", ";", "if", "(", "payLoad", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ")", ";", "return", "Response", ".", "ok", "(", "payLoad", ")", ".", "build", "(", ")", ";", "}", "else", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ")", ";", "return", "Response", ".", "status", "(", "Status", ".", "NOT_FOUND", ")", ".", "build", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "InstanceResource", "getInstanceInfo", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "id", ")", "{", "return", "new", "InstanceResource", "(", "this", ",", "id", ",", "serverConfig", ",", "registry", ")", ";", "}", "</s>"]
["<s>", "@", "POST", "@", "Consumes", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "void", "addInstance", "(", "InstanceInfo", "info", ",", "@", "HeaderParam", "(", "PeerEurekaNode", ".", "HEADER_REPLICATION", ")", "String", "isReplication", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "info", ".", "getId", "(", ")", ",", "isReplication", ")", ";", "registry", ".", "register", "(", "info", ",", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "isReplication", ")", ")", ";", "}", "</s>"]
["<s>", "String", "getName", "(", ")", "{", "return", "appName", ";", "}", "</s>"]
["<s>", "public", "Lease", "(", "T", "r", ",", "int", "durationInSecs", ")", "{", "holder", "=", "r", ";", "registrationTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "lastUpdateTimestamp", "=", "registrationTimestamp", ";", "duration", "=", "(", "durationInSecs", "*", "<NUM_LIT:1000>", ")", ";", "}", "</s>"]
["<s>", "public", "void", "renew", "(", ")", "{", "lastUpdateTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", "+", "duration", ";", "}", "</s>"]
["<s>", "public", "void", "cancel", "(", ")", "{", "if", "(", "evictionTimestamp", "<", "=", "0", ")", "{", "evictionTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "serviceUp", "(", ")", "{", "if", "(", "serviceUpTimestamp", "=", "=", "0", ")", "{", "serviceUpTimestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "setServiceUpTimestamp", "(", "long", "serviceUpTimestamp", ")", "{", "this", ".", "serviceUpTimestamp", "=", "serviceUpTimestamp", ";", "}", "</s>"]
["<s>", "public", "boolean", "isExpired", "(", ")", "{", "return", "isExpired", "(", "0", "l", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isExpired", "(", "long", "additionalLeaseMs", ")", "{", "return", "(", "evictionTimestamp", ">", "0", "|", "|", "System", ".", "currentTimeMillis", "(", ")", ">", "(", "lastUpdateTimestamp", "+", "duration", "+", "additionalLeaseMs", ")", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getRegistrationTimestamp", "(", ")", "{", "return", "registrationTimestamp", ";", "}", "</s>"]
["<s>", "public", "long", "getLastRenewalTimestamp", "(", ")", "{", "return", "lastUpdateTimestamp", ";", "}", "</s>"]
["<s>", "public", "long", "getEvictionTimestamp", "(", ")", "{", "return", "evictionTimestamp", ";", "}", "</s>"]
["<s>", "public", "long", "getServiceUpTimestamp", "(", ")", "{", "return", "serviceUpTimestamp", ";", "}", "</s>"]
["<s>", "public", "T", "getHolder", "(", ")", "{", "return", "holder", ";", "}", "</s>"]
["<s>", "void", "register", "(", "T", "r", ",", "int", "leaseDuration", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "boolean", "cancel", "(", "String", "appName", ",", "String", "id", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "boolean", "renew", "(", "String", "appName", ",", "String", "id", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "void", "evict", "(", ")", ";", "</s>"]
["<s>", "public", "com", ".", "netflix", ".", "servo", ".", "monitor", ".", "Timer", "getTimer", "(", ")", "{", "return", "this", ".", "timer", ";", "}", "</s>"]
["<s>", "public", "int", "compare", "(", "Application", "l", ",", "Application", "r", ")", "{", "return", "l", ".", "getName", "(", ")", ".", "compareTo", "(", "r", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "PeerAwareInstanceRegistryImpl", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "ServerCodecs", "serverCodecs", ",", "EurekaClient", "eurekaClient", ")", "{", "super", "(", "serverConfig", ",", "serverCodecs", ")", ";", "this", ".", "clientConfig", "=", "clientConfig", ";", "this", ".", "serverCodecs", "=", "serverCodecs", ";", "this", ".", "eurekaClient", "=", "eurekaClient", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", "PeerEurekaNodes", "peerEurekaNodes", ")", "throws", "Exception", "{", "this", ".", "peerEurekaNodes", "=", "peerEurekaNodes", ";", "initializedResponseCache", "(", ")", ";", "scheduleRenewalThresholdUpdateTask", "(", ")", ";", "initRemoteRegionRegistry", "(", ")", ";", "try", "{", "Monitors", ".", "registerObject", "(", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "try", "{", "DefaultMonitorRegistry", ".", "getInstance", "(", ")", ".", "unregister", "(", "Monitors", ".", "newObjectMonitor", "(", "this", ")", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "}", "try", "{", "peerEurekaNodes", ".", "shutdown", "(", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "}", "super", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "scheduleRenewalThresholdUpdateTask", "(", ")", "{", "timer", ".", "schedule", "(", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "updateRenewalThreshold", "(", ")", ";", "}", "}", ",", "serverConfig", ".", "getRenewalThresholdUpdateIntervalMs", "(", ")", ",", "serverConfig", ".", "getRenewalThresholdUpdateIntervalMs", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "updateRenewalThreshold", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "syncUp", "(", ")", "{", "int", "count", "=", "0", ";", "for", "(", "int", "i", "=", "0", ";", "(", "(", "i", "<", "serverConfig", ".", "getRegistrySyncRetries", "(", ")", ")", "&", "&", "(", "count", "=", "=", "0", ")", ")", ";", "i", "+", "+", ")", "{", "Applications", "apps", "=", "eurekaClient", ".", "getApplications", "(", ")", ";", "for", "(", "Application", "app", ":", "apps", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "app", ".", "getInstances", "(", ")", ")", "{", "try", "{", "if", "(", "isRegisterable", "(", "instance", ")", ")", "{", "register", "(", "instance", ",", "instance", ".", "getLeaseInfo", "(", ")", ".", "getDurationInSecs", "(", ")", ",", "true", ")", ";", "count", "+", "+", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "}", "}", "}", "if", "(", "count", "=", "=", "0", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "serverConfig", ".", "getRegistrySyncRetryWaitMs", "(", ")", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "break", ";", "}", "}", "}", "return", "count", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "openForTraffic", "(", "ApplicationInfoManager", "applicationInfoManager", ",", "int", "count", ")", "{", "this", ".", "expectedNumberOfRenewsPerMin", "=", "count", "*", "<NUM_LIT:2>", ";", "this", ".", "numberOfRenewsPerMinThreshold", "=", "(", "int", ")", "(", "this", ".", "expectedNumberOfRenewsPerMin", "*", "serverConfig", ".", "getRenewalPercentThreshold", "(", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "count", "+", "\"", "<STR_LIT>", "\"", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "numberOfRenewsPerMinThreshold", ")", ";", "this", ".", "startupTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "if", "(", "count", ">", "0", ")", "{", "this", ".", "peerInstancesTransferEmptyOnStartup", "=", "false", ";", "}", "DataCenterInfo", ".", "Name", "selfName", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ".", "getDataCenterInfo", "(", ")", ".", "getName", "(", ")", ";", "boolean", "isAws", "=", "Name", ".", "Amazon", "=", "=", "selfName", ";", "if", "(", "isAws", "&", "&", "serverConfig", ".", "shouldPrimeAwsReplicaConnections", "(", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "primeAwsReplicas", "(", "applicationInfoManager", ")", ";", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "applicationInfoManager", ".", "setInstanceStatus", "(", "InstanceStatus", ".", "UP", ")", ";", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "primeAwsReplicas", "(", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "boolean", "areAllPeerNodesPrimed", "=", "false", ";", "while", "(", "!", "areAllPeerNodesPrimed", ")", "{", "String", "peerHostName", "=", "null", ";", "try", "{", "Application", "eurekaApps", "=", "this", ".", "getApplication", "(", "applicationInfoManager", ".", "getInfo", "(", ")", ".", "getAppName", "(", ")", ",", "false", ")", ";", "if", "(", "eurekaApps", "=", "=", "null", ")", "{", "areAllPeerNodesPrimed", "=", "true", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "for", "(", "PeerEurekaNode", "node", ":", "peerEurekaNodes", ".", "getPeerEurekaNodes", "(", ")", ")", "{", "for", "(", "InstanceInfo", "peerInstanceInfo", ":", "eurekaApps", ".", "getInstances", "(", ")", ")", "{", "LeaseInfo", "leaseInfo", "=", "peerInstanceInfo", ".", "getLeaseInfo", "(", ")", ";", "if", "(", "System", ".", "currentTimeMillis", "(", ")", ">", "(", "leaseInfo", ".", "getRenewalTimestamp", "(", ")", "+", "(", "leaseInfo", ".", "getDurationInSecs", "(", ")", "*", "<NUM_LIT:1000>", ")", ")", "+", "(", "<NUM_LIT:2>", "*", "<NUM_LIT>", "*", "<NUM_LIT:1000>", ")", ")", "{", "continue", ";", "}", "peerHostName", "=", "peerInstanceInfo", ".", "getHostName", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "peerHostName", ")", ";", "if", "(", "peerHostName", ".", "equalsIgnoreCase", "(", "new", "URI", "(", "node", ".", "getServiceUrl", "(", ")", ")", ".", "getHost", "(", ")", ")", ")", "{", "node", ".", "heartbeat", "(", "peerInstanceInfo", ".", "getAppName", "(", ")", ",", "peerInstanceInfo", ".", "getId", "(", ")", ",", "peerInstanceInfo", ",", "null", ",", "true", ")", ";", "}", "}", "}", "areAllPeerNodesPrimed", "=", "true", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "peerHostName", ",", "e", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "PRIME_PEER_NODES_RETRY_MS", ")", ";", "}", "catch", "(", "InterruptedException", "e1", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e1", ")", ";", "areAllPeerNodesPrimed", "=", "true", ";", "}", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "shouldAllowAccess", "(", "boolean", "remoteRegionRequired", ")", "{", "if", "(", "this", ".", "peerInstancesTransferEmptyOnStartup", ")", "{", "if", "(", "!", "(", "System", ".", "currentTimeMillis", "(", ")", ">", "this", ".", "startupTime", "+", "serverConfig", ".", "getWaitTimeInMsWhenSyncEmpty", "(", ")", ")", ")", "{", "return", "false", ";", "}", "}", "if", "(", "remoteRegionRequired", ")", "{", "for", "(", "RemoteRegionRegistry", "remoteRegionRegistry", ":", "this", ".", "regionNameVSRemoteRegistry", ".", "values", "(", ")", ")", "{", "if", "(", "!", "remoteRegionRegistry", ".", "isReadyForServingData", "(", ")", ")", "{", "return", "false", ";", "}", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "public", "boolean", "shouldAllowAccess", "(", ")", "{", "return", "shouldAllowAccess", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "List", "<", "PeerEurekaNode", ">", "getReplicaNodes", "(", ")", "{", "return", "Collections", ".", "unmodifiableList", "(", "peerEurekaNodes", ".", "getPeerEurekaNodes", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "cancel", "(", "final", "String", "appName", ",", "final", "String", "id", ",", "final", "boolean", "isReplication", ")", "{", "if", "(", "super", ".", "cancel", "(", "appName", ",", "id", ",", "isReplication", ")", ")", "{", "replicateToPeers", "(", "Action", ".", "Cancel", ",", "appName", ",", "id", ",", "null", ",", "null", ",", "isReplication", ")", ";", "synchronized", "(", "lock", ")", "{", "if", "(", "this", ".", "expectedNumberOfRenewsPerMin", ">", "0", ")", "{", "this", ".", "expectedNumberOfRenewsPerMin", "=", "this", ".", "expectedNumberOfRenewsPerMin", "-", "<NUM_LIT:2>", ";", "this", ".", "numberOfRenewsPerMinThreshold", "=", "(", "int", ")", "(", "this", ".", "expectedNumberOfRenewsPerMin", "*", "serverConfig", ".", "getRenewalPercentThreshold", "(", ")", ")", ";", "}", "}", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "register", "(", "final", "InstanceInfo", "info", ",", "final", "boolean", "isReplication", ")", "{", "int", "leaseDuration", "=", "Lease", ".", "DEFAULT_DURATION_IN_SECS", ";", "if", "(", "info", ".", "getLeaseInfo", "(", ")", "!", "=", "null", "&", "&", "info", ".", "getLeaseInfo", "(", ")", ".", "getDurationInSecs", "(", ")", ">", "0", ")", "{", "leaseDuration", "=", "info", ".", "getLeaseInfo", "(", ")", ".", "getDurationInSecs", "(", ")", ";", "}", "super", ".", "register", "(", "info", ",", "leaseDuration", ",", "isReplication", ")", ";", "replicateToPeers", "(", "Action", ".", "Register", ",", "info", ".", "getAppName", "(", ")", ",", "info", ".", "getId", "(", ")", ",", "info", ",", "null", ",", "isReplication", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "renew", "(", "final", "String", "appName", ",", "final", "String", "id", ",", "final", "boolean", "isReplication", ")", "{", "if", "(", "super", ".", "renew", "(", "appName", ",", "id", ",", "isReplication", ")", ")", "{", "replicateToPeers", "(", "Action", ".", "Heartbeat", ",", "appName", ",", "id", ",", "null", ",", "null", ",", "isReplication", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "statusUpdate", "(", "final", "String", "appName", ",", "final", "String", "id", ",", "final", "InstanceStatus", "newStatus", ",", "String", "lastDirtyTimestamp", ",", "final", "boolean", "isReplication", ")", "{", "if", "(", "super", ".", "statusUpdate", "(", "appName", ",", "id", ",", "newStatus", ",", "lastDirtyTimestamp", ",", "isReplication", ")", ")", "{", "replicateToPeers", "(", "Action", ".", "StatusUpdate", ",", "appName", ",", "id", ",", "null", ",", "newStatus", ",", "isReplication", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "deleteStatusOverride", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "String", "lastDirtyTimestamp", ",", "boolean", "isReplication", ")", "{", "if", "(", "super", ".", "deleteStatusOverride", "(", "appName", ",", "id", ",", "newStatus", ",", "lastDirtyTimestamp", ",", "isReplication", ")", ")", "{", "replicateToPeers", "(", "Action", ".", "DeleteStatusOverride", ",", "appName", ",", "id", ",", "null", ",", "null", ",", "isReplication", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "statusUpdate", "(", "final", "String", "asgName", ",", "final", "ASGStatus", "newStatus", ",", "final", "boolean", "isReplication", ")", "{", "if", "(", "isReplication", ")", "{", "return", ";", "}", "for", "(", "final", "PeerEurekaNode", "node", ":", "peerEurekaNodes", ".", "getPeerEurekaNodes", "(", ")", ")", "{", "replicateASGInfoToReplicaNodes", "(", "asgName", ",", "newStatus", ",", "node", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isLeaseExpirationEnabled", "(", ")", "{", "if", "(", "!", "isSelfPreservationModeEnabled", "(", ")", ")", "{", "return", "true", ";", "}", "return", "numberOfRenewsPerMinThreshold", ">", "0", "&", "&", "getNumOfRenewsInLastMin", "(", ")", ">", "numberOfRenewsPerMinThreshold", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isSelfPreservationModeEnabled", "(", ")", "{", "return", "serverConfig", ".", "shouldEnableSelfPreservation", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "getNextServerFromEureka", "(", "String", "virtualHostname", ",", "boolean", "secure", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "private", "void", "updateRenewalThreshold", "(", ")", "{", "try", "{", "Applications", "apps", "=", "eurekaClient", ".", "getApplications", "(", ")", ";", "int", "count", "=", "0", ";", "for", "(", "Application", "app", ":", "apps", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "app", ".", "getInstances", "(", ")", ")", "{", "if", "(", "this", ".", "isRegisterable", "(", "instance", ")", ")", "{", "+", "+", "count", ";", "}", "}", "}", "synchronized", "(", "lock", ")", "{", "if", "(", "(", "count", "*", "<NUM_LIT:2>", ")", ">", "(", "serverConfig", ".", "getRenewalPercentThreshold", "(", ")", "*", "numberOfRenewsPerMinThreshold", ")", "|", "|", "(", "!", "this", ".", "isSelfPreservationModeEnabled", "(", ")", ")", ")", "{", "this", ".", "expectedNumberOfRenewsPerMin", "=", "count", "*", "<NUM_LIT:2>", ";", "this", ".", "numberOfRenewsPerMinThreshold", "=", "(", "int", ")", "(", "(", "count", "*", "<NUM_LIT:2>", ")", "*", "serverConfig", ".", "getRenewalPercentThreshold", "(", ")", ")", ";", "}", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "numberOfRenewsPerMinThreshold", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Application", ">", "getSortedApplications", "(", ")", "{", "List", "<", "Application", ">", "apps", "=", "new", "ArrayList", "<", "Application", ">", "(", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", ";", "Collections", ".", "sort", "(", "apps", ",", "APP_COMPARATOR", ")", ";", "return", "apps", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getNumOfReplicationsInLastMin", "(", ")", "{", "return", "numberOfReplicationsLastMin", ".", "getCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "DataSourceType", ".", "GAUGE", ")", "@", "Override", "public", "int", "isBelowRenewThresold", "(", ")", "{", "if", "(", "(", "getNumOfRenewsInLastMin", "(", ")", "<", "=", "numberOfRenewsPerMinThreshold", ")", "&", "&", "(", "(", "this", ".", "startupTime", ">", "0", ")", "&", "&", "(", "System", ".", "currentTimeMillis", "(", ")", ">", "this", ".", "startupTime", "+", "(", "serverConfig", ".", "getWaitTimeInMsWhenSyncEmpty", "(", ")", ")", ")", ")", ")", "{", "return", "1", ";", "}", "else", "{", "return", "0", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "isRegisterable", "(", "InstanceInfo", "instanceInfo", ")", "{", "DataCenterInfo", "datacenterInfo", "=", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ";", "String", "serverRegion", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "if", "(", "AmazonInfo", ".", "class", ".", "isInstance", "(", "datacenterInfo", ")", ")", "{", "AmazonInfo", "info", "=", "AmazonInfo", ".", "class", ".", "cast", "(", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ")", ";", "String", "availabilityZone", "=", "info", ".", "get", "(", "MetaDataKey", ".", "availabilityZone", ")", ";", "if", "(", "availabilityZone", "=", "=", "null", "&", "&", "US_EAST_1", ".", "equalsIgnoreCase", "(", "serverRegion", ")", ")", "{", "return", "true", ";", "}", "else", "if", "(", "(", "availabilityZone", "!", "=", "null", ")", "&", "&", "(", "availabilityZone", ".", "contains", "(", "serverRegion", ")", ")", ")", "{", "return", "true", ";", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "private", "void", "replicateToPeers", "(", "Action", "action", ",", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceStatus", "newStatus", ",", "boolean", "isReplication", ")", "{", "Stopwatch", "tracer", "=", "action", ".", "getTimer", "(", ")", ".", "start", "(", ")", ";", "try", "{", "if", "(", "isReplication", ")", "{", "numberOfReplicationsLastMin", ".", "increment", "(", ")", ";", "}", "if", "(", "peerEurekaNodes", "=", "=", "Collections", ".", "EMPTY_LIST", "|", "|", "isReplication", ")", "{", "return", ";", "}", "for", "(", "final", "PeerEurekaNode", "node", ":", "peerEurekaNodes", ".", "getPeerEurekaNodes", "(", ")", ")", "{", "if", "(", "peerEurekaNodes", ".", "isThisMe", "(", "node", ".", "getServiceUrl", "(", ")", ")", ")", "{", "continue", ";", "}", "replicateInstanceActionsToPeers", "(", "action", ",", "appName", ",", "id", ",", "info", ",", "newStatus", ",", "node", ")", ";", "}", "}", "finally", "{", "tracer", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "replicateInstanceActionsToPeers", "(", "Action", "action", ",", "String", "appName", ",", "String", "id", ",", "InstanceInfo", "info", ",", "InstanceStatus", "newStatus", ",", "PeerEurekaNode", "node", ")", "{", "try", "{", "InstanceInfo", "infoFromRegistry", "=", "null", ";", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "V2", ")", ";", "switch", "(", "action", ")", "{", "case", "Cancel", ":", "node", ".", "cancel", "(", "appName", ",", "id", ")", ";", "break", ";", "case", "Heartbeat", ":", "InstanceStatus", "overriddenStatus", "=", "overriddenInstanceStatusMap", ".", "get", "(", "id", ")", ";", "infoFromRegistry", "=", "getInstanceByAppAndId", "(", "appName", ",", "id", ",", "false", ")", ";", "node", ".", "heartbeat", "(", "appName", ",", "id", ",", "infoFromRegistry", ",", "overriddenStatus", ",", "false", ")", ";", "break", ";", "case", "Register", ":", "node", ".", "register", "(", "info", ")", ";", "break", ";", "case", "StatusUpdate", ":", "infoFromRegistry", "=", "getInstanceByAppAndId", "(", "appName", ",", "id", ",", "false", ")", ";", "node", ".", "statusUpdate", "(", "appName", ",", "id", ",", "newStatus", ",", "infoFromRegistry", ")", ";", "break", ";", "case", "DeleteStatusOverride", ":", "infoFromRegistry", "=", "getInstanceByAppAndId", "(", "appName", ",", "id", ",", "false", ")", ";", "node", ".", "deleteStatusOverride", "(", "appName", ",", "id", ",", "infoFromRegistry", ")", ";", "break", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getServiceUrl", "(", ")", ",", "action", ".", "name", "(", ")", ",", "t", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "replicateASGInfoToReplicaNodes", "(", "final", "String", "asgName", ",", "final", "ASGStatus", "newStatus", ",", "final", "PeerEurekaNode", "node", ")", "{", "CurrentRequestVersion", ".", "set", "(", "Version", ".", "V2", ")", ";", "try", "{", "node", ".", "statusUpdate", "(", "asgName", ",", "newStatus", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getServiceUrl", "(", ")", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getLocalRegistrySize", "(", ")", "{", "return", "super", ".", "getLocalRegistrySize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "InstanceInfo", ".", "InstanceStatus", "getOverriddenInstanceStatus", "(", "InstanceInfo", "r", ",", "Lease", "<", "InstanceInfo", ">", "existingLease", ",", "boolean", "isReplication", ")", "{", "if", "(", "(", "!", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ".", "equals", "(", "r", ".", "getStatus", "(", ")", ")", ")", "&", "&", "(", "!", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "equals", "(", "r", ".", "getStatus", "(", ")", ")", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getStatus", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "return", "r", ".", "getStatus", "(", ")", ";", "}", "InstanceInfo", ".", "InstanceStatus", "overridden", "=", "overriddenInstanceStatusMap", ".", "get", "(", "r", ".", "getId", "(", ")", ")", ";", "if", "(", "overridden", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getId", "(", ")", ",", "overridden", ".", "name", "(", ")", ")", ";", "return", "overridden", ";", "}", "if", "(", "!", "isReplication", ")", "{", "InstanceInfo", ".", "InstanceStatus", "existingStatus", "=", "null", ";", "if", "(", "existingLease", "!", "=", "null", ")", "{", "existingStatus", "=", "existingLease", ".", "getHolder", "(", ")", ".", "getStatus", "(", ")", ";", "}", "if", "(", "(", "existingStatus", "!", "=", "null", ")", "&", "&", "(", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "equals", "(", "existingStatus", ")", "|", "|", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ".", "equals", "(", "existingStatus", ")", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "existingLease", ".", "getHolder", "(", ")", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "existingLease", ".", "getHolder", "(", ")", ".", "getId", "(", ")", ")", ";", "return", "existingLease", ".", "getHolder", "(", ")", ".", "getStatus", "(", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getStatus", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "return", "r", ".", "getStatus", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "RemoteRegionRegistry", "(", "EurekaServerConfig", "serverConfig", ",", "ServerCodecs", "serverCodecs", ",", "String", "regionName", ",", "URL", "remoteRegionURL", ")", "{", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "remoteRegionURL", "=", "remoteRegionURL", ";", "this", ".", "fetchRegistryTimer", "=", "Monitors", ".", "newTimer", "(", "this", ".", "remoteRegionURL", ".", "toString", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "EurekaJerseyClientBuilder", "clientBuilder", "=", "new", "EurekaJerseyClientBuilder", "(", ")", ".", "withUserAgent", "(", "\"", "<STR_LIT>", "\"", ")", ".", "withEncoderWrapper", "(", "serverCodecs", ".", "getFullJsonCodec", "(", ")", ")", ".", "withDecoderWrapper", "(", "serverCodecs", ".", "getFullJsonCodec", "(", ")", ")", ".", "withConnectionTimeout", "(", "serverConfig", ".", "getRemoteRegionConnectTimeoutMs", "(", ")", ")", ".", "withReadTimeout", "(", "serverConfig", ".", "getRemoteRegionReadTimeoutMs", "(", ")", ")", ".", "withMaxConnectionsPerHost", "(", "serverConfig", ".", "getRemoteRegionTotalConnectionsPerHost", "(", ")", ")", ".", "withMaxTotalConnections", "(", "serverConfig", ".", "getRemoteRegionTotalConnections", "(", ")", ")", ".", "withConnectionIdleTimeout", "(", "serverConfig", ".", "getRemoteRegionConnectionIdleTimeoutSeconds", "(", ")", ")", ";", "if", "(", "remoteRegionURL", ".", "getProtocol", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "clientBuilder", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", "+", "regionName", ")", ";", "}", "else", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", "{", "clientBuilder", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", "+", "regionName", ")", ".", "withSystemSSLConfiguration", "(", ")", ";", "}", "else", "{", "clientBuilder", ".", "withClientName", "(", "\"", "<STR_LIT>", "\"", "+", "regionName", ")", ".", "withTrustStoreFile", "(", "serverConfig", ".", "getRemoteRegionTrustStore", "(", ")", ",", "serverConfig", ".", "getRemoteRegionTrustStorePassword", "(", ")", ")", ";", "}", "discoveryJerseyClient", "=", "clientBuilder", ".", "build", "(", ")", ";", "discoveryApacheClient", "=", "discoveryJerseyClient", ".", "getClient", "(", ")", ";", "if", "(", "serverConfig", ".", "shouldGZipContentFromRemoteRegion", "(", ")", ")", "{", "discoveryApacheClient", ".", "addFilter", "(", "new", "GZIPContentEncodingFilter", "(", "false", ")", ")", ";", "}", "String", "ip", "=", "null", ";", "try", "{", "ip", "=", "InetAddress", ".", "getLocalHost", "(", ")", ".", "getHostAddress", "(", ")", ";", "}", "catch", "(", "UnknownHostException", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "EurekaServerIdentity", "identity", "=", "new", "EurekaServerIdentity", "(", "ip", ")", ";", "discoveryApacheClient", ".", "addFilter", "(", "new", "EurekaIdentityHeaderFilter", "(", "identity", ")", ")", ";", "applications", ".", "set", "(", "new", "Applications", "(", ")", ")", ";", "try", "{", "if", "(", "fetchRegistry", "(", ")", ")", "{", "this", ".", "readyForServingData", "=", "true", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:.>", "\"", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "Runnable", "remoteRegionFetchTask", "=", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "if", "(", "fetchRegistry", "(", ")", ")", "{", "readyForServingData", "=", "true", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ";", "ThreadPoolExecutor", "remoteRegionFetchExecutor", "=", "new", "ThreadPoolExecutor", "(", "1", ",", "serverConfig", ".", "getRemoteRegionFetchThreadPoolSize", "(", ")", ",", "0", ",", "TimeUnit", ".", "SECONDS", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ")", ";", "scheduler", "=", "Executors", ".", "newScheduledThreadPool", "(", "1", ",", "new", "ThreadFactoryBuilder", "(", ")", ".", "setNameFormat", "(", "\"", "<STR_LIT>", "\"", "+", "regionName", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setDaemon", "(", "true", ")", ".", "build", "(", ")", ")", ";", "scheduler", ".", "schedule", "(", "new", "TimedSupervisorTask", "(", "\"", "<STR_LIT>", "\"", "+", "regionName", ",", "scheduler", ",", "remoteRegionFetchExecutor", ",", "serverConfig", ".", "getRemoteRegionRegistryFetchInterval", "(", ")", ",", "TimeUnit", ".", "SECONDS", ",", "<NUM_LIT:5>", ",", "remoteRegionFetchTask", ")", ",", "serverConfig", ".", "getRemoteRegionRegistryFetchInterval", "(", ")", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "if", "(", "fetchRegistry", "(", ")", ")", "{", "readyForServingData", "=", "true", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "isReadyForServingData", "(", ")", "{", "return", "readyForServingData", ";", "}", "</s>"]
["<s>", "private", "boolean", "fetchRegistry", "(", ")", "{", "ClientResponse", "response", "=", "null", ";", "Stopwatch", "tracer", "=", "fetchRegistryTimer", ".", "start", "(", ")", ";", "try", "{", "if", "(", "serverConfig", ".", "shouldDisableDeltaForRemoteRegions", "(", ")", "|", "|", "(", "getApplications", "(", ")", "=", "=", "null", ")", "|", "|", "(", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", "=", "=", "0", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "serverConfig", ".", "shouldDisableDeltaForRemoteRegions", "(", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "(", "getApplications", "(", ")", "=", "=", "null", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "(", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", "=", "=", "0", ")", ")", ";", "response", "=", "storeFullRegistry", "(", ")", ";", "}", "else", "{", "long", "currDeltaGeneration", "=", "deltaGeneration", ".", "get", "(", ")", ";", "Applications", "delta", "=", "null", ";", "response", "=", "fetchRemoteRegistry", "(", "true", ")", ";", "if", "(", "null", "!", "=", "response", ")", "{", "if", "(", "response", ".", "getStatus", "(", ")", "=", "=", "Status", ".", "OK", ".", "getStatusCode", "(", ")", ")", "{", "delta", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "if", "(", "delta", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "if", "(", "deltaGeneration", ".", "compareAndSet", "(", "currDeltaGeneration", ",", "currDeltaGeneration", "+", "1", ")", ")", "{", "this", ".", "applicationsDelta", ".", "set", "(", "delta", ")", ";", "}", "else", "{", "delta", "=", "null", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "if", "(", "delta", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "closeResponse", "(", "response", ")", ";", "response", "=", "fetchRemoteRegistry", "(", "true", ")", ";", "}", "else", "{", "updateDelta", "(", "delta", ")", ";", "String", "reconcileHashCode", "=", "getApplications", "(", ")", ".", "getReconcileHashCode", "(", ")", ";", "if", "(", "(", "!", "reconcileHashCode", ".", "equals", "(", "delta", ".", "getAppsHashCode", "(", ")", ")", ")", ")", "{", "response", "=", "reconcileAndLogDifference", "(", "response", ",", "delta", ",", "reconcileHashCode", ")", ";", "}", "}", "}", "}", "logTotalInstances", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "null", "=", "=", "response", "?", "null", ":", "response", ".", "getStatus", "(", ")", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "this", ".", "remoteRegionURL", ".", "toString", "(", ")", ",", "e", ")", ";", "return", "false", ";", "}", "finally", "{", "if", "(", "tracer", "!", "=", "null", ")", "{", "tracer", ".", "stop", "(", ")", ";", "}", "closeResponse", "(", "response", ")", ";", "}", "return", "null", "!", "=", "response", ";", "}", "</s>"]
["<s>", "private", "void", "updateDelta", "(", "Applications", "delta", ")", "{", "int", "deltaCount", "=", "0", ";", "for", "(", "Application", "app", ":", "delta", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instance", ":", "app", ".", "getInstances", "(", ")", ")", "{", "+", "+", "deltaCount", ";", "if", "(", "ActionType", ".", "ADDED", ".", "equals", "(", "instance", ".", "getActionType", "(", ")", ")", ")", "{", "Application", "existingApp", "=", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "existingApp", "=", "=", "null", ")", "{", "getApplications", "(", ")", ".", "addApplication", "(", "app", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instance", ".", "getId", "(", ")", ")", ";", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ".", "addInstance", "(", "instance", ")", ";", "}", "else", "if", "(", "ActionType", ".", "MODIFIED", ".", "equals", "(", "instance", ".", "getActionType", "(", ")", ")", ")", "{", "Application", "existingApp", "=", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "existingApp", "=", "=", "null", ")", "{", "getApplications", "(", ")", ".", "addApplication", "(", "app", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instance", ".", "getId", "(", ")", ")", ";", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ".", "addInstance", "(", "instance", ")", ";", "}", "else", "if", "(", "ActionType", ".", "DELETED", ".", "equals", "(", "instance", ".", "getActionType", "(", ")", ")", ")", "{", "Application", "existingApp", "=", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ";", "if", "(", "existingApp", "=", "=", "null", ")", "{", "getApplications", "(", ")", ".", "addApplication", "(", "app", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "instance", ".", "getId", "(", ")", ")", ";", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", "instance", ".", "getAppName", "(", ")", ")", ".", "removeInstance", "(", "instance", ")", ";", "}", "}", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "deltaCount", ")", ";", "}", "</s>"]
["<s>", "private", "void", "closeResponse", "(", "ClientResponse", "response", ")", "{", "if", "(", "response", "!", "=", "null", ")", "{", "try", "{", "response", ".", "close", "(", ")", ";", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "ClientResponse", "storeFullRegistry", "(", ")", "{", "long", "currentUpdateGeneration", "=", "fullRegistryGeneration", ".", "get", "(", ")", ";", "ClientResponse", "response", "=", "fetchRemoteRegistry", "(", "false", ")", ";", "if", "(", "response", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "Applications", "apps", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "if", "(", "apps", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "if", "(", "fullRegistryGeneration", ".", "compareAndSet", "(", "currentUpdateGeneration", ",", "currentUpdateGeneration", "+", "1", ")", ")", "{", "applications", ".", "set", "(", "apps", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "response", ".", "getStatus", "(", ")", ")", ";", "return", "response", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "fetchRemoteRegistry", "(", "boolean", "delta", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ".", "remoteRegionURL", ",", "delta", ")", ";", "ClientResponse", "response", "=", "null", ";", "try", "{", "String", "urlPath", "=", "delta", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT:/>", "\"", ";", "response", "=", "discoveryApacheClient", ".", "resource", "(", "this", ".", "remoteRegionURL", ".", "toString", "(", ")", "+", "urlPath", ")", ".", "accept", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "get", "(", "ClientResponse", ".", "class", ")", ";", "int", "httpStatus", "=", "response", ".", "getStatus", "(", ")", ";", "if", "(", "httpStatus", ">", "=", "<NUM_LIT>", "&", "&", "httpStatus", "<", "<NUM_LIT>", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "httpStatus", ")", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "this", ".", "remoteRegionURL", ".", "toString", "(", ")", ",", "httpStatus", ")", ";", "return", "null", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "this", ".", "remoteRegionURL", ",", "t", ")", ";", "}", "return", "response", ";", "}", "</s>"]
["<s>", "private", "ClientResponse", "reconcileAndLogDifference", "(", "ClientResponse", "response", ",", "Applications", "delta", ",", "String", "reconcileHashCode", ")", "throws", "Throwable", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "reconcileHashCode", ",", "delta", ".", "getAppsHashCode", "(", ")", ")", ";", "this", ".", "closeResponse", "(", "response", ")", ";", "response", "=", "this", ".", "fetchRemoteRegistry", "(", "false", ")", ";", "if", "(", "null", "=", "=", "response", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "Applications", "serverApps", "=", "response", ".", "getEntity", "(", "Applications", ".", "class", ")", ";", "Map", "<", "String", ",", "List", "<", "String", ">", ">", "reconcileDiffMap", "=", "getApplications", "(", ")", ".", "getReconcileMapDiff", "(", "serverApps", ")", ";", "String", "reconcileString", "=", "\"", "\"", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "List", "<", "String", ">", ">", "mapEntry", ":", "reconcileDiffMap", ".", "entrySet", "(", ")", ")", "{", "reconcileString", "=", "reconcileString", "+", "mapEntry", ".", "getKey", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "for", "(", "String", "displayString", ":", "mapEntry", ".", "getValue", "(", ")", ")", "{", "reconcileString", "=", "reconcileString", "+", "displayString", ";", "}", "reconcileString", "=", "reconcileString", "+", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ";", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "reconcileString", ")", ";", "applications", ".", "set", "(", "serverApps", ")", ";", "applicationsDelta", ".", "set", "(", "serverApps", ")", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getApplications", "(", ")", ".", "getReconcileHashCode", "(", ")", ",", "delta", ".", "getAppsHashCode", "(", ")", ")", ";", "return", "response", ";", "}", "</s>"]
["<s>", "private", "void", "logTotalInstances", "(", ")", "{", "int", "totInstances", "=", "0", ";", "for", "(", "Application", "application", ":", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", "{", "totInstances", "+", "=", "application", ".", "getInstancesAsIsFromEureka", "(", ")", ".", "size", "(", ")", ";", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "totInstances", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "getApplications", "(", ")", "{", "return", "applications", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "getNextServerFromEureka", "(", "String", "arg0", ",", "boolean", "arg1", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Application", "getApplication", "(", "String", "appName", ")", "{", "return", "this", ".", "applications", ".", "get", "(", ")", ".", "getRegisteredApplications", "(", "appName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "InstanceInfo", ">", "getInstancesById", "(", "String", "id", ")", "{", "List", "<", "InstanceInfo", ">", "list", "=", "Collections", ".", "emptyList", "(", ")", ";", "for", "(", "Application", "app", ":", "applications", ".", "get", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", "{", "InstanceInfo", "info", "=", "app", ".", "getByInstanceId", "(", "id", ")", ";", "if", "(", "info", "!", "=", "null", ")", "{", "list", ".", "add", "(", "info", ")", ";", "return", "list", ";", "}", "}", "return", "list", ";", "}", "</s>"]
["<s>", "public", "Applications", "getApplicationDeltas", "(", ")", "{", "return", "this", ".", "applicationsDelta", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "void", "invalidate", "(", "String", "appName", ",", "@", "Nullable", "String", "vipAddress", ",", "@", "Nullable", "String", "secureVipAddress", ")", ";", "</s>"]
["<s>", "AtomicLong", "getVersionDelta", "(", ")", ";", "</s>"]
["<s>", "AtomicLong", "getVersionDeltaWithRegions", "(", ")", ";", "</s>"]
["<s>", "String", "get", "(", "Key", "key", ")", ";", "</s>"]
["<s>", "byte", "[", "]", "getGZIP", "(", "Key", "key", ")", ";", "</s>"]
["<s>", "void", "init", "(", "PeerEurekaNodes", "peerEurekaNodes", ")", "throws", "Exception", ";", "</s>"]
["<s>", "int", "syncUp", "(", ")", ";", "</s>"]
["<s>", "boolean", "shouldAllowAccess", "(", "boolean", "remoteRegionRequired", ")", ";", "</s>"]
["<s>", "void", "register", "(", "InstanceInfo", "info", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "void", "statusUpdate", "(", "final", "String", "asgName", ",", "final", "ASGResource", ".", "ASGStatus", "newStatus", ",", "final", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "public", "Key", "(", "EntityType", "entityType", ",", "String", "entityName", ",", "KeyType", "type", ",", "Version", "v", ",", "EurekaAccept", "eurekaAccept", ")", "{", "this", "(", "entityType", ",", "entityName", ",", "type", ",", "v", ",", "eurekaAccept", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Key", "(", "EntityType", "entityType", ",", "String", "entityName", ",", "KeyType", "type", ",", "Version", "v", ",", "EurekaAccept", "eurekaAccept", ",", "@", "Nullable", "String", "[", "]", "regions", ")", "{", "this", ".", "regions", "=", "regions", ";", "this", ".", "entityType", "=", "entityType", ";", "this", ".", "entityName", "=", "entityName", ";", "this", ".", "requestType", "=", "type", ";", "this", ".", "requestVersion", "=", "v", ";", "this", ".", "eurekaAccept", "=", "eurekaAccept", ";", "hashKey", "=", "this", ".", "entityType", "+", "this", ".", "entityName", "+", "(", "null", "!", "=", "this", ".", "regions", "?", "Arrays", ".", "toString", "(", "this", ".", "regions", ")", ":", "\"", "\"", ")", "+", "requestType", ".", "name", "(", ")", "+", "requestVersion", ".", "name", "(", ")", "+", "this", ".", "eurekaAccept", ".", "name", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getName", "(", ")", "{", "return", "entityName", ";", "}", "</s>"]
["<s>", "public", "String", "getHashKey", "(", ")", "{", "return", "hashKey", ";", "}", "</s>"]
["<s>", "public", "KeyType", "getType", "(", ")", "{", "return", "requestType", ";", "}", "</s>"]
["<s>", "public", "Version", "getVersion", "(", ")", "{", "return", "requestVersion", ";", "}", "</s>"]
["<s>", "public", "EurekaAccept", "getEurekaAccept", "(", ")", "{", "return", "eurekaAccept", ";", "}", "</s>"]
["<s>", "public", "EntityType", "getEntityType", "(", ")", "{", "return", "entityType", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasRegions", "(", ")", "{", "return", "null", "!", "=", "regions", "&", "&", "regions", ".", "length", "!", "=", "0", ";", "}", "</s>"]
["<s>", "public", "String", "[", "]", "getRegions", "(", ")", "{", "return", "regions", ";", "}", "</s>"]
["<s>", "public", "Key", "cloneWithoutRegions", "(", ")", "{", "return", "new", "Key", "(", "entityType", ",", "entityName", ",", "requestType", ",", "requestVersion", ",", "eurekaAccept", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "String", "hashKey", "=", "getHashKey", "(", ")", ";", "return", "hashKey", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "other", ")", "{", "if", "(", "other", "instanceof", "Key", ")", "{", "return", "getHashKey", "(", ")", ".", "equals", "(", "(", "(", "Key", ")", "other", ")", ".", "getHashKey", "(", ")", ")", ";", "}", "else", "{", "return", "false", ";", "}", "}", "</s>"]
["<s>", "public", "String", "toStringCompact", "(", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "entityName", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "entityType", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "requestType", ")", ";", "if", "(", "regions", "!", "=", "null", ")", "{", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "Arrays", ".", "toString", "(", "regions", ")", ")", ";", "}", "sb", ".", "append", "(", "<CHAR_LIT:}>", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "AwsInstanceRegistry", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "ServerCodecs", "serverCodecs", ",", "EurekaClient", "eurekaClient", ")", "{", "super", "(", "serverConfig", ",", "clientConfig", ",", "serverCodecs", ",", "eurekaClient", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", "PeerEurekaNodes", "peerEurekaNodes", ")", "throws", "Exception", "{", "super", ".", "init", "(", "peerEurekaNodes", ")", ";", "this", ".", "awsAsgUtil", "=", "new", "AwsAsgUtil", "(", "serverConfig", ",", "clientConfig", ",", "this", ")", ";", "}", "</s>"]
["<s>", "public", "AwsAsgUtil", "getAwsAsgUtil", "(", ")", "{", "return", "awsAsgUtil", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "InstanceInfo", ".", "InstanceStatus", "getOverriddenInstanceStatus", "(", "InstanceInfo", "r", ",", "Lease", "<", "InstanceInfo", ">", "existingLease", ",", "boolean", "isReplication", ")", "{", "if", "(", "(", "!", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ".", "equals", "(", "r", ".", "getStatus", "(", ")", ")", ")", "&", "&", "(", "!", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "equals", "(", "r", ".", "getStatus", "(", ")", ")", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getStatus", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "return", "r", ".", "getStatus", "(", ")", ";", "}", "InstanceInfo", ".", "InstanceStatus", "overridden", "=", "overriddenInstanceStatusMap", ".", "get", "(", "r", ".", "getId", "(", ")", ")", ";", "if", "(", "overridden", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getId", "(", ")", ",", "overridden", ".", "name", "(", ")", ")", ";", "return", "overridden", ";", "}", "boolean", "isASGDisabled", "=", "false", ";", "if", "(", "r", ".", "getASGName", "(", ")", "!", "=", "null", ")", "{", "isASGDisabled", "=", "!", "awsAsgUtil", ".", "isASGEnabled", "(", "r", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getASGName", "(", ")", ",", "isASGDisabled", ")", ";", "if", "(", "isASGDisabled", ")", "{", "return", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ";", "}", "else", "{", "return", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ";", "}", "}", "if", "(", "!", "isReplication", ")", "{", "InstanceInfo", ".", "InstanceStatus", "existingStatus", "=", "null", ";", "if", "(", "existingLease", "!", "=", "null", ")", "{", "existingStatus", "=", "existingLease", ".", "getHolder", "(", ")", ".", "getStatus", "(", ")", ";", "}", "if", "(", "(", "existingStatus", "!", "=", "null", ")", "&", "&", "(", "InstanceInfo", ".", "InstanceStatus", ".", "OUT_OF_SERVICE", ".", "equals", "(", "existingStatus", ")", "|", "|", "InstanceInfo", ".", "InstanceStatus", ".", "UP", ".", "equals", "(", "existingStatus", ")", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "existingLease", ".", "getHolder", "(", ")", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "existingLease", ".", "getHolder", "(", ")", ".", "getId", "(", ")", ")", ";", "return", "existingLease", ".", "getHolder", "(", ")", ".", "getStatus", "(", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getStatus", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "return", "r", ".", "getStatus", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "AbstractInstanceRegistry", "(", "EurekaServerConfig", "serverConfig", ",", "ServerCodecs", "serverCodecs", ")", "{", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "serverCodecs", "=", "serverCodecs", ";", "this", ".", "recentCanceledQueue", "=", "new", "CircularQueue", "<", "Pair", "<", "Long", ",", "String", ">", ">", "(", "<NUM_LIT:1000>", ")", ";", "this", ".", "recentRegisteredQueue", "=", "new", "CircularQueue", "<", "Pair", "<", "Long", ",", "String", ">", ">", "(", "<NUM_LIT:1000>", ")", ";", "this", ".", "deltaRetentionTimer", ".", "schedule", "(", "getDeltaRetentionTask", "(", ")", ",", "serverConfig", ".", "getDeltaRetentionTimerIntervalInMs", "(", ")", ",", "serverConfig", ".", "getDeltaRetentionTimerIntervalInMs", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "initializedResponseCache", "(", ")", "{", "if", "(", "responseCache", "=", "=", "null", ")", "{", "responseCache", "=", "new", "ResponseCacheImpl", "(", "serverConfig", ",", "serverCodecs", ",", "this", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "initRemoteRegionRegistry", "(", ")", "throws", "MalformedURLException", "{", "Map", "<", "String", ",", "String", ">", "remoteRegionUrlsWithName", "=", "serverConfig", ".", "getRemoteRegionUrlsWithName", "(", ")", ";", "if", "(", "remoteRegionUrlsWithName", "!", "=", "null", ")", "{", "allKnownRemoteRegions", "=", "new", "String", "[", "remoteRegionUrlsWithName", ".", "size", "(", ")", "]", ";", "int", "remoteRegionArrayIndex", "=", "0", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "String", ">", "remoteRegionUrlWithName", ":", "remoteRegionUrlsWithName", ".", "entrySet", "(", ")", ")", "{", "RemoteRegionRegistry", "remoteRegionRegistry", "=", "new", "RemoteRegionRegistry", "(", "serverConfig", ",", "serverCodecs", ",", "remoteRegionUrlWithName", ".", "getKey", "(", ")", ",", "new", "URL", "(", "remoteRegionUrlWithName", ".", "getValue", "(", ")", ")", ")", ";", "regionNameVSRemoteRegistry", ".", "put", "(", "remoteRegionUrlWithName", ".", "getKey", "(", ")", ",", "remoteRegionRegistry", ")", ";", "allKnownRemoteRegions", "[", "remoteRegionArrayIndex", "+", "+", "]", "=", "remoteRegionUrlWithName", ".", "getKey", "(", ")", ";", "}", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "allKnownRemoteRegions", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ResponseCache", "getResponseCache", "(", ")", "{", "return", "responseCache", ";", "}", "</s>"]
["<s>", "public", "long", "getLocalRegistrySize", "(", ")", "{", "long", "total", "=", "0", ";", "for", "(", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "entry", ":", "registry", ".", "values", "(", ")", ")", "{", "total", "+", "=", "entry", ".", "size", "(", ")", ";", "}", "return", "total", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clearRegistry", "(", ")", "{", "overriddenInstanceStatusMap", ".", "clear", "(", ")", ";", "recentCanceledQueue", ".", "clear", "(", ")", ";", "recentRegisteredQueue", ".", "clear", "(", ")", ";", "recentlyChangedQueue", ".", "clear", "(", ")", ";", "registry", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "InstanceStatus", ">", "overriddenInstanceStatusesSnapshot", "(", ")", "{", "return", "new", "HashMap", "<", ">", "(", "overriddenInstanceStatusMap", ")", ";", "}", "</s>"]
["<s>", "public", "void", "register", "(", "InstanceInfo", "r", ",", "int", "leaseDuration", ",", "boolean", "isReplication", ")", "{", "try", "{", "read", ".", "lock", "(", ")", ";", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "gMap", "=", "registry", ".", "get", "(", "r", ".", "getAppName", "(", ")", ")", ";", "REGISTER", ".", "increment", "(", "isReplication", ")", ";", "if", "(", "gMap", "=", "=", "null", ")", "{", "final", "ConcurrentHashMap", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "gNewMap", "=", "new", "ConcurrentHashMap", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "(", ")", ";", "gMap", "=", "registry", ".", "putIfAbsent", "(", "r", ".", "getAppName", "(", ")", ",", "gNewMap", ")", ";", "if", "(", "gMap", "=", "=", "null", ")", "{", "gMap", "=", "gNewMap", ";", "}", "}", "Lease", "<", "InstanceInfo", ">", "existingLease", "=", "gMap", ".", "get", "(", "r", ".", "getId", "(", ")", ")", ";", "if", "(", "existingLease", "!", "=", "null", "&", "&", "(", "existingLease", ".", "getHolder", "(", ")", "!", "=", "null", ")", ")", "{", "Long", "existingLastDirtyTimestamp", "=", "existingLease", ".", "getHolder", "(", ")", ".", "getLastDirtyTimestamp", "(", ")", ";", "Long", "registrationLastDirtyTimestamp", "=", "r", ".", "getLastDirtyTimestamp", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "existingLastDirtyTimestamp", ",", "registrationLastDirtyTimestamp", ")", ";", "if", "(", "existingLastDirtyTimestamp", ">", "registrationLastDirtyTimestamp", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "existingLastDirtyTimestamp", ",", "registrationLastDirtyTimestamp", ")", ";", "r", ".", "setLastDirtyTimestamp", "(", "existingLastDirtyTimestamp", ")", ";", "}", "}", "else", "{", "synchronized", "(", "lock", ")", "{", "if", "(", "this", ".", "expectedNumberOfRenewsPerMin", ">", "0", ")", "{", "this", ".", "expectedNumberOfRenewsPerMin", "=", "this", ".", "expectedNumberOfRenewsPerMin", "+", "<NUM_LIT:2>", ";", "this", ".", "numberOfRenewsPerMinThreshold", "=", "(", "int", ")", "(", "this", ".", "expectedNumberOfRenewsPerMin", "*", "serverConfig", ".", "getRenewalPercentThreshold", "(", ")", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Lease", "<", "InstanceInfo", ">", "lease", "=", "new", "Lease", "<", "InstanceInfo", ">", "(", "r", ",", "leaseDuration", ")", ";", "if", "(", "existingLease", "!", "=", "null", ")", "{", "lease", ".", "setServiceUpTimestamp", "(", "existingLease", ".", "getServiceUpTimestamp", "(", ")", ")", ";", "}", "gMap", ".", "put", "(", "r", ".", "getId", "(", ")", ",", "lease", ")", ";", "synchronized", "(", "recentRegisteredQueue", ")", "{", "recentRegisteredQueue", ".", "add", "(", "new", "Pair", "<", "Long", ",", "String", ">", "(", "System", ".", "currentTimeMillis", "(", ")", ",", "r", ".", "getAppName", "(", ")", "+", "\"", "<STR_LIT:(>", "\"", "+", "r", ".", "getId", "(", ")", "+", "\"", "<STR_LIT:)>", "\"", ")", ")", ";", "}", "if", "(", "!", "InstanceStatus", ".", "UNKNOWN", ".", "equals", "(", "r", ".", "getOverriddenStatus", "(", ")", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getOverriddenStatus", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "if", "(", "!", "overriddenInstanceStatusMap", ".", "containsKey", "(", "r", ".", "getId", "(", ")", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getId", "(", ")", ")", ";", "overriddenInstanceStatusMap", ".", "put", "(", "r", ".", "getId", "(", ")", ",", "r", ".", "getOverriddenStatus", "(", ")", ")", ";", "}", "}", "InstanceStatus", "overriddenStatusFromMap", "=", "overriddenInstanceStatusMap", ".", "get", "(", "r", ".", "getId", "(", ")", ")", ";", "if", "(", "overriddenStatusFromMap", "!", "=", "null", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "overriddenStatusFromMap", ")", ";", "r", ".", "setOverriddenStatus", "(", "overriddenStatusFromMap", ")", ";", "}", "InstanceStatus", "overriddenInstanceStatus", "=", "getOverriddenInstanceStatus", "(", "r", ",", "existingLease", ",", "isReplication", ")", ";", "r", ".", "setStatusWithoutDirty", "(", "overriddenInstanceStatus", ")", ";", "if", "(", "InstanceStatus", ".", "UP", ".", "equals", "(", "r", ".", "getStatus", "(", ")", ")", ")", "{", "lease", ".", "serviceUp", "(", ")", ";", "}", "r", ".", "setActionType", "(", "ActionType", ".", "ADDED", ")", ";", "recentlyChangedQueue", ".", "add", "(", "new", "RecentlyChangedItem", "(", "lease", ")", ")", ";", "r", ".", "setLastUpdatedTimestamp", "(", ")", ";", "invalidateCache", "(", "r", ".", "getAppName", "(", ")", ",", "r", ".", "getVIPAddress", "(", ")", ",", "r", ".", "getSecureVipAddress", "(", ")", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "r", ".", "getAppName", "(", ")", ",", "r", ".", "getId", "(", ")", ",", "r", ".", "getStatus", "(", ")", ",", "isReplication", ")", ";", "}", "finally", "{", "read", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "cancel", "(", "String", "appName", ",", "String", "id", ",", "boolean", "isReplication", ")", "{", "return", "internalCancel", "(", "appName", ",", "id", ",", "isReplication", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "internalCancel", "(", "String", "appName", ",", "String", "id", ",", "boolean", "isReplication", ")", "{", "try", "{", "read", ".", "lock", "(", ")", ";", "CANCEL", ".", "increment", "(", "isReplication", ")", ";", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "gMap", "=", "registry", ".", "get", "(", "appName", ")", ";", "Lease", "<", "InstanceInfo", ">", "leaseToCancel", "=", "null", ";", "if", "(", "gMap", "!", "=", "null", ")", "{", "leaseToCancel", "=", "gMap", ".", "remove", "(", "id", ")", ";", "}", "synchronized", "(", "recentCanceledQueue", ")", "{", "recentCanceledQueue", ".", "add", "(", "new", "Pair", "<", "Long", ",", "String", ">", "(", "System", ".", "currentTimeMillis", "(", ")", ",", "appName", "+", "\"", "<STR_LIT:(>", "\"", "+", "id", "+", "\"", "<STR_LIT:)>", "\"", ")", ")", ";", "}", "InstanceStatus", "instanceStatus", "=", "overriddenInstanceStatusMap", ".", "remove", "(", "id", ")", ";", "if", "(", "instanceStatus", "!", "=", "null", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "instanceStatus", ".", "name", "(", ")", ")", ";", "}", "if", "(", "leaseToCancel", "=", "=", "null", ")", "{", "CANCEL_NOT_FOUND", ".", "increment", "(", "isReplication", ")", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ")", ";", "return", "false", ";", "}", "else", "{", "leaseToCancel", ".", "cancel", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "leaseToCancel", ".", "getHolder", "(", ")", ";", "String", "vip", "=", "null", ";", "String", "svip", "=", "null", ";", "if", "(", "instanceInfo", "!", "=", "null", ")", "{", "instanceInfo", ".", "setActionType", "(", "ActionType", ".", "DELETED", ")", ";", "recentlyChangedQueue", ".", "add", "(", "new", "RecentlyChangedItem", "(", "leaseToCancel", ")", ")", ";", "instanceInfo", ".", "setLastUpdatedTimestamp", "(", ")", ";", "vip", "=", "instanceInfo", ".", "getVIPAddress", "(", ")", ";", "svip", "=", "instanceInfo", ".", "getSecureVipAddress", "(", ")", ";", "}", "invalidateCache", "(", "appName", ",", "vip", ",", "svip", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ",", "isReplication", ")", ";", "return", "true", ";", "}", "}", "finally", "{", "read", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "renew", "(", "String", "appName", ",", "String", "id", ",", "boolean", "isReplication", ")", "{", "RENEW", ".", "increment", "(", "isReplication", ")", ";", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "gMap", "=", "registry", ".", "get", "(", "appName", ")", ";", "Lease", "<", "InstanceInfo", ">", "leaseToRenew", "=", "null", ";", "if", "(", "gMap", "!", "=", "null", ")", "{", "leaseToRenew", "=", "gMap", ".", "get", "(", "id", ")", ";", "}", "if", "(", "leaseToRenew", "=", "=", "null", ")", "{", "RENEW_NOT_FOUND", ".", "increment", "(", "isReplication", ")", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ")", ";", "return", "false", ";", "}", "else", "{", "InstanceInfo", "instanceInfo", "=", "leaseToRenew", ".", "getHolder", "(", ")", ";", "if", "(", "instanceInfo", "!", "=", "null", ")", "{", "InstanceStatus", "overriddenInstanceStatus", "=", "this", ".", "getOverriddenInstanceStatus", "(", "instanceInfo", ",", "leaseToRenew", ",", "isReplication", ")", ";", "if", "(", "overriddenInstanceStatus", "=", "=", "InstanceStatus", ".", "UNKNOWN", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "instanceInfo", ".", "getId", "(", ")", ")", ";", "RENEW_NOT_FOUND", ".", "increment", "(", "isReplication", ")", ";", "return", "false", ";", "}", "if", "(", "!", "instanceInfo", ".", "getStatus", "(", ")", ".", "equals", "(", "overriddenInstanceStatus", ")", ")", "{", "Object", "[", "]", "args", "=", "{", "instanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instanceInfo", ".", "getOverriddenStatus", "(", ")", ".", "name", "(", ")", ",", "instanceInfo", ".", "getId", "(", ")", "}", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "instanceInfo", ".", "setStatus", "(", "overriddenInstanceStatus", ")", ";", "}", "}", "renewsLastMin", ".", "increment", "(", ")", ";", "leaseToRenew", ".", "renew", "(", ")", ";", "return", "true", ";", "}", "}", "</s>"]
["<s>", "@", "Deprecated", "@", "Override", "public", "void", "storeOverriddenStatusIfRequired", "(", "String", "id", ",", "InstanceStatus", "overriddenStatus", ")", "{", "InstanceStatus", "instanceStatus", "=", "overriddenInstanceStatusMap", ".", "get", "(", "id", ")", ";", "if", "(", "(", "instanceStatus", "=", "=", "null", ")", "|", "|", "(", "!", "overriddenStatus", ".", "equals", "(", "instanceStatus", ")", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "overriddenStatus", ".", "name", "(", ")", ")", ";", "overriddenInstanceStatusMap", ".", "put", "(", "id", ",", "overriddenStatus", ")", ";", "List", "<", "InstanceInfo", ">", "instanceInfo", "=", "this", ".", "getInstancesById", "(", "id", ",", "false", ")", ";", "if", "(", "(", "instanceInfo", "!", "=", "null", ")", "&", "&", "(", "!", "instanceInfo", ".", "isEmpty", "(", ")", ")", ")", "{", "instanceInfo", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "setOverriddenStatus", "(", "overriddenStatus", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "overriddenStatus", ".", "name", "(", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "storeOverriddenStatusIfRequired", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "overriddenStatus", ")", "{", "InstanceStatus", "instanceStatus", "=", "overriddenInstanceStatusMap", ".", "get", "(", "id", ")", ";", "if", "(", "(", "instanceStatus", "=", "=", "null", ")", "|", "|", "(", "!", "overriddenStatus", ".", "equals", "(", "instanceStatus", ")", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "overriddenStatus", ".", "name", "(", ")", ")", ";", "overriddenInstanceStatusMap", ".", "put", "(", "id", ",", "overriddenStatus", ")", ";", "InstanceInfo", "instanceInfo", "=", "this", ".", "getInstanceByAppAndId", "(", "appName", ",", "id", ",", "false", ")", ";", "instanceInfo", ".", "setOverriddenStatus", "(", "overriddenStatus", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ",", "overriddenStatus", ".", "name", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "statusUpdate", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "String", "lastDirtyTimestamp", ",", "boolean", "isReplication", ")", "{", "try", "{", "read", ".", "lock", "(", ")", ";", "STATUS_UPDATE", ".", "increment", "(", "isReplication", ")", ";", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "gMap", "=", "registry", ".", "get", "(", "appName", ")", ";", "Lease", "<", "InstanceInfo", ">", "lease", "=", "null", ";", "if", "(", "gMap", "!", "=", "null", ")", "{", "lease", "=", "gMap", ".", "get", "(", "id", ")", ";", "}", "if", "(", "lease", "=", "=", "null", ")", "{", "return", "false", ";", "}", "else", "{", "lease", ".", "renew", "(", ")", ";", "InstanceInfo", "info", "=", "lease", ".", "getHolder", "(", ")", ";", "if", "(", "info", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "}", "if", "(", "(", "info", "!", "=", "null", ")", "&", "&", "!", "(", "info", ".", "getStatus", "(", ")", ".", "equals", "(", "newStatus", ")", ")", ")", "{", "if", "(", "InstanceStatus", ".", "UP", ".", "equals", "(", "newStatus", ")", ")", "{", "lease", ".", "serviceUp", "(", ")", ";", "}", "overriddenInstanceStatusMap", ".", "put", "(", "id", ",", "newStatus", ")", ";", "info", ".", "setOverriddenStatus", "(", "newStatus", ")", ";", "long", "replicaDirtyTimestamp", "=", "0", ";", "if", "(", "lastDirtyTimestamp", "!", "=", "null", ")", "{", "replicaDirtyTimestamp", "=", "Long", ".", "valueOf", "(", "lastDirtyTimestamp", ")", ";", "}", "if", "(", "replicaDirtyTimestamp", ">", "info", ".", "getLastDirtyTimestamp", "(", ")", ")", "{", "info", ".", "setLastDirtyTimestamp", "(", "replicaDirtyTimestamp", ")", ";", "info", ".", "setStatusWithoutDirty", "(", "newStatus", ")", ";", "}", "else", "{", "info", ".", "setStatus", "(", "newStatus", ")", ";", "}", "info", ".", "setActionType", "(", "ActionType", ".", "MODIFIED", ")", ";", "recentlyChangedQueue", ".", "add", "(", "new", "RecentlyChangedItem", "(", "lease", ")", ")", ";", "info", ".", "setLastUpdatedTimestamp", "(", ")", ";", "invalidateCache", "(", "appName", ",", "info", ".", "getVIPAddress", "(", ")", ",", "info", ".", "getSecureVipAddress", "(", ")", ")", ";", "}", "return", "true", ";", "}", "}", "finally", "{", "read", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "deleteStatusOverride", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "String", "lastDirtyTimestamp", ",", "boolean", "isReplication", ")", "{", "try", "{", "read", ".", "lock", "(", ")", ";", "STATUS_OVERRIDE_DELETE", ".", "increment", "(", "isReplication", ")", ";", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "gMap", "=", "registry", ".", "get", "(", "appName", ")", ";", "Lease", "<", "InstanceInfo", ">", "lease", "=", "null", ";", "if", "(", "gMap", "!", "=", "null", ")", "{", "lease", "=", "gMap", ".", "get", "(", "id", ")", ";", "}", "if", "(", "lease", "=", "=", "null", ")", "{", "return", "false", ";", "}", "else", "{", "lease", ".", "renew", "(", ")", ";", "InstanceInfo", "info", "=", "lease", ".", "getHolder", "(", ")", ";", "if", "(", "info", "=", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "}", "InstanceStatus", "currentOverride", "=", "overriddenInstanceStatusMap", ".", "remove", "(", "id", ")", ";", "if", "(", "currentOverride", "!", "=", "null", "&", "&", "info", "!", "=", "null", ")", "{", "info", ".", "setOverriddenStatus", "(", "InstanceStatus", ".", "UNKNOWN", ")", ";", "info", ".", "setStatus", "(", "newStatus", ")", ";", "long", "replicaDirtyTimestamp", "=", "0", ";", "if", "(", "lastDirtyTimestamp", "!", "=", "null", ")", "{", "replicaDirtyTimestamp", "=", "Long", ".", "valueOf", "(", "lastDirtyTimestamp", ")", ";", "}", "if", "(", "replicaDirtyTimestamp", ">", "info", ".", "getLastDirtyTimestamp", "(", ")", ")", "{", "info", ".", "setLastDirtyTimestamp", "(", "replicaDirtyTimestamp", ")", ";", "}", "info", ".", "setActionType", "(", "ActionType", ".", "MODIFIED", ")", ";", "recentlyChangedQueue", ".", "add", "(", "new", "RecentlyChangedItem", "(", "lease", ")", ")", ";", "info", ".", "setLastUpdatedTimestamp", "(", ")", ";", "invalidateCache", "(", "appName", ",", "info", ".", "getVIPAddress", "(", ")", ",", "info", ".", "getSecureVipAddress", "(", ")", ")", ";", "}", "return", "true", ";", "}", "}", "finally", "{", "read", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "evict", "(", ")", "{", "evict", "(", "0", "l", ")", ";", "}", "</s>"]
["<s>", "public", "void", "evict", "(", "long", "additionalLeaseMs", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "!", "isLeaseExpirationEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "List", "<", "Lease", "<", "InstanceInfo", ">", ">", "expiredLeases", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", "Entry", "<", "String", ",", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", ">", "groupEntry", ":", "registry", ".", "entrySet", "(", ")", ")", "{", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "leaseMap", "=", "groupEntry", ".", "getValue", "(", ")", ";", "if", "(", "leaseMap", "!", "=", "null", ")", "{", "for", "(", "Entry", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "leaseEntry", ":", "leaseMap", ".", "entrySet", "(", ")", ")", "{", "Lease", "<", "InstanceInfo", ">", "lease", "=", "leaseEntry", ".", "getValue", "(", ")", ";", "if", "(", "lease", ".", "isExpired", "(", "additionalLeaseMs", ")", "&", "&", "lease", ".", "getHolder", "(", ")", "!", "=", "null", ")", "{", "expiredLeases", ".", "add", "(", "lease", ")", ";", "}", "}", "}", "}", "boolean", "experimental", "=", "\"", "<STR_LIT>", "\"", ".", "equalsIgnoreCase", "(", "serverConfig", ".", "getExperimental", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "int", "registrySize", "=", "(", "int", ")", "getLocalRegistrySize", "(", ")", ";", "int", "registrySizeThreshold", "=", "(", "int", ")", "(", "registrySize", "*", "serverConfig", ".", "getRenewalPercentThreshold", "(", ")", ")", ";", "int", "evictionLimit", "=", "registrySize", "-", "registrySizeThreshold", ";", "int", "toEvict", "=", "Math", ".", "min", "(", "expiredLeases", ".", "size", "(", ")", ",", "evictionLimit", ")", ";", "if", "(", "toEvict", ">", "0", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "toEvict", ",", "expiredLeases", ".", "size", "(", ")", ",", "evictionLimit", ")", ";", "Random", "random", "=", "new", "Random", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "toEvict", ";", "i", "+", "+", ")", "{", "int", "next", "=", "i", "+", "random", ".", "nextInt", "(", "expiredLeases", ".", "size", "(", ")", "-", "i", ")", ";", "Collections", ".", "swap", "(", "expiredLeases", ",", "i", ",", "next", ")", ";", "Lease", "<", "InstanceInfo", ">", "lease", "=", "expiredLeases", ".", "get", "(", "i", ")", ";", "String", "appName", "=", "lease", ".", "getHolder", "(", ")", ".", "getAppName", "(", ")", ";", "String", "id", "=", "lease", ".", "getHolder", "(", ")", ".", "getId", "(", ")", ";", "EXPIRED", ".", "increment", "(", ")", ";", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "appName", ",", "id", ")", ";", "if", "(", "experimental", ")", "{", "internalCancel", "(", "appName", ",", "id", ",", "false", ")", ";", "}", "else", "{", "cancel", "(", "appName", ",", "id", ",", "false", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Application", "getApplication", "(", "String", "appName", ")", "{", "boolean", "disableTransparentFallback", "=", "serverConfig", ".", "disableTransparentFallbackToOtherRegion", "(", ")", ";", "return", "this", ".", "getApplication", "(", "appName", ",", "!", "disableTransparentFallback", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Application", "getApplication", "(", "String", "appName", ",", "boolean", "includeRemoteRegion", ")", "{", "Application", "app", "=", "null", ";", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "leaseMap", "=", "registry", ".", "get", "(", "appName", ")", ";", "if", "(", "leaseMap", "!", "=", "null", "&", "&", "leaseMap", ".", "size", "(", ")", ">", "0", ")", "{", "for", "(", "Entry", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "entry", ":", "leaseMap", ".", "entrySet", "(", ")", ")", "{", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "appName", ")", ";", "}", "app", ".", "addInstance", "(", "decorateInstanceInfo", "(", "entry", ".", "getValue", "(", ")", ")", ")", ";", "}", "}", "else", "if", "(", "includeRemoteRegion", ")", "{", "for", "(", "RemoteRegionRegistry", "remoteRegistry", ":", "this", ".", "regionNameVSRemoteRegistry", ".", "values", "(", ")", ")", "{", "Application", "application", "=", "remoteRegistry", ".", "getApplication", "(", "appName", ")", ";", "if", "(", "application", "!", "=", "null", ")", "{", "return", "application", ";", "}", "}", "}", "return", "app", ";", "}", "</s>"]
["<s>", "public", "Applications", "getApplications", "(", ")", "{", "boolean", "disableTransparentFallback", "=", "serverConfig", ".", "disableTransparentFallbackToOtherRegion", "(", ")", ";", "if", "(", "disableTransparentFallback", ")", "{", "return", "getApplicationsFromLocalRegionOnly", "(", ")", ";", "}", "else", "{", "return", "getApplicationsFromAllRemoteRegions", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Applications", "getApplicationsFromAllRemoteRegions", "(", ")", "{", "return", "getApplicationsFromMultipleRegions", "(", "allKnownRemoteRegions", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Applications", "getApplicationsFromLocalRegionOnly", "(", ")", "{", "return", "getApplicationsFromMultipleRegions", "(", "EMPTY_STR_ARRAY", ")", ";", "}", "</s>"]
["<s>", "public", "Applications", "getApplicationsFromMultipleRegions", "(", "String", "[", "]", "remoteRegions", ")", "{", "boolean", "includeRemoteRegion", "=", "null", "!", "=", "remoteRegions", "&", "&", "remoteRegions", ".", "length", "!", "=", "0", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "includeRemoteRegion", ",", "Arrays", ".", "toString", "(", "remoteRegions", ")", ")", ";", "if", "(", "includeRemoteRegion", ")", "{", "GET_ALL_WITH_REMOTE_REGIONS_CACHE_MISS", ".", "increment", "(", ")", ";", "}", "else", "{", "GET_ALL_CACHE_MISS", ".", "increment", "(", ")", ";", "}", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "<NUM_LIT>", ")", ";", "for", "(", "Entry", "<", "String", ",", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", ">", "entry", ":", "registry", ".", "entrySet", "(", ")", ")", "{", "Application", "app", "=", "null", ";", "if", "(", "entry", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "for", "(", "Entry", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "stringLeaseEntry", ":", "entry", ".", "getValue", "(", ")", ".", "entrySet", "(", ")", ")", "{", "Lease", "<", "InstanceInfo", ">", "lease", "=", "stringLeaseEntry", ".", "getValue", "(", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "lease", ".", "getHolder", "(", ")", ".", "getAppName", "(", ")", ")", ";", "}", "app", ".", "addInstance", "(", "decorateInstanceInfo", "(", "lease", ")", ")", ";", "}", "}", "if", "(", "app", "!", "=", "null", ")", "{", "apps", ".", "addApplication", "(", "app", ")", ";", "}", "}", "if", "(", "includeRemoteRegion", ")", "{", "for", "(", "String", "remoteRegion", ":", "remoteRegions", ")", "{", "RemoteRegionRegistry", "remoteRegistry", "=", "regionNameVSRemoteRegistry", ".", "get", "(", "remoteRegion", ")", ";", "if", "(", "null", "!", "=", "remoteRegistry", ")", "{", "Applications", "remoteApps", "=", "remoteRegistry", ".", "getApplications", "(", ")", ";", "for", "(", "Application", "application", ":", "remoteApps", ".", "getRegisteredApplications", "(", ")", ")", "{", "if", "(", "shouldFetchFromRemoteRegistry", "(", "application", ".", "getName", "(", ")", ",", "remoteRegion", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "application", ".", "getName", "(", ")", ",", "remoteRegion", ")", ";", "Application", "appInstanceTillNow", "=", "apps", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "if", "(", "appInstanceTillNow", "=", "=", "null", ")", "{", "appInstanceTillNow", "=", "new", "Application", "(", "application", ".", "getName", "(", ")", ")", ";", "apps", ".", "addApplication", "(", "appInstanceTillNow", ")", ";", "}", "for", "(", "InstanceInfo", "instanceInfo", ":", "application", ".", "getInstances", "(", ")", ")", "{", "appInstanceTillNow", ".", "addInstance", "(", "instanceInfo", ")", ";", "}", "}", "else", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "application", ".", "getName", "(", ")", ",", "remoteRegion", ")", ";", "}", "}", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "remoteRegion", ")", ";", "}", "}", "}", "apps", ".", "setAppsHashCode", "(", "apps", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "apps", ";", "}", "</s>"]
["<s>", "private", "boolean", "shouldFetchFromRemoteRegistry", "(", "String", "appName", ",", "String", "remoteRegion", ")", "{", "Set", "<", "String", ">", "whiteList", "=", "serverConfig", ".", "getRemoteRegionAppWhitelist", "(", "remoteRegion", ")", ";", "if", "(", "null", "=", "=", "whiteList", ")", "{", "whiteList", "=", "serverConfig", ".", "getRemoteRegionAppWhitelist", "(", "null", ")", ";", "}", "return", "null", "=", "=", "whiteList", "|", "|", "whiteList", ".", "contains", "(", "appName", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "Applications", "getApplications", "(", "boolean", "includeRemoteRegion", ")", "{", "GET_ALL_CACHE_MISS", ".", "increment", "(", ")", ";", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "<NUM_LIT>", ")", ";", "for", "(", "Entry", "<", "String", ",", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", ">", "entry", ":", "registry", ".", "entrySet", "(", ")", ")", "{", "Application", "app", "=", "null", ";", "if", "(", "entry", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "for", "(", "Entry", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "stringLeaseEntry", ":", "entry", ".", "getValue", "(", ")", ".", "entrySet", "(", ")", ")", "{", "Lease", "<", "InstanceInfo", ">", "lease", "=", "stringLeaseEntry", ".", "getValue", "(", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "lease", ".", "getHolder", "(", ")", ".", "getAppName", "(", ")", ")", ";", "}", "app", ".", "addInstance", "(", "decorateInstanceInfo", "(", "lease", ")", ")", ";", "}", "}", "if", "(", "app", "!", "=", "null", ")", "{", "apps", ".", "addApplication", "(", "app", ")", ";", "}", "}", "if", "(", "includeRemoteRegion", ")", "{", "for", "(", "RemoteRegionRegistry", "remoteRegistry", ":", "this", ".", "regionNameVSRemoteRegistry", ".", "values", "(", ")", ")", "{", "Applications", "applications", "=", "remoteRegistry", ".", "getApplications", "(", ")", ";", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "appInLocalRegistry", "=", "apps", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "if", "(", "appInLocalRegistry", "=", "=", "null", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "}", "}", "}", "apps", ".", "setAppsHashCode", "(", "apps", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "apps", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "Applications", "getApplicationDeltas", "(", ")", "{", "GET_ALL_CACHE_MISS_DELTA", ".", "increment", "(", ")", ";", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "responseCache", ".", "getVersionDelta", "(", ")", ".", "get", "(", ")", ")", ";", "Map", "<", "String", ",", "Application", ">", "applicationInstancesMap", "=", "new", "HashMap", "<", "String", ",", "Application", ">", "(", ")", ";", "try", "{", "write", ".", "lock", "(", ")", ";", "Iterator", "<", "RecentlyChangedItem", ">", "iter", "=", "this", ".", "recentlyChangedQueue", ".", "iterator", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "this", ".", "recentlyChangedQueue", ".", "size", "(", ")", ")", ";", "while", "(", "iter", ".", "hasNext", "(", ")", ")", "{", "Lease", "<", "InstanceInfo", ">", "lease", "=", "iter", ".", "next", "(", ")", ".", "getLeaseInfo", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "lease", ".", "getHolder", "(", ")", ";", "Object", "[", "]", "args", "=", "{", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instanceInfo", ".", "getActionType", "(", ")", ".", "name", "(", ")", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "Application", "app", "=", "applicationInstancesMap", ".", "get", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "applicationInstancesMap", ".", "put", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "app", ")", ";", "apps", ".", "addApplication", "(", "app", ")", ";", "}", "app", ".", "addInstance", "(", "decorateInstanceInfo", "(", "lease", ")", ")", ";", "}", "boolean", "disableTransparentFallback", "=", "serverConfig", ".", "disableTransparentFallbackToOtherRegion", "(", ")", ";", "if", "(", "!", "disableTransparentFallback", ")", "{", "Applications", "allAppsInLocalRegion", "=", "getApplications", "(", "false", ")", ";", "for", "(", "RemoteRegionRegistry", "remoteRegistry", ":", "this", ".", "regionNameVSRemoteRegistry", ".", "values", "(", ")", ")", "{", "Applications", "applications", "=", "remoteRegistry", ".", "getApplicationDeltas", "(", ")", ";", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "appInLocalRegistry", "=", "allAppsInLocalRegion", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "if", "(", "appInLocalRegistry", "=", "=", "null", ")", "{", "apps", ".", "addApplication", "(", "application", ")", ";", "}", "}", "}", "}", "Applications", "allApps", "=", "getApplications", "(", "!", "disableTransparentFallback", ")", ";", "apps", ".", "setAppsHashCode", "(", "allApps", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "apps", ";", "}", "finally", "{", "write", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Applications", "getApplicationDeltasFromMultipleRegions", "(", "String", "[", "]", "remoteRegions", ")", "{", "if", "(", "null", "=", "=", "remoteRegions", ")", "{", "remoteRegions", "=", "allKnownRemoteRegions", ";", "}", "boolean", "includeRemoteRegion", "=", "remoteRegions", ".", "length", "!", "=", "0", ";", "if", "(", "includeRemoteRegion", ")", "{", "GET_ALL_WITH_REMOTE_REGIONS_CACHE_MISS_DELTA", ".", "increment", "(", ")", ";", "}", "else", "{", "GET_ALL_CACHE_MISS_DELTA", ".", "increment", "(", ")", ";", "}", "Applications", "apps", "=", "new", "Applications", "(", ")", ";", "apps", ".", "setVersion", "(", "responseCache", ".", "getVersionDeltaWithRegions", "(", ")", ".", "get", "(", ")", ")", ";", "Map", "<", "String", ",", "Application", ">", "applicationInstancesMap", "=", "new", "HashMap", "<", "String", ",", "Application", ">", "(", ")", ";", "try", "{", "write", ".", "lock", "(", ")", ";", "Iterator", "<", "RecentlyChangedItem", ">", "iter", "=", "this", ".", "recentlyChangedQueue", ".", "iterator", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "this", ".", "recentlyChangedQueue", ".", "size", "(", ")", ")", ";", "while", "(", "iter", ".", "hasNext", "(", ")", ")", "{", "Lease", "<", "InstanceInfo", ">", "lease", "=", "iter", ".", "next", "(", ")", ".", "getLeaseInfo", "(", ")", ";", "InstanceInfo", "instanceInfo", "=", "lease", ".", "getHolder", "(", ")", ";", "Object", "[", "]", "args", "=", "{", "instanceInfo", ".", "getId", "(", ")", ",", "instanceInfo", ".", "getStatus", "(", ")", ".", "name", "(", ")", ",", "instanceInfo", ".", "getActionType", "(", ")", ".", "name", "(", ")", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "Application", "app", "=", "applicationInstancesMap", ".", "get", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "if", "(", "app", "=", "=", "null", ")", "{", "app", "=", "new", "Application", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "applicationInstancesMap", ".", "put", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "app", ")", ";", "apps", ".", "addApplication", "(", "app", ")", ";", "}", "app", ".", "addInstance", "(", "decorateInstanceInfo", "(", "lease", ")", ")", ";", "}", "if", "(", "includeRemoteRegion", ")", "{", "for", "(", "String", "remoteRegion", ":", "remoteRegions", ")", "{", "RemoteRegionRegistry", "remoteRegistry", "=", "regionNameVSRemoteRegistry", ".", "get", "(", "remoteRegion", ")", ";", "if", "(", "null", "!", "=", "remoteRegistry", ")", "{", "Applications", "remoteAppsDelta", "=", "remoteRegistry", ".", "getApplicationDeltas", "(", ")", ";", "if", "(", "null", "!", "=", "remoteAppsDelta", ")", "{", "for", "(", "Application", "application", ":", "remoteAppsDelta", ".", "getRegisteredApplications", "(", ")", ")", "{", "if", "(", "shouldFetchFromRemoteRegistry", "(", "application", ".", "getName", "(", ")", ",", "remoteRegion", ")", ")", "{", "Application", "appInstanceTillNow", "=", "apps", ".", "getRegisteredApplications", "(", "application", ".", "getName", "(", ")", ")", ";", "if", "(", "appInstanceTillNow", "=", "=", "null", ")", "{", "appInstanceTillNow", "=", "new", "Application", "(", "application", ".", "getName", "(", ")", ")", ";", "apps", ".", "addApplication", "(", "appInstanceTillNow", ")", ";", "}", "for", "(", "InstanceInfo", "instanceInfo", ":", "application", ".", "getInstances", "(", ")", ")", "{", "appInstanceTillNow", ".", "addInstance", "(", "instanceInfo", ")", ";", "}", "}", "}", "}", "}", "}", "}", "Applications", "allApps", "=", "getApplicationsFromMultipleRegions", "(", "remoteRegions", ")", ";", "apps", ".", "setAppsHashCode", "(", "allApps", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "apps", ";", "}", "finally", "{", "write", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "getInstanceByAppAndId", "(", "String", "appName", ",", "String", "id", ")", "{", "return", "this", ".", "getInstanceByAppAndId", "(", "appName", ",", "id", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "getInstanceByAppAndId", "(", "String", "appName", ",", "String", "id", ",", "boolean", "includeRemoteRegions", ")", "{", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "leaseMap", "=", "registry", ".", "get", "(", "appName", ")", ";", "Lease", "<", "InstanceInfo", ">", "lease", "=", "null", ";", "if", "(", "leaseMap", "!", "=", "null", ")", "{", "lease", "=", "leaseMap", ".", "get", "(", "id", ")", ";", "}", "if", "(", "lease", "!", "=", "null", "&", "&", "(", "!", "isLeaseExpirationEnabled", "(", ")", "|", "|", "!", "lease", ".", "isExpired", "(", ")", ")", ")", "{", "return", "decorateInstanceInfo", "(", "lease", ")", ";", "}", "else", "if", "(", "includeRemoteRegions", ")", "{", "for", "(", "RemoteRegionRegistry", "remoteRegistry", ":", "this", ".", "regionNameVSRemoteRegistry", ".", "values", "(", ")", ")", "{", "Application", "application", "=", "remoteRegistry", ".", "getApplication", "(", "appName", ")", ";", "if", "(", "application", "!", "=", "null", ")", "{", "return", "application", ".", "getByInstanceId", "(", "id", ")", ";", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "List", "<", "InstanceInfo", ">", "getInstancesById", "(", "String", "id", ")", "{", "return", "this", ".", "getInstancesById", "(", "id", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "List", "<", "InstanceInfo", ">", "getInstancesById", "(", "String", "id", ",", "boolean", "includeRemoteRegions", ")", "{", "List", "<", "InstanceInfo", ">", "list", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "for", "(", "Iterator", "<", "Entry", "<", "String", ",", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", ">", ">", "iter", "=", "registry", ".", "entrySet", "(", ")", ".", "iterator", "(", ")", ";", "iter", ".", "hasNext", "(", ")", ";", ")", "{", "Map", "<", "String", ",", "Lease", "<", "InstanceInfo", ">", ">", "leaseMap", "=", "iter", ".", "next", "(", ")", ".", "getValue", "(", ")", ";", "if", "(", "leaseMap", "!", "=", "null", ")", "{", "Lease", "<", "InstanceInfo", ">", "lease", "=", "leaseMap", ".", "get", "(", "id", ")", ";", "if", "(", "lease", "=", "=", "null", "|", "|", "(", "isLeaseExpirationEnabled", "(", ")", "&", "&", "lease", ".", "isExpired", "(", ")", ")", ")", "{", "continue", ";", "}", "if", "(", "list", "=", "=", "Collections", ".", "EMPTY_LIST", ")", "{", "list", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "}", "list", ".", "add", "(", "decorateInstanceInfo", "(", "lease", ")", ")", ";", "}", "}", "if", "(", "list", ".", "isEmpty", "(", ")", "&", "&", "includeRemoteRegions", ")", "{", "for", "(", "RemoteRegionRegistry", "remoteRegistry", ":", "this", ".", "regionNameVSRemoteRegistry", ".", "values", "(", ")", ")", "{", "for", "(", "Application", "application", ":", "remoteRegistry", ".", "getApplications", "(", ")", ".", "getRegisteredApplications", "(", ")", ")", "{", "InstanceInfo", "instanceInfo", "=", "application", ".", "getByInstanceId", "(", "id", ")", ";", "if", "(", "instanceInfo", "!", "=", "null", ")", "{", "list", ".", "add", "(", "instanceInfo", ")", ";", "return", "list", ";", "}", "}", "}", "}", "return", "list", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "decorateInstanceInfo", "(", "Lease", "<", "InstanceInfo", ">", "lease", ")", "{", "InstanceInfo", "info", "=", "lease", ".", "getHolder", "(", ")", ";", "int", "renewalInterval", "=", "LeaseInfo", ".", "DEFAULT_LEASE_RENEWAL_INTERVAL", ";", "int", "leaseDuration", "=", "LeaseInfo", ".", "DEFAULT_LEASE_DURATION", ";", "if", "(", "info", ".", "getLeaseInfo", "(", ")", "!", "=", "null", ")", "{", "renewalInterval", "=", "info", ".", "getLeaseInfo", "(", ")", ".", "getRenewalIntervalInSecs", "(", ")", ";", "leaseDuration", "=", "info", ".", "getLeaseInfo", "(", ")", ".", "getDurationInSecs", "(", ")", ";", "}", "info", ".", "setLeaseInfo", "(", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setRegistrationTimestamp", "(", "lease", ".", "getRegistrationTimestamp", "(", ")", ")", ".", "setRenewalTimestamp", "(", "lease", ".", "getLastRenewalTimestamp", "(", ")", ")", ".", "setServiceUpTimestamp", "(", "lease", ".", "getServiceUpTimestamp", "(", ")", ")", ".", "setRenewalIntervalInSecs", "(", "renewalInterval", ")", ".", "setDurationInSecs", "(", "leaseDuration", ")", ".", "setEvictionTimestamp", "(", "lease", ".", "getEvictionTimestamp", "(", ")", ")", ".", "build", "(", ")", ")", ";", "info", ".", "setIsCoordinatingDiscoveryServer", "(", ")", ";", "return", "info", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "@", "Override", "public", "long", "getNumOfRenewsInLastMin", "(", ")", "{", "if", "(", "renewsLastMin", "!", "=", "null", ")", "{", "return", "renewsLastMin", ".", "getCount", "(", ")", ";", "}", "else", "{", "return", "0", ";", "}", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "@", "Override", "public", "int", "getNumOfRenewsPerMinThreshold", "(", ")", "{", "return", "numberOfRenewsPerMinThreshold", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Pair", "<", "Long", ",", "String", ">", ">", "getLastNRegisteredInstances", "(", ")", "{", "List", "<", "Pair", "<", "Long", ",", "String", ">", ">", "list", "=", "new", "ArrayList", "<", "Pair", "<", "Long", ",", "String", ">", ">", "(", ")", ";", "synchronized", "(", "recentRegisteredQueue", ")", "{", "for", "(", "Pair", "<", "Long", ",", "String", ">", "aRecentRegisteredQueue", ":", "recentRegisteredQueue", ")", "{", "list", ".", "add", "(", "aRecentRegisteredQueue", ")", ";", "}", "}", "Collections", ".", "reverse", "(", "list", ")", ";", "return", "list", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Pair", "<", "Long", ",", "String", ">", ">", "getLastNCanceledInstances", "(", ")", "{", "List", "<", "Pair", "<", "Long", ",", "String", ">", ">", "list", "=", "new", "ArrayList", "<", "Pair", "<", "Long", ",", "String", ">", ">", "(", ")", ";", "synchronized", "(", "recentCanceledQueue", ")", "{", "for", "(", "Pair", "<", "Long", ",", "String", ">", "aRecentCanceledQueue", ":", "recentCanceledQueue", ")", "{", "list", ".", "add", "(", "aRecentCanceledQueue", ")", ";", "}", "}", "Collections", ".", "reverse", "(", "list", ")", ";", "return", "list", ";", "}", "</s>"]
["<s>", "private", "void", "invalidateCache", "(", "String", "appName", ",", "@", "Nullable", "String", "vipAddress", ",", "@", "Nullable", "String", "secureVipAddress", ")", "{", "responseCache", ".", "invalidate", "(", "appName", ",", "vipAddress", ",", "secureVipAddress", ")", ";", "}", "</s>"]
["<s>", "public", "RecentlyChangedItem", "(", "Lease", "<", "InstanceInfo", ">", "lease", ")", "{", "this", ".", "leaseInfo", "=", "lease", ";", "lastUpdateTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getLastUpdateTime", "(", ")", "{", "return", "this", ".", "lastUpdateTime", ";", "}", "</s>"]
["<s>", "public", "Lease", "<", "InstanceInfo", ">", "getLeaseInfo", "(", ")", "{", "return", "this", ".", "leaseInfo", ";", "}", "</s>"]
["<s>", "protected", "void", "postInit", "(", ")", "{", "renewsLastMin", "=", "new", "MeasuredRate", "(", "<NUM_LIT:1000>", "*", "<NUM_LIT>", "*", "1", ")", ";", "if", "(", "evictionTaskRef", ".", "get", "(", ")", "!", "=", "null", ")", "{", "evictionTaskRef", ".", "get", "(", ")", ".", "cancel", "(", ")", ";", "}", "evictionTaskRef", ".", "set", "(", "new", "EvictionTask", "(", ")", ")", ";", "evictionTimer", ".", "schedule", "(", "evictionTaskRef", ".", "get", "(", ")", ",", "serverConfig", ".", "getEvictionIntervalTimerInMs", "(", ")", ",", "serverConfig", ".", "getEvictionIntervalTimerInMs", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "deltaRetentionTimer", ".", "cancel", "(", ")", ";", "evictionTimer", ".", "cancel", "(", ")", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getNumberofElementsininstanceCache", "(", ")", "{", "return", "overriddenInstanceStatusMap", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "boolean", "experimental", "=", "\"", "<STR_LIT>", "\"", ".", "equalsIgnoreCase", "(", "serverConfig", ".", "getExperimental", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "if", "(", "experimental", ")", "{", "long", "compensationTimeMs", "=", "getCompensationTimeMs", "(", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "compensationTimeMs", ")", ";", "evict", "(", "compensationTimeMs", ")", ";", "}", "else", "{", "evict", "(", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "long", "getCompensationTimeMs", "(", ")", "{", "long", "currNanos", "=", "getCurrentTimeNano", "(", ")", ";", "long", "lastNanos", "=", "lastExecutionNanosRef", ".", "getAndSet", "(", "currNanos", ")", ";", "if", "(", "lastNanos", "=", "=", "0", "l", ")", "{", "return", "0", "l", ";", "}", "long", "elapsedMs", "=", "TimeUnit", ".", "NANOSECONDS", ".", "toMillis", "(", "currNanos", "-", "lastNanos", ")", ";", "long", "compensationTime", "=", "elapsedMs", "-", "serverConfig", ".", "getEvictionIntervalTimerInMs", "(", ")", ";", "return", "compensationTime", "<", "=", "0", "l", "?", "0", "l", ":", "compensationTime", ";", "}", "</s>"]
["<s>", "long", "getCurrentTimeNano", "(", ")", "{", "return", "System", ".", "nanoTime", "(", ")", ";", "}", "</s>"]
["<s>", "public", "CircularQueue", "(", "int", "size", ")", "{", "this", ".", "size", "=", "size", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "add", "(", "E", "e", ")", "{", "this", ".", "makeSpaceIfNotAvailable", "(", ")", ";", "return", "super", ".", "add", "(", "e", ")", ";", "}", "</s>"]
["<s>", "private", "void", "makeSpaceIfNotAvailable", "(", ")", "{", "if", "(", "this", ".", "size", "(", ")", "=", "=", "size", ")", "{", "this", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "offer", "(", "E", "e", ")", "{", "this", ".", "makeSpaceIfNotAvailable", "(", ")", ";", "return", "super", ".", "offer", "(", "e", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "InstanceInfo", ".", "InstanceStatus", "getOverriddenInstanceStatus", "(", "InstanceInfo", "r", ",", "Lease", "<", "InstanceInfo", ">", "existingLease", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "private", "TimerTask", "getDeltaRetentionTask", "(", ")", "{", "return", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Iterator", "<", "RecentlyChangedItem", ">", "it", "=", "recentlyChangedQueue", ".", "iterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "if", "(", "it", ".", "next", "(", ")", ".", "getLastUpdateTime", "(", ")", "<", "System", ".", "currentTimeMillis", "(", ")", "-", "serverConfig", ".", "getRetentionTimeInMSInDeltaQueue", "(", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "else", "{", "break", ";", "}", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "Iterator", "<", "RecentlyChangedItem", ">", "it", "=", "recentlyChangedQueue", ".", "iterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "if", "(", "it", ".", "next", "(", ")", ".", "getLastUpdateTime", "(", ")", "<", "System", ".", "currentTimeMillis", "(", ")", "-", "serverConfig", ".", "getRetentionTimeInMSInDeltaQueue", "(", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "else", "{", "break", ";", "}", "}", "}", "</s>"]
["<s>", "void", "openForTraffic", "(", "ApplicationInfoManager", "applicationInfoManager", ",", "int", "count", ")", ";", "</s>"]
["<s>", "void", "shutdown", "(", ")", ";", "</s>"]
["<s>", "@", "Deprecated", "void", "storeOverriddenStatusIfRequired", "(", "String", "id", ",", "InstanceStatus", "overriddenStatus", ")", ";", "</s>"]
["<s>", "void", "storeOverriddenStatusIfRequired", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "overriddenStatus", ")", ";", "</s>"]
["<s>", "boolean", "statusUpdate", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "String", "lastDirtyTimestamp", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "boolean", "deleteStatusOverride", "(", "String", "appName", ",", "String", "id", ",", "InstanceStatus", "newStatus", ",", "String", "lastDirtyTimestamp", ",", "boolean", "isReplication", ")", ";", "</s>"]
["<s>", "Map", "<", "String", ",", "InstanceStatus", ">", "overriddenInstanceStatusesSnapshot", "(", ")", ";", "</s>"]
["<s>", "Applications", "getApplicationsFromLocalRegionOnly", "(", ")", ";", "</s>"]
["<s>", "List", "<", "Application", ">", "getSortedApplications", "(", ")", ";", "</s>"]
["<s>", "Application", "getApplication", "(", "String", "appName", ",", "boolean", "includeRemoteRegion", ")", ";", "</s>"]
["<s>", "InstanceInfo", "getInstanceByAppAndId", "(", "String", "appName", ",", "String", "id", ")", ";", "</s>"]
["<s>", "InstanceInfo", "getInstanceByAppAndId", "(", "String", "appName", ",", "String", "id", ",", "boolean", "includeRemoteRegions", ")", ";", "</s>"]
["<s>", "void", "clearRegistry", "(", ")", ";", "</s>"]
["<s>", "void", "initializedResponseCache", "(", ")", ";", "</s>"]
["<s>", "ResponseCache", "getResponseCache", "(", ")", ";", "</s>"]
["<s>", "long", "getNumOfRenewsInLastMin", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOfRenewsPerMinThreshold", "(", ")", ";", "</s>"]
["<s>", "int", "isBelowRenewThresold", "(", ")", ";", "</s>"]
["<s>", "List", "<", "Pair", "<", "Long", ",", "String", ">", ">", "getLastNRegisteredInstances", "(", ")", ";", "</s>"]
["<s>", "List", "<", "Pair", "<", "Long", ",", "String", ">", ">", "getLastNCanceledInstances", "(", ")", ";", "</s>"]
["<s>", "boolean", "isLeaseExpirationEnabled", "(", ")", ";", "</s>"]
["<s>", "boolean", "isSelfPreservationModeEnabled", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Key", ">", "get", "(", ")", "{", "return", "new", "CopyOnWriteArrayList", "<", "Key", ">", "(", ")", ";", "}", "</s>"]
["<s>", "ResponseCacheImpl", "(", "EurekaServerConfig", "serverConfig", ",", "ServerCodecs", "serverCodecs", ",", "AbstractInstanceRegistry", "registry", ")", "{", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "serverCodecs", "=", "serverCodecs", ";", "this", ".", "shouldUseReadOnlyResponseCache", "=", "serverConfig", ".", "shouldUseReadOnlyResponseCache", "(", ")", ";", "this", ".", "registry", "=", "registry", ";", "long", "responseCacheUpdateIntervalMs", "=", "serverConfig", ".", "getResponseCacheUpdateIntervalMs", "(", ")", ";", "this", ".", "readWriteCacheMap", "=", "CacheBuilder", ".", "newBuilder", "(", ")", ".", "initialCapacity", "(", "<NUM_LIT:1000>", ")", ".", "expireAfterWrite", "(", "serverConfig", ".", "getResponseCacheAutoExpirationInSeconds", "(", ")", ",", "TimeUnit", ".", "SECONDS", ")", ".", "removalListener", "(", "new", "RemovalListener", "<", "Key", ",", "Value", ">", "(", ")", "{", "@", "Override", "public", "void", "onRemoval", "(", "RemovalNotification", "<", "Key", ",", "Value", ">", "notification", ")", "{", "Key", "removedKey", "=", "notification", ".", "getKey", "(", ")", ";", "if", "(", "removedKey", ".", "hasRegions", "(", ")", ")", "{", "Key", "cloneWithNoRegions", "=", "removedKey", ".", "cloneWithoutRegions", "(", ")", ";", "regionSpecificKeys", ".", "remove", "(", "cloneWithNoRegions", ",", "removedKey", ")", ";", "}", "}", "}", ")", ".", "build", "(", "new", "CacheLoader", "<", "Key", ",", "Value", ">", "(", ")", "{", "@", "Override", "public", "Value", "load", "(", "Key", "key", ")", "throws", "Exception", "{", "if", "(", "key", ".", "hasRegions", "(", ")", ")", "{", "Key", "cloneWithNoRegions", "=", "key", ".", "cloneWithoutRegions", "(", ")", ";", "regionSpecificKeys", ".", "put", "(", "cloneWithNoRegions", ",", "key", ")", ";", "}", "Value", "value", "=", "generatePayload", "(", "key", ")", ";", "return", "value", ";", "}", "}", ")", ";", "if", "(", "shouldUseReadOnlyResponseCache", ")", "{", "timer", ".", "schedule", "(", "getCacheUpdateTask", "(", ")", ",", "new", "Date", "(", "(", "(", "System", ".", "currentTimeMillis", "(", ")", "/", "responseCacheUpdateIntervalMs", ")", "*", "responseCacheUpdateIntervalMs", ")", "+", "responseCacheUpdateIntervalMs", ")", ",", "responseCacheUpdateIntervalMs", ")", ";", "}", "try", "{", "Monitors", ".", "registerObject", "(", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onRemoval", "(", "RemovalNotification", "<", "Key", ",", "Value", ">", "notification", ")", "{", "Key", "removedKey", "=", "notification", ".", "getKey", "(", ")", ";", "if", "(", "removedKey", ".", "hasRegions", "(", ")", ")", "{", "Key", "cloneWithNoRegions", "=", "removedKey", ".", "cloneWithoutRegions", "(", ")", ";", "regionSpecificKeys", ".", "remove", "(", "cloneWithNoRegions", ",", "removedKey", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Value", "load", "(", "Key", "key", ")", "throws", "Exception", "{", "if", "(", "key", ".", "hasRegions", "(", ")", ")", "{", "Key", "cloneWithNoRegions", "=", "key", ".", "cloneWithoutRegions", "(", ")", ";", "regionSpecificKeys", ".", "put", "(", "cloneWithNoRegions", ",", "key", ")", ";", "}", "Value", "value", "=", "generatePayload", "(", "key", ")", ";", "return", "value", ";", "}", "</s>"]
["<s>", "private", "TimerTask", "getCacheUpdateTask", "(", ")", "{", "return", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "Key", "key", ":", "readOnlyCacheMap", ".", "keySet", "(", ")", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "Object", "[", "]", "args", "=", "{", "key", ".", "getEntityType", "(", ")", ",", "key", ".", "getName", "(", ")", ",", "key", ".", "getVersion", "(", ")", ",", "key", ".", "getType", "(", ")", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "}", "try", "{", "CurrentRequestVersion", ".", "set", "(", "key", ".", "getVersion", "(", ")", ")", ";", "Value", "cacheValue", "=", "readWriteCacheMap", ".", "get", "(", "key", ")", ";", "Value", "currentCacheValue", "=", "readOnlyCacheMap", ".", "get", "(", "key", ")", ";", "if", "(", "cacheValue", "!", "=", "currentCacheValue", ")", "{", "readOnlyCacheMap", ".", "put", "(", "key", ",", "cacheValue", ")", ";", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "Key", "key", ":", "readOnlyCacheMap", ".", "keySet", "(", ")", ")", "{", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "Object", "[", "]", "args", "=", "{", "key", ".", "getEntityType", "(", ")", ",", "key", ".", "getName", "(", ")", ",", "key", ".", "getVersion", "(", ")", ",", "key", ".", "getType", "(", ")", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "}", "try", "{", "CurrentRequestVersion", ".", "set", "(", "key", ".", "getVersion", "(", ")", ")", ";", "Value", "cacheValue", "=", "readWriteCacheMap", ".", "get", "(", "key", ")", ";", "Value", "currentCacheValue", "=", "readOnlyCacheMap", ".", "get", "(", "key", ")", ";", "if", "(", "cacheValue", "!", "=", "currentCacheValue", ")", "{", "readOnlyCacheMap", ".", "put", "(", "key", ",", "cacheValue", ")", ";", "}", "}", "catch", "(", "Throwable", "th", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "th", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "String", "get", "(", "final", "Key", "key", ")", "{", "return", "get", "(", "key", ",", "shouldUseReadOnlyResponseCache", ")", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "String", "get", "(", "final", "Key", "key", ",", "boolean", "useReadOnlyCache", ")", "{", "Value", "payload", "=", "getValue", "(", "key", ",", "useReadOnlyCache", ")", ";", "if", "(", "payload", "=", "=", "null", "|", "|", "payload", ".", "getPayload", "(", ")", ".", "equals", "(", "EMPTY_PAYLOAD", ")", ")", "{", "return", "null", ";", "}", "else", "{", "return", "payload", ".", "getPayload", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "getGZIP", "(", "Key", "key", ")", "{", "Value", "payload", "=", "getValue", "(", "key", ",", "shouldUseReadOnlyResponseCache", ")", ";", "if", "(", "payload", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "payload", ".", "getGzipped", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "invalidate", "(", "String", "appName", ",", "@", "Nullable", "String", "vipAddress", ",", "@", "Nullable", "String", "secureVipAddress", ")", "{", "for", "(", "Key", ".", "KeyType", "type", ":", "Key", ".", "KeyType", ".", "values", "(", ")", ")", "{", "for", "(", "Version", "v", ":", "Version", ".", "values", "(", ")", ")", "{", "invalidate", "(", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "appName", ",", "type", ",", "v", ",", "EurekaAccept", ".", "full", ")", ",", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "appName", ",", "type", ",", "v", ",", "EurekaAccept", ".", "compact", ")", ",", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "ALL_APPS", ",", "type", ",", "v", ",", "EurekaAccept", ".", "full", ")", ",", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "ALL_APPS", ",", "type", ",", "v", ",", "EurekaAccept", ".", "compact", ")", ",", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "ALL_APPS_DELTA", ",", "type", ",", "v", ",", "EurekaAccept", ".", "full", ")", ",", "new", "Key", "(", "Key", ".", "EntityType", ".", "Application", ",", "ALL_APPS_DELTA", ",", "type", ",", "v", ",", "EurekaAccept", ".", "compact", ")", ")", ";", "if", "(", "null", "!", "=", "vipAddress", ")", "{", "invalidate", "(", "new", "Key", "(", "Key", ".", "EntityType", ".", "VIP", ",", "vipAddress", ",", "type", ",", "v", ",", "EurekaAccept", ".", "full", ")", ")", ";", "}", "if", "(", "null", "!", "=", "secureVipAddress", ")", "{", "invalidate", "(", "new", "Key", "(", "Key", ".", "EntityType", ".", "SVIP", ",", "secureVipAddress", ",", "type", ",", "v", ",", "EurekaAccept", ".", "full", ")", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "public", "void", "invalidate", "(", "Key", ".", ".", ".", "keys", ")", "{", "for", "(", "Key", "key", ":", "keys", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "key", ".", "getEntityType", "(", ")", ",", "key", ".", "getName", "(", ")", ",", "key", ".", "getVersion", "(", ")", ",", "key", ".", "getType", "(", ")", ",", "key", ".", "getEurekaAccept", "(", ")", ")", ";", "readWriteCacheMap", ".", "invalidate", "(", "key", ")", ";", "Collection", "<", "Key", ">", "keysWithRegions", "=", "regionSpecificKeys", ".", "get", "(", "key", ")", ";", "if", "(", "null", "!", "=", "keysWithRegions", "&", "&", "!", "keysWithRegions", ".", "isEmpty", "(", ")", ")", "{", "for", "(", "Key", "keysWithRegion", ":", "keysWithRegions", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "key", ".", "getEntityType", "(", ")", ",", "key", ".", "getName", "(", ")", ",", "key", ".", "getVersion", "(", ")", ",", "key", ".", "getType", "(", ")", ",", "key", ".", "getEurekaAccept", "(", ")", ")", ";", "readWriteCacheMap", ".", "invalidate", "(", "keysWithRegion", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "AtomicLong", "getVersionDelta", "(", ")", "{", "return", "versionDelta", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "AtomicLong", "getVersionDeltaWithRegions", "(", ")", "{", "return", "versionDeltaWithRegions", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "AtomicLong", "getVersionDeltaStatic", "(", ")", "{", "return", "versionDeltaLegacy", ";", "}", "</s>"]
["<s>", "@", "Deprecated", "public", "static", "AtomicLong", "getVersionDeltaWithRegionsLegacy", "(", ")", "{", "return", "versionDeltaWithRegionsLegacy", ";", "}", "</s>"]
["<s>", "@", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "int", "getCurrentSize", "(", ")", "{", "return", "readWriteCacheMap", ".", "asMap", "(", ")", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "VisibleForTesting", "Value", "getValue", "(", "final", "Key", "key", ",", "boolean", "useReadOnlyCache", ")", "{", "Value", "payload", "=", "null", ";", "try", "{", "if", "(", "useReadOnlyCache", ")", "{", "final", "Value", "currentPayload", "=", "readOnlyCacheMap", ".", "get", "(", "key", ")", ";", "if", "(", "currentPayload", "!", "=", "null", ")", "{", "payload", "=", "currentPayload", ";", "}", "else", "{", "payload", "=", "readWriteCacheMap", ".", "get", "(", "key", ")", ";", "readOnlyCacheMap", ".", "put", "(", "key", ",", "payload", ")", ";", "}", "}", "else", "{", "payload", "=", "readWriteCacheMap", ".", "get", "(", "key", ")", ";", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "key", ",", "t", ")", ";", "}", "return", "payload", ";", "}", "</s>"]
["<s>", "private", "String", "getPayLoad", "(", "Key", "key", ",", "Applications", "apps", ")", "{", "EncoderWrapper", "encoderWrapper", "=", "serverCodecs", ".", "getEncoder", "(", "key", ".", "getType", "(", ")", ",", "key", ".", "getEurekaAccept", "(", ")", ")", ";", "String", "result", ";", "try", "{", "result", "=", "encoderWrapper", ".", "encode", "(", "apps", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "return", "\"", "\"", ";", "}", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "key", ".", "toStringCompact", "(", ")", ",", "apps", ".", "getAppsHashCode", "(", ")", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "private", "String", "getPayLoad", "(", "Key", "key", ",", "Application", "app", ")", "{", "if", "(", "app", "=", "=", "null", ")", "{", "return", "EMPTY_PAYLOAD", ";", "}", "EncoderWrapper", "encoderWrapper", "=", "serverCodecs", ".", "getEncoder", "(", "key", ".", "getType", "(", ")", ",", "key", ".", "getEurekaAccept", "(", ")", ")", ";", "try", "{", "return", "encoderWrapper", ".", "encode", "(", "app", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "app", ".", "getName", "(", ")", ",", "e", ")", ";", "return", "\"", "\"", ";", "}", "}", "</s>"]
["<s>", "private", "Value", "generatePayload", "(", "Key", "key", ")", "{", "Stopwatch", "tracer", "=", "null", ";", "try", "{", "String", "payload", ";", "switch", "(", "key", ".", "getEntityType", "(", ")", ")", "{", "case", "Application", ":", "boolean", "isRemoteRegionRequested", "=", "key", ".", "hasRegions", "(", ")", ";", "if", "(", "ALL_APPS", ".", "equals", "(", "key", ".", "getName", "(", ")", ")", ")", "{", "if", "(", "isRemoteRegionRequested", ")", "{", "tracer", "=", "serializeAllAppsWithRemoteRegionTimer", ".", "start", "(", ")", ";", "payload", "=", "getPayLoad", "(", "key", ",", "registry", ".", "getApplicationsFromMultipleRegions", "(", "key", ".", "getRegions", "(", ")", ")", ")", ";", "}", "else", "{", "tracer", "=", "serializeAllAppsTimer", ".", "start", "(", ")", ";", "payload", "=", "getPayLoad", "(", "key", ",", "registry", ".", "getApplications", "(", ")", ")", ";", "}", "}", "else", "if", "(", "ALL_APPS_DELTA", ".", "equals", "(", "key", ".", "getName", "(", ")", ")", ")", "{", "if", "(", "isRemoteRegionRequested", ")", "{", "tracer", "=", "serializeDeltaAppsWithRemoteRegionTimer", ".", "start", "(", ")", ";", "versionDeltaWithRegions", ".", "incrementAndGet", "(", ")", ";", "versionDeltaWithRegionsLegacy", ".", "incrementAndGet", "(", ")", ";", "payload", "=", "getPayLoad", "(", "key", ",", "registry", ".", "getApplicationDeltasFromMultipleRegions", "(", "key", ".", "getRegions", "(", ")", ")", ")", ";", "}", "else", "{", "tracer", "=", "serializeDeltaAppsTimer", ".", "start", "(", ")", ";", "versionDelta", ".", "incrementAndGet", "(", ")", ";", "versionDeltaLegacy", ".", "incrementAndGet", "(", ")", ";", "payload", "=", "getPayLoad", "(", "key", ",", "registry", ".", "getApplicationDeltas", "(", ")", ")", ";", "}", "}", "else", "{", "tracer", "=", "serializeOneApptimer", ".", "start", "(", ")", ";", "payload", "=", "getPayLoad", "(", "key", ",", "registry", ".", "getApplication", "(", "key", ".", "getName", "(", ")", ")", ")", ";", "}", "break", ";", "case", "VIP", ":", "case", "SVIP", ":", "tracer", "=", "serializeViptimer", ".", "start", "(", ")", ";", "payload", "=", "getPayLoad", "(", "key", ",", "getApplicationsForVip", "(", "key", ",", "registry", ")", ")", ";", "break", ";", "default", ":", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "key", ".", "getEntityType", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "payload", "=", "\"", "\"", ";", "break", ";", "}", "return", "new", "Value", "(", "payload", ")", ";", "}", "finally", "{", "if", "(", "tracer", "!", "=", "null", ")", "{", "tracer", ".", "stop", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "static", "Applications", "getApplicationsForVip", "(", "Key", "key", ",", "AbstractInstanceRegistry", "registry", ")", "{", "Object", "[", "]", "args", "=", "{", "key", ".", "getEntityType", "(", ")", ",", "key", ".", "getName", "(", ")", ",", "key", ".", "getVersion", "(", ")", ",", "key", ".", "getType", "(", ")", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "Applications", "toReturn", "=", "new", "Applications", "(", ")", ";", "Applications", "applications", "=", "registry", ".", "getApplications", "(", ")", ";", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "Application", "appToAdd", "=", "null", ";", "for", "(", "InstanceInfo", "instanceInfo", ":", "application", ".", "getInstances", "(", ")", ")", "{", "String", "vipAddress", ";", "if", "(", "Key", ".", "EntityType", ".", "VIP", ".", "equals", "(", "key", ".", "getEntityType", "(", ")", ")", ")", "{", "vipAddress", "=", "instanceInfo", ".", "getVIPAddress", "(", ")", ";", "}", "else", "if", "(", "Key", ".", "EntityType", ".", "SVIP", ".", "equals", "(", "key", ".", "getEntityType", "(", ")", ")", ")", "{", "vipAddress", "=", "instanceInfo", ".", "getSecureVipAddress", "(", ")", ";", "}", "else", "{", "continue", ";", "}", "if", "(", "null", "!", "=", "vipAddress", ")", "{", "String", "[", "]", "vipAddresses", "=", "vipAddress", ".", "split", "(", "\"", "<STR_LIT:U+002C>", "\"", ")", ";", "Arrays", ".", "sort", "(", "vipAddresses", ")", ";", "if", "(", "Arrays", ".", "binarySearch", "(", "vipAddresses", ",", "key", ".", "getName", "(", ")", ")", ">", "=", "0", ")", "{", "if", "(", "null", "=", "=", "appToAdd", ")", "{", "appToAdd", "=", "new", "Application", "(", "application", ".", "getName", "(", ")", ")", ";", "toReturn", ".", "addApplication", "(", "appToAdd", ")", ";", "}", "appToAdd", ".", "addInstance", "(", "instanceInfo", ")", ";", "}", "}", "}", "}", "toReturn", ".", "setAppsHashCode", "(", "toReturn", ".", "getReconcileHashCode", "(", ")", ")", ";", "args", "=", "new", "Object", "[", "]", "{", "key", ".", "getEntityType", "(", ")", ",", "key", ".", "getName", "(", ")", ",", "key", ".", "getVersion", "(", ")", ",", "key", ".", "getType", "(", ")", ",", "toReturn", ".", "getReconcileHashCode", "(", ")", "}", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "args", ")", ";", "return", "toReturn", ";", "}", "</s>"]
["<s>", "public", "Value", "(", "String", "payload", ")", "{", "this", ".", "payload", "=", "payload", ";", "if", "(", "!", "EMPTY_PAYLOAD", ".", "equals", "(", "payload", ")", ")", "{", "Stopwatch", "tracer", "=", "compressPayloadTimer", ".", "start", "(", ")", ";", "try", "{", "ByteArrayOutputStream", "bos", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "GZIPOutputStream", "out", "=", "new", "GZIPOutputStream", "(", "bos", ")", ";", "byte", "[", "]", "rawBytes", "=", "payload", ".", "getBytes", "(", ")", ";", "out", ".", "write", "(", "rawBytes", ")", ";", "out", ".", "finish", "(", ")", ";", "out", ".", "close", "(", ")", ";", "bos", ".", "close", "(", ")", ";", "gzipped", "=", "bos", ".", "toByteArray", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "gzipped", "=", "null", ";", "}", "finally", "{", "if", "(", "tracer", "!", "=", "null", ")", "{", "tracer", ".", "stop", "(", ")", ";", "}", "}", "}", "else", "{", "gzipped", "=", "null", ";", "}", "}", "</s>"]
["<s>", "public", "String", "getPayload", "(", ")", "{", "return", "payload", ";", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "getGzipped", "(", ")", "{", "return", "gzipped", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "Route53Binder", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "this", "(", "getRegistrationHostnameFromAmazonDataCenterInfo", "(", "applicationInfoManager", ")", ",", "serverConfig", ",", "clientConfig", ",", "applicationInfoManager", ")", ";", "}", "</s>"]
["<s>", "public", "Route53Binder", "(", "String", "registrationHostname", ",", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "this", ".", "registrationHostname", "=", "registrationHostname", ";", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "clientConfig", "=", "clientConfig", ";", "this", ".", "applicationInfoManager", "=", "applicationInfoManager", ";", "this", ".", "timer", "=", "new", "Timer", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "this", ".", "amazonRoute53Client", "=", "getAmazonRoute53Client", "(", "serverConfig", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "getRegistrationHostnameFromAmazonDataCenterInfo", "(", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "InstanceInfo", "myInfo", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ";", "AmazonInfo", "dataCenterInfo", "=", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ";", "String", "ip", "=", "dataCenterInfo", ".", "get", "(", "AmazonInfo", ".", "MetaDataKey", ".", "publicHostname", ")", ";", "if", "(", "ip", "=", "=", "null", "|", "|", "ip", ".", "length", "(", ")", "=", "=", "0", ")", "{", "return", "dataCenterInfo", ".", "get", "(", "AmazonInfo", ".", "MetaDataKey", ".", "localHostname", ")", ";", "}", "return", "ip", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "PostConstruct", "public", "void", "start", "(", ")", "throws", "InterruptedException", "{", "doBind", "(", ")", ";", "timer", ".", "schedule", "(", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "doBind", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ",", "serverConfig", ".", "getRoute53BindingRetryIntervalMs", "(", ")", ",", "serverConfig", ".", "getRoute53BindingRetryIntervalMs", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "doBind", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "doBind", "(", ")", "throws", "InterruptedException", "{", "List", "<", "ResourceRecordSetWithHostedZone", ">", "freeDomains", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "List", "<", "String", ">", "domains", "=", "getDeclaredDomains", "(", ")", ";", "for", "(", "String", "domain", ":", "domains", ")", "{", "ResourceRecordSetWithHostedZone", "rrs", "=", "getResourceRecordSetWithHostedZone", "(", "domain", ")", ";", "if", "(", "rrs", "!", "=", "null", ")", "{", "if", "(", "rrs", ".", "getResourceRecordSet", "(", ")", "=", "=", "null", ")", "{", "ResourceRecordSet", "resourceRecordSet", "=", "new", "ResourceRecordSet", "(", ")", ";", "resourceRecordSet", ".", "setName", "(", "domain", ")", ";", "resourceRecordSet", ".", "setType", "(", "RRType", ".", "CNAME", ")", ";", "resourceRecordSet", ".", "setTTL", "(", "serverConfig", ".", "getRoute53DomainTTL", "(", ")", ")", ";", "freeDomains", ".", "add", "(", "new", "ResourceRecordSetWithHostedZone", "(", "rrs", ".", "getHostedZone", "(", ")", ",", "resourceRecordSet", ")", ")", ";", "}", "else", "if", "(", "NULL_DOMAIN", ".", "equals", "(", "rrs", ".", "getResourceRecordSet", "(", ")", ".", "getResourceRecords", "(", ")", ".", "get", "(", "0", ")", ".", "getValue", "(", ")", ")", ")", "{", "freeDomains", ".", "add", "(", "rrs", ")", ";", "}", "if", "(", "hasValue", "(", "rrs", ",", "registrationHostname", ")", ")", "{", "return", ";", "}", "}", "}", "for", "(", "ResourceRecordSetWithHostedZone", "rrs", ":", "freeDomains", ")", "{", "if", "(", "createResourceRecordSet", "(", "rrs", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "registrationHostname", ",", "rrs", ".", "getResourceRecordSet", "(", ")", ".", "getName", "(", ")", ")", ";", "return", ";", "}", "}", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "domains", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "createResourceRecordSet", "(", "ResourceRecordSetWithHostedZone", "rrs", ")", "throws", "InterruptedException", "{", "rrs", ".", "getResourceRecordSet", "(", ")", ".", "setResourceRecords", "(", "Arrays", ".", "asList", "(", "new", "ResourceRecord", "(", "registrationHostname", ")", ")", ")", ";", "Change", "change", "=", "new", "Change", "(", "ChangeAction", ".", "UPSERT", ",", "rrs", ".", "getResourceRecordSet", "(", ")", ")", ";", "if", "(", "executeChangeWithRetry", "(", "change", ",", "rrs", ".", "getHostedZone", "(", ")", ")", ")", "{", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "ResourceRecordSet", "resourceRecordSet", "=", "getResourceRecordSet", "(", "rrs", ".", "getResourceRecordSet", "(", ")", ".", "getName", "(", ")", ",", "rrs", ".", "getHostedZone", "(", ")", ")", ";", "return", "resourceRecordSet", ".", "getResourceRecords", "(", ")", ".", "equals", "(", "rrs", ".", "getResourceRecordSet", "(", ")", ".", "getResourceRecords", "(", ")", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "List", "<", "String", ">", "toDomains", "(", "List", "<", "String", ">", "ec2Urls", ")", "{", "List", "<", "String", ">", "domains", "=", "new", "ArrayList", "<", ">", "(", "ec2Urls", ".", "size", "(", ")", ")", ";", "for", "(", "String", "url", ":", "ec2Urls", ")", "{", "try", "{", "domains", ".", "add", "(", "extractDomain", "(", "url", ")", ")", ";", "}", "catch", "(", "MalformedURLException", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "url", ",", "e", ")", ";", "}", "}", "return", "domains", ";", "}", "</s>"]
["<s>", "private", "String", "getMyZone", "(", ")", "{", "InstanceInfo", "info", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ";", "AmazonInfo", "amazonInfo", "=", "info", "!", "=", "null", "?", "(", "AmazonInfo", ")", "info", ".", "getDataCenterInfo", "(", ")", ":", "null", ";", "String", "zone", "=", "amazonInfo", "!", "=", "null", "?", "amazonInfo", ".", "get", "(", "AmazonInfo", ".", "MetaDataKey", ".", "availabilityZone", ")", ":", "null", ";", "if", "(", "zone", "=", "=", "null", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "zone", ";", "}", "</s>"]
["<s>", "private", "List", "<", "String", ">", "getDeclaredDomains", "(", ")", "{", "final", "String", "myZone", "=", "getMyZone", "(", ")", ";", "List", "<", "String", ">", "ec2Urls", "=", "clientConfig", ".", "getEurekaServerServiceUrls", "(", "myZone", ")", ";", "return", "toDomains", "(", "ec2Urls", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "executeChangeWithRetry", "(", "Change", "change", ",", "HostedZone", "hostedZone", ")", "throws", "InterruptedException", "{", "Throwable", "firstError", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "serverConfig", ".", "getRoute53BindRebindRetries", "(", ")", ";", "i", "+", "+", ")", "{", "try", "{", "executeChange", "(", "change", ",", "hostedZone", ")", ";", "return", "true", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "if", "(", "firstError", "=", "=", "null", ")", "{", "firstError", "=", "e", ";", "}", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "}", "}", "if", "(", "firstError", "!", "=", "null", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "change", "+", "\"", "\"", "+", "firstError", ",", "firstError", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "void", "executeChange", "(", "Change", "change", ",", "HostedZone", "hostedZone", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "change", ")", ";", "ChangeResourceRecordSetsRequest", "changeResourceRecordSetsRequest", "=", "new", "ChangeResourceRecordSetsRequest", "(", ")", ";", "changeResourceRecordSetsRequest", ".", "setHostedZoneId", "(", "hostedZone", ".", "getId", "(", ")", ")", ";", "ChangeBatch", "changeBatch", "=", "new", "ChangeBatch", "(", ")", ";", "changeBatch", ".", "withChanges", "(", "change", ")", ";", "changeResourceRecordSetsRequest", ".", "setChangeBatch", "(", "changeBatch", ")", ";", "amazonRoute53Client", ".", "changeResourceRecordSets", "(", "changeResourceRecordSetsRequest", ")", ";", "}", "</s>"]
["<s>", "private", "ResourceRecordSetWithHostedZone", "getResourceRecordSetWithHostedZone", "(", "String", "domain", ")", "{", "HostedZone", "hostedZone", "=", "getHostedZone", "(", "domain", ")", ";", "if", "(", "hostedZone", "!", "=", "null", ")", "{", "return", "new", "ResourceRecordSetWithHostedZone", "(", "hostedZone", ",", "getResourceRecordSet", "(", "domain", ",", "hostedZone", ")", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "ResourceRecordSet", "getResourceRecordSet", "(", "String", "domain", ",", "HostedZone", "hostedZone", ")", "{", "ListResourceRecordSetsRequest", "request", "=", "new", "ListResourceRecordSetsRequest", "(", ")", ";", "request", ".", "setMaxItems", "(", "String", ".", "valueOf", "(", "Integer", ".", "MAX_VALUE", ")", ")", ";", "request", ".", "setHostedZoneId", "(", "hostedZone", ".", "getId", "(", ")", ")", ";", "ListResourceRecordSetsResult", "listResourceRecordSetsResult", "=", "amazonRoute53Client", ".", "listResourceRecordSets", "(", "request", ")", ";", "for", "(", "ResourceRecordSet", "rrs", ":", "listResourceRecordSetsResult", ".", "getResourceRecordSets", "(", ")", ")", "{", "if", "(", "rrs", ".", "getName", "(", ")", ".", "equals", "(", "domain", ")", ")", "{", "return", "rrs", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "HostedZone", "getHostedZone", "(", "String", "domain", ")", "{", "ListHostedZonesRequest", "listHostedZoneRequest", "=", "new", "ListHostedZonesRequest", "(", ")", ";", "listHostedZoneRequest", ".", "setMaxItems", "(", "String", ".", "valueOf", "(", "Integer", ".", "MAX_VALUE", ")", ")", ";", "ListHostedZonesResult", "listHostedZonesResult", "=", "amazonRoute53Client", ".", "listHostedZones", "(", "listHostedZoneRequest", ")", ";", "for", "(", "HostedZone", "hostedZone", ":", "listHostedZonesResult", ".", "getHostedZones", "(", ")", ")", "{", "if", "(", "domain", ".", "endsWith", "(", "hostedZone", ".", "getName", "(", ")", ")", ")", "{", "return", "hostedZone", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "void", "unbindFromDomain", "(", "String", "domain", ")", "throws", "InterruptedException", "{", "ResourceRecordSetWithHostedZone", "resourceRecordSetWithHostedZone", "=", "getResourceRecordSetWithHostedZone", "(", "domain", ")", ";", "if", "(", "hasValue", "(", "resourceRecordSetWithHostedZone", ",", "registrationHostname", ")", ")", "{", "resourceRecordSetWithHostedZone", ".", "getResourceRecordSet", "(", ")", ".", "getResourceRecords", "(", ")", ".", "get", "(", "0", ")", ".", "setValue", "(", "NULL_DOMAIN", ")", ";", "executeChangeWithRetry", "(", "new", "Change", "(", "ChangeAction", ".", "UPSERT", ",", "resourceRecordSetWithHostedZone", ".", "getResourceRecordSet", "(", ")", ")", ",", "resourceRecordSetWithHostedZone", ".", "getHostedZone", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "String", "extractDomain", "(", "String", "url", ")", "throws", "MalformedURLException", "{", "return", "new", "URL", "(", "url", ")", ".", "getHost", "(", ")", "+", "\"", "<STR_LIT:.>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "PreDestroy", "public", "void", "shutdown", "(", ")", "throws", "InterruptedException", "{", "timer", ".", "cancel", "(", ")", ";", "for", "(", "String", "domain", ":", "getDeclaredDomains", "(", ")", ")", "{", "unbindFromDomain", "(", "domain", ")", ";", "}", "amazonRoute53Client", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "private", "AmazonRoute53Client", "getAmazonRoute53Client", "(", "EurekaServerConfig", "serverConfig", ")", "{", "String", "aWSAccessId", "=", "serverConfig", ".", "getAWSAccessId", "(", ")", ";", "String", "aWSSecretKey", "=", "serverConfig", ".", "getAWSSecretKey", "(", ")", ";", "ClientConfiguration", "clientConfiguration", "=", "new", "ClientConfiguration", "(", ")", ".", "withConnectionTimeout", "(", "serverConfig", ".", "getASGQueryTimeoutMs", "(", ")", ")", ";", "if", "(", "null", "!", "=", "aWSAccessId", "&", "&", "!", "\"", "\"", ".", "equals", "(", "aWSAccessId", ")", "&", "&", "null", "!", "=", "aWSSecretKey", "&", "&", "!", "\"", "\"", ".", "equals", "(", "aWSSecretKey", ")", ")", "{", "return", "new", "AmazonRoute53Client", "(", "new", "BasicAWSCredentials", "(", "aWSAccessId", ",", "aWSSecretKey", ")", ",", "clientConfiguration", ")", ";", "}", "else", "{", "return", "new", "AmazonRoute53Client", "(", "new", "InstanceProfileCredentialsProvider", "(", ")", ",", "clientConfiguration", ")", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "hasValue", "(", "ResourceRecordSetWithHostedZone", "resourceRecordSetWithHostedZone", ",", "String", "ip", ")", "{", "if", "(", "resourceRecordSetWithHostedZone", "!", "=", "null", "&", "&", "resourceRecordSetWithHostedZone", ".", "getResourceRecordSet", "(", ")", "!", "=", "null", ")", "{", "for", "(", "ResourceRecord", "rr", ":", "resourceRecordSetWithHostedZone", ".", "getResourceRecordSet", "(", ")", ".", "getResourceRecords", "(", ")", ")", "{", "if", "(", "ip", ".", "equals", "(", "rr", ".", "getValue", "(", ")", ")", ")", "{", "return", "true", ";", "}", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "ResourceRecordSetWithHostedZone", "(", "HostedZone", "hostedZone", ",", "ResourceRecordSet", "resourceRecordSet", ")", "{", "this", ".", "hostedZone", "=", "hostedZone", ";", "this", ".", "resourceRecordSet", "=", "resourceRecordSet", ";", "}", "</s>"]
["<s>", "public", "HostedZone", "getHostedZone", "(", ")", "{", "return", "hostedZone", ";", "}", "</s>"]
["<s>", "public", "ResourceRecordSet", "getResourceRecordSet", "(", ")", "{", "return", "resourceRecordSet", ";", "}", "</s>"]
["<s>", "void", "start", "(", ")", "throws", "Exception", ";", "</s>"]
["<s>", "void", "shutdown", "(", ")", "throws", "Exception", ";", "</s>"]
["<s>", "@", "Inject", "public", "AwsBinderDelegate", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "PeerAwareInstanceRegistry", "registry", ",", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "AwsBindingStrategy", "bindingStrategy", "=", "serverConfig", ".", "getBindingStrategy", "(", ")", ";", "switch", "(", "bindingStrategy", ")", "{", "case", "ROUTE53", ":", "delegate", "=", "new", "Route53Binder", "(", "serverConfig", ",", "clientConfig", ",", "applicationInfoManager", ")", ";", "break", ";", "case", "EIP", ":", "delegate", "=", "new", "EIPManager", "(", "serverConfig", ",", "clientConfig", ",", "registry", ",", "applicationInfoManager", ")", ";", "break", ";", "default", ":", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "bindingStrategy", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "@", "PostConstruct", "public", "void", "start", "(", ")", "throws", "Exception", "{", "delegate", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "PreDestroy", "public", "void", "shutdown", "(", ")", "throws", "Exception", "{", "delegate", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "EIPManager", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "PeerAwareInstanceRegistry", "registry", ",", "ApplicationInfoManager", "applicationInfoManager", ")", "{", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "clientConfig", "=", "clientConfig", ";", "this", ".", "registry", "=", "registry", ";", "this", ".", "applicationInfoManager", "=", "applicationInfoManager", ";", "try", "{", "Monitors", ".", "registerObject", "(", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "PostConstruct", "public", "void", "start", "(", ")", "throws", "Exception", "{", "handleEIPBinding", "(", ")", ";", "}", "</s>"]
["<s>", "@", "PreDestroy", "public", "void", "shutdown", "(", ")", "throws", "Exception", "{", "timer", ".", "cancel", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "serverConfig", ".", "getEIPBindRebindRetries", "(", ")", ";", "i", "+", "+", ")", "{", "try", "{", "unbindEIP", "(", ")", ";", "break", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:1000>", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "handleEIPBinding", "(", ")", "throws", "InterruptedException", "{", "int", "retries", "=", "serverConfig", ".", "getEIPBindRebindRetries", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "retries", ";", "i", "+", "+", ")", "{", "try", "{", "if", "(", "isEIPBound", "(", ")", ")", "{", "break", ";", "}", "else", "{", "bindEIP", "(", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "Thread", ".", "sleep", "(", "EIP_BIND_SLEEP_TIME_MS", ")", ";", "}", "}", "scheduleEIPBindTask", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "scheduleEIPBindTask", "(", ")", "{", "timer", ".", "schedule", "(", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "if", "(", "!", "isEIPBound", "(", ")", ")", "{", "registry", ".", "clearRegistry", "(", ")", ";", "int", "count", "=", "registry", ".", "syncUp", "(", ")", ";", "registry", ".", "openForTraffic", "(", "applicationInfoManager", ",", "count", ")", ";", "}", "else", "{", "return", ";", "}", "bindEIP", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ",", "serverConfig", ".", "getEIPBindingRetryIntervalMs", "(", ")", ",", "serverConfig", ".", "getEIPBindingRetryIntervalMs", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "if", "(", "!", "isEIPBound", "(", ")", ")", "{", "registry", ".", "clearRegistry", "(", ")", ";", "int", "count", "=", "registry", ".", "syncUp", "(", ")", ";", "registry", ".", "openForTraffic", "(", "applicationInfoManager", ",", "count", ")", ";", "}", "else", "{", "return", ";", "}", "bindEIP", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "isEIPBound", "(", ")", "{", "InstanceInfo", "myInfo", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ";", "String", "myInstanceId", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "instanceId", ")", ";", "String", "myZone", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "availabilityZone", ")", ";", "String", "myPublicIP", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "publicIpv4", ")", ";", "Collection", "<", "String", ">", "candidateEIPs", "=", "getCandidateEIPs", "(", "myInstanceId", ",", "myZone", ")", ";", "for", "(", "String", "eipEntry", ":", "candidateEIPs", ")", "{", "if", "(", "eipEntry", ".", "equals", "(", "myPublicIP", ")", ")", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "myInstanceId", ",", "myPublicIP", ")", ";", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "void", "bindEIP", "(", ")", "{", "InstanceInfo", "myInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "String", "myInstanceId", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "instanceId", ")", ";", "String", "myZone", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "availabilityZone", ")", ";", "Collection", "<", "String", ">", "candidateEIPs", "=", "getCandidateEIPs", "(", "myInstanceId", ",", "myZone", ")", ";", "AmazonEC2", "ec2Service", "=", "getEC2Service", "(", ")", ";", "boolean", "isMyinstanceAssociatedWithEIP", "=", "false", ";", "Address", "selectedEIP", "=", "null", ";", "for", "(", "String", "eipEntry", ":", "candidateEIPs", ")", "{", "try", "{", "String", "associatedInstanceId", ";", "DescribeAddressesRequest", "describeAddressRequest", "=", "new", "DescribeAddressesRequest", "(", ")", ".", "withPublicIps", "(", "eipEntry", ")", ";", "DescribeAddressesResult", "result", "=", "ec2Service", ".", "describeAddresses", "(", "describeAddressRequest", ")", ";", "if", "(", "(", "result", ".", "getAddresses", "(", ")", "!", "=", "null", ")", "&", "&", "(", "!", "result", ".", "getAddresses", "(", ")", ".", "isEmpty", "(", ")", ")", ")", "{", "Address", "eipAddress", "=", "result", ".", "getAddresses", "(", ")", ".", "get", "(", "0", ")", ";", "associatedInstanceId", "=", "eipAddress", ".", "getInstanceId", "(", ")", ";", "if", "(", "(", "(", "associatedInstanceId", "=", "=", "null", ")", "|", "|", "(", "associatedInstanceId", ".", "isEmpty", "(", ")", ")", ")", ")", "{", "if", "(", "selectedEIP", "=", "=", "null", ")", "{", "selectedEIP", "=", "eipAddress", ";", "}", "}", "else", "if", "(", "isMyinstanceAssociatedWithEIP", "=", "(", "associatedInstanceId", ".", "equals", "(", "myInstanceId", ")", ")", ")", "{", "selectedEIP", "=", "eipAddress", ";", "break", ";", "}", "else", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ",", "eipEntry", ",", "associatedInstanceId", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "eipEntry", ",", "myInstanceId", ",", "t", ")", ";", "}", "}", "if", "(", "null", "!", "=", "selectedEIP", ")", "{", "String", "publicIp", "=", "selectedEIP", ".", "getPublicIp", "(", ")", ";", "if", "(", "!", "isMyinstanceAssociatedWithEIP", ")", "{", "AssociateAddressRequest", "associateAddressRequest", "=", "new", "AssociateAddressRequest", "(", ")", ".", "withInstanceId", "(", "myInstanceId", ")", ";", "String", "domain", "=", "selectedEIP", ".", "getDomain", "(", ")", ";", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "domain", ")", ")", "{", "associateAddressRequest", ".", "setAllocationId", "(", "selectedEIP", ".", "getAllocationId", "(", ")", ")", ";", "}", "else", "{", "associateAddressRequest", ".", "setPublicIp", "(", "publicIp", ")", ";", "}", "ec2Service", ".", "associateAddress", "(", "associateAddressRequest", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ",", "myInstanceId", ",", "myZone", ",", "publicIp", ")", ";", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "myInstanceId", ",", "publicIp", ")", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "candidateEIPs", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "unbindEIP", "(", ")", "throws", "Exception", "{", "InstanceInfo", "myInfo", "=", "applicationInfoManager", ".", "getInfo", "(", ")", ";", "String", "myPublicIP", "=", "null", ";", "if", "(", "myInfo", "!", "=", "null", "&", "&", "myInfo", ".", "getDataCenterInfo", "(", ")", ".", "getName", "(", ")", "=", "=", "Name", ".", "Amazon", ")", "{", "myPublicIP", "=", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "publicIpv4", ")", ";", "try", "{", "AmazonEC2", "ec2Service", "=", "getEC2Service", "(", ")", ";", "DescribeAddressesRequest", "describeAddressRequest", "=", "new", "DescribeAddressesRequest", "(", ")", ".", "withPublicIps", "(", "myPublicIP", ")", ";", "DescribeAddressesResult", "result", "=", "ec2Service", ".", "describeAddresses", "(", "describeAddressRequest", ")", ";", "if", "(", "(", "result", ".", "getAddresses", "(", ")", "!", "=", "null", ")", "&", "&", "(", "!", "result", ".", "getAddresses", "(", ")", ".", "isEmpty", "(", ")", ")", ")", "{", "Address", "eipAddress", "=", "result", ".", "getAddresses", "(", ")", ".", "get", "(", "0", ")", ";", "DisassociateAddressRequest", "dissociateRequest", "=", "new", "DisassociateAddressRequest", "(", ")", ";", "String", "domain", "=", "eipAddress", ".", "getDomain", "(", ")", ";", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "domain", ")", ")", "{", "dissociateRequest", ".", "setAssociationId", "(", "eipAddress", ".", "getAssociationId", "(", ")", ")", ";", "}", "else", "{", "dissociateRequest", ".", "setPublicIp", "(", "eipAddress", ".", "getPublicIp", "(", ")", ")", ";", "}", "ec2Service", ".", "disassociateAddress", "(", "dissociateRequest", ")", ";", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "myPublicIP", ")", ";", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "Collection", "<", "String", ">", "getCandidateEIPs", "(", "String", "myInstanceId", ",", "String", "myZone", ")", "{", "if", "(", "myZone", "=", "=", "null", ")", "{", "myZone", "=", "\"", "<STR_LIT>", "\"", ";", "}", "Collection", "<", "String", ">", "eipCandidates", "=", "clientConfig", ".", "shouldUseDnsForFetchingServiceUrls", "(", ")", "?", "getEIPsForZoneFromDNS", "(", "myZone", ")", ":", "getEIPsForZoneFromConfig", "(", "myZone", ")", ";", "if", "(", "eipCandidates", "=", "=", "null", "|", "|", "eipCandidates", ".", "size", "(", ")", "=", "=", "0", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "myZone", ")", ";", "}", "return", "eipCandidates", ";", "}", "</s>"]
["<s>", "private", "Collection", "<", "String", ">", "getEIPsForZoneFromConfig", "(", "String", "myZone", ")", "{", "List", "<", "String", ">", "ec2Urls", "=", "clientConfig", ".", "getEurekaServerServiceUrls", "(", "myZone", ")", ";", "return", "getEIPsFromServiceUrls", "(", "ec2Urls", ")", ";", "}", "</s>"]
["<s>", "private", "Collection", "<", "String", ">", "getEIPsFromServiceUrls", "(", "List", "<", "String", ">", "ec2Urls", ")", "{", "List", "<", "String", ">", "returnedUrls", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "String", "region", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "String", "regionPhrase", "=", "\"", "\"", ";", "if", "(", "!", "US_EAST_1", ".", "equals", "(", "region", ")", ")", "{", "regionPhrase", "=", "\"", "<STR_LIT:.>", "\"", "+", "region", ";", "}", "for", "(", "String", "cname", ":", "ec2Urls", ")", "{", "int", "beginIndex", "=", "cname", ".", "indexOf", "(", "\"", "<STR_LIT>", "\"", ")", "+", "<NUM_LIT:4>", ";", "int", "endIndex", "=", "cname", ".", "indexOf", "(", "regionPhrase", "+", "\"", "<STR_LIT>", "\"", ")", ";", "String", "eipStr", "=", "cname", ".", "substring", "(", "beginIndex", ",", "endIndex", ")", ";", "String", "eip", "=", "eipStr", ".", "replaceAll", "(", "\"", "<STR_LIT:\\\\>", "<STR_LIT:->", "\"", ",", "\"", "<STR_LIT:.>", "\"", ")", ";", "returnedUrls", ".", "add", "(", "eip", ")", ";", "}", "return", "returnedUrls", ";", "}", "</s>"]
["<s>", "private", "Collection", "<", "String", ">", "getEIPsForZoneFromDNS", "(", "String", "myZone", ")", "{", "List", "<", "String", ">", "ec2Urls", "=", "EndpointUtils", ".", "getServiceUrlsFromDNS", "(", "clientConfig", ",", "myZone", ",", "true", ",", "new", "EndpointUtils", ".", "InstanceInfoBasedUrlRandomizer", "(", "applicationInfoManager", ".", "getInfo", "(", ")", ")", ")", ";", "return", "getEIPsFromServiceUrls", "(", "ec2Urls", ")", ";", "}", "</s>"]
["<s>", "private", "AmazonEC2", "getEC2Service", "(", ")", "{", "String", "aWSAccessId", "=", "serverConfig", ".", "getAWSAccessId", "(", ")", ";", "String", "aWSSecretKey", "=", "serverConfig", ".", "getAWSSecretKey", "(", ")", ";", "AmazonEC2", "ec2Service", ";", "if", "(", "null", "!", "=", "aWSAccessId", "&", "&", "!", "\"", "\"", ".", "equals", "(", "aWSAccessId", ")", "&", "&", "null", "!", "=", "aWSSecretKey", "&", "&", "!", "\"", "\"", ".", "equals", "(", "aWSSecretKey", ")", ")", "{", "ec2Service", "=", "new", "AmazonEC2Client", "(", "new", "BasicAWSCredentials", "(", "aWSAccessId", ",", "aWSSecretKey", ")", ")", ";", "}", "else", "{", "ec2Service", "=", "new", "AmazonEC2Client", "(", "new", "InstanceProfileCredentialsProvider", "(", ")", ")", ";", "}", "String", "region", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "region", "=", "region", ".", "trim", "(", ")", ".", "toLowerCase", "(", ")", ";", "ec2Service", ".", "setEndpoint", "(", "\"", "<STR_LIT>", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", "ec2Service", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "Thread", "thread", "=", "new", "Thread", "(", "r", ",", "\"", "<STR_LIT>", "\"", ")", ";", "thread", ".", "setDaemon", "(", "true", ")", ";", "return", "thread", ";", "}", "</s>"]
["<s>", "@", "Inject", "public", "AwsAsgUtil", "(", "EurekaServerConfig", "serverConfig", ",", "EurekaClientConfig", "clientConfig", ",", "InstanceRegistry", "registry", ")", "{", "this", ".", "serverConfig", "=", "serverConfig", ";", "this", ".", "clientConfig", "=", "clientConfig", ";", "this", ".", "registry", "=", "registry", ";", "this", ".", "asgCache", "=", "CacheBuilder", ".", "newBuilder", "(", ")", ".", "initialCapacity", "(", "<NUM_LIT>", ")", ".", "expireAfterAccess", "(", "serverConfig", ".", "getASGCacheExpiryTimeoutMs", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ".", "build", "(", "new", "CacheLoader", "<", "CacheKey", ",", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "load", "(", "CacheKey", "key", ")", "throws", "Exception", "{", "return", "isASGEnabledinAWS", "(", "key", ".", "asgAccountId", ",", "key", ".", "asgName", ")", ";", "}", "@", "Override", "public", "ListenableFuture", "<", "Boolean", ">", "reload", "(", "final", "CacheKey", "key", ",", "Boolean", "oldValue", ")", "throws", "Exception", "{", "return", "listeningCacheReloadExecutor", ".", "submit", "(", "new", "Callable", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "return", "load", "(", "key", ")", ";", "}", "}", ")", ";", "}", "}", ")", ";", "this", ".", "awsClient", "=", "getAmazonAutoScalingClient", "(", ")", ";", "this", ".", "awsClient", ".", "setEndpoint", "(", "\"", "<STR_LIT:.>", "\"", "+", "clientConfig", ".", "getRegion", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "timer", ".", "schedule", "(", "getASGUpdateTask", "(", ")", ",", "serverConfig", ".", "getASGUpdateIntervalMs", "(", ")", ",", "serverConfig", ".", "getASGUpdateIntervalMs", "(", ")", ")", ";", "try", "{", "Monitors", ".", "registerObject", "(", "this", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "load", "(", "CacheKey", "key", ")", "throws", "Exception", "{", "return", "isASGEnabledinAWS", "(", "key", ".", "asgAccountId", ",", "key", ".", "asgName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Boolean", ">", "reload", "(", "final", "CacheKey", "key", ",", "Boolean", "oldValue", ")", "throws", "Exception", "{", "return", "listeningCacheReloadExecutor", ".", "submit", "(", "new", "Callable", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "return", "load", "(", "key", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "call", "(", ")", "throws", "Exception", "{", "return", "load", "(", "key", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isASGEnabled", "(", "InstanceInfo", "instanceInfo", ")", "{", "CacheKey", "cacheKey", "=", "new", "CacheKey", "(", "getAccountId", "(", "instanceInfo", ",", "accountId", ")", ",", "instanceInfo", ".", "getASGName", "(", ")", ")", ";", "Boolean", "result", "=", "asgCache", ".", "getIfPresent", "(", "cacheKey", ")", ";", "if", "(", "result", "!", "=", "null", ")", "{", "return", "result", ";", "}", "else", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "cacheKey", ".", "asgName", ")", ";", "asgCache", ".", "refresh", "(", "cacheKey", ")", ";", "return", "true", ";", "}", "}", "</s>"]
["<s>", "public", "void", "setStatus", "(", "String", "asgName", ",", "boolean", "enabled", ")", "{", "String", "asgAccountId", "=", "getASGAccount", "(", "asgName", ")", ";", "asgCache", ".", "put", "(", "new", "CacheKey", "(", "asgAccountId", ",", "asgName", ")", ",", "enabled", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isAddToLoadBalancerSuspended", "(", "String", "asgAccountId", ",", "String", "asgName", ")", "{", "AutoScalingGroup", "asg", ";", "if", "(", "asgAccountId", "=", "=", "null", "|", "|", "asgAccountId", ".", "equals", "(", "accountId", ")", ")", "{", "asg", "=", "retrieveAutoScalingGroup", "(", "asgName", ")", ";", "}", "else", "{", "asg", "=", "retrieveAutoScalingGroupCrossAccount", "(", "asgAccountId", ",", "asgName", ")", ";", "}", "if", "(", "asg", "=", "=", "null", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "asgName", ")", ";", "return", "false", ";", "}", "return", "isAddToLoadBalancerSuspended", "(", "asg", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isAddToLoadBalancerSuspended", "(", "AutoScalingGroup", "asg", ")", "{", "List", "<", "SuspendedProcess", ">", "suspendedProcesses", "=", "asg", ".", "getSuspendedProcesses", "(", ")", ";", "for", "(", "SuspendedProcess", "process", ":", "suspendedProcesses", ")", "{", "if", "(", "PROP_ADD_TO_LOAD_BALANCER", ".", "equals", "(", "process", ".", "getProcessName", "(", ")", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "AutoScalingGroup", "retrieveAutoScalingGroup", "(", "String", "asgName", ")", "{", "if", "(", "Strings", ".", "isNullOrEmpty", "(", "asgName", ")", ")", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "DescribeAutoScalingGroupsRequest", "request", "=", "new", "DescribeAutoScalingGroupsRequest", "(", ")", ".", "withAutoScalingGroupNames", "(", "asgName", ")", ";", "DescribeAutoScalingGroupsResult", "result", "=", "awsClient", ".", "describeAutoScalingGroups", "(", "request", ")", ";", "List", "<", "AutoScalingGroup", ">", "asgs", "=", "result", ".", "getAutoScalingGroups", "(", ")", ";", "if", "(", "asgs", ".", "isEmpty", "(", ")", ")", "{", "return", "null", ";", "}", "else", "{", "return", "asgs", ".", "get", "(", "0", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Credentials", "initializeStsSession", "(", "String", "asgAccount", ")", "{", "AWSSecurityTokenService", "sts", "=", "new", "AWSSecurityTokenServiceClient", "(", "new", "InstanceProfileCredentialsProvider", "(", ")", ")", ";", "String", "region", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "if", "(", "!", "region", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "sts", ".", "setEndpoint", "(", "\"", "<STR_LIT:.>", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "String", "roleName", "=", "serverConfig", ".", "getListAutoScalingGroupsRoleName", "(", ")", ";", "String", "roleArn", "=", "\"", "<STR_LIT>", "\"", "+", "asgAccount", "+", "\"", "<STR_LIT>", "\"", "+", "roleName", ";", "AssumeRoleResult", "assumeRoleResult", "=", "sts", ".", "assumeRole", "(", "new", "AssumeRoleRequest", "(", ")", ".", "withRoleArn", "(", "roleArn", ")", ".", "withRoleSessionName", "(", "\"", "<STR_LIT>", "\"", "+", "asgAccount", ")", ")", ";", "return", "assumeRoleResult", ".", "getCredentials", "(", ")", ";", "}", "</s>"]
["<s>", "private", "AutoScalingGroup", "retrieveAutoScalingGroupCrossAccount", "(", "String", "asgAccount", ",", "String", "asgName", ")", "{", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "asgName", "+", "\"", "<STR_LIT>", "\"", "+", "asgAccount", ")", ";", "Credentials", "credentials", "=", "stsCredentials", ".", "get", "(", "asgAccount", ")", ";", "if", "(", "credentials", "=", "=", "null", "|", "|", "credentials", ".", "getExpiration", "(", ")", ".", "getTime", "(", ")", "<", "System", ".", "currentTimeMillis", "(", ")", "+", "<NUM_LIT:1000>", ")", "{", "stsCredentials", ".", "put", "(", "asgAccount", ",", "initializeStsSession", "(", "asgAccount", ")", ")", ";", "credentials", "=", "stsCredentials", ".", "get", "(", "asgAccount", ")", ";", "}", "ClientConfiguration", "clientConfiguration", "=", "new", "ClientConfiguration", "(", ")", ".", "withConnectionTimeout", "(", "serverConfig", ".", "getASGQueryTimeoutMs", "(", ")", ")", ";", "AmazonAutoScaling", "autoScalingClient", "=", "new", "AmazonAutoScalingClient", "(", "new", "BasicSessionCredentials", "(", "credentials", ".", "getAccessKeyId", "(", ")", ",", "credentials", ".", "getSecretAccessKey", "(", ")", ",", "credentials", ".", "getSessionToken", "(", ")", ")", ",", "clientConfiguration", ")", ";", "String", "region", "=", "clientConfig", ".", "getRegion", "(", ")", ";", "if", "(", "!", "region", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "autoScalingClient", ".", "setEndpoint", "(", "\"", "<STR_LIT:.>", "\"", "+", "region", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "DescribeAutoScalingGroupsRequest", "request", "=", "new", "DescribeAutoScalingGroupsRequest", "(", ")", ".", "withAutoScalingGroupNames", "(", "asgName", ")", ";", "DescribeAutoScalingGroupsResult", "result", "=", "autoScalingClient", ".", "describeAutoScalingGroups", "(", "request", ")", ";", "List", "<", "AutoScalingGroup", ">", "asgs", "=", "result", ".", "getAutoScalingGroups", "(", ")", ";", "if", "(", "asgs", ".", "isEmpty", "(", ")", ")", "{", "return", "null", ";", "}", "else", "{", "return", "asgs", ".", "get", "(", "0", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Boolean", "isASGEnabledinAWS", "(", "String", "asgAccountid", ",", "String", "asgName", ")", "{", "try", "{", "Stopwatch", "t", "=", "this", ".", "loadASGInfoTimer", ".", "start", "(", ")", ";", "boolean", "returnValue", "=", "!", "isAddToLoadBalancerSuspended", "(", "asgAccountid", ",", "asgName", ")", ";", "t", ".", "stop", "(", ")", ";", "return", "returnValue", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "return", "Boolean", ".", "TRUE", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "GAUGE", ")", "public", "long", "getNumberofElementsinASGCache", "(", ")", "{", "return", "asgCache", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "COUNTER", ")", "public", "long", "getNumberofASGQueries", "(", ")", "{", "return", "asgCache", ".", "stats", "(", ")", ".", "loadCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "com", ".", "netflix", ".", "servo", ".", "annotations", ".", "Monitor", "(", "name", "=", "\"", "<STR_LIT>", "\"", ",", "description", "=", "\"", "<STR_LIT>", "\"", ",", "type", "=", "DataSourceType", ".", "COUNTER", ")", "public", "long", "getNumberofASGQueryFailures", "(", ")", "{", "return", "asgCache", ".", "stats", "(", ")", ".", "loadExceptionCount", "(", ")", ";", "}", "</s>"]
["<s>", "private", "TimerTask", "getASGUpdateTask", "(", ")", "{", "return", "new", "TimerTask", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "Set", "<", "CacheKey", ">", "cacheKeys", "=", "getCacheKeys", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "cacheKeys", ".", "toArray", "(", ")", ")", ")", ";", "for", "(", "CacheKey", "key", ":", "cacheKeys", ")", "{", "try", "{", "asgCache", ".", "refresh", "(", "key", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "key", ",", "e", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "Set", "<", "CacheKey", ">", "cacheKeys", "=", "getCacheKeys", "(", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "Arrays", ".", "toString", "(", "cacheKeys", ".", "toArray", "(", ")", ")", ")", ";", "for", "(", "CacheKey", "key", ":", "cacheKeys", ")", "{", "try", "{", "asgCache", ".", "refresh", "(", "key", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "key", ",", "e", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "e", ")", "{", "logger", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Set", "<", "CacheKey", ">", "getCacheKeys", "(", ")", "{", "Set", "<", "CacheKey", ">", "cacheKeys", "=", "new", "HashSet", "<", "CacheKey", ">", "(", ")", ";", "Applications", "apps", "=", "registry", ".", "getApplicationsFromLocalRegionOnly", "(", ")", ";", "for", "(", "Application", "app", ":", "apps", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instanceInfo", ":", "app", ".", "getInstances", "(", ")", ")", "{", "String", "localAccountId", "=", "getAccountId", "(", "instanceInfo", ",", "accountId", ")", ";", "String", "asgName", "=", "instanceInfo", ".", "getASGName", "(", ")", ";", "if", "(", "asgName", "!", "=", "null", ")", "{", "CacheKey", "key", "=", "new", "CacheKey", "(", "localAccountId", ",", "asgName", ")", ";", "cacheKeys", ".", "add", "(", "key", ")", ";", "}", "}", "}", "return", "cacheKeys", ";", "}", "</s>"]
["<s>", "private", "String", "getASGAccount", "(", "String", "asgName", ")", "{", "Applications", "apps", "=", "registry", ".", "getApplicationsFromLocalRegionOnly", "(", ")", ";", "for", "(", "Application", "app", ":", "apps", ".", "getRegisteredApplications", "(", ")", ")", "{", "for", "(", "InstanceInfo", "instanceInfo", ":", "app", ".", "getInstances", "(", ")", ")", "{", "String", "thisAsgName", "=", "instanceInfo", ".", "getASGName", "(", ")", ";", "if", "(", "thisAsgName", "!", "=", "null", "&", "&", "thisAsgName", ".", "equals", "(", "asgName", ")", ")", "{", "String", "localAccountId", "=", "getAccountId", "(", "instanceInfo", ",", "null", ")", ";", "if", "(", "localAccountId", "!", "=", "null", ")", "{", "return", "localAccountId", ";", "}", "}", "}", "}", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "asgName", ")", ";", "return", "accountId", ";", "}", "</s>"]
["<s>", "private", "String", "getAccountId", "(", "InstanceInfo", "instanceInfo", ",", "String", "fallbackId", ")", "{", "String", "localAccountId", "=", "null", ";", "DataCenterInfo", "dataCenterInfo", "=", "instanceInfo", ".", "getDataCenterInfo", "(", ")", ";", "if", "(", "dataCenterInfo", "instanceof", "AmazonInfo", ")", "{", "localAccountId", "=", "(", "(", "AmazonInfo", ")", "dataCenterInfo", ")", ".", "get", "(", "MetaDataKey", ".", "accountId", ")", ";", "}", "return", "localAccountId", "=", "=", "null", "?", "fallbackId", ":", "localAccountId", ";", "}", "</s>"]
["<s>", "private", "AmazonAutoScaling", "getAmazonAutoScalingClient", "(", ")", "{", "String", "aWSAccessId", "=", "serverConfig", ".", "getAWSAccessId", "(", ")", ";", "String", "aWSSecretKey", "=", "serverConfig", ".", "getAWSSecretKey", "(", ")", ";", "ClientConfiguration", "clientConfiguration", "=", "new", "ClientConfiguration", "(", ")", ".", "withConnectionTimeout", "(", "serverConfig", ".", "getASGQueryTimeoutMs", "(", ")", ")", ";", "if", "(", "null", "!", "=", "aWSAccessId", "&", "&", "!", "\"", "\"", ".", "equals", "(", "aWSAccessId", ")", "&", "&", "null", "!", "=", "aWSSecretKey", "&", "&", "!", "\"", "\"", ".", "equals", "(", "aWSSecretKey", ")", ")", "{", "return", "new", "AmazonAutoScalingClient", "(", "new", "BasicAWSCredentials", "(", "aWSAccessId", ",", "aWSSecretKey", ")", ",", "clientConfiguration", ")", ";", "}", "else", "{", "return", "new", "AmazonAutoScalingClient", "(", "new", "InstanceProfileCredentialsProvider", "(", ")", ",", "clientConfiguration", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "String", "getAccountId", "(", ")", "{", "InstanceInfo", "myInfo", "=", "ApplicationInfoManager", ".", "getInstance", "(", ")", ".", "getInfo", "(", ")", ";", "return", "(", "(", "AmazonInfo", ")", "myInfo", ".", "getDataCenterInfo", "(", ")", ")", ".", "get", "(", "MetaDataKey", ".", "accountId", ")", ";", "}", "</s>"]
["<s>", "CacheKey", "(", "String", "asgAccountId", ",", "String", "asgName", ")", "{", "this", ".", "asgAccountId", "=", "asgAccountId", ";", "this", ".", "asgName", "=", "asgName", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "asgName", "+", "<STR_LIT>", "+", "\"", "<STR_LIT>", "\"", "+", "asgAccountId", "+", "<STR_LIT>", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "!", "(", "o", "instanceof", "CacheKey", ")", ")", "return", "false", ";", "CacheKey", "cacheKey", "=", "(", "CacheKey", ")", "o", ";", "if", "(", "asgAccountId", "!", "=", "null", "?", "!", "asgAccountId", ".", "equals", "(", "cacheKey", ".", "asgAccountId", ")", ":", "cacheKey", ".", "asgAccountId", "!", "=", "null", ")", "return", "false", ";", "if", "(", "asgName", "!", "=", "null", "?", "!", "asgName", ".", "equals", "(", "cacheKey", ".", "asgName", ")", ":", "cacheKey", ".", "asgName", "!", "=", "null", ")", "return", "false", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "int", "result", "=", "asgName", "!", "=", "null", "?", "asgName", ".", "hashCode", "(", ")", ":", "0", ";", "result", "=", "<NUM_LIT:31>", "*", "result", "+", "(", "asgAccountId", "!", "=", "null", "?", "asgAccountId", ".", "hashCode", "(", ")", ":", "0", ")", ";", "return", "result", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInstanceInfoStream", "(", ")", "throws", "Exception", "{", "Iterator", "<", "InstanceInfo", ">", "it", "=", "InstanceInfoGenerator", ".", "newBuilder", "(", "<NUM_LIT:4>", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ".", "build", "(", ")", ".", "serviceIterator", "(", ")", ";", "assertThat", "(", "it", ".", "next", "(", ")", ".", "getAppName", "(", ")", ",", "is", "(", "equalTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "assertThat", "(", "it", ".", "next", "(", ")", ".", "getAppName", "(", ")", ",", "is", "(", "equalTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "assertThat", "(", "it", ".", "next", "(", ")", ".", "getAppName", "(", ")", ",", "is", "(", "equalTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "assertThat", "(", "it", ".", "next", "(", ")", ".", "getAppName", "(", ")", ",", "is", "(", "equalTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "InterruptedException", "{", "String", "discoveryURL", "=", "args", "[", "0", "]", ";", "long", "startTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "EurekaServerConfig", "serverConfig", "=", "new", "DefaultEurekaServerConfig", "(", "\"", "<STR_LIT:.>", "\"", ")", ";", "JerseyReplicationClient", "client", "=", "new", "JerseyReplicationClient", "(", "serverConfig", ",", "new", "DefaultServerCodecs", "(", "serverConfig", ")", ",", "discoveryURL", ")", ";", "Applications", "applications", "=", "client", ".", "getApplications", "(", ")", ".", "getEntity", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "applications", ".", "getRegisteredApplications", "(", ")", ".", "size", "(", ")", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "countInstances", "(", "applications", ")", ")", ";", "while", "(", "true", ")", "{", "long", "delay", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "startTime", ";", "if", "(", "delay", ">", "=", "<NUM_LIT>", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "long", "waitTime", "=", "<NUM_LIT:30>", "*", "<NUM_LIT:1000>", "-", "delay", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "waitTime", "/", "<NUM_LIT:1000>", "+", "\"", "<STR_LIT>", "\"", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:15>", "*", "<NUM_LIT:1000>", ")", ";", "}", "startTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "Applications", "delta", "=", "client", ".", "getDelta", "(", ")", ".", "getEntity", "(", ")", ";", "Applications", "merged", "=", "EurekaEntityFunctions", ".", "mergeApplications", "(", "applications", ",", "delta", ")", ";", "if", "(", "merged", ".", "getAppsHashCode", "(", ")", ".", "equals", "(", "delta", ".", "getAppsHashCode", "(", ")", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "delta", ".", "getAppsHashCode", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "countInstances", "(", "delta", ")", "+", "<CHAR_LIT:)>", ")", ";", "applications", "=", "merged", ";", "}", "else", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "delta", ".", "getAppsHashCode", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "merged", ".", "getAppsHashCode", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "applications", ".", "getAppsHashCode", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "countInstances", "(", "delta", ")", "+", "<CHAR_LIT:)>", ")", ";", "applications", "=", "client", ".", "getApplications", "(", ")", ".", "getEntity", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "InstanceInfoGenerator", "(", "InstanceInfoGeneratorBuilder", "builder", ")", "{", "this", ".", "instanceCount", "=", "builder", ".", "instanceCount", ";", "this", ".", "appNames", "=", "builder", ".", "appNames", ";", "this", ".", "zone", "=", "builder", ".", "zone", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "builder", ".", "zone", ";", "this", ".", "taggedId", "=", "builder", ".", "taggedId", ";", "this", ".", "withMetaData", "=", "builder", ".", "includeMetaData", ";", "this", ".", "includeAsg", "=", "builder", ".", "includeAsg", ";", "this", ".", "useInstanceId", "=", "builder", ".", "useInstanceId", ";", "}", "</s>"]
["<s>", "public", "Applications", "takeDelta", "(", "int", "count", ")", "{", "if", "(", "currentIt", "=", "=", "null", ")", "{", "currentIt", "=", "serviceIterator", "(", ")", ";", "allApplications", "=", "new", "Applications", "(", ")", ";", "}", "List", "<", "InstanceInfo", ">", "instanceBatch", "=", "new", "ArrayList", "<", "InstanceInfo", ">", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "InstanceInfo", "next", "=", "currentIt", ".", "next", "(", ")", ";", "next", ".", "setActionType", "(", "ActionType", ".", "ADDED", ")", ";", "instanceBatch", ".", "add", "(", "next", ")", ";", "}", "Applications", "nextBatch", "=", "EurekaEntityFunctions", ".", "toApplications", "(", "toApplicationMap", "(", "instanceBatch", ")", ")", ";", "allApplications", "=", "mergeApplications", "(", "allApplications", ",", "nextBatch", ")", ";", "nextBatch", ".", "setAppsHashCode", "(", "allApplications", ".", "getAppsHashCode", "(", ")", ")", ";", "return", "nextBatch", ";", "}", "</s>"]
["<s>", "public", "Iterator", "<", "InstanceInfo", ">", "serviceIterator", "(", ")", "{", "return", "new", "Iterator", "<", "InstanceInfo", ">", "(", ")", "{", "private", "int", "returned", ";", "private", "final", "int", "[", "]", "appInstanceIds", "=", "new", "int", "[", "appNames", ".", "length", "]", ";", "private", "int", "currentApp", ";", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "returned", "<", "instanceCount", ";", "}", "@", "Override", "public", "InstanceInfo", "next", "(", ")", "{", "if", "(", "!", "hasNext", "(", ")", ")", "{", "throw", "new", "NoSuchElementException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "InstanceInfo", "toReturn", "=", "generateInstanceInfo", "(", "currentApp", ",", "appInstanceIds", "[", "currentApp", "]", ",", "useInstanceId", ")", ";", "appInstanceIds", "[", "currentApp", "]", "+", "+", ";", "currentApp", "=", "(", "currentApp", "+", "1", ")", "%", "appNames", ".", "length", ";", "returned", "+", "+", ";", "return", "toReturn", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "returned", "<", "instanceCount", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InstanceInfo", "next", "(", ")", "{", "if", "(", "!", "hasNext", "(", ")", ")", "{", "throw", "new", "NoSuchElementException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "InstanceInfo", "toReturn", "=", "generateInstanceInfo", "(", "currentApp", ",", "appInstanceIds", "[", "currentApp", "]", ",", "useInstanceId", ")", ";", "appInstanceIds", "[", "currentApp", "]", "+", "+", ";", "currentApp", "=", "(", "currentApp", "+", "1", ")", "%", "appNames", ".", "length", ";", "returned", "+", "+", ";", "return", "toReturn", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "Applications", "toApplications", "(", ")", "{", "Map", "<", "String", ",", "Application", ">", "appsByName", "=", "new", "HashMap", "<", ">", "(", ")", ";", "Iterator", "<", "InstanceInfo", ">", "it", "=", "serviceIterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "InstanceInfo", "instanceInfo", "=", "it", ".", "next", "(", ")", ";", "Application", "instanceApp", "=", "appsByName", ".", "get", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "if", "(", "instanceApp", "=", "=", "null", ")", "{", "instanceApp", "=", "new", "Application", "(", "instanceInfo", ".", "getAppName", "(", ")", ")", ";", "appsByName", ".", "put", "(", "instanceInfo", ".", "getAppName", "(", ")", ",", "instanceApp", ")", ";", "}", "instanceApp", ".", "addInstance", "(", "instanceInfo", ")", ";", "}", "Applications", "applications", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "app", ":", "appsByName", ".", "values", "(", ")", ")", "{", "applications", ".", "addApplication", "(", "app", ")", ";", "}", "applications", ".", "setAppsHashCode", "(", "applications", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "applications", ";", "}", "</s>"]
["<s>", "public", "List", "<", "InstanceInfo", ">", "toInstanceList", "(", ")", "{", "List", "<", "InstanceInfo", ">", "result", "=", "new", "ArrayList", "<", ">", "(", "instanceCount", ")", ";", "Iterator", "<", "InstanceInfo", ">", "it", "=", "serviceIterator", "(", ")", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "InstanceInfo", "instanceInfo", "=", "it", ".", "next", "(", ")", ";", "result", ".", "add", "(", "instanceInfo", ")", ";", "}", "return", "result", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfo", "takeOne", "(", ")", "{", "return", "newBuilder", "(", "1", ",", "1", ")", ".", "withMetaData", "(", "true", ")", ".", "build", "(", ")", ".", "serviceIterator", "(", ")", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfoGeneratorBuilder", "newBuilder", "(", "int", "instanceCount", ",", "int", "applicationCount", ")", "{", "return", "new", "InstanceInfoGeneratorBuilder", "(", "instanceCount", ",", "applicationCount", ")", ";", "}", "</s>"]
["<s>", "public", "static", "InstanceInfoGeneratorBuilder", "newBuilder", "(", "int", "instanceCount", ",", "String", ".", ".", ".", "appNames", ")", "{", "return", "new", "InstanceInfoGeneratorBuilder", "(", "instanceCount", ",", "appNames", ")", ";", "}", "</s>"]
["<s>", "private", "InstanceInfo", "generateInstanceInfo", "(", "int", "appIndex", ",", "int", "appInstanceId", ",", "boolean", "useInstanceId", ")", "{", "String", "appName", "=", "appNames", "[", "appIndex", "]", ";", "String", "hostName", "=", "\"", "<STR_LIT>", "\"", "+", "appInstanceId", "+", "<CHAR_LIT:.>", "+", "appName", "+", "\"", "<STR_LIT>", "\"", ";", "String", "privateHostname", "=", "\"", "<STR_LIT>", "\"", "+", "appIndex", "+", "\"", "<STR_LIT:.>", "\"", "+", "appInstanceId", "+", "\"", "<STR_LIT>", "\"", ";", "String", "publicIp", "=", "\"", "<STR_LIT>", "\"", "+", "appIndex", "+", "<CHAR_LIT:.>", "+", "appInstanceId", ";", "String", "privateIp", "=", "\"", "<STR_LIT>", "\"", "+", "appIndex", "+", "<CHAR_LIT:.>", "+", "appInstanceId", ";", "String", "instanceId", "=", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "appIndex", ",", "appInstanceId", ")", ";", "if", "(", "taggedId", ")", "{", "instanceId", "=", "instanceId", "+", "<CHAR_LIT:_>", "+", "appName", ";", "}", "AmazonInfo", "dataCenterInfo", "=", "AmazonInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "accountId", ",", "\"", "<STR_LIT>", "\"", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "amiId", ",", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "appIndex", ",", "appInstanceId", ")", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "availabilityZone", ",", "zone", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "instanceId", ",", "instanceId", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "instanceType", ",", "\"", "<STR_LIT>", "\"", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "localHostname", ",", "privateHostname", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "localIpv4", ",", "privateIp", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "publicHostname", ",", "hostName", ")", ".", "addMetadata", "(", "MetaDataKey", ".", "publicIpv4", ",", "publicIp", ")", ".", "build", "(", ")", ";", "String", "unsecureURL", "=", "\"", "<STR_LIT>", "\"", "+", "hostName", "+", "\"", "<STR_LIT>", "\"", ";", "String", "secureURL", "=", "\"", "<STR_LIT>", "\"", "+", "hostName", "+", "\"", "<STR_LIT>", "\"", ";", "long", "now", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "LeaseInfo", "leaseInfo", "=", "LeaseInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setDurationInSecs", "(", "<NUM_LIT:3>", "*", "RENEW_INTERVAL", ")", ".", "setRenewalIntervalInSecs", "(", "RENEW_INTERVAL", ")", ".", "setServiceUpTimestamp", "(", "now", "-", "RENEW_INTERVAL", ")", ".", "setRegistrationTimestamp", "(", "now", ")", ".", "setEvictionTimestamp", "(", "now", "+", "<NUM_LIT:3>", "*", "RENEW_INTERVAL", ")", ".", "setRenewalTimestamp", "(", "now", "+", "RENEW_INTERVAL", ")", ".", "build", "(", ")", ";", "Builder", "builder", "=", "useInstanceId", "?", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ".", "setInstanceId", "(", "instanceId", ")", ":", "InstanceInfo", ".", "Builder", ".", "newBuilder", "(", ")", ";", "builder", ".", "setActionType", "(", "ActionType", ".", "ADDED", ")", ".", "setAppGroupName", "(", "appName", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setAppName", "(", "appName", ")", ".", "setHostName", "(", "hostName", ")", ".", "setIPAddr", "(", "publicIp", ")", ".", "setPort", "(", "<NUM_LIT>", ")", ".", "setSecurePort", "(", "<NUM_LIT>", ")", ".", "enablePort", "(", "PortType", ".", "SECURE", ",", "true", ")", ".", "setHealthCheckUrls", "(", "\"", "<STR_LIT>", "\"", ",", "unsecureURL", "+", "\"", "<STR_LIT>", "\"", ",", "secureURL", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setHomePageUrl", "(", "\"", "<STR_LIT>", "\"", ",", "unsecureURL", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setStatusPageUrl", "(", "\"", "<STR_LIT>", "\"", ",", "unsecureURL", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setLeaseInfo", "(", "leaseInfo", ")", ".", "setStatus", "(", "InstanceStatus", ".", "UP", ")", ".", "setVIPAddress", "(", "hostName", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setSecureVIPAddress", "(", "hostName", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setDataCenterInfo", "(", "dataCenterInfo", ")", ".", "setLastUpdatedTimestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "<NUM_LIT:100>", ")", ".", "setLastDirtyTimestamp", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "<NUM_LIT:100>", ")", ".", "setIsCoordinatingDiscoveryServer", "(", "true", ")", ".", "enablePort", "(", "PortType", ".", "UNSECURE", ",", "true", ")", ";", "if", "(", "includeAsg", ")", "{", "builder", ".", "setASGName", "(", "appName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "withMetaData", ")", "{", "builder", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "appIndex", ",", "Integer", ".", "toString", "(", "appInstanceId", ")", ")", ";", "}", "return", "builder", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "(", "int", "instanceCount", ",", "int", "applicationCount", ")", "{", "this", ".", "instanceCount", "=", "instanceCount", ";", "String", "[", "]", "appNames", "=", "new", "String", "[", "applicationCount", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "appNames", ".", "length", ";", "i", "+", "+", ")", "{", "appNames", "[", "i", "]", "=", "\"", "<STR_LIT>", "\"", "+", "i", ";", "}", "this", ".", "appNames", "=", "appNames", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "(", "int", "instanceCount", ",", "String", ".", ".", ".", "appNames", ")", "{", "this", ".", "instanceCount", "=", "instanceCount", ";", "this", ".", "appNames", "=", "appNames", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "withZone", "(", "String", "zone", ")", "{", "this", ".", "zone", "=", "zone", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "withTaggedId", "(", "boolean", "taggedId", ")", "{", "this", ".", "taggedId", "=", "taggedId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "withMetaData", "(", "boolean", "includeMetaData", ")", "{", "this", ".", "includeMetaData", "=", "includeMetaData", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "withAsg", "(", "boolean", "includeAsg", ")", "{", "this", ".", "includeAsg", "=", "includeAsg", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGeneratorBuilder", "withUseInstanceId", "(", "boolean", "useInstanceId", ")", "{", "this", ".", "useInstanceId", "=", "useInstanceId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "InstanceInfoGenerator", "build", "(", ")", "{", "return", "new", "InstanceInfoGenerator", "(", "this", ")", ";", "}", "</s>"]
["<s>", "private", "ApplicationFunctions", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "Map", "<", "String", ",", "Application", ">", "toApplicationMap", "(", "List", "<", "InstanceInfo", ">", "instances", ")", "{", "Map", "<", "String", ",", "Application", ">", "applicationMap", "=", "new", "HashMap", "<", "String", ",", "Application", ">", "(", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "instances", ")", "{", "String", "appName", "=", "instance", ".", "getAppName", "(", ")", ";", "Application", "application", "=", "applicationMap", ".", "get", "(", "appName", ")", ";", "if", "(", "application", "=", "=", "null", ")", "{", "applicationMap", ".", "put", "(", "appName", ",", "application", "=", "new", "Application", "(", "appName", ")", ")", ";", "}", "application", ".", "addInstance", "(", "instance", ")", ";", "}", "return", "applicationMap", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "toApplications", "(", "Map", "<", "String", ",", "Application", ">", "applicationMap", ")", "{", "Applications", "applications", "=", "new", "Applications", "(", ")", ";", "for", "(", "Application", "application", ":", "applicationMap", ".", "values", "(", ")", ")", "{", "applications", ".", "addApplication", "(", "application", ")", ";", "}", "return", "updateMeta", "(", "applications", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Set", "<", "String", ">", "applicationNames", "(", "Applications", "applications", ")", "{", "Set", "<", "String", ">", "names", "=", "new", "HashSet", "<", "String", ">", "(", ")", ";", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "names", ".", "add", "(", "application", ".", "getName", "(", ")", ")", ";", "}", "return", "names", ";", "}", "</s>"]
["<s>", "public", "static", "Application", "copyOf", "(", "Application", "application", ")", "{", "Application", "copy", "=", "new", "Application", "(", "application", ".", "getName", "(", ")", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "application", ".", "getInstances", "(", ")", ")", "{", "copy", ".", "addInstance", "(", "instance", ")", ";", "}", "return", "copy", ";", "}", "</s>"]
["<s>", "public", "static", "Application", "merge", "(", "Application", "first", ",", "Application", "second", ")", "{", "if", "(", "!", "first", ".", "getName", "(", ")", ".", "equals", "(", "second", ".", "getName", "(", ")", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Application", "merged", "=", "copyOf", "(", "first", ")", ";", "for", "(", "InstanceInfo", "instance", ":", "second", ".", "getInstances", "(", ")", ")", "{", "switch", "(", "instance", ".", "getActionType", "(", ")", ")", "{", "case", "ADDED", ":", "case", "MODIFIED", ":", "merged", ".", "addInstance", "(", "instance", ")", ";", "break", ";", "case", "DELETED", ":", "merged", ".", "removeInstance", "(", "instance", ")", ";", "}", "}", "return", "merged", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "merge", "(", "Applications", "first", ",", "Applications", "second", ")", "{", "Set", "<", "String", ">", "firstNames", "=", "applicationNames", "(", "first", ")", ";", "Set", "<", "String", ">", "secondNames", "=", "applicationNames", "(", "second", ")", ";", "Set", "<", "String", ">", "allNames", "=", "new", "HashSet", "<", "String", ">", "(", "firstNames", ")", ";", "allNames", ".", "addAll", "(", "secondNames", ")", ";", "Applications", "merged", "=", "new", "Applications", "(", ")", ";", "for", "(", "String", "appName", ":", "allNames", ")", "{", "if", "(", "firstNames", ".", "contains", "(", "appName", ")", ")", "{", "if", "(", "secondNames", ".", "contains", "(", "appName", ")", ")", "{", "merged", ".", "addApplication", "(", "merge", "(", "first", ".", "getRegisteredApplications", "(", "appName", ")", ",", "second", ".", "getRegisteredApplications", "(", "appName", ")", ")", ")", ";", "}", "else", "{", "merged", ".", "addApplication", "(", "copyOf", "(", "first", ".", "getRegisteredApplications", "(", "appName", ")", ")", ")", ";", "}", "}", "else", "{", "merged", ".", "addApplication", "(", "copyOf", "(", "second", ".", "getRegisteredApplications", "(", "appName", ")", ")", ")", ";", "}", "}", "return", "updateMeta", "(", "merged", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Applications", "updateMeta", "(", "Applications", "applications", ")", "{", "applications", ".", "setVersion", "(", "<NUM_LIT>", ")", ";", "applications", ".", "setAppsHashCode", "(", "applications", ".", "getReconcileHashCode", "(", ")", ")", ";", "return", "applications", ";", "}", "</s>"]
["<s>", "public", "static", "int", "countInstances", "(", "Applications", "applications", ")", "{", "int", "count", "=", "0", ";", "for", "(", "Application", "application", ":", "applications", ".", "getRegisteredApplications", "(", ")", ")", "{", "count", "+", "=", "application", ".", "getInstances", "(", ")", ".", "size", "(", ")", ";", "}", "return", "count", ";", "}", "</s>"]
