["<s>", "@", "JsonProperty", "public", "Set", "<", "String", ">", "getRequestAttributes", "(", ")", "{", "return", "requestAttributes", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "void", "setRequestAttributes", "(", "Set", "<", "String", ">", "requestAttributes", ")", "{", "this", ".", "requestAttributes", "=", "requestAttributes", ";", "}", "</s>"]
["<s>", "private", "Map", "<", "String", ",", "String", ">", "filterRequestAttributes", "(", "Set", "<", "String", ">", "requestAttributeNames", ",", "IAccessEvent", "event", ")", "{", "return", "requestAttributeNames", ".", "stream", "(", ")", ".", "filter", "(", "name", "-", ">", "event", ".", "getAttribute", "(", "name", ")", "!", "=", "null", ")", ".", "collect", "(", "Collectors", ".", "toMap", "(", "Function", ".", "identity", "(", ")", ",", "event", ":", ":", "getAttribute", ")", ")", ";", "}", "</s>"]
["<s>", "public", "Set", "<", "String", ">", "getRequestAttributes", "(", ")", "{", "return", "requestAttributes", ";", "}", "</s>"]
["<s>", "public", "void", "setRequestAttributes", "(", "Set", "<", "String", ">", "requestAttributes", ")", "{", "final", "TreeSet", "<", "String", ">", "attributes", "=", "new", "TreeSet", "<", ">", "(", "String", ":", ":", "compareToIgnoreCase", ")", ";", "attributes", ".", "addAll", "(", "requestAttributes", ")", ";", "this", ".", "requestAttributes", "=", "attributes", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRequestAttributes", "(", ")", "{", "final", "String", "attribute1", "=", "\"", "<STR_LIT:1>", "\"", ";", "final", "String", "attribute2", "=", "\"", "<STR_LIT:2>", "\"", ";", "final", "String", "attribute3", "=", "\"", "<STR_LIT:3>", "\"", ";", "final", "Map", "<", "String", ",", "String", ">", "attributes", "=", "Maps", ".", "of", "(", "attribute1", ",", "\"", "<STR_LIT:1>", "\"", ",", "attribute2", ",", "\"", "<STR_LIT:2>", "\"", ",", "attribute3", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "when", "(", "event", ".", "getAttribute", "(", "eq", "(", "attribute1", ")", ")", ")", ".", "thenReturn", "(", "attributes", ".", "get", "(", "attribute1", ")", ")", ";", "when", "(", "event", ".", "getAttribute", "(", "eq", "(", "attribute2", ")", ")", ")", ".", "thenReturn", "(", "attributes", ".", "get", "(", "attribute2", ")", ")", ";", "when", "(", "event", ".", "getAttribute", "(", "eq", "(", "attribute3", ")", ")", ")", ".", "thenReturn", "(", "attributes", ".", "get", "(", "attribute3", ")", ")", ";", "accessJsonLayout", ".", "setRequestAttributes", "(", "attributes", ".", "keySet", "(", ")", ")", ";", "assertThat", "(", "accessJsonLayout", ".", "toJsonMap", "(", "event", ")", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "attributes", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRequestAttributesWithNull", "(", ")", "{", "final", "String", "attribute1", "=", "\"", "<STR_LIT:1>", "\"", ";", "final", "String", "attribute2", "=", "\"", "<STR_LIT:2>", "\"", ";", "final", "String", "attribute3", "=", "\"", "<STR_LIT:3>", "\"", ";", "final", "Map", "<", "String", ",", "String", ">", "attributes", "=", "Maps", ".", "of", "(", "attribute1", ",", "\"", "<STR_LIT:1>", "\"", ",", "attribute2", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "when", "(", "event", ".", "getAttribute", "(", "eq", "(", "attribute1", ")", ")", ")", ".", "thenReturn", "(", "attributes", ".", "get", "(", "attribute1", ")", ")", ";", "when", "(", "event", ".", "getAttribute", "(", "eq", "(", "attribute2", ")", ")", ")", ".", "thenReturn", "(", "attributes", ".", "get", "(", "attribute2", ")", ")", ";", "when", "(", "event", ".", "getAttribute", "(", "eq", "(", "attribute3", ")", ")", ")", ".", "thenReturn", "(", "null", ")", ";", "accessJsonLayout", ".", "setRequestAttributes", "(", "Sets", ".", "of", "(", "attribute1", ",", "attribute2", ",", "attribute3", ")", ")", ";", "assertThat", "(", "accessJsonLayout", ".", "toJsonMap", "(", "event", ")", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "Maps", ".", "of", "(", "attribute1", ",", "\"", "<STR_LIT:1>", "\"", ",", "attribute2", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "HttpClientBuilder", "createBuilder", "(", ")", "{", "return", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "HttpClientBuilder", ".", "create", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "AnotherHttpClientBuilder", "create", "(", ")", "{", "return", "new", "AnotherHttpClientBuilder", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "org", ".", "apache", ".", "http", ".", "impl", ".", "client", ".", "HttpClientBuilder", "createBuilder", "(", ")", "{", "return", "builder", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "buildWithAnotherBuilder", "(", ")", "throws", "Exception", "{", "CustomBuilder", "builder", "=", "new", "CustomBuilder", "(", "new", "MetricRegistry", "(", ")", ",", "anotherApacheBuilder", ")", ";", "builder", ".", "build", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "FieldUtils", ".", "getField", "(", "httpClientBuilderClass", ",", "\"", "<STR_LIT>", "\"", ",", "true", ")", ".", "get", "(", "anotherApacheBuilder", ")", ")", ".", "isInstanceOf", "(", "CustomRequestExecutor", ".", "class", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "isJava8", "(", ")", "{", "final", "String", "specVersion", "=", "getJavaSpecVersion", "(", ")", ";", "return", "specVersion", "!", "=", "null", "&", "&", "specVersion", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "private", "static", "String", "getJavaSpecVersion", "(", ")", "{", "try", "{", "return", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "final", "SecurityException", "ex", ")", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "isJava8_returns_false_if_specVersion_cannot_be_read", "(", ")", "{", "System", ".", "clearProperty", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "JavaVersion", ".", "isJava8", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "isJava8_returns_true_if_specVersion_is_Java_8", "(", ")", "{", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "JavaVersion", ".", "isJava8", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "isJava8_returns_true_if_specVersion_is_Java_11", "(", ")", "{", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "JavaVersion", ".", "isJava8", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "HttpRequestExecutor", "createRequestExecutor", "(", "String", "name", ")", "{", "return", "new", "InstrumentedHttpRequestExecutor", "(", "metricRegistry", ",", "metricNameStrategy", ",", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "HttpRequestExecutor", "createRequestExecutor", "(", "String", "name", ")", "{", "return", "new", "CustomRequestExecutor", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testSerialization", "(", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "final", "DataSize", "size", "=", "DataSize", ".", "kibibytes", "(", "<NUM_LIT>", ")", ";", "final", "byte", "[", "]", "bytes", ";", "try", "(", "final", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "final", "ObjectOutputStream", "objectOutputStream", "=", "new", "ObjectOutputStream", "(", "outputStream", ")", ")", "{", "objectOutputStream", ".", "writeObject", "(", "size", ")", ";", "bytes", "=", "outputStream", ".", "toByteArray", "(", ")", ";", "}", "try", "(", "final", "ByteArrayInputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "final", "ObjectInputStream", "objectInputStream", "=", "new", "ObjectInputStream", "(", "inputStream", ")", ")", "{", "final", "Object", "o", "=", "objectInputStream", ".", "readObject", "(", ")", ";", "assertThat", "(", "o", ")", ".", "isInstanceOf", "(", "DataSize", ".", "class", ")", ".", "isEqualTo", "(", "size", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "testSerialization", "(", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "final", "Duration", "duration", "=", "Duration", ".", "minutes", "(", "<NUM_LIT>", ")", ";", "final", "byte", "[", "]", "bytes", ";", "try", "(", "final", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "final", "ObjectOutputStream", "objectOutputStream", "=", "new", "ObjectOutputStream", "(", "outputStream", ")", ")", "{", "objectOutputStream", ".", "writeObject", "(", "duration", ")", ";", "bytes", "=", "outputStream", ".", "toByteArray", "(", ")", ";", "}", "try", "(", "final", "ByteArrayInputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "final", "ObjectInputStream", "objectInputStream", "=", "new", "ObjectInputStream", "(", "inputStream", ")", ")", "{", "final", "Object", "o", "=", "objectInputStream", ".", "readObject", "(", ")", ";", "assertThat", "(", "o", ")", ".", "isInstanceOf", "(", "Duration", ".", "class", ")", ".", "isEqualTo", "(", "duration", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "testSerialization", "(", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "final", "Size", "size", "=", "Size", ".", "megabytes", "(", "<NUM_LIT>", ")", ";", "final", "byte", "[", "]", "bytes", ";", "try", "(", "final", "ByteArrayOutputStream", "outputStream", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "final", "ObjectOutputStream", "objectOutputStream", "=", "new", "ObjectOutputStream", "(", "outputStream", ")", ")", "{", "objectOutputStream", ".", "writeObject", "(", "size", ")", ";", "bytes", "=", "outputStream", ".", "toByteArray", "(", ")", ";", "}", "try", "(", "final", "ByteArrayInputStream", "inputStream", "=", "new", "ByteArrayInputStream", "(", "bytes", ")", ";", "final", "ObjectInputStream", "objectInputStream", "=", "new", "ObjectInputStream", "(", "inputStream", ")", ")", "{", "final", "Object", "o", "=", "objectInputStream", ".", "readObject", "(", ")", ";", "assertThat", "(", "o", ")", ".", "isInstanceOf", "(", "Size", ".", "class", ")", ".", "isEqualTo", "(", "size", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "onFatalError", "(", "Throwable", "t", ")", "{", "onFatalError", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "BadAppException", "that", "=", "(", "BadAppException", ")", "o", ";", "return", "Objects", ".", "equals", "(", "this", ".", "getMessage", "(", ")", ",", "that", ".", "getMessage", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "getMessage", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "logResourceWithHK2Binder", "(", ")", "{", "rc", ".", "register", "(", "ResourceWithInjectedDependency", ".", "class", ")", ";", "rc", ".", "register", "(", "new", "org", ".", "glassfish", ".", "hk2", ".", "utilities", ".", "binding", ".", "AbstractBinder", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bindAsContract", "(", "Dependency", ".", "class", ")", ";", "}", "}", ")", ";", "runJersey", "(", ")", ";", "final", "String", "expectedLog", "=", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "rc", ".", "getEndpointsInfo", "(", ")", ")", ".", "contains", "(", "expectedLog", ")", ";", "}", "</s>"]
["<s>", "public", "String", "bar", "(", ")", "{", "return", "dependency", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "get", "(", ")", "{", "return", "\"", "<STR_LIT:A>", "\"", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "demonstrateThatHk2BinderIsNotPickedUpAsProvider", "(", ")", "{", "org", ".", "glassfish", ".", "hk2", ".", "utilities", ".", "Binder", "binder", "=", "new", "org", ".", "glassfish", ".", "hk2", ".", "utilities", ".", "binding", ".", "AbstractBinder", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "}", "}", ";", "assertThat", "(", "Providers", ".", "isProvider", "(", "binder", ".", "getClass", "(", ")", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "demonstrateThatJerseyBinderIsPickedUpAsProvider", "(", ")", "{", "org", ".", "glassfish", ".", "jersey", ".", "internal", ".", "inject", ".", "Binder", "binder", "=", "new", "org", ".", "glassfish", ".", "jersey", ".", "internal", ".", "inject", ".", "AbstractBinder", "(", ")", "{", "@", "Override", "protected", "void", "configure", "(", ")", "{", "}", "}", ";", "assertThat", "(", "Providers", ".", "isProvider", "(", "binder", ".", "getClass", "(", ")", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "boolean", "isReportOnStop", "(", ")", "{", "return", "reportOnStop", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "void", "setReportOnStop", "(", "boolean", "reportOnStop", ")", "{", "this", ".", "reportOnStop", "=", "reportOnStop", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "AdminFactory", "getAdminFactory", "(", ")", "{", "return", "admin", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setAdminFactory", "(", "AdminFactory", "admin", ")", "{", "this", ".", "admin", "=", "admin", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "HealthCheckConfiguration", "getHealthChecks", "(", ")", "{", "return", "healthChecks", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setHealthChecks", "(", "HealthCheckConfiguration", "healthChecks", ")", "{", "this", ".", "healthChecks", "=", "healthChecks", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "TaskConfiguration", "getTasks", "(", ")", "{", "return", "tasks", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setTasks", "(", "TaskConfiguration", "tasks", ")", "{", "this", ".", "tasks", "=", "tasks", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "new", "StringJoiner", "(", "\"", "<STR_LIT>", "\"", ",", "AdminFactory", ".", "class", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", ",", "\"", "<STR_LIT:]>", "\"", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "healthChecks", ")", ".", "add", "(", "\"", "<STR_LIT:=>", "\"", "+", "tasks", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "int", "getMinThreads", "(", ")", "{", "return", "minThreads", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setMinThreads", "(", "int", "minThreads", ")", "{", "this", ".", "minThreads", "=", "minThreads", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "int", "getMaxThreads", "(", ")", "{", "return", "maxThreads", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setMaxThreads", "(", "int", "maxThreads", ")", "{", "this", ".", "maxThreads", "=", "maxThreads", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "int", "getWorkQueueSize", "(", ")", "{", "return", "workQueueSize", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setWorkQueueSize", "(", "int", "workQueueSize", ")", "{", "this", ".", "workQueueSize", "=", "workQueueSize", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "new", "StringJoiner", "(", "\"", "<STR_LIT>", "\"", ",", "HealthCheckConfiguration", ".", "class", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", ",", "\"", "<STR_LIT:]>", "\"", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "minThreads", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "maxThreads", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "workQueueSize", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "isPrintStackTraceOnError", "(", ")", "{", "return", "printStackTraceOnError", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setPrintStackTraceOnError", "(", "boolean", "printStackTraceOnError", ")", "{", "this", ".", "printStackTraceOnError", "=", "printStackTraceOnError", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "new", "StringJoiner", "(", "\"", "<STR_LIT>", "\"", ",", "TaskConfiguration", ".", "class", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", ",", "\"", "<STR_LIT:]>", "\"", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "printStackTraceOnError", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testPrintStackTrackWhenEnabled", "(", ")", "throws", "Exception", "{", "final", "TaskConfiguration", "taskConfiguration", "=", "new", "TaskConfiguration", "(", ")", ";", "taskConfiguration", ".", "setPrintStackTraceOnError", "(", "true", ")", ";", "final", "TaskServlet", "servlet", "=", "new", "TaskServlet", "(", "metricRegistry", ",", "taskConfiguration", ")", ";", "servlet", ".", "add", "(", "gc", ")", ";", "final", "ServletInputStream", "bodyStream", "=", "new", "TestServletInputStream", "(", "new", "ByteArrayInputStream", "(", "new", "byte", "[", "0", "]", ")", ")", ";", "when", "(", "request", ".", "getMethod", "(", ")", ")", ".", "thenReturn", "(", "\"", "<STR_LIT:POST>", "\"", ")", ";", "when", "(", "request", ".", "getPathInfo", "(", ")", ")", ".", "thenReturn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "when", "(", "request", ".", "getParameterNames", "(", ")", ")", ".", "thenReturn", "(", "Collections", ".", "emptyEnumeration", "(", ")", ")", ";", "when", "(", "request", ".", "getInputStream", "(", ")", ")", ".", "thenReturn", "(", "bodyStream", ")", ";", "final", "StringWriter", "stringWriter", "=", "new", "StringWriter", "(", ")", ";", "final", "PrintWriter", "output", "=", "new", "PrintWriter", "(", "stringWriter", ",", "true", ")", ";", "when", "(", "response", ".", "getWriter", "(", ")", ")", ".", "thenReturn", "(", "output", ")", ";", "doThrow", "(", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "when", "(", "gc", ")", ".", "execute", "(", "any", "(", ")", ",", "any", "(", ")", ")", ";", "servlet", ".", "service", "(", "request", ",", "response", ")", ";", "assertThat", "(", "stringWriter", ".", "toString", "(", ")", ".", "trim", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testDoNotPrintStackTrackWhenDisabled", "(", ")", "throws", "Exception", "{", "final", "TaskConfiguration", "taskConfiguration", "=", "new", "TaskConfiguration", "(", ")", ";", "taskConfiguration", ".", "setPrintStackTraceOnError", "(", "false", ")", ";", "final", "TaskServlet", "servlet", "=", "new", "TaskServlet", "(", "metricRegistry", ",", "taskConfiguration", ")", ";", "servlet", ".", "add", "(", "gc", ")", ";", "final", "ServletInputStream", "bodyStream", "=", "new", "TestServletInputStream", "(", "new", "ByteArrayInputStream", "(", "new", "byte", "[", "0", "]", ")", ")", ";", "when", "(", "request", ".", "getMethod", "(", ")", ")", ".", "thenReturn", "(", "\"", "<STR_LIT:POST>", "\"", ")", ";", "when", "(", "request", ".", "getPathInfo", "(", ")", ")", ".", "thenReturn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "when", "(", "request", ".", "getParameterNames", "(", ")", ")", ".", "thenReturn", "(", "Collections", ".", "emptyEnumeration", "(", ")", ")", ";", "when", "(", "request", ".", "getInputStream", "(", ")", ")", ".", "thenReturn", "(", "bodyStream", ")", ";", "final", "StringWriter", "stringWriter", "=", "new", "StringWriter", "(", ")", ";", "final", "PrintWriter", "output", "=", "new", "PrintWriter", "(", "stringWriter", ",", "true", ")", ";", "when", "(", "response", ".", "getWriter", "(", ")", ")", ".", "thenReturn", "(", "output", ")", ";", "doThrow", "(", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "when", "(", "gc", ")", ".", "execute", "(", "any", "(", ")", ",", "any", "(", ")", ")", ";", "servlet", ".", "service", "(", "request", ",", "response", ")", ";", "assertThat", "(", "stringWriter", ".", "toString", "(", ")", ".", "trim", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "o", "=", "=", "null", "|", "|", "getClass", "(", ")", "!", "=", "o", ".", "getClass", "(", ")", ")", "return", "false", ";", "Info", "that", "=", "(", "Info", ")", "o", ";", "return", "Objects", ".", "equals", "(", "this", ".", "title", ",", "that", ".", "title", ")", "&", "&", "Objects", ".", "equals", "(", "this", ".", "content", ",", "that", ".", "content", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "title", ",", "content", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "new", "StringJoiner", "(", "\"", "<STR_LIT>", "\"", ",", "this", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", "+", "\"", "<STR_LIT:[>", "\"", ",", "\"", "<STR_LIT:]>", "\"", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "title", ")", ".", "add", "(", "\"", "<STR_LIT>", "\"", "+", "content", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testAppenderIsStarted", "(", "@", "TempDir", "Path", "tempDir", ")", "throws", "Exception", "{", "FileAppenderFactory", "<", "ILoggingEvent", ">", "fileAppenderFactory", "=", "new", "FileAppenderFactory", "<", "ILoggingEvent", ">", "(", ")", ";", "fileAppenderFactory", ".", "setCurrentLogFilename", "(", "\"", "<STR_LIT>", "\"", ")", ";", "fileAppenderFactory", ".", "setArchive", "(", "true", ")", ";", "fileAppenderFactory", ".", "setArchivedFileCount", "(", "<NUM_LIT:20>", ")", ";", "fileAppenderFactory", ".", "setArchivedLogFilenamePattern", "(", "\"", "<STR_LIT>", "\"", ")", ";", "fileAppenderFactory", ".", "setMaxFileSize", "(", "DataSize", ".", "megabytes", "(", "<NUM_LIT>", ")", ")", ";", "fileAppenderFactory", ".", "setImmediateFlush", "(", "false", ")", ";", "fileAppenderFactory", ".", "setThreshold", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Appender", "appender", "=", "fileAppenderFactory", ".", "build", "(", "new", "LoggerContext", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DropwizardLayoutFactory", "(", ")", ",", "new", "NullLevelFilterFactory", "<", ">", "(", ")", ",", "new", "AsyncLoggingEventAppenderFactory", "(", ")", ")", ";", "assertThat", "(", "appender", ".", "isStarted", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getYearBorn", "(", ")", "{", "return", "yearBorn", ";", "}", "</s>"]
["<s>", "public", "void", "setYearBorn", "(", "int", "yearBorn", ")", "{", "this", ".", "yearBorn", "=", "yearBorn", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "createPersonFailureMinYearBorn", "(", ")", "{", "person", ".", "setYearBorn", "(", "-", "1", ")", ";", "final", "Response", "response", "=", "RESOURCES", ".", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "Entity", ".", "entity", "(", "person", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ")", ";", "assertThat", "(", "response", ".", "getStatusInfo", "(", ")", ")", ".", "isNotEqualTo", "(", "Response", ".", "Status", ".", "OK", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "createPersonFailureMaxYearBorn", "(", ")", "{", "person", ".", "setYearBorn", "(", "<NUM_LIT>", ")", ";", "final", "Response", "response", "=", "RESOURCES", ".", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "Entity", ".", "entity", "(", "person", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ")", ";", "assertThat", "(", "response", ".", "getStatusInfo", "(", ")", ")", ".", "isNotEqualTo", "(", "Response", ".", "Status", ".", "OK", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "static", "String", "getDefaultValue", "(", "final", "Annotation", "[", "]", "annotations", ")", "{", "if", "(", "annotations", "!", "=", "null", ")", "{", "for", "(", "Annotation", "annotation", ":", "annotations", ")", "{", "if", "(", "DefaultValue", ".", "class", "=", "=", "annotation", ".", "annotationType", "(", ")", ")", "{", "return", "(", "(", "DefaultValue", ")", "annotation", ")", ".", "value", "(", ")", ";", "}", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueSetIgnoresDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueNotSetReturnsDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isEqualTo", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueEmptyReturnsDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isEqualTo", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueInvalidReturns404", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isInstanceOf", "(", "NotFoundException", ".", "class", ")", ";", "assertThatThrownBy", "(", "(", ")", "-", ">", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Double", ".", "class", ")", ")", ".", "isInstanceOf", "(", "NotFoundException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "OptionalDouble", "showWithQueryParamAndDefaultValue", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT:0>", "\"", ")", "OptionalDouble", "id", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "Double", "showWithLongQueryParamAndDefaultValue", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT:0>", "\"", ")", "Double", "id", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "verifyInvalidDefaultValueFailsFast", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "new", "OptionalDoubleParamConverterProvider", ".", "OptionalDoubleParamConverter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isInstanceOf", "(", "NumberFormatException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "verifyInvalidValueNoDefaultReturnsNotPresent", "(", ")", "{", "assertThat", "(", "new", "OptionalDoubleParamConverterProvider", ".", "OptionalDoubleParamConverter", "(", ")", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isNotPresent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueSetIgnoresDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueNotSetReturnsDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueEmptyReturnsDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueInvalidReturns404", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isInstanceOf", "(", "NotFoundException", ".", "class", ")", ";", "assertThatThrownBy", "(", "(", ")", "-", ">", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Integer", ".", "class", ")", ")", ".", "isInstanceOf", "(", "NotFoundException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "verifyInvalidDefaultValueFailsFast", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "new", "OptionalIntParamConverterProvider", ".", "OptionalIntParamConverter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isInstanceOf", "(", "NumberFormatException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "OptionalInt", "showWithQueryParamAndDefaultValue", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT:0>", "\"", ")", "OptionalInt", "id", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "Integer", "showWithLongQueryParamAndDefaultValue", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT:0>", "\"", ")", "Integer", "id", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "verifyInvalidValueNoDefaultReturnsNotPresent", "(", ")", "{", "assertThat", "(", "new", "OptionalIntParamConverterProvider", ".", "OptionalIntParamConverter", "(", ")", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isNotPresent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueSetIgnoresDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueNotSetReturnsDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "0", "L", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueEmptyReturnsDefault", "(", ")", "{", "assertThat", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "0", "L", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "valueInvalidReturns404", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isInstanceOf", "(", "NotFoundException", ".", "class", ")", ";", "assertThatThrownBy", "(", "(", ")", "-", ">", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "Long", ".", "class", ")", ")", ".", "isInstanceOf", "(", "NotFoundException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "OptionalLong", "showWithQueryParamAndDefaultValue", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT:0>", "\"", ")", "OptionalLong", "id", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "Long", "showWithLongQueryParamAndDefaultValue", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT:0>", "\"", ")", "Long", "id", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "verifyInvalidDefaultValueFailsFast", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "new", "OptionalLongParamConverterProvider", ".", "OptionalLongParamConverter", "(", "\"", "<STR_LIT>", "\"", ")", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isInstanceOf", "(", "NumberFormatException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "verifyInvalidValueNoDefaultReturnsNotPresent", "(", ")", "{", "assertThat", "(", "new", "OptionalLongParamConverterProvider", ".", "OptionalLongParamConverter", "(", ")", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isNotPresent", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ")", ".", "inIterable", "(", ")", ".", "atIndex", "(", "index", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ")", "{", "violationOccurred", "=", "true", ";", "String", "messageTemplate", "=", "escapeEl", "(", "message", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ")", ".", "inIterable", "(", ")", ".", "atKey", "(", "key", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "private", "String", "escapeEl", "(", "@", "Nullable", "String", "s", ")", "{", "if", "(", "s", "=", "=", "null", "|", "|", "s", ".", "isEmpty", "(", ")", ")", "{", "return", "s", ";", "}", "final", "Matcher", "m", "=", "ESCAPE_PATTERN", ".", "matcher", "(", "s", ")", ";", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", "s", ".", "length", "(", ")", "+", "<NUM_LIT:16>", ")", ";", "while", "(", "m", ".", "find", "(", ")", ")", "{", "m", ".", "appendReplacement", "(", "sb", ",", "\"", "<STR_LIT:\\\\>", "<STR_LIT:\\\\>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ";", "}", "m", ".", "appendTail", "(", "sb", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail4", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "FAILED", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "violationMessagesAreEscaped", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "InjectionExample", "(", ")", ")", ")", ")", ".", "containsExactly", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParam_fails_with_null", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParam_fails_with_emptyString", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParam_fails_with_constraint_violation", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParam_fails_with_string", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParam_succeeds", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamNotNull_fails_with_null", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamNotNull_fails_with_empty_string", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamNotNull_fails_with_constraint_violation", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamNotNull_fails_with_string", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamNotNull_succeeds", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamWithDefault_succeeds_with_null", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamWithDefault_fails_with_empty_string", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "Long", ".", "class", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamWithDefault_fails_with_constraint_violation", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamWithDefault_fails_with_string", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "String", ".", "class", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:{>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT::>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT:}>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "longParamWithDefault_succeeds", "(", ")", "{", "final", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "readEntity", "(", "Integer", ".", "class", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:30>", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Long", "longParam", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Min", "(", "<NUM_LIT>", ")", "LongParam", "longParam", ")", "{", "return", "longParam", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Long", "longParamNotNull", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "NotNull", "(", "payload", "=", "Unwrapping", ".", "Skip", ".", "class", ")", "@", "Min", "(", "<NUM_LIT>", ")", "LongParam", "longParam", ")", "{", "return", "longParam", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Long", "longParamWithDefault", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "@", "DefaultValue", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Min", "(", "<NUM_LIT>", ")", "LongParam", "longParam", ")", "{", "return", "longParam", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "JmxReporter", "getJmxReporter", "(", ")", "{", "return", "jmxReporter", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "allowsAccessToJmxReporter", "(", ")", "{", "final", "MetricRegistry", "newRegistry", "=", "new", "MetricRegistry", "(", ")", ";", "bootstrap", ".", "setMetricRegistry", "(", "newRegistry", ")", ";", "assertThat", "(", "bootstrap", ".", "getJmxReporter", "(", ")", ")", ".", "isNull", "(", ")", ";", "bootstrap", ".", "registerMetrics", "(", ")", ";", "assertThat", "(", "bootstrap", ".", "getJmxReporter", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "}", "</s>"]
["<s>", "static", "String", "getNameWithoutFormat", "(", "String", "nameFormat", ")", "{", "final", "String", "name", "=", "String", ".", "format", "(", "Locale", ".", "ROOT", ",", "nameFormat", ",", "0", ")", ";", "return", "commonPrefixWithoutHyphen", "(", "name", ",", "nameFormat", ")", "+", "commonSuffix", "(", "name", ",", "nameFormat", ")", ";", "}", "</s>"]
["<s>", "static", "String", "commonPrefixWithoutHyphen", "(", "String", "name", ",", "String", "nameFormat", ")", "{", "final", "int", "minLength", "=", "Math", ".", "min", "(", "name", ".", "length", "(", ")", ",", "nameFormat", ".", "length", "(", ")", ")", ";", "int", "diffIndex", ";", "for", "(", "diffIndex", "=", "0", ";", "diffIndex", "<", "minLength", ";", "diffIndex", "+", "+", ")", "{", "if", "(", "name", ".", "charAt", "(", "diffIndex", ")", "!", "=", "nameFormat", ".", "charAt", "(", "diffIndex", ")", ")", "{", "break", ";", "}", "}", "if", "(", "diffIndex", ">", "0", "&", "&", "name", ".", "charAt", "(", "diffIndex", "-", "1", ")", "=", "=", "<CHAR_LIT:->", ")", "{", "diffIndex", "-", "-", ";", "}", "return", "name", ".", "substring", "(", "0", ",", "diffIndex", ")", ";", "}", "</s>"]
["<s>", "static", "String", "commonSuffix", "(", "String", "name", ",", "String", "nameFormat", ")", "{", "int", "nameIndex", "=", "name", ".", "length", "(", ")", ";", "int", "nameFormatIndex", "=", "nameFormat", ".", "length", "(", ")", ";", "while", "(", "-", "-", "nameIndex", ">", "=", "0", "&", "&", "-", "-", "nameFormatIndex", ">", "=", "0", ")", "{", "if", "(", "name", ".", "charAt", "(", "nameIndex", ")", "!", "=", "nameFormat", ".", "charAt", "(", "nameFormatIndex", ")", ")", "{", "break", ";", "}", "}", "return", "name", ".", "substring", "(", "nameIndex", "+", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "nameWithoutFormat", "(", ")", "{", "final", "String", "[", "]", "[", "]", "tests", "=", "new", "String", "[", "]", "[", "]", "{", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", "}", ",", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ",", "}", ";", "for", "(", "String", "[", "]", "t", ":", "tests", ")", "{", "assertThat", "(", "ExecutorServiceBuilder", ".", "getNameWithoutFormat", "(", "t", "[", "0", "]", ")", ")", ".", "describedAs", "(", "\"", "<STR_LIT>", "\"", ",", "t", "[", "0", "]", ",", "t", "[", "1", "]", ")", ".", "isEqualTo", "(", "t", "[", "1", "]", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Nullable", "public", "static", "String", "escapeMessageParameter", "(", "@", "Nullable", "String", "messageParameter", ")", "{", "if", "(", "messageParameter", "=", "=", "null", ")", "{", "return", "null", ";", "}", "return", "ESCAPE_MESSAGE_PARAMETER_PATTERN", ".", "matcher", "(", "messageParameter", ")", ".", "replaceAll", "(", "Matcher", ".", "quoteReplacement", "(", "String", ".", "valueOf", "(", "ESCAPE_CHARACTER", ")", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "propertyName", ",", "Integer", "index", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "getContextWithMessageParameters", "(", "messageParameters", ")", ".", "buildConstraintViolationWithTemplate", "(", "sanitizeTemplate", "(", "message", ")", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ")", ".", "inIterable", "(", ")", ".", "atIndex", "(", "index", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addViolation", "(", "String", "propertyName", ",", "String", "key", ",", "String", "message", ",", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "violationOccurred", "=", "true", ";", "final", "String", "messageTemplate", "=", "sanitizeTemplate", "(", "message", ")", ";", "final", "HibernateConstraintValidatorContext", "context", "=", "getContextWithMessageParameters", "(", "messageParameters", ")", ";", "context", ".", "buildConstraintViolationWithTemplate", "(", "messageTemplate", ")", ".", "addPropertyNode", "(", "propertyName", ")", ".", "addBeanNode", "(", ")", ".", "inIterable", "(", ")", ".", "atKey", "(", "key", ")", ".", "addConstraintViolation", "(", ")", ";", "}", "</s>"]
["<s>", "private", "HibernateConstraintValidatorContext", "getContextWithMessageParameters", "(", "Map", "<", "String", ",", "Object", ">", "messageParameters", ")", "{", "final", "HibernateConstraintValidatorContext", "context", "=", "constraintValidatorContext", ".", "unwrap", "(", "HibernateConstraintValidatorContext", ".", "class", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "messageParameter", ":", "messageParameters", ".", "entrySet", "(", ")", ")", "{", "final", "Object", "value", "=", "messageParameter", ".", "getValue", "(", ")", ";", "final", "String", "escapedValue", "=", "value", "=", "=", "null", "?", "null", ":", "escapeMessageParameter", "(", "value", ".", "toString", "(", ")", ")", ";", "context", ".", "addMessageParameter", "(", "messageParameter", ".", "getKey", "(", ")", ",", "escapedValue", ")", ";", "}", "return", "context", ";", "}", "</s>"]
["<s>", "@", "Nullable", "private", "String", "sanitizeTemplate", "(", "@", "Nullable", "String", "message", ")", "{", "return", "escapeExpressions", "?", "escapeMessageParameter", "(", "message", ")", ":", "message", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT:$>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "SelfValidation", "public", "void", "validateFail", "(", "ViolationCollector", "col", ")", "{", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT:}>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "Maps", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "Maps", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "col", ".", "addViolation", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "Maps", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "violationMessagesAreInterpolatedIfEscapingDisabled", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "EscapingDisabledExample", "(", ")", ")", ")", ")", ".", "containsExactly", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "messageParametersExample", "(", ")", "{", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "new", "MessageParametersExample", "(", ")", ")", ")", ")", ".", "containsExactly", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "TestLoggerFactory", ".", "getAllLoggingEvents", "(", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "cachesTheNegativeResultIfSpecified", "(", ")", "throws", "Exception", "{", "when", "(", "underlying", ".", "authenticate", "(", "anyString", "(", ")", ")", ")", ".", "thenReturn", "(", "Optional", ".", "empty", "(", ")", ")", ";", "Caffeine", "<", "Object", ",", "Object", ">", "caffeine", "=", "Caffeine", ".", "newBuilder", "(", ")", ".", "maximumSize", "(", "<NUM_LIT>", ")", ".", "executor", "(", "Runnable", ":", ":", "run", ")", ";", "cached", "=", "new", "CachingAuthenticator", "<", ">", "(", "new", "MetricRegistry", "(", ")", ",", "underlying", ",", "caffeine", ",", "true", ")", ";", "assertThat", "(", "cached", ".", "authenticate", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isEqualTo", "(", "Optional", ".", "empty", "(", ")", ")", ";", "verify", "(", "underlying", ")", ".", "authenticate", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "cached", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "protected", "BootstrapServiceRegistryBuilder", "configureBootstrapServiceRegistryBuilder", "(", "BootstrapServiceRegistryBuilder", "builder", ")", "{", "return", "builder", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "buildBootstrapServiceRegistryRunsBeforeSessionFactoryCreation", "(", ")", "{", "final", "SessionFactoryFactory", "customFactory", "=", "new", "SessionFactoryFactory", "(", ")", "{", "@", "Override", "protected", "BootstrapServiceRegistryBuilder", "configureBootstrapServiceRegistryBuilder", "(", "BootstrapServiceRegistryBuilder", "builder", ")", "{", "return", "builder", ";", "}", "}", ";", "sessionFactory", "=", "customFactory", ".", "build", "(", "bundle", ",", "environment", ",", "config", ",", "Collections", ".", "singletonList", "(", "Person", ".", "class", ")", ")", ";", "assertThat", "(", "sessionFactory", ".", "getSessionFactoryOptions", "(", ")", ".", "getInterceptor", "(", ")", ")", ".", "isSameAs", "(", "EmptyInterceptor", ".", "INSTANCE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "BootstrapServiceRegistryBuilder", "configureBootstrapServiceRegistryBuilder", "(", "BootstrapServiceRegistryBuilder", "builder", ")", "{", "return", "builder", ";", "}", "</s>"]
["<s>", "public", "String", "getDefaultMediaType", "(", ")", "{", "return", "defaultMediaType", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "canHaveDifferentDefaultMediaType", "(", ")", "{", "runBundle", "(", "new", "AssetsBundle", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "servletPath", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "servlet", ".", "getIndexFile", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "servlet", ".", "getResourceURL", "(", ")", ")", ".", "isEqualTo", "(", "normalize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "servlet", ".", "getUriPath", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "servlet", ".", "getDefaultMediaType", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "Charset", "getDefaultCharset", "(", ")", "{", "return", "defaultCharset", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "defaultsToHtmlIfNotOverridden", "(", ")", "throws", "Exception", "{", "request", ".", "setURI", "(", "NOMEDIATYPE_SERVLET", "+", "\"", "<STR_LIT>", "\"", ")", ";", "response", "=", "HttpTester", ".", "parseResponse", "(", "SERVLET_TESTER", ".", "getResponses", "(", "request", ".", "generate", "(", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "MimeTypes", ".", "CACHE", ".", "get", "(", "response", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ")", ".", "isEqualTo", "(", "MimeTypes", ".", "Type", ".", "TEXT_HTML_UTF_8", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "servesWithDefaultMediaType", "(", ")", "throws", "Exception", "{", "request", ".", "setURI", "(", "MEDIATYPE_SERVLET", "+", "\"", "<STR_LIT>", "\"", ")", ";", "response", "=", "HttpTester", ".", "parseResponse", "(", "SERVLET_TESTER", ".", "getResponses", "(", "request", ".", "generate", "(", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "MimeTypes", ".", "CACHE", ".", "get", "(", "response", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ")", ".", "isEqualTo", "(", "MimeTypes", ".", "Type", ".", "TEXT_PLAIN_UTF_8", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "URI", "getBaseUri", "(", ")", "{", "forceSet", "(", "TestProperties", ".", "CONTAINER_PORT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "return", "super", ".", "getBaseUri", "(", ")", ";", "}", "</s>"]
["<s>", "private", "TestResource", "createResource", "(", ")", "{", "return", "new", "TestResource", "(", "mockPerson", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "accessingMockPersonSucceeds", "(", ")", "{", "when", "(", "mockPerson", ".", "getName", "(", ")", ")", ".", "thenReturn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "String", "resp", "=", "resources", ".", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "String", ".", "class", ")", ";", "assertThat", "(", "resp", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getPersonName", "(", ")", "{", "return", "person", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "RepeatedTest", "(", "<NUM_LIT:10>", ")", "public", "void", "eachTestShouldUseANewPort", "(", ")", "{", "final", "int", "port", "=", "resources", ".", "target", "(", "\"", "<STR_LIT:/>", "\"", ")", ".", "getUri", "(", ")", ".", "getPort", "(", ")", ";", "assertThat", "(", "usedPorts", ")", ".", "doesNotContain", "(", "port", ")", ";", "usedPorts", ".", "add", "(", "port", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeAll", "public", "static", "void", "migrateDb", "(", ")", "throws", "Exception", "{", "APP", ".", "getApplication", "(", ")", ".", "run", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "CONFIG_PATH", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHelloWorld", "(", ")", "throws", "Exception", "{", "final", "Optional", "<", "String", ">", "name", "=", "Optional", ".", "of", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "Saying", "saying", "=", "APP", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "name", ".", "get", "(", ")", ")", ".", "request", "(", ")", ".", "get", "(", "Saying", ".", "class", ")", ";", "assertThat", "(", "saying", ".", "getContent", "(", ")", ")", ".", "isEqualTo", "(", "APP", ".", "getConfiguration", "(", ")", ".", "buildTemplate", "(", ")", ".", "render", "(", "name", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPostPerson", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "final", "Person", "newPerson", "=", "postPerson", "(", "person", ")", ";", "assertThat", "(", "newPerson", ".", "getId", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "newPerson", ".", "getFullName", "(", ")", ")", ".", "isEqualTo", "(", "person", ".", "getFullName", "(", ")", ")", ";", "assertThat", "(", "newPerson", ".", "getJobTitle", "(", ")", ")", ".", "isEqualTo", "(", "person", ".", "getJobTitle", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testRenderingPerson", "(", "String", "viewName", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "final", "Person", "newPerson", "=", "postPerson", "(", "person", ")", ";", "final", "String", "url", "=", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "newPerson", ".", "getId", "(", ")", "+", "\"", "<STR_LIT:/>", "\"", "+", "viewName", ";", "Response", "response", "=", "APP", ".", "client", "(", ")", ".", "target", "(", "url", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "HttpStatus", ".", "OK_200", ")", ";", "}", "</s>"]
["<s>", "private", "Person", "postPerson", "(", "Person", "person", ")", "{", "return", "APP", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "post", "(", "Entity", ".", "entity", "(", "person", ",", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ")", ".", "readEntity", "(", "Person", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLogFileWritten", "(", ")", "throws", "IOException", "{", "final", "Path", "log", "=", "Paths", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "log", ")", ".", "exists", "(", ")", ";", "final", "String", "actual", "=", "new", "String", "(", "Files", ".", "readAllBytes", "(", "log", ")", ",", "UTF_8", ")", ";", "assertThat", "(", "actual", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "{", "personDAO", "=", "new", "PersonDAO", "(", "daoTestRule", ".", "getSessionFactory", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "createPerson", "(", ")", "{", "final", "Person", "jeff", "=", "daoTestRule", ".", "inTransaction", "(", "(", ")", "-", ">", "personDAO", ".", "create", "(", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ")", ")", ";", "assertThat", "(", "jeff", ".", "getId", "(", ")", ")", ".", "isGreaterThan", "(", "0", ")", ";", "assertThat", "(", "jeff", ".", "getFullName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "jeff", ".", "getJobTitle", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "jeff", ".", "getYearBorn", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "personDAO", ".", "findById", "(", "jeff", ".", "getId", "(", ")", ")", ")", ".", "isEqualTo", "(", "Optional", ".", "of", "(", "jeff", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "findAll", "(", ")", "{", "daoTestRule", ".", "inTransaction", "(", "(", ")", "-", ">", "{", "personDAO", ".", "create", "(", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ")", ";", "personDAO", ".", "create", "(", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ")", ";", "personDAO", ".", "create", "(", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ")", ";", "}", ")", ";", "final", "List", "<", "Person", ">", "persons", "=", "personDAO", ".", "findAll", "(", ")", ";", "assertThat", "(", "persons", ")", ".", "extracting", "(", "\"", "<STR_LIT:Name>", "\"", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "persons", ")", ".", "extracting", "(", "\"", "<STR_LIT>", "\"", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "persons", ")", ".", "extracting", "(", "\"", "<STR_LIT>", "\"", ")", ".", "containsOnly", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "handlesNullFullName", "(", ")", "{", "assertThatExceptionOfType", "(", "ConstraintViolationException", ".", "class", ")", ".", "isThrownBy", "(", "(", ")", "-", ">", "daoTestRule", ".", "inTransaction", "(", "(", ")", "-", ">", "personDAO", ".", "create", "(", "new", "Person", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "B", "setPassword", "(", "String", "password", ")", "{", "this", ".", "password", "=", "password", ";", "return", "(", "B", ")", "this", ";", "}", "</s>"]
["<s>", "public", "B", "setDriver", "(", "String", "driver", ")", "{", "this", ".", "driver", "=", "driver", ";", "return", "(", "B", ")", "this", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "configure", "(", ")", "{", "bind", "(", "metricRegistry", ")", ".", "to", "(", "MetricRegistry", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "aroundWriteTo", "(", "WriterInterceptorContext", "context", ")", "throws", "IOException", ",", "WebApplicationException", "{", "try", "{", "context", ".", "proceed", "(", ")", ";", "}", "catch", "(", "EofException", "e", ")", "{", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "exceptionCounter", ".", "inc", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "TestContainerFactory", "getTestContainerFactory", "(", ")", "throws", "TestContainerException", "{", "return", "new", "JettyTestContainerFactory", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Application", "configure", "(", ")", "{", "return", "DropwizardResourceConfig", ".", "forTesting", "(", ")", ".", "register", "(", "EofExceptionWriterInterceptor", ".", "class", ")", ".", "register", "(", "EofExceptionCountingInterceptor", ".", "class", ")", ".", "register", "(", "TestResource", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldCountZeroEofExceptions", "(", ")", "throws", "IOException", "{", "target", "(", "\"", "<STR_LIT:/>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "InputStream", ".", "class", ")", ".", "close", "(", ")", ";", "assertThat", "(", "EofExceptionCountingInterceptor", ".", "exceptionCount", ")", ".", "isEqualByComparingTo", "(", "0", "L", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "Response", "streamForever", "(", ")", "{", "final", "StreamingOutput", "output", "=", "os", "-", ">", "{", "while", "(", "true", ")", "{", "os", ".", "write", "(", "<CHAR_LIT:a>", ")", ";", "os", ".", "flush", "(", ")", ";", "}", "}", ";", "return", "Response", ".", "ok", "(", "output", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "aroundWriteTo", "(", "WriterInterceptorContext", "context", ")", "throws", "IOException", ",", "WebApplicationException", "{", "try", "{", "context", ".", "proceed", "(", ")", ";", "}", "catch", "(", "EofException", "e", ")", "{", "exceptionCount", ".", "increment", "(", ")", ";", "throw", "e", ";", "}", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Test", "public", "void", "shouldSwallowEofException", "(", ")", "throws", "IOException", "{", "MetricRegistry", "metricRegistry", "=", "new", "MetricRegistry", "(", ")", ";", "EofExceptionWriterInterceptor", "interceptor", "=", "new", "EofExceptionWriterInterceptor", "(", "metricRegistry", ")", ";", "WriterInterceptorContext", "context", "=", "mock", "(", "WriterInterceptorContext", ".", "class", ")", ";", "doThrow", "(", "EofException", ".", "class", ")", ".", "when", "(", "context", ")", ".", "proceed", "(", ")", ";", "interceptor", ".", "aroundWriteTo", "(", "context", ")", ";", "verify", "(", "context", ",", "only", "(", ")", ")", ".", "proceed", "(", ")", ";", "Counter", "counter", "=", "metricRegistry", ".", "getCounters", "(", ")", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "counter", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "counter", ".", "getCount", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "B", "setMetricRegistry", "(", "MetricRegistry", "metricRegistry", ")", "{", "this", ".", "metricRegistry", "=", "metricRegistry", ";", "return", "(", "B", ")", "this", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "PasswordAuthentication", "getPasswordAuthentication", "(", ")", "{", "return", "new", "PasswordAuthentication", "(", "username", ",", "password", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getString", "(", ")", "{", "return", "string", ";", "}", "</s>"]
["<s>", "public", "Long", "getNumber", "(", ")", "{", "return", "number", ";", "}", "</s>"]
["<s>", "public", "Collection", "<", "String", ">", "getList", "(", ")", "{", "return", "list", ";", "}", "</s>"]
["<s>", "@", "POST", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "beanValidation", "(", "@", "Valid", "@", "NotNull", "ValidatedBean", "bean", ")", "{", "if", "(", "bean", "=", "=", "null", "|", "|", "bean", ".", "getString", "(", ")", "=", "=", "null", "|", "|", "bean", ".", "getString", "(", ")", ".", "trim", "(", ")", ".", "isEmpty", "(", ")", "|", "|", "bean", ".", "getNumber", "(", ")", "<", "0", "|", "|", "bean", ".", "getList", "(", ")", ".", "size", "(", ")", "<", "1", ")", "{", "throw", "new", "IllegalArgumentException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "BeforeEach", "void", "setUp", "(", ")", "{", "UriBuilder", "uriBuilder", "=", "UriBuilder", ".", "fromPath", "(", "\"", "<STR_LIT>", "\"", ")", ".", "scheme", "(", "\"", "<STR_LIT>", "\"", ")", ".", "host", "(", "\"", "<STR_LIT>", "\"", ")", ".", "port", "(", "APP", ".", "getLocalPort", "(", ")", ")", ";", "target", "=", "APP", ".", "client", "(", ")", ".", "target", "(", "uriBuilder", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldValidateNormally", "(", ")", "{", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "requestBody", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithNullRequestBody", "(", ")", "throws", "IOException", "{", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "null", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithNullString", "(", ")", "throws", "IOException", "{", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "requestBody", "(", "null", ",", "<NUM_LIT:5>", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithNegativeNumber", "(", ")", "throws", "IOException", "{", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "requestBody", "(", "\"", "<STR_LIT>", "\"", ",", "-", "<NUM_LIT>", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithEmptyList", "(", ")", "throws", "IOException", "{", "Map", "<", "String", ",", "Object", ">", "requestBody", "=", "new", "HashMap", "<", ">", "(", ")", ";", "requestBody", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "requestBody", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ")", ";", "requestBody", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "Collections", ".", "emptyList", "(", ")", ")", ";", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "Entity", ".", "json", "(", "requestBody", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithTooLongList", "(", ")", "throws", "IOException", "{", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "requestBody", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithBlankStringInList", "(", ")", "throws", "IOException", "{", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "requestBody", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldFailWithAllInvalid", "(", ")", "throws", "IOException", "{", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "entity", "=", "requestBody", "(", "null", ",", "-", "<NUM_LIT>", ",", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Response", "response", "=", "target", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "post", "(", "entity", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "hasEntity", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThatResponseBody", "(", "response", ")", ".", "containsOnly", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "NotNull", "private", "Entity", "<", "Map", "<", "String", ",", "Object", ">", ">", "requestBody", "(", "String", "string", ",", "long", "number", ",", "List", "<", "String", ">", "list", ")", "{", "Map", "<", "String", ",", "Object", ">", "requestBody", "=", "new", "HashMap", "<", ">", "(", ")", ";", "requestBody", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "string", ")", ";", "requestBody", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "number", ")", ";", "requestBody", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "list", ")", ";", "return", "Entity", ".", "json", "(", "requestBody", ")", ";", "}", "</s>"]
["<s>", "private", "AbstractListAssert", "<", "?", ",", "List", "<", "?", "extends", "String", ">", ",", "String", ",", "ObjectAssert", "<", "String", ">", ">", "assertThatResponseBody", "(", "Response", "response", ")", "throws", "IOException", "{", "return", "assertThat", "(", "responseBody", "(", "response", ")", ".", "elements", "(", ")", ")", ".", "toIterable", "(", ")", ".", "extracting", "(", "JsonNode", ":", ":", "asText", ")", ";", "}", "</s>"]
["<s>", "private", "JsonNode", "responseBody", "(", "Response", "response", ")", "throws", "IOException", "{", "InputStream", "responseBodyStream", "=", "(", "InputStream", ")", "response", ".", "getEntity", "(", ")", ";", "return", "mapper", ".", "readTree", "(", "responseBodyStream", ")", ".", "withArray", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Application", "configure", "(", ")", "{", "return", "DropwizardResourceConfig", ".", "forTesting", "(", ")", ".", "register", "(", "OptionalBeanParamResource", ".", "class", ")", ".", "register", "(", "MyMessageParamConverterProvider", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldReturnValuesIfProvidedAndValid", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", "D", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "Long", ".", "MAX_VALUE", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "cookie", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", "new", "GenericType", "<", "Map", "<", "String", ",", "Object", ">", ">", "(", ")", "{", "}", ")", ";", "assertThat", "(", "response", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", "D", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "Long", ".", "MAX_VALUE", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldReturnBadRequestIfValuesInvalid", "(", ")", "{", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ".", "cookie", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldReturnaDefaultsIfValuesMissing", "(", ")", "{", "Map", "<", "String", ",", "Object", ">", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON_TYPE", ")", ".", "get", "(", "new", "GenericType", "<", "Map", "<", "String", ",", "Object", ">", ">", "(", ")", "{", "}", ")", ";", "assertThat", "(", "response", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "Double", ".", "toString", "(", "Double", ".", "NaN", ")", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "containsEntry", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "GET", "public", "Map", "<", "String", ",", "Object", ">", "getMessage", "(", "@", "BeanParam", "MyBean", "bean", ")", "{", "final", "HashMap", "<", "String", ",", "Object", ">", "response", "=", "new", "HashMap", "<", ">", "(", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "uriInfo", ".", "getPath", "(", ")", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "pathParam", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "optionalDouble", ".", "orElse", "(", "Double", ".", "NaN", ")", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "optionalInt", ".", "orElse", "(", "<NUM_LIT>", ")", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "optionalLong", ".", "orElse", "(", "<NUM_LIT>", ")", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "string", ".", "orElse", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "response", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "bean", ".", "uuid", ".", "orElse", "(", "UUID", ".", "fromString", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "return", "response", ";", "}", "</s>"]
["<s>", "private", "Optional", "<", "JavaType", ">", "getTypeOfField", "(", "String", "fieldName", ")", "{", "return", "Optional", ".", "ofNullable", "(", "fields", ".", "get", "(", "fieldName", ".", "replaceAll", "(", "\"", "<STR_LIT:\\\\>", "<STR_LIT:[>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCollectionOfStrings", "(", "String", "fieldName", ")", "{", "Optional", "<", "JavaType", ">", "propertyType", "=", "getTypeOfField", "(", "fieldName", ")", ";", "if", "(", "!", "propertyType", ".", "isPresent", "(", ")", ")", "{", "return", "false", ";", "}", "if", "(", "!", "propertyType", ".", "get", "(", ")", ".", "isCollectionLikeType", "(", ")", "&", "&", "!", "propertyType", ".", "get", "(", ")", ".", "isArrayType", "(", ")", ")", "{", "return", "false", ";", "}", "return", "propertyType", ".", "get", "(", ")", ".", "getContentType", "(", ")", ".", "isTypeOrSubTypeOf", "(", "String", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "JsonObjectFormatVisitor", "expectObjectFormat", "(", "JavaType", "type", ")", "throws", "JsonMappingException", "{", "final", "ConfigurationMetadata", "thiss", "=", "this", ";", "return", "new", "JsonObjectFormatVisitor", ".", "Base", "(", ")", "{", "@", "Override", "public", "void", "optionalProperty", "(", "BeanProperty", "prop", ")", "throws", "JsonMappingException", "{", "if", "(", "currentDepth", ">", "MAX_DEPTH", ")", "{", "return", ";", "}", "String", "name", "=", "!", "currentPrefix", ".", "isEmpty", "(", ")", "?", "currentPrefix", "+", "\"", "<STR_LIT:.>", "\"", "+", "prop", ".", "getName", "(", ")", ":", "prop", ".", "getName", "(", ")", ";", "int", "oldFieldSize", "=", "fields", ".", "size", "(", ")", ";", "String", "oldPrefix", "=", "currentPrefix", ";", "currentPrefix", "=", "name", ";", "currentDepth", "+", "+", ";", "JavaType", "fieldType", "=", "prop", ".", "getType", "(", ")", ";", "if", "(", "fieldType", ".", "isCollectionLikeType", "(", ")", "|", "|", "fieldType", ".", "isArrayType", "(", ")", ")", "{", "fieldType", "=", "fieldType", ".", "getContentType", "(", ")", ";", "currentPrefix", "+", "=", "\"", "<STR_LIT>", "\"", ";", "}", "TypeDeserializer", "typeDeserializer", "=", "mapper", ".", "getDeserializationConfig", "(", ")", ".", "findTypeDeserializer", "(", "fieldType", ")", ";", "Class", "<", "?", ">", "defaultImpl", "=", "typeDeserializer", "!", "=", "null", "?", "typeDeserializer", ".", "getDefaultImpl", "(", ")", ":", "null", ";", "mapper", ".", "acceptJsonFormatVisitor", "(", "defaultImpl", "=", "=", "null", "?", "fieldType", ".", "getRawClass", "(", ")", ":", "defaultImpl", ",", "thiss", ")", ";", "currentDepth", "-", "-", ";", "currentPrefix", "=", "oldPrefix", ";", "if", "(", "oldFieldSize", "=", "=", "fields", ".", "size", "(", ")", ")", "{", "fields", ".", "put", "(", "name", ",", "prop", ".", "getType", "(", ")", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "optionalProperty", "(", "BeanProperty", "prop", ")", "throws", "JsonMappingException", "{", "if", "(", "currentDepth", ">", "MAX_DEPTH", ")", "{", "return", ";", "}", "String", "name", "=", "!", "currentPrefix", ".", "isEmpty", "(", ")", "?", "currentPrefix", "+", "\"", "<STR_LIT:.>", "\"", "+", "prop", ".", "getName", "(", ")", ":", "prop", ".", "getName", "(", ")", ";", "int", "oldFieldSize", "=", "fields", ".", "size", "(", ")", ";", "String", "oldPrefix", "=", "currentPrefix", ";", "currentPrefix", "=", "name", ";", "currentDepth", "+", "+", ";", "JavaType", "fieldType", "=", "prop", ".", "getType", "(", ")", ";", "if", "(", "fieldType", ".", "isCollectionLikeType", "(", ")", "|", "|", "fieldType", ".", "isArrayType", "(", ")", ")", "{", "fieldType", "=", "fieldType", ".", "getContentType", "(", ")", ";", "currentPrefix", "+", "=", "\"", "<STR_LIT>", "\"", ";", "}", "TypeDeserializer", "typeDeserializer", "=", "mapper", ".", "getDeserializationConfig", "(", ")", ".", "findTypeDeserializer", "(", "fieldType", ")", ";", "Class", "<", "?", ">", "defaultImpl", "=", "typeDeserializer", "!", "=", "null", "?", "typeDeserializer", ".", "getDefaultImpl", "(", ")", ":", "null", ";", "mapper", ".", "acceptJsonFormatVisitor", "(", "defaultImpl", "=", "=", "null", "?", "fieldType", ".", "getRawClass", "(", ")", ":", "defaultImpl", ",", "thiss", ")", ";", "currentDepth", "-", "-", ";", "currentPrefix", "=", "oldPrefix", ";", "if", "(", "oldFieldSize", "=", "=", "fields", ".", "size", "(", ")", ")", "{", "fields", ".", "put", "(", "name", ",", "prop", ".", "getType", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "handlesArrayOverrideIntoValidNoTypeFile", "(", ")", "throws", "Exception", "{", "System", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "Example", "example", "=", "factory", ".", "build", "(", "validNoTypeFile", ")", ";", "assertThat", "(", "example", ".", "getType", "(", ")", ".", "get", "(", "<NUM_LIT:2>", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "example", ".", "getType", "(", ")", ".", "size", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "}", "</s>"]
["<s>", "public", "ExampleInterface", "getExample", "(", ")", "{", "return", "example", ";", "}", "</s>"]
["<s>", "public", "ExampleInterfaceWithDefaultImpl", "getExampleWithDefault", "(", ")", "{", "return", "exampleWithDefault", ";", "}", "</s>"]
["<s>", "public", "List", "<", "ExampleInterfaceWithDefaultImpl", ">", "getExampleWithDefaults", "(", ")", "{", "return", "exampleWithDefaults", ";", "}", "</s>"]
["<s>", "public", "String", "[", "]", "getArray", "(", ")", "{", "return", "array", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getList", "(", ")", "{", "return", "list", ";", "}", "</s>"]
["<s>", "public", "Set", "<", "String", ">", "getSet", "(", ")", "{", "return", "set", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "MethodSource", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "shouldDiscoverAllFields", "(", "String", "name", ",", "boolean", "isPrimitive", ",", "boolean", "isCollectionOrArrayType", ",", "Class", "<", "?", ">", "klass", ")", "{", "final", "ConfigurationMetadata", "metadata", "=", "new", "ConfigurationMetadata", "(", "Jackson", ".", "newObjectMapper", "(", ")", ",", "ExampleConfiguration", ".", "class", ")", ";", "assertThat", "(", "metadata", ".", "fields", ".", "get", "(", "name", ")", ")", ".", "isNotNull", "(", ")", ".", "satisfies", "(", "(", "f", ")", "-", ">", "{", "assertThat", "(", "f", ".", "isPrimitive", "(", ")", ")", ".", "isEqualTo", "(", "isPrimitive", ")", ";", "assertThat", "(", "f", ".", "isCollectionLikeType", "(", ")", "|", "|", "f", ".", "isArrayType", "(", ")", ")", ".", "isEqualTo", "(", "isCollectionOrArrayType", ")", ";", "if", "(", "isCollectionOrArrayType", ")", "{", "assertThat", "(", "f", ".", "getContentType", "(", ")", ".", "isTypeOrSubTypeOf", "(", "klass", ")", ")", ".", "isTrue", "(", ")", ";", "}", "else", "{", "assertThat", "(", "f", ".", "isTypeOrSubTypeOf", "(", "klass", ")", ")", ".", "isTrue", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Stream", "<", "Arguments", ">", "provideArgsForShouldDiscoverAllFields", "(", ")", "{", "return", "Stream", ".", "of", "(", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "false", ",", "Integer", ".", "TYPE", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "false", ",", "ExampleInterface", ".", "class", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "true", ",", "String", ".", "class", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "true", ",", "String", ".", "class", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "true", ",", "String", ".", "class", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "true", ",", "String", ".", "class", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "true", ",", "String", ".", "class", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "true", ",", "String", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "MethodSource", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "isCollectionOfStringsShouldWork", "(", "String", "name", ",", "boolean", "isCollectionOfStrings", ")", "{", "final", "ConfigurationMetadata", "metadata", "=", "new", "ConfigurationMetadata", "(", "Jackson", ".", "newObjectMapper", "(", ")", ",", "ExampleConfiguration", ".", "class", ")", ";", "assertThat", "(", "metadata", ".", "isCollectionOfStrings", "(", "name", ")", ")", ".", "isEqualTo", "(", "isCollectionOfStrings", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Stream", "<", "Arguments", ">", "provideArgsForIsCollectionOfStringsShouldWork", "(", ")", "{", "return", "Stream", ".", "of", "(", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "false", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ",", "Arguments", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", "TestConfiguration", "configuration", ",", "Environment", "environment", ")", "throws", "Exception", "{", "final", "SessionFactory", "sessionFactory", "=", "hibernate", ".", "getSessionFactory", "(", ")", ";", "initDatabase", "(", "sessionFactory", ")", ";", "UnitOfWorkAwareProxyFactory", "unitOfWorkProxyFactory", "=", "new", "UnitOfWorkAwareProxyFactory", "(", "hibernate", ")", ";", "DogDAO", "dao", "=", "unitOfWorkProxyFactory", ".", "create", "(", "DogDAO", ".", "class", ",", "SessionFactory", ".", "class", ",", "sessionFactory", ")", ";", "environment", ".", "jersey", "(", ")", ".", "register", "(", "new", "UnitOfWorkApplicationListener", "(", "\"", "<STR_LIT>", "\"", ",", "sessionFactory", ")", ")", ";", "environment", ".", "jersey", "(", ")", ".", "register", "(", "new", "DogResource", "(", "dao", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "initDatabase", "(", "SessionFactory", "sessionFactory", ")", "{", "try", "(", "Session", "session", "=", "sessionFactory", ".", "openSession", "(", ")", ")", "{", "Transaction", "transaction", "=", "session", ".", "beginTransaction", "(", ")", ";", "session", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "session", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "session", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "session", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "transaction", ".", "commit", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "UnitOfWork", "Optional", "<", "Dog", ">", "findByName", "(", "String", "name", ")", "{", "return", "Optional", ".", "ofNullable", "(", "get", "(", "name", ")", ")", ";", "}", "</s>"]
["<s>", "@", "UnitOfWork", "Dog", "create", "(", "Dog", "dog", ")", "throws", "HibernateException", "{", "currentSession", "(", ")", ".", "setHibernateFlushMode", "(", "FlushMode", ".", "COMMIT", ")", ";", "currentSession", "(", ")", ".", "save", "(", "requireNonNull", "(", "dog", ")", ")", ";", "return", "dog", ";", "}", "</s>"]
["<s>", "public", "Optional", "<", "Dog", ">", "getDog", "(", ")", "{", "return", "dog", ";", "}", "</s>"]
["<s>", "public", "void", "setDog", "(", "Dog", "dog", ")", "{", "this", ".", "dog", "=", "Optional", ".", "ofNullable", "(", "dog", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "transactional", "=", "false", ")", "public", "DogResult", "findSerialized", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "name", ")", "{", "return", "new", "DogResult", "(", ")", "{", "@", "Override", "public", "void", "setDog", "(", "Dog", "dog", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "@", "Override", "public", "Optional", "<", "Dog", ">", "getDog", "(", ")", "{", "return", "dao", ".", "findByName", "(", "name", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setDog", "(", "Dog", "dog", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Optional", "<", "Dog", ">", "getDog", "(", ")", "{", "return", "dao", ".", "findByName", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "transactional", "=", "false", ")", "public", "Optional", "<", "Dog", ">", "findNested", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "String", "name", ")", "{", "return", "dao", ".", "findByName", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setup", "(", ")", "throws", "Exception", "{", "dropwizardTestSupport", ".", "before", "(", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "public", "void", "tearDown", "(", ")", "{", "dropwizardTestSupport", ".", "after", "(", ")", ";", "client", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "unitOfWorkSupportedNested", "(", ")", "throws", "Exception", "{", "final", "Dog", "raf", "=", "client", ".", "target", "(", "getUrlPrefix", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "get", "(", "Dog", ".", "class", ")", ";", "assertThat", "(", "raf", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "raf", ".", "getOwner", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "requireNonNull", "(", "raf", ".", "getOwner", "(", ")", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "unitOfWorkSupportedSerialized", "(", ")", "throws", "Exception", "{", "final", "Dog", "raf", "=", "client", ".", "target", "(", "getUrlPrefix", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "get", "(", "DogResult", ".", "class", ")", ".", "getDog", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "raf", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "raf", ".", "getOwner", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "requireNonNull", "(", "raf", ".", "getOwner", "(", ")", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "nameForConstructorParameterWorksWithNullField", "(", ")", "{", "final", "MapperConfig", "<", "?", ">", "mapperConfig", "=", "mock", "(", "MapperConfig", ".", "class", ")", ";", "final", "String", "name", "=", "strategy", ".", "nameForConstructorParameter", "(", "mapperConfig", ",", "null", ",", "\"", "<STR_LIT:Name>", "\"", ")", ";", "assertThat", "(", "name", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "nameForFieldWorksWithNullField", "(", ")", "{", "final", "MapperConfig", "<", "?", ">", "mapperConfig", "=", "mock", "(", "MapperConfig", ".", "class", ")", ";", "final", "String", "name", "=", "strategy", ".", "nameForField", "(", "mapperConfig", ",", "null", ",", "\"", "<STR_LIT:Name>", "\"", ")", ";", "assertThat", "(", "name", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "nameForGetterMethodWorksWithNullField", "(", ")", "{", "final", "MapperConfig", "<", "?", ">", "mapperConfig", "=", "mock", "(", "MapperConfig", ".", "class", ")", ";", "final", "String", "name", "=", "strategy", ".", "nameForGetterMethod", "(", "mapperConfig", ",", "null", ",", "\"", "<STR_LIT:Name>", "\"", ")", ";", "assertThat", "(", "name", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "nameForSetterMethodWorksWithNullField", "(", ")", "{", "final", "MapperConfig", "<", "?", ">", "mapperConfig", "=", "mock", "(", "MapperConfig", ".", "class", ")", ";", "final", "String", "name", "=", "strategy", ".", "nameForSetterMethod", "(", "mapperConfig", ",", "null", ",", "\"", "<STR_LIT:Name>", "\"", ")", ";", "assertThat", "(", "name", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "usingRangeHelperDoesNotThrowNullPointerException", "(", ")", "{", "final", "RangeHelper", ".", "RangeProperties", "standardNames", "=", "RangeHelper", ".", "standardNames", "(", ")", ";", "assertThat", "(", "standardNames", ".", "lowerBoundType", ")", ".", "isNotBlank", "(", ")", ";", "assertThat", "(", "standardNames", ".", "lowerEndpoint", ")", ".", "isNotBlank", "(", ")", ";", "assertThat", "(", "standardNames", ".", "upperBoundType", ")", ".", "isNotBlank", "(", ")", ";", "assertThat", "(", "standardNames", ".", "upperEndpoint", ")", ".", "isNotBlank", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testEmptyDriverClassIsAllowed", "(", ")", "throws", "Exception", "{", "DataSourceFactory", "ds", "=", "getDataSourceFactory", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "ds", ".", "getDriverClass", "(", ")", ")", ".", "isNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testEmptyDriverClass", "(", ")", "throws", "Exception", "{", "factory", ".", "setDriverClass", "(", "null", ")", ";", "ManagedDataSource", "dataSource", "=", "factory", ".", "build", "(", "metricRegistry", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThatNoException", "(", ")", ".", "isThrownBy", "(", "dataSource", ":", ":", "start", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "return", "super", ".", "equals", "(", "o", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "Servlet", "getServlet", "(", ")", "throws", "ServletException", "{", "return", "servlet", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handle", "(", "Request", "baseRequest", ",", "ServletRequest", "request", ",", "ServletResponse", "response", ")", "throws", "ServletException", ",", "IOException", "{", "final", "boolean", "asyncSupported", "=", "baseRequest", ".", "isAsyncSupported", "(", ")", ";", "if", "(", "!", "isAsyncSupported", "(", ")", ")", "{", "baseRequest", ".", "setAsyncSupported", "(", "false", ",", "null", ")", ";", "}", "try", "{", "servlet", ".", "service", "(", "request", ",", "response", ")", ";", "}", "catch", "(", "EofException", "ignored", ")", "{", "}", "finally", "{", "baseRequest", ".", "setAsyncSupported", "(", "asyncSupported", ",", "null", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "hasAServlet", "(", ")", "throws", "Exception", "{", "assertThat", "(", "holder", ".", "getServlet", "(", ")", ")", ".", "isEqualTo", "(", "servlet", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "temporarilyDisablesAsyncRequestsIfDisabled", "(", ")", "throws", "Exception", "{", "holder", ".", "setAsyncSupported", "(", "false", ")", ";", "holder", ".", "handle", "(", "baseRequest", ",", "request", ",", "response", ")", ";", "final", "InOrder", "inOrder", "=", "inOrder", "(", "baseRequest", ",", "servlet", ")", ";", "inOrder", ".", "verify", "(", "baseRequest", ")", ".", "setAsyncSupported", "(", "false", ",", "null", ")", ";", "inOrder", ".", "verify", "(", "servlet", ")", ".", "service", "(", "request", ",", "response", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testDefaultExcludedProtocols", "(", ")", "throws", "Exception", "{", "HttpsConnectorFactory", "factory", "=", "new", "HttpsConnectorFactory", "(", ")", ";", "SslContextFactory", "sslContextFactory", "=", "factory", ".", "configureSslContextFactory", "(", "new", "SslContextFactory", ".", "Server", "(", ")", ")", ";", "assertThat", "(", "sslContextFactory", ".", "getExcludeProtocols", "(", ")", ")", ".", "containsExactlyElementsOf", "(", "factory", ".", "getExcludedProtocols", "(", ")", ")", ";", "sslContextFactory", ".", "start", "(", ")", ";", "try", "{", "assertThat", "(", "sslContextFactory", ".", "newSSLEngine", "(", ")", ".", "getEnabledProtocols", "(", ")", ")", ".", "doesNotContainAnyElementsOf", "(", "factory", ".", "getExcludedProtocols", "(", ")", ")", ".", "allSatisfy", "(", "protocol", "-", ">", "assertThat", "(", "protocol", ")", ".", "doesNotStartWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "finally", "{", "sslContextFactory", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "ObjectMapper", "getMapper", "(", ")", "{", "return", "new", "ObjectMapper", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "SelfReferencingConfiguration", "getSelfReferencingConfiguration", "(", ")", "{", "return", "new", "SelfReferencingConfiguration", "(", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "String", "getStr", "(", ")", "{", "return", "str", ";", "}", "</s>"]
["<s>", "@", "JsonIgnore", "public", "SelfReferencingConfiguration", "getSelfReferencingConfiguration", "(", ")", "{", "return", "new", "SelfReferencingConfiguration", "(", ")", ";", "}", "</s>"]
["<s>", "public", "SelfReferencingConfiguration", "getIgnored", "(", ")", "{", "return", "ignored", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "issue3528ShouldNotProduceOutOfMemoryError", "(", ")", "{", "assertThatNoException", "(", ")", ".", "isThrownBy", "(", "(", ")", "-", ">", "new", "ConfigurationMetadata", "(", "Jackson", ".", "newObjectMapper", "(", ")", ",", "Issue3528Configuration", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "fieldsAnnotatedWithJsonIgnoreShouldBeIgnored", "(", ")", "{", "final", "ConfigurationMetadata", "metadata", "=", "new", "ConfigurationMetadata", "(", "Jackson", ".", "newObjectMapper", "(", ")", ",", "SelfReferencingIgnoredConfiguration", ".", "class", ")", ";", "assertThat", "(", "metadata", ".", "fields", ")", ".", "containsOnlyKeys", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "selfReferencingConfigurationShouldNotLoop", "(", ")", "{", "final", "ConfigurationMetadata", "metadata", "=", "new", "ConfigurationMetadata", "(", "Jackson", ".", "newObjectMapper", "(", ")", ",", "SelfReferencingConfiguration", ".", "class", ")", ";", "assertThat", "(", "metadata", ".", "fields", ")", ".", "containsOnlyKeys", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBuildAppenderWithCustomPatternLayoutAndFormat", "(", ")", "throws", "Exception", "{", "ConsoleAppender", "<", "?", ">", "consoleAppender", "=", "buildAppender", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LayoutWrappingEncoder", "<", "?", ">", "encoder", "=", "(", "LayoutWrappingEncoder", "<", "?", ">", ")", "consoleAppender", ".", "getEncoder", "(", ")", ";", "TestPatternLayout", "layout", "=", "(", "TestPatternLayout", ")", "encoder", ".", "getLayout", "(", ")", ";", "assertThat", "(", "layout", ".", "getPattern", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "ConsoleAppender", "<", "?", ">", "buildAppender", "(", "String", "resourceName", ")", "throws", "Exception", "{", "AsyncAppender", "appender", "=", "(", "AsyncAppender", ")", "factory", ".", "build", "(", "loadResource", "(", "resourceName", ")", ")", ".", "build", "(", "new", "LoggerContext", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DropwizardLayoutFactory", "(", ")", ",", "new", "NullLevelFilterFactory", "<", ">", "(", ")", ",", "new", "AsyncLoggingEventAppenderFactory", "(", ")", ")", ";", "return", "(", "ConsoleAppender", "<", "?", ">", ")", "appender", ".", "getAppender", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBuildAppenderWithTimeZonePlaceholderInLogFormat", "(", ")", "throws", "Exception", "{", "ConsoleAppender", "<", "?", ">", "consoleAppender", "=", "buildAppender", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LayoutWrappingEncoder", "<", "?", ">", "encoder", "=", "(", "LayoutWrappingEncoder", "<", "?", ">", ")", "consoleAppender", ".", "getEncoder", "(", ")", ";", "PatternLayoutBase", "<", "?", ">", "layout", "=", "(", "PatternLayoutBase", "<", "?", ">", ")", "encoder", ".", "getLayout", "(", ")", ";", "assertThat", "(", "layout", ".", "getPattern", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "private", "ConsoleAppender", "<", "?", ">", "buildAppender", "(", "String", "resourceName", ")", "throws", "Exception", "{", "AsyncAppender", "appender", "=", "(", "AsyncAppender", ")", "factory", ".", "build", "(", "loadResource", "(", "resourceName", ")", ")", ".", "build", "(", "new", "LoggerContext", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DropwizardLayoutFactory", "(", ")", ",", "new", "NullLevelFilterFactory", "<", ">", "(", ")", ",", "new", "AsyncLoggingEventAppenderFactory", "(", ")", ")", ";", "return", "(", "ConsoleAppender", "<", "?", ">", ")", "appender", ".", "getAppender", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "LayoutBase", "<", "ILoggingEvent", ">", "build", "(", "LoggerContext", "context", ",", "TimeZone", "timeZone", ")", "{", "return", "new", "TestPatternLayout", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "doLayout", "(", "ILoggingEvent", "event", ")", "{", "return", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getDefaultConverterMap", "(", ")", "{", "return", "Collections", ".", "emptyMap", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ConfigOverride", "randomPorts", "(", ")", "{", "return", "new", "ConfigOverrideRandomPorts", "(", "DEFAULT_PREFIX", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ConfigOverride", "randomPorts", "(", "String", "propertyPrefix", ")", "{", "return", "new", "ConfigOverrideRandomPorts", "(", "propertyPrefix", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addToSystemProperties", "(", ")", "{", "applicationConnectorsPort", "=", "System", ".", "setProperty", "(", "propertyPrefix", "+", "SERVER_APPLICATION_CONNECTORS_PORT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "adminConnectorsPort", "=", "System", ".", "setProperty", "(", "propertyPrefix", "+", "SERVER_ADMIN_CONNECTORS_PORT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeFromSystemProperties", "(", ")", "{", "if", "(", "applicationConnectorsPort", "!", "=", "null", ")", "{", "System", ".", "setProperty", "(", "propertyPrefix", "+", "SERVER_APPLICATION_CONNECTORS_PORT", ",", "applicationConnectorsPort", ")", ";", "}", "else", "{", "System", ".", "clearProperty", "(", "propertyPrefix", "+", "SERVER_APPLICATION_CONNECTORS_PORT", ")", ";", "}", "if", "(", "adminConnectorsPort", "!", "=", "null", ")", "{", "System", ".", "setProperty", "(", "propertyPrefix", "+", "SERVER_ADMIN_CONNECTORS_PORT", ",", "adminConnectorsPort", ")", ";", "}", "else", "{", "System", ".", "clearProperty", "(", "propertyPrefix", "+", "SERVER_ADMIN_CONNECTORS_PORT", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addToSystemProperties", "(", ")", "{", "this", ".", "originalValue", "=", "System", ".", "setProperty", "(", "propertyPrefix", "+", "key", ",", "value", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeFromSystemProperties", "(", ")", "{", "if", "(", "originalValue", "!", "=", "null", ")", "{", "System", ".", "setProperty", "(", "propertyPrefix", "+", "key", ",", "originalValue", ")", ";", "}", "else", "{", "System", ".", "clearProperty", "(", "propertyPrefix", "+", "key", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "supportsRandomPortsConfigAttributeOverrides", "(", ")", "{", "DefaultServerFactory", "serverFactory", "=", "(", "DefaultServerFactory", ")", "EXTENSION", ".", "getConfiguration", "(", ")", ".", "getServerFactory", "(", ")", ";", "assertThat", "(", "serverFactory", ".", "getApplicationConnectors", "(", ")", ".", "stream", "(", ")", ".", "map", "(", "HttpConnectorFactory", ".", "class", ":", ":", "cast", ")", ")", ".", "extracting", "(", "HttpConnectorFactory", ":", ":", "getPort", ")", ".", "containsExactly", "(", "0", ")", ";", "assertThat", "(", "serverFactory", ".", "getAdminConnectors", "(", ")", ".", "stream", "(", ")", ".", "map", "(", "HttpConnectorFactory", ".", "class", ":", ":", "cast", ")", ")", ".", "extracting", "(", "HttpConnectorFactory", ":", ":", "getPort", ")", ".", "containsExactly", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testSupportedProtocolsWithWildcards", "(", ")", "throws", "Exception", "{", "List", "<", "String", ">", "supportedProtocols", "=", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ";", "HttpsConnectorFactory", "factory", "=", "new", "HttpsConnectorFactory", "(", ")", ";", "factory", ".", "setKeyStorePassword", "(", "\"", "<STR_LIT>", "\"", ")", ";", "factory", ".", "setSupportedProtocols", "(", "supportedProtocols", ")", ";", "factory", ".", "setExcludedProtocols", "(", "Collections", ".", "emptyList", "(", ")", ")", ";", "SslContextFactory", "sslContextFactory", "=", "factory", ".", "configureSslContextFactory", "(", "new", "SslContextFactory", ".", "Server", "(", ")", ")", ";", "assertThat", "(", "Arrays", ".", "asList", "(", "sslContextFactory", ".", "getIncludeProtocols", "(", ")", ")", ")", ".", "isEqualTo", "(", "supportedProtocols", ")", ";", "sslContextFactory", ".", "start", "(", ")", ";", "try", "{", "assertThat", "(", "sslContextFactory", ".", "newSSLEngine", "(", ")", ".", "getEnabledProtocols", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "sslContextFactory", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "testExcludedProtocolsWithWildcards", "(", ")", "throws", "Exception", "{", "List", "<", "String", ">", "excludedProtocols", "=", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ";", "HttpsConnectorFactory", "factory", "=", "new", "HttpsConnectorFactory", "(", ")", ";", "factory", ".", "setKeyStorePassword", "(", "\"", "<STR_LIT>", "\"", ")", ";", "factory", ".", "setExcludedProtocols", "(", "excludedProtocols", ")", ";", "SslContextFactory", "sslContextFactory", "=", "factory", ".", "configureSslContextFactory", "(", "new", "SslContextFactory", ".", "Server", "(", ")", ")", ";", "assertThat", "(", "Arrays", ".", "asList", "(", "sslContextFactory", ".", "getExcludeProtocols", "(", ")", ")", ")", ".", "isEqualTo", "(", "excludedProtocols", ")", ";", "sslContextFactory", ".", "start", "(", ")", ";", "try", "{", "assertThat", "(", "sslContextFactory", ".", "newSSLEngine", "(", ")", ".", "getEnabledProtocols", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ".", "allSatisfy", "(", "protocol", "-", ">", "assertThat", "(", "protocol", ")", ".", "doesNotStartWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "sslContextFactory", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLogbackExcludedClassNotFound", "(", ")", "throws", "Exception", "{", "testBuildConfigurationMetadata", "(", "className", "-", ">", "{", "if", "(", "className", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "throw", "new", "ClassNotFoundException", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLogbackExcludedNoClassDef", "(", ")", "throws", "Exception", "{", "testBuildConfigurationMetadata", "(", "className", "-", ">", "{", "if", "(", "className", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "throw", "new", "NoClassDefFoundError", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPropagatedException", "(", ")", "throws", "Exception", "{", "AtomicReference", "<", "RuntimeException", ">", "thrown", "=", "new", "AtomicReference", "<", ">", "(", ")", ";", "try", "{", "testBuildConfigurationMetadata", "(", "className", "-", ">", "{", "if", "(", "className", ".", "startsWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "thrown", ".", "set", "(", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "throw", "thrown", ".", "get", "(", ")", ";", "}", "}", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ")", ".", "isSameAs", "(", "thrown", ".", "get", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "testBuildConfigurationMetadata", "(", "CheckedConsumer", "<", "String", ">", "classFilter", ")", "throws", "Exception", "{", "try", "(", "ByteArrayOutputStream", "byteStream", "=", "captureStderr", "(", ")", ";", "CustomClassLoader", "loader", "=", "new", "CustomClassLoader", "(", "classFilter", ")", ")", "{", "Class", "<", "ConfigurationMetadata", ">", "cmType", "=", "loader", ".", "reloadClass", "(", "ConfigurationMetadata", ".", "class", ")", ";", "Class", "<", "ObjectMapper", ">", "omType", "=", "loader", ".", "reloadClass", "(", "ObjectMapper", ".", "class", ")", ";", "Class", "<", "Configuration", ">", "confType", "=", "loader", ".", "reloadClass", "(", "Configuration", ".", "class", ")", ";", "cmType", ".", "getConstructor", "(", "omType", ",", "Class", ".", "class", ")", ".", "newInstance", "(", "omType", ".", "newInstance", "(", ")", ",", "confType", ")", ";", "String", "err", "=", "byteStream", ".", "toString", "(", ")", ";", "assertThat", "(", "err", ")", ".", "isEmpty", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "ByteArrayOutputStream", "captureStderr", "(", ")", "{", "PrintStream", "err", "=", "System", ".", "err", ";", "ByteArrayOutputStream", "byteStream", "=", "new", "ByteArrayOutputStream", "(", ")", "{", "@", "Override", "public", "void", "close", "(", ")", "{", "System", ".", "setErr", "(", "err", ")", ";", "}", "}", ";", "System", ".", "setErr", "(", "new", "PrintStream", "(", "byteStream", ")", ")", ";", "return", "byteStream", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "{", "System", ".", "setErr", "(", "err", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Class", "<", "?", ">", "loadClass", "(", "String", "name", ")", "throws", "ClassNotFoundException", "{", "classFilter", ".", "accept", "(", "name", ")", ";", "Class", "<", "?", ">", "clazz", "=", "getClassSystemLoader", "(", "name", ")", ";", "Optional", "<", "URL", ">", "url", "=", "getUrl", "(", "clazz", ")", ";", "if", "(", "!", "url", ".", "isPresent", "(", ")", ")", "{", "return", "clazz", ";", "}", "addURL", "(", "url", ".", "get", "(", ")", ")", ";", "return", "super", ".", "loadClass", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "Class", "<", "T", ">", "reloadClass", "(", "Class", "<", "T", ">", "clazz", ")", "throws", "ClassNotFoundException", "{", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "Class", "<", "T", ">", "ret", "=", "(", "Class", "<", "T", ">", ")", "loadClass", "(", "clazz", ".", "getCanonicalName", "(", ")", ")", ";", "return", "ret", ";", "}", "</s>"]
["<s>", "private", "static", "Class", "<", "?", ">", "getClassSystemLoader", "(", "String", "name", ")", "throws", "ClassNotFoundException", "{", "return", "ClassLoader", ".", "getSystemClassLoader", "(", ")", ".", "loadClass", "(", "name", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Optional", "<", "URL", ">", "getUrl", "(", "Class", "<", "?", ">", "clazz", ")", "throws", "ClassNotFoundException", "{", "return", "Optional", ".", "ofNullable", "(", "clazz", ".", "getProtectionDomain", "(", ")", ".", "getCodeSource", "(", ")", ")", ".", "map", "(", "CodeSource", ":", ":", "getLocation", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "beforeAll", "(", "ExtensionContext", "extensionContext", ")", "throws", "Exception", "{", "this", ".", "before", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "afterAll", "(", "ExtensionContext", "extensionContext", ")", "{", "this", ".", "after", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "canGetExpectedResourceOverHttp", "(", ")", "{", "final", "String", "content", "=", "ClientBuilder", ".", "newClient", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "getExtension", "(", ")", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "String", ".", "class", ")", ";", "assertThat", "(", "content", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "returnsConfiguration", "(", ")", "{", "final", "TestConfiguration", "config", "=", "getExtension", "(", ")", ".", "getConfiguration", "(", ")", ";", "assertThat", "(", "config", ".", "getMessage", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "returnsApplication", "(", ")", "{", "final", "DropwizardTestApplication", "application", "=", "getExtension", "(", ")", ".", "getApplication", "(", ")", ";", "Assertions", ".", "assertNotNull", "(", "application", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "returnsEnvironment", "(", ")", "{", "final", "Environment", "environment", "=", "getExtension", "(", ")", ".", "getEnvironment", "(", ")", ";", "assertThat", "(", "environment", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "canPerformAdminTask", "(", ")", "{", "final", "String", "response", "=", "getExtension", "(", ")", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "getExtension", "(", ")", ".", "getAdminPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "post", "(", "Entity", ".", "entity", "(", "\"", "\"", ",", "MediaType", ".", "TEXT_PLAIN", ")", ",", "String", ".", "class", ")", ";", "assertThat", "(", "response", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "canPerformAdminTaskWithPostBody", "(", ")", "{", "final", "String", "response", "=", "getExtension", "(", ")", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "getExtension", "(", ")", ".", "getAdminPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "post", "(", "Entity", ".", "entity", "(", "\"", "<STR_LIT>", "\"", ",", "MediaType", ".", "TEXT_PLAIN", ")", ",", "String", ".", "class", ")", ";", "assertThat", "(", "response", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "clientUsesJacksonMapperFromEnvironment", "(", ")", "{", "final", "Optional", "<", "String", ">", "message", "=", "getExtension", "(", ")", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "getExtension", "(", ")", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "DropwizardTestApplication", ".", "MessageView", ".", "class", ")", ".", "getMessage", "(", ")", ";", "assertThat", "(", "message", ")", ".", "hasValue", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "clientSupportsPatchMethod", "(", ")", "{", "final", "String", "method", "=", "getExtension", "(", ")", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "getExtension", "(", ")", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "method", "(", "\"", "<STR_LIT>", "\"", ",", "Entity", ".", "text", "(", "\"", "<STR_LIT>", "\"", ")", ",", "String", ".", "class", ")", ";", "assertThat", "(", "method", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "DropwizardAppExtension", "<", "TestConfiguration", ">", "getExtension", "(", ")", "{", "return", "EXTENSION", ";", "}", "</s>"]
["<s>", "private", "static", "Field", "getInaccessibleField", "(", "Class", "klass", ",", "String", "name", ")", "throws", "NoSuchFieldException", "{", "Field", "field", "=", "klass", ".", "getDeclaredField", "(", "name", ")", ";", "field", ".", "setAccessible", "(", "true", ")", ";", "return", "field", ";", "}", "</s>"]
["<s>", "ByteBufferPool", "buildBufferPool", "(", "int", "minCapacity", ",", "int", "factor", ",", "int", "maxCapacity", ")", "{", "return", "new", "ArrayByteBufferPool", "(", "minCapacity", ",", "factor", ",", "maxCapacity", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Field", "getSSLContextFactoryPrivateField", "(", "final", "String", "name", ")", "throws", "NoSuchFieldException", "{", "final", "Field", "field", "=", "SslContextFactory", ".", "class", ".", "getDeclaredField", "(", "name", ")", ";", "field", ".", "setAccessible", "(", "true", ")", ";", "return", "field", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "T", "getConfiguration", "(", ")", "{", "return", "configuration", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "Environment", "getEnvironment", "(", ")", "{", "return", "environment", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "returnsConfiguration", "(", ")", "{", "assertThat", "(", "EXTENSION", ".", "getConfiguration", "(", ")", ".", "getMessage", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "returnsApplication", "(", ")", "{", "assertThat", "(", "EXTENSION", ".", "<", "DropwizardTestApplication", ">", "getApplication", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "environmentIsNull", "(", ")", "{", "assertThatNullPointerException", "(", ")", ".", "isThrownBy", "(", "EXTENSION", ":", ":", "getEnvironment", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "configurationIsNull", "(", ")", "{", "assertThatNullPointerException", "(", ")", ".", "isThrownBy", "(", "EXTENSION", ":", ":", "getConfiguration", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testStartAndStop", "(", ")", "{", "accessJsonLayout", ".", "start", "(", ")", ";", "assertThat", "(", "accessJsonLayout", ".", "isStarted", "(", ")", ")", ".", "isTrue", "(", ")", ";", "accessJsonLayout", ".", "stop", "(", ")", ";", "assertThat", "(", "accessJsonLayout", ".", "isStarted", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "@", "DisabledForJreRange", "(", "max", "=", "JRE", ".", "JAVA_15", ")", "void", "testExcludedProtocolsJava16", "(", ")", "throws", "Exception", "{", "List", "<", "String", ">", "excludedProtocols", "=", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "HttpsConnectorFactory", "factory", "=", "new", "HttpsConnectorFactory", "(", ")", ";", "factory", ".", "setKeyStorePassword", "(", "\"", "<STR_LIT>", "\"", ")", ";", "factory", ".", "setExcludedProtocols", "(", "excludedProtocols", ")", ";", "SslContextFactory", "sslContextFactory", "=", "factory", ".", "configureSslContextFactory", "(", "new", "SslContextFactory", ".", "Server", "(", ")", ")", ";", "assertThat", "(", "Arrays", ".", "asList", "(", "sslContextFactory", ".", "getExcludeProtocols", "(", ")", ")", ")", ".", "isEqualTo", "(", "excludedProtocols", ")", ";", "sslContextFactory", ".", "start", "(", ")", ";", "try", "{", "assertThat", "(", "sslContextFactory", ".", "newSSLEngine", "(", ")", ".", "getEnabledProtocols", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "sslContextFactory", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "@", "DisabledForJreRange", "(", "max", "=", "JRE", ".", "JAVA_15", ")", "void", "testExcludedProtocolsWithWildcardsJava16", "(", ")", "throws", "Exception", "{", "List", "<", "String", ">", "excludedProtocols", "=", "Arrays", ".", "asList", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ";", "HttpsConnectorFactory", "factory", "=", "new", "HttpsConnectorFactory", "(", ")", ";", "factory", ".", "setKeyStorePassword", "(", "\"", "<STR_LIT>", "\"", ")", ";", "factory", ".", "setExcludedProtocols", "(", "excludedProtocols", ")", ";", "SslContextFactory", "sslContextFactory", "=", "factory", ".", "configureSslContextFactory", "(", "new", "SslContextFactory", ".", "Server", "(", ")", ")", ";", "assertThat", "(", "Arrays", ".", "asList", "(", "sslContextFactory", ".", "getExcludeProtocols", "(", ")", ")", ")", ".", "isEqualTo", "(", "excludedProtocols", ")", ";", "sslContextFactory", ".", "start", "(", ")", ";", "try", "{", "assertThat", "(", "sslContextFactory", ".", "newSSLEngine", "(", ")", ".", "getEnabledProtocols", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "allSatisfy", "(", "protocol", "-", ">", "assertThat", "(", "protocol", ")", ".", "doesNotStartWith", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "sslContextFactory", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "static", "void", "assertResponse", "(", "ContentResponse", "response", ",", "HttpVersion", "httpVersion", ")", "{", "assertThat", "(", "response", ".", "getVersion", "(", ")", ")", ".", "isEqualTo", "(", "httpVersion", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "getContentAsString", "(", ")", ")", ".", "isEqualTo", "(", "FakeApplication", ".", "HELLO_WORLD", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testHttp1", "(", ")", "throws", "Exception", "{", "assertResponse", "(", "http1Client", ".", "GET", "(", "\"", "<STR_LIT>", "\"", "+", "appRule", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ",", "HttpVersion", ".", "HTTP_1_1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testHttp1", "(", ")", "throws", "Exception", "{", "assertResponse", "(", "http1Client", ".", "GET", "(", "\"", "<STR_LIT>", "\"", "+", "appRule", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ",", "HttpVersion", ".", "HTTP_1_1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testHttp1WithCustomCipher", "(", ")", "throws", "Exception", "{", "assertResponse", "(", "http1Client", ".", "GET", "(", "\"", "<STR_LIT>", "\"", "+", "appRule", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ",", "HttpVersion", ".", "HTTP_1_1", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "containsAuthAnnotation", "(", "final", "Annotation", "[", "]", "annotations", ")", "{", "for", "(", "final", "Annotation", "annotation", ":", "annotations", ")", "{", "if", "(", "annotation", "instanceof", "Auth", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "cacheIfModifiedSinceOverwrittenByIfNoneMatch", "(", ")", "throws", "Exception", "{", "request", ".", "setHeader", "(", "HttpHeader", ".", "IF_MODIFIED_SINCE", ".", "toString", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "request", ".", "setURI", "(", "DUMMY_SERVLET", "+", "\"", "<STR_LIT>", "\"", ")", ";", "response", "=", "HttpTester", ".", "parseResponse", "(", "SERVLET_TESTER", ".", "getResponses", "(", "request", ".", "generate", "(", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "String", "eTag", "=", "response", ".", "get", "(", "HttpHeader", ".", "ETAG", ")", ";", "request", ".", "setHeader", "(", "HttpHeader", ".", "IF_NONE_MATCH", ".", "toString", "(", ")", ",", "eTag", ")", ";", "response", "=", "HttpTester", ".", "parseResponse", "(", "SERVLET_TESTER", ".", "getResponses", "(", "request", ".", "generate", "(", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "default", "AuthorizationContext", "<", "P", ">", "getAuthorizationContext", "(", "P", "principal", ",", "String", "role", ",", "@", "Nullable", "ContainerRequestContext", "requestContext", ")", "{", "return", "new", "DefaultAuthorizationContext", "<", ">", "(", "principal", ",", "role", ",", "requestContext", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "AuthorizationContext", "<", "P", ">", "getAuthorizationContext", "(", "P", "principal", ",", "String", "role", ",", "@", "Nullable", "ContainerRequestContext", "requestContext", ")", "{", "return", "underlying", ".", "getAuthorizationContext", "(", "principal", ",", "role", ",", "requestContext", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "configurationWithCustomDeserializerCanBeRead", "(", ")", "throws", "IOException", ",", "ConfigurationException", "{", "final", "ConfigurationFactory", "<", "CustomConfiguration", ">", "factory", "=", "new", "YamlConfigurationFactory", "<", ">", "(", "CustomConfiguration", ".", "class", ",", "BaseValidator", ".", "newValidator", "(", ")", ",", "Jackson", ".", "newObjectMapper", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "CustomConfiguration", "testObject", "=", "factory", ".", "build", "(", "new", "ResourceConfigurationSourceProvider", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "testObject", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "testObject", ".", "customProperty", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "testObject", ".", "customProperty", ".", "customString", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CustomProperty", "deserialize", "(", "JsonParser", "parser", ",", "DeserializationContext", "context", ")", "throws", "IOException", "{", "assertThat", "(", "parser", ".", "getCodec", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "TreeNode", "treeNode", "=", "parser", ".", "readValueAsTree", "(", ")", ";", "final", "TextNode", "custom", "=", "(", "TextNode", ")", "treeNode", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "new", "CustomProperty", "(", "custom", ".", "asText", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Resource", "newResource", "(", "String", "resource", ")", "{", "try", "{", "return", "Resource", ".", "newResource", "(", "resource", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "UncheckedIOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "Query", "<", "E", ">", "namedTypedQuery", "(", "String", "queryName", ")", "throws", "HibernateException", "{", "return", "currentSession", "(", ")", ".", "createNamedQuery", "(", "queryName", ",", "getEntityClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Query", "<", "String", ">", "namedTypedQuery", "(", "String", "queryName", ")", "throws", "HibernateException", "{", "return", "super", ".", "namedTypedQuery", "(", "queryName", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "getsNamedTypedQueries", "(", ")", "throws", "Exception", "{", "assertThat", "(", "dao", ".", "namedTypedQuery", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isEqualTo", "(", "query", ")", ";", "verify", "(", "session", ")", ".", "createNamedQuery", "(", "\"", "<STR_LIT>", "\"", ",", "String", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "expandChildren", "(", "List", "<", "Handler", ">", "list", ",", "Class", "<", "?", ">", "byClass", ")", "{", "Handler", "[", "]", "handlers", "=", "getHandlers", "(", ")", ";", "if", "(", "handlers", "!", "=", "null", ")", "{", "for", "(", "Handler", "h", ":", "handlers", ")", "{", "expandHandler", "(", "h", ",", "list", ",", "byClass", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Optional", "<", "HealthFactory", ">", "getHealthFactory", "(", ")", "{", "return", "Optional", ".", "ofNullable", "(", "health", ")", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setHealthFactory", "(", "HealthFactory", "health", ")", "{", "this", ".", "health", "=", "health", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", "final", "Configuration", "configuration", ",", "final", "Environment", "environment", ")", "throws", "Exception", "{", "environment", ".", "healthChecks", "(", ")", ".", "register", "(", "CRITICAL_HEALTH_CHECK_NAME_1", ",", "new", "HealthCheck", "(", ")", "{", "@", "Override", "protected", "Result", "check", "(", ")", "{", "return", "criticalCheckHealthy1", ".", "get", "(", ")", "?", "Result", ".", "healthy", "(", ")", ":", "Result", ".", "builder", "(", ")", ".", "unhealthy", "(", ")", ".", "build", "(", ")", ";", "}", "}", ")", ";", "environment", ".", "healthChecks", "(", ")", ".", "register", "(", "CRITICAL_HEALTH_CHECK_NAME_2", ",", "new", "HealthCheck", "(", ")", "{", "@", "Override", "protected", "Result", "check", "(", ")", "{", "return", "criticalCheckHealthy2", ".", "get", "(", ")", "?", "Result", ".", "healthy", "(", ")", ":", "Result", ".", "builder", "(", ")", ".", "unhealthy", "(", ")", ".", "build", "(", ")", ";", "}", "}", ")", ";", "environment", ".", "healthChecks", "(", ")", ".", "register", "(", "NON_CRITICAL_HEALTH_CHECK_NAME", ",", "new", "HealthCheck", "(", ")", "{", "@", "Override", "protected", "Result", "check", "(", ")", "{", "return", "nonCriticalCheckHealthy", ".", "get", "(", ")", "?", "Result", ".", "healthy", "(", ")", ":", "Result", ".", "builder", "(", ")", ".", "unhealthy", "(", ")", ".", "build", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Result", "check", "(", ")", "{", "return", "nonCriticalCheckHealthy", ".", "get", "(", ")", "?", "Result", ".", "healthy", "(", ")", ":", "Result", ".", "builder", "(", ")", ".", "unhealthy", "(", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "AtomicBoolean", "getCriticalCheckHealthy1", "(", ")", "{", "return", "criticalCheckHealthy1", ";", "}", "</s>"]
["<s>", "AtomicBoolean", "getCriticalCheckHealthy2", "(", ")", "{", "return", "criticalCheckHealthy2", ";", "}", "</s>"]
["<s>", "AtomicBoolean", "getNonCriticalCheckHealthy", "(", ")", "{", "return", "nonCriticalCheckHealthy", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "hostUrl", "=", "\"", "<STR_LIT>", "\"", "+", "HOST", "+", "\"", "<STR_LIT::>", "\"", "+", "TEST_APP_RULE", ".", "getLocalPort", "(", ")", ";", "Awaitility", ".", "waitAtMost", "(", "APP_STARTUP_MAX_TIMEOUT", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isHealthCheckResponding", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "public", "void", "tearDown", "(", ")", "{", "this", ".", "client", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "healthCheckShouldReportUnhealthyOnInitialStart", "(", ")", "{", "assertThat", "(", "isAppHealthy", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "healthCheckShouldReportHealthyWhenInitialStateFalseCriticalCheckGoesHealthy", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "assertThat", "(", "isAppHealthy", "(", ")", ")", ".", "isFalse", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "healthCheckShouldReportHealthyWhenAllHealthChecksHealthy", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getNonCriticalCheckHealthy", "(", ")", ".", "set", "(", "true", ")", ";", "Awaitility", ".", "await", "(", ")", ".", "pollInSameThread", "(", ")", ".", "atMost", "(", "testTimeout", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "nonCriticalHealthCheckFailureShouldNotResultInUnhealthyApp", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getNonCriticalCheckHealthy", "(", ")", ".", "set", "(", "false", ")", ";", "Awaitility", ".", "await", "(", ")", ".", "pollInSameThread", "(", ")", ".", "atMost", "(", "testTimeout", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "criticalHealthCheckFailureShouldResultInUnhealthyApp", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "false", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "(", ")", "-", ">", "!", "isAppHealthy", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "appShouldRecoverOnceCriticalCheckReturnsToHealthyStatus", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "false", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "(", ")", "-", ">", "!", "isAppHealthy", "(", ")", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isAppHealthy", "(", ")", "{", "return", "client", ".", "target", "(", "hostUrl", "+", "ENDPOINT", ")", ".", "request", "(", ")", ".", "get", "(", ")", ".", "getStatus", "(", ")", "=", "=", "<NUM_LIT>", ";", "}", "</s>"]
["<s>", "private", "boolean", "isHealthCheckResponding", "(", ")", "{", "final", "Response", "response", "=", "client", ".", "target", "(", "hostUrl", "+", "ENDPOINT", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "return", "response", ".", "getStatus", "(", ")", "=", "=", "<NUM_LIT>", "|", "|", "response", ".", "getStatus", "(", ")", "=", "=", "<NUM_LIT>", ";", "}", "</s>"]
["<s>", "@", "Nullable", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "public", "void", "setName", "(", "@", "Nullable", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "public", "List", "<", "HealthCheckConfiguration", ">", "getHealthCheckConfigurations", "(", ")", "{", "return", "healthChecks", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthCheckConfigurations", "(", "final", "List", "<", "HealthCheckConfiguration", ">", "healthChecks", ")", "{", "this", ".", "healthChecks", "=", "healthChecks", ";", "}", "</s>"]
["<s>", "public", "boolean", "isInitialOverallState", "(", ")", "{", "return", "initialOverallState", ";", "}", "</s>"]
["<s>", "public", "void", "setInitialOverallState", "(", "boolean", "initialOverallState", ")", "{", "this", ".", "initialOverallState", "=", "initialOverallState", ";", "}", "</s>"]
["<s>", "public", "boolean", "isDelayedShutdownHandlerEnabled", "(", ")", "{", "return", "delayedShutdownHandlerEnabled", ";", "}", "</s>"]
["<s>", "public", "void", "setDelayedShutdownHandlerEnabled", "(", "final", "boolean", "delayedShutdownHandlerEnabled", ")", "{", "this", ".", "delayedShutdownHandlerEnabled", "=", "delayedShutdownHandlerEnabled", ";", "}", "</s>"]
["<s>", "public", "Duration", "getShutdownWaitPeriod", "(", ")", "{", "return", "shutdownWaitPeriod", ";", "}", "</s>"]
["<s>", "public", "void", "setShutdownWaitPeriod", "(", "final", "Duration", "shutdownWaitPeriod", ")", "{", "this", ".", "shutdownWaitPeriod", "=", "shutdownWaitPeriod", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getHealthCheckUrlPaths", "(", ")", "{", "return", "healthCheckUrlPaths", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthCheckUrlPaths", "(", "final", "List", "<", "String", ">", "healthCheckUrlPaths", ")", "{", "this", ".", "healthCheckUrlPaths", "=", "healthCheckUrlPaths", ";", "}", "</s>"]
["<s>", "public", "HealthServletFactory", "getServletFactory", "(", ")", "{", "return", "servletFactory", ";", "}", "</s>"]
["<s>", "public", "void", "setServletFactory", "(", "HealthServletFactory", "servletFactory", ")", "{", "this", ".", "servletFactory", "=", "servletFactory", ";", "}", "</s>"]
["<s>", "public", "List", "<", "HealthCheckConfiguration", ">", "getHealthChecks", "(", ")", "{", "return", "healthChecks", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthChecks", "(", "List", "<", "HealthCheckConfiguration", ">", "healthChecks", ")", "{", "this", ".", "healthChecks", "=", "healthChecks", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "configure", "(", "final", "MetricRegistry", "metrics", ",", "final", "LifecycleEnvironment", "lifecycle", ",", "final", "HealthCheckRegistry", "healthChecks", ",", "final", "ServletEnvironment", "servlets", ")", "{", "if", "(", "!", "isEnabled", "(", ")", ")", "{", "LOGGER", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "final", "String", "fullName", ";", "if", "(", "name", "!", "=", "null", ")", "{", "fullName", "=", "DEFAULT_BASE_NAME", "+", "\"", "<STR_LIT:->", "\"", "+", "name", ";", "}", "else", "{", "fullName", "=", "DEFAULT_BASE_NAME", ";", "}", "final", "List", "<", "HealthCheckConfiguration", ">", "healthCheckConfigs", "=", "getHealthCheckConfigurations", "(", ")", ";", "final", "ScheduledExecutorService", "scheduledHealthCheckExecutor", "=", "createScheduledExecutorForHealthChecks", "(", "healthCheckConfigs", ".", "size", "(", ")", ",", "metrics", ",", "lifecycle", ",", "fullName", ")", ";", "final", "HealthCheckScheduler", "scheduler", "=", "new", "HealthCheckScheduler", "(", "scheduledHealthCheckExecutor", ")", ";", "final", "HealthCheckManager", "healthCheckManager", "=", "new", "HealthCheckManager", "(", "healthCheckConfigs", ",", "scheduler", ",", "metrics", ",", "shutdownWaitPeriod", ",", "initialOverallState", ")", ";", "healthCheckManager", ".", "initializeAppHealth", "(", ")", ";", "final", "HttpServlet", "servlet", "=", "getServletFactory", "(", ")", ".", "build", "(", "healthCheckManager", ")", ";", "servlets", ".", "addServlet", "(", "fullName", "+", "\"", "<STR_LIT>", "\"", ",", "servlet", ")", ".", "addMapping", "(", "getHealthCheckUrlPaths", "(", ")", ".", "toArray", "(", "new", "String", "[", "0", "]", ")", ")", ";", "healthChecks", ".", "addListener", "(", "healthCheckManager", ")", ";", "lifecycle", ".", "manage", "(", "new", "HealthCheckConfigValidator", "(", "healthCheckConfigs", ",", "healthChecks", ")", ")", ";", "final", "Duration", "shutdownWaitPeriod", "=", "getShutdownWaitPeriod", "(", ")", ";", "if", "(", "isDelayedShutdownHandlerEnabled", "(", ")", "&", "&", "shutdownWaitPeriod", ".", "toMilliseconds", "(", ")", ">", "0", ")", "{", "final", "DelayedShutdownHandler", "shutdownHandler", "=", "new", "DelayedShutdownHandler", "(", "healthCheckManager", ")", ";", "shutdownHandler", ".", "register", "(", ")", ";", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "shutdownWaitPeriod", ")", ";", "}", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "getHealthChecks", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "ScheduledExecutorService", "createScheduledExecutorForHealthChecks", "(", "final", "int", "numberOfScheduledHealthChecks", ",", "final", "MetricRegistry", "metrics", ",", "final", "LifecycleEnvironment", "lifecycle", ",", "final", "String", "fullName", ")", "{", "final", "ThreadFactory", "threadFactory", "=", "new", "ThreadFactoryBuilder", "(", ")", ".", "setNameFormat", "(", "fullName", "+", "\"", "<STR_LIT>", "\"", ")", ".", "setDaemon", "(", "true", ")", ".", "setUncaughtExceptionHandler", "(", "(", "t", ",", "e", ")", "-", ">", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ",", "e", ")", ")", ".", "build", "(", ")", ";", "final", "InstrumentedThreadFactory", "instrumentedThreadFactory", "=", "new", "InstrumentedThreadFactory", "(", "threadFactory", ",", "metrics", ")", ";", "final", "ScheduledExecutorService", "scheduledExecutorService", "=", "lifecycle", ".", "scheduledExecutorService", "(", "fullName", "+", "\"", "<STR_LIT>", "\"", ",", "instrumentedThreadFactory", ")", ".", "threads", "(", "numberOfScheduledHealthChecks", ")", ".", "build", "(", ")", ";", "return", "new", "InstrumentedScheduledExecutorService", "(", "scheduledExecutorService", ",", "metrics", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "start", "(", ")", "throws", "Exception", "{", "validateConfiguration", "(", "configs", ",", "registry", ".", "getNames", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "validateConfiguration", "(", "final", "List", "<", "HealthCheckConfiguration", ">", "healthCheckConfigs", ",", "final", "Set", "<", "String", ">", "registeredHealthCheckNames", ")", "{", "final", "Set", "<", "String", ">", "configuredHealthCheckNames", "=", "healthCheckConfigs", ".", "stream", "(", ")", ".", "map", "(", "HealthCheckConfiguration", ":", ":", "getName", ")", ".", "collect", "(", "Collectors", ".", "toSet", "(", ")", ")", ";", "final", "Set", "<", "String", ">", "notConfiguredHealthCheckNames", "=", "registeredHealthCheckNames", ".", "stream", "(", ")", ".", "filter", "(", "healthCheckName", "-", ">", "!", "configuredHealthCheckNames", ".", "contains", "(", "healthCheckName", ")", ")", ".", "collect", "(", "Collectors", ".", "toSet", "(", ")", ")", ";", "if", "(", "!", "notConfiguredHealthCheckNames", ".", "isEmpty", "(", ")", ")", "{", "final", "String", "healthCheckList", "=", "notConfiguredHealthCheckNames", ".", "stream", "(", ")", ".", "map", "(", "name", "-", ">", "\"", "<STR_LIT>", "\"", "+", "name", ")", ".", "collect", "(", "Collectors", ".", "joining", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT:{}>", "\"", ",", "healthCheckList", ")", ";", "}", "final", "Set", "<", "String", ">", "notRegisteredHealthCheckNames", "=", "configuredHealthCheckNames", ".", "stream", "(", ")", ".", "filter", "(", "healthCheckName", "-", ">", "!", "registeredHealthCheckNames", ".", "contains", "(", "healthCheckName", ")", ")", ".", "collect", "(", "Collectors", ".", "toSet", "(", ")", ")", ";", "if", "(", "!", "notRegisteredHealthCheckNames", ".", "isEmpty", "(", ")", ")", "{", "final", "String", "healthCheckList", "=", "notRegisteredHealthCheckNames", ".", "stream", "(", ")", ".", "map", "(", "name", "-", ">", "\"", "<STR_LIT>", "\"", "+", "name", ")", ".", "collect", "(", "Collectors", ".", "joining", "(", "\"", "<STR_LIT>", "<STR_LIT>", "\"", ")", ")", ";", "log", ".", "error", "(", "\"", "<STR_LIT>", "<STR_LIT>", "<STR_LIT:{}>", "\"", ",", "healthCheckList", ")", ";", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "notRegisteredHealthCheckNames", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onHealthCheckAdded", "(", "final", "String", "name", ",", "final", "HealthCheck", "healthCheck", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "configs", ".", "get", "(", "name", ")", ";", "if", "(", "config", "=", "=", "null", ")", "{", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "return", ";", "}", "final", "Schedule", "schedule", "=", "config", ".", "getSchedule", "(", ")", ";", "final", "HealthCheckType", "type", "=", "config", ".", "getType", "(", ")", ";", "final", "boolean", "critical", "=", "(", "type", "=", "=", "HealthCheckType", ".", "ALIVE", ")", "|", "|", "config", ".", "isCritical", "(", ")", ";", "final", "boolean", "initialState", "=", "config", ".", "isInitialState", "(", ")", ";", "final", "State", "state", "=", "new", "State", "(", "name", ",", "schedule", ".", "getFailureAttempts", "(", ")", ",", "schedule", ".", "getSuccessAttempts", "(", ")", ",", "initialState", ",", "this", ")", ";", "final", "Counter", "healthyCheckCounter", "=", "metrics", ".", "counter", "(", "MetricRegistry", ".", "name", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "Counter", "unhealthyCheckCounter", "=", "metrics", ".", "counter", "(", "MetricRegistry", ".", "name", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "new", "ScheduledHealthCheck", "(", "name", ",", "type", ",", "critical", ",", "healthCheck", ",", "schedule", ",", "state", ",", "healthyCheckCounter", ",", "unhealthyCheckCounter", ")", ";", "checks", ".", "put", "(", "name", ",", "check", ")", ";", "if", "(", "!", "initialState", "&", "&", "critical", ")", "{", "handleCriticalHealthChange", "(", "name", ",", "type", ",", "false", ")", ";", "}", "scheduler", ".", "scheduleInitial", "(", "check", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onHealthCheckRemoved", "(", "final", "String", "name", ",", "final", "HealthCheck", "healthCheck", ")", "{", "scheduler", ".", "unschedule", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onStateChanged", "(", "final", "String", "name", ",", "final", "boolean", "isNowHealthy", ")", "{", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "isNowHealthy", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "checks", ".", "get", "(", "name", ")", ";", "if", "(", "check", "=", "=", "null", ")", "{", "log", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "isNowHealthy", ")", ";", "return", ";", "}", "if", "(", "check", ".", "isCritical", "(", ")", ")", "{", "handleCriticalHealthChange", "(", "check", ".", "getName", "(", ")", ",", "check", ".", "getType", "(", ")", ",", "isNowHealthy", ")", ";", "}", "else", "{", "handleNonCriticalHealthChange", "(", "check", ".", "getName", "(", ")", ",", "check", ".", "getType", "(", ")", ",", "isNowHealthy", ")", ";", "}", "scheduler", ".", "schedule", "(", "check", ",", "isNowHealthy", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "initializeAppHealth", "(", ")", "{", "this", ".", "isAppHealthy", ".", "set", "(", "initialOverallState", ")", ";", "}", "</s>"]
["<s>", "private", "long", "calculateNumberOfHealthyChecks", "(", ")", "{", "return", "checks", ".", "values", "(", ")", ".", "stream", "(", ")", ".", "filter", "(", "ScheduledHealthCheck", ":", ":", "isHealthy", ")", ".", "count", "(", ")", ";", "}", "</s>"]
["<s>", "private", "long", "calculateNumberOfUnhealthyChecks", "(", ")", "{", "return", "checks", ".", "values", "(", ")", ".", "stream", "(", ")", ".", "filter", "(", "check", "-", ">", "!", "check", ".", "isHealthy", "(", ")", ")", ".", "count", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleCriticalHealthChange", "(", "final", "String", "name", ",", "final", "HealthCheckType", "type", ",", "final", "boolean", "isNowHealthy", ")", "{", "if", "(", "isNowHealthy", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "type", ")", ";", "switch", "(", "type", ")", "{", "case", "ALIVE", ":", "updateCriticalStatus", "(", "isAppAlive", ",", "unhealthyCriticalAliveChecks", ".", "decrementAndGet", "(", ")", ")", ";", "return", ";", "case", "READY", ":", "if", "(", "!", "shuttingDown", ")", "{", "updateCriticalStatus", "(", "isAppHealthy", ",", "unhealthyCriticalHealthChecks", ".", "decrementAndGet", "(", ")", ")", ";", "}", "else", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "type", ")", ";", "}", "return", ";", "}", "}", "else", "{", "log", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "type", ")", ";", "switch", "(", "type", ")", "{", "case", "ALIVE", ":", "updateCriticalStatus", "(", "isAppAlive", ",", "unhealthyCriticalAliveChecks", ".", "incrementAndGet", "(", ")", ")", ";", "return", ";", "case", "READY", ":", "updateCriticalStatus", "(", "isAppHealthy", ",", "unhealthyCriticalHealthChecks", ".", "incrementAndGet", "(", ")", ")", ";", "return", ";", "}", "}", "log", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "type", ")", ";", "}", "</s>"]
["<s>", "private", "void", "updateCriticalStatus", "(", "final", "AtomicBoolean", "status", ",", "final", "int", "count", ")", "{", "status", ".", "set", "(", "count", "=", "=", "0", ")", ";", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "count", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleNonCriticalHealthChange", "(", "final", "String", "name", ",", "final", "HealthCheckType", "type", ",", "final", "boolean", "isNowHealthy", ")", "{", "if", "(", "isNowHealthy", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "type", ")", ";", "}", "else", "{", "log", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "type", ")", ";", "}", "}", "</s>"]
["<s>", "String", "getAggregateHealthyName", "(", ")", "{", "return", "aggregateHealthyName", ";", "}", "</s>"]
["<s>", "String", "getAggregateUnhealthyName", "(", ")", "{", "return", "aggregateUnhealthyName", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isHealthy", "(", ")", "{", "return", "isAppAlive", ".", "get", "(", ")", "&", "&", "isAppHealthy", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isHealthy", "(", "@", "Nullable", "String", "type", ")", "{", "if", "(", "HealthCheckType", ".", "ALIVE", ".", "name", "(", ")", ".", "equalsIgnoreCase", "(", "type", ")", ")", "{", "return", "isAppAlive", ".", "get", "(", ")", ";", "}", "else", "{", "return", "isHealthy", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "notifyShutdownStarted", "(", ")", "throws", "Exception", "{", "shuttingDown", "=", "true", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "shutdownWaitPeriod", ")", ";", "isAppHealthy", ".", "set", "(", "false", ")", ";", "Thread", ".", "sleep", "(", "shutdownWaitPeriod", ".", "toMilliseconds", "(", ")", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "void", "scheduleInitial", "(", "final", "ScheduledHealthCheck", "check", ")", "{", "final", "Duration", "interval", ";", "if", "(", "check", ".", "isHealthy", "(", ")", ")", "{", "interval", "=", "check", ".", "getSchedule", "(", ")", ".", "getCheckInterval", "(", ")", ";", "}", "else", "{", "interval", "=", "check", ".", "getSchedule", "(", ")", ".", "getDowntimeInterval", "(", ")", ";", "}", "schedule", "(", "check", ",", "check", ".", "getSchedule", "(", ")", ".", "getInitialDelay", "(", ")", ",", "interval", ")", ";", "}", "</s>"]
["<s>", "public", "void", "schedule", "(", "final", "ScheduledHealthCheck", "check", ",", "final", "boolean", "healthy", ")", "{", "unschedule", "(", "check", ".", "getName", "(", ")", ")", ";", "final", "Duration", "interval", ";", "if", "(", "healthy", ")", "{", "interval", "=", "check", ".", "getSchedule", "(", ")", ".", "getCheckInterval", "(", ")", ";", "}", "else", "{", "interval", "=", "check", ".", "getSchedule", "(", ")", ".", "getDowntimeInterval", "(", ")", ";", "}", "schedule", "(", "check", ",", "interval", ",", "interval", ")", ";", "}", "</s>"]
["<s>", "private", "void", "schedule", "(", "final", "ScheduledHealthCheck", "check", ",", "final", "Duration", "initialDelay", ",", "final", "Duration", "delay", ")", "{", "final", "ScheduledFuture", "taskFuture", "=", "executorService", ".", "scheduleWithFixedDelay", "(", "check", ",", "initialDelay", ".", "toMilliseconds", "(", ")", ",", "delay", ".", "toMilliseconds", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "futures", ".", "put", "(", "check", ".", "getName", "(", ")", ",", "taskFuture", ")", ";", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "check", ")", ";", "}", "</s>"]
["<s>", "public", "void", "unschedule", "(", "final", "String", "name", ")", "{", "final", "ScheduledFuture", "taskFuture", "=", "futures", ".", "get", "(", "name", ")", ";", "if", "(", "taskFuture", "!", "=", "null", ")", "{", "taskFuture", ".", "cancel", "(", "true", ")", ";", "futures", ".", "remove", "(", "name", ")", ";", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "doGet", "(", "final", "HttpServletRequest", "req", ",", "final", "HttpServletResponse", "resp", ")", "throws", "IOException", "{", "if", "(", "cacheControlEnabled", ")", "{", "resp", ".", "setHeader", "(", "HttpHeaders", ".", "CACHE_CONTROL", ",", "cacheControlValue", ")", ";", "}", "resp", ".", "setContentType", "(", "contentType", ")", ";", "final", "String", "typeValue", "=", "req", ".", "getParameter", "(", "CHECK_TYPE_QUERY_PARAM", ")", ";", "final", "PrintWriter", "writer", "=", "resp", ".", "getWriter", "(", ")", ";", "if", "(", "healthStatusChecker", ".", "isHealthy", "(", "typeValue", ")", ")", "{", "writer", ".", "print", "(", "healthyValue", ")", ";", "}", "else", "{", "writer", ".", "print", "(", "unhealthyValue", ")", ";", "resp", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "}", "}", "</s>"]
["<s>", "default", "boolean", "isHealthy", "(", ")", "{", "return", "isHealthy", "(", "null", ")", ";", "}", "</s>"]
["<s>", "public", "HealthCheckType", "getType", "(", ")", "{", "return", "type", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCritical", "(", ")", "{", "return", "critical", ";", "}", "</s>"]
["<s>", "public", "Schedule", "getSchedule", "(", ")", "{", "return", "schedule", ";", "}", "</s>"]
["<s>", "public", "boolean", "isHealthy", "(", ")", "{", "return", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "log", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "HealthCheck", ".", "Result", "result", ";", "try", "{", "result", "=", "healthCheck", ".", "execute", "(", ")", ";", "}", "catch", "(", "final", "Exception", "e", ")", "{", "log", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "e", ")", ";", "result", "=", "HealthCheck", ".", "Result", ".", "unhealthy", "(", "e", ")", ";", "}", "if", "(", "result", ".", "isHealthy", "(", ")", ")", "{", "log", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "state", ".", "success", "(", ")", ";", "healthyCheckCounter", ".", "inc", "(", ")", ";", "}", "else", "{", "log", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "result", ")", ";", "state", ".", "failure", "(", ")", ";", "unhealthyCheckCounter", ".", "inc", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "final", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "!", "(", "o", "instanceof", "ScheduledHealthCheck", ")", ")", "return", "false", ";", "final", "ScheduledHealthCheck", "that", "=", "(", "ScheduledHealthCheck", ")", "o", ";", "return", "critical", "=", "=", "that", ".", "critical", "&", "&", "Objects", ".", "equals", "(", "name", ",", "that", ".", "name", ")", "&", "&", "Objects", ".", "equals", "(", "healthCheck", ",", "that", ".", "healthCheck", ")", "&", "&", "Objects", ".", "equals", "(", "schedule", ",", "that", ".", "schedule", ")", "&", "&", "Objects", ".", "equals", "(", "state", ",", "that", ".", "state", ")", "&", "&", "Objects", ".", "equals", "(", "healthyCheckCounter", ",", "that", ".", "healthyCheckCounter", ")", "&", "&", "Objects", ".", "equals", "(", "unhealthyCheckCounter", ",", "that", ".", "unhealthyCheckCounter", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "name", ",", "critical", ",", "healthCheck", ",", "schedule", ",", "state", ",", "healthyCheckCounter", ",", "unhealthyCheckCounter", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "name", ")", ".", "append", "(", "<STR_LIT>", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "critical", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "healthCheck", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "schedule", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "state", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "healthyCheckCounter", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "unhealthyCheckCounter", ")", ";", "sb", ".", "append", "(", "<CHAR_LIT:}>", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "void", "success", "(", ")", "{", "if", "(", "healthy", ".", "get", "(", ")", ")", "{", "return", ";", "}", "log", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "healthy", ")", ";", "handleEvent", "(", "successAttempts", ",", "true", ")", ";", "}", "</s>"]
["<s>", "void", "failure", "(", ")", "{", "if", "(", "!", "healthy", ".", "get", "(", ")", ")", "{", "return", ";", "}", "log", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "healthy", ")", ";", "handleEvent", "(", "failureAttempts", ",", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleEvent", "(", "final", "int", "numAttempts", ",", "final", "boolean", "result", ")", "{", "final", "int", "newCount", "=", "counter", ".", "incrementAndGet", "(", ")", ";", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "result", ",", "newCount", ",", "numAttempts", ")", ";", "if", "(", "newCount", ">", "=", "numAttempts", ")", "{", "final", "boolean", "newState", "=", "!", "healthy", ".", "get", "(", ")", ";", "healthy", ".", "set", "(", "newState", ")", ";", "resetCount", "(", ")", ";", "stateChangedCallback", ".", "onStateChanged", "(", "this", ".", "name", ",", "newState", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "resetCount", "(", ")", "{", "counter", ".", "set", "(", "0", ")", ";", "}", "</s>"]
["<s>", "AtomicBoolean", "getHealthy", "(", ")", "{", "return", "healthy", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "final", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "!", "(", "o", "instanceof", "State", ")", ")", "return", "false", ";", "final", "State", "state", "=", "(", "State", ")", "o", ";", "return", "successAttempts", "=", "=", "state", ".", "successAttempts", "&", "&", "failureAttempts", "=", "=", "state", ".", "failureAttempts", "&", "&", "Objects", ".", "equals", "(", "name", ",", "state", ".", "name", ")", "&", "&", "Objects", ".", "equals", "(", "stateChangedCallback", ",", "state", ".", "stateChangedCallback", ")", "&", "&", "Objects", ".", "equals", "(", "counter", ",", "state", ".", "counter", ")", "&", "&", "Objects", ".", "equals", "(", "healthy", ",", "state", ".", "healthy", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "name", ",", "successAttempts", ",", "failureAttempts", ",", "stateChangedCallback", ",", "counter", ",", "healthy", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setName", "(", "final", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "public", "void", "setType", "(", "HealthCheckType", "type", ")", "{", "this", ".", "type", "=", "type", ";", "}", "</s>"]
["<s>", "public", "void", "setCritical", "(", "final", "boolean", "critical", ")", "{", "this", ".", "critical", "=", "critical", ";", "}", "</s>"]
["<s>", "public", "boolean", "isInitialState", "(", ")", "{", "return", "initialState", ";", "}", "</s>"]
["<s>", "public", "void", "setInitialState", "(", "boolean", "initialState", ")", "{", "this", ".", "initialState", "=", "initialState", ";", "}", "</s>"]
["<s>", "public", "void", "setSchedule", "(", "final", "Schedule", "schedule", ")", "{", "this", ".", "schedule", "=", "schedule", ";", "}", "</s>"]
["<s>", "public", "Duration", "getInitialDelay", "(", ")", "{", "return", "initialDelay", "=", "=", "null", "?", "getCheckInterval", "(", ")", ":", "initialDelay", ";", "}", "</s>"]
["<s>", "public", "void", "setInitialDelay", "(", "Duration", "initialDelay", ")", "{", "this", ".", "initialDelay", "=", "initialDelay", ";", "}", "</s>"]
["<s>", "public", "Duration", "getCheckInterval", "(", ")", "{", "return", "checkInterval", ";", "}", "</s>"]
["<s>", "public", "void", "setCheckInterval", "(", "final", "Duration", "checkInterval", ")", "{", "this", ".", "checkInterval", "=", "checkInterval", ";", "}", "</s>"]
["<s>", "public", "Duration", "getDowntimeInterval", "(", ")", "{", "return", "downtimeInterval", ";", "}", "</s>"]
["<s>", "public", "void", "setDowntimeInterval", "(", "final", "Duration", "downtimeInterval", ")", "{", "this", ".", "downtimeInterval", "=", "downtimeInterval", ";", "}", "</s>"]
["<s>", "public", "int", "getFailureAttempts", "(", ")", "{", "return", "failureAttempts", ";", "}", "</s>"]
["<s>", "public", "void", "setFailureAttempts", "(", "final", "int", "failureAttempts", ")", "{", "this", ".", "failureAttempts", "=", "failureAttempts", ";", "}", "</s>"]
["<s>", "public", "int", "getSuccessAttempts", "(", ")", "{", "return", "successAttempts", ";", "}", "</s>"]
["<s>", "public", "void", "setSuccessAttempts", "(", "final", "int", "successAttempts", ")", "{", "this", ".", "successAttempts", "=", "successAttempts", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "final", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "!", "(", "o", "instanceof", "Schedule", ")", ")", "return", "false", ";", "final", "Schedule", "schedule", "=", "(", "Schedule", ")", "o", ";", "return", "failureAttempts", "=", "=", "schedule", ".", "failureAttempts", "&", "&", "successAttempts", "=", "=", "schedule", ".", "successAttempts", "&", "&", "Objects", ".", "equals", "(", "initialDelay", ",", "schedule", ".", "initialDelay", ")", "&", "&", "Objects", ".", "equals", "(", "checkInterval", ",", "schedule", ".", "checkInterval", ")", "&", "&", "Objects", ".", "equals", "(", "downtimeInterval", ",", "schedule", ".", "downtimeInterval", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "initialDelay", ",", "checkInterval", ",", "downtimeInterval", ",", "failureAttempts", ",", "successAttempts", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Result", "check", "(", ")", "{", "final", "HttpHealthResponse", "httpHealthResponse", "=", "httpCheck", "(", "url", ")", ";", "if", "(", "isHealthResponseValid", "(", "httpHealthResponse", ")", ")", "{", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "url", ")", ";", "return", "Result", ".", "healthy", "(", ")", ";", "}", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "url", ",", "httpHealthResponse", ")", ";", "return", "Result", ".", "unhealthy", "(", "\"", "<STR_LIT>", "\"", ",", "url", ",", "httpHealthResponse", ")", ";", "}", "</s>"]
["<s>", "protected", "HttpHealthResponse", "httpCheck", "(", "final", "String", "url", ")", "{", "final", "Response", "response", "=", "client", ".", "target", "(", "url", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "final", "String", "entityString", "=", "response", ".", "readEntity", "(", "String", ".", "class", ")", ";", "return", "new", "HttpHealthResponse", "(", "response", ".", "getStatus", "(", ")", ",", "entityString", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isHealthResponseValid", "(", "final", "HttpHealthResponse", "httpHealthResponse", ")", "{", "final", "Response", ".", "Status", ".", "Family", "statusFamily", "=", "Response", ".", "Status", ".", "Family", ".", "familyOf", "(", "httpHealthResponse", ".", "getStatus", "(", ")", ")", ";", "return", "statusFamily", "=", "=", "Response", ".", "Status", ".", "Family", ".", "SUCCESSFUL", ";", "}", "</s>"]
["<s>", "public", "int", "getStatus", "(", ")", "{", "return", "status", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "public", "String", "getBody", "(", ")", "{", "return", "body", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "final", "Object", "other", ")", "{", "if", "(", "this", "=", "=", "other", ")", "{", "return", "true", ";", "}", "if", "(", "!", "(", "other", "instanceof", "HttpHealthResponse", ")", ")", "{", "return", "false", ";", "}", "final", "HttpHealthResponse", "that", "=", "(", "HttpHealthResponse", ")", "other", ";", "return", "status", "=", "=", "that", ".", "status", "&", "&", "Objects", ".", "equals", "(", "body", ",", "that", ".", "body", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "status", ",", "body", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT:=>", "\"", ")", ".", "append", "(", "status", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "body", ")", ".", "append", "(", "<STR_LIT>", ")", ";", "sb", ".", "append", "(", "<CHAR_LIT:}>", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCacheControlEnabled", "(", ")", "{", "return", "cacheControlEnabled", ";", "}", "</s>"]
["<s>", "public", "void", "setCacheControlEnabled", "(", "final", "boolean", "cacheControlEnabled", ")", "{", "this", ".", "cacheControlEnabled", "=", "cacheControlEnabled", ";", "}", "</s>"]
["<s>", "public", "String", "getCacheControlValue", "(", ")", "{", "return", "cacheControlValue", ";", "}", "</s>"]
["<s>", "public", "void", "setCacheControlValue", "(", "final", "String", "cacheControlValue", ")", "{", "this", ".", "cacheControlValue", "=", "cacheControlValue", ";", "}", "</s>"]
["<s>", "public", "String", "getContentType", "(", ")", "{", "return", "contentType", ";", "}", "</s>"]
["<s>", "public", "void", "setContentType", "(", "final", "String", "contentType", ")", "{", "this", ".", "contentType", "=", "contentType", ";", "}", "</s>"]
["<s>", "public", "String", "getHealthyValue", "(", ")", "{", "return", "healthyValue", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthyValue", "(", "final", "String", "healthyValue", ")", "{", "this", ".", "healthyValue", "=", "healthyValue", ";", "}", "</s>"]
["<s>", "public", "String", "getUnhealthyValue", "(", ")", "{", "return", "unhealthyValue", ";", "}", "</s>"]
["<s>", "public", "void", "setUnhealthyValue", "(", "final", "String", "unhealthyValue", ")", "{", "this", ".", "unhealthyValue", "=", "unhealthyValue", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HttpServlet", "build", "(", "HealthStatusChecker", "healthStatusChecker", ")", "{", "return", "new", "HealthCheckServlet", "(", "healthStatusChecker", ",", "cacheControlEnabled", ",", "cacheControlValue", ",", "contentType", ",", "healthyValue", ",", "unhealthyValue", ")", ";", "}", "</s>"]
["<s>", "public", "void", "register", "(", ")", "{", "try", "{", "start", "(", ")", ";", "ShutdownThread", ".", "register", "(", "0", ",", "this", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "doStop", "(", ")", "throws", "Exception", "{", "shutdownNotifier", ".", "notifyShutdownStarted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Result", "check", "(", ")", "throws", "IOException", "{", "final", "boolean", "isHealthy", "=", "tcpCheck", "(", "host", ",", "port", ")", ";", "if", "(", "isHealthy", ")", "{", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "host", ",", "port", ")", ";", "return", "Result", ".", "healthy", "(", ")", ";", "}", "log", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "host", ",", "port", ")", ";", "return", "Result", ".", "unhealthy", "(", "\"", "<STR_LIT>", "\"", ",", "host", ",", "port", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "tcpCheck", "(", "final", "String", "host", ",", "final", "int", "port", ")", "throws", "IOException", "{", "try", "(", "Socket", "socket", "=", "new", "Socket", "(", ")", ")", "{", "socket", ".", "connect", "(", "new", "InetSocketAddress", "(", "host", ",", "port", ")", ",", "(", "int", ")", "connectionTimeout", ".", "toMillis", "(", ")", ")", ";", "return", "socket", ".", "isConnected", "(", ")", ";", "}", "}", "</s>"]
["<s>", "Duration", "getConnectionTimeout", "(", ")", "{", "return", "connectionTimeout", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldBuildHealthFactoryFromYaml", "(", ")", "throws", "Exception", "{", "final", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "final", "DefaultHealthFactory", "healthFactory", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "assertThat", "(", "healthFactory", ".", "isDelayedShutdownHandlerEnabled", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "healthFactory", ".", "getShutdownWaitPeriod", "(", ")", ".", "toMilliseconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "healthFactory", ".", "getHealthCheckUrlPaths", "(", ")", ")", ".", "isEqualTo", "(", "ImmutableList", ".", "of", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "healthFactory", ".", "getHealthCheckConfigurations", "(", ")", ".", "stream", "(", ")", ".", "map", "(", "HealthCheckConfiguration", ":", ":", "getName", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "healthFactory", ".", "getHealthCheckConfigurations", "(", ")", ".", "stream", "(", ")", ".", "map", "(", "HealthCheckConfiguration", ":", ":", "isCritical", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ")", ".", "contains", "(", "true", ",", "false", ",", "false", ")", ";", "healthFactory", ".", "getHealthCheckConfigurations", "(", ")", ".", "forEach", "(", "healthCheckConfig", "-", ">", "{", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getCheckInterval", "(", ")", ".", "toSeconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getDowntimeInterval", "(", ")", ".", "toSeconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getFailureAttempts", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getSuccessAttempts", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:2>", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "ch", ".", "qos", ".", "logback", ".", "classic", ".", "Logger", "logger", "=", "(", "ch", ".", "qos", ".", "logback", ".", "classic", ".", "Logger", ")", "LoggerFactory", ".", "getLogger", "(", "HealthCheckConfigValidator", ".", "class", ")", ";", "logger", ".", "addAppender", "(", "mockLogAppender", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "ch", ".", "qos", ".", "logback", ".", "classic", ".", "Logger", "logger", "=", "(", "ch", ".", "qos", ".", "logback", ".", "classic", ".", "Logger", ")", "LoggerFactory", ".", "getLogger", "(", "HealthCheckConfigValidator", ".", "class", ")", ";", "logger", ".", "detachAppender", "(", "mockLogAppender", ")", ";", "MDC", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "startValidationsShouldSucceedWhenNoHealthChecksConfigured", "(", ")", "throws", "Exception", "{", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", ")", ";", "HealthCheckRegistry", "registry", "=", "new", "HealthCheckRegistry", "(", ")", ";", "HealthCheckConfigValidator", "validator", "=", "new", "HealthCheckConfigValidator", "(", "configs", ",", "registry", ")", ";", "validator", ".", "start", "(", ")", ";", "verifyNoInteractions", "(", "mockLogAppender", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "startValidationsShouldSucceedForConfiguredAndRegisteredHealthCheck", "(", ")", "throws", "Exception", "{", "HealthCheckConfiguration", "check1", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "check1", ".", "setName", "(", "\"", "<STR_LIT:-1>", "\"", ")", ";", "HealthCheckConfiguration", "check2", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "check2", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", "check1", ",", "check2", ")", ";", "HealthCheckRegistry", "registry", "=", "new", "HealthCheckRegistry", "(", ")", ";", "registry", ".", "register", "(", "\"", "<STR_LIT:-1>", "\"", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "registry", ".", "register", "(", "\"", "<STR_LIT>", "\"", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "HealthCheckConfigValidator", "validator", "=", "new", "HealthCheckConfigValidator", "(", "configs", ",", "registry", ")", ";", "validator", ".", "start", "(", ")", ";", "verifyNoInteractions", "(", "mockLogAppender", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "startValidationsShouldSucceedButLogWhenNotAllHealthChecksAreConfigured", "(", ")", "throws", "Exception", "{", "ArgumentCaptor", "<", "LoggingEvent", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "LoggingEvent", ".", "class", ")", ";", "HealthCheckConfiguration", "check1", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "check1", ".", "setName", "(", "\"", "<STR_LIT:-1>", "\"", ")", ";", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", "check1", ")", ";", "HealthCheckRegistry", "registry", "=", "new", "HealthCheckRegistry", "(", ")", ";", "registry", ".", "register", "(", "\"", "<STR_LIT:-1>", "\"", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "registry", ".", "register", "(", "\"", "<STR_LIT>", "\"", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "registry", ".", "register", "(", "\"", "<STR_LIT>", "\"", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "HealthCheckConfigValidator", "validator", "=", "new", "HealthCheckConfigValidator", "(", "configs", ",", "registry", ")", ";", "validator", ".", "start", "(", ")", ";", "verify", "(", "mockLogAppender", ")", ".", "doAppend", "(", "captor", ".", "capture", "(", ")", ")", ";", "LoggingEvent", "logEvent", "=", "captor", ".", "getValue", "(", ")", ";", "assertThat", "(", "logEvent", ".", "getLevel", "(", ")", ")", ".", "isEqualTo", "(", "Level", ".", "INFO", ")", ";", "assertThat", "(", "logEvent", ".", "getFormattedMessage", "(", ")", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "logEvent", ".", "getFormattedMessage", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "logEvent", ".", "getFormattedMessage", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "startValidationsShouldFailIfAHealthCheckConfiguredButNotRegistered", "(", ")", "throws", "Exception", "{", "ArgumentCaptor", "<", "LoggingEvent", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "LoggingEvent", ".", "class", ")", ";", "HealthCheckConfiguration", "check1", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "check1", ".", "setName", "(", "\"", "<STR_LIT:-1>", "\"", ")", ";", "HealthCheckConfiguration", "check2", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "check2", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "HealthCheckConfiguration", "check3", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "check3", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", "check1", ",", "check2", ",", "check3", ")", ";", "HealthCheckRegistry", "registry", "=", "new", "HealthCheckRegistry", "(", ")", ";", "registry", ".", "register", "(", "\"", "<STR_LIT:-1>", "\"", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "try", "{", "HealthCheckConfigValidator", "validator", "=", "new", "HealthCheckConfigValidator", "(", "configs", ",", "registry", ")", ";", "validator", ".", "start", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "IllegalStateException", "e", ")", "{", "verify", "(", "mockLogAppender", ")", ".", "doAppend", "(", "captor", ".", "capture", "(", ")", ")", ";", "LoggingEvent", "logEvent", "=", "captor", ".", "getValue", "(", ")", ";", "assertThat", "(", "logEvent", ".", "getLevel", "(", ")", ")", ".", "isEqualTo", "(", "Level", ".", "ERROR", ")", ";", "assertThat", "(", "logEvent", ".", "getFormattedMessage", "(", ")", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "logEvent", ".", "getFormattedMessage", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "logEvent", ".", "getFormattedMessage", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "e", ".", "getMessage", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldIgnoreUnconfiguredAddedHealthChecks", "(", ")", "{", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "emptyList", "(", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "verifyNoInteractions", "(", "scheduler", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldScheduleHealthCheckWhenConfiguredHealthCheckAdded", "(", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "config", ".", "setName", "(", "NAME", ")", ";", "config", ".", "setCritical", "(", "true", ")", ";", "config", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "singletonList", "(", "config", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "verifyCheckWasScheduled", "(", "scheduler", ",", "NAME", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldUnscheduleTaskWhenHealthCheckRemoved", "(", ")", "{", "final", "ScheduledHealthCheck", "healthCheck", "=", "mock", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "emptyList", "(", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ",", "ImmutableMap", ".", "of", "(", "NAME", ",", "healthCheck", ")", ")", ";", "manager", ".", "onHealthCheckRemoved", "(", "NAME", ",", "mock", "(", "HealthCheck", ".", "class", ")", ")", ";", "verify", "(", "scheduler", ")", ".", "unschedule", "(", "NAME", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldDoNothingWhenStateChangesForUnconfiguredHealthCheck", "(", ")", "{", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "emptyList", "(", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "verifyNoInteractions", "(", "scheduler", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldReportUnhealthyWhenInitialOverallStateIsFalse", "(", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "config", ".", "setName", "(", "NAME", ")", ";", "config", ".", "setCritical", "(", "true", ")", ";", "config", ".", "setInitialState", "(", "false", ")", ";", "config", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "singletonList", "(", "config", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "false", ")", ";", "manager", ".", "initializeAppHealth", "(", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "check", ")", ";", "boolean", "beforeSuccessReadyStatus", "=", "manager", ".", "isHealthy", "(", ")", ";", "boolean", "beforeSuccessAliveStatus", "=", "manager", ".", "isHealthy", "(", "\"", "<STR_LIT>", "\"", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "true", ")", ";", "boolean", "afterSuccessReadyStatus", "=", "manager", ".", "isHealthy", "(", ")", ";", "boolean", "afterSuccessAliveStatus", "=", "manager", ".", "isHealthy", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "beforeSuccessReadyStatus", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "beforeSuccessAliveStatus", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "afterSuccessReadyStatus", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "afterSuccessAliveStatus", ")", ".", "isTrue", "(", ")", ";", "verifyCheckWasScheduled", "(", "scheduler", ",", "NAME", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldMarkServerUnhealthyWhenCriticalHealthCheckFails", "(", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "config", ".", "setName", "(", "NAME", ")", ";", "config", ".", "setCritical", "(", "true", ")", ";", "config", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "singletonList", "(", "config", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "manager", ".", "initializeAppHealth", "(", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "check", ")", ";", "boolean", "beforeFailureReadyStatus", "=", "manager", ".", "isHealthy", "(", ")", ";", "boolean", "beforeFailureAliveStatus", "=", "manager", ".", "isHealthy", "(", "\"", "<STR_LIT>", "\"", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "boolean", "afterFailureReadyStatus", "=", "manager", ".", "isHealthy", "(", ")", ";", "boolean", "afterFailureAliveStatus", "=", "manager", ".", "isHealthy", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "beforeFailureReadyStatus", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "beforeFailureAliveStatus", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "afterFailureReadyStatus", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "afterFailureAliveStatus", ")", ".", "isTrue", "(", ")", ";", "verifyCheckWasScheduled", "(", "scheduler", ",", "NAME", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldMarkServerNotAliveAndUnhealthyWhenCriticalAliveCheckFails", "(", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "config", ".", "setName", "(", "NAME", ")", ";", "config", ".", "setType", "(", "HealthCheckType", ".", "ALIVE", ")", ";", "config", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "singletonList", "(", "config", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "manager", ".", "initializeAppHealth", "(", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "check", ")", ";", "boolean", "beforeFailureReadyStatus", "=", "manager", ".", "isHealthy", "(", ")", ";", "boolean", "beforeFailureAliveStatus", "=", "manager", ".", "isHealthy", "(", "\"", "<STR_LIT>", "\"", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "boolean", "afterFailureReadyStatus", "=", "manager", ".", "isHealthy", "(", ")", ";", "boolean", "afterFailureAliveStatus", "=", "manager", ".", "isHealthy", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "beforeFailureReadyStatus", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "beforeFailureAliveStatus", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "afterFailureReadyStatus", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "afterFailureAliveStatus", ")", ".", "isFalse", "(", ")", ";", "verifyCheckWasScheduled", "(", "scheduler", ",", "NAME", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldMarkServerHealthyWhenCriticalHealthCheckRecovers", "(", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "config", ".", "setName", "(", "NAME", ")", ";", "config", ".", "setCritical", "(", "true", ")", ";", "config", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "singletonList", "(", "config", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "check", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "boolean", "beforeRecovery", "=", "manager", ".", "isHealthy", "(", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "true", ")", ";", "boolean", "afterRecovery", "=", "manager", ".", "isHealthy", "(", ")", ";", "assertThat", "(", "beforeRecovery", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "afterRecovery", ")", ".", "isTrue", "(", ")", ";", "ArgumentCaptor", "<", "ScheduledHealthCheck", ">", "checkCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "ArgumentCaptor", "<", "Boolean", ">", "healthyCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "Boolean", ".", "class", ")", ";", "verify", "(", "scheduler", ")", ".", "scheduleInitial", "(", "checkCaptor", ".", "capture", "(", ")", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "schedule", "(", "checkCaptor", ".", "capture", "(", ")", ",", "healthyCaptor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "0", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "0", ")", ".", "isCritical", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "1", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "1", ")", ".", "isCritical", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "healthyCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "0", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:2>", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:2>", ")", ".", "isCritical", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "healthyCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "1", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldNotChangeServerStateWhenNonCriticalHealthCheckFails", "(", ")", "{", "final", "HealthCheckConfiguration", "config", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "config", ".", "setName", "(", "NAME", ")", ";", "config", ".", "setCritical", "(", "false", ")", ";", "config", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "Collections", ".", "singletonList", "(", "config", ")", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "manager", ".", "initializeAppHealth", "(", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "check", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "boolean", "afterFailure", "=", "manager", ".", "isHealthy", "(", ")", ";", "verifyCheckWasScheduled", "(", "scheduler", ",", "NAME", ",", "false", ")", ";", "assertThat", "(", "afterFailure", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldNotChangeServerStateWhenNonCriticalHealthCheckRecovers", "(", ")", "{", "final", "HealthCheckConfiguration", "nonCriticalConfig", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "nonCriticalConfig", ".", "setName", "(", "NAME", ")", ";", "nonCriticalConfig", ".", "setCritical", "(", "false", ")", ";", "nonCriticalConfig", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "HealthCheckConfiguration", "criticalConfig", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "criticalConfig", ".", "setName", "(", "NAME_2", ")", ";", "criticalConfig", ".", "setCritical", "(", "true", ")", ";", "criticalConfig", ".", "setSchedule", "(", "new", "Schedule", "(", ")", ")", ";", "final", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", "nonCriticalConfig", ",", "criticalConfig", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "configs", ",", "scheduler", ",", "new", "MetricRegistry", "(", ")", ",", "SHUTDOWN_WAIT", ",", "true", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME", ",", "check", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "NAME_2", ",", "check", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "manager", ".", "onStateChanged", "(", "NAME_2", ",", "false", ")", ";", "boolean", "beforeRecovery", "=", "manager", ".", "isHealthy", "(", ")", ";", "manager", ".", "onStateChanged", "(", "NAME", ",", "true", ")", ";", "boolean", "afterRecovery", "=", "manager", ".", "isHealthy", "(", ")", ";", "assertThat", "(", "beforeRecovery", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "afterRecovery", ")", ".", "isFalse", "(", ")", ";", "ArgumentCaptor", "<", "ScheduledHealthCheck", ">", "checkCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "ArgumentCaptor", "<", "Boolean", ">", "healthyCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "Boolean", ".", "class", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "scheduleInitial", "(", "checkCaptor", ".", "capture", "(", ")", ")", ";", "verify", "(", "scheduler", ",", "times", "(", "<NUM_LIT:3>", ")", ")", ".", "schedule", "(", "checkCaptor", ".", "capture", "(", ")", ",", "healthyCaptor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "0", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "0", ")", ".", "isCritical", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "1", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME_2", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "1", ")", ".", "isCritical", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:2>", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:2>", ")", ".", "isCritical", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "healthyCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "0", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:3>", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME_2", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:3>", ")", ".", "isCritical", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "healthyCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "1", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:4>", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:4>", ")", ".", "isCritical", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "healthyCaptor", ".", "getAllValues", "(", ")", ".", "get", "(", "<NUM_LIT:2>", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldRecordNumberOfHealthyAndUnhealthyHealthChecks", "(", ")", "{", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "final", "HealthCheckConfiguration", "nonCriticalConfig", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "nonCriticalConfig", ".", "setName", "(", "NAME", ")", ";", "nonCriticalConfig", ".", "setCritical", "(", "false", ")", ";", "nonCriticalConfig", ".", "setSchedule", "(", "schedule", ")", ";", "final", "HealthCheckConfiguration", "criticalConfig", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "criticalConfig", ".", "setName", "(", "NAME_2", ")", ";", "criticalConfig", ".", "setCritical", "(", "true", ")", ";", "criticalConfig", ".", "setSchedule", "(", "schedule", ")", ";", "final", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", "nonCriticalConfig", ",", "criticalConfig", ")", ";", "final", "HealthCheck", "check", "=", "mock", "(", "HealthCheck", ".", "class", ")", ";", "final", "MetricRegistry", "metrics", "=", "new", "MetricRegistry", "(", ")", ";", "final", "ScheduledHealthCheck", "check1", "=", "new", "ScheduledHealthCheck", "(", "NAME", ",", "READY", ",", "nonCriticalConfig", ".", "isCritical", "(", ")", ",", "check", ",", "schedule", ",", "new", "State", "(", "NAME", ",", "schedule", ".", "getFailureAttempts", "(", ")", ",", "schedule", ".", "getSuccessAttempts", "(", ")", ",", "true", ",", "(", "name", ",", "newState", ")", "-", ">", "{", "}", ")", ",", "metrics", ".", "counter", "(", "NAME", "+", "\"", "<STR_LIT>", "\"", ")", ",", "metrics", ".", "counter", "(", "NAME", "+", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "ScheduledHealthCheck", "check2", "=", "new", "ScheduledHealthCheck", "(", "NAME_2", ",", "READY", ",", "criticalConfig", ".", "isCritical", "(", ")", ",", "check", ",", "schedule", ",", "new", "State", "(", "NAME", ",", "schedule", ".", "getFailureAttempts", "(", ")", ",", "schedule", ".", "getSuccessAttempts", "(", ")", ",", "true", ",", "(", "name", ",", "newState", ")", "-", ">", "{", "}", ")", ",", "metrics", ".", "counter", "(", "NAME_2", "+", "\"", "<STR_LIT>", "\"", ")", ",", "metrics", ".", "counter", "(", "NAME_2", "+", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "configs", ",", "scheduler", ",", "metrics", ",", "SHUTDOWN_WAIT", ",", "true", ",", "ImmutableMap", ".", "of", "(", "NAME", ",", "check1", ",", "NAME_2", ",", "check2", ")", ")", ";", "assertThat", "(", "metrics", ".", "gauge", "(", "manager", ".", "getAggregateHealthyName", "(", ")", ",", "null", ")", ".", "getValue", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "metrics", ".", "gauge", "(", "manager", ".", "getAggregateUnhealthyName", "(", ")", ",", "null", ")", ".", "getValue", "(", ")", ")", ".", "isEqualTo", "(", "0", "L", ")", ";", "when", "(", "check", ".", "execute", "(", ")", ")", ".", "thenReturn", "(", "HealthCheck", ".", "Result", ".", "unhealthy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "check2", ".", "run", "(", ")", ";", "check2", ".", "run", "(", ")", ";", "check2", ".", "run", "(", ")", ";", "assertThat", "(", "metrics", ".", "gauge", "(", "manager", ".", "getAggregateHealthyName", "(", ")", ",", "null", ")", ".", "getValue", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "metrics", ".", "gauge", "(", "manager", ".", "getAggregateUnhealthyName", "(", ")", ",", "null", ")", ".", "getValue", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldContinueScheduledCheckingWhileDelayingShutdown", "(", ")", "throws", "Exception", "{", "final", "int", "checkIntervalMillis", "=", "<NUM_LIT:10>", ";", "final", "int", "shutdownWaitTimeMillis", "=", "<NUM_LIT>", ";", "final", "int", "expectedCount", "=", "shutdownWaitTimeMillis", "/", "checkIntervalMillis", "-", "1", ";", "final", "AtomicBoolean", "shutdownFailure", "=", "new", "AtomicBoolean", "(", "false", ")", ";", "final", "CountingHealthCheck", "check", "=", "new", "CountingHealthCheck", "(", ")", ";", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "schedule", ".", "setCheckInterval", "(", "Duration", ".", "milliseconds", "(", "checkIntervalMillis", ")", ")", ";", "final", "HealthCheckConfiguration", "checkConfig", "=", "new", "HealthCheckConfiguration", "(", ")", ";", "checkConfig", ".", "setName", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "checkConfig", ".", "setCritical", "(", "true", ")", ";", "checkConfig", ".", "setSchedule", "(", "schedule", ")", ";", "final", "List", "<", "HealthCheckConfiguration", ">", "configs", "=", "ImmutableList", ".", "of", "(", "checkConfig", ")", ";", "final", "ScheduledExecutorService", "executorService", "=", "new", "ScheduledThreadPoolExecutor", "(", "1", ")", ";", "final", "HealthCheckScheduler", "scheduler", "=", "new", "HealthCheckScheduler", "(", "executorService", ")", ";", "final", "MetricRegistry", "metrics", "=", "new", "MetricRegistry", "(", ")", ";", "final", "Duration", "shutdownWaitPeriod", "=", "Duration", ".", "milliseconds", "(", "shutdownWaitTimeMillis", ")", ";", "final", "HealthCheckManager", "manager", "=", "new", "HealthCheckManager", "(", "configs", ",", "scheduler", ",", "metrics", ",", "shutdownWaitPeriod", ",", "true", ")", ";", "manager", ".", "onHealthCheckAdded", "(", "\"", "<STR_LIT:1>", "\"", ",", "check", ")", ";", "final", "Thread", "shutdownThread", "=", "new", "Thread", "(", "(", ")", "-", ">", "{", "try", "{", "manager", ".", "notifyShutdownStarted", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "shutdownFailure", ".", "set", "(", "true", ")", ";", "e", ".", "printStackTrace", "(", ")", ";", "}", "}", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT:20>", ")", ";", "long", "beforeCount", "=", "check", ".", "getCount", "(", ")", ";", "shutdownThread", ".", "start", "(", ")", ";", "shutdownThread", ".", "join", "(", ")", ";", "long", "afterCount", "=", "check", ".", "getCount", "(", ")", ";", "assertThat", "(", "shutdownFailure", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "afterCount", "-", "beforeCount", ")", ".", "isGreaterThanOrEqualTo", "(", "expectedCount", ")", ";", "}", "</s>"]
["<s>", "private", "void", "verifyCheckWasScheduled", "(", "HealthCheckScheduler", "scheduler", ",", "String", "name", ",", "boolean", "critical", ")", "{", "ArgumentCaptor", "<", "ScheduledHealthCheck", ">", "checkCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "verify", "(", "scheduler", ")", ".", "scheduleInitial", "(", "checkCaptor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "checkCaptor", ".", "getValue", "(", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "name", ")", ";", "assertThat", "(", "checkCaptor", ".", "getValue", "(", ")", ".", "isCritical", "(", ")", ")", ".", "isEqualTo", "(", "critical", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getCount", "(", ")", "{", "return", "counter", ".", "getCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Result", "check", "(", ")", "throws", "Exception", "{", "counter", ".", "inc", "(", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "getCount", "(", ")", ")", ";", "return", "Result", ".", "healthy", "(", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "{", "this", ".", "scheduler", "=", "new", "HealthCheckScheduler", "(", "executor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldScheduleCheckForNotAlreadyScheduledHealthyDependency", "(", ")", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "mock", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "when", "(", "check", ".", "getName", "(", ")", ")", ".", "thenReturn", "(", "name", ")", ";", "when", "(", "check", ".", "getSchedule", "(", ")", ")", ".", "thenReturn", "(", "schedule", ")", ";", "when", "(", "executor", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ")", ".", "thenReturn", "(", "mock", "(", "ScheduledFuture", ".", "class", ")", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "true", ")", ";", "verify", "(", "executor", ")", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldScheduleCheckForNotAlreadyScheduledUnhealthyDependency", "(", ")", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "mock", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "when", "(", "check", ".", "getName", "(", ")", ")", ".", "thenReturn", "(", "name", ")", ";", "when", "(", "check", ".", "getSchedule", "(", ")", ")", ".", "thenReturn", "(", "schedule", ")", ";", "when", "(", "executor", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ")", ".", "thenReturn", "(", "mock", "(", "ScheduledFuture", ".", "class", ")", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "false", ")", ";", "verify", "(", "executor", ")", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldRescheduleCheckForHealthyDependency", "(", ")", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "final", "ScheduledFuture", "future", "=", "mock", "(", "ScheduledFuture", ".", "class", ")", ";", "when", "(", "future", ".", "cancel", "(", "true", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "mock", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "when", "(", "check", ".", "getName", "(", ")", ")", ".", "thenReturn", "(", "name", ")", ";", "when", "(", "check", ".", "getSchedule", "(", ")", ")", ".", "thenReturn", "(", "schedule", ")", ";", "when", "(", "executor", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ")", ".", "thenReturn", "(", "future", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "false", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "true", ")", ";", "verify", "(", "executor", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ";", "verify", "(", "future", ")", ".", "cancel", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldRescheduleCheckForUnhealthyDependency", "(", ")", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "final", "ScheduledFuture", "future", "=", "mock", "(", "ScheduledFuture", ".", "class", ")", ";", "when", "(", "future", ".", "cancel", "(", "true", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "mock", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "when", "(", "check", ".", "getName", "(", ")", ")", ".", "thenReturn", "(", "name", ")", ";", "when", "(", "check", ".", "getSchedule", "(", ")", ")", ".", "thenReturn", "(", "schedule", ")", ";", "when", "(", "executor", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ")", ".", "thenReturn", "(", "future", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "true", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "false", ")", ";", "verify", "(", "executor", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ";", "verify", "(", "future", ")", ".", "cancel", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldUnscheduleExistingCheck", "(", ")", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Schedule", "schedule", "=", "new", "Schedule", "(", ")", ";", "final", "ScheduledFuture", "future", "=", "mock", "(", "ScheduledFuture", ".", "class", ")", ";", "final", "ScheduledHealthCheck", "check", "=", "mock", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "when", "(", "check", ".", "getName", "(", ")", ")", ".", "thenReturn", "(", "name", ")", ";", "when", "(", "check", ".", "getSchedule", "(", ")", ")", ".", "thenReturn", "(", "schedule", ")", ";", "when", "(", "executor", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "or", "(", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ")", ".", "thenReturn", "(", "future", ")", ";", "scheduler", ".", "schedule", "(", "check", ",", "true", ")", ";", "scheduler", ".", "unschedule", "(", "name", ")", ";", "verify", "(", "executor", ")", ".", "scheduleWithFixedDelay", "(", "eq", "(", "check", ")", ",", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ",", "eq", "(", "TimeUnit", ".", "MILLISECONDS", ")", ")", ";", "verify", "(", "future", ")", ".", "cancel", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "unscheduleShouldDoNothingIfNoCheckScheduled", "(", ")", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "scheduler", ".", "unschedule", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "healthyCheckShouldResultInSuccess", "(", ")", "{", "when", "(", "schedule", ".", "getSuccessAttempts", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "schedule", ".", "getFailureAttempts", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Counter", "healthyCounter", "=", "metrics", ".", "counter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "Counter", "unhealthyCounter", "=", "metrics", ".", "counter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "State", "state", "=", "new", "State", "(", "name", ",", "schedule", ".", "getFailureAttempts", "(", ")", ",", "schedule", ".", "getSuccessAttempts", "(", ")", ",", "true", ",", "(", "checkName", ",", "newState", ")", "-", ">", "{", "}", ")", ";", "final", "ScheduledHealthCheck", "scheduledHealthCheck", "=", "new", "ScheduledHealthCheck", "(", "name", ",", "HealthCheckType", ".", "READY", ",", "true", ",", "healthCheck", ",", "schedule", ",", "state", ",", "healthyCounter", ",", "unhealthyCounter", ")", ";", "when", "(", "healthCheck", ".", "execute", "(", ")", ")", ".", "thenReturn", "(", "HealthCheck", ".", "Result", ".", "healthy", "(", ")", ")", ";", "scheduledHealthCheck", ".", "run", "(", ")", ";", "assertThat", "(", "scheduledHealthCheck", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "healthyCounter", ".", "getCount", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "unhealthyCounter", ".", "getCount", "(", ")", ")", ".", "isEqualTo", "(", "0", "L", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "unhealthyCheckShouldResultInFail", "(", ")", "{", "when", "(", "schedule", ".", "getSuccessAttempts", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "when", "(", "schedule", ".", "getFailureAttempts", "(", ")", ")", ".", "thenReturn", "(", "1", ")", ";", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "Counter", "healthyCounter", "=", "metrics", ".", "counter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "Counter", "unhealthyCounter", "=", "metrics", ".", "counter", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "State", "state", "=", "new", "State", "(", "name", ",", "schedule", ".", "getFailureAttempts", "(", ")", ",", "schedule", ".", "getSuccessAttempts", "(", ")", ",", "true", ",", "(", "checkName", ",", "newState", ")", "-", ">", "{", "}", ")", ";", "final", "ScheduledHealthCheck", "scheduledHealthCheck", "=", "new", "ScheduledHealthCheck", "(", "name", ",", "HealthCheckType", ".", "READY", ",", "true", ",", "healthCheck", ",", "schedule", ",", "state", ",", "healthyCounter", ",", "unhealthyCounter", ")", ";", "when", "(", "healthCheck", ".", "execute", "(", ")", ")", ".", "thenReturn", "(", "HealthCheck", ".", "Result", ".", "unhealthy", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "scheduledHealthCheck", ".", "run", "(", ")", ";", "assertThat", "(", "scheduledHealthCheck", ".", "isHealthy", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "healthyCounter", ".", "getCount", "(", ")", ")", ".", "isEqualTo", "(", "0", "L", ")", ";", "assertThat", "(", "unhealthyCounter", ".", "getCount", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "{", "didStateChange", ".", "set", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "singleFailureShouldNotChangeStateIfThresholdNotExceeded", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "<NUM_LIT:2>", ",", "1", ",", "true", ",", "(", "healthCheckName", ",", "newState", ")", "-", ">", "didStateChange", ".", "set", "(", "true", ")", ")", ";", "state", ".", "failure", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "singleFailureShouldChangeStateIfThresholdExceeded", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "1", ",", "1", ",", "true", ",", "(", "healthCheckName", ",", "newState", ")", "-", ">", "didStateChange", ".", "set", "(", "true", ")", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "state", ".", "failure", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "singleSuccessShouldNotChangeStateIfThresholdNotExceeded", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "1", ",", "<NUM_LIT:2>", ",", "false", ",", "(", "healthCheckName", ",", "newState", ")", "-", ">", "didStateChange", ".", "set", "(", "true", ")", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "state", ".", "success", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "singleSuccessShouldChangeStateIfThresholdExceeded", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "1", ",", "1", ",", "false", ",", "(", "healthCheckName", ",", "newState", ")", "-", ">", "didStateChange", ".", "set", "(", "true", ")", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "state", ".", "success", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "failureFollowedByRecoveryShouldAllowAStateChangeToUnhealthyAfterAnotherFailureOccurs", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "1", ",", "1", ",", "true", ",", "(", "healthCheckName", ",", "newState", ")", "-", ">", "didStateChange", ".", "set", "(", "true", ")", ")", ";", "state", ".", "failure", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "didStateChange", ".", "set", "(", "false", ")", ";", "state", ".", "success", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "didStateChange", ".", "set", "(", "false", ")", ";", "state", ".", "failure", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "successFollowedByFailureShouldAllowAStateChangeToHealthyAfterAnotherSuccessOccurs", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "1", ",", "1", ",", "false", ",", "(", "healthCheckName", ",", "newState", ")", "-", ">", "didStateChange", ".", "set", "(", "true", ")", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "state", ".", "success", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "didStateChange", ".", "set", "(", "false", ")", ";", "state", ".", "failure", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isFalse", "(", ")", ";", "didStateChange", ".", "set", "(", "false", ")", ";", "state", ".", "success", "(", ")", ";", "assertThat", "(", "didStateChange", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "state", ".", "getHealthy", "(", ")", ".", "get", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "dependencyFailingThenRecoveringTriggersStateChangeEventsCorrectly", "(", ")", "{", "final", "State", "state", "=", "new", "State", "(", "NAME", ",", "<NUM_LIT:3>", ",", "<NUM_LIT:2>", ",", "true", ",", "callback", ")", ";", "state", ".", "success", "(", ")", ";", "state", ".", "failure", "(", ")", ";", "state", ".", "failure", "(", ")", ";", "state", ".", "failure", "(", ")", ";", "verify", "(", "callback", ")", ".", "onStateChanged", "(", "NAME", ",", "false", ")", ";", "state", ".", "success", "(", ")", ";", "state", ".", "success", "(", ")", ";", "verify", "(", "callback", ")", ".", "onStateChanged", "(", "NAME", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldBuildHealthCheckConfigurationFromYaml", "(", ")", "throws", "Exception", "{", "final", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "final", "HealthCheckConfiguration", "healthCheckConfig", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "isCritical", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getCheckInterval", "(", ")", ".", "toSeconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getDowntimeInterval", "(", ")", ".", "toSeconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getFailureAttempts", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "healthCheckConfig", ".", "getSchedule", "(", ")", ".", "getSuccessAttempts", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "shouldBuildAScheduleFromYaml", "(", ")", "throws", "Exception", "{", "final", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "final", "Schedule", "schedule", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "assertThat", "(", "schedule", ".", "getCheckInterval", "(", ")", ".", "toMilliseconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "schedule", ".", "getDowntimeInterval", "(", ")", ".", "toSeconds", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "schedule", ".", "getFailureAttempts", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT:2>", ")", ";", "assertThat", "(", "schedule", ".", "getSuccessAttempts", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "void", "setup", "(", ")", "throws", "Exception", "{", "httpServer", "=", "HttpServer", ".", "create", "(", "new", "InetSocketAddress", "(", "0", ")", ",", "0", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "void", "tearDown", "(", ")", "throws", "Exception", "{", "httpServer", ".", "stop", "(", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "httpHealthCheckShouldConsiderA200ResponseHealthy", "(", ")", "{", "httpServer", ".", "createContext", "(", "SUCCESS_PATH", ",", "httpExchange", "-", ">", "{", "try", "{", "httpExchange", ".", "sendResponseHeaders", "(", "<NUM_LIT>", ",", "0", ")", ";", "}", "finally", "{", "httpExchange", ".", "close", "(", ")", ";", "}", "}", ")", ";", "httpServer", ".", "start", "(", ")", ";", "final", "HttpHealthCheck", "httpHealthCheck", "=", "new", "HttpHealthCheck", "(", "BASE_URI", "+", "httpServer", ".", "getAddress", "(", ")", ".", "getPort", "(", ")", "+", "SUCCESS_PATH", ")", ";", "assertThat", "(", "httpHealthCheck", ".", "check", "(", ")", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "httpHealthCheckShouldConsiderA500ResponseUnhealthy", "(", ")", "{", "httpServer", ".", "createContext", "(", "FAIL_PATH", ",", "httpExchange", "-", ">", "{", "try", "{", "httpExchange", ".", "sendResponseHeaders", "(", "<NUM_LIT>", ",", "0", ")", ";", "}", "finally", "{", "httpExchange", ".", "close", "(", ")", ";", "}", "}", ")", ";", "httpServer", ".", "start", "(", ")", ";", "final", "HttpHealthCheck", "httpHealthCheck", "=", "new", "HttpHealthCheck", "(", "BASE_URI", "+", "httpServer", ".", "getAddress", "(", ")", ".", "getPort", "(", ")", "+", "FAIL_PATH", ")", ";", "assertThat", "(", "httpHealthCheck", ".", "check", "(", ")", ".", "isHealthy", "(", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "httpHealthCheckShouldConsiderATimeoutUnhealthy", "(", ")", "{", "httpServer", ".", "createContext", "(", "TIMEOUT_PATH", ",", "httpExchange", "-", ">", "{", "try", "{", "Thread", ".", "sleep", "(", "HttpHealthCheck", ".", "DEFAULT_TIMEOUT", ".", "toMillis", "(", ")", "*", "<NUM_LIT:2>", ")", ";", "httpExchange", ".", "sendResponseHeaders", "(", "<NUM_LIT>", ",", "0", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "httpExchange", ".", "sendResponseHeaders", "(", "<NUM_LIT>", ",", "0", ")", ";", "}", "finally", "{", "httpExchange", ".", "close", "(", ")", ";", "}", "}", ")", ";", "httpServer", ".", "start", "(", ")", ";", "final", "HttpHealthCheck", "httpHealthCheck", "=", "new", "HttpHealthCheck", "(", "BASE_URI", "+", "httpServer", ".", "getAddress", "(", ")", ".", "getPort", "(", ")", "+", "TIMEOUT_PATH", ")", ";", "assertThrows", "(", "ProcessingException", ".", "class", ",", "httpHealthCheck", ":", ":", "check", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "servletTester", "=", "new", "ServletTester", "(", ")", ";", "request", ".", "setHeader", "(", "HttpHeader", ".", "HOST", ".", "asString", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "request", ".", "setURI", "(", "HEALTH_CHECK_URI", ")", ";", "request", ".", "setMethod", "(", "\"", "<STR_LIT:GET>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "public", "void", "tearDown", "(", ")", "throws", "Exception", "{", "servletTester", ".", "stop", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "isDiscoverable", "(", ")", "{", "DiscoverableSubtypeResolver", "resolver", "=", "new", "DiscoverableSubtypeResolver", "(", ")", ";", "List", "<", "Class", "<", "?", ">", ">", "subtypes", "=", "resolver", ".", "getDiscoveredSubtypes", "(", ")", ";", "assertThat", "(", "subtypes", ")", ".", "contains", "(", "DefaultHealthServletFactory", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBuildHealthServlet", "(", ")", "throws", "Exception", "{", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ",", "false", ")", ";", "HealthServletFactory", "factory", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "HttpServlet", "servlet", "=", "factory", ".", "build", "(", "healthStatusChecker", ")", ";", "servletTester", ".", "addServlet", "(", "new", "ServletHolder", "(", "servlet", ")", ",", "HEALTH_CHECK_URI", ")", ";", "servletTester", ".", "start", "(", ")", ";", "HttpTester", ".", "Response", "healthyResponse", "=", "executeRequest", "(", "request", ")", ";", "HttpTester", ".", "Response", "unhealthyResponse", "=", "executeRequest", "(", "request", ")", ";", "assertThat", "(", "healthyResponse", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "Response", ".", "SC_OK", ")", ";", "assertThat", "(", "healthyResponse", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "parseResponseBody", "(", "healthyResponse", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "Response", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "parseResponseBody", "(", "unhealthyResponse", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBuildHealthServletWithCacheControlDisabled", "(", ")", "throws", "Exception", "{", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ",", "false", ")", ";", "HealthServletFactory", "factory", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "HttpServlet", "servlet", "=", "factory", ".", "build", "(", "healthStatusChecker", ")", ";", "servletTester", ".", "addServlet", "(", "new", "ServletHolder", "(", "servlet", ")", ",", "HEALTH_CHECK_URI", ")", ";", "servletTester", ".", "start", "(", ")", ";", "HttpTester", ".", "Response", "healthyResponse", "=", "executeRequest", "(", "request", ")", ";", "HttpTester", ".", "Response", "unhealthyResponse", "=", "executeRequest", "(", "request", ")", ";", "assertThat", "(", "healthyResponse", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "Response", ".", "SC_OK", ")", ";", "assertThat", "(", "healthyResponse", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "parseResponseBody", "(", "healthyResponse", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "healthyResponse", ".", "get", "(", "HttpHeader", ".", "CACHE_CONTROL", ")", ")", ".", "isNull", "(", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "Response", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "parseResponseBody", "(", "unhealthyResponse", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "get", "(", "HttpHeader", ".", "CACHE_CONTROL", ")", ")", ".", "isNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBuildHealthServletWithCustomResponses", "(", ")", "throws", "Exception", "{", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ",", "false", ")", ";", "HealthServletFactory", "factory", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "HttpServlet", "servlet", "=", "factory", ".", "build", "(", "healthStatusChecker", ")", ";", "servletTester", ".", "addServlet", "(", "new", "ServletHolder", "(", "servlet", ")", ",", "HEALTH_CHECK_URI", ")", ";", "servletTester", ".", "start", "(", ")", ";", "HttpTester", ".", "Response", "healthyResponse", "=", "executeRequest", "(", "request", ")", ";", "HttpTester", ".", "Response", "unhealthyResponse", "=", "executeRequest", "(", "request", ")", ";", "assertThat", "(", "healthyResponse", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "Response", ".", "SC_OK", ")", ";", "assertThat", "(", "healthyResponse", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ".", "isEqualTo", "(", "PLAIN_TEXT_UTF_8", ")", ";", "assertThat", "(", "healthyResponse", ".", "getContent", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "Response", ".", "SC_SERVICE_UNAVAILABLE", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "get", "(", "HttpHeader", ".", "CONTENT_TYPE", ")", ")", ".", "isEqualTo", "(", "PLAIN_TEXT_UTF_8", ")", ";", "assertThat", "(", "unhealthyResponse", ".", "getContent", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "HttpTester", ".", "Response", "executeRequest", "(", "HttpTester", ".", "Request", "request", ")", "throws", "Exception", "{", "return", "HttpTester", ".", "parseResponse", "(", "servletTester", ".", "getResponses", "(", "request", ".", "generate", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "String", "parseResponseBody", "(", "HttpTester", ".", "Response", "response", ")", "throws", "IOException", "{", "JsonNode", "jsonBody", "=", "mapper", ".", "readValue", "(", "response", ".", "getContentBytes", "(", ")", ",", "JsonNode", ".", "class", ")", ";", "return", "jsonBody", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asText", "(", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "throws", "IOException", "{", "serverSocket", "=", "new", "ServerSocket", "(", "0", ")", ";", "tcpHealthCheck", "=", "new", "TcpHealthCheck", "(", "\"", "<STR_LIT:127.0.0.1>", "\"", ",", "serverSocket", ".", "getLocalPort", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "public", "void", "tearDown", "(", ")", "throws", "IOException", "{", "serverSocket", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "tcpHealthCheckShouldReturnHealthyIfCanConnect", "(", ")", "throws", "IOException", "{", "final", "ExecutorService", "executorService", "=", "Executors", ".", "newSingleThreadExecutor", "(", ")", ";", "executorService", ".", "submit", "(", "(", ")", "-", ">", "serverSocket", ".", "accept", "(", ")", ")", ";", "assertThat", "(", "tcpHealthCheck", ".", "check", "(", ")", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "tcpHealthCheckShouldReturnUnhealthyIfCannotConnect", "(", ")", "throws", "IOException", "{", "serverSocket", ".", "close", "(", ")", ";", "assertThrows", "(", "ConnectException", ".", "class", ",", "(", ")", "-", ">", "tcpHealthCheck", ".", "check", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "tcpHealthCheckShouldReturnUnhealthyIfCannotConnectWithinConfiguredTimeout", "(", ")", "throws", "IOException", "{", "final", "int", "port", "=", "serverSocket", ".", "getLocalPort", "(", ")", ";", "serverSocket", ".", "setReuseAddress", "(", "true", ")", ";", "serverSocket", ".", "close", "(", ")", ";", "serverSocket", "=", "new", "ServerSocket", "(", ")", ";", "final", "ExecutorService", "executorService", "=", "Executors", ".", "newSingleThreadExecutor", "(", ")", ";", "executorService", ".", "submit", "(", "(", ")", "-", ">", "{", "Uninterruptibles", ".", "sleepUninterruptibly", "(", "tcpHealthCheck", ".", "getConnectionTimeout", "(", ")", ".", "toMillis", "(", ")", "*", "<NUM_LIT:3>", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "serverSocket", ".", "bind", "(", "new", "InetSocketAddress", "(", "\"", "<STR_LIT:127.0.0.1>", "\"", ",", "port", ")", ")", ";", "return", "true", ";", "}", ")", ";", "assertThrows", "(", "ConnectException", ".", "class", ",", "(", ")", "-", ">", "tcpHealthCheck", ".", "check", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "Handler", "createAdminServlet", "(", "Server", "server", ",", "MutableServletContextHandler", "handler", ",", "MetricRegistry", "metrics", ",", "HealthCheckRegistry", "healthChecks", ",", "AdminEnvironment", "admin", ")", "{", "configureSessionsAndSecurity", "(", "handler", ",", "server", ")", ";", "handler", ".", "setServer", "(", "server", ")", ";", "handler", ".", "getServletContext", "(", ")", ".", "setAttribute", "(", "MetricsServlet", ".", "METRICS_REGISTRY", ",", "metrics", ")", ";", "handler", ".", "getServletContext", "(", ")", ".", "setAttribute", "(", "HealthCheckServlet", ".", "HEALTH_CHECK_REGISTRY", ",", "healthChecks", ")", ";", "handler", ".", "getServletContext", "(", ")", ".", "setAttribute", "(", "AdminServlet", ".", "HEALTHCHECK_ENABLED_PARAM_KEY", ",", "admin", ".", "isHealthCheckServletEnabled", "(", ")", ")", ";", "handler", ".", "addServlet", "(", "AdminServlet", ".", "class", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "String", "allowedMethodsParam", "=", "String", ".", "join", "(", "\"", "<STR_LIT:U+002C>", "\"", ",", "allowedMethods", ")", ";", "handler", ".", "addFilter", "(", "AllowedMethodsFilter", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "EnumSet", ".", "of", "(", "DispatcherType", ".", "REQUEST", ")", ")", ".", "setInitParameter", "(", "AllowedMethodsFilter", ".", "ALLOWED_METHODS_PARAM", ",", "allowedMethodsParam", ")", ";", "return", "handler", ";", "}", "</s>"]
["<s>", "public", "boolean", "isHealthCheckServletEnabled", "(", ")", "{", "return", "healthCheckServletEnabled", ";", "}", "</s>"]
["<s>", "public", "HealthEnvironment", "health", "(", ")", "{", "return", "healthEnvironment", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "isServletEnabled", "(", ")", "{", "return", "servletEnabled", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "(", "\"", "<STR_LIT>", "\"", ")", "public", "void", "setServletEnabled", "(", "boolean", "servletEnabled", ")", "{", "this", ".", "servletEnabled", "=", "servletEnabled", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onHealthyCheck", "(", "String", "healthCheckName", ")", "{", "healthyCheckCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onUnhealthyCheck", "(", "String", "healthCheckName", ")", "{", "unhealthyCheckCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onStateChanged", "(", "String", "healthCheckName", ",", "boolean", "healthy", ")", "{", "stateChangeCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "AtomicInteger", "getHealthyCheckCounter", "(", ")", "{", "return", "healthyCheckCounter", ";", "}", "</s>"]
["<s>", "AtomicInteger", "getUnhealthyCheckCounter", "(", ")", "{", "return", "unhealthyCheckCounter", ";", "}", "</s>"]
["<s>", "AtomicInteger", "getStateChangeCounter", "(", ")", "{", "return", "stateChangeCounter", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "healthCheckShouldReportHealthyWhenInitialStateFalseCriticalCheckGoesHealthy", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "assertThat", "(", "isAppHealthy", "(", ")", ")", ".", "isFalse", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "assertThat", "(", "app", ".", "getStateChangeCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getHealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getUnhealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "healthCheckShouldReportHealthyWhenAllHealthChecksHealthy", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getNonCriticalCheckHealthy", "(", ")", ".", "set", "(", "true", ")", ";", "Awaitility", ".", "await", "(", ")", ".", "pollInSameThread", "(", ")", ".", "atMost", "(", "testTimeout", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "assertThat", "(", "app", ".", "getStateChangeCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getHealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getUnhealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "nonCriticalHealthCheckFailureShouldNotResultInUnhealthyApp", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getNonCriticalCheckHealthy", "(", ")", ".", "set", "(", "false", ")", ";", "Awaitility", ".", "await", "(", ")", ".", "pollInSameThread", "(", ")", ".", "atMost", "(", "testTimeout", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "assertThat", "(", "app", ".", "getStateChangeCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getHealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getUnhealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "criticalHealthCheckFailureShouldResultInUnhealthyApp", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "false", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "(", ")", "-", ">", "!", "isAppHealthy", "(", ")", ")", ";", "assertThat", "(", "app", ".", "getStateChangeCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getHealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isEqualTo", "(", "0", ")", ";", "assertThat", "(", "app", ".", "getUnhealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "appShouldRecoverOnceCriticalCheckReturnsToHealthyStatus", "(", ")", "{", "final", "HealthApp", "app", "=", "TEST_APP_RULE", ".", "getApplication", "(", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "false", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "(", ")", "-", ">", "!", "isAppHealthy", "(", ")", ")", ";", "app", ".", "getCriticalCheckHealthy1", "(", ")", ".", "set", "(", "true", ")", ";", "app", ".", "getCriticalCheckHealthy2", "(", ")", ".", "set", "(", "true", ")", ";", "Awaitility", ".", "waitAtMost", "(", "testTimeout", ")", ".", "pollInSameThread", "(", ")", ".", "pollDelay", "(", "POLL_DELAY", ")", ".", "until", "(", "this", ":", ":", "isAppHealthy", ")", ";", "assertThat", "(", "app", ".", "getStateChangeCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getHealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "assertThat", "(", "app", ".", "getUnhealthyCheckCounter", "(", ")", ".", "get", "(", ")", ")", ".", "isGreaterThanOrEqualTo", "(", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "healthCheckShouldSucceed", "(", ")", "{", "final", "Response", "healthCheckResponse", "=", "APP", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "healthCheckResponse", ")", ".", "extracting", "(", "Response", ":", ":", "getStatus", ")", ".", "isEqualTo", "(", "Response", ".", "Status", ".", "OK", ".", "getStatusCode", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "HealthResponseProviderFactory", "getHealthResponseProviderFactory", "(", ")", "{", "return", "healthResponseProviderFactory", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthResponseProviderFactory", "(", "HealthResponseProviderFactory", "healthResponseProviderFactory", ")", "{", "this", ".", "healthResponseProviderFactory", "=", "healthResponseProviderFactory", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthResponderFactory", "(", "HealthResponderFactory", "healthResponderFactory", ")", "{", "this", ".", "healthResponderFactory", "=", "healthResponderFactory", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "configure", "(", "final", "LifecycleEnvironment", "lifecycle", ",", "final", "ServletEnvironment", "servlets", ",", "final", "JerseyEnvironment", "jersey", ",", "final", "HealthEnvironment", "health", ",", "final", "ObjectMapper", "mapper", ",", "final", "String", "name", ")", "{", "if", "(", "!", "isEnabled", "(", ")", ")", "{", "LOGGER", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "final", "MetricRegistry", "metrics", "=", "lifecycle", ".", "getMetricRegistry", "(", ")", ";", "final", "HealthCheckRegistry", "healthChecks", "=", "health", ".", "healthChecks", "(", ")", ";", "final", "String", "fullName", "=", "DEFAULT_BASE_NAME", "+", "\"", "<STR_LIT:->", "\"", "+", "name", ";", "final", "List", "<", "HealthCheckConfiguration", ">", "healthCheckConfigs", "=", "getHealthCheckConfigurations", "(", ")", ";", "final", "ScheduledExecutorService", "scheduledHealthCheckExecutor", "=", "createScheduledExecutorForHealthChecks", "(", "healthCheckConfigs", ".", "size", "(", ")", ",", "metrics", ",", "lifecycle", ",", "fullName", ")", ";", "final", "HealthCheckScheduler", "scheduler", "=", "new", "HealthCheckScheduler", "(", "scheduledHealthCheckExecutor", ")", ";", "final", "HealthCheckManager", "healthCheckManager", "=", "new", "HealthCheckManager", "(", "healthCheckConfigs", ",", "scheduler", ",", "metrics", ",", "shutdownWaitPeriod", ",", "initialOverallState", ",", "health", ".", "healthStateListeners", "(", ")", ")", ";", "healthCheckManager", ".", "initializeAppHealth", "(", ")", ";", "final", "HealthResponseProvider", "responseProvider", "=", "healthResponseProviderFactory", ".", "build", "(", "healthCheckManager", ",", "healthCheckManager", ",", "mapper", ")", ";", "healthResponderFactory", ".", "configure", "(", "fullName", ",", "healthCheckUrlPaths", ",", "responseProvider", ",", "health", ",", "jersey", ",", "servlets", ",", "mapper", ")", ";", "healthChecks", ".", "addListener", "(", "healthCheckManager", ")", ";", "lifecycle", ".", "manage", "(", "new", "HealthCheckConfigValidator", "(", "healthCheckConfigs", ",", "healthChecks", ")", ")", ";", "final", "Duration", "shutdownWaitPeriod", "=", "getShutdownWaitPeriod", "(", ")", ";", "if", "(", "isDelayedShutdownHandlerEnabled", "(", ")", "&", "&", "shutdownWaitPeriod", ".", "toMilliseconds", "(", ")", ">", "0", ")", "{", "final", "DelayedShutdownHandler", "shutdownHandler", "=", "new", "DelayedShutdownHandler", "(", "healthCheckManager", ")", ";", "shutdownHandler", ".", "register", "(", ")", ";", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "shutdownWaitPeriod", ")", ";", "}", "health", ".", "setHealthStateAggregator", "(", "healthCheckManager", ")", ";", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "getHealthChecks", "(", ")", ")", ";", "}", "</s>"]
["<s>", "void", "setChecks", "(", "final", "Map", "<", "String", ",", "ScheduledHealthCheck", ">", "checks", ")", "{", "this", ".", "checks", "=", "checks", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onHealthyCheck", "(", "final", "String", "healthCheckName", ")", "{", "healthStateListeners", ".", "forEach", "(", "listener", "-", ">", "{", "try", "{", "listener", ".", "onHealthyCheck", "(", "healthCheckName", ")", ";", "}", "catch", "(", "final", "RuntimeException", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "healthCheckName", ",", "listener", ",", "e", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onUnhealthyCheck", "(", "final", "String", "healthCheckName", ")", "{", "healthStateListeners", ".", "forEach", "(", "listener", "-", ">", "{", "try", "{", "listener", ".", "onUnhealthyCheck", "(", "healthCheckName", ")", ";", "}", "catch", "(", "final", "RuntimeException", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "healthCheckName", ",", "listener", ",", "e", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "@", "Override", "public", "Collection", "<", "HealthStateView", ">", "healthStateViews", "(", ")", "{", "return", "checks", ".", "values", "(", ")", ".", "stream", "(", ")", ".", "map", "(", "ScheduledHealthCheck", ":", ":", "view", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "@", "Override", "public", "Optional", "<", "HealthStateView", ">", "healthStateView", "(", "@", "Nonnull", "final", "String", "name", ")", "{", "return", "Optional", ".", "ofNullable", "(", "checks", ".", "get", "(", "name", ")", ")", ".", "map", "(", "ScheduledHealthCheck", ":", ":", "view", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addHealthStateListener", "(", "final", "HealthStateListener", "listener", ")", "{", "healthStateListeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "public", "HealthCheckRegistry", "healthChecks", "(", ")", "{", "return", "healthCheckRegistry", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "public", "Collection", "<", "HealthStateListener", ">", "healthStateListeners", "(", ")", "{", "return", "healthStateListeners", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "public", "HealthStateAggregator", "healthStateAggregator", "(", ")", "{", "if", "(", "healthStateAggregator", "=", "=", "null", ")", "{", "final", "String", "message", "=", "\"", "<STR_LIT>", "\"", ";", "LOGGER", ".", "error", "(", "message", ")", ";", "throw", "new", "IllegalStateException", "(", "message", ")", ";", "}", "return", "healthStateAggregator", ";", "}", "</s>"]
["<s>", "void", "setHealthStateAggregator", "(", "@", "Nonnull", "final", "HealthStateAggregator", "healthStateAggregator", ")", "{", "this", ".", "healthStateAggregator", "=", "Objects", ".", "requireNonNull", "(", "healthStateAggregator", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isHealthy", "(", ")", "{", "return", "healthy", ";", "}", "</s>"]
["<s>", "public", "void", "setHealthy", "(", "boolean", "healthy", ")", "{", "this", ".", "healthy", "=", "healthy", ";", "}", "</s>"]
["<s>", "public", "void", "setCritical", "(", "boolean", "critical", ")", "{", "this", ".", "critical", "=", "critical", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "!", "(", "o", "instanceof", "HealthStateView", ")", ")", "return", "false", ";", "HealthStateView", "that", "=", "(", "HealthStateView", ")", "o", ";", "return", "healthy", "=", "=", "that", ".", "healthy", "&", "&", "critical", "=", "=", "that", ".", "critical", "&", "&", "Objects", ".", "equals", "(", "name", ",", "that", ".", "name", ")", "&", "&", "type", "=", "=", "that", ".", "type", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "name", ",", "healthy", ",", "type", ",", "critical", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "<STR_LIT>", "+", "\"", "<STR_LIT>", "\"", "+", "healthy", "+", "\"", "<STR_LIT>", "\"", "+", "type", "+", "\"", "<STR_LIT>", "\"", "+", "critical", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "compareTo", "(", "final", "HealthStateView", "other", ")", "{", "return", "name", ".", "compareTo", "(", "other", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "<STR_LIT>", "+", "\"", "<STR_LIT>", "\"", "+", "successAttempts", "+", "\"", "<STR_LIT>", "\"", "+", "failureAttempts", "+", "\"", "<STR_LIT>", "\"", "+", "healthStateListener", "+", "\"", "<STR_LIT>", "\"", "+", "counter", "+", "\"", "<STR_LIT>", "\"", "+", "healthy", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "public", "String", "getMessage", "(", ")", "{", "return", "message", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "o", ")", "{", "if", "(", "this", "=", "=", "o", ")", "return", "true", ";", "if", "(", "!", "(", "o", "instanceof", "HealthResponse", ")", ")", "return", "false", ";", "HealthResponse", "that", "=", "(", "HealthResponse", ")", "o", ";", "return", "healthy", "=", "=", "that", ".", "healthy", "&", "&", "status", "=", "=", "that", ".", "status", "&", "&", "message", ".", "equals", "(", "that", ".", "message", ")", "&", "&", "contentType", ".", "equals", "(", "that", ".", "contentType", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "Objects", ".", "hash", "(", "healthy", ",", "message", ",", "contentType", ",", "status", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:=>", "\"", "+", "healthy", "+", "\"", "<STR_LIT>", "\"", "+", "message", "+", "<STR_LIT>", "+", "\"", "<STR_LIT>", "\"", "+", "contentType", "+", "<STR_LIT>", "+", "\"", "<STR_LIT>", "\"", "+", "status", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "@", "Nonnull", "@", "Override", "public", "HealthResponse", "healthResponse", "(", "final", "Map", "<", "String", ",", "Collection", "<", "String", ">", ">", "queryParams", ")", "{", "final", "String", "type", "=", "queryParams", ".", "getOrDefault", "(", "CHECK_TYPE_QUERY_PARAM", ",", "Collections", ".", "emptyList", "(", ")", ")", ".", "stream", "(", ")", ".", "findFirst", "(", ")", ".", "orElse", "(", "null", ")", ";", "final", "Collection", "<", "HealthStateView", ">", "views", "=", "getViews", "(", "queryParams", ")", ";", "final", "String", "responseBody", ";", "try", "{", "responseBody", "=", "mapper", ".", "writeValueAsString", "(", "views", ")", ";", "}", "catch", "(", "final", "Exception", "e", ")", "{", "LOGGER", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "views", ",", "e", ")", ";", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "final", "boolean", "healthy", "=", "healthStatusChecker", ".", "isHealthy", "(", "type", ")", ";", "final", "int", "status", ";", "if", "(", "healthy", ")", "{", "status", "=", "<NUM_LIT>", ";", "}", "else", "{", "status", "=", "<NUM_LIT>", ";", "}", "return", "new", "HealthResponse", "(", "healthy", ",", "responseBody", ",", "MEDIA_TYPE", ",", "status", ")", ";", "}", "</s>"]
["<s>", "private", "Set", "<", "String", ">", "getNamesFromQueryParams", "(", "final", "Map", "<", "String", ",", "Collection", "<", "String", ">", ">", "queryParams", ")", "{", "return", "queryParams", ".", "getOrDefault", "(", "NAME_QUERY_PARAM", ",", "Collections", ".", "emptyList", "(", ")", ")", ".", "stream", "(", ")", ".", "map", "(", "String", ":", ":", "toLowerCase", ")", ".", "collect", "(", "Collectors", ".", "toCollection", "(", "LinkedHashSet", ":", ":", "new", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Collection", "<", "HealthStateView", ">", "getViews", "(", "final", "Map", "<", "String", ",", "Collection", "<", "String", ">", ">", "queryParams", ")", "{", "final", "Set", "<", "String", ">", "names", "=", "getNamesFromQueryParams", "(", "queryParams", ")", ";", "final", "Collection", "<", "HealthStateView", ">", "views", ";", "if", "(", "shouldReturnAllViews", "(", "names", ")", ")", "{", "views", "=", "healthStateAggregator", ".", "healthStateViews", "(", ")", ";", "}", "else", "{", "views", "=", "names", ".", "stream", "(", ")", ".", "map", "(", "healthStateAggregator", ":", ":", "healthStateView", ")", ".", "filter", "(", "Optional", ":", ":", "isPresent", ")", ".", "map", "(", "Optional", ":", ":", "get", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ";", "}", "return", "ImmutableList", ".", "copyOf", "(", "views", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "shouldReturnAllViews", "(", "final", "Set", "<", "String", ">", "names", ")", "{", "return", "names", ".", "contains", "(", "ALL_VALUE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "HealthResponseProvider", "build", "(", "final", "HealthStatusChecker", "healthStatusChecker", ",", "final", "HealthStateAggregator", "healthStateAggregator", ",", "final", "ObjectMapper", "mapper", ")", "{", "return", "new", "JsonHealthResponseProvider", "(", "healthStatusChecker", ",", "healthStateAggregator", ",", "mapper", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onHealthyCheck", "(", "String", "healthCheckName", ")", "{", "healthyCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onUnhealthyCheck", "(", "String", "healthCheckName", ")", "{", "unhealthyCounter", ".", "incrementAndGet", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "verifyCheckWasScheduled", "(", "HealthCheckScheduler", "scheduler", ",", "boolean", "critical", ")", "{", "ArgumentCaptor", "<", "ScheduledHealthCheck", ">", "checkCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "ScheduledHealthCheck", ".", "class", ")", ";", "verify", "(", "scheduler", ")", ".", "scheduleInitial", "(", "checkCaptor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "checkCaptor", ".", "getValue", "(", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "HealthCheckManagerTest", ".", "NAME", ")", ";", "assertThat", "(", "checkCaptor", ".", "getValue", "(", ")", ".", "isCritical", "(", ")", ")", ".", "isEqualTo", "(", "critical", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "void", "setUp", "(", ")", "{", "healthEnvironment", "=", "new", "HealthEnvironment", "(", "healthChecks", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "gettingHealthStateAggregatorBeforeSetShouldResultInException", "(", ")", "{", "assertThrows", "(", "IllegalStateException", ".", "class", ",", "(", ")", "-", ">", "healthEnvironment", ".", "healthStateAggregator", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "shouldRegisterAListener", "(", ")", "{", "healthEnvironment", ".", "addHealthStateListener", "(", "healthStateListener", ")", ";", "assertThat", "(", "healthEnvironment", ".", "healthStateListeners", "(", ")", ")", ".", "contains", "(", "healthStateListener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onStateChanged", "(", "String", "healthCheckName", ",", "boolean", "healthy", ")", "{", "didStateChange", ".", "set", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "isDiscoverable", "(", ")", "{", "final", "DiscoverableSubtypeResolver", "resolver", "=", "new", "DiscoverableSubtypeResolver", "(", ")", ";", "final", "List", "<", "Class", "<", "?", ">", ">", "subtypes", "=", "resolver", ".", "getDiscoveredSubtypes", "(", ")", ";", "assertThat", "(", "subtypes", ")", ".", "contains", "(", "JsonHealthResponseProviderFactory", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testBuildJsonHealthResponseProvider", "(", ")", "throws", "Exception", "{", "final", "File", "yml", "=", "new", "File", "(", "Resources", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ".", "toURI", "(", ")", ")", ";", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "final", "HealthResponseProviderFactory", "factory", "=", "configFactory", ".", "build", "(", "yml", ")", ";", "final", "HealthResponseProvider", "responseProvider", "=", "factory", ".", "build", "(", "healthStatusChecker", ",", "healthStateAggregator", ",", "mapper", ")", ";", "final", "HealthResponse", "response", "=", "responseProvider", ".", "healthResponse", "(", "Collections", ".", "emptyMap", "(", ")", ")", ";", "assertThat", "(", "response", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "response", ".", "getMessage", "(", ")", ")", ".", "isEqualToIgnoringWhitespace", "(", "\"", "<STR_LIT:[]>", "\"", ")", ";", "assertThat", "(", "response", ".", "getContentType", "(", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "verifyNoInteractions", "(", "healthStateAggregator", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "void", "setUp", "(", ")", "{", "this", ".", "jsonHealthResponseProvider", "=", "new", "JsonHealthResponseProvider", "(", "healthStatusChecker", ",", "healthStateAggregator", ",", "mapper", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "shouldHandleSingleHealthStateViewCorrectly", "(", ")", "{", "final", "HealthStateView", "view", "=", "new", "HealthStateView", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "HealthCheckType", ".", "READY", ",", "true", ")", ";", "final", "Map", "<", "String", ",", "Collection", "<", "String", ">", ">", "queryParams", "=", "Collections", ".", "singletonMap", "(", "JsonHealthResponseProvider", ".", "NAME_QUERY_PARAM", ",", "Collections", ".", "singleton", "(", "view", ".", "getName", "(", ")", ")", ")", ";", "when", "(", "healthStateAggregator", ".", "healthStateView", "(", "eq", "(", "view", ".", "getName", "(", ")", ")", ")", ")", ".", "thenReturn", "(", "Optional", ".", "of", "(", "view", ")", ")", ";", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "final", "HealthResponse", "response", "=", "jsonHealthResponseProvider", ".", "healthResponse", "(", "queryParams", ")", ";", "assertThat", "(", "response", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "response", ".", "getContentType", "(", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "response", ".", "getMessage", "(", ")", ")", ".", "isEqualToIgnoringWhitespace", "(", "fixture", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "shouldHandleMultipleHealthStateViewsCorrectly", "(", ")", "{", "final", "HealthStateView", "fooView", "=", "new", "HealthStateView", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "HealthCheckType", ".", "READY", ",", "true", ")", ";", "final", "HealthStateView", "barView", "=", "new", "HealthStateView", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "HealthCheckType", ".", "ALIVE", ",", "true", ")", ";", "final", "HealthStateView", "bazView", "=", "new", "HealthStateView", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "HealthCheckType", ".", "READY", ",", "false", ")", ";", "final", "Collection", "<", "String", ">", "names", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "names", ".", "add", "(", "fooView", ".", "getName", "(", ")", ")", ";", "names", ".", "add", "(", "barView", ".", "getName", "(", ")", ")", ";", "names", ".", "add", "(", "bazView", ".", "getName", "(", ")", ")", ";", "final", "Map", "<", "String", ",", "Collection", "<", "String", ">", ">", "queryParams", "=", "Collections", ".", "singletonMap", "(", "JsonHealthResponseProvider", ".", "NAME_QUERY_PARAM", ",", "names", ")", ";", "when", "(", "healthStateAggregator", ".", "healthStateView", "(", "fooView", ".", "getName", "(", ")", ")", ")", ".", "thenReturn", "(", "Optional", ".", "of", "(", "fooView", ")", ")", ";", "when", "(", "healthStateAggregator", ".", "healthStateView", "(", "barView", ".", "getName", "(", ")", ")", ")", ".", "thenReturn", "(", "Optional", ".", "of", "(", "barView", ")", ")", ";", "when", "(", "healthStateAggregator", ".", "healthStateView", "(", "bazView", ".", "getName", "(", ")", ")", ")", ".", "thenReturn", "(", "Optional", ".", "of", "(", "bazView", ")", ")", ";", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "final", "HealthResponse", "response", "=", "jsonHealthResponseProvider", ".", "healthResponse", "(", "queryParams", ")", ";", "assertThat", "(", "response", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "response", ".", "getContentType", "(", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "response", ".", "getMessage", "(", ")", ")", ".", "isEqualToIgnoringWhitespace", "(", "fixture", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "shouldHandleZeroHealthStateViewsCorrectly", "(", ")", "{", "when", "(", "healthStatusChecker", ".", "isHealthy", "(", "isNull", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "final", "HealthResponse", "response", "=", "jsonHealthResponseProvider", ".", "healthResponse", "(", "Collections", ".", "emptyMap", "(", ")", ")", ";", "assertThat", "(", "response", ".", "isHealthy", "(", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "response", ".", "getContentType", "(", ")", ")", ".", "isEqualTo", "(", "MediaType", ".", "APPLICATION_JSON", ")", ";", "assertThat", "(", "response", ".", "getMessage", "(", ")", ")", ".", "isEqualToIgnoringWhitespace", "(", "\"", "<STR_LIT:[]>", "\"", ")", ";", "verifyNoInteractions", "(", "healthStateAggregator", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "shouldThrowExceptionWhenJsonProcessorExceptionOccurs", "(", ")", "throws", "IOException", "{", "final", "ObjectMapper", "mapperMock", "=", "mock", "(", "ObjectMapper", ".", "class", ")", ";", "this", ".", "jsonHealthResponseProvider", "=", "new", "JsonHealthResponseProvider", "(", "healthStatusChecker", ",", "healthStateAggregator", ",", "mapperMock", ")", ";", "final", "HealthStateView", "view", "=", "new", "HealthStateView", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "HealthCheckType", ".", "READY", ",", "true", ")", ";", "final", "Map", "<", "String", ",", "Collection", "<", "String", ">", ">", "queryParams", "=", "Collections", ".", "singletonMap", "(", "JsonHealthResponseProvider", ".", "NAME_QUERY_PARAM", ",", "Collections", ".", "singleton", "(", "view", ".", "getName", "(", ")", ")", ")", ";", "final", "JsonMappingException", "exception", "=", "JsonMappingException", ".", "fromUnexpectedIOE", "(", "new", "IOException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "when", "(", "healthStateAggregator", ".", "healthStateView", "(", "view", ".", "getName", "(", ")", ")", ")", ".", "thenReturn", "(", "Optional", ".", "of", "(", "view", ")", ")", ";", "when", "(", "mapperMock", ".", "writeValueAsString", "(", "any", "(", ")", ")", ")", ".", "thenThrow", "(", "exception", ")", ";", "assertThatThrownBy", "(", "(", ")", "-", ">", "jsonHealthResponseProvider", ".", "healthResponse", "(", "queryParams", ")", ")", ".", "isInstanceOf", "(", "RuntimeException", ".", "class", ")", ".", "hasCauseReference", "(", "exception", ")", ";", "verifyNoInteractions", "(", "healthStatusChecker", ")", ";", "}", "</s>"]
["<s>", "private", "String", "fixture", "(", "final", "String", "filename", ")", "{", "final", "URL", "resource", "=", "Resources", ".", "getResource", "(", "filename", ")", ";", "try", "{", "return", "Resources", ".", "toString", "(", "resource", ",", "Charsets", ".", "UTF_8", ")", ".", "trim", "(", ")", ";", "}", "catch", "(", "final", "IOException", "e", ")", "{", "throw", "new", "IllegalArgumentException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Nullable", "public", "Map", "<", "String", ",", "Object", ">", "getScopedObjects", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "void", "setUpTest", "(", ")", "{", "databaseUrl", "=", "getDatabaseUrl", "(", ")", ";", "conf", "=", "createConfiguration", "(", "databaseUrl", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testCustomChange", "(", ")", "throws", "Exception", "{", "dbCommand", ".", "run", "(", "null", ",", "new", "Namespace", "(", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ",", "conf", ")", ";", "try", "(", "Handle", "handle", "=", "Jdbi", ".", "create", "(", "databaseUrl", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ")", ".", "open", "(", ")", ")", "{", "final", "ResultIterable", "<", "Map", "<", "String", ",", "Object", ">", ">", "rows", "=", "handle", ".", "select", "(", "\"", "<STR_LIT>", "\"", ")", ".", "mapToMap", "(", ")", ";", "assertThat", "(", "rows", ")", ".", "hasSize", "(", "1", ")", ";", "Map", "<", "String", ",", "Object", ">", "dbPerson", "=", "rows", ".", "first", "(", ")", ";", "String", "name", "=", "(", "String", ")", "dbPerson", ".", "getOrDefault", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ";", "assertThat", "(", "name", ")", ".", "isNotNull", "(", ")", ";", "assertThat", "(", "name", ")", ".", "isEqualTo", "(", "(", "(", "Person", ")", "scopedObjects", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "getName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "testFailingCustomChange", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "dbCommandWithoutScopedObjects", ".", "run", "(", "null", ",", "new", "Namespace", "(", "Collections", ".", "singletonMap", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ",", "conf", ")", ")", ".", "isInstanceOf", "(", "LiquibaseException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "execute", "(", "Database", "database", ")", "throws", "CustomChangeException", "{", "if", "(", "!", "Scope", ".", "getCurrentScope", "(", ")", ".", "has", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "throw", "new", "CustomChangeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "Person", "person", "=", "Scope", ".", "getCurrentScope", "(", ")", ".", "get", "(", "\"", "<STR_LIT>", "\"", ",", "Person", ".", "class", ")", ";", "JdbcConnection", "connection", "=", "(", "JdbcConnection", ")", "database", ".", "getConnection", "(", ")", ";", "try", "{", "PreparedStatement", "statement", "=", "connection", ".", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", ")", ";", "statement", ".", "setString", "(", "1", ",", "person", ".", "getName", "(", ")", ")", ";", "statement", ".", "execute", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "CustomChangeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getConfirmationMessage", "(", ")", "{", "return", "\"", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "Nullable", "public", "ValidationErrors", "validate", "(", "Database", "database", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "nonASCIIDisallowed", "(", ")", "{", "assertThatExceptionOfType", "(", "NumberFormatException", ".", "class", ")", ".", "isThrownBy", "(", "(", ")", "-", ">", "ByteRange", ".", "parse", "(", "\"", "<STR_LIT>", "\"", ",", "RESOURCE_LENGTH", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "tableExists", "(", "final", "Handle", "handle", ",", "final", "String", "tableName", ")", "throws", "SQLException", "{", "return", "handle", ".", "getConnection", "(", ")", ".", "getMetaData", "(", ")", ".", "getTables", "(", "null", ",", "null", ",", "tableName", ",", "null", ")", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "columnExists", "(", "final", "Handle", "handle", ",", "final", "String", "tableName", ",", "final", "String", "columnName", ")", "throws", "SQLException", "{", "return", "handle", ".", "getConnection", "(", ")", ".", "getMetaData", "(", ")", ".", "getColumns", "(", "null", ",", "null", ",", "tableName", ",", "columnName", ")", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testHttp2WithCustomCipher", "(", ")", "throws", "Exception", "{", "assertResponse", "(", "http2Client", ".", "GET", "(", "\"", "<STR_LIT>", "\"", "+", "appRule", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ",", "HttpVersion", ".", "HTTP_2", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testLoadAppenderWithTimeZoneInFullFormat", "(", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "loadResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ".", "getID", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testLoadAppenderWithTimeZoneInCustomFormat", "(", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "loadResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ".", "getID", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testLoadAppenderWithNoTimeZone", "(", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "loadResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ".", "getID", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testLoadAppenderWithUtcTimeZone", "(", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "loadResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ".", "getID", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testLoadAppenderWithWrongTimeZone", "(", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "loadResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ".", "getID", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:GMT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testLoadAppenderWithSystemTimeZone", "(", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "loadResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ")", ".", "isEqualTo", "(", "TimeZone", ".", "getDefault", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testBuildAppenderWithTimeZonePlaceholderInLogFormat", "(", ")", "throws", "Exception", "{", "ConsoleAppender", "<", "?", ">", "consoleAppender", "=", "buildAppender", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LayoutWrappingEncoder", "<", "?", ">", "encoder", "=", "(", "LayoutWrappingEncoder", "<", "?", ">", ")", "consoleAppender", ".", "getEncoder", "(", ")", ";", "PatternLayoutBase", "<", "?", ">", "layout", "=", "(", "PatternLayoutBase", "<", "?", ">", ")", "encoder", ".", "getLayout", "(", ")", ";", "assertThat", "(", "layout", ".", "getPattern", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "clientHasNotBeenClosed", "(", ")", "{", "final", "String", "response", "=", "EXTENSION", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "EXTENSION", ".", "getAdminPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "post", "(", "Entity", ".", "entity", "(", "\"", "<STR_LIT>", "\"", ",", "MediaType", ".", "TEXT_PLAIN", ")", ",", "String", ".", "class", ")", ";", "assertThat", "(", "response", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "HealthCheck", ".", "Result", "unhealthy", "(", ")", "{", "return", "HealthCheck", ".", "Result", ".", "unhealthy", "(", "\"", "<STR_LIT>", "\"", ",", "duration", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testUser", "(", ")", "{", "Set", "<", "String", ">", "roles", "=", "new", "HashSet", "<", ">", "(", ")", ";", "roles", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "roles", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "User", "user", "=", "new", "User", "(", "\"", "<STR_LIT:Name>", "\"", ",", "roles", ")", ";", "assertThat", "(", "user", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT:Name>", "\"", ")", ";", "assertThat", "(", "user", ".", "getRoles", "(", ")", ")", ".", "hasSize", "(", "<NUM_LIT:2>", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "user", ".", "getId", "(", ")", ")", ".", "isNotNegative", "(", ")", ".", "isLessThan", "(", "<NUM_LIT:100>", ")", ";", "User", "secondUser", "=", "new", "User", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "secondUser", ".", "getRoles", "(", ")", ")", ".", "isNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testMethods", "(", ")", "throws", "Exception", "{", "delayedShutdownHandler", ".", "register", "(", ")", ";", "assertThat", "(", "ShutdownThread", ".", "isRegistered", "(", "delayedShutdownHandler", ")", ")", ".", "isTrue", "(", ")", ";", "delayedShutdownHandler", ".", "doStop", "(", ")", ";", "verify", "(", "shutdownNotifier", ")", ".", "notifyShutdownStarted", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testHealthStatusChecker", "(", ")", "{", "HealthStatusChecker", "healthStatusChecker", "=", "mock", "(", "HealthStatusChecker", ".", "class", ")", ";", "assertThat", "(", "healthStatusChecker", ".", "isHealthy", "(", ")", ")", ".", "isEqualTo", "(", "healthStatusChecker", ".", "isHealthy", "(", "null", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PooledDataSourceFactory", "getDataSourceFactory", "(", "TestMigrationConfiguration", "configuration", ")", "{", "return", "configuration", ".", "getDataSource", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getScopedObjects", "(", ")", "{", "return", "new", "HashMap", "<", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testMigrationsBundle", "(", ")", "throws", "Exception", "{", "Bootstrap", "<", "TestMigrationConfiguration", ">", "bootstrap", "=", "new", "Bootstrap", "<", ">", "(", "application", ")", ";", "assertThat", "(", "migrationsBundle", ".", "name", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "migrationsBundle", ".", "getMigrationsFileName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "migrationsBundle", ".", "getScopedObjects", "(", ")", ")", ".", "isNull", "(", ")", ";", "migrationsBundle", ".", "initialize", "(", "bootstrap", ")", ";", "assertThat", "(", "bootstrap", ".", "getCommands", "(", ")", ")", ".", "hasSize", "(", "1", ")", ".", "satisfies", "(", "list", "-", ">", "assertThat", "(", "list", ".", "get", "(", "0", ")", ")", ".", "isInstanceOf", "(", "DbCommand", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testScopedObjects", "(", ")", "{", "assertThat", "(", "migrationsBundleWithScopedObjects", ".", "getScopedObjects", "(", ")", ")", ".", "isNotNull", "(", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "private", "<", "T", ">", "void", "assertEndpointReturns400WithoutDetails", "(", "String", "endpoint", ",", "T", "entity", ")", "{", "Response", "response", "=", "target", "(", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "endpoint", ")", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "post", "(", "Entity", ".", "entity", "(", "entity", ",", "MediaType", ".", "APPLICATION_JSON", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "JsonNode", "errorMessage", "=", "response", ".", "readEntity", "(", "JsonNode", ".", "class", ")", ";", "assertThat", "(", "errorMessage", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asInt", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "errorMessage", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asText", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "errorMessage", ".", "has", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "private", "<", "T", ">", "void", "assertEndpointReturns500", "(", "String", "endpoint", ",", "T", "entity", ")", "{", "Response", "response", "=", "target", "(", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "endpoint", ")", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "post", "(", "Entity", ".", "entity", "(", "entity", ",", "MediaType", ".", "APPLICATION_JSON", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "JsonNode", "errorMessage", "=", "response", ".", "readEntity", "(", "JsonNode", ".", "class", ")", ";", "assertThat", "(", "errorMessage", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asInt", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "errorMessage", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "asText", "(", ")", ")", ".", "matches", "(", "\"", "<STR_LIT>", "<STR_LIT:\\\\>", "<STR_LIT>", "<STR_LIT:\\\\>", "<STR_LIT:+>", "<STR_LIT:\\\\>", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "errorMessage", ".", "has", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isFalse", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "boolean", "showDetails", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "boolean", "showDetails", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "ValueSource", "(", "strings", "=", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "void", "readsFileContents", "(", "String", "path", ")", "throws", "Exception", "{", "assertThat", "(", "provider", ".", "open", "(", "path", ")", ")", ".", "asString", "(", "UTF_8", ")", ".", "isEqualToIgnoringWhitespace", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "mergePaths", "(", "@", "NotNull", "String", "context", ",", "String", "subPath", ")", "{", "if", "(", "subPath", "=", "=", "null", "|", "|", "subPath", ".", "isEmpty", "(", ")", ")", "{", "return", "cleanUpPath", "(", "context", ")", ";", "}", "final", "StringBuilder", "path", "=", "new", "StringBuilder", "(", "context", ")", ";", "if", "(", "!", "context", ".", "endsWith", "(", "\"", "<STR_LIT:/>", "\"", ")", ")", "{", "path", ".", "append", "(", "<CHAR_LIT:/>", ")", ";", "}", "if", "(", "!", "\"", "<STR_LIT:/>", "\"", ".", "equals", "(", "subPath", ")", ")", "{", "final", "int", "startIndex", "=", "subPath", ".", "startsWith", "(", "\"", "<STR_LIT:/>", "\"", ")", "?", "1", ":", "0", ";", "final", "int", "endIndex", "=", "subPath", ".", "endsWith", "(", "\"", "<STR_LIT:/>", "\"", ")", "?", "subPath", ".", "length", "(", ")", "-", "1", ":", "subPath", ".", "length", "(", ")", ";", "path", ".", "append", "(", "subPath", ",", "startIndex", ",", "endIndex", ")", ";", "}", "return", "cleanUpPath", "(", "path", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "static", "void", "copyInternal", "(", "InputStream", "in", ",", "OutputStream", "to", ")", "throws", "IOException", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "<NUM_LIT>", "]", ";", "int", "length", ";", "while", "(", "(", "length", "=", "in", ".", "read", "(", "buffer", ")", ")", "!", "=", "-", "1", ")", "{", "to", ".", "write", "(", "buffer", ",", "0", ",", "length", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "writeKeystore", "(", "String", "source", ")", "throws", "IOException", "{", "try", "(", "final", "InputStream", "inputStream", "=", "getClass", "(", ")", ".", "getResourceAsStream", "(", "source", ")", ")", "{", "Files", ".", "write", "(", "keystore", ",", "ByteStreams", ".", "toByteArray", "(", "inputStream", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "super", ".", "close", "(", ")", ";", "closeSocket", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "closeSocket", "(", ")", "throws", "IOException", "{", "if", "(", "socket", "!", "=", "null", "&", "&", "!", "socket", ".", "isClosed", "(", ")", ")", "{", "socket", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "before", "(", ")", "throws", "Throwable", "{", "beforeInvocations", "+", "+", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "after", "(", ")", "throws", "Throwable", "{", "afterInvocations", "+", "+", ";", "}", "</s>"]
["<s>", "public", "int", "getBeforeInvocations", "(", ")", "{", "return", "beforeInvocations", ";", "}", "</s>"]
["<s>", "public", "int", "getAfterInvocations", "(", ")", "{", "return", "afterInvocations", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "afterEach", "(", "ExtensionContext", "context", ")", "throws", "Exception", "{", "DelayedAssertionsTest", "testInstance", "=", "(", "DelayedAssertionsTest", ")", "context", ".", "getTestInstance", "(", ")", ".", "orElseThrow", "(", "(", ")", "-", ">", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "testInstance", ".", "getDelayedAssertions", "(", ")", ".", "forEach", "(", "Invokable", ":", ":", "invoke", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "parentClassTestMethod", "(", ")", "{", "getDelayedAssertions", "(", ")", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "getExtension", "(", ")", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "getExtension", "(", ")", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "overriddenTestMethod", "(", ")", "{", "getDelayedAssertions", "(", ")", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "getExtension", "(", ")", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "getExtension", "(", ")", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Invokable", ">", "getDelayedAssertions", "(", ")", "{", "return", "ParentClass_ChildHasExtension", ".", "this", ".", "getDelayedAssertions", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "onlyInParent", "(", ")", "{", "getDelayedAssertions", "(", ")", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "getExtension", "(", ")", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "getExtension", "(", ")", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "Invokable", ">", "getDelayedAssertions", "(", ")", "{", "return", "delayedAssertions", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "parentClassTestMethod", "(", ")", "{", "getDelayedAssertions", "(", ")", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "overriddenTestMethod", "(", ")", "{", "getDelayedAssertions", "(", ")", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "onlyInParent", "(", ")", "{", "getDelayedAssertions", "(", ")", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "regularTestMethod", "(", ")", "{", "delayedAssertions", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "nestedClassMethod", "(", ")", "{", "delayedAssertions", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "CountingExtension", "getExtension", "(", ")", "{", "return", "extension", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "childClassTestMethod", "(", ")", "{", "delayedAssertions", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "@", "Override", "public", "void", "parentClassTestMethod", "(", ")", "{", "delayedAssertions", ".", "add", "(", "(", ")", "-", ">", "{", "assertThat", "(", "extension", ".", "getBeforeInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "assertThat", "(", "extension", ".", "getAfterInvocations", "(", ")", ")", ".", "isEqualTo", "(", "1", ")", ";", "}", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "ILoggingEvent", ">", "getAllLoggingEvents", "(", ")", "{", "return", "events", ";", "}", "</s>"]
["<s>", "public", "void", "clearAllLoggingEvents", "(", ")", "{", "events", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "append", "(", "ILoggingEvent", "iLoggingEvent", ")", "{", "if", "(", "iLoggingEvent", ".", "getLevel", "(", ")", "!", "=", "Level", ".", "DEBUG", ")", "{", "events", ".", "add", "(", "iLoggingEvent", ")", ";", "}", "}", "</s>"]
["<s>", "@", "BeforeAll", "static", "void", "setUp", "(", ")", "{", "LoggerContext", "loggerContext", "=", "(", "LoggerContext", ")", "LoggerFactory", ".", "getILoggerFactory", "(", ")", ";", "Logger", "root", "=", "loggerContext", ".", "getLogger", "(", "org", ".", "slf4j", ".", "Logger", ".", "ROOT_LOGGER_NAME", ")", ";", "listAppender", ".", "setContext", "(", "root", ".", "getLoggerContext", "(", ")", ")", ";", "listAppender", ".", "start", "(", ")", ";", "root", ".", "addAppender", "(", "listAppender", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "configureCredentialReturnsUserNamePasswordCredentialsForBasicConfig", "(", ")", "{", "assertThat", "(", "builder", ".", "configureCredentials", "(", "new", "AuthConfiguration", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ")", ".", "isInstanceOfSatisfying", "(", "UsernamePasswordCredentials", ".", "class", ",", "upCredentials", "-", ">", "assertThat", "(", "upCredentials", ")", ".", "satisfies", "(", "c", "-", ">", "assertThat", "(", "c", ".", "getPassword", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "satisfies", "(", "c", "-", ">", "assertThat", "(", "c", ".", "getUserPrincipal", "(", ")", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "Future", "<", "List", "<", "String", ">", ">", "receive", "(", ")", "{", "return", "es", ".", "submit", "(", "(", ")", "-", ">", "{", "try", "(", "Socket", "s", "=", "serverSocket", ".", "accept", "(", ")", ";", "BufferedReader", "reader", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "s", ".", "getInputStream", "(", ")", ",", "StandardCharsets", ".", "UTF_8", ")", ")", ")", "{", "return", "reader", ".", "lines", "(", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "public", "void", "close", "(", ")", "{", "es", ".", "shutdownNow", "(", ")", ";", "try", "{", "if", "(", "!", "es", ".", "awaitTermination", "(", "1", ",", "TimeUnit", ".", "MINUTES", ")", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "catch", "(", "InterruptedException", "ie", ")", "{", "es", ".", "shutdownNow", "(", ")", ";", "Thread", ".", "currentThread", "(", ")", ".", "interrupt", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "List", "<", "String", ">", "generateLogs", "(", "final", "Logger", "logger", ")", "{", "return", "IntStream", ".", "range", "(", "0", ",", "<NUM_LIT:100>", ")", ".", "mapToObj", "(", "i", "-", ">", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "i", ")", ")", ".", "peek", "(", "logger", ":", ":", "info", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "Future", "<", "List", "<", "String", ">", ">", "receive", "(", ")", "{", "return", "es", ".", "submit", "(", "(", ")", "-", ">", "{", "List", "<", "String", ">", "messages", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "for", "(", ";", "messageCount", ">", "0", ";", "messageCount", "-", "-", ")", "{", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "<NUM_LIT>", "]", ";", "DatagramPacket", "datagramPacket", "=", "new", "DatagramPacket", "(", "buffer", ",", "buffer", ".", "length", ")", ";", "try", "{", "socket", ".", "receive", "(", "datagramPacket", ")", ";", "messages", ".", "add", "(", "new", "String", "(", "buffer", ",", "0", ",", "datagramPacket", ".", "getLength", "(", ")", ",", "UTF_8", ")", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "return", "messages", ";", "}", ")", ";", "}", "</s>"]
["<s>", "private", "static", "List", "<", "String", ">", "generateLogs", "(", "final", "Logger", "logger", ",", "final", "int", "messageCount", ")", "{", "return", "IntStream", ".", "range", "(", "0", ",", "messageCount", ")", ".", "mapToObj", "(", "i", "-", ">", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "i", ")", ")", ".", "peek", "(", "logger", ":", ":", "info", ")", ".", "collect", "(", "Collectors", ".", "toList", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "CsvSource", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "void", "testAppenderTimeZone", "(", "String", "configurationFile", ",", "String", "timeZone", ")", "throws", "Exception", "{", "final", "ConsoleAppenderFactory", "<", "?", ">", "appender", "=", "factory", ".", "build", "(", "configurationSourceProvider", ",", "configurationFile", ")", ";", "assertThat", "(", "appender", ".", "getTimeZone", "(", ")", ".", "getID", "(", ")", ")", ".", "isEqualTo", "(", "timeZone", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handle", "(", "String", "target", ",", "Request", "baseRequest", ",", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "IOException", ",", "ServletException", "{", "try", "{", "super", ".", "handle", "(", "target", ",", "baseRequest", ",", "request", ",", "response", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "Throwable", "rootCause", "=", "ExceptionUtils", ".", "getRootCause", "(", "ex", ")", ";", "if", "(", "rootCause", "instanceof", "ZipException", "|", "|", "rootCause", "instanceof", "EOFException", ")", "{", "throw", "new", "BadMessageException", "(", "HttpStatus", ".", "BAD_REQUEST_400", ",", "rootCause", ".", "getMessage", "(", ")", ",", "rootCause", ")", ";", "}", "throw", "ex", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "testBadRequestStatusOnInvalidGzipBytes", "(", ")", "throws", "Exception", "{", "request", ".", "setMethod", "(", "\"", "<STR_LIT:POST>", "\"", ")", ";", "request", ".", "setHeader", "(", "HttpHeader", ".", "CONTENT_TYPE", ".", "asString", "(", ")", ",", "PLAIN_TEXT_UTF_8", ")", ";", "request", ".", "setHeader", "(", "HttpHeader", ".", "CONTENT_ENCODING", ".", "asString", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "request", ".", "setContent", "(", "\"", "<STR_LIT>", "\"", ")", ";", "HttpTester", ".", "Response", "response", "=", "HttpTester", ".", "parseResponse", "(", "servletTester", ".", "getResponses", "(", "request", ".", "generate", "(", ")", ")", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "stripLastComponent", "(", "String", "str", ")", "{", "int", "pos", "=", "str", ".", "lastIndexOf", "(", "<CHAR_LIT:.>", ")", ";", "return", "pos", "=", "=", "-", "1", "?", "str", ":", "str", ".", "substring", "(", "0", ",", "pos", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Optional", "<", "Annotation", "[", "]", ">", "getFieldAnnotations", "(", "Class", "klass", ",", "String", "name", ")", "{", "try", "{", "return", "Optional", ".", "of", "(", "klass", ".", "getDeclaredField", "(", "name", ")", ".", "getDeclaredAnnotations", "(", ")", ")", ";", "}", "catch", "(", "NoSuchFieldException", "e", ")", "{", "return", "Optional", ".", "ofNullable", "(", "klass", ".", "getSuperclass", "(", ")", ")", ".", "flatMap", "(", "superClass", "-", ">", "getFieldAnnotations", "(", "superClass", ",", "name", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "CsvSource", "(", "value", "=", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "}", ")", "@", "ParameterizedTest", "void", "nameWithoutFormat", "(", "String", "format", ",", "String", "name", ")", "{", "assertThat", "(", "ExecutorServiceBuilder", ".", "getNameWithoutFormat", "(", "format", ")", ")", ".", "describedAs", "(", "\"", "<STR_LIT>", "\"", ",", "format", ",", "name", ")", ".", "isEqualTo", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "Produces", "(", "MediaType", ".", "TEXT_PLAIN", ")", "public", "String", "receiveDate", "(", "@", "QueryParam", "(", "\"", "<STR_LIT>", "\"", ")", "LocalDateParam", "date", ")", "{", "if", "(", "date", "=", "=", "null", ")", "{", "LOGGER", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "LOGGER", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "date", ")", ";", "return", "date", ".", "get", "(", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "UnitOfWork", "public", "Person", "getPerson", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "OptionalLong", "personId", ")", "{", "return", "findSafely", "(", "personId", ".", "orElseThrow", "(", "(", ")", "-", ">", "new", "BadRequestException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "@", "Produces", "(", "MediaType", ".", "TEXT_HTML", ")", "public", "PersonView", "getPersonViewFreemarker", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "OptionalLong", "personId", ")", "{", "return", "new", "PersonView", "(", "PersonView", ".", "Template", ".", "FREEMARKER", ",", "findSafely", "(", "personId", ".", "orElseThrow", "(", "(", ")", "-", ">", "new", "BadRequestException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "@", "Produces", "(", "MediaType", ".", "TEXT_HTML", ")", "public", "PersonView", "getPersonViewMustache", "(", "@", "PathParam", "(", "\"", "<STR_LIT>", "\"", ")", "OptionalLong", "personId", ")", "{", "return", "new", "PersonView", "(", "PersonView", ".", "Template", ".", "MUSTACHE", ",", "findSafely", "(", "personId", ".", "orElseThrow", "(", "(", ")", "-", ">", "new", "BadRequestException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "validDateParameter", "(", ")", "{", "final", "String", "date", "=", "APP", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "String", ".", "class", ")", ";", "assertThat", "(", "date", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "ValueSource", "(", "strings", "=", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", "}", ")", "void", "invalidDateParameter", "(", "String", "value", ")", "{", "assertThatExceptionOfType", "(", "BadRequestException", ".", "class", ")", ".", "isThrownBy", "(", "(", ")", "-", ">", "APP", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "queryParam", "(", "\"", "<STR_LIT>", "\"", ",", "value", ")", ".", "request", "(", ")", ".", "get", "(", "String", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "noDateParameter", "(", ")", "{", "final", "String", "date", "=", "APP", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "APP", ".", "getLocalPort", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", "String", ".", "class", ")", ";", "assertThat", "(", "date", ")", ".", "isEqualTo", "(", "\"", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "configure", "(", ")", "throws", "Exception", "{", "final", "DefaultHealthFactory", "healthFactory", "=", "configFactory", ".", "build", "(", "new", "ResourceConfigurationSourceProvider", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "LifecycleEnvironment", "lifecycleEnvironment", "=", "new", "LifecycleEnvironment", "(", "new", "MetricRegistry", "(", ")", ")", ";", "ServletRegistration", ".", "Dynamic", "mockServletRegistration", "=", "mock", "(", "ServletRegistration", ".", "Dynamic", ".", "class", ")", ";", "ServletEnvironment", "servletEnvironment", "=", "mock", "(", "ServletEnvironment", ".", "class", ")", ";", "ArgumentCaptor", "<", "Servlet", ">", "servletCaptor", "=", "ArgumentCaptor", ".", "forClass", "(", "Servlet", ".", "class", ")", ";", "when", "(", "servletEnvironment", ".", "addServlet", "(", "eq", "(", "\"", "<STR_LIT>", "\"", ")", ",", "any", "(", "Servlet", ".", "class", ")", ")", ")", ".", "thenReturn", "(", "mockServletRegistration", ")", ";", "HealthEnvironment", "healthEnvironment", "=", "new", "HealthEnvironment", "(", "mock", "(", "HealthCheckRegistry", ".", "class", ")", ")", ";", "healthFactory", ".", "configure", "(", "lifecycleEnvironment", ",", "servletEnvironment", ",", "mock", "(", "JerseyEnvironment", ".", "class", ")", ",", "healthEnvironment", ",", "new", "ObjectMapper", "(", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "lifecycleEnvironment", ".", "getManagedObjects", "(", ")", ")", ".", "hasSize", "(", "<NUM_LIT:2>", ")", ".", "allSatisfy", "(", "obj", "-", ">", "assertThat", "(", "obj", ")", ".", "isInstanceOf", "(", "JettyManaged", ".", "class", ")", ")", ".", "map", "(", "managed", "-", ">", "(", "(", "JettyManaged", ")", "managed", ")", ".", "getManaged", "(", ")", ")", ".", "satisfies", "(", "obj", "-", ">", "assertThat", "(", "obj", ")", ".", "element", "(", "0", ")", ".", "isInstanceOfSatisfying", "(", "ExecutorServiceManager", ".", "class", ",", "executorServiceManager", "-", ">", "assertThat", "(", "executorServiceManager", ".", "getPoolName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ".", "satisfies", "(", "obj", "-", ">", "assertThat", "(", "obj", ")", ".", "element", "(", "1", ")", ".", "isInstanceOf", "(", "HealthCheckConfigValidator", ".", "class", ")", ")", ";", "assertThat", "(", "healthFactory", ".", "getHealthResponderFactory", "(", ")", ")", ".", "isInstanceOf", "(", "ServletHealthResponderFactory", ".", "class", ")", ";", "verify", "(", "servletEnvironment", ")", ".", "addServlet", "(", "eq", "(", "\"", "<STR_LIT>", "\"", ")", ",", "servletCaptor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "servletCaptor", ".", "getValue", "(", ")", ")", ".", "isInstanceOf", "(", "ServletHealthResponder", ".", "class", ")", ";", "verify", "(", "mockServletRegistration", ")", ".", "addMapping", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "healthEnvironment", ".", "healthStateAggregator", "(", ")", ")", ".", "isNotNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "onFatalError", "(", "Throwable", "t", ")", "{", "LOGGER", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", "Configuration", "configuration", ",", "Environment", "environment", ")", "throws", "Exception", "{", "environment", ".", "servlets", "(", ")", ".", "setSessionHandler", "(", "new", "SessionHandler", "(", ")", ")", ";", "environment", ".", "jersey", "(", ")", ".", "register", "(", "new", "HttpSessionsResource", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "public", "Response", "isSessionInjected", "(", "@", "Session", "HttpSession", "httpSession", ")", "{", "return", "Response", ".", "ok", "(", "httpSession", "!", "=", "null", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testInjectedSessionsIsNotNull", "(", ")", "{", "Boolean", "sessionNotNull", "=", "RULE", ".", "client", "(", ")", ".", "target", "(", "String", ".", "format", "(", "\"", "<STR_LIT>", "\"", ",", "RULE", ".", "getLocalPort", "(", ")", ")", ")", ".", "request", "(", ")", ".", "get", "(", "Boolean", ".", "class", ")", ";", "assertThat", "(", "sessionNotNull", ")", ".", "isNotNull", "(", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "beforeAll", "(", "ExtensionContext", "extensionContext", ")", "throws", "Exception", "{", "try", "{", "before", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "throw", "new", "HibernateException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "afterAll", "(", "ExtensionContext", "extensionContext", ")", "{", "after", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "shouldProvideSession", "(", ")", "{", "final", "SessionFactory", "sessionFactory", "=", "daoTestExtension", ".", "getSessionFactory", "(", ")", ";", "assertThat", "(", "sessionFactory", ")", ".", "isNotNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "sendsNullWhenDisabled", "(", ")", "{", "final", "Dog", "raf", "=", "appExtension", ".", "client", "(", ")", ".", "target", "(", "\"", "<STR_LIT>", "\"", "+", "appExtension", ".", "getLocalPort", "(", ")", ")", ".", "path", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", "MediaType", ".", "APPLICATION_JSON", ")", ".", "get", "(", "Dog", ".", "class", ")", ";", "assertThat", "(", "raf", ".", "getName", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "raf", ".", "getOwner", "(", ")", ")", ".", "isNull", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "reloadingNothingSucceeds", "(", ")", "{", "SslReloadTask", "reloadTask", "=", "new", "SslReloadTask", "(", ")", ";", "assertThatNoException", "(", ")", ".", "isThrownBy", "(", "(", ")", "-", ">", "reloadTask", ".", "execute", "(", "emptyMap", "(", ")", ",", "mock", "(", "PrintWriter", ".", "class", ")", ")", ")", ";", "reloadTask", ".", "setReloaders", "(", "Sets", ".", "of", "(", ")", ")", ";", "assertThatNoException", "(", ")", ".", "isThrownBy", "(", "(", ")", "-", ">", "reloadTask", ".", "execute", "(", "emptyMap", "(", ")", ",", "mock", "(", "PrintWriter", ".", "class", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "failingDryRunSkipsAll", "(", ")", "throws", "Exception", "{", "SslReload", "failingDryRun", "=", "mock", "(", "SslReload", ".", "class", ")", ";", "doThrow", "(", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "when", "(", "failingDryRun", ")", ".", "reloadDryRun", "(", ")", ";", "SslReload", "ok", "=", "mock", "(", "SslReload", ".", "class", ")", ";", "SslReloadTask", "reloadTask", "=", "new", "SslReloadTask", "(", ")", ";", "reloadTask", ".", "setReloaders", "(", "Sets", ".", "of", "(", "failingDryRun", ",", "ok", ")", ")", ";", "assertThat", "(", "catchRuntimeException", "(", "(", ")", "-", ">", "reloadTask", ".", "execute", "(", "emptyMap", "(", ")", ",", "mock", "(", "PrintWriter", ".", "class", ")", ")", ")", ".", "getMessage", "(", ")", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "failingDryRun", ",", "never", "(", ")", ")", ".", "reload", "(", ")", ";", "verify", "(", "ok", ",", "never", "(", ")", ")", ".", "reload", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "reloadsMultiple", "(", ")", "throws", "Exception", "{", "SslReload", "ok1", "=", "mock", "(", "SslReload", ".", "class", ")", ";", "SslReload", "ok2", "=", "mock", "(", "SslReload", ".", "class", ")", ";", "SslReloadTask", "reloadTask", "=", "new", "SslReloadTask", "(", ")", ";", "reloadTask", ".", "setReloaders", "(", "Sets", ".", "of", "(", "ok1", ",", "ok2", ")", ")", ";", "reloadTask", ".", "execute", "(", "emptyMap", "(", ")", ",", "mock", "(", "PrintWriter", ".", "class", ")", ")", ";", "verify", "(", "ok1", ",", "times", "(", "1", ")", ")", ".", "reload", "(", ")", ";", "verify", "(", "ok2", ",", "times", "(", "1", ")", ")", ".", "reload", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "reloadDryRun", "(", ")", "throws", "Exception", "{", "new", "SslContextFactory", ".", "Server", "(", ")", ".", "reload", "(", "configurer", ")", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "protected", "URL", "getResourceURL", "(", "String", "absoluteRequestedResourcePath", ")", "{", "return", "getResourceUrl", "(", "absoluteRequestedResourcePath", ")", ";", "}", "</s>"]
["<s>", "protected", "LifeCycle", ".", "Listener", "logSslParameters", "(", "final", "SslContextFactory", "sslContextFactory", ")", "{", "return", "logSslInfoOnStart", "(", "sslContextFactory", ")", ";", "}", "</s>"]
["<s>", "private", "static", "File", "toFile", "(", "final", "String", "resourceName", ")", "throws", "URISyntaxException", "{", "return", "new", "File", "(", "getResource", "(", "resourceName", ")", ".", "toURI", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "void", "setUp", "(", ")", "throws", "Exception", "{", "sslContextFactory", ".", "setTrustStorePath", "(", "resourceFilePath", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "sslContextFactory", ".", "setTrustStorePassword", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sslContextFactory", ".", "start", "(", ")", ";", "http1Client", "=", "new", "HttpClient", "(", "sslContextFactory", ")", ";", "http1Client", ".", "start", "(", ")", ";", "http2Client", "=", "new", "HttpClient", "(", "new", "HttpClientTransportOverHTTP2", "(", "new", "HTTP2Client", "(", ")", ")", ",", "sslContextFactory", ")", ";", "http2Client", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "AfterEach", "void", "tearDown", "(", ")", "throws", "Exception", "{", "http2Client", ".", "stop", "(", ")", ";", "http1Client", ".", "stop", "(", ")", ";", "sslContextFactory", ".", "stop", "(", ")", ";", "}", "</s>"]
["<s>", "static", "void", "assertResponse", "(", "ContentResponse", "response", ",", "HttpVersion", "httpVersion", ")", "{", "assertThat", "(", "response", ".", "getVersion", "(", ")", ")", ".", "isEqualTo", "(", "httpVersion", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response", ".", "getContentAsString", "(", ")", ")", ".", "isEqualTo", "(", "FakeApplication", ".", "HELLO_WORLD", ")", ";", "}", "</s>"]
["<s>", "static", "boolean", "performManyAsyncRequests", "(", "HttpClient", "client", ",", "String", "url", ")", "throws", "InterruptedException", "{", "final", "int", "amount", "=", "<NUM_LIT:100>", ";", "final", "CountDownLatch", "latch", "=", "new", "CountDownLatch", "(", "amount", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "amount", ";", "i", "+", "+", ")", "{", "client", ".", "newRequest", "(", "url", ")", ".", "send", "(", "new", "BufferingResponseListener", "(", ")", "{", "@", "Override", "public", "void", "onComplete", "(", "Result", "result", ")", "{", "assertThat", "(", "result", ".", "getResponse", "(", ")", ".", "getVersion", "(", ")", ")", ".", "isEqualTo", "(", "HttpVersion", ".", "HTTP_2", ")", ";", "assertThat", "(", "result", ".", "getResponse", "(", ")", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "getContentAsString", "(", "StandardCharsets", ".", "UTF_8", ")", ")", ".", "isEqualTo", "(", "FakeApplication", ".", "HELLO_WORLD", ")", ";", "latch", ".", "countDown", "(", ")", ";", "}", "}", ")", ";", "}", "return", "latch", ".", "await", "(", "<NUM_LIT:30>", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "static", "Subparser", "createSubparser", "(", "AbstractLiquibaseCommand", "<", "?", ">", "command", ")", "{", "final", "Subparser", "subparser", "=", "ArgumentParsers", ".", "newFor", "(", "\"", "<STR_LIT>", "\"", ")", ".", "terminalWidthDetection", "(", "false", ")", ".", "build", "(", ")", ".", "addSubparsers", "(", ")", ".", "addParser", "(", "command", ".", "getName", "(", ")", ")", ".", "description", "(", "command", ".", "getDescription", "(", ")", ")", ";", "command", ".", "configure", "(", "subparser", ")", ";", "return", "subparser", ";", "}", "</s>"]
["<s>", "static", "TestMigrationConfiguration", "createConfiguration", "(", ")", "{", "return", "createConfiguration", "(", "getDatabaseUrl", "(", ")", ")", ";", "}", "</s>"]
["<s>", "static", "TestMigrationConfiguration", "createConfiguration", "(", "String", "databaseUrl", ")", "{", "final", "DataSourceFactory", "dataSource", "=", "new", "DataSourceFactory", "(", ")", ";", "dataSource", ".", "setDriverClass", "(", "\"", "<STR_LIT>", "\"", ")", ";", "dataSource", ".", "setUser", "(", "\"", "<STR_LIT>", "\"", ")", ";", "dataSource", ".", "setUrl", "(", "databaseUrl", ")", ";", "return", "new", "TestMigrationConfiguration", "(", "dataSource", ")", ";", "}", "</s>"]
["<s>", "static", "String", "getDatabaseUrl", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "UUID", ".", "randomUUID", "(", ")", "+", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "static", "boolean", "tableExists", "(", "final", "Handle", "handle", ",", "final", "String", "tableName", ")", "throws", "SQLException", "{", "return", "handle", ".", "getConnection", "(", ")", ".", "getMetaData", "(", ")", ".", "getTables", "(", "null", ",", "null", ",", "tableName", ",", "null", ")", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "static", "boolean", "columnExists", "(", "final", "Handle", "handle", ",", "final", "String", "tableName", ",", "final", "String", "columnName", ")", "throws", "SQLException", "{", "return", "handle", ".", "getConnection", "(", ")", ".", "getMetaData", "(", ")", ".", "getColumns", "(", "null", ",", "null", ",", "tableName", ",", "columnName", ")", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "serializesToJSON", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "final", "String", "expected", "=", "MAPPER", ".", "writeValueAsString", "(", "MAPPER", ".", "readValue", "(", "getClass", "(", ")", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "Person", ".", "class", ")", ")", ";", "assertThat", "(", "MAPPER", ".", "writeValueAsString", "(", "person", ")", ")", ".", "isEqualTo", "(", "expected", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "deserializesFromJSON", "(", ")", "throws", "Exception", "{", "final", "Person", "person", "=", "new", "Person", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "assertThat", "(", "MAPPER", ".", "readValue", "(", "getClass", "(", ")", ".", "getResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "Person", ".", "class", ")", ")", ".", "isEqualTo", "(", "person", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Optional", "<", "Throwable", ">", "findThrowableInChain", "(", "Predicate", "<", "Throwable", ">", "condition", ",", "@", "Nullable", "Throwable", "t", ")", "{", "final", "Set", "<", "Throwable", ">", "seen", "=", "new", "HashSet", "<", ">", "(", ")", ";", "while", "(", "t", "!", "=", "null", "&", "&", "!", "seen", ".", "contains", "(", "t", ")", ")", "{", "if", "(", "condition", ".", "test", "(", "t", ")", ")", "{", "return", "Optional", ".", "of", "(", "t", ")", ";", "}", "seen", ".", "add", "(", "t", ")", ";", "t", "=", "t", ".", "getCause", "(", ")", ";", "}", "return", "Optional", ".", "empty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "findsNothingFromNull", "(", ")", "{", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "true", ",", "null", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "findsSimpleException", "(", ")", "{", "final", "RuntimeException", "e", "=", "new", "RuntimeException", "(", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "t", "instanceof", "RuntimeException", ",", "e", ")", ")", ".", "contains", "(", "e", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "false", ",", "e", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "findsChainedException", "(", ")", "{", "final", "RuntimeException", "first", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "RuntimeException", "second", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "first", ")", ";", "final", "RuntimeException", "third", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "second", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "third", ")", ")", ".", "contains", "(", "third", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "third", ")", ")", ".", "contains", "(", "second", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "third", ")", ")", ".", "contains", "(", "first", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "false", ",", "third", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "ignoresCircularChains", "(", ")", "{", "final", "LateBoundCauseException", "first", "=", "new", "LateBoundCauseException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "RuntimeException", "second", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "first", ")", ";", "final", "RuntimeException", "third", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "second", ")", ";", "first", ".", "setCause", "(", "third", ")", ";", "final", "RuntimeException", "fourth", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "third", ")", ";", "final", "RuntimeException", "fifth", "=", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "fourth", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "fifth", ")", ")", ".", "contains", "(", "fifth", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "fifth", ")", ")", ".", "contains", "(", "fourth", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "fifth", ")", ")", ".", "contains", "(", "third", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "fifth", ")", ")", ".", "contains", "(", "second", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "fifth", ")", ")", ".", "contains", "(", "first", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "false", ",", "fifth", ")", ")", ".", "isEmpty", "(", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "second", ")", ")", ".", "contains", "(", "third", ")", ";", "assertThat", "(", "findThrowableInChain", "(", "t", "-", ">", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "t", ".", "getMessage", "(", ")", ")", ",", "second", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "void", "setCause", "(", "@", "Nullable", "Throwable", "cause", ")", "{", "this", ".", "cause", "=", "cause", ";", "}", "</s>"]
["<s>", "@", "Override", "@", "Nullable", "public", "Throwable", "getCause", "(", ")", "{", "return", "cause", ";", "}", "</s>"]
["<s>", "@", "JsonProperty", "public", "void", "setBirthday", "(", "@", "Nullable", "ZonedDateTime", "birthday", ")", "{", "this", ".", "birthday", "=", "birthday", ";", "}", "</s>"]
["<s>", "private", "String", "getCounterString", "(", "Counter", "counter", ")", "{", "return", "Counter", ".", "class", ".", "equals", "(", "counter", ".", "getClass", "(", ")", ")", "?", "String", ".", "valueOf", "(", "counter", ".", "getCount", "(", ")", ")", ":", "counter", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "private", "String", "baseUri", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "appExtension", ".", "getLocalPort", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Boolean", "request", "(", "String", "path", ")", "{", "return", "appExtension", ".", "client", "(", ")", ".", "target", "(", "baseUri", "(", ")", ")", ".", "path", "(", "path", ")", ".", "request", "(", "MediaType", ".", "TEXT_PLAIN", ")", ".", "get", "(", "Boolean", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testDog", "(", ")", "{", "assertThat", "(", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "requireNonNull", "(", "staticTestResource", ")", ".", "getDog", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testPerson", "(", ")", "{", "assertThat", "(", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "requireNonNull", "(", "staticTestResource", ")", ".", "getPerson", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testFailingDog", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isInstanceOf", "(", "InternalServerErrorException", ".", "class", ")", ";", "assertThatThrownBy", "(", "(", ")", "-", ">", "requireNonNull", "(", "staticTestResource", ")", ".", "getFailingDog", "(", ")", ")", ".", "isInstanceOf", "(", "HibernateException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testDogMultiple", "(", ")", "{", "assertThat", "(", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "requireNonNull", "(", "staticTestResource", ")", ".", "getDogMultiple", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testFailingPerson", "(", ")", "{", "assertThatThrownBy", "(", "(", ")", "-", ">", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isInstanceOf", "(", "InternalServerErrorException", ".", "class", ")", ";", "assertThatThrownBy", "(", "(", ")", "-", ">", "requireNonNull", "(", "staticTestResource", ")", ".", "getFailingPerson", "(", ")", ")", ".", "isInstanceOf", "(", "HibernateException", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testDogAndPerson", "(", ")", "{", "assertThat", "(", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isTrue", "(", ")", ";", "assertThat", "(", "requireNonNull", "(", "staticTestResource", ")", ".", "getDogAndPerson", "(", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testDeclaredAndHandlingUnitOfWork", "(", ")", "{", "assertThat", "(", "request", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "isTrue", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PooledDataSourceFactory", "getDataSourceFactory", "(", "TestConfiguration", "configuration", ")", "{", "return", "configuration", ".", "personDataSource", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "name", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "initialize", "(", "Bootstrap", "<", "TestConfiguration", ">", "bootstrap", ")", "{", "bootstrap", ".", "addBundle", "(", "dogHibernate", ")", ";", "bootstrap", ".", "addBundle", "(", "personHibernate", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", "TestConfiguration", "configuration", ",", "Environment", "environment", ")", "throws", "Exception", "{", "final", "SessionFactory", "dogSessionFactory", "=", "dogHibernate", ".", "getSessionFactory", "(", ")", ";", "final", "SessionFactory", "personSessionFactory", "=", "personHibernate", ".", "getSessionFactory", "(", ")", ";", "initDatabase", "(", "dogSessionFactory", ",", "personSessionFactory", ")", ";", "UnitOfWorkAwareProxyFactory", "proxyFactory", "=", "new", "UnitOfWorkAwareProxyFactory", "(", "dogHibernate", ",", "personHibernate", ")", ";", "staticTestResource", "=", "proxyFactory", ".", "create", "(", "TestResource", ".", "class", ",", "new", "Class", "[", "]", "{", "SessionFactory", ".", "class", ",", "SessionFactory", ".", "class", "}", ",", "new", "Object", "[", "]", "{", "dogSessionFactory", ",", "personSessionFactory", "}", ")", ";", "environment", ".", "jersey", "(", ")", ".", "register", "(", "new", "TestResource", "(", "dogSessionFactory", ",", "personSessionFactory", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "initDatabase", "(", "SessionFactory", "dogSessionFactory", ",", "SessionFactory", "personSessionFactory", ")", "{", "try", "(", "Session", "dogSession", "=", "dogSessionFactory", ".", "openSession", "(", ")", ";", "Session", "personSession", "=", "personSessionFactory", ".", "openSession", "(", ")", ")", "{", "Transaction", "personTransaction", "=", "personSession", ".", "beginTransaction", "(", ")", ";", "personSession", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "personSession", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "personTransaction", ".", "commit", "(", ")", ";", "Transaction", "dogTransaction", "=", "dogSession", ".", "beginTransaction", "(", ")", ";", "dogSession", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "dogSession", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "dogSession", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "dogSession", ".", "createNativeQuery", "(", "\"", "<STR_LIT>", "\"", ")", ".", "executeUpdate", "(", ")", ";", "dogTransaction", ".", "commit", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "getDog", "(", ")", "{", "return", "dogSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "dogSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "getPerson", "(", ")", "{", "return", "personSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "personSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "getFailingDog", "(", ")", "{", "return", "dogSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "dogSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ",", "readOnly", "=", "true", ")", "public", "boolean", "getDogMultiple", "(", ")", "{", "return", "dogSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "dogSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", "&", "&", "dogSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isDefaultReadOnly", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "getFailingPerson", "(", ")", "{", "return", "personSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "personSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "@", "Path", "(", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "getDogAndPerson", "(", ")", "{", "return", "dogSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "personSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "dogSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", "&", "&", "personSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "UnitOfWork", "(", "value", "=", "\"", "<STR_LIT>", "\"", ")", "@", "Override", "public", "boolean", "getDefinitionAndHandlingUnitOfWork", "(", ")", "{", "return", "dogSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "personSessionFactory", ".", "getCurrentSession", "(", ")", "!", "=", "null", "&", "&", "dogSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", "&", "&", "personSessionFactory", ".", "getCurrentSession", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "default", "RuntimeException", "buildException", "(", "String", "prefix", ",", "String", "realm", ")", "{", "return", "new", "WebApplicationException", "(", "buildResponse", "(", "prefix", ",", "realm", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "RuntimeException", "buildException", "(", "String", "prefix", ",", "String", "realm", ")", "{", "return", "new", "CustomAuthException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Response", "toResponse", "(", "CustomAuthException", "exception", ")", "{", "return", "Response", ".", "status", "(", "<NUM_LIT>", ")", ".", "entity", "(", "exception", ".", "getMessage", "(", ")", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "GET", "public", "String", "ping", "(", "@", "Auth", "Principal", "principal", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "DeploymentContext", "configureDeployment", "(", ")", "{", "forceSet", "(", "TestProperties", ".", "CONTAINER_PORT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "return", "ServletDeploymentContext", ".", "builder", "(", "new", "CustomAuthResourceConfig", "(", ")", ")", ".", "initParam", "(", "ServletProperties", ".", "JAXRS_APPLICATION_CLASS", ",", "CustomAuthResourceConfig", ".", "class", ".", "getName", "(", ")", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testCustomAuthException", "(", ")", "{", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "String", "entity", "=", "response", ".", "readEntity", "(", "String", ".", "class", ")", ";", "assertThat", "(", "entity", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isPreviouslyRecovered", "(", ")", "{", "return", "previouslyRecovered", ";", "}", "</s>"]
["<s>", "private", "void", "registerAuthFilter", "(", "FeatureContext", "context", ",", "@", "Nullable", "ContainerRequestFilter", "decoratedAuthFilter", ")", "{", "if", "(", "decoratedAuthFilter", "!", "=", "null", ")", "{", "context", ".", "register", "(", "new", "InjectingFilter", "(", "injectionManager", ",", "decoratedAuthFilter", ")", ")", ";", "}", "else", "if", "(", "authFilter", "!", "=", "null", ")", "{", "context", ".", "register", "(", "new", "InjectingFilter", "(", "injectionManager", ",", "authFilter", ")", ")", ";", "}", "else", "if", "(", "authFilterClass", "!", "=", "null", ")", "{", "context", ".", "register", "(", "authFilterClass", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "configure", "(", "FeatureContext", "context", ")", "{", "try", "{", "this", ".", "injectionManager", "=", "InjectionManagerProvider", ".", "getInjectionManager", "(", "context", ")", ";", "return", "true", ";", "}", "catch", "(", "IllegalArgumentException", "illegalArgumentException", ")", "{", "return", "false", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "filter", "(", "ContainerRequestContext", "requestContext", ")", "throws", "IOException", "{", "if", "(", "injectionManager", "!", "=", "null", ")", "{", "injectionManager", ".", "inject", "(", "filter", ")", ";", "if", "(", "filter", ".", "authenticator", "!", "=", "null", ")", "{", "injectionManager", ".", "inject", "(", "filter", ".", "authenticator", ")", ";", "}", "if", "(", "filter", ".", "authorizer", "!", "=", "null", ")", "{", "injectionManager", ".", "inject", "(", "filter", ".", "authorizer", ")", ";", "}", "}", "rawAuthFilter", ".", "filter", "(", "requestContext", ")", ";", "}", "</s>"]
["<s>", "ContainerRequestFilter", "getUnderlying", "(", ")", "{", "return", "underlying", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "filter", "(", "ContainerRequestContext", "requestContext", ")", "throws", "IOException", "{", "if", "(", "injectionManager", "=", "=", "null", ")", "{", "throw", "new", "ForbiddenException", "(", ")", ";", "}", "if", "(", "!", "authenticate", "(", "requestContext", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", "{", "throw", "new", "WebApplicationException", "(", "Response", ".", "Status", ".", "UNAUTHORIZED", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "ContainerRequestFilter", "getAuthFilter", "(", ")", "{", "return", "new", "TestInjectionAuthFilter", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "DeploymentContext", "configureDeployment", "(", ")", "{", "forceSet", "(", "TestProperties", ".", "CONTAINER_PORT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "return", "ServletDeploymentContext", ".", "builder", "(", "new", "InjectionResourceConfig", "(", ")", ")", ".", "initParam", "(", "ServletProperties", ".", "JAXRS_APPLICATION_CLASS", ",", "InjectionResourceConfig", ".", "class", ".", "getName", "(", ")", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testInjectionSupport", "(", ")", "{", "Response", "response", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ".", "request", "(", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response", ".", "getStatus", "(", ")", ")", ".", "isNotEqualTo", "(", "<NUM_LIT>", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "public", "SessionFactory", "prepare", "(", "final", "boolean", "readOnly", ")", "{", "final", "SessionFactory", "factory", "=", "readOnly", "?", "reader", ":", "primary", ";", "current", ".", "set", "(", "factory", ")", ";", "return", "factory", ";", "}", "</s>"]
["<s>", "public", "SessionFactory", "current", "(", ")", "{", "return", "current", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "EntityManager", "createEntityManager", "(", ")", "{", "return", "current", "(", ")", ".", "createEntityManager", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "EntityManager", "createEntityManager", "(", "final", "Map", "map", ")", "{", "return", "current", "(", ")", ".", "createEntityManager", "(", "map", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "EntityManager", "createEntityManager", "(", "final", "SynchronizationType", "synchronizationType", ")", "{", "return", "current", "(", ")", ".", "createEntityManager", "(", "synchronizationType", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "EntityManager", "createEntityManager", "(", "final", "SynchronizationType", "synchronizationType", ",", "final", "Map", "map", ")", "{", "return", "current", "(", ")", ".", "createEntityManager", "(", "synchronizationType", ",", "map", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CriteriaBuilder", "getCriteriaBuilder", "(", ")", "{", "return", "current", "(", ")", ".", "getCriteriaBuilder", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isOpen", "(", ")", "{", "return", "current", "(", ")", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getProperties", "(", ")", "{", "return", "current", "(", ")", ".", "getProperties", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PersistenceUnitUtil", "getPersistenceUnitUtil", "(", ")", "{", "return", "current", "(", ")", ".", "getPersistenceUnitUtil", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addNamedQuery", "(", "String", "name", ",", "Query", "query", ")", "{", "current", "(", ")", ".", "addNamedQuery", "(", "name", ",", "query", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "unwrap", "(", "Class", "<", "T", ">", "cls", ")", "{", "return", "current", "(", ")", ".", "unwrap", "(", "cls", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "void", "addNamedEntityGraph", "(", "String", "graphName", ",", "EntityGraph", "<", "T", ">", "entityGraph", ")", "{", "current", "(", ")", ".", "addNamedEntityGraph", "(", "graphName", ",", "entityGraph", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "List", "<", "EntityGraph", "<", "?", "super", "T", ">", ">", "findEntityGraphsByType", "(", "Class", "<", "T", ">", "entityClass", ")", "{", "return", "current", "(", ")", ".", "findEntityGraphsByType", "(", "entityClass", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Metamodel", "getMetamodel", "(", ")", "{", "return", "current", "(", ")", ".", "getMetamodel", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Reference", "getReference", "(", ")", "throws", "NamingException", "{", "return", "current", "(", ")", ".", "getReference", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "SessionFactoryOptions", "getSessionFactoryOptions", "(", ")", "{", "return", "current", "(", ")", ".", "getSessionFactoryOptions", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "SessionBuilder", "withOptions", "(", ")", "{", "return", "current", "(", ")", ".", "withOptions", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Session", "openSession", "(", ")", "throws", "HibernateException", "{", "return", "current", "(", ")", ".", "openSession", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Session", "getCurrentSession", "(", ")", "throws", "HibernateException", "{", "return", "current", "(", ")", ".", "getCurrentSession", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "StatelessSessionBuilder", "withStatelessOptions", "(", ")", "{", "return", "current", "(", ")", ".", "withStatelessOptions", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "StatelessSession", "openStatelessSession", "(", ")", "{", "return", "current", "(", ")", ".", "openStatelessSession", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "StatelessSession", "openStatelessSession", "(", "Connection", "connection", ")", "{", "return", "current", "(", ")", ".", "openStatelessSession", "(", "connection", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Statistics", "getStatistics", "(", ")", "{", "return", "current", "(", ")", ".", "getStatistics", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "throws", "HibernateException", "{", "current", "(", ")", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isClosed", "(", ")", "{", "return", "current", "(", ")", ".", "isClosed", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Cache", "getCache", "(", ")", "{", "return", "current", "(", ")", ".", "getCache", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "getDefinedFilterNames", "(", ")", "{", "return", "current", "(", ")", ".", "getDefinedFilterNames", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "FilterDefinition", "getFilterDefinition", "(", "String", "filterName", ")", "throws", "HibernateException", "{", "return", "current", "(", ")", ".", "getFilterDefinition", "(", "filterName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "containsFetchProfileDefinition", "(", "String", "name", ")", "{", "return", "current", "(", ")", ".", "containsFetchProfileDefinition", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "TypeHelper", "getTypeHelper", "(", ")", "{", "return", "current", "(", ")", ".", "getTypeHelper", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ClassMetadata", "getClassMetadata", "(", "Class", "entityClass", ")", "{", "return", "current", "(", ")", ".", "getClassMetadata", "(", "entityClass", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ClassMetadata", "getClassMetadata", "(", "String", "entityName", ")", "{", "return", "current", "(", ")", ".", "getClassMetadata", "(", "entityName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "CollectionMetadata", "getCollectionMetadata", "(", "String", "roleName", ")", "{", "return", "current", "(", ")", ".", "getCollectionMetadata", "(", "roleName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "String", ",", "ClassMetadata", ">", "getAllClassMetadata", "(", ")", "{", "return", "current", "(", ")", ".", "getAllClassMetadata", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "getAllCollectionMetadata", "(", ")", "{", "return", "current", "(", ")", ".", "getAllCollectionMetadata", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", "T", "configuration", ",", "Environment", "environment", ")", "throws", "Exception", "{", "final", "String", "name", "=", "name", "(", ")", ";", "final", "String", "primaryName", "=", "name", "+", "PRIMARY", ";", "final", "String", "readerName", "=", "name", "+", "READER", ";", "final", "PooledDataSourceFactory", "primaryConfig", "=", "getDataSourceFactory", "(", "configuration", ")", ";", "final", "SessionFactory", "primary", "=", "requireNonNull", "(", "sessionFactoryFactory", ".", "build", "(", "this", ",", "environment", ",", "primaryConfig", ",", "entities", ",", "primaryName", ")", ")", ";", "final", "PooledDataSourceFactory", "readerConfig", "=", "getReadSourceFactory", "(", "configuration", ")", ";", "final", "SessionFactory", "reader", "=", "requireNonNull", "(", "sessionFactoryFactory", ".", "build", "(", "this", ",", "environment", ",", "readerConfig", ",", "entities", ",", "readerName", ")", ")", ";", "final", "DualSessionFactory", "factory", "=", "new", "DualSessionFactory", "(", "primary", ",", "reader", ")", ";", "registerUnitOfWorkListenerIfAbsent", "(", "environment", ")", ".", "registerSessionFactory", "(", "name", ",", "factory", ")", ";", "final", "ExecutorService", "exec", "=", "environment", ".", "getHealthCheckExecutorService", "(", ")", ";", "environment", ".", "healthChecks", "(", ")", ".", "register", "(", "primaryName", ",", "new", "SessionFactoryHealthCheck", "(", "exec", ",", "primaryConfig", ".", "getValidationQueryTimeout", "(", ")", ".", "orElse", "(", "Duration", ".", "seconds", "(", "<NUM_LIT:5>", ")", ")", ",", "primary", ",", "primaryConfig", ".", "getValidationQuery", "(", ")", ")", ")", ";", "environment", ".", "healthChecks", "(", ")", ".", "register", "(", "readerName", ",", "new", "SessionFactoryHealthCheck", "(", "exec", ",", "readerConfig", ".", "getValidationQueryTimeout", "(", ")", ".", "orElse", "(", "Duration", ".", "seconds", "(", "<NUM_LIT:5>", ")", ")", ",", "reader", ",", "readerConfig", ".", "getValidationQuery", "(", ")", ")", ")", ";", "this", ".", "sessionFactory", "=", "factory", ";", "}", "</s>"]
["<s>", "@", "BeforeAll", "public", "static", "void", "beforeAll", "(", ")", "throws", "Exception", "{", "when", "(", "primaryFactory", ".", "getCurrentSession", "(", ")", ")", ".", "thenReturn", "(", "primary", ")", ";", "when", "(", "readerFactory", ".", "getCurrentSession", "(", ")", ")", ".", "thenReturn", "(", "reader", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Stream", "<", "Arguments", ">", "current", "(", ")", "{", "return", "Stream", ".", "of", "(", "arguments", "(", "false", ",", "primaryFactory", ")", ",", "arguments", "(", "true", ",", "readerFactory", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "MethodSource", "public", "void", "current", "(", "final", "boolean", "readOnly", ",", "final", "SessionFactory", "expected", ")", "{", "try", "(", "final", "DualSessionFactory", "factory", "=", "new", "DualSessionFactory", "(", "primaryFactory", ",", "readerFactory", ")", ")", "{", "factory", ".", "prepare", "(", "readOnly", ")", ";", "assertThat", "(", "factory", ".", "current", "(", ")", ")", ".", "isEqualTo", "(", "expected", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Stream", "<", "Arguments", ">", "getCurrentSession", "(", ")", "{", "return", "Stream", ".", "of", "(", "arguments", "(", "false", ",", "primary", ")", ",", "arguments", "(", "true", ",", "reader", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "MethodSource", "public", "void", "getCurrentSession", "(", "final", "boolean", "readOnly", ",", "final", "Session", "expected", ")", "{", "try", "(", "final", "DualSessionFactory", "factory", "=", "new", "DualSessionFactory", "(", "primaryFactory", ",", "readerFactory", ")", ")", "{", "factory", ".", "prepare", "(", "readOnly", ")", ";", "assertThat", "(", "factory", ".", "getCurrentSession", "(", ")", ")", ".", "isEqualTo", "(", "expected", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Stream", "<", "Arguments", ">", "prepare", "(", ")", "{", "return", "Stream", ".", "of", "(", "arguments", "(", "false", ",", "primaryFactory", ")", ",", "arguments", "(", "true", ",", "readerFactory", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "MethodSource", "public", "void", "prepare", "(", "final", "boolean", "readOnly", ",", "final", "SessionFactory", "expected", ")", "{", "try", "(", "final", "DualSessionFactory", "factory", "=", "new", "DualSessionFactory", "(", "primaryFactory", ",", "readerFactory", ")", ")", "{", "assertThat", "(", "factory", ".", "prepare", "(", "readOnly", ")", ")", ".", "isEqualTo", "(", "expected", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "DataSourceFactory", "getReadSourceFactory", "(", "Configuration", "configuration", ")", "{", "return", "readConfig", ";", "}", "</s>"]
["<s>", "@", "BeforeEach", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "when", "(", "environment", ".", "healthChecks", "(", ")", ")", ".", "thenReturn", "(", "healthChecks", ")", ";", "when", "(", "environment", ".", "jersey", "(", ")", ")", ".", "thenReturn", "(", "jerseyEnvironment", ")", ";", "when", "(", "jerseyEnvironment", ".", "getResourceConfig", "(", ")", ")", ".", "thenReturn", "(", "new", "DropwizardResourceConfig", "(", ")", ")", ";", "when", "(", "factory", ".", "build", "(", "eq", "(", "bundle", ")", ",", "any", "(", "Environment", ".", "class", ")", ",", "any", "(", "DataSourceFactory", ".", "class", ")", ",", "anyList", "(", ")", ",", "eq", "(", "PREFIX", "+", "PRIMARY", ")", ")", ")", ".", "thenReturn", "(", "sessionFactory", ")", ";", "when", "(", "factory", ".", "build", "(", "eq", "(", "bundle", ")", ",", "any", "(", "Environment", ".", "class", ")", ",", "any", "(", "DataSourceFactory", ".", "class", ")", ",", "anyList", "(", ")", ",", "eq", "(", "PREFIX", "+", "READER", ")", ")", ")", ".", "thenReturn", "(", "readFactory", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "addsHibernateSupportToJackson", "(", ")", "throws", "Exception", "{", "final", "ObjectMapper", "objectMapperFactory", "=", "mock", "(", "ObjectMapper", ".", "class", ")", ";", "final", "Bootstrap", "<", "?", ">", "bootstrap", "=", "mock", "(", "Bootstrap", ".", "class", ")", ";", "when", "(", "bootstrap", ".", "getObjectMapper", "(", ")", ")", ".", "thenReturn", "(", "objectMapperFactory", ")", ";", "bundle", ".", "initialize", "(", "bootstrap", ")", ";", "final", "ArgumentCaptor", "<", "Module", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "Module", ".", "class", ")", ";", "verify", "(", "objectMapperFactory", ")", ".", "registerModule", "(", "captor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "captor", ".", "getValue", "(", ")", ")", ".", "isInstanceOf", "(", "Hibernate5Module", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "buildsASessionFactory", "(", ")", "throws", "Exception", "{", "bundle", ".", "run", "(", "configuration", ",", "environment", ")", ";", "verify", "(", "factory", ")", ".", "build", "(", "bundle", ",", "environment", ",", "dbConfig", ",", "entities", ",", "PREFIX", "+", "PRIMARY", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "registersATransactionalListener", "(", ")", "throws", "Exception", "{", "bundle", ".", "run", "(", "configuration", ",", "environment", ")", ";", "final", "ArgumentCaptor", "<", "UnitOfWorkApplicationListener", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "UnitOfWorkApplicationListener", ".", "class", ")", ";", "verify", "(", "jerseyEnvironment", ")", ".", "register", "(", "captor", ".", "capture", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "registersASessionFactoryHealthCheck", "(", ")", "throws", "Exception", "{", "dbConfig", ".", "setValidationQuery", "(", "\"", "<STR_LIT>", "\"", ")", ";", "bundle", ".", "run", "(", "configuration", ",", "environment", ")", ";", "final", "ArgumentCaptor", "<", "SessionFactoryHealthCheck", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "SessionFactoryHealthCheck", ".", "class", ")", ";", "verify", "(", "healthChecks", ")", ".", "register", "(", "eq", "(", "PREFIX", "+", "PRIMARY", ")", ",", "captor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "captor", ".", "getValue", "(", ")", ".", "getSessionFactory", "(", ")", ")", ".", "isInstanceOf", "(", "SessionFactory", ".", "class", ")", ";", "assertThat", "(", "captor", ".", "getValue", "(", ")", ".", "getValidationQuery", "(", ")", ")", ".", "isEqualTo", "(", "Optional", ".", "of", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "healthChecks", ")", ".", "register", "(", "eq", "(", "PREFIX", "+", "READER", ")", ",", "captor", ".", "capture", "(", ")", ")", ";", "assertThat", "(", "captor", ".", "getValue", "(", ")", ".", "getSessionFactory", "(", ")", ")", ".", "isInstanceOf", "(", "SessionFactory", ".", "class", ")", ";", "assertThat", "(", "captor", ".", "getValue", "(", ")", ".", "getValidationQuery", "(", ")", ")", ".", "isEqualTo", "(", "Optional", ".", "of", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "registersACustomNameOfHealthCheckAndDBPoolMetrics", "(", ")", "throws", "Exception", "{", "final", "String", "name", "=", "\"", "<STR_LIT>", "\"", ";", "final", "HibernateBundle", "<", "Configuration", ">", "customBundle", "=", "new", "HibernateBundle", "<", "Configuration", ">", "(", "entities", ",", "factory", ")", "{", "@", "Override", "public", "DataSourceFactory", "getDataSourceFactory", "(", "Configuration", "configuration", ")", "{", "return", "dbConfig", ";", "}", "@", "Override", "public", "DataSourceFactory", "getReadSourceFactory", "(", "Configuration", "configuration", ")", "{", "return", "readConfig", ";", "}", "@", "Override", "protected", "String", "name", "(", ")", "{", "return", "name", ";", "}", "}", ";", "when", "(", "factory", ".", "build", "(", "eq", "(", "customBundle", ")", ",", "any", "(", "Environment", ".", "class", ")", ",", "any", "(", "DataSourceFactory", ".", "class", ")", ",", "anyList", "(", ")", ",", "eq", "(", "name", "+", "PRIMARY", ")", ")", ")", ".", "thenReturn", "(", "sessionFactory", ")", ";", "when", "(", "factory", ".", "build", "(", "eq", "(", "customBundle", ")", ",", "any", "(", "Environment", ".", "class", ")", ",", "any", "(", "DataSourceFactory", ".", "class", ")", ",", "anyList", "(", ")", ",", "eq", "(", "name", "+", "READER", ")", ")", ")", ".", "thenReturn", "(", "readFactory", ")", ";", "customBundle", ".", "run", "(", "configuration", ",", "environment", ")", ";", "final", "ArgumentCaptor", "<", "SessionFactoryHealthCheck", ">", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "SessionFactoryHealthCheck", ".", "class", ")", ";", "verify", "(", "healthChecks", ")", ".", "register", "(", "eq", "(", "name", "+", "READER", ")", ",", "captor", ".", "capture", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "String", "name", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "hasASessionFactory", "(", ")", "throws", "Exception", "{", "bundle", ".", "run", "(", "configuration", ",", "environment", ")", ";", "assertThat", "(", "bundle", ".", "getSessionFactory", "(", ")", ")", ".", "isInstanceOf", "(", "DualSessionFactory", ".", "class", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isDefaultLocaleEnglish", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "Locale", ".", "getDefault", "(", ")", ".", "getLanguage", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "@", "EnabledIf", "(", "\"", "<STR_LIT>", "\"", ")", "@", "EnabledOnOs", "(", "OS", ".", "LINUX", ")", "void", "testOsTcpBackloc", "(", ")", "{", "assertThat", "(", "NetUtil", ".", "getTcpBacklog", "(", "-", "1", ")", ")", ".", "isNotEqualTo", "(", "-", "1", ")", ";", "assertThat", "(", "NetUtil", ".", "getTcpBacklog", "(", ")", ")", ".", "as", "(", "\"", "<STR_LIT>", "\"", ")", ".", "isGreaterThan", "(", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "private", "static", "List", "<", "File", ">", "getRootPaths", "(", "FileSystem", "fileSystem", ")", "{", "List", "<", "File", ">", "rootPaths", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "fileSystem", ".", "getRootDirectories", "(", ")", ".", "forEach", "(", "path", "-", ">", "rootPaths", ".", "add", "(", "path", ".", "toFile", "(", ")", ")", ")", ";", "try", "{", "rootPaths", ".", "add", "(", "new", "File", "(", "CloseableLiquibase", ".", "class", ".", "getProtectionDomain", "(", ")", ".", "getCodeSource", "(", ")", ".", "getLocation", "(", ")", ".", "toURI", "(", ")", ")", ")", ";", "}", "catch", "(", "Exception", "ignored", ")", "{", "}", "return", "rootPaths", ";", "}", "</s>"]
["<s>", "static", "void", "inject", "(", "InjectionManager", "injectionManager", ",", "ContainerRequestFilter", "filter", ")", "{", "injectionManager", ".", "inject", "(", "filter", ")", ";", "if", "(", "filter", "instanceof", "AuthFilter", ")", "{", "AuthFilter", "<", "?", ",", "?", ">", "authFilter", "=", "(", "AuthFilter", "<", "?", ",", "?", ">", ")", "filter", ";", "if", "(", "authFilter", ".", "authenticator", "!", "=", "null", ")", "{", "injectionManager", ".", "inject", "(", "authFilter", ".", "authenticator", ")", ";", "}", "if", "(", "authFilter", ".", "authorizer", "!", "=", "null", ")", "{", "injectionManager", ".", "inject", "(", "authFilter", ".", "authorizer", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Optional", "<", "Principal", ">", "authenticate", "(", "String", "credentials", ")", "throws", "AuthenticationException", "{", "if", "(", "headers", "!", "=", "null", ")", "{", "String", "username", "=", "headers", ".", "getHeaderString", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "Optional", ".", "of", "(", "(", ")", "-", ">", "username", ")", ";", "}", "else", "{", "throw", "new", "AuthenticationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "authorize", "(", "Principal", "principal", ",", "String", "role", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "authorize", "(", "Principal", "principal", ",", "String", "role", ",", "@", "Nullable", "ContainerRequestContext", "requestContext", ")", "{", "if", "(", "headers", "!", "=", "null", ")", "{", "String", "allowedRole", "=", "headers", ".", "getHeaderString", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "allowedRole", ".", "equals", "(", "role", ")", ";", "}", "else", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "filter", "(", "ContainerRequestContext", "requestContext", ")", "throws", "IOException", "{", "if", "(", "!", "authenticate", "(", "requestContext", ",", "\"", "<STR_LIT>", "\"", ",", "SecurityContext", ".", "BASIC_AUTH", ")", ")", "{", "throw", "new", "WebApplicationException", "(", "Response", ".", "status", "(", "Response", ".", "Status", ".", "UNAUTHORIZED", ")", ".", "build", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "void", "testInjectionSupport", "(", ")", "{", "String", "req1User", "=", "\"", "<STR_LIT:1>", "\"", ";", "String", "req2User", "=", "\"", "<STR_LIT:2>", "\"", ";", "WebTarget", "target", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ";", "String", "response1", "=", "target", ".", "request", "(", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "req1User", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", "String", ".", "class", ")", ";", "String", "response2", "=", "target", ".", "request", "(", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "req2User", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", "String", ".", "class", ")", ";", "Response", "response3", "=", "target", ".", "request", "(", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "req1User", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "Response", "response4", "=", "target", ".", "request", "(", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "req2User", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ".", "get", "(", ")", ";", "assertThat", "(", "response1", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "req1User", ")", ";", "assertThat", "(", "response2", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "req2User", ")", ";", "assertThat", "(", "response3", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "response4", ".", "getStatus", "(", ")", ")", ".", "isEqualTo", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "filter", "(", "ContainerRequestContext", "requestContext", ")", "throws", "IOException", "{", "if", "(", "headers", "!", "=", "null", ")", "{", "String", "username", "=", "headers", ".", "getHeaderString", "(", "\"", "<STR_LIT>", "\"", ")", ";", "requestContext", ".", "setSecurityContext", "(", "new", "SecurityContext", "(", ")", "{", "@", "Override", "public", "Principal", "getUserPrincipal", "(", ")", "{", "return", "(", ")", "-", ">", "username", ";", "}", "@", "Override", "public", "boolean", "isUserInRole", "(", "String", "role", ")", "{", "return", "false", ";", "}", "@", "Override", "public", "boolean", "isSecure", "(", ")", "{", "return", "false", ";", "}", "@", "Override", "public", "String", "getAuthenticationScheme", "(", ")", "{", "return", "\"", "\"", ";", "}", "}", ")", ";", "}", "else", "{", "requestContext", ".", "abortWith", "(", "Response", ".", "serverError", "(", ")", ".", "entity", "(", "\"", "<STR_LIT>", "\"", ")", ".", "build", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Principal", "getUserPrincipal", "(", ")", "{", "return", "(", ")", "-", ">", "username", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isUserInRole", "(", "String", "role", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isSecure", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAuthenticationScheme", "(", ")", "{", "return", "\"", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "ContainerRequestFilter", "getAuthFilter", "(", ")", "{", "return", "new", "TestInjectableAuthenticationFilter", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "testInjectionSupport", "(", ")", "{", "String", "req1User", "=", "\"", "<STR_LIT:1>", "\"", ";", "String", "req2User", "=", "\"", "<STR_LIT:2>", "\"", ";", "WebTarget", "target", "=", "target", "(", "\"", "<STR_LIT>", "\"", ")", ";", "String", "response1", "=", "target", ".", "request", "(", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "req1User", ")", ".", "get", "(", "String", ".", "class", ")", ";", "String", "response2", "=", "target", ".", "request", "(", ")", ".", "header", "(", "\"", "<STR_LIT>", "\"", ",", "req2User", ")", ".", "get", "(", "String", ".", "class", ")", ";", "assertThat", "(", "response1", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "req1User", ")", ";", "assertThat", "(", "response2", ")", ".", "isEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "req2User", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "void", "objectMapperRegistersAfterburnerButNotBlackbird", "(", ")", "{", "assertThat", "(", "Jackson", ".", "newObjectMapper", "(", ")", ".", "getRegisteredModuleIds", "(", ")", ")", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ".", "doesNotContain", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "void", "acceptsNull", "(", ")", "{", "example", ".", "nullablePort", "=", "null", ";", "assertThat", "(", "ConstraintViolations", ".", "format", "(", "validator", ".", "validate", "(", "example", ")", ")", ")", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "public", "java", ".", "time", ".", "Duration", "toJavaDuration", "(", ")", "{", "return", "java", ".", "time", ".", "Duration", ".", "ofNanos", "(", "toNanoseconds", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ParameterizedTest", "@", "CsvSource", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "void", "convertsToJavaDuration", "(", "String", "durationSpec", ",", "long", "amount", ",", "ChronoUnit", "unit", ")", "{", "Duration", "duration", "=", "Duration", ".", "parse", "(", "durationSpec", ")", ";", "assertThat", "(", "duration", ".", "toJavaDuration", "(", ")", ")", ".", "isEqualTo", "(", "java", ".", "time", ".", "Duration", ".", "of", "(", "amount", ",", "unit", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "ErrorMessage", "generateErrorMessage", "(", "@", "Nullable", "String", "input", ",", "Exception", "e", ")", "{", "final", "Response", "response", "=", "error", "(", "input", ",", "e", ")", ";", "if", "(", "response", "!", "=", "null", ")", "{", "throw", "new", "WebApplicationException", "(", "response", ")", ";", "}", "LOGGER", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "input", ")", ";", "String", "errorMessage", "=", "errorMessage", "(", "e", ")", ";", "if", "(", "errorMessage", ".", "contains", "(", "\"", "<STR_LIT:%s>", "\"", ")", ")", "{", "errorMessage", "=", "String", ".", "format", "(", "errorMessage", ",", "parameterName", ")", ";", "}", "return", "new", "ErrorMessage", "(", "getErrorStatus", "(", ")", ".", "getStatusCode", "(", ")", ",", "errorMessage", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "configure", "(", ")", "{", "this", ".", "bind", "(", "new", "LoggingExceptionMapper", "<", "Throwable", ">", "(", ")", "{", "}", ")", ".", "to", "(", "ExceptionMapper", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "RuntimeType", "Object", "invoke", "(", "@", "Origin", "Method", "overridden", ",", "@", "SuperCall", "Callable", "<", "Object", ">", "proxy", ")", "throws", "Throwable", "{", "final", "UnitOfWork", "[", "]", "unitsOfWork", "=", "overridden", ".", "getAnnotationsByType", "(", "UnitOfWork", ".", "class", ")", ";", "if", "(", "unitsOfWork", ".", "length", "=", "=", "0", ")", "{", "return", "proxy", ".", "call", "(", ")", ";", "}", "final", "Map", "<", "UnitOfWork", ",", "UnitOfWorkAspect", ">", "unitOfWorkAspectMap", ";", "if", "(", "unitsOfWork", ".", "length", "=", "=", "1", ")", "{", "unitOfWorkAspectMap", "=", "Collections", ".", "singletonMap", "(", "unitsOfWork", "[", "0", "]", ",", "newAspect", "(", "sessionFactories", ")", ")", ";", "}", "else", "{", "unitOfWorkAspectMap", "=", "new", "HashMap", "<", ">", "(", ")", ";", "Arrays", ".", "stream", "(", "unitsOfWork", ")", ".", "collect", "(", "Collectors", ".", "toMap", "(", "UnitOfWork", ":", ":", "value", ",", "Function", ".", "identity", "(", ")", ",", "(", "first", ",", "second", ")", "-", ">", "second", ")", ")", ".", "values", "(", ")", ".", "forEach", "(", "unitOfWork", "-", ">", "unitOfWorkAspectMap", ".", "put", "(", "unitOfWork", ",", "newAspect", "(", "sessionFactories", ")", ")", ")", ";", "}", "try", "{", "unitOfWorkAspectMap", ".", "forEach", "(", "(", "unitOfWork", ",", "unitOfWorkAspect", ")", "-", ">", "unitOfWorkAspect", ".", "beforeStart", "(", "unitOfWork", ")", ")", ";", "Object", "result", "=", "proxy", ".", "call", "(", ")", ";", "unitOfWorkAspectMap", ".", "values", "(", ")", ".", "forEach", "(", "UnitOfWorkAspect", ":", ":", "afterEnd", ")", ";", "return", "result", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "unitOfWorkAspectMap", ".", "values", "(", ")", ".", "forEach", "(", "UnitOfWorkAspect", ":", ":", "onError", ")", ";", "throw", "e", ".", "getCause", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "unitOfWorkAspectMap", ".", "values", "(", ")", ".", "forEach", "(", "UnitOfWorkAspect", ":", ":", "onError", ")", ";", "throw", "e", ";", "}", "finally", "{", "unitOfWorkAspectMap", ".", "values", "(", ")", ".", "forEach", "(", "UnitOfWorkAspect", ":", ":", "onFinish", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "configureJMX", "(", ")", "{", "try", "{", "Class", ".", "forName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "return", ";", "}", "final", "MBeanServer", "server", "=", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ";", "MBEAN_REGISTRATION_LOCK", ".", "lock", "(", ")", ";", "try", "{", "final", "ObjectName", "objectName", "=", "new", "ObjectName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "!", "server", ".", "isRegistered", "(", "objectName", ")", ")", "{", "server", ".", "registerMBean", "(", "new", "JMXConfigurator", "(", "loggerContext", ",", "server", ",", "objectName", ")", ",", "objectName", ")", ";", "}", "}", "catch", "(", "MalformedObjectNameException", "|", "InstanceAlreadyExistsException", "|", "NotCompliantMBeanException", "|", "MBeanRegistrationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "finally", "{", "MBEAN_REGISTRATION_LOCK", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
