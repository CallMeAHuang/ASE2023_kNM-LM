["<s>", "public", "long", "getMaxStaleReadMillis", "(", ")", "{", "assertDuringInitialization", "(", ")", ";", "return", "maxStaleReadMillis", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "void", "setMaxStaleReadMillis", "(", "long", "maxStaleReadMillis", ")", "{", "this", ".", "maxStaleReadMillis", "=", "maxStaleReadMillis", ";", "}", "</s>"]
["<s>", "private", "void", "setOwnerClockPut", "(", "short", "owner", ",", "OwnerClock", "oc", ",", "long", "clock", ")", "{", "for", "(", ";", ";", ")", "{", "final", "long", "current", "=", "oc", ".", "lastPut", ".", "get", "(", ")", ";", "if", "(", "clock", "<", "=", "current", ")", "break", ";", "if", "(", "oc", ".", "lastPut", ".", "compareAndSet", "(", "current", ",", "clock", ")", ")", "{", "if", "(", "owner", ">", "=", "0", ")", "{", "monitor", ".", "addStalePurge", "(", "oc", ".", "invCounter", ".", "get", "(", ")", ")", ";", "oc", ".", "invCounter", ".", "set", "(", "0", ")", ";", "}", "else", "{", "int", "count", "=", "0", ";", "for", "(", "OwnerClock", "oc1", ":", "ownerClocks", ".", "values", "(", ")", ")", "{", "count", "+", "=", "oc1", ".", "invCounter", ".", "get", "(", ")", ";", "oc1", ".", "invCounter", ".", "set", "(", "0", ")", ";", "}", "monitor", ".", "addStalePurge", "(", "count", ")", ";", "}", "break", ";", "}", "}", "}", "</s>"]
["<s>", "private", "Object", "handleOpInvoke", "(", "CacheLine", "line", ",", "Object", "data", ",", "short", "nodeHint", ",", "int", "lineChange", ")", "{", "if", "(", "(", "lineChange", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "if", "(", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "send", "(", "Message", ".", "INVOKE", "(", "getTarget", "(", "line", ",", "nodeHint", ")", ",", "line", ".", "id", ",", "data", ")", ")", ";", "return", "PENDING", ";", "}", "else", "{", "if", "(", "!", "transitionToE", "(", "line", ",", "nodeHint", ")", ")", "return", "PENDING", ";", "Store", ".", "InvokeOnLine", "iol", "=", "(", "Store", ".", "InvokeOnLine", ")", "data", ";", "byte", "[", "]", "readData", "=", "readData", "(", "line", ")", ";", "ByteBuffer", "bb", "=", "ByteBuffer", ".", "wrap", "(", "readData", ")", ";", "Object", "invoke", "=", "iol", ".", "invoke", "(", "bb", ")", ";", "setData", "(", "line", ",", "bb", ",", "null", ")", ";", "return", "invoke", ";", "}", "}", "</s>"]
["<s>", "private", "int", "handleMessageInvRes", "(", "INVRES", "msg", ",", "CacheLine", "line", ")", "{", "Op", "invokeOp", "=", "null", ";", "final", "Collection", "<", "Op", ">", "pending", "=", "getPendingOps", "(", "line", ")", ";", "for", "(", "Iterator", "<", "Op", ">", "it", "=", "pending", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Op", "op", "=", "it", ".", "next", "(", ")", ";", "if", "(", "op", ".", "type", "=", "=", "Op", ".", "Type", ".", "INVOKE", ")", "{", "if", "(", "msg", ".", "getLine", "(", ")", "=", "=", "op", ".", "line", ")", "{", "invokeOp", "=", "op", ";", "break", ";", "}", "}", "}", "if", "(", "invokeOp", "!", "=", "null", ")", "{", "completeOp", "(", "line", ",", "invokeOp", ",", "msg", ".", "getResult", "(", ")", ",", "true", ")", ";", "removePendingOp", "(", "line", ",", "invokeOp", ")", ";", "}", "return", "LINE_NO_CHANGE", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageInvoke", "(", "Message", ".", "INVOKE", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "if", "(", "handleNotOwner", "(", "msg", ",", "line", ")", ")", "return", "LINE_NO_CHANGE", ";", "relevantStates", "(", "line", ",", "State", ".", "E", ",", "State", ".", "O", ")", ";", "if", "(", "!", "transitionToE", "(", "line", ",", "(", "short", ")", "-", "1", ")", ")", "{", "addPendingMessage", "(", "line", ",", "msg", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "Store", ".", "InvokeOnLine", "iol", "=", "(", "Store", ".", "InvokeOnLine", ")", "msg", ".", "getFunction", "(", ")", ";", "byte", "[", "]", "readData", "=", "readData", "(", "line", ")", ";", "ByteBuffer", "bb", "=", "ByteBuffer", ".", "wrap", "(", "readData", ")", ";", "Object", "invokeRes", "=", "iol", ".", "invoke", "(", "bb", ")", ";", "setData", "(", "line", ",", "bb", ",", "null", ")", ";", "send", "(", "Message", ".", "INVRES", "(", "msg", ",", "line", ".", "id", ",", "invokeRes", ")", ")", ";", "return", "LINE_EVERYTHING_CHANGED", ";", "}", "</s>"]
["<s>", "private", "boolean", "handleMessageInvoke", "(", "LineMessage", "msg", ")", "{", "return", "handleMessageGet", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "public", "static", "INVOKE", "INVOKE", "(", "short", "node", ",", "long", "line", ",", "Object", "data", ")", "{", "try", "{", "return", "new", "INVOKE", "(", "Type", ".", "INVOKE", ",", "node", ",", "line", ",", "data", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "Logger", ".", "getLogger", "(", "Message", ".", "class", ".", "getName", "(", ")", ")", ".", "log", "(", "Level", ".", "SEVERE", ",", "null", ",", "ex", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "static", "INVRES", "INVRES", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "Object", "result", ")", "{", "try", "{", "return", "new", "INVRES", "(", "responseTo", ",", "line", ",", "result", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "Logger", ".", "getLogger", "(", "Message", ".", "class", ".", "getName", "(", ")", ")", ".", "log", "(", "Level", ".", "SEVERE", ",", "null", ",", "ex", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "Object", "getFunction", "(", ")", "{", "try", "(", "ByteArrayInputStream", "bis", "=", "new", "ByteArrayInputStream", "(", "function", ")", ";", "ObjectInput", "in", "=", "new", "ObjectInputStream", "(", "bis", ")", ")", "{", "return", "(", "Object", ")", "in", ".", "readObject", "(", ")", ";", "}", "catch", "(", "ClassNotFoundException", "|", "IOException", "ex", ")", "{", "Logger", ".", "getLogger", "(", "Message", ".", "class", ".", "getName", "(", ")", ")", ".", "log", "(", "Level", ".", "SEVERE", ",", "null", ",", "ex", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "Object", "getResult", "(", ")", "{", "try", "(", "ByteArrayInputStream", "bis", "=", "new", "ByteArrayInputStream", "(", "result", ")", ";", "ObjectInput", "in", "=", "new", "ObjectInputStream", "(", "bis", ")", ")", "{", "return", "(", "Object", ")", "in", ".", "readObject", "(", ")", ";", "}", "catch", "(", "ClassNotFoundException", "|", "IOException", "ex", ")", "{", "Logger", ".", "getLogger", "(", "Message", ".", "class", ".", "getName", "(", ")", ")", ".", "log", "(", "Level", ".", "SEVERE", ",", "null", ",", "ex", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "Object", "execInvoke", "(", "final", "CacheLine", "line", ",", "InvokeOnLine", "iol", ")", "{", "return", "iol", ".", "invoke", "(", "new", "Store", ".", "LineAccess", "(", ")", "{", "@", "Override", "public", "ByteBuffer", "getForRead", "(", ")", "{", "return", "line", ".", "getData", "(", ")", ".", "asReadOnlyBuffer", "(", ")", ";", "}", "@", "Override", "public", "ByteBuffer", "getForWrite", "(", "int", "size", ")", "{", "allocateLineData", "(", "line", ",", "size", ")", ";", "line", ".", "version", "+", "+", ";", "line", ".", "set", "(", "CacheLine", ".", "MODIFIED", ",", "true", ")", ";", "return", "line", ".", "getData", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "public", "static", "INVOKE", "INVOKE", "(", "short", "node", ",", "long", "line", ",", "InvokeOnLine", "data", ")", "{", "return", "new", "INVOKE", "(", "Type", ".", "INVOKE", ",", "node", ",", "line", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Store", ".", "InvokeOnLine", "<", "Long", ">", "storefunc", "(", "final", "long", "set", ")", "{", "return", "new", "Store", ".", "InvokeOnLine", "<", "Long", ">", "(", ")", "{", "@", "Override", "public", "Long", "invoke", "(", "LineAccess", "lineAccess", ")", "{", "try", "{", "ByteBuffer", "get", "=", "lineAccess", ".", "getForRead", "(", ")", ";", "if", "(", "!", "Charset", ".", "forName", "(", "\"", "<STR_LIT>", "\"", ")", ".", "newDecoder", "(", ")", ".", "decode", "(", "get", ")", ".", "toString", "(", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "return", "0", "L", ";", "ByteBuffer", "bb", "=", "lineAccess", ".", "getForWrite", "(", "<NUM_LIT:8>", ")", ";", "bb", ".", "putLong", "(", "set", ")", ";", "bb", ".", "flip", "(", ")", ";", "return", "set", ";", "}", "catch", "(", "CharacterCodingException", "ex", ")", "{", "Logger", ".", "getLogger", "(", "CacheTest", ".", "class", ".", "getName", "(", ")", ")", ".", "log", "(", "Level", ".", "SEVERE", ",", "null", ",", "ex", ")", ";", "}", "return", "0", "L", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenInvokeLocalAndOThenInvokeAndSendINVAndBecomeE", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "long", "l", "=", "(", "Long", ")", "cache", ".", "doOp", "(", "Op", ".", "Type", ".", "INVOKE", ",", "<NUM_LIT>", ",", "storefunc", "(", "<NUM_LIT>", ")", ",", "null", ",", "null", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "E", ")", ";", "assertThat", "(", "l", ",", "equalTo", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvokeNotOwnerInI", "(", ")", "throws", "Exception", "{", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "final", "InvokeOnLine", "<", "Long", ">", "storefunc", "=", "storefunc", "(", "<NUM_LIT>", ")", ";", "ListenableFuture", "<", "Object", ">", "future", "=", "cache", ".", "doOpAsync", "(", "Op", ".", "Type", ".", "INVOKE", ",", "<NUM_LIT>", ",", "storefunc", ",", "null", ",", "null", ")", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "storefunc", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "msg", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "I", ",", "null", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVRES", "(", "msg", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "(", "long", ")", "future", ".", "get", "(", ")", ",", "equalTo", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvokeNotOwnerInS", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "InvokeOnLine", "<", "Long", ">", "storefunc", "=", "storefunc", "(", "<NUM_LIT>", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "S", ",", "null", ")", ";", "ListenableFuture", "<", "Object", ">", "future", "=", "cache", ".", "doOpAsync", "(", "Op", ".", "Type", ".", "INVOKE", ",", "<NUM_LIT>", ",", "storefunc", ",", "null", ",", "null", ")", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "storefunc", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "msg", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "S", ",", "null", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVRES", "(", "msg", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "(", "long", ")", "future", ".", "get", "(", ")", ",", "equalTo", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvokeWhenServerIsOwner", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "InvokeOnLine", "<", "Long", ">", "storefunc", "=", "storefunc", "(", "<NUM_LIT>", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "S", ",", "null", ")", ";", "ListenableFuture", "<", "Object", ">", "future", "=", "cache", ".", "doOpAsync", "(", "Op", ".", "Type", ".", "INVOKE", ",", "<NUM_LIT>", ",", "storefunc", ",", "null", ",", "null", ")", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "storefunc", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "msg", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "S", ",", "null", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "assertThat", "(", "(", "long", ")", "future", ".", "get", "(", ")", ",", "equalTo", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInvokeLocalWhenOwnerIsE", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "long", "l", "=", "(", "Long", ")", "cache", ".", "doOp", "(", "Op", ".", "Type", ".", "INVOKE", ",", "<NUM_LIT>", ",", "storefunc", "(", "<NUM_LIT>", ")", ",", "null", ",", "null", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "assertThat", "(", "l", ",", "equalTo", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHandleInvokeWhenE", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "final", "InvokeOnLine", "<", "Long", ">", "storefunc", "=", "storefunc", "(", "<NUM_LIT>", ")", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "storefunc", ")", ";", "cache", ".", "receive", "(", "msg", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INVRES", "(", "msg", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testHandleInvokeWhenO", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "final", "InvokeOnLine", "<", "Long", ">", "storefunc", "=", "storefunc", "(", "<NUM_LIT>", ")", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "storefunc", ")", ";", "cache", ".", "receive", "(", "msg", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "E", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INVRES", "(", "msg", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "void", "INVOKE", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "InvokeOnLine", "function", ")", "{", "cache", ".", "receive", "(", "Message", ".", "INVOKE", "(", "owner", ",", "id", ",", "function", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetxAndCHNGD_OWNRToYou", "(", ")", "throws", "Exception", "{", "ListenableFuture", "<", "Object", ">", "future", "=", "cache", ".", "doOpAsync", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ",", "null", ",", "null", ")", ";", "LineMessage", "msg", "=", "(", "LineMessage", ")", "captureMessage", "(", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "true", ")", ")", ";", "assertThat", "(", "future", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "PUTX", "(", "msg", ",", "<NUM_LIT>", ",", "null", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "assertThat", "(", "future", ".", "isDone", "(", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "deserialize", "(", "future", ".", "get", "(", ")", ")", ",", "equalTo", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSendToOwnerOfAndCHNGD_OWNRToYou", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "true", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "true", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "TIMEOUT", "(", "msg", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "PUTX", "(", "msg", ",", "<NUM_LIT>", ",", "null", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "true", ")", ")", ";", "try", "{", "send", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "InterruptedException", "|", "ExecutionException", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "TimeoutException", ".", "class", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "init", "(", "DistributedTree", "tree", ",", "final", "String", "branchRoot", ",", "boolean", "ordered", ")", "{", "synchronized", "(", "nodes", ")", "{", "final", "List", "<", "String", ">", "children", "=", "tree", ".", "getChildren", "(", "branchRoot", ")", ";", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "children", ")", ";", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "tree", ".", "getChildren", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "tree", ".", "getChildren", "(", "branchRoot", ")", ")", ";", "if", "(", "children", "!", "=", "null", ")", "{", "for", "(", "String", "nodeName", ":", "children", ")", "nodeAdded", "(", "nodeName", ")", ";", "}", "if", "(", "ordered", ")", "{", "final", "Node", "first", "=", "getFirstNode", "(", ")", ";", "if", "(", "first", "!", "=", "null", ")", "first", ".", "predecessorsComplete", "(", ")", ";", "}", "doneInit", "=", "true", ";", "}", "}", "</s>"]
["<s>", "private", "void", "finish_leader_added", "(", "final", "NodeInfoImpl", "node", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getName", "(", ")", ",", "nodes", ")", ";", "final", "NodeInfoImpl", "nodesMaster", "=", "findMaster", "(", "node", ".", "getNodeId", "(", ")", ",", "null", ")", ";", "final", "boolean", "nodeIsServer", "=", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "0", ")", ";", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "myId", ")", "{", "if", "(", "isMe", "(", "node", ")", ")", "{", "this", ".", "master", "=", "(", "node", "=", "=", "nodesMaster", ")", ";", "if", "(", "!", "this", ".", "master", ")", "assert", "this", ".", "myMaster", "=", "=", "nodesMaster", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "myId", ",", "this", ".", "master", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ",", "this", ".", "master", "?", "\"", "\"", ":", "\"", "<STR_LIT>", "\"", "+", "nodesMaster", "}", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "setOnline", "(", "true", ")", ";", "}", "else", "if", "(", "node", "=", "=", "nodesMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "this", ".", "myMaster", "=", "node", ";", "masters", ".", "put", "(", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "}", "else", "if", "(", "online", "&", "&", "this", ".", "master", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "mySlaves", ".", "add", "(", "node", ")", ";", "fireSlaveAdded", "(", "node", ")", ";", "}", "}", "else", "if", "(", "node", "=", "=", "nodesMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "final", "boolean", "switchover", "=", "masters", ".", "containsKey", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "masters", ".", "put", "(", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "if", "(", "nodeIsServer", ")", "{", "this", ".", "server", "=", "node", ";", "}", "if", "(", "switchover", ")", "{", "fireNodeSwitched", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "else", "{", "activeNodes", ".", "add", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "fireNodeAdded", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "}", "else", "{", "if", "(", "nodeIsServer", ")", "slaveServers", ".", "add", "(", "node", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "finishLeaderAdded", "(", "final", "NodeInfoImpl", "node", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getName", "(", ")", ")", ";", "final", "NodeInfoImpl", "nodesMaster", "=", "findMaster", "(", "node", ".", "getNodeId", "(", ")", ",", "null", ")", ";", "final", "boolean", "nodeIsServer", "=", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "0", ")", ";", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "myId", ")", "{", "if", "(", "isMe", "(", "node", ")", ")", "{", "this", ".", "master", "=", "(", "node", "=", "=", "nodesMaster", ")", ";", "if", "(", "!", "this", ".", "master", ")", "assert", "this", ".", "myMaster", "=", "=", "nodesMaster", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "myId", ",", "this", ".", "master", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ",", "this", ".", "master", "?", "\"", "\"", ":", "\"", "<STR_LIT>", "\"", "+", "nodesMaster", "}", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "setOnline", "(", "true", ")", ";", "}", "else", "if", "(", "node", "=", "=", "nodesMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "this", ".", "myMaster", "=", "node", ";", "masters", ".", "put", "(", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "}", "else", "if", "(", "online", "&", "&", "this", ".", "master", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "mySlaves", ".", "add", "(", "node", ")", ";", "fireSlaveAdded", "(", "node", ")", ";", "}", "}", "else", "if", "(", "node", "=", "=", "nodesMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "final", "boolean", "switchover", "=", "masters", ".", "containsKey", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "masters", ".", "put", "(", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "if", "(", "nodeIsServer", ")", "{", "this", ".", "server", "=", "node", ";", "}", "if", "(", "switchover", ")", "{", "fireNodeSwitched", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "else", "{", "activeNodes", ".", "add", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "fireNodeAdded", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "}", "else", "{", "if", "(", "nodeIsServer", ")", "slaveServers", ".", "add", "(", "node", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "Void", ">", "sendToOwnerOfAsync", "(", "long", "line", ",", "Msg", "msg", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "Long", ".", "toHexString", "(", "line", ")", ",", "msg", ")", ";", "final", "LineMessage", "message", "=", "Message", ".", "MSG", "(", "(", "short", ")", "-", "1", ",", "line", ",", "Streamables", ".", "toByteArray", "(", "msg", ")", ")", ";", "return", "(", "ListenableFuture", "<", "Void", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "Type", ".", "SEND", ",", "line", ",", "null", ",", "message", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "static", "MetricRegistry", "registry", "(", ")", "{", "return", "metrics", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", "extends", "Metric", ">", "T", "register", "(", "String", "name", ",", "T", "metric", ")", "throws", "IllegalArgumentException", "{", "return", "metrics", ".", "register", "(", "name", ",", "metric", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "registerAll", "(", "MetricSet", "ms", ")", "throws", "IllegalArgumentException", "{", "metrics", ".", "registerAll", "(", "ms", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Counter", "counter", "(", "String", "name", ")", "{", "return", "metrics", ".", "counter", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Histogram", "histogram", "(", "String", "name", ")", "{", "return", "metrics", ".", "histogram", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Meter", "meter", "(", "String", "name", ")", "{", "return", "metrics", ".", "meter", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Timer", "timer", "(", "String", "name", ")", "{", "return", "metrics", ".", "timer", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "remove", "(", "String", "name", ")", "{", "return", "metrics", ".", "remove", "(", "name", ")", ";", "}", "</s>"]
["<s>", "protected", "final", "String", "metric", "(", "String", "name", ")", "{", "return", "MetricRegistry", ".", "name", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "</s>"]
["<s>", "protected", "final", "String", "metric", "(", "String", "name", ")", "{", "return", "name", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "</s>"]
["<s>", "protected", "final", "String", "metric", "(", "String", "name", ")", "{", "return", "MetricRegistry", ".", "name", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testSecondSlaveSwitchover", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "MY_ID", ")", ";", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:4>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:5>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:6>", "\"", ",", "MY_ID", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "false", ")", ";", "assertThat", "(", "cluster", ".", "getMyMaster", "(", ")", ".", "getName", "(", ")", ",", "is", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "Collections", ".", "EMPTY_LIST", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "slaveListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "slaveListener", ")", ".", "newMaster", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "assertThat", "(", "cluster", ".", "getMyMaster", "(", ")", ".", "getName", "(", ")", ",", "is", "(", "\"", "<STR_LIT:3>", "\"", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "Collections", ".", "EMPTY_LIST", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:3>", "\"", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "switchToMaster", "(", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:4>", "\"", ")", ")", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:5>", "\"", ")", ")", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:6>", "\"", ")", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "list", "(", "\"", "<STR_LIT:4>", "\"", ",", "\"", "<STR_LIT:5>", "\"", ",", "\"", "<STR_LIT:6>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setCommMsgCounter", "(", ")", "throws", "NodeNotFoundException", "{", "doAnswer", "(", "new", "Answer", "<", "Void", ">", "(", ")", "{", "@", "Override", "public", "Void", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Message", "msg", "=", "(", "Message", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "msg", ")", ";", "if", "(", "msg", ".", "getMessageId", "(", ")", "<", "0", ")", "msg", ".", "setMessageId", "(", "+", "+", "messageId", ")", ";", "return", "null", ";", "}", "}", ")", ".", "when", "(", "comm", ")", ".", "send", "(", "any", "(", "Message", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "remove", "(", "String", "ROOT", ",", "String", "child1", ")", "{", "tree", ".", "delete", "(", "ROOT", "+", "SEP", "+", "child1", ")", ";", "}", "</s>"]
["<s>", "private", "void", "add", "(", "String", "ROOT", ",", "String", "child1", ")", "{", "tree", ".", "create", "(", "ROOT", "+", "SEP", "+", "child1", ",", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "add", "(", "String", "ROOT", ",", "String", "child2", ",", "String", "a", ")", "{", "tree", ".", "create", "(", "ROOT", "+", "SEP", "+", "child2", "+", "SEP", "+", "a", ",", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "set", "(", "String", "ROOT", ",", "String", "child0", ",", "String", "a", ",", "String", "a0", ")", "{", "tree", ".", "set", "(", "ROOT", "+", "SEP", "+", "child0", "+", "SEP", "+", "a", ",", "a0", ".", "getBytes", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Throwable", "unwrap", "(", "Throwable", "t", ")", "{", "if", "(", "t", "=", "=", "null", ")", "throw", "new", "NullPointerException", "(", ")", ";", "if", "(", "t", "instanceof", "ExecutionException", ")", "return", "unwrap", "(", "t", ".", "getCause", "(", ")", ")", ";", "if", "(", "t", ".", "getClass", "(", ")", ".", "equals", "(", "RuntimeException", ".", "class", ")", "&", "&", "t", ".", "getCause", "(", ")", "!", "=", "null", ")", "return", "unwrap", "(", "t", ".", "getCause", "(", ")", ")", ";", "return", "t", ";", "}", "</s>"]
["<s>", "static", "public", "RuntimeException", "sneakyThrow", "(", "Throwable", "t", ")", "{", "if", "(", "t", "=", "=", "null", ")", "throw", "new", "NullPointerException", "(", ")", ";", "Exceptions", ".", "<", "RuntimeException", ">", "sneakyThrow0", "(", "t", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "@", "SuppressWarnings", "(", "\"", "<STR_LIT>", "\"", ")", "static", "private", "<", "T", "extends", "Throwable", ">", "T", "sneakyThrow0", "(", "Throwable", "t", ")", "throws", "T", "{", "throw", "(", "T", ")", "t", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "mock", "(", "Class", "<", "T", ">", "classToMock", ",", "Answer", "answer", ")", "{", "return", "Mockito", ".", "mock", "(", "classToMock", ",", "answer", ")", ";", "}", "</s>"]
["<s>", "public", "static", "byte", "[", "]", "toByteArray", "(", "ByteBuffer", "bb", ")", "{", "if", "(", "bb", ".", "hasArray", "(", ")", "&", "&", "bb", ".", "arrayOffset", "(", ")", "=", "=", "0", "&", "&", "bb", ".", "position", "(", ")", "=", "=", "0", ")", "{", "return", "bb", ".", "array", "(", ")", ";", "}", "else", "{", "byte", "[", "]", "arr", "=", "new", "byte", "[", "bb", ".", "remaining", "(", ")", "]", ";", "int", "p", "=", "bb", ".", "position", "(", ")", ";", "bb", ".", "get", "(", "arr", ")", ";", "bb", ".", "position", "(", "p", ")", ";", "return", "arr", ";", "}", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "putArray", "(", "ByteBuffer", "bb", ",", "int", "position", ",", "Object", "array", ")", "{", "putArray0", "(", "bb", ",", "position", ",", "array", ")", ";", "return", "bb", ";", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "putArray", "(", "ByteBuffer", "bb", ",", "Object", "array", ")", "{", "int", "p", "=", "bb", ".", "position", "(", ")", ";", "p", "+", "=", "putArray0", "(", "bb", ",", "p", ",", "array", ")", ";", "if", "(", "p", ">", "bb", ".", "limit", "(", ")", ")", "bb", ".", "limit", "(", "p", ")", ";", "bb", ".", "position", "(", "p", ")", ";", "return", "bb", ";", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "getArray", "(", "ByteBuffer", "bb", ",", "int", "position", ",", "Object", "array", ")", "{", "getArray0", "(", "bb", ",", "position", ",", "array", ")", ";", "return", "bb", ";", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "getArray", "(", "ByteBuffer", "bb", ",", "Object", "array", ")", "{", "int", "p", "=", "bb", ".", "position", "(", ")", ";", "p", "+", "=", "getArray0", "(", "bb", ",", "p", ",", "array", ")", ";", "bb", ".", "position", "(", "p", ")", ";", "return", "bb", ";", "}", "</s>"]
["<s>", "private", "static", "int", "putArray0", "(", "ByteBuffer", "bb", ",", "int", "position", ",", "Object", "array", ")", "{", "final", "int", "size", "=", "getArraySize", "(", "array", ")", ";", "if", "(", "bb", ".", "capacity", "(", ")", "-", "position", "<", "size", ")", "throw", "new", "BufferOverflowException", "(", ")", ";", "if", "(", "!", "bb", ".", "isDirect", "(", ")", ")", "unsafe", ".", "copyMemory", "(", "array", ",", "getArrayBase", "(", "array", ")", ",", "bb", ".", "array", "(", ")", ",", "base", "+", "bb", ".", "arrayOffset", "(", ")", "+", "position", ",", "size", ")", ";", "else", "unsafe", ".", "copyMemory", "(", "array", ",", "getArrayBase", "(", "array", ")", ",", "null", ",", "(", "(", "DirectBuffer", ")", "bb", ")", ".", "address", "(", ")", "+", "position", ",", "size", ")", ";", "return", "size", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getArray0", "(", "ByteBuffer", "bb", ",", "int", "position", ",", "Object", "array", ")", "{", "final", "int", "size", "=", "getArraySize", "(", "array", ")", ";", "if", "(", "bb", ".", "limit", "(", ")", "-", "position", "<", "size", ")", "throw", "new", "BufferUnderflowException", "(", ")", ";", "if", "(", "!", "bb", ".", "isDirect", "(", ")", ")", "unsafe", ".", "copyMemory", "(", "bb", ".", "array", "(", ")", ",", "base", "+", "bb", ".", "arrayOffset", "(", ")", "+", "position", ",", "array", ",", "getArrayBase", "(", "array", ")", ",", "size", ")", ";", "else", "unsafe", ".", "copyMemory", "(", "null", ",", "(", "(", "DirectBuffer", ")", "bb", ")", ".", "address", "(", ")", "+", "position", ",", "array", ",", "getArrayBase", "(", "array", ")", ",", "size", ")", ";", "return", "size", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getArrayBase", "(", "Object", "array", ")", "{", "return", "unsafe", ".", "arrayBaseOffset", "(", "array", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getArraySize", "(", "Object", "array", ")", "{", "return", "Array", ".", "getLength", "(", "array", ")", "*", "getArrayScale", "(", "array", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getArrayScale", "(", "Object", "array", ")", "{", "return", "unsafe", ".", "arrayIndexScale", "(", "array", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Unsafe", "getUnsafe1", "(", ")", "{", "if", "(", "UtilUnsafe", ".", "class", ".", "getClassLoader", "(", ")", "=", "=", "null", ")", "return", "Unsafe", ".", "getUnsafe", "(", ")", ";", "try", "{", "Field", "f", "=", "Unsafe", ".", "class", ".", "getDeclaredField", "(", "\"", "<STR_LIT>", "\"", ")", ";", "f", ".", "setAccessible", "(", "true", ")", ";", "return", "(", "Unsafe", ")", "f", ".", "get", "(", "UtilUnsafe", ".", "class", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Unsafe", "getUnsafe", "(", ")", "{", "try", "{", "return", "Unsafe", ".", "getUnsafe", "(", ")", ";", "}", "catch", "(", "SecurityException", "se", ")", "{", "try", "{", "return", "java", ".", "security", ".", "AccessController", ".", "doPrivileged", "(", "new", "java", ".", "security", ".", "PrivilegedExceptionAction", "<", "Unsafe", ">", "(", ")", "{", "@", "Override", "public", "Unsafe", "run", "(", ")", "throws", "Exception", "{", "final", "Class", "<", "sun", ".", "misc", ".", "Unsafe", ">", "k", "=", "sun", ".", "misc", ".", "Unsafe", ".", "class", ";", "if", "(", "true", ")", "{", "final", "Field", "f", "=", "k", ".", "getDeclaredField", "(", "\"", "<STR_LIT>", "\"", ")", ";", "f", ".", "setAccessible", "(", "true", ")", ";", "final", "Object", "x", "=", "f", ".", "get", "(", "null", ")", ";", "return", "k", ".", "cast", "(", "x", ")", ";", "}", "else", "{", "for", "(", "Field", "f", ":", "k", ".", "getDeclaredFields", "(", ")", ")", "{", "f", ".", "setAccessible", "(", "true", ")", ";", "final", "Object", "x", "=", "f", ".", "get", "(", "null", ")", ";", "if", "(", "k", ".", "isInstance", "(", "x", ")", ")", "return", "k", ".", "cast", "(", "x", ")", ";", "}", "throw", "new", "NoSuchFieldError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", ")", ";", "}", "catch", "(", "java", ".", "security", ".", "PrivilegedActionException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Parameterized", ".", "Parameters", "public", "static", "Collection", "<", "Object", "[", "]", ">", "data", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "new", "Object", "[", "]", "[", "]", "{", "{", "false", "}", ",", "{", "true", "}", ",", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "bb", "=", "direct", "?", "ByteBuffer", ".", "allocateDirect", "(", "<NUM_LIT>", ")", ":", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testByteArray", "(", ")", "{", "byte", "[", "]", "array", "=", "new", "byte", "[", "<NUM_LIT:20>", "]", ";", "r", ".", "nextBytes", "(", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT:3>", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT>", ")", ";", "bb", ".", "flip", "(", ")", ";", "byte", "[", "]", "array2", "=", "new", "byte", "[", "array", ".", "length", "]", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "assertThat", "(", "array2", ",", "equalTo", "(", "array", ")", ")", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBooleanArray", "(", ")", "{", "boolean", "[", "]", "array", "=", "new", "boolean", "[", "<NUM_LIT:20>", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "r", ".", "nextBoolean", "(", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT:3>", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT>", ")", ";", "bb", ".", "flip", "(", ")", ";", "boolean", "[", "]", "array2", "=", "new", "boolean", "[", "array", ".", "length", "]", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "assertThat", "(", "array2", ",", "equalTo", "(", "array", ")", ")", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testShortArray", "(", ")", "{", "short", "[", "]", "array", "=", "new", "short", "[", "<NUM_LIT:20>", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "short", ")", "r", ".", "nextInt", "(", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT:3>", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT>", ")", ";", "bb", ".", "flip", "(", ")", ";", "short", "[", "]", "array2", "=", "new", "short", "[", "array", ".", "length", "]", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "assertThat", "(", "array2", ",", "equalTo", "(", "array", ")", ")", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testIntArray", "(", ")", "{", "int", "[", "]", "array", "=", "new", "int", "[", "<NUM_LIT:20>", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "r", ".", "nextInt", "(", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT:3>", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT>", ")", ";", "bb", ".", "flip", "(", ")", ";", "int", "[", "]", "array2", "=", "new", "int", "[", "array", ".", "length", "]", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "assertThat", "(", "array2", ",", "equalTo", "(", "array", ")", ")", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLongArray", "(", ")", "{", "long", "[", "]", "array", "=", "new", "long", "[", "<NUM_LIT:20>", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "r", ".", "nextLong", "(", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT:3>", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT>", ")", ";", "bb", ".", "flip", "(", ")", ";", "long", "[", "]", "array2", "=", "new", "long", "[", "array", ".", "length", "]", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "assertThat", "(", "array2", ",", "equalTo", "(", "array", ")", ")", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDoubleArray", "(", ")", "{", "double", "[", "]", "array", "=", "new", "double", "[", "<NUM_LIT:20>", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "r", ".", "nextDouble", "(", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT:3>", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "putInt", "(", "<NUM_LIT>", ")", ";", "bb", ".", "flip", "(", ")", ";", "double", "[", "]", "array2", "=", "new", "double", "[", "array", ".", "length", "]", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "assertThat", "(", "array2", ",", "equalTo", "(", "array", ")", ")", ";", "assertThat", "(", "bb", ".", "getInt", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "(", "expected", "=", "BufferOverflowException", ".", "class", ")", "public", "void", "testOverflow", "(", ")", "{", "long", "[", "]", "array", "=", "new", "long", "[", "<NUM_LIT>", "]", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "(", "expected", "=", "BufferUnderflowException", ".", "class", ")", "public", "void", "testUnderflow", "(", ")", "{", "int", "[", "]", "array", "=", "new", "int", "[", "<NUM_LIT:20>", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "array", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "r", ".", "nextInt", "(", ")", ";", "ByteBufferUtil", ".", "putArray", "(", "bb", ",", "array", ")", ";", "bb", ".", "flip", "(", ")", ";", "int", "[", "]", "array2", "=", "new", "int", "[", "<NUM_LIT>", "]", ";", "ByteBufferUtil", ".", "getArray", "(", "bb", ",", "array2", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getVersion", "(", "long", "id", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "return", "-", "1", ";", "return", "line", ".", "getVersion", "(", ")", ";", "}", "</s>"]
["<s>", "private", "CacheListener", "setListener", "(", "CacheListener", "listener", ",", "boolean", "onlyIfAbsent", ")", "{", "if", "(", "!", "onlyIfAbsent", "|", "this", ".", "listener", "=", "=", "null", ")", "this", ".", "listener", "=", "listener", ";", "return", "this", ".", "listener", ";", "}", "</s>"]
["<s>", "public", "CacheListener", "getListener", "(", "long", "id", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "return", "null", ";", "return", "line", ".", "getListener", "(", ")", ";", "}", "</s>"]
["<s>", "private", "CacheListener", "handleOpListen", "(", "CacheLine", "line", ",", "Object", "data", ",", "Object", "listener", ")", "{", "boolean", "onlyIfAbsent", "=", "(", "boolean", ")", "data", ";", "return", "line", ".", "setListener", "(", "(", "CacheListener", ")", "listener", ",", "onlyIfAbsent", ")", ";", "}", "</s>"]
["<s>", "public", "CacheListener", "setListener", "(", "long", "id", ",", "CacheListener", "listener", ",", "boolean", "onlyIfAbsent", ")", "{", "try", "{", "return", "(", "CacheListener", ")", "cache", ".", "doOp", "(", "LSTN", ",", "id", ",", "onlyIfAbsent", ",", "listener", ",", "null", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "throw", "new", "AssertionError", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "T", "getObj", "(", ")", "{", "return", "obj", ";", "}", "</s>"]
["<s>", "boolean", "tryLock", "(", "long", "id", ",", "ItemState", "state", ",", "Transaction", "txn", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "return", "false", ";", "synchronized", "(", "line", ")", "{", "if", "(", "(", "state", "=", "=", "ItemState", ".", "OWNED", "&", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "E", ")", "|", "(", "state", "=", "=", "ItemState", ".", "SHARED", "&", "!", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "S", ")", ")", ")", "{", "lockLine", "(", "line", ",", "txn", ")", ";", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "static", "DataOutput", "toDataOutput", "(", "OutputStream", "os", ")", "{", "if", "(", "os", "instanceof", "DataOutput", ")", "return", "(", "DataOutput", ")", "os", ";", "return", "new", "DataOutputStream", "(", "os", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ObjectOutput", "toObjectOutput", "(", "OutputStream", "os", ")", "throws", "IOException", "{", "if", "(", "os", "instanceof", "ObjectOutput", ")", "return", "(", "ObjectOutput", ")", "os", ";", "return", "new", "ObjectOutputStream", "(", "os", ")", ";", "}", "</s>"]
["<s>", "public", "static", "DataInput", "toDataInput", "(", "InputStream", "is", ")", "{", "if", "(", "is", "instanceof", "DataInput", ")", "return", "(", "DataInput", ")", "is", ";", "return", "new", "DataInputStream", "(", "is", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ObjectInput", "toObjectInput", "(", "InputStream", "is", ")", "throws", "IOException", "{", "if", "(", "is", "instanceof", "DataInput", ")", "return", "(", "ObjectInput", ")", "is", ";", "return", "new", "ObjectInputStream", "(", "is", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Serialization", "getInstance", "(", ")", "{", "if", "(", "instance", "!", "=", "null", ")", "return", "instance", ";", "else", "return", "tlInstance", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "read", "(", "byte", "[", "]", "buf", ")", "{", "return", "bas", ".", "read", "(", "buf", ")", ";", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "write", "(", "Object", "object", ")", "{", "return", "bas", ".", "write", "(", "object", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "read", "(", "InputStream", "is", ")", "throws", "IOException", "{", "return", "ioss", ".", "read", "(", "is", ")", ";", "}", "</s>"]
["<s>", "public", "void", "write", "(", "OutputStream", "os", ",", "Object", "object", ")", "throws", "IOException", "{", "ioss", ".", "write", "(", "os", ",", "object", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "register", "(", "Class", "type", ")", "{", "register", "(", "type", ",", "NULL_SERIALIZER", ",", "-", "1", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "register", "(", "Class", "type", ",", "int", "id", ")", "{", "register", "(", "type", ",", "NULL_SERIALIZER", ",", "id", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "register", "(", "Class", "type", ",", "Serializer", "ser", ")", "{", "register", "(", "type", ",", "ser", ",", "-", "1", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "register", "(", "Class", "type", ",", "Serializer", "ser", ",", "int", "id", ")", "{", "registrations", ".", "add", "(", "new", "Registration", "(", "type", ",", "ser", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Input", "getInput", "(", ")", "{", "if", "(", "input", "=", "=", "null", ")", "input", "=", "new", "Input", "(", "<NUM_LIT>", ")", ";", "return", "input", ";", "}", "</s>"]
["<s>", "private", "Output", "getOutput", "(", ")", "{", "if", "(", "output", "=", "=", "null", ")", "output", "=", "new", "Output", "(", "<NUM_LIT>", ",", "-", "1", ")", ";", "return", "output", ";", "}", "</s>"]
["<s>", "private", "void", "register", "(", "Registration", "r", ")", "{", "if", "(", "r", ".", "getId", "(", ")", "<", "0", "&", "&", "r", ".", "getSerializer", "(", ")", "=", "=", "NULL_SERIALIZER", ")", "kryo", ".", "register", "(", "r", ".", "getType", "(", ")", ")", ";", "else", "if", "(", "r", ".", "getId", "(", ")", "<", "0", ")", "kryo", ".", "register", "(", "r", ".", "getType", "(", ")", ",", "r", ".", "getSerializer", "(", ")", ")", ";", "else", "if", "(", "r", ".", "getSerializer", "(", ")", "=", "=", "NULL_SERIALIZER", ")", "kryo", ".", "register", "(", "r", ".", "getType", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "else", "kryo", ".", "register", "(", "r", ".", "getType", "(", ")", ",", "r", ".", "getSerializer", "(", ")", ",", "r", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "read", "(", "byte", "[", "]", "buf", ",", "Class", "<", "T", ">", "type", ")", "{", "final", "Input", "in", "=", "new", "Input", "(", "buf", ")", ";", "return", "kryo", ".", "readObjectOrNull", "(", "in", ",", "type", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "read", "(", "InputStream", "is", ",", "Class", "<", "T", ">", "type", ")", "{", "final", "Input", "in", "=", "getInput", "(", ")", ";", "in", ".", "setInputStream", "(", "is", ")", ";", "return", "kryo", ".", "readObjectOrNull", "(", "input", ",", "type", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Kryo", "newKryo", "(", ")", "{", "Kryo", "kryo", "=", "new", "ReplaceableObjectKryo", "(", ")", ";", "kryo", ".", "setRegistrationRequired", "(", "false", ")", ";", "kryo", ".", "setInstantiatorStrategy", "(", "new", "SerializingInstantiatorStrategy", "(", ")", ")", ";", "registerCommonClasses", "(", "kryo", ")", ";", "return", "kryo", ";", "}", "</s>"]
["<s>", "public", "static", "void", "registerCommonClasses", "(", "Kryo", "kryo", ")", "{", "kryo", ".", "register", "(", "boolean", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "byte", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "short", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "char", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "int", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "float", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "long", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "double", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "String", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "int", "[", "]", "[", "]", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "ArrayList", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "LinkedList", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "HashMap", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "LinkedHashMap", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "TreeMap", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "EnumMap", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "HashSet", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "TreeSet", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "EnumSet", ".", "class", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "Arrays", ".", "asList", "(", "\"", "\"", ")", ".", "getClass", "(", ")", ",", "new", "ArraysAsListSerializer", "(", ")", ")", ";", "kryo", ".", "register", "(", "java", ".", "util", ".", "GregorianCalendar", ".", "class", ",", "new", "GregorianCalendarSerializer", "(", ")", ")", ";", "kryo", ".", "register", "(", "java", ".", "lang", ".", "reflect", ".", "InvocationHandler", ".", "class", ",", "new", "JdkProxySerializer", "(", ")", ")", ";", "UnmodifiableCollectionsSerializer", ".", "registerSerializers", "(", "kryo", ")", ";", "SynchronizedCollectionsSerializer", ".", "registerSerializers", "(", "kryo", ")", ";", "kryo", ".", "addDefaultSerializer", "(", "Externalizable", ".", "class", ",", "new", "ExternalizableKryoSerializer", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ObjectOutput", "asObjectOutput", "(", "Output", "output", ",", "Kryo", "kryo", ")", "{", "return", "new", "KryoObjectOutputStream", "(", "output", ",", "kryo", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ObjectInput", "asObjectInput", "(", "Input", "input", ",", "Kryo", "kryo", ")", "{", "return", "new", "KryoObjectInputStream", "(", "input", ",", "kryo", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Object", "getReplacement", "(", "Object", "obj", ",", "final", "String", "replaceMethodName", ")", "{", "try", "{", "Class", "clazz", "=", "obj", ".", "getClass", "(", ")", ";", "if", "(", "!", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "clazz", ")", ")", "return", "obj", ";", "Method", "m", "=", "null", ";", "try", "{", "m", "=", "clazz", ".", "getDeclaredMethod", "(", "replaceMethodName", ")", ";", "}", "catch", "(", "NoSuchMethodException", "ex", ")", "{", "Class", "ancestor", "=", "clazz", ".", "getSuperclass", "(", ")", ";", "while", "(", "ancestor", "!", "=", "null", ")", "{", "if", "(", "!", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "ancestor", ")", ")", "return", "obj", ";", "try", "{", "m", "=", "ancestor", ".", "getDeclaredMethod", "(", "replaceMethodName", ")", ";", "if", "(", "!", "Modifier", ".", "isPublic", "(", "m", ".", "getModifiers", "(", ")", ")", "&", "&", "!", "Modifier", ".", "isProtected", "(", "m", ".", "getModifiers", "(", ")", ")", ")", "return", "obj", ";", "break", ";", "}", "catch", "(", "NoSuchMethodException", "ex1", ")", "{", "ancestor", "=", "ancestor", ".", "getSuperclass", "(", ")", ";", "}", "}", "}", "if", "(", "m", "=", "=", "null", ")", "return", "obj", ";", "m", ".", "setAccessible", "(", "true", ")", ";", "Object", "replacement", "=", "m", ".", "invoke", "(", "obj", ")", ";", "return", "replacement", ";", "}", "catch", "(", "IllegalAccessException", "|", "IllegalArgumentException", "|", "InvocationTargetException", "ex", ")", "{", "if", "(", "ex", "instanceof", "InvocationTargetException", ")", "(", "(", "InvocationTargetException", ")", "ex", ")", ".", "getTargetException", "(", ")", ".", "printStackTrace", "(", ")", ";", "return", "obj", ";", "}", "}", "</s>"]
["<s>", "private", "static", "Object", "getReplacement", "(", "Method", "m", ",", "Object", "object", ")", "{", "if", "(", "m", "=", "=", "null", ")", "return", "object", ";", "try", "{", "return", "m", ".", "invoke", "(", "object", ")", ";", "}", "catch", "(", "IllegalAccessException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "catch", "(", "InvocationTargetException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ".", "getCause", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "ReplaceMethods", "getMethods", "(", "Class", "clazz", ")", "{", "if", "(", "replaceMethodsCache", ".", "containsKey", "(", "clazz", ")", ")", "return", "replaceMethodsCache", ".", "get", "(", "clazz", ")", ";", "final", "ReplaceMethods", "replaceMethods", "=", "new", "ReplaceMethods", "(", "getMethodByReflection", "(", "clazz", ",", "WRITE_REPLACE", ")", ",", "getMethodByReflection", "(", "clazz", ",", "READ_RESOLVE", ")", ")", ";", "replaceMethodsCache", ".", "put", "(", "clazz", ",", "replaceMethods", ")", ";", "return", "replaceMethods", ";", "}", "</s>"]
["<s>", "private", "static", "Method", "getMethodByReflection", "(", "Class", "clazz", ",", "final", "String", "methodName", ")", "throws", "SecurityException", "{", "if", "(", "!", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "clazz", ")", ")", "return", "null", ";", "Method", "m", "=", "null", ";", "try", "{", "m", "=", "clazz", ".", "getDeclaredMethod", "(", "methodName", ")", ";", "}", "catch", "(", "NoSuchMethodException", "ex", ")", "{", "Class", "ancestor", "=", "clazz", ".", "getSuperclass", "(", ")", ";", "while", "(", "ancestor", "!", "=", "null", ")", "{", "if", "(", "!", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "ancestor", ")", ")", "return", "null", ";", "try", "{", "m", "=", "ancestor", ".", "getDeclaredMethod", "(", "methodName", ")", ";", "if", "(", "!", "Modifier", ".", "isPublic", "(", "m", ".", "getModifiers", "(", ")", ")", "&", "&", "!", "Modifier", ".", "isProtected", "(", "m", ".", "getModifiers", "(", ")", ")", ")", "return", "null", ";", "break", ";", "}", "catch", "(", "NoSuchMethodException", "ex1", ")", "{", "ancestor", "=", "ancestor", ".", "getSuperclass", "(", ")", ";", "}", "}", "}", "if", "(", "m", "!", "=", "null", ")", "m", ".", "setAccessible", "(", "true", ")", ";", "return", "m", ";", "}", "</s>"]
["<s>", "public", "T", "get", "(", ")", "{", "return", "obj", ";", "}", "</s>"]
["<s>", "protected", "void", "clear", "(", ")", "{", "this", ".", "obj", "=", "null", ";", "}", "</s>"]
["<s>", "byte", "[", "]", "getSerialized", "(", ")", "{", "if", "(", "tmpBuffer", "=", "=", "null", ")", "tmpBuffer", "=", "serialize", "(", "obj", ")", ";", "return", "tmpBuffer", ";", "}", "</s>"]
["<s>", "protected", "void", "set", "(", "T", "obj", ")", "{", "this", ".", "obj", "=", "obj", ";", "}", "</s>"]
["<s>", "protected", "byte", "[", "]", "serialize", "(", "T", "obj", ")", "{", "return", "obj", "!", "=", "null", "?", "Serialization", ".", "getInstance", "(", ")", ".", "write", "(", "obj", ")", ":", "null", ";", "}", "</s>"]
["<s>", "protected", "T", "deserialize", "(", "InputStream", "is", ")", "{", "try", "{", "return", "(", "T", ")", "Serialization", ".", "getInstance", "(", ")", ".", "read", "(", "is", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "R", "getOrCreateRef", "(", "long", "lineId", ",", "Object", "arg", ")", "{", "if", "(", "lineId", "<", "=", "0", ")", "return", "null", ";", "CacheListener", "ref", "=", "store", ".", "getListener", "(", "lineId", ")", ";", "return", "(", "R", ")", "(", "ref", "!", "=", "null", "?", "ref", ":", "store", ".", "setListenerIfAbsent", "(", "lineId", ",", "createRef", "(", "lineId", ",", "null", ",", "arg", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "R", "newRef", "(", "long", "lineId", ",", "T", "obj", ",", "Object", "arg", ")", "{", "if", "(", "lineId", "<", "=", "0", ")", "return", "null", ";", "assert", "store", ".", "getListener", "(", "lineId", ")", "=", "=", "null", ";", "R", "ref", "=", "createRef", "(", "lineId", ",", "obj", ",", "arg", ")", ";", "store", ".", "setListener", "(", "lineId", ",", "ref", ")", ";", "return", "ref", ";", "}", "</s>"]
["<s>", "protected", "R", "createRef", "(", "long", "id", ",", "T", "obj", ",", "Object", "arg", ")", "{", "return", "(", "R", ")", "new", "DistributedReference", "<", "T", ">", "(", "id", ",", "obj", ")", ";", "}", "</s>"]
["<s>", "public", "R", "newRef", "(", "T", "obj", ")", "{", "try", "{", "long", "id", "=", "store", ".", "put", "(", "ba", ",", "null", ")", ";", "R", "newRef", "=", "newRef", "(", "id", ",", "obj", ")", ";", "store", ".", "release", "(", "id", ")", ";", "return", "newRef", ";", "}", "catch", "(", "TimeoutException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "CacheLine", "createNewCacheLine", "(", "long", "id", ")", "{", "CacheLine", "line", "=", "allocateCacheLine", "(", ")", ";", "line", ".", "id", "=", "id", ";", "return", "putLine", "(", "id", ",", "line", ",", "0", ",", "0", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "execInvoke", "(", "final", "CacheLine", "line", ",", "LineFunction", "f", ")", "{", "final", "LineAccess", "la", "=", "new", "LineAccess", "(", "line", ")", ";", "final", "Object", "res", "=", "f", ".", "invoke", "(", "la", ")", ";", "if", "(", "la", ".", "written", ")", "line", ".", "data", ".", "flip", "(", ")", ";", "else", "line", ".", "data", ".", "rewind", "(", ")", ";", "return", "res", ";", "}", "</s>"]
