["<s>", "private", "static", "Persistable", "nonNullPersistable", "(", "Persistable", "object", ")", "{", "return", "object", "=", "=", "null", "?", "Cache", ".", "NULL_PERSISTABLE", ":", "object", ";", "}", "</s>"]
["<s>", "public", "boolean", "is", "(", "int", "flag", ")", "{", "return", "(", "flags", "&", "(", "byte", ")", "flag", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "private", "void", "extendLineData", "(", "int", "size", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "size", ",", "hex", "(", "line", ".", "getId", "(", ")", ")", ")", ";", "ByteBuffer", "allocated", "=", "allocateStorage", "(", "size", ")", ";", "allocated", ".", "put", "(", "(", "ByteBuffer", ")", "line", ".", "data", ".", "rewind", "(", ")", ")", ";", "allocated", ".", "flip", "(", ")", ";", "deallocateStorage", "(", "line", ".", "id", ",", "line", ".", "data", ")", ";", "line", ".", "data", "=", "allocated", ";", "}", "</s>"]
["<s>", "public", "Object", "read", "(", "byte", "[", "]", "buf", ",", "int", "offset", ")", "{", "return", "bas", ".", "read", "(", "buf", ",", "offset", ")", ";", "}", "</s>"]
["<s>", "public", "<", "T", ">", "T", "read", "(", "byte", "[", "]", "buf", ",", "int", "offset", ",", "Class", "<", "T", ">", "type", ")", "{", "final", "Input", "in", "=", "new", "Input", "(", "buf", ",", "offset", ",", "buf", ".", "length", "-", "offset", ")", ";", "return", "kryo", ".", "readObjectOrNull", "(", "in", ",", "type", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Method", "getMethodByReflection", "(", "Class", "clazz", ",", "final", "String", "methodName", ",", "Class", "<", "?", ">", ".", ".", ".", "paramTypes", ")", "throws", "SecurityException", "{", "if", "(", "!", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "clazz", ")", ")", "return", "null", ";", "Method", "m", "=", "null", ";", "try", "{", "m", "=", "clazz", ".", "getDeclaredMethod", "(", "methodName", ",", "paramTypes", ")", ";", "}", "catch", "(", "NoSuchMethodException", "ex", ")", "{", "Class", "ancestor", "=", "clazz", ".", "getSuperclass", "(", ")", ";", "while", "(", "ancestor", "!", "=", "null", ")", "{", "if", "(", "!", "Serializable", ".", "class", ".", "isAssignableFrom", "(", "ancestor", ")", ")", "return", "null", ";", "try", "{", "m", "=", "ancestor", ".", "getDeclaredMethod", "(", "methodName", ",", "paramTypes", ")", ";", "if", "(", "!", "Modifier", ".", "isPublic", "(", "m", ".", "getModifiers", "(", ")", ")", "&", "&", "!", "Modifier", ".", "isProtected", "(", "m", ".", "getModifiers", "(", ")", ")", ")", "return", "null", ";", "break", ";", "}", "catch", "(", "NoSuchMethodException", "ex1", ")", "{", "ancestor", "=", "ancestor", ".", "getSuperclass", "(", ")", ";", "}", "}", "}", "if", "(", "m", "!", "=", "null", ")", "m", ".", "setAccessible", "(", "true", ")", ";", "return", "m", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOp", "(", "CacheLine", "line", ",", "Op", ".", "Type", "type", ",", "Object", "data", ",", "Object", "extra", ",", "Transaction", "txn", ",", "boolean", "pending", ",", "int", "lineChange", ",", "Op", "op", ")", "{", "assert", "line", "!", "=", "null", "|", "|", "type", "=", "=", "Op", ".", "Type", ".", "PUT", "|", "|", "type", "=", "=", "Op", ".", "Type", ".", "ALLOC", ";", "handleNodeEvents", "(", "line", ")", ";", "Object", "res", "=", "null", ";", "if", "(", "line", "!", "=", "null", "&", "&", "shouldHoldOp", "(", "line", ",", "type", ")", ")", "res", "=", "PENDING", ";", "else", "{", "switch", "(", "type", ")", "{", "case", "GET", ":", "case", "GETS", ":", "res", "=", "handleOpGet", "(", "line", ",", "type", ",", "data", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "GETX", ":", "res", "=", "handleOpGetX", "(", "line", ",", "data", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "GET_FROM_OWNER", ":", "res", "=", "handleOpGetFromOwner", "(", "line", ",", "extra", ")", ";", "break", ";", "case", "SET", ":", "res", "=", "handleOpSet", "(", "line", ",", "data", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "DEL", ":", "res", "=", "handleOpDel", "(", "line", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "SEND", ":", "res", "=", "handleOpSend", "(", "line", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "case", "PUSH", ":", "res", "=", "handleOpPush", "(", "line", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "case", "PUSHX", ":", "res", "=", "handleOpPushX", "(", "line", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "case", "LSTN", ":", "res", "=", "handleOpListen", "(", "line", ",", "data", ",", "extra", ")", ";", "break", ";", "case", "INVOKE", ":", "res", "=", "handleOpInvoke", "(", "line", ",", "data", ",", "op", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "}", "accessLine", "(", "line", ")", ";", "}", "if", "(", "!", "pending", "&", "&", "type", ".", "isOf", "(", "HIT_OR_MISS_OPS", ")", ")", "{", "if", "(", "res", "!", "=", "PENDING", ")", "{", "if", "(", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "I", ")", "monitor", ".", "addStaleHit", "(", ")", ";", "else", "monitor", ".", "addHit", "(", ")", ";", "}", "}", "return", "res", ";", "}", "</s>"]
["<s>", "private", "boolean", "fastReplyToBroadcast", "(", "CacheLine", "line", ",", "LineMessage", "msg", ")", "{", "assert", "msg", ".", "isBroadcast", "(", ")", ";", "if", "(", "!", "msg", ".", "getType", "(", ")", ".", "isOf", "(", "MESSAGES_WITH_FAST_REPLY", ")", ")", "return", "false", ";", "if", "(", "line", ".", "state", "=", "=", "State", ".", "O", "|", "|", "line", ".", "state", "=", "=", "State", ".", "E", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "msg", ")", ";", "send", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "line", ".", "getId", "(", ")", ",", "myNodeId", "(", ")", ",", "true", ")", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpInvoke", "(", "CacheLine", "line", ",", "Object", "function", ",", "Op", "op", ",", "Object", "extra", ",", "int", "lineChange", ")", "{", "if", "(", "(", "lineChange", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "final", "LineFunction", "f", "=", "(", "LineFunction", ")", "function", ";", "if", "(", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "if", "(", "op", "!", "=", "null", ")", "{", "assert", "extra", "=", "=", "null", "|", "|", "extra", "instanceof", "Short", ";", "short", "nodeHint", "=", "nodeHint", "(", "extra", ")", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "getTarget", "(", "line", ",", "nodeHint", ")", ",", "line", ".", "id", ",", "f", ")", ";", "send", "(", "msg", ")", ";", "assert", "msg", ".", "getMessageId", "(", ")", ">", "0", ";", "op", ".", "setExtra", "(", "msg", ")", ";", "if", "(", "f", "instanceof", "NoResultLineFunction", ")", "return", "null", ";", "}", "return", "PENDING", ";", "}", "else", "{", "if", "(", "!", "transitionToE", "(", "line", ",", "(", "short", ")", "-", "1", ")", ")", "return", "PENDING", ";", "return", "execInvoke", "(", "line", ",", "f", ")", ";", "}", "}", "</s>"]
["<s>", "private", "CacheListener", "setListener", "(", "long", "id", ",", "CacheListener", "listener", ",", "boolean", "ifAbsent", ")", "{", "try", "{", "return", "(", "CacheListener", ")", "doOp", "(", "Op", ".", "Type", ".", "LSTN", ",", "id", ",", "ifAbsent", ",", "listener", ",", "null", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "throw", "new", "AssertionError", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "DistributedReference", "<", "T", ">", "newRef", "(", "Cache", "cache", ",", "long", "id", ",", "T", "obj", ")", "{", "if", "(", "id", "<", "=", "0", ")", "return", "null", ";", "assert", "cache", ".", "getListener", "(", "id", ")", "=", "=", "null", ";", "DistributedReference", "<", "T", ">", "ref", "=", "new", "DistributedReference", "<", "T", ">", "(", "id", ",", "obj", ")", ";", "cache", ".", "setListener", "(", "id", ",", "ref", ")", ";", "return", "ref", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "DistributedReference", "<", "T", ">", "getOrCreateRef", "(", "Cache", "cache", ",", "long", "id", ")", "{", "if", "(", "id", "<", "=", "0", ")", "return", "null", ";", "CacheListener", "ref", "=", "cache", ".", "getListener", "(", "id", ")", ";", "return", "(", "DistributedReference", "<", "T", ">", ")", "(", "ref", "!", "=", "null", "?", "ref", ":", "cache", ".", "setListenerIfAbsent", "(", "id", ",", "new", "DistributedReference", "<", "T", ">", "(", "id", ",", "null", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "quickReplyToBroadcast", "(", "CacheLine", "line", ",", "LineMessage", "msg", ")", "{", "assert", "msg", ".", "isBroadcast", "(", ")", ";", "if", "(", "!", "msg", ".", "getType", "(", ")", ".", "isOf", "(", "MESSAGES_WITH_FAST_REPLY", ")", ")", "return", "false", ";", "if", "(", "line", ".", "state", "=", "=", "State", ".", "O", "|", "|", "line", ".", "state", "=", "=", "State", ".", "E", ")", "{", "send", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "line", ".", "getId", "(", ")", ",", "myNodeId", "(", ")", ",", "true", ")", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpInvoke", "(", "CacheLine", "line", ",", "Object", "function", ",", "Op", "op", ",", "Object", "extra", ",", "Transaction", "txn", ",", "int", "lineChange", ")", "{", "if", "(", "(", "lineChange", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "final", "LineFunction", "f", "=", "(", "LineFunction", ")", "function", ";", "if", "(", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "if", "(", "op", "!", "=", "null", ")", "{", "short", "nodeHint", "=", "extra", "instanceof", "Short", "?", "nodeHint", "(", "extra", ")", ":", "(", "short", ")", "-", "1", ";", "final", "Message", ".", "INVOKE", "msg", "=", "Message", ".", "INVOKE", "(", "getTarget", "(", "line", ",", "nodeHint", ")", ",", "line", ".", "id", ",", "f", ")", ";", "send", "(", "msg", ")", ";", "assert", "msg", ".", "getMessageId", "(", ")", ">", "0", ";", "op", ".", "setExtra", "(", "msg", ")", ";", "if", "(", "f", "instanceof", "NoResultLineFunction", ")", "return", "null", ";", "}", "return", "PENDING", ";", "}", "else", "{", "if", "(", "!", "transitionToE", "(", "line", ",", "(", "short", ")", "-", "1", ")", ")", "return", "PENDING", ";", "Object", "res", "=", "execInvoke", "(", "line", ",", "f", ")", ";", "if", "(", "txn", "=", "=", "null", "&", "&", "!", "line", ".", "isLocked", "(", ")", ")", "backupLine", "(", "line", ")", ";", "return", "res", ";", "}", "}", "</s>"]
["<s>", "protected", "Object", "writeReplace", "(", ")", "{", "return", "new", "SerializedDistributedRef", "(", "id", ")", ";", "}", "</s>"]
["<s>", "Object", "readResolve", "(", ")", "{", "try", "{", "return", "DistributedReferenceStore", ".", "getOrCreateRef", "(", "Grid", ".", "getInstance", "(", ")", ".", "store", "(", ")", ",", "id", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "<", "T", ">", "T", "readReplace", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "null", ";", "return", "(", "T", ")", "getReplacement", "(", "getMethods", "(", "obj", ".", "getClass", "(", ")", ")", ".", "readResolve", ",", "obj", ")", ";", "}", "</s>"]
["<s>", "boolean", "cancelOp", "(", "Op", "op", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "op", ".", "line", ")", ";", "if", "(", "line", "=", "=", "null", ")", "return", "false", ";", "synchronized", "(", "line", ")", "{", "final", "boolean", "completed", ";", "if", "(", "!", "(", "completed", "=", "op", ".", "isCompleted", "(", ")", ")", ")", "{", "op", ".", "setCancelled", "(", ")", ";", "removePendingOp", "(", "line", ",", "op", ")", ";", "}", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "op", ",", "line", ",", "completed", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "return", "!", "completed", ";", "}", "}", "</s>"]
["<s>", "private", "Object", "handleOpGetX", "(", "CacheLine", "line", ",", "Object", "data", ",", "short", "nodeHint", ",", "Transaction", "txn", ",", "int", "change", ",", "boolean", "pending", ")", "{", "if", "(", "(", "change", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "if", "(", "!", "pending", ")", "verifyNoUpgrade", "(", "line", ")", ";", "if", "(", "!", "transitionToE", "(", "line", ",", "nodeHint", ")", ")", "return", "PENDING", ";", "lockLine", "(", "line", ",", "txn", ")", ";", "if", "(", "data", "!", "=", "null", ")", "{", "readData", "(", "line", ",", "(", "Persistable", ")", "data", ")", ";", "return", "null", ";", "}", "else", "return", "readData", "(", "line", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "verifyNoUpgrade", "(", "CacheLine", "line", ")", "{", "if", "(", "line", ".", "isLocked", "(", ")", "&", "&", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "S", ")", "{", "RuntimeException", "e", "=", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "line", "+", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "line", "+", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "e", ";", "}", "if", "(", "hasPendingOp", "(", "line", ",", "Op", ".", "Type", ".", "GETS", ")", ")", "{", "RuntimeException", "e", "=", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "line", "+", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "line", "+", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "e", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "private", "boolean", "hasPendingOp", "(", "CacheLine", "line", ",", "Op", ".", "Type", "opType", ")", "{", "for", "(", "Op", "op", ":", "getPendingOps", "(", "line", ")", ")", "{", "if", "(", "op", ".", "type", "=", "=", "opType", ")", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "void", "setCancelled", "(", ")", "{", "assert", "status", "=", "=", "0", ";", "this", ".", "status", "=", "CANCELLED", ";", "}", "</s>"]
["<s>", "private", "void", "setCompleted", "(", ")", "{", "assert", "status", "=", "=", "0", ";", "this", ".", "status", "=", "COMPLETED", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCancelled", "(", ")", "{", "return", "status", "=", "=", "CANCELLED", ";", "}", "</s>"]
["<s>", "public", "boolean", "isCompleted", "(", ")", "{", "return", "status", "=", "=", "COMPLETED", ";", "}", "</s>"]
["<s>", "static", "Cache", "getCache", "(", ")", "{", "try", "{", "return", "(", "(", "StoreImpl", ")", "Grid", ".", "getInstance", "(", ")", ".", "store", "(", ")", ")", ".", "cache", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "static", "boolean", "isVoidLineFunction", "(", "LineFunction", "<", "?", ">", "function", ")", "{", "return", "isVoidLineFunction", ".", "get", "(", "function", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isVoidLineFunction", "(", "Class", "<", "?", ">", "clazz", ")", "{", "if", "(", "clazz", "=", "=", "null", ")", "return", "false", ";", "for", "(", "java", ".", "lang", ".", "reflect", ".", "Type", "iface", ":", "clazz", ".", "getGenericInterfaces", "(", ")", ")", "{", "if", "(", "iface", "instanceof", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ")", "{", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", "pt", "=", "(", "java", ".", "lang", ".", "reflect", ".", "ParameterizedType", ")", "iface", ";", "if", "(", "pt", ".", "getRawType", "(", ")", "=", "=", "LineFunction", ".", "class", ")", "return", "(", "pt", ".", "getActualTypeArguments", "(", ")", "[", "0", "]", "=", "=", "Void", ".", "class", ")", ";", "boolean", "r", "=", "isVoidLineFunction", "(", "(", "Class", ")", "pt", ".", "getRawType", "(", ")", ")", ";", "if", "(", "r", ")", "return", "true", ";", "}", "else", "if", "(", "iface", "=", "=", "LineFunction", ".", "class", ")", "return", "false", ";", "boolean", "r", "=", "isVoidLineFunction", "(", "(", "Class", ")", "iface", ")", ";", "if", "(", "r", ")", "return", "true", ";", "}", "return", "isVoidLineFunction", "(", "clazz", ".", "getSuperclass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "NonBlockingHashMapLong", "<", "BackupEntry", ">", "oldMap", "(", ")", "{", "return", "map", "=", "=", "map1", "?", "map2", ":", "map1", ";", "}", "</s>"]
["<s>", "public", "static", "RuntimeException", "rethrowUnwrap", "(", "Throwable", "t", ")", "{", "throw", "rethrow", "(", "unwrap", "(", "t", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "X", "extends", "Throwable", ">", "RuntimeException", "rethrowUnwrap", "(", "Throwable", "t", ",", "Class", "<", "X", ">", "exceptionClass", ")", "throws", "X", "{", "Throwable", "t1", "=", "unwrap", "(", "t", ")", ";", "if", "(", "exceptionClass", ".", "isInstance", "(", "t1", ")", ")", "throw", "exceptionClass", ".", "cast", "(", "t1", ")", ";", "throw", "rethrow", "(", "t1", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "X1", "extends", "Throwable", ",", "X2", "extends", "Throwable", ">", "RuntimeException", "rethrowUnwrap", "(", "Throwable", "t", ",", "Class", "<", "X1", ">", "exceptionClass1", ",", "Class", "<", "X2", ">", "exceptionClass2", ")", "throws", "X1", ",", "X2", "{", "Throwable", "t1", "=", "unwrap", "(", "t", ")", ";", "if", "(", "exceptionClass1", ".", "isInstance", "(", "t1", ")", ")", "throw", "exceptionClass1", ".", "cast", "(", "t1", ")", ";", "if", "(", "exceptionClass2", ".", "isInstance", "(", "t1", ")", ")", "throw", "exceptionClass2", ".", "cast", "(", "t1", ")", ";", "throw", "rethrow", "(", "t1", ")", ";", "}", "</s>"]
["<s>", "public", "long", "get", "(", "String", "root", ",", "long", "ref", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "new", "StringRootPageHandler", "(", "root", ")", ".", "find", "(", "txn", ",", "ref", ")", ";", "}", "</s>"]
["<s>", "private", "void", "openOrCreate", "(", ")", "throws", "DatabaseException", ",", "IllegalStateException", ",", "DatabaseExistsException", ",", "DatabaseNotFoundException", ",", "IllegalArgumentException", "{", "this", ".", "ownerDirectory", "=", "env", ".", "openDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DatabaseConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ")", ";", "this", ".", "ownerIndex", "=", "env", ".", "openSecondaryDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "ownerDirectory", ",", "(", "(", "SecondaryConfig", ")", "(", "new", "SecondaryConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setSortedDuplicates", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ")", ")", ".", "setAllowPopulate", "(", "true", ")", ".", "setKeyCreator", "(", "new", "OwnerKeyCreator", "(", ")", ")", ")", ";", "this", ".", "mainStore", "=", "env", ".", "openDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DatabaseConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "hello", "(", ")", "throws", "Exception", "{", "main", "(", "new", "String", "[", "]", "{", "}", ")", ";", "}", "</s>"]
["<s>", "private", "static", "<", "K", ",", "V", ">", "V", "value", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", "entry", ")", "{", "return", "entry", "!", "=", "null", "?", "entry", ".", "getValue", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "private", "static", "<", "K", ",", "V", ">", "K", "key", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", "entry", ")", "{", "return", "entry", "!", "=", "null", "?", "entry", ".", "getKey", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "public", "boolean", "isIncomplete", "(", ")", "{", "return", "parts", ">", "0", ";", "}", "</s>"]
["<s>", "private", "List", "<", "Message", ".", "MSG", ">", "getAndClearPendingMSGs", "(", "CacheLine", "line", ")", "{", "final", "List", "<", "Message", ".", "MSG", ">", "ms", "=", "new", "ArrayList", "<", ">", "(", ")", ";", "final", "Collection", "<", "LineMessage", ">", "msgs", "=", "getPendingMessages", "(", "line", ")", ";", "for", "(", "Iterator", "<", "LineMessage", ">", "it", "=", "msgs", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "LineMessage", "msg", "=", "it", ".", "next", "(", ")", ";", "if", "(", "msg", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "MSG", ")", "{", "ms", ".", "add", "(", "(", "Message", ".", "MSG", ")", "msg", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "return", "ms", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageMsg", "(", "Message", ".", "MSG", "msg", ",", "CacheLine", "line", ")", "{", "setOwnerClock", "(", "line", ",", "msg", ")", ";", "if", "(", "msg", ".", "isPending", "(", ")", ")", "{", "line", ".", "parts", "-", "-", ";", "msg", ".", "setPending", "(", "false", ")", ";", "}", "if", "(", "line", ".", "getListener", "(", ")", "!", "=", "null", ")", "{", "try", "{", "line", ".", "getListener", "(", ")", ".", "messageReceived", "(", "msg", ".", "getData", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "if", "(", "msg", ".", "isReplyRequired", "(", ")", ")", "send", "(", "Message", ".", "MSGACK", "(", "msg", ")", ")", ";", "}", "else", "addPendingMessage", "(", "line", ",", "msg", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "</s>"]
["<s>", "public", "static", "PUTX", "PUTX", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "[", "]", "sharers", ",", "int", "messages", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "PUTX", "(", "responseTo", ",", "line", ",", "sharers", ",", "messages", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "MSG", "MSG", "(", "short", "node", ",", "long", "line", ",", "boolean", "messenger", ",", "boolean", "pending", ",", "byte", "[", "]", "data", ")", "{", "return", "new", "MSG", "(", "node", ",", "line", ",", "messenger", ",", "pending", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "MSG", "MSG", "(", "short", "[", "]", "nodes", ",", "long", "line", ",", "boolean", "messenger", ",", "boolean", "pending", ",", "byte", "[", "]", "data", ")", "{", "return", "new", "MSG", "(", "nodes", ",", "line", ",", "messenger", ",", "pending", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getMessages", "(", ")", "{", "return", "messages", ";", "}", "</s>"]
["<s>", "public", "boolean", "isMessenger", "(", ")", "{", "return", "(", "flags", "&", "MESSENGER", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "public", "boolean", "isPending", "(", ")", "{", "return", "(", "flags", "&", "PENDING", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "public", "void", "setPending", "(", "boolean", "value", ")", "{", "this", ".", "flags", "|", "=", "value", "?", "PENDING", ":", "0", ";", "}", "</s>"]
["<s>", "public", "Message", "setOutgoing", "(", ")", "{", "this", ".", "incoming", "=", "false", ";", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSend1", "(", ")", "throws", "Exception", "{", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "doOp", "(", "LSTN", ",", "<NUM_LIT>", ",", "listener", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "false", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "verify", "(", "listener", ")", ".", "messageReceived", "(", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSend2", "(", ")", "throws", "Exception", "{", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "false", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "messageReceived", "(", "any", "(", "byte", "[", "]", ".", "class", ")", ")", ";", "doOp", "(", "LSTN", ",", "<NUM_LIT>", ",", "listener", ")", ";", "verify", "(", "listener", ")", ".", "messageReceived", "(", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSend3", "(", ")", "throws", "Exception", "{", "setCommMsgCounter", "(", ")", ";", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "doOp", "(", "LSTN", ",", "<NUM_LIT>", ",", "listener", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "false", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "messageReceived", "(", "any", "(", "byte", "[", "]", ".", "class", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "false", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setMessageId", "(", "<NUM_LIT:2>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPendingMSGsAndGETXThenSend", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "false", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "false", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "GETX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "comm", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "new", "short", "[", "0", "]", ",", "<NUM_LIT:2>", ",", "1", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "false", ",", "true", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setReplyRequired", "(", "false", ")", ")", ")", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "false", ",", "true", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setReplyRequired", "(", "false", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTXandPendingAndGETXThenSend", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "GETX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "new", "short", "[", "0", "]", ",", "<NUM_LIT:2>", ",", "1", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "false", ",", "true", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "new", "short", "[", "0", "]", ",", "<NUM_LIT:2>", ",", "1", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "false", ",", "true", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "comm", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "new", "short", "[", "0", "]", ",", "<NUM_LIT:2>", ",", "1", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "false", ",", "true", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setReplyRequired", "(", "false", ")", ")", ")", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "false", ",", "true", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setReplyRequired", "(", "false", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "void", "PUTX", "(", "long", "id", ",", "short", "owner", ",", "int", "parts", ",", "long", "version", ",", "String", "obj", ")", "{", "cache", ".", "receive", "(", "Message", ".", "PUTX", "(", "Message", ".", "GETX", "(", "owner", ",", "id", ")", ",", "id", ",", "new", "short", "[", "0", "]", ",", "parts", ",", "version", ",", "toBuffer", "(", "obj", ")", ")", ".", "setMessageId", "(", "+", "+", "messageId", ")", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "id", ",", "owner", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "fireLineKilled", "(", "CacheLine", "line", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "line", ")", ";", "if", "(", "line", ".", "getListener", "(", ")", "!", "=", "null", ")", "{", "try", "{", "line", ".", "getListener", "(", ")", ".", "killed", "(", "this", ",", "line", ".", "getId", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "for", "(", "CacheListener", "listener", ":", "listeners", ")", "{", "try", "{", "listener", ".", "killed", "(", "this", ",", "line", ".", "getId", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "After", "public", "void", "recycleCloud", "(", ")", "{", "if", "(", "cloud", "!", "=", "null", ")", "{", "cloud", ".", "shutdown", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "sayHelloWorld", "(", "ViNodeSet", "cloud", ")", "{", "ViNode", "allNodes", "=", "cloud", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allNodes", ".", "exec", "(", "new", "Callable", "<", "Void", ">", "(", ")", "{", "@", "Override", "public", "Void", "call", "(", ")", "throws", "Exception", "{", "String", "jvmName", "=", "ManagementFactory", ".", "getRuntimeMXBean", "(", ")", ".", "getName", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "jvmName", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "reportMemory", "(", "ViNodeSet", "cloud", ")", "{", "ViNode", "allNodes", "=", "cloud", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allNodes", ".", "exec", "(", "new", "Callable", "<", "Void", ">", "(", ")", "{", "@", "Override", "public", "Void", "call", "(", ")", "throws", "Exception", "{", "String", "jvmName", "=", "ManagementFactory", ".", "getRuntimeMXBean", "(", ")", ".", "getName", "(", ")", ";", "long", "totalMemory", "=", "Runtime", ".", "getRuntime", "(", ")", ".", "maxMemory", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "jvmName", "+", "\"", "<STR_LIT>", "\"", "+", "(", "totalMemory", ">", ">", "<NUM_LIT:20>", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "warmUp", "(", "ViNodeSet", "cloud", ")", "{", "ViNode", "allNodes", "=", "cloud", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ";", "allNodes", ".", "exec", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "InterruptedException", "{", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "this", ".", "zk", "=", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "ServerConfig", "sc", "=", "new", "ServerConfig", "(", ")", ";", "sc", ".", "parse", "(", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "File", "dataDir", "=", "new", "File", "(", "\"", "<STR_LIT>", "\"", ")", ";", "FileUtils", ".", "deleteDirectory", "(", "dataDir", ")", ";", "dataDir", ".", "mkdirs", "(", ")", ";", "new", "ZooKeeperServerMain", "(", ")", ".", "runFromConfig", "(", "sc", ")", ";", "}", "catch", "(", "QuorumPeerConfig", ".", "ConfigException", "|", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "}", ")", ";", "zk", ".", "start", "(", ")", ";", "cloud", "=", "createLocalCloud", "(", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "InterruptedException", "{", "zk", ".", "interrupt", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "clusterAddTest", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "cloud", ".", "nodes", "(", "SERVER", ",", "PEER1", ",", "PEER2", ")", ";", "setJvmArgs", "(", "cloud", ")", ";", "warmUp", "(", "cloud", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "Future", "<", "Void", ">", "server", "=", "cloud", ".", "node", "(", "SERVER", ")", ".", "submit", "(", "createServer", "(", ")", ")", ";", "Future", "<", "Short", ">", "peer1", "=", "cloud", ".", "node", "(", "PEER1", ")", ".", "submit", "(", "createWaitForLargerPeer", "(", "1", ")", ")", ";", "Future", "<", "Short", ">", "peer2", "=", "cloud", ".", "node", "(", "PEER2", ")", ".", "submit", "(", "createWaitForLargerPeer", "(", "<NUM_LIT:2>", ")", ")", ";", "int", "largerPeer", "=", "peer1", ".", "get", "(", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "largerPeer", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "largerPeer", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Runnable", "createServer", "(", ")", "{", "return", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Server", ".", "start", "(", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "Long", ".", "MAX_VALUE", ")", ";", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "private", "static", "Callable", "<", "Short", ">", "createWaitForLargerPeer", "(", "final", "int", "peerNum", ")", "{", "return", "new", "Callable", "<", "Short", ">", "(", ")", "{", "@", "Override", "public", "Short", "call", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "peerNum", ")", ";", "Properties", "props", "=", "new", "Properties", "(", ")", ";", "props", ".", "load", "(", "new", "FileInputStream", "(", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", "+", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", "+", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", ")", ")", ";", "final", "Grid", "grid", "=", "Grid", ".", "getInstance", "(", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "props", ")", ";", "grid", ".", "goOnline", "(", ")", ";", "final", "SettableFuture", "<", "Short", ">", "future", "=", "SettableFuture", ".", "create", "(", ")", ";", "grid", ".", "cluster", "(", ")", ".", "addNodeChangeListener", "(", "new", "NodeChangeListener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "if", "(", "id", ">", "grid", ".", "cluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "future", ".", "set", "(", "id", ")", ";", "}", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "}", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "}", "}", ")", ";", "for", "(", "Short", "node", ":", "grid", ".", "cluster", "(", ")", ".", "getNodes", "(", ")", ")", "{", "if", "(", "node", ">", "grid", ".", "cluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "return", "node", ";", "}", "return", "future", ".", "get", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "private", "static", "ViManager", "createLocalCloud", "(", ")", "{", "ViManager", "vim", "=", "CloudFactory", ".", "createCloud", "(", ")", ";", "ViProps", ".", "at", "(", "vim", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setLocalType", "(", ")", ";", "return", "vim", ";", "}", "</s>"]
["<s>", "private", "static", "void", "setJvmArgs", "(", "final", "ViManager", "cloud", ")", "{", "String", "[", "]", "copyEnv", "=", "{", "\"", "<STR_LIT>", "\"", ",", "}", ";", "JvmProps", "props", "=", "JvmProps", ".", "at", "(", "cloud", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "for", "(", "String", "string", ":", "copyEnv", ")", "props", "=", "props", ".", "addJvmArg", "(", "\"", "<STR_LIT>", "\"", "+", "string", "+", "\"", "<STR_LIT:=>", "\"", "+", "System", ".", "getProperty", "(", "string", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "pathToResource", "(", "final", "String", "name", ")", "{", "return", "ClassLoader", ".", "getSystemClassLoader", "(", ")", ".", "getResource", "(", "name", ")", ".", "getPath", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "ZooKeeperServer", "startZookeeper", "(", "final", "String", "configResource", ",", "final", "String", "dataDirName", ")", "throws", "IOException", ",", "QuorumPeerConfig", ".", "ConfigException", "{", "ServerConfig", "sc", "=", "new", "ServerConfig", "(", ")", ";", "sc", ".", "parse", "(", "pathToResource", "(", "configResource", ")", ")", ";", "final", "File", "dataDir", "=", "new", "File", "(", "dataDirName", ")", ";", "FileUtils", ".", "deleteDirectory", "(", "dataDir", ")", ";", "dataDir", ".", "mkdirs", "(", ")", ";", "FileTxnSnapLog", "txnLog", "=", "null", ";", "try", "{", "ZooKeeperServer", "zkServer", "=", "new", "ZooKeeperServer", "(", ")", ";", "txnLog", "=", "new", "FileTxnSnapLog", "(", "new", "File", "(", "sc", ".", "getDataDir", "(", ")", ")", ",", "new", "File", "(", "sc", ".", "getDataDir", "(", ")", ")", ")", ";", "zkServer", ".", "setTxnLogFactory", "(", "txnLog", ")", ";", "zkServer", ".", "setTickTime", "(", "sc", ".", "getTickTime", "(", ")", ")", ";", "zkServer", ".", "setMinSessionTimeout", "(", "sc", ".", "getMinSessionTimeout", "(", ")", ")", ";", "zkServer", ".", "setMaxSessionTimeout", "(", "sc", ".", "getMaxSessionTimeout", "(", ")", ")", ";", "ServerCnxnFactory", "cnxnFactory", "=", "ServerCnxnFactory", ".", "createFactory", "(", ")", ";", "cnxnFactory", ".", "configure", "(", "sc", ".", "getClientPortAddress", "(", ")", ",", "sc", ".", "getMaxClientCnxns", "(", ")", ")", ";", "cnxnFactory", ".", "startup", "(", "zkServer", ")", ";", "return", "zkServer", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "finally", "{", "if", "(", "txnLog", "!", "=", "null", ")", "{", "txnLog", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "static", "ViManager", "createLocalCloud", "(", ")", "{", "ViManager", "vim", "=", "CloudFactory", ".", "createCloud", "(", ")", ";", "ViProps", ".", "at", "(", "vim", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "setLocalType", "(", ")", ";", "return", "vim", ";", "}", "</s>"]
["<s>", "public", "static", "Runnable", "startGlxServer", "(", ")", "{", "return", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "Server", ".", "start", "(", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "try", "{", "Thread", ".", "sleep", "(", "Long", ".", "MAX_VALUE", ")", ";", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "public", "static", "Callable", "<", "Short", ">", "startWaitForLargerPeer", "(", "final", "int", "peerNum", ",", "final", "String", "configpeerxml", ")", "{", "return", "new", "Callable", "<", "Short", ">", "(", ")", "{", "@", "Override", "public", "Short", "call", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "peerNum", ")", ";", "Properties", "props", "=", "new", "Properties", "(", ")", ";", "props", ".", "load", "(", "new", "FileInputStream", "(", "pathToResource", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", "+", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", "+", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", ")", ")", ";", "final", "Grid", "grid", "=", "Grid", ".", "getInstance", "(", "pathToResource", "(", "configpeerxml", ")", ",", "props", ")", ";", "grid", ".", "goOnline", "(", ")", ";", "final", "SettableFuture", "<", "Short", ">", "future", "=", "SettableFuture", ".", "create", "(", ")", ";", "grid", ".", "cluster", "(", ")", ".", "addNodeChangeListener", "(", "new", "NodeChangeListener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "if", "(", "id", ">", "grid", ".", "cluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "future", ".", "set", "(", "id", ")", ";", "}", "}", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "}", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "}", "}", ")", ";", "for", "(", "Short", "node", ":", "grid", ".", "cluster", "(", ")", ".", "getNodes", "(", ")", ")", "{", "if", "(", "node", ">", "grid", ".", "cluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "node", ";", "}", "}", "return", "future", ".", "get", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "clusterAddTest", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "cloud", "=", "createLocalCloud", "(", ")", ";", "cloud", ".", "nodes", "(", "PEER1", ",", "PEER2", ")", ";", "setJvmArgs", "(", "cloud", ")", ";", "cloud", ".", "node", "(", "PEER2", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "<NUM_LIT:2>", ",", "PEER_NO_SERVER_CFG", ")", ")", ";", "int", "largerID", "=", "cloud", ".", "node", "(", "PEER1", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "1", ",", "PEER_NO_SERVER_CFG", ")", ")", ".", "get", "(", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "largerID", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "setJvmArgs", "(", "final", "ViManager", "cloud", ")", "{", "String", "[", "]", "copyEnv", "=", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "}", ";", "JvmProps", "props", "=", "JvmProps", ".", "at", "(", "cloud", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "addJvmArg", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "String", "string", ":", "copyEnv", ")", "props", "=", "props", ".", "addJvmArg", "(", "\"", "<STR_LIT>", "\"", "+", "string", "+", "\"", "<STR_LIT:=>", "\"", "+", "System", ".", "getProperty", "(", "string", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "InterruptedException", ",", "QuorumPeerConfig", ".", "ConfigException", ",", "IOException", "{", "zkCnxnFactory", "=", "startZookeeper", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cloud", "=", "createLocalCloud", "(", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "throws", "InterruptedException", "{", "zkCnxnFactory", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "clusterAddTest", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "cloud", ".", "nodes", "(", "SERVER", ",", "PEER1", ",", "PEER2", ")", ";", "setJvmArgs", "(", "cloud", ")", ";", "cloud", ".", "node", "(", "SERVER", ")", ".", "submit", "(", "startGlxServer", "(", ")", ")", ";", "cloud", ".", "node", "(", "PEER2", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "<NUM_LIT:2>", ",", "PEER_WITH_SERVER_CFG", ")", ")", ";", "int", "largerID", "=", "cloud", ".", "node", "(", "PEER1", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "1", ",", "PEER_WITH_SERVER_CFG", ")", ")", ".", "get", "(", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "largerID", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "setJvmArgs", "(", "final", "ViManager", "cloud", ")", "{", "String", "[", "]", "copyEnv", "=", "{", "\"", "<STR_LIT>", "\"", ",", "}", ";", "JvmProps", "props", "=", "JvmProps", ".", "at", "(", "cloud", ".", "node", "(", "\"", "<STR_LIT>", "\"", ")", ")", ".", "addJvmArg", "(", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "String", "string", ":", "copyEnv", ")", "props", "=", "props", ".", "addJvmArg", "(", "\"", "<STR_LIT>", "\"", "+", "string", "+", "\"", "<STR_LIT:=>", "\"", "+", "System", ".", "getProperty", "(", "string", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "ServerCnxnFactory", "startZookeeper", "(", "final", "String", "configResource", ",", "final", "String", "dataDirName", ")", "throws", "IOException", ",", "QuorumPeerConfig", ".", "ConfigException", "{", "ServerConfig", "sc", "=", "new", "ServerConfig", "(", ")", ";", "sc", ".", "parse", "(", "pathToResource", "(", "configResource", ")", ")", ";", "final", "File", "dataDir", "=", "new", "File", "(", "dataDirName", ")", ";", "FileUtils", ".", "deleteDirectory", "(", "dataDir", ")", ";", "dataDir", ".", "mkdirs", "(", ")", ";", "FileTxnSnapLog", "txnLog", "=", "null", ";", "try", "{", "ZooKeeperServer", "zkServer", "=", "new", "ZooKeeperServer", "(", ")", ";", "txnLog", "=", "new", "FileTxnSnapLog", "(", "new", "File", "(", "sc", ".", "getDataDir", "(", ")", ")", ",", "new", "File", "(", "sc", ".", "getDataDir", "(", ")", ")", ")", ";", "zkServer", ".", "setTxnLogFactory", "(", "txnLog", ")", ";", "zkServer", ".", "setTickTime", "(", "sc", ".", "getTickTime", "(", ")", ")", ";", "zkServer", ".", "setMinSessionTimeout", "(", "sc", ".", "getMinSessionTimeout", "(", ")", ")", ";", "zkServer", ".", "setMaxSessionTimeout", "(", "sc", ".", "getMaxSessionTimeout", "(", ")", ")", ";", "ServerCnxnFactory", "cnxnFactory", "=", "ServerCnxnFactory", ".", "createFactory", "(", ")", ";", "cnxnFactory", ".", "configure", "(", "sc", ".", "getClientPortAddress", "(", ")", ",", "sc", ".", "getMaxClientCnxns", "(", ")", ")", ";", "cnxnFactory", ".", "startup", "(", "zkServer", ")", ";", "return", "cnxnFactory", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "finally", "{", "if", "(", "txnLog", "!", "=", "null", ")", "{", "txnLog", ".", "close", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "defineCloud", "(", ")", "{", "cloud", "=", "createLocalCloud", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "jgroupsWithServerTest", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "cloud", ".", "nodes", "(", "SERVER", ",", "PEER1", ",", "PEER2", ")", ";", "setJvmArgs", "(", "cloud", ")", ";", "cloud", ".", "node", "(", "SERVER", ")", ".", "submit", "(", "startGlxServer", "(", "SERVER_JG_CFG", ",", "SERVER_PROPS", ")", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "cloud", ".", "node", "(", "PEER2", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "<NUM_LIT:2>", ",", "PEER_WITH_JG_SERVER_CFG", ")", ")", ";", "int", "largerID", "=", "cloud", ".", "node", "(", "PEER1", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "1", ",", "PEER_WITH_JG_SERVER_CFG", ")", ")", ".", "get", "(", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "largerID", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "deleteDir", "(", "String", "path", ")", "throws", "IOException", "{", "Files", ".", "walkFileTree", "(", "Paths", ".", "get", "(", "path", ")", ",", "new", "SimpleFileVisitor", "<", "Path", ">", "(", ")", "{", "@", "Override", "public", "FileVisitResult", "visitFile", "(", "Path", "file", ",", "BasicFileAttributes", "attrs", ")", "throws", "IOException", "{", "Files", ".", "delete", "(", "file", ")", ";", "return", "FileVisitResult", ".", "CONTINUE", ";", "}", "@", "Override", "public", "FileVisitResult", "postVisitDirectory", "(", "Path", "dir", ",", "IOException", "exc", ")", "throws", "IOException", "{", "Files", ".", "delete", "(", "dir", ")", ";", "return", "FileVisitResult", ".", "CONTINUE", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "RefAllocator", "getRefAllocator", "(", ")", "{", "return", "idAllocator", ".", "getRefAllocator", "(", ")", ";", "}", "</s>"]
["<s>", "public", "RefAllocator", "getRefAllocator", "(", ")", "{", "return", "refAllocator", ";", "}", "</s>"]
["<s>", "private", "void", "handleMessageAllocRef", "(", "Message", ".", "ALLOC_REF", "msg", ")", "{", "final", "int", "num", "=", "msg", ".", "getNum", "(", ")", ";", "final", "long", "end", "=", "refCounter", ".", "getAndAdd", "(", "num", ")", ";", "final", "long", "start", "=", "end", "-", "num", ";", "store", ".", "allocate", "(", "msg", ".", "getNode", "(", ")", ",", "start", ",", "num", ")", ";", "send", "(", "Message", ".", "ALLOCED_REF", "(", "msg", ",", "start", ",", "num", ")", ")", ";", "monitor", ".", "addAllocation", "(", "num", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ALLOC_REF", "ALLOC_REF", "(", "short", "node", ",", "int", "num", ")", "{", "return", "new", "ALLOC_REF", "(", "node", ",", "num", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ALLOCED_REF", "ALLOCED_REF", "(", "ALLOC_REF", "responseTo", ",", "long", "start", ",", "int", "num", ")", "{", "return", "new", "ALLOCED_REF", "(", "responseTo", ",", "start", ",", "num", ")", ";", "}", "</s>"]
["<s>", "public", "int", "getNum", "(", ")", "{", "return", "num", ";", "}", "</s>"]
["<s>", "public", "long", "getStart", "(", ")", "{", "return", "start", ";", "}", "</s>"]
["<s>", "public", "Collection", "<", "RefAllocationsListener", ">", "getRefAllocationListeners", "(", ")", "{", "return", "refAllocationListeners", ";", "}", "</s>"]
["<s>", "public", "void", "setAllocationTableName", "(", "String", "tableName", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "allocationTableName", "=", "tableName", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndNoOwnerThenFindAllocation", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "0", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "-", "1", ")", ")", ";", "when", "(", "store", ".", "findAllocation", "(", "id", "(", "<NUM_LIT>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ";", "final", "LineMessage", "get", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "mm", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "get", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:3>", ")", ",", "true", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testALLOC_REFSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "ALLOC_REF", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextInt", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testALLOCED_REFSer", "(", ")", "{", "final", "ALLOC_REF", "m", "=", "Message", ".", "ALLOC_REF", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextInt", "(", ")", ")", ";", "testSerialize", "(", "Message", ".", "ALLOCED_REF", "(", "m", ",", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextInt", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setTimeout", "(", "long", "timeout", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "timeout", "=", "timeout", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "long", "getTimeout", "(", ")", "{", "return", "timeout", ";", "}", "</s>"]
["<s>", "private", "static", "<", "M", "extends", "Message", ">", "M", "toOutgoing", "(", "M", "m", ",", "short", "node", ")", "{", "m", ".", "setOutgoing", "(", ")", ";", "m", ".", "setMessageId", "(", "-", "1", ")", ";", "m", ".", "setNode", "(", "node", ")", ";", "return", "m", ";", "}", "</s>"]
["<s>", "private", "boolean", "hasPendingBlockingMessages", "(", "CacheLine", "line", ")", "{", "final", "Collection", "<", "LineMessage", ">", "msgs", "=", "pendingMessages", ".", "get", "(", "line", ".", "getId", "(", ")", ")", ";", "if", "(", "msgs", "=", "=", "null", "|", "|", "msgs", ".", "isEmpty", "(", ")", ")", "return", "false", ";", "for", "(", "LineMessage", "m", ":", "msgs", ")", "{", "if", "(", "!", "(", "m", "instanceof", "Message", ".", "MSG", ")", ")", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "void", "registerWriteReplace", "(", "Class", "<", "?", ">", "clazz", ",", "WriteReplace", "wr", ")", "{", "writeReplace", ".", "add", "(", "new", "WriteReplaceEntry", "(", "clazz", ",", "wr", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "writeReplace", "(", "Object", "object", ")", "{", "for", "(", "WriteReplaceEntry", "entry", ":", "writeReplace", ")", "{", "if", "(", "entry", ".", "clazz", ".", "isInstance", "(", "object", ")", ")", "return", "entry", ".", "writeReplace", ".", "writeReplace", "(", "object", ")", ";", "}", "return", "object", ";", "}", "</s>"]
["<s>", "public", "static", "Kryo", "getKryo", "(", ")", "{", "return", "(", "(", "KryoSerializer", ")", "tlInstance", ".", "get", "(", ")", ".", "bas", ")", ".", "getKryo", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Kryo", "getKryo", "(", ")", "{", "return", "kryo", ";", "}", "</s>"]
["<s>", "public", "static", "Serialization", "newInstance", "(", ")", "{", "if", "(", "instance", "!", "=", "null", ")", "return", "instance", ";", "else", "return", "new", "Serialization", "(", "new", "KryoSerializer", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "isCI", "(", ")", "{", "return", "ci", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isEnvTrue", "(", "String", "envVar", ")", "{", "final", "String", "ev", "=", "System", ".", "getenv", "(", "envVar", ")", ";", "if", "(", "ev", "=", "=", "null", ")", "return", "false", ";", "try", "{", "return", "Boolean", ".", "parseBoolean", "(", "ev", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "return", "false", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "isOwnMessage", "(", "Message", "msg", ")", "{", "return", "getAddress", "(", ")", "!", "=", "null", "&", "&", "msg", ".", "getSrc", "(", ")", "!", "=", "null", "&", "&", "getAddress", "(", ")", ".", "equals", "(", "msg", ".", "getSrc", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Message", "fromByteArray", "(", "byte", "[", "]", "array", ",", "int", "offset", ",", "int", "length", ")", "{", "final", "Type", "type", "=", "Type", ".", "values", "(", ")", "[", "array", "[", "offset", "]", "]", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "type", ".", "name", "(", ")", ")", ";", "final", "Message", "message", "=", "newMessage", "(", "type", ")", ";", "message", ".", "read", "(", "array", ",", "offset", "+", "1", ",", "length", "-", "1", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "synchronized", "void", "forEachRollback", "(", "LongObjectProcedure", "<", "RollbackInfo", ">", "proc", ")", "{", "for", "(", "Long2ObjectMap", ".", "Entry", "<", "RollbackInfo", ">", "entry", ":", "rollbackLog", ".", "long2ObjectEntrySet", "(", ")", ")", "proc", ".", "execute", "(", "entry", ".", "getLongKey", "(", ")", ",", "entry", ".", "getValue", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Callable", "<", "Short", ">", "startWaitForLargerPeer", "(", "final", "int", "peerNum", ",", "final", "String", "configpeerxml", ",", "final", "boolean", "withNamaspace", ")", "{", "return", "new", "Callable", "<", "Short", ">", "(", ")", "{", "@", "Override", "public", "Short", "call", "(", ")", "throws", "IOException", ",", "InterruptedException", ",", "ExecutionException", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "peerNum", ")", ";", "Properties", "props", "=", "new", "Properties", "(", ")", ";", "props", ".", "load", "(", "new", "FileInputStream", "(", "pathToResource", "(", "SERVER_PROPS", ")", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", "+", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", "+", "peerNum", ")", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "<NUM_LIT>", ")", ")", ";", "if", "(", "withNamaspace", ")", "{", "props", ".", "setProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "Grid", "grid", "=", "Grid", ".", "getInstance", "(", "pathToResource", "(", "configpeerxml", ")", ",", "props", ")", ";", "grid", ".", "goOnline", "(", ")", ";", "final", "SettableFuture", "<", "Short", ">", "future", "=", "SettableFuture", ".", "create", "(", ")", ";", "grid", ".", "cluster", "(", ")", ".", "addNodeChangeListener", "(", "new", "NodeChangeListener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "if", "(", "id", ">", "grid", ".", "cluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "future", ".", "set", "(", "id", ")", ";", "}", "}", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "}", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "}", "}", ")", ";", "for", "(", "Short", "node", ":", "grid", ".", "cluster", "(", ")", ".", "getNodes", "(", ")", ")", "{", "if", "(", "node", ">", "grid", ".", "cluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "node", ";", "}", "}", "return", "future", ".", "get", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "clusterWithNamespaceAddTest", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "cloud", ".", "node", "(", "SERVER", ")", ".", "submit", "(", "startGlxServer", "(", "SERVER_ZK_CFG", ",", "SERVER_WITH_ZK_NAMESPACE_PROPS", ")", ")", ";", "final", "boolean", "withNamaspace", "=", "true", ";", "cloud", ".", "node", "(", "PEER2", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "<NUM_LIT:2>", ",", "PEER_WITH_ZK_SERVER_CFG", ",", "withNamaspace", ")", ")", ";", "int", "largerID", "=", "cloud", ".", "node", "(", "PEER1", ")", ".", "submit", "(", "startWaitForLargerPeer", "(", "1", ",", "PEER_WITH_ZK_SERVER_CFG", ",", "withNamaspace", ")", ")", ".", "get", "(", ")", ";", "assertEquals", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ",", "largerID", ")", ";", "}", "</s>"]
["<s>", "public", "static", "int", "getWorkerCount", "(", "ThreadPoolExecutor", "workerExecutor", ")", "{", "return", "Math", ".", "min", "(", "workerExecutor", ".", "getMaximumPoolSize", "(", ")", ",", "DEFAULT_IO_THREADS", ")", ";", "}", "</s>"]
["<s>", "private", "void", "resetConnectionState", "(", "Channel", "contextChannel", ")", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "contextChannel", "=", "=", "channel", ")", "{", "setReady", "(", "false", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "channel", ".", "close", "(", ")", ";", "channel", "=", "null", ";", "connectLater", "(", ")", ";", "}", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", "Resource", "configFile", ",", "Resource", "propertiesFile", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "configFile", ",", "(", "Object", ")", "propertiesFile", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", "Resource", "configFile", ",", "Properties", "properties", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "configFile", ",", "(", "Object", ")", "properties", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "start", "(", "Resource", "configFile", ",", "Resource", "propertiesFile", ")", "{", "final", "ApplicationContext", "context", "=", "SpringContainerHelper", ".", "createContext", "(", "\"", "<STR_LIT>", "\"", ",", "configFile", "!", "=", "null", "?", "configFile", ":", "new", "ClassPathResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "propertiesFile", ",", "null", ")", ";", "MainMemory", "memory", "=", "context", ".", "getBean", "(", "\"", "<STR_LIT>", "\"", ",", "MainMemory", ".", "class", ")", ";", "(", "(", "AbstractCluster", ")", "memory", ".", "getCluster", "(", ")", ")", ".", "goOnline", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", "URL", "configFile", ",", "URL", "propertiesFile", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "new", "UrlResource", "(", "configFile", ")", ",", "propertiesFile", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", "URL", "configFile", ",", "Properties", "properties", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "new", "UrlResource", "(", "configFile", ")", ",", "properties", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "start", "(", "URL", "configFile", ",", "URL", "propertiesFile", ")", "{", "Resource", "configResource", "=", "configFile", "!", "=", "null", "?", "new", "UrlResource", "(", "configFile", ")", ":", "null", ";", "Resource", "propertiesResource", "=", "propertiesFile", "!", "=", "null", "?", "new", "UrlResource", "(", "propertiesFile", ")", ":", "null", ";", "start", "(", "configResource", ",", "propertiesResource", ")", ";", "}", "</s>"]
