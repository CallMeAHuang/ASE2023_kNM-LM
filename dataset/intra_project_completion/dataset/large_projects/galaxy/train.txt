["<s>", "public", "DistributedTreeTKB", "(", "DistributedTree", "tree", ",", "String", "name", ")", "{", "this", ".", "tree", "=", "tree", ";", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "public", "void", "run", "(", ")", "throws", "Exception", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "print", "(", "\"", "<STR_LIT:/>", "\"", ",", "System", ".", "out", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "addListener", "(", "\"", "<STR_LIT>", "\"", ")", ";", "addListener", "(", "\"", "<STR_LIT>", "\"", ")", ";", "addListener", "(", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "null", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "null", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "print", "(", "\"", "<STR_LIT:/>", "\"", ",", "System", ".", "out", ")", ";", "put", "(", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "delete", "(", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "createEphemeralOrdered", "(", "\"", "<STR_LIT>", "\"", "+", "name", ")", ";", "tree", ".", "create", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", "+", "name", ")", ")", ";", "tree", ".", "create", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", "+", "name", ")", ")", ";", "tree", ".", "set", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", "+", "name", ")", ")", ";", "tree", ".", "create", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", "+", "name", ")", ")", ";", "tree", ".", "delete", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ")", ";", "while", "(", "true", ")", "{", "tree", ".", "print", "(", "\"", "<STR_LIT:/>", "\"", ",", "System", ".", "out", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "put", "(", "String", "node", ",", "boolean", "ephemeral", ",", "String", "data", ")", "throws", "Exception", "{", "tree", ".", "create", "(", "node", ",", "ephemeral", ")", ";", "tree", ".", "set", "(", "node", ",", "data", "!", "=", "null", "?", "serialize", "(", "data", ")", ":", "null", ")", ";", "}", "</s>"]
["<s>", "static", "byte", "[", "]", "serialize", "(", "String", "object", ")", "{", "return", "object", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "static", "String", "deserialize", "(", "byte", "[", "]", "array", ")", "{", "return", "new", "String", "(", "array", ",", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addListener", "(", "final", "String", "node", ")", "{", "tree", ".", "addListener", "(", "node", ",", "new", "Listener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "String", "node", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "node", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "@", "Override", "public", "void", "nodeDeleted", "(", "String", "node", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "child", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "child", ")", ";", "}", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "child", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "child", ")", ";", "}", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "child", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "child", ")", ";", "}", "private", "void", "event", "(", "String", "event", ",", "String", "node", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "event", ")", ";", "}", "private", "void", "event", "(", "String", "event", ",", "String", "node", ",", "String", "child", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "child", "+", "\"", "<STR_LIT>", "\"", "+", "event", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "String", "node", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "node", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeDeleted", "(", "String", "node", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "child", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "child", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "child", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "child", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "child", ")", "{", "event", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "child", ")", ";", "}", "</s>"]
["<s>", "private", "void", "event", "(", "String", "event", ",", "String", "node", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "event", ")", ";", "}", "</s>"]
["<s>", "private", "void", "event", "(", "String", "event", ",", "String", "node", ",", "String", "child", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "child", "+", "\"", "<STR_LIT>", "\"", "+", "event", ")", ";", "}", "</s>"]
["<s>", "public", "LocalTree", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addListener", "(", "String", "node", ",", "Listener", "listener", ")", "{", "final", "Node", "n", "=", "findNode", "(", "node", ")", ";", "if", "(", "n", "=", "=", "null", ")", "pendingListeners", ".", "put", "(", "node", ",", "listener", ")", ";", "else", "n", ".", "addListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeListener", "(", "String", "node", ",", "Listener", "listener", ")", "{", "final", "Node", "n", "=", "findNode", "(", "node", ")", ";", "if", "(", "n", "=", "=", "null", ")", "pendingListeners", ".", "remove", "(", "node", ",", "listener", ")", ";", "else", "n", ".", "removeListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "create", "(", "String", "fqn", ",", "boolean", "ephemeral", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", ";", "findNode", "(", "fqn", ",", "true", ",", "ephemeral", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "createEphemeralOrdered", "(", "String", "fqn", ")", "{", "create", "(", "fqn", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "String", "fqn", ",", "byte", "[", "]", "data", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", ";", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "!", "=", "null", "&", "&", "(", "(", "n", ".", "getData", "(", ")", "=", "=", "null", "&", "&", "data", "!", "=", "null", ")", "|", "|", "!", "Arrays", ".", "equals", "(", "n", ".", "getData", "(", ")", ",", "data", ")", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "n", ".", "setData", "(", "data", ")", ";", "}", "else", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "String", "fqn", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", ";", "if", "(", "fqn", ".", "equals", "(", "SSEPARATOR", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "root", ".", "removeAll", "(", ")", ";", "return", ";", "}", "final", "Node", "parent", "=", "findNode", "(", "parent", "(", "fqn", ")", ")", ";", "if", "(", "parent", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "parent", "(", "fqn", ")", ",", "fqn", ")", ";", "return", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "parent", ".", "removeChild", "(", "child", "(", "fqn", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "flush", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "exists", "(", "String", "fqn", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", "false", ";", "return", "findNode", "(", "fqn", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "get", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "final", "byte", "[", "]", "buffer", "=", "n", ".", "getData", "(", ")", ";", "if", "(", "buffer", "=", "=", "null", ")", "return", "null", ";", "return", "Arrays", ".", "copyOf", "(", "buffer", ",", "buffer", ".", "length", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "getChildren", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "final", "Set", "<", "String", ">", "names", "=", "n", ".", "getChildrenNames", "(", ")", ";", "return", "new", "ArrayList", "<", "String", ">", "(", "names", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "print", "(", "String", "fqn", ",", "PrintStream", "out", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", ";", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "n", ".", "print", "(", "sb", ",", "0", ")", ";", "out", ".", "println", "(", "sb", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "String", "toString", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "return", "n", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "root", ".", "print", "(", "sb", ",", "0", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Node", "findNode", "(", "String", "fqn", ",", "boolean", "create", ",", "boolean", "ephemeral", ")", "{", "if", "(", "fqn", "=", "=", "null", "|", "|", "fqn", ".", "equals", "(", "SSEPARATOR", ")", "|", "|", "\"", "\"", ".", "equals", "(", "fqn", ")", ")", "return", "root", ";", "final", "Scanner", "scanner", "=", "new", "Scanner", "(", "fqn", ")", ".", "useDelimiter", "(", "SSEPARATOR", ")", ";", "Node", "curr", "=", "root", ";", "while", "(", "scanner", ".", "hasNext", "(", ")", ")", "{", "final", "String", "name", "=", "scanner", ".", "next", "(", ")", ";", "Node", "node", "=", "curr", ".", "getChild", "(", "name", ")", ";", "if", "(", "create", ")", "{", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "curr", ".", "fqn", "+", "(", "!", "curr", ".", "fqn", ".", "equals", "(", "SSEPARATOR", ")", "?", "SEPARATOR", ":", "\"", "\"", ")", "+", "name", ")", ";", "node", "=", "curr", ".", "createChild", "(", "name", ",", "ephemeral", ",", "null", ")", ";", "}", "else", "{", "if", "(", "node", ".", "isEphemeral", "(", ")", ")", "{", "if", "(", "!", "ephemeral", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "fqn", ")", ";", "node", ".", "setNotEphemeral", "(", ")", ";", "}", "}", "}", "}", "if", "(", "node", "=", "=", "null", ")", "return", "null", ";", "else", "curr", "=", "node", ";", "}", "return", "curr", ";", "}", "</s>"]
["<s>", "private", "Node", "findNode", "(", "String", "fqn", ")", "{", "return", "findNode", "(", "fqn", ",", "false", ",", "false", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "parent", "(", "String", "fqn", ")", "{", "final", "int", "index", "=", "fqn", ".", "lastIndexOf", "(", "SEPARATOR", ")", ";", "if", "(", "index", "<", "0", ")", "return", "null", ";", "final", "String", "parent", "=", "fqn", ".", "substring", "(", "0", ",", "index", ")", ";", "return", "parent", ";", "}", "</s>"]
["<s>", "public", "static", "String", "child", "(", "String", "fqn", ")", "{", "final", "int", "index", "=", "fqn", ".", "lastIndexOf", "(", "SEPARATOR", ")", ";", "if", "(", "index", "<", "0", "|", "|", "index", "=", "=", "fqn", ".", "length", "(", ")", "-", "1", ")", "return", "null", ";", "final", "String", "child", "=", "fqn", ".", "substring", "(", "index", "+", "1", ",", "fqn", ".", "length", "(", ")", ")", ";", "return", "child", ";", "}", "</s>"]
["<s>", "Node", "(", "String", "childName", ",", "String", "fqn", ",", "Node", "parent", ",", "boolean", "ephemeral", ",", "byte", "[", "]", "data", ")", "{", "this", ".", "name", "=", "childName", ";", "this", ".", "fqn", "=", "fqn", ";", "this", ".", "parent", "=", "parent", ";", "this", ".", "ephemeral", "=", "ephemeral", ";", "this", ".", "data", "=", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ";", "}", "</s>"]
["<s>", "boolean", "isEphemeral", "(", ")", "{", "return", "ephemeral", ";", "}", "</s>"]
["<s>", "void", "setNotEphemeral", "(", ")", "{", "ephemeral", "=", "false", ";", "}", "</s>"]
["<s>", "synchronized", "byte", "[", "]", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "final", "synchronized", "void", "setData", "(", "byte", "[", "]", "data", ")", "{", "this", ".", "data", "=", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ";", "notifyNodeModified", "(", ")", ";", "}", "</s>"]
["<s>", "synchronized", "Map", "<", "String", ",", "Node", ">", "getChildren", "(", ")", "{", "return", "children", "!", "=", "null", "?", "children", ":", "(", "Map", "<", "String", ",", "Node", ">", ")", "Collections", ".", "EMPTY_MAP", ";", "}", "</s>"]
["<s>", "synchronized", "Set", "<", "String", ">", "getChildrenNames", "(", ")", "{", "return", "children", "!", "=", "null", "?", "Collections", ".", "unmodifiableSet", "(", "children", ".", "keySet", "(", ")", ")", ":", "(", "Set", "<", "String", ">", ")", "Collections", ".", "EMPTY_SET", ";", "}", "</s>"]
["<s>", "synchronized", "Node", "getChild", "(", "String", "childName", ")", "{", "return", "childName", "=", "=", "null", "?", "null", ":", "children", "=", "=", "null", "?", "null", ":", "children", ".", "get", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "synchronized", "boolean", "hasChild", "(", "String", "childName", ")", "{", "return", "childName", "!", "=", "null", "&", "&", "children", "!", "=", "null", "&", "&", "children", ".", "containsKey", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "private", "synchronized", "Node", "addChild", "(", "Node", "child", ")", "{", "assert", "fqn", ".", "equals", "(", "parent", "(", "child", ".", "fqn", ")", ")", "|", "|", "(", "fqn", ".", "equals", "(", "\"", "<STR_LIT:/>", "\"", ")", "&", "&", "parent", "(", "child", ".", "fqn", ")", ".", "equals", "(", "\"", "\"", ")", ")", ";", "if", "(", "children", "=", "=", "null", ")", "children", "=", "new", "LinkedHashMap", "<", "String", ",", "Node", ">", "(", ")", ";", "children", ".", "put", "(", "child", ".", "name", ",", "child", ")", ";", "child", ".", "notifyNodeAdded", "(", ")", ";", "return", "child", ";", "}", "</s>"]
["<s>", "synchronized", "Node", "createChild", "(", "String", "childName", ",", "boolean", "ephemeral", ",", "byte", "[", "]", "data", ")", "{", "if", "(", "childName", "=", "=", "null", ")", "return", "null", ";", "assert", "children", "=", "=", "null", "|", "|", "!", "children", ".", "containsKey", "(", "childName", ")", ";", "final", "Node", "child", "=", "new", "Node", "(", "childName", ",", "(", "!", "fqn", ".", "equals", "(", "SSEPARATOR", ")", "?", "fqn", ":", "\"", "\"", ")", "+", "SEPARATOR", "+", "childName", ",", "this", ",", "ephemeral", ",", "data", ")", ";", "for", "(", "Listener", "listener", ":", "pendingListeners", ".", "removeAll", "(", "child", ".", "fqn", ")", ")", "child", ".", "addListener", "(", "listener", ")", ";", "addChild", "(", "child", ")", ";", "return", "child", ";", "}", "</s>"]
["<s>", "synchronized", "Node", "removeChild", "(", "String", "childName", ")", "{", "if", "(", "childName", "!", "=", "null", "&", "&", "children", "!", "=", "null", ")", "{", "final", "Node", "child", "=", "children", ".", "remove", "(", "childName", ")", ";", "child", ".", "notifyNodeRemoved", "(", ")", ";", "return", "child", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "synchronized", "void", "removeAll", "(", ")", "{", "children", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "addListener", "(", "Listener", "listener", ")", "{", "synchronized", "(", "this", ")", "{", "if", "(", "listeners", "=", "=", "null", ")", "listeners", "=", "new", "CopyOnWriteArrayList", "<", "Listener", ">", "(", ")", ";", "}", "if", "(", "!", "listeners", ".", "contains", "(", "listener", ")", ")", "listeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeListener", "(", "Listener", "listener", ")", "{", "synchronized", "(", "this", ")", "{", "if", "(", "listeners", "=", "=", "null", ")", "return", ";", "}", "listeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "void", "notifyNodeAdded", "(", ")", "{", "if", "(", "listeners", "!", "=", "null", ")", "{", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeAdded", "(", "fqn", ")", ";", "}", "if", "(", "parent", "!", "=", "null", "&", "&", "parent", ".", "listeners", "!", "=", "null", ")", "{", "for", "(", "Listener", "listener", ":", "parent", ".", "listeners", ")", "listener", ".", "nodeChildAdded", "(", "parent", ".", "fqn", ",", "name", ")", ";", "}", "}", "</s>"]
["<s>", "void", "notifyNodeRemoved", "(", ")", "{", "notifyNodeRemoved1", "(", ")", ";", "if", "(", "parent", "!", "=", "null", "&", "&", "parent", ".", "listeners", "!", "=", "null", ")", "{", "for", "(", "Listener", "listener", ":", "parent", ".", "listeners", ")", "listener", ".", "nodeChildDeleted", "(", "parent", ".", "fqn", ",", "name", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "notifyNodeRemoved1", "(", ")", "{", "if", "(", "children", "!", "=", "null", ")", "{", "for", "(", "Node", "child", ":", "children", ".", "values", "(", ")", ")", "child", ".", "notifyNodeRemoved1", "(", ")", ";", "}", "if", "(", "listeners", "!", "=", "null", ")", "{", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeDeleted", "(", "fqn", ")", ";", "}", "}", "</s>"]
["<s>", "void", "notifyNodeModified", "(", ")", "{", "if", "(", "listeners", "!", "=", "null", "&", "&", "parent", ".", "listeners", "!", "=", "null", ")", "{", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeUpdated", "(", "fqn", ")", ";", "}", "if", "(", "parent", "!", "=", "null", "&", "&", "parent", ".", "listeners", "!", "=", "null", ")", "{", "for", "(", "Listener", "listener", ":", "parent", ".", "listeners", ")", "listener", ".", "nodeChildUpdated", "(", "parent", ".", "fqn", ",", "name", ")", ";", "}", "}", "</s>"]
["<s>", "synchronized", "StringBuilder", "print", "(", "StringBuilder", "sb", ",", "int", "indent", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "indent", ";", "i", "+", "+", ")", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ";", "sb", ".", "append", "(", "SEPARATOR", ")", ".", "append", "(", "name", ")", ";", "if", "(", "children", "!", "=", "null", ")", "{", "for", "(", "Node", "n", ":", "children", ".", "values", "(", ")", ")", "{", "sb", ".", "append", "(", "<STR_LIT:\\n>", ")", ";", "n", ".", "print", "(", "sb", ",", "indent", "+", "INDENT", ")", ";", "}", "}", "return", "sb", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", "+", "fqn", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "data", ")", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "public", "MessageDeepEqualTo", "(", "Message", "message", ")", "{", "super", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matchesSafely", "(", "Message", "item", ")", "{", "return", "equals", "(", "message", ",", "item", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "equals", "(", "Message", "m1", ",", "Message", "m2", ")", "{", "if", "(", "m1", "=", "=", "null", ")", "return", "m2", "=", "=", "null", ";", "if", "(", "m2", "=", "=", "null", ")", "return", "false", ";", "if", "(", "m2", "=", "=", "m1", ")", "return", "true", ";", "if", "(", "!", "(", "m1", ".", "getType", "(", ")", "=", "=", "m2", ".", "getType", "(", ")", "&", "&", "m1", ".", "isResponse", "(", ")", "=", "=", "m2", ".", "isResponse", "(", ")", "&", "&", "m1", ".", "getMessageId", "(", ")", "=", "=", "m2", ".", "getMessageId", "(", ")", ")", ")", "return", "false", ";", "if", "(", "!", "m1", ".", "getClass", "(", ")", ".", "equals", "(", "m2", ".", "getClass", "(", ")", ")", ")", "return", "false", ";", "return", "fieldEqual", "(", "m1", ",", "m2", ",", "m1", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "fieldEqual", "(", "Object", "a", ",", "Object", "b", ",", "Class", "clazz", ")", "{", "if", "(", "clazz", ".", "equals", "(", "Message", ".", "class", ")", ")", "return", "true", ";", "if", "(", "!", "fieldEqual", "(", "a", ",", "b", ",", "clazz", ".", "getSuperclass", "(", ")", ")", ")", "return", "false", ";", "try", "{", "for", "(", "Field", "field", ":", "clazz", ".", "getDeclaredFields", "(", ")", ")", "{", "field", ".", "setAccessible", "(", "true", ")", ";", "if", "(", "!", "equals", "(", "field", ".", "get", "(", "a", ")", ",", "field", ".", "get", "(", "b", ")", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "boolean", "equals", "(", "Object", "a", ",", "Object", "b", ")", "{", "if", "(", "a", "=", "=", "b", ")", "return", "true", ";", "if", "(", "a", "=", "=", "null", "|", "|", "b", "=", "=", "null", ")", "return", "false", ";", "if", "(", "a", ".", "getClass", "(", ")", ".", "isArray", "(", ")", ")", "return", "Objects", ".", "deepEquals", "(", "a", ",", "b", ")", ";", "else", "return", "a", ".", "equals", "(", "b", ")", ";", "}", "</s>"]
["<s>", "public", "NodeInfoPropertyEqual", "(", "String", "property", ",", "Object", "value", ")", "{", "super", "(", "NodeInfo", ".", "class", ")", ";", "this", ".", "property", "=", "property", ";", "this", ".", "value", "=", "value", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matchesSafely", "(", "NodeInfo", "item", ")", "{", "if", "(", "item", "=", "=", "null", ")", "return", "false", ";", "if", "(", "property", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "return", "new", "Short", "(", "item", ".", "getNodeId", "(", ")", ")", ".", "equals", "(", "value", ")", ";", "if", "(", "property", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ")", "return", "item", ".", "getName", "(", ")", ".", "equals", "(", "value", ")", ";", "final", "Object", "actualValue", "=", "item", ".", "get", "(", "property", ")", ";", "if", "(", "actualValue", "=", "=", "value", ")", "return", "true", ";", "if", "(", "value", "!", "=", "null", ")", "return", "value", ".", "equals", "(", "actualValue", ")", ";", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "\"", "<STR_LIT>", "\"", "+", "property", "+", "\"", "<STR_LIT>", "\"", "+", "value", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "tree", "=", "new", "LocalTree", "(", ")", ";", "cluster", "=", "new", "AbstractCluster", "(", "\"", "<STR_LIT>", "\"", ",", "MY_ID", ")", "{", "@", "Override", "protected", "boolean", "isMe", "(", "NodeInfoImpl", "node", ")", "{", "return", "node", ".", "getName", "(", ")", ".", "equals", "(", "MY_NAME", ")", ";", "}", "@", "Override", "public", "boolean", "hasServer", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "@", "Override", "public", "Object", "getUnderlyingResource", "(", ")", "{", "return", "null", ";", "}", "}", ";", "cluster", ".", "setName", "(", "MY_NAME", ")", ";", "cluster", ".", "setControlTree", "(", "tree", ")", ";", "lifecycleListener", "=", "mock", "(", "LifecycleListener", ".", "class", ")", ";", "cluster", ".", "addLifecycleListener", "(", "lifecycleListener", ")", ";", "nodeListener", "=", "mock", "(", "NodeChangeListener", ".", "class", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "nodeListener", ")", ";", "slaveListener", "=", "mock", "(", "SlaveConfigurationListener", ".", "class", ")", ";", "cluster", ".", "addSlaveConfigurationListener", "(", "slaveListener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isMe", "(", "NodeInfoImpl", "node", ")", "{", "return", "node", ".", "getName", "(", ")", ".", "equals", "(", "MY_NAME", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasServer", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "getUnderlyingResource", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSetRequiredPropery", "(", ")", "throws", "Exception", "{", "tree", "=", "spy", "(", "tree", ")", ";", "cluster", ".", "setControlTree", "(", "tree", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "true", ",", "ReaderWriters", ".", "STRING", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "true", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "cluster", ".", "postInit", "(", ")", ";", "assertThat", "(", "(", "String", ")", "cluster", ".", "getMyNodeInfo", "(", ")", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "(", "Integer", ")", "cluster", ".", "getMyNodeInfo", "(", ")", ".", "get", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", ",", "true", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "verify", "(", "tree", ")", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "Short", ".", "toString", "(", "MY_ID", ")", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "verify", "(", "tree", ")", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "verify", "(", "tree", ")", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "verify", "(", "tree", ")", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenMissingRequiredPropertiesThenFailInit", "(", ")", "throws", "Exception", "{", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "true", ",", "ReaderWriters", ".", "STRING", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "true", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "cluster", ".", "postInit", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "}", "verify", "(", "lifecycleListener", ",", "never", "(", ")", ")", ".", "online", "(", "anyBoolean", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenDuplicateNameThenFailInit", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "MY_ID", ")", ";", "try", "{", "init", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "}", "verify", "(", "lifecycleListener", ",", "never", "(", ")", ")", ".", "online", "(", "anyBoolean", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenFirstOnlineThenMaster", "(", ")", "{", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "true", ")", ";", "assertThat", "(", "cluster", ".", "getMyMaster", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNotFirstOnlineThenSlave", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "MY_ID", ")", ";", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "false", ")", ";", "assertThat", "(", "cluster", ".", "getMyMaster", "(", ")", ".", "getName", "(", ")", ",", "is", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNodes", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:10>", ")", ";", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeRemoved", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testRecoverFromNodeThatFailsToInit1", "(", ")", "{", "addBadNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:10>", ")", ";", "init", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "lifecycleListener", ",", "never", "(", ")", ")", ".", "online", "(", "anyBoolean", "(", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "true", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testRecoverFromNodeThatFailsToInit2", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:10>", ")", ";", "addBadNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:20>", ")", ";", "init", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "lifecycleListener", ",", "never", "(", ")", ")", ".", "online", "(", "anyBoolean", "(", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "true", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "testRecoverFromNodeThatFailsToInit3", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:10>", ")", ";", "init", "(", ")", ";", "addBadNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "true", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "true", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMySlaves", "(", ")", "{", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:11>", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:12>", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "slaveListener", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "list", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveRemoved", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "list", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testOtherNodeSwitchover", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:10>", ")", ";", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ";", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ")", ";", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "<NUM_LIT:30>", ")", ";", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ";", "addNode", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeAdded", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeRemoved", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:3>", "\"", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeSwitched", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "nodeListener", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "nodeSwitched", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeRemoved", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "nodeListener", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeSwitched", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "nodeListener", ")", ".", "nodeRemoved", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "Collections", ".", "EMPTY_SET", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSwitchover", "(", ")", "{", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:3>", "\"", ",", "MY_ID", ")", ";", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:4>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:5>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:6>", "\"", ",", "MY_ID", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "online", "(", "false", ")", ";", "assertThat", "(", "cluster", ".", "getMyMaster", "(", ")", ".", "getName", "(", ")", ",", "is", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "Collections", ".", "EMPTY_LIST", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:2>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "slaveListener", ")", ";", "removeNode", "(", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "slaveListener", ")", ".", "newMaster", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:3>", "\"", ")", ")", ")", ";", "assertThat", "(", "cluster", ".", "getMyMaster", "(", ")", ".", "getName", "(", ")", ",", "is", "(", "\"", "<STR_LIT:3>", "\"", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "Collections", ".", "EMPTY_LIST", ")", ")", ";", "removeNode", "(", "\"", "<STR_LIT:3>", "\"", ")", ";", "verify", "(", "lifecycleListener", ")", ".", "switchToMaster", "(", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:4>", "\"", ")", ")", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:5>", "\"", ")", ")", ")", ";", "verify", "(", "slaveListener", ")", ".", "slaveAdded", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:6>", "\"", ")", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "list", "(", "\"", "<STR_LIT:4>", "\"", ",", "\"", "<STR_LIT:5>", "\"", ",", "\"", "<STR_LIT:6>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSetNodeProperty", "(", ")", "{", "tree", "=", "spy", "(", "tree", ")", ";", "cluster", ".", "setControlTree", "(", "tree", ")", ";", "init", "(", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT:?>", "\"", ",", "false", ",", "false", ",", "ReaderWriters", ".", "STRING", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT:?>", "\"", ",", "false", ",", "false", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT:?>", "\"", ",", "\"", "<STR_LIT:!>", "\"", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT:?>", "\"", ",", "<NUM_LIT:20>", ")", ";", "assertThat", "(", "(", "String", ")", "cluster", ".", "getMyNodeInfo", "(", ")", ".", "get", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "is", "(", "\"", "<STR_LIT:!>", "\"", ")", ")", ";", "assertThat", "(", "(", "Integer", ")", "cluster", ".", "getMyNodeInfo", "(", ")", ".", "get", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "is", "(", "<NUM_LIT:20>", ")", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "verify", "(", "tree", ")", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:!>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "verify", "(", "tree", ")", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "verify", "(", "tree", ")", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "MY_NAME", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNodePropertyListeners", "(", ")", "{", "init", "(", ")", ";", "cluster", ".", "goOnline", "(", ")", ";", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "<NUM_LIT:10>", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "<NUM_LIT:20>", ")", ";", "addNode", "(", "\"", "<STR_LIT:1>", "\"", ",", "MY_ID", ")", ";", "addNode", "(", "\"", "<STR_LIT:2>", "\"", ",", "MY_ID", ")", ";", "assertThat", "(", "set", "(", "names", "(", "cluster", ".", "getMasters", "(", ")", ")", ")", ",", "equalTo", "(", "set", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "assertThat", "(", "names", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ",", "equalTo", "(", "list", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT:?>", "\"", ",", "false", ",", "false", ",", "ReaderWriters", ".", "STRING", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT:?>", "\"", ",", "false", ",", "false", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "NodePropertyListener", "listener1", "=", "mock", "(", "NodePropertyListener", ".", "class", ")", ";", "NodePropertyListener", "listener2", "=", "mock", "(", "NodePropertyListener", ".", "class", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "cluster", ".", "addMasterNodePropertyListener", "(", "\"", "<STR_LIT:?>", "\"", ",", "listener1", ")", ";", "cluster", ".", "addSlaveNodePropertyListener", "(", "\"", "<STR_LIT:?>", "\"", ",", "listener2", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "verify", "(", "listener1", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "eq", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verifyNoMoreInteractions", "(", "listener1", ")", ";", "verify", "(", "listener2", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "eq", "(", "<NUM_LIT>", ")", ")", ";", "verifyNoMoreInteractions", "(", "listener2", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "verify", "(", "listener1", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "argThat", "(", "is", "(", "nullValue", "(", ")", ")", ")", ")", ";", "verify", "(", "listener1", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "eq", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verifyNoMoreInteractions", "(", "listener1", ")", ";", "verify", "(", "listener2", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "argThat", "(", "is", "(", "nullValue", "(", ")", ")", ")", ")", ";", "verify", "(", "listener2", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "eq", "(", "<NUM_LIT>", ")", ")", ";", "verifyNoMoreInteractions", "(", "listener2", ")", ";", "tree", ".", "delete", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "delete", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "delete", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "delete", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "listener1", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "argThat", "(", "is", "(", "nullValue", "(", ")", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "listener1", ")", ";", "verify", "(", "listener2", ")", ".", "propertyChanged", "(", "argThat", "(", "withPropertyEqualTo", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ")", ",", "eq", "(", "\"", "<STR_LIT:?>", "\"", ")", ",", "argThat", "(", "is", "(", "nullValue", "(", ")", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "listener2", ")", ";", "}", "</s>"]
["<s>", "void", "init", "(", ")", "{", "try", "{", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "true", ",", "ReaderWriters", ".", "STRING", ")", ";", "cluster", ".", "addNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "true", ",", "true", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cluster", ".", "setNodeProperty", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "cluster", ".", "postInit", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "void", "addNode", "(", "String", "name", ",", "int", "id", ")", "{", "addNode", "(", "name", ",", "id", ",", "\"", "<STR_LIT:->", "\"", "+", "name", "+", "\"", "<STR_LIT:->", "\"", ",", "name", ".", "hashCode", "(", ")", ")", ";", "}", "</s>"]
["<s>", "void", "addNode", "(", "String", "name", ",", "int", "id", ",", "String", "foo", ",", "int", "bar", ")", "{", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", ",", "true", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "Short", ".", "toString", "(", "(", "short", ")", "id", ")", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "foo", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "bar", ")", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "void", "addBadNode", "(", "String", "name", ",", "int", "id", ")", "{", "int", "bar", "=", "<NUM_LIT>", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", ",", "true", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "Short", ".", "toString", "(", "(", "short", ")", "id", ")", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", ",", "Integer", ".", "toString", "(", "bar", ")", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "tree", ".", "create", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", ",", "true", ")", ";", "}", "</s>"]
["<s>", "void", "removeNode", "(", "String", "name", ")", "{", "tree", ".", "delete", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", ")", ";", "tree", ".", "delete", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "name", ")", ";", "}", "</s>"]
["<s>", "static", "short", "sh", "(", "int", "x", ")", "{", "return", "(", "short", ")", "x", ";", "}", "</s>"]
["<s>", "static", "short", "[", "]", "sh", "(", "int", ".", ".", ".", "args", ")", "{", "final", "short", "[", "]", "array", "=", "new", "short", "[", "args", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "short", ")", "args", "[", "i", "]", ";", "return", "array", ";", "}", "</s>"]
["<s>", "static", "List", "<", "String", ">", "names", "(", "Collection", "<", "NodeInfo", ">", "nis", ")", "{", "List", "<", "String", ">", "names", "=", "new", "ArrayList", "<", "String", ">", "(", "nis", ".", "size", "(", ")", ")", ";", "for", "(", "NodeInfo", "ni", ":", "nis", ")", "names", ".", "add", "(", "ni", ".", "getName", "(", ")", ")", ";", "return", "names", ";", "}", "</s>"]
["<s>", "static", "List", "<", "Short", ">", "ids", "(", "Collection", "<", "NodeInfo", ">", "nis", ")", "{", "List", "<", "Short", ">", "ids", "=", "new", "ArrayList", "<", "Short", ">", "(", "nis", ".", "size", "(", ")", ")", ";", "for", "(", "NodeInfo", "ni", ":", "nis", ")", "ids", ".", "add", "(", "ni", ".", "getNodeId", "(", ")", ")", ";", "return", "ids", ";", "}", "</s>"]
["<s>", "static", "<", "T", ">", "Set", "<", "T", ">", "set", "(", "T", ".", ".", ".", "es", ")", "{", "return", "new", "HashSet", "<", "T", ">", "(", "Arrays", ".", "asList", "(", "es", ")", ")", ";", "}", "</s>"]
["<s>", "static", "<", "T", ">", "Set", "<", "T", ">", "set", "(", "Collection", "<", "T", ">", "es", ")", "{", "return", "new", "HashSet", "<", "T", ">", "(", "es", ")", ";", "}", "</s>"]
["<s>", "static", "<", "T", ">", "List", "<", "T", ">", "list", "(", "T", ".", ".", ".", "es", ")", "{", "return", "Arrays", ".", "asList", "(", "es", ")", ";", "}", "</s>"]
["<s>", "static", "void", "pending", "(", ")", "{", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "MockDistributedTree", "(", ")", "{", "this", ".", "tree", "=", "mock", "(", "DistributedTree", ".", "class", ")", ";", "when", "(", "tree", ".", "getChildren", "(", "any", "(", "String", ".", "class", ")", ")", ")", ".", "thenAnswer", "(", "new", "Answer", "<", "List", "<", "String", ">", ">", "(", ")", "{", "@", "Override", "public", "List", "<", "String", ">", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "return", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "return", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Listener", "getListener", "(", "String", "path", ")", "{", "try", "{", "return", "(", "Listener", ")", "capture", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "path", ",", "arg", "(", "Listener", ".", "class", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "private", "String", "join", "(", "String", "[", "]", "pathElements", ",", "int", "length", ")", "{", "return", "joiner", ".", "join", "(", "Arrays", ".", "copyOf", "(", "pathElements", ",", "length", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "add", "(", "String", ".", ".", ".", "pathElements", ")", "{", "final", "String", "parentPath", "=", "join", "(", "pathElements", ",", "pathElements", ".", "length", "-", "1", ")", ";", "final", "String", "child", "=", "pathElements", "[", "pathElements", ".", "length", "-", "1", "]", ";", "addToList", "(", "parentPath", ",", "child", ")", ";", "final", "Listener", "listener", "=", "getListener", "(", "parentPath", ")", ";", "if", "(", "listener", "!", "=", "null", ")", "listener", ".", "nodeChildAdded", "(", "parentPath", ",", "child", ")", ";", "}", "</s>"]
["<s>", "public", "void", "remove", "(", "String", ".", ".", ".", "pathElements", ")", "{", "final", "String", "parentPath", "=", "join", "(", "pathElements", ",", "pathElements", ".", "length", "-", "1", ")", ";", "final", "String", "child", "=", "pathElements", "[", "pathElements", ".", "length", "-", "1", "]", ";", "removeFromList", "(", "parentPath", ",", "child", ")", ";", "final", "Listener", "listener", "=", "getListener", "(", "parentPath", ")", ";", "if", "(", "listener", "!", "=", "null", ")", "listener", ".", "nodeChildDeleted", "(", "parentPath", ",", "child", ")", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "String", ".", ".", ".", "args", ")", "{", "final", "String", "parentPath", "=", "join", "(", "args", ",", "args", ".", "length", "-", "<NUM_LIT:2>", ")", ";", "final", "String", "child", "=", "args", "[", "args", ".", "length", "-", "<NUM_LIT:2>", "]", ";", "final", "String", "value", "=", "args", "[", "args", ".", "length", "-", "1", "]", ";", "setValue", "(", "parentPath", "+", "<CHAR_LIT:/>", "+", "child", ",", "value", ")", ";", "final", "Listener", "listener", "=", "getListener", "(", "parentPath", ")", ";", "if", "(", "listener", "!", "=", "null", ")", "listener", ".", "nodeChildUpdated", "(", "parentPath", ",", "child", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addToList", "(", "String", "path", ",", "String", "child", ")", "{", "List", "<", "String", ">", "children", "=", "tree", ".", "getChildren", "(", "path", ")", ";", "if", "(", "children", "=", "=", "null", ")", "children", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "when", "(", "tree", ".", "getChildren", "(", "path", ")", ")", ".", "thenReturn", "(", "children", ")", ";", "children", ".", "add", "(", "child", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removeFromList", "(", "String", "path", ",", "String", "child", ")", "{", "List", "<", "String", ">", "children", "=", "tree", ".", "getChildren", "(", "path", ")", ";", "if", "(", "children", "!", "=", "null", ")", "children", ".", "remove", "(", "child", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setValue", "(", "String", "path", ",", "String", "value", ")", "{", "when", "(", "tree", ".", "get", "(", "path", ")", ")", ".", "thenReturn", "(", "toBuffer", "(", "value", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setValue", "(", "String", "path", ",", "byte", "[", "]", "value", ")", "{", "when", "(", "tree", ".", "get", "(", "path", ")", ")", ".", "thenReturn", "(", "value", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "toString", "(", "byte", "[", "]", "buffer", ")", "{", "return", "new", "String", "(", "buffer", ",", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "public", "static", "byte", "[", "]", "toBuffer", "(", "String", "str", ")", "{", "return", "str", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "public", "MainMemoryTest", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "cluster", "=", "mock", "(", "Cluster", ".", "class", ")", ";", "when", "(", "cluster", ".", "hasServer", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "store", "=", "mock", "(", "MainMemoryDB", ".", "class", ")", ";", "comm", "=", "mock", "(", "Comm", ".", "class", ")", ";", "monitor", "=", "mock", "(", "MainMemoryMonitor", ".", "class", ")", ";", "mm", "=", "new", "MainMemory", "(", "\"", "<STR_LIT>", "\"", ",", "cluster", ",", "store", ",", "comm", ",", "monitor", ")", ";", "verify", "(", "monitor", ")", ".", "setMonitoredObject", "(", "mm", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenINVThenMarkOwnerAndINVACK", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:5>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "final", "Message", ".", "INV", "inv", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "mm", ".", "receive", "(", "inv", ")", ";", "verify", "(", "store", ")", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:5>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INVACK", "(", "inv", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addOwnerWrite", "(", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenINVAndWrongPreviousOwnerThenINV", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:5>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "final", "Message", ".", "INV", "inv", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "mm", ".", "receive", "(", "inv", ")", ";", "verify", "(", "store", ")", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:5>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "inv", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addOwnerServed", "(", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndHasOwnerThenReplyCHNGD_OWNR", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "0", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ";", "final", "LineMessage", "get", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "mm", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "get", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:3>", ")", ",", "true", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addOwnerServed", "(", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndNoOwnerThenReplyNOT_FOUND", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "0", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "-", "1", ")", ")", ";", "final", "LineMessage", "get", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "mm", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "NOT_FOUND", "(", "get", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndServerIsOwnerThenReplyPUTX", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "0", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "when", "(", "store", ".", "read", "(", "id", "(", "<NUM_LIT>", ")", ")", ")", ".", "thenReturn", "(", "new", "MainMemoryEntry", "(", "<NUM_LIT>", ",", "new", "byte", "[", "]", "{", "<NUM_LIT:3>", ",", "<NUM_LIT:4>", ",", "<NUM_LIT:5>", "}", ")", ")", ";", "final", "LineMessage", "get", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "mm", ".", "receive", "(", "get", ")", ";", "verify", "(", "store", ")", ".", "casOwner", "(", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "0", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "store", ")", ".", "read", "(", "id", "(", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "get", ",", "id", "(", "<NUM_LIT>", ")", ",", "new", "short", "[", "0", "]", ",", "<NUM_LIT>", ",", "ByteBuffer", ".", "wrap", "(", "new", "byte", "[", "]", "{", "<NUM_LIT:3>", ",", "<NUM_LIT:4>", ",", "<NUM_LIT:5>", "}", ")", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addObjectServed", "(", ")", ";", "verify", "(", "monitor", ")", ".", "addOwnerWrite", "(", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETReservedAndNoOwnerThenCreateAndReplyPUTX", "(", ")", "throws", "Exception", "{", "when", "(", "store", ".", "casOwner", "(", "<NUM_LIT:15>", ",", "sh", "(", "-", "1", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "final", "LineMessage", "get", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:15>", ")", ";", "mm", ".", "receive", "(", "get", ")", ";", "verify", "(", "store", ")", ".", "casOwner", "(", "<NUM_LIT:15>", ",", "sh", "(", "-", "1", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "store", ")", ".", "write", "(", "<NUM_LIT:15>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "new", "byte", "[", "0", "]", ",", "null", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "get", ",", "<NUM_LIT:15>", ",", "new", "short", "[", "0", "]", ",", "1", ",", "null", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addObjectServed", "(", ")", ";", "verify", "(", "monitor", ")", ".", "addOwnerWrite", "(", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNodeRemovedThenRemoveOwner", "(", ")", "throws", "Exception", "{", "mm", ".", "nodeRemoved", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "store", ")", ".", "removeOwner", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenBACKUP_PACKETThenWriteUpdates", "(", ")", "throws", "Exception", "{", "final", "ByteBuffer", "buffer1", "=", "randomBuffer", "(", "<NUM_LIT>", ")", ";", "final", "ByteBuffer", "buffer2", "=", "randomBuffer", "(", "<NUM_LIT>", ")", ";", "final", "ByteBuffer", "buffer3", "=", "randomBuffer", "(", "<NUM_LIT>", ")", ";", "final", "BACKUP_PACKET", "bp", "=", "Message", ".", "BACKUP_PACKET", "(", "<NUM_LIT:7>", ",", "Arrays", ".", "asList", "(", "Message", ".", "BACKUP", "(", "id", "(", "1", ")", ",", "<NUM_LIT:4>", ",", "buffer1", ")", ",", "Message", ".", "BACKUP", "(", "id", "(", "<NUM_LIT:2>", ")", ",", "<NUM_LIT:5>", ",", "buffer2", ")", ",", "Message", ".", "BACKUP", "(", "id", "(", "<NUM_LIT:3>", ")", ",", "<NUM_LIT:6>", ",", "buffer3", ")", ")", ")", ";", "bp", ".", "setNode", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "mm", ".", "receive", "(", "bp", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "store", ",", "comm", ")", ";", "inOrder", ".", "verify", "(", "store", ")", ".", "beginTransaction", "(", ")", ";", "inOrder", ".", "verify", "(", "store", ")", ".", "write", "(", "eq", "(", "id", "(", "1", ")", ")", ",", "eq", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ",", "eq", "(", "<NUM_LIT>", ")", ",", "eq", "(", "Persistables", ".", "toByteArray", "(", "buffer1", ")", ")", ",", "anyObject", "(", ")", ")", ";", "inOrder", ".", "verify", "(", "store", ")", ".", "write", "(", "eq", "(", "id", "(", "<NUM_LIT:2>", ")", ")", ",", "eq", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ",", "eq", "(", "<NUM_LIT>", ")", ",", "eq", "(", "Persistables", ".", "toByteArray", "(", "buffer2", ")", ")", ",", "anyObject", "(", ")", ")", ";", "inOrder", ".", "verify", "(", "store", ")", ".", "write", "(", "eq", "(", "id", "(", "<NUM_LIT:3>", ")", ")", ",", "eq", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ",", "eq", "(", "<NUM_LIT>", ")", ",", "eq", "(", "Persistables", ".", "toByteArray", "(", "buffer3", ")", ")", ",", "anyObject", "(", ")", ")", ";", "inOrder", ".", "verify", "(", "store", ")", ".", "commit", "(", "anyObject", "(", ")", ")", ";", "inOrder", ".", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "BACKUP_PACKETACK", "(", "bp", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addTransaction", "(", "<NUM_LIT:3>", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "short", "sh", "(", "int", "x", ")", "{", "return", "(", "short", ")", "x", ";", "}", "</s>"]
["<s>", "short", "[", "]", "sh", "(", "int", ".", ".", ".", "args", ")", "{", "final", "short", "[", "]", "array", "=", "new", "short", "[", "args", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "short", ")", "args", "[", "i", "]", ";", "return", "array", ";", "}", "</s>"]
["<s>", "private", "long", "id", "(", "long", "id", ")", "{", "return", "MAX_RESERVED_REF_ID", "+", "id", ";", "}", "</s>"]
["<s>", "private", "ByteBuffer", "randomBuffer", "(", "int", "size", ")", "{", "ByteBuffer", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "size", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+", ")", "buffer", ".", "put", "(", "(", "byte", ")", "rand", ".", "nextInt", "(", ")", ")", ";", "buffer", ".", "flip", "(", ")", ";", "return", "buffer", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testeResponseEquality", "(", ")", "{", "final", "Message", "msg1", "=", "Message", ".", "GETX", "(", "(", "short", ")", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "msg1", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "final", "Message", "rsp1", "=", "new", "Message", "(", "msg1", ",", "null", ")", ";", "rsp1", ".", "setIncoming", "(", ")", ";", "assertTrue", "(", "rsp1", ".", "equals", "(", "msg1", ")", ")", ";", "assertTrue", "(", "rsp1", ".", "hashCode", "(", ")", "=", "=", "msg1", ".", "hashCode", "(", ")", ")", ";", "final", "Message", "rsp2", "=", "new", "Message", "(", "msg1", ",", "null", ")", ";", "assertTrue", "(", "!", "rsp2", ".", "equals", "(", "msg1", ")", ")", ";", "final", "Message", "rsp3", "=", "new", "Message", "(", "msg1", ",", "null", ")", ";", "rsp3", ".", "setIncoming", "(", ")", ";", "rsp3", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "assertTrue", "(", "!", "rsp3", ".", "equals", "(", "msg1", ")", ")", ";", "assertTrue", "(", "rsp3", ".", "hashCode", "(", ")", "!", "=", "msg1", ".", "hashCode", "(", ")", ")", ";", "final", "Message", "rsp4", "=", "new", "Message", "(", "msg1", ",", "null", ")", ";", "rsp4", ".", "setIncoming", "(", ")", ";", "rsp4", ".", "setNode", "(", "(", "short", ")", "<NUM_LIT:2>", ")", ";", "assertTrue", "(", "!", "rsp4", ".", "equals", "(", "msg1", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGETSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "GET", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testGETXSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "GETX", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPUTSer", "(", ")", "{", "final", "long", "line", "=", "rand", ".", "nextLong", "(", ")", ";", "final", "LineMessage", "m", "=", "new", "LineMessage", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "Message", ".", "Type", ".", "GET", ",", "line", ")", ";", "testSerialize", "(", "Message", ".", "PUT", "(", "m", ",", "line", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT>", ")", ")", ")", ";", "testSerialize", "(", "Message", ".", "PUT", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT:100>", ")", ")", ")", ";", "testSerialize", "(", "Message", ".", "PUT", "(", "randomShortArray", "(", "<NUM_LIT:4>", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT:100>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPUTXSer", "(", ")", "{", "final", "long", "line", "=", "rand", ".", "nextLong", "(", ")", ";", "final", "LineMessage", "m", "=", "new", "LineMessage", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "Message", ".", "Type", ".", "GET", ",", "line", ")", ";", "testSerialize", "(", "Message", ".", "PUTX", "(", "m", ",", "line", ",", "randomShortArray", "(", "<NUM_LIT:5>", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT:100>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testINVSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "INV", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testINVACKSer", "(", ")", "{", "final", "long", "line", "=", "rand", ".", "nextLong", "(", ")", ";", "final", "INV", "m", "=", "Message", ".", "INV", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "line", ",", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ")", ";", "testSerialize", "(", "Message", ".", "INVACK", "(", "m", ")", ")", ";", "testSerialize", "(", "Message", ".", "INVACK", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCHNGD_OWNRSer", "(", ")", "{", "final", "long", "line", "=", "rand", ".", "nextLong", "(", ")", ";", "final", "LineMessage", "m", "=", "new", "LineMessage", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "Message", ".", "Type", ".", "GET", ",", "line", ")", ";", "testSerialize", "(", "Message", ".", "CHNGD_OWNR", "(", "m", ",", "line", ",", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextBoolean", "(", ")", ")", ")", ";", "testSerialize", "(", "Message", ".", "CHNGD_OWNR", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextBoolean", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNOT_FOUNDSer", "(", ")", "{", "final", "LineMessage", "m", "=", "new", "LineMessage", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "Message", ".", "Type", ".", "GET", ",", "rand", ".", "nextLong", "(", ")", ")", ";", "testSerialize", "(", "Message", ".", "NOT_FOUND", "(", "m", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBACKUPSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "BACKUP", "(", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT:100>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBACKUPACKSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "BACKUPACK", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBACKUPACK_PACKETSer", "(", ")", "{", "final", "BACKUP_PACKET", "m1", "=", "Message", ".", "BACKUP_PACKET", "(", "rand", ".", "nextLong", "(", ")", ",", "Arrays", ".", "asList", "(", "Message", ".", "BACKUP", "(", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT:100>", ")", ")", ",", "Message", ".", "BACKUP", "(", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT>", ")", ")", ",", "Message", ".", "BACKUP", "(", "rand", ".", "nextLong", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomBuffer", "(", "<NUM_LIT>", ")", ")", ")", ")", ";", "byte", "[", "]", "array", "=", "m1", ".", "toByteArray", "(", ")", ";", "final", "BACKUP_PACKET", "m2", "=", "(", "BACKUP_PACKET", ")", "Message", ".", "fromByteArray", "(", "array", ")", ";", "assertThat", "(", "m2", ".", "getId", "(", ")", ",", "equalTo", "(", "m1", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "m2", ".", "getBackups", "(", ")", ".", "size", "(", ")", ",", "equalTo", "(", "m1", ".", "getBackups", "(", ")", ".", "size", "(", ")", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "m1", ".", "getBackups", "(", ")", ".", "size", "(", ")", ";", "i", "+", "+", ")", "assertThat", "(", "m2", ".", "getBackups", "(", ")", ".", "get", "(", "i", ")", ",", "deepEqualTo", "(", "m1", ".", "getBackups", "(", ")", ".", "get", "(", "i", ")", ")", ")", ";", "final", "ByteBuffer", "[", "]", "buffers", "=", "m1", ".", "toByteBuffers", "(", ")", ";", "final", "BACKUP_PACKET", "m3", "=", "(", "BACKUP_PACKET", ")", "Message", ".", "fromByteBuffer", "(", "combine", "(", "buffers", ")", ")", ";", "assertThat", "(", "m3", ".", "getId", "(", ")", ",", "equalTo", "(", "m1", ".", "getId", "(", ")", ")", ")", ";", "assertThat", "(", "m3", ".", "getBackups", "(", ")", ".", "size", "(", ")", ",", "equalTo", "(", "m1", ".", "getBackups", "(", ")", ".", "size", "(", ")", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "m1", ".", "getBackups", "(", ")", ".", "size", "(", ")", ";", "i", "+", "+", ")", "assertThat", "(", "m3", ".", "getBackups", "(", ")", ".", "get", "(", "i", ")", ",", "deepEqualTo", "(", "m1", ".", "getBackups", "(", ")", ".", "get", "(", "i", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testBACKUPACK_PACKETACKSer", "(", ")", "{", "testSerialize", "(", "Message", ".", "BACKUP_PACKET", "(", "rand", ".", "nextLong", "(", ")", ",", "Collections", ".", "EMPTY_LIST", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMSGSer", "(", ")", "{", "final", "MSG", "msg1", "=", "Message", ".", "MSG", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomArray", "(", "<NUM_LIT>", ")", ")", ";", "testSerialize", "(", "Message", ".", "MSG", "(", "msg1", ",", "randomArray", "(", "<NUM_LIT>", ")", ")", ")", ";", "testSerialize", "(", "Message", ".", "MSG", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomArray", "(", "<NUM_LIT>", ")", ")", ")", ";", "testSerialize", "(", "Message", ".", "MSG", "(", "randomShortArray", "(", "<NUM_LIT:2>", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomArray", "(", "<NUM_LIT>", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testMSGACKSer", "(", ")", "{", "final", "MSG", "msg1", "=", "Message", ".", "MSG", "(", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ",", "rand", ".", "nextLong", "(", ")", ",", "randomArray", "(", "<NUM_LIT>", ")", ")", ";", "testSerialize", "(", "Message", ".", "MSGACK", "(", "msg1", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testSerialize", "(", "Message", "message", ")", "{", "testArraySerialize", "(", "message", ")", ";", "testByteBufferSerialize", "(", "message", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testArraySerialize", "(", "Message", "message", ")", "{", "byte", "[", "]", "array", "=", "message", ".", "toByteArray", "(", ")", ";", "final", "Message", "message2", "=", "Message", ".", "fromByteArray", "(", "array", ")", ";", "assertThat", "(", "message2", ",", "deepEqualTo", "(", "message", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testByteBufferSerialize", "(", "Message", "message", ")", "{", "final", "ByteBuffer", "[", "]", "buffers", "=", "message", ".", "toByteBuffers", "(", ")", ";", "final", "Message", "message2", "=", "Message", ".", "fromByteBuffer", "(", "combine", "(", "buffers", ")", ")", ";", "assertThat", "(", "message2", ",", "deepEqualTo", "(", "message", ")", ")", ";", "}", "</s>"]
["<s>", "private", "ByteBuffer", "randomBuffer", "(", "int", "size", ")", "{", "ByteBuffer", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "size", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+", ")", "buffer", ".", "put", "(", "(", "byte", ")", "rand", ".", "nextInt", "(", ")", ")", ";", "buffer", ".", "flip", "(", ")", ";", "return", "buffer", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "randomArray", "(", "int", "size", ")", "{", "byte", "[", "]", "array", "=", "new", "byte", "[", "size", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "byte", ")", "rand", ".", "nextInt", "(", ")", ";", "return", "array", ";", "}", "</s>"]
["<s>", "private", "short", "[", "]", "randomShortArray", "(", "int", "size", ")", "{", "short", "[", "]", "array", "=", "new", "short", "[", "size", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "size", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "short", ")", "rand", ".", "nextInt", "(", ")", ";", "return", "array", ";", "}", "</s>"]
["<s>", "private", "ByteBuffer", "combine", "(", "ByteBuffer", "[", "]", "buffers", ")", "{", "int", "size", "=", "0", ";", "for", "(", "ByteBuffer", "b", ":", "buffers", ")", "size", "+", "=", "b", ".", "remaining", "(", ")", ";", "final", "ByteBuffer", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "size", ")", ";", "for", "(", "ByteBuffer", "b", ":", "buffers", ")", "{", "buffer", ".", "put", "(", "b", ")", ";", "b", ".", "rewind", "(", ")", ";", "}", "buffer", ".", "flip", "(", ")", ";", "assertThat", "(", "buffer", ".", "remaining", "(", ")", ",", "is", "(", "size", ")", ")", ";", "return", "buffer", ";", "}", "</s>"]
["<s>", "public", "NodeInfoMatcher", "(", "NodeInfo", "nodeInfo", ")", "{", "this", ".", "nodeInfo", "=", "nodeInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "nodeInfo", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "MessageMatcher", "(", "Message", "message", ")", "{", "this", ".", "message", "=", "message", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "message", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Matcher", "<", "NodeInfo", ">", "withPropertyEqualTo", "(", "String", "property", ",", "Object", "value", ")", "{", "return", "new", "NodeInfoPropertyEqual", "(", "property", ",", "value", ")", ";", "}", "</s>"]
["<s>", "private", "NodeInfoMatchers", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "NUM_THREADS", ";", "i", "+", "+", ")", "new", "Thread", "(", "new", "OffHeapLocalStorageLoad", "(", ")", ")", ".", "start", "(", ")", ";", "Thread", ".", "sleep", "(", "Long", ".", "MAX_VALUE", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "System", ".", "out", ".", "println", "(", "thread", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "out", ".", "println", "(", "thread", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "buffers", ".", "length", ";", "i", "+", "+", ")", "{", "final", "int", "size", "=", "randSize", "(", ")", ";", "buffers", "[", "i", "]", "=", "storage", ".", "allocateStorage", "(", "size", ")", ";", "totalSize", "+", "=", "buffers", "[", "i", "]", ".", "limit", "(", ")", ";", "}", "System", ".", "out", ".", "println", "(", "thread", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "totalSize", ")", ";", "System", ".", "out", ".", "println", "(", "thread", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "long", "counter", "=", "0", ";", "for", "(", ";", ";", ")", "{", "final", "int", "i", "=", "random", "(", "0", ",", "buffers", ".", "length", ")", ";", "totalSize", "-", "=", "buffers", "[", "i", "]", ".", "limit", "(", ")", ";", "storage", ".", "deallocateStorage", "(", "-", "1", ",", "buffers", "[", "i", "]", ")", ";", "int", "size", "=", "randSize", "(", ")", ";", "buffers", "[", "i", "]", "=", "storage", ".", "allocateStorage", "(", "size", ")", ";", "totalSize", "+", "=", "buffers", "[", "i", "]", ".", "limit", "(", ")", ";", "if", "(", "counter", "%", "<NUM_LIT>", "=", "=", "0", ")", "System", ".", "out", ".", "println", "(", "thread", "(", ")", "+", "\"", "\"", "+", "counter", "+", "\"", "<STR_LIT>", "\"", "+", "totalSize", ")", ";", "counter", "+", "+", ";", "}", "}", "</s>"]
["<s>", "private", "String", "thread", "(", ")", "{", "return", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "private", "int", "random", "(", "int", "least", ",", "int", "bound", ")", "{", "return", "ThreadLocalRandom", ".", "current", "(", ")", ".", "nextInt", "(", "least", ",", "bound", ")", ";", "}", "</s>"]
["<s>", "private", "int", "randSize", "(", ")", "{", "int", "n", "=", "1", "<", "<", "ThreadLocalRandom", ".", "current", "(", ")", ".", "nextInt", "(", "0", ",", "MAX_POWER_TWO", ")", ";", "int", "s", "=", "n", "+", "ThreadLocalRandom", ".", "current", "(", ")", ".", "nextInt", "(", "0", ",", "n", ")", ";", "return", "s", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "store", "=", "mock", "(", "StoreImpl", ".", "class", ")", ";", "cluster", "=", "mock", "(", "FullCluster", ".", "class", ")", ";", "txn", "=", "mock", "(", "Transaction", ".", "class", ")", ";", "srm", "=", "new", "StringRootManager", "(", "store", ",", "cluster", ")", ";", "buffers", "=", "new", "HashMap", "<", "Long", ",", "ByteBuffer", ">", "(", ")", ";", "when", "(", "cluster", ".", "hasServer", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "store", ".", "getMaxItemSize", "(", ")", ")", ".", "thenReturn", "(", "<NUM_LIT>", ")", ";", "final", "Answer", "<", "Void", ">", "getAnswer", "=", "new", "Answer", "<", "Void", ">", "(", ")", "{", "@", "Override", "public", "Void", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "read", "(", "(", "Long", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ",", "(", "Persistable", ")", "invocation", ".", "getArguments", "(", ")", "[", "1", "]", ")", ";", "return", "null", ";", "}", "}", ";", "doAnswer", "(", "getAnswer", ")", ".", "when", "(", "store", ")", ".", "get1", "(", "anyLong", "(", ")", ",", "any", "(", "Persistable", ".", "class", ")", ")", ";", "doAnswer", "(", "getAnswer", ")", ".", "when", "(", "store", ")", ".", "getx1", "(", "anyLong", "(", ")", ",", "any", "(", "Persistable", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ";", "doAnswer", "(", "new", "Answer", "(", ")", "{", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "write", "(", "(", "Long", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ",", "(", "Persistable", ")", "invocation", ".", "getArguments", "(", ")", "[", "1", "]", ")", ";", "return", "null", ";", "}", "}", ")", ".", "when", "(", "store", ")", ".", "set1", "(", "anyLong", "(", ")", ",", "any", "(", "Persistable", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "read", "(", "(", "Long", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ",", "(", "Persistable", ")", "invocation", ".", "getArguments", "(", ")", "[", "1", "]", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "write", "(", "(", "Long", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ",", "(", "Persistable", ")", "invocation", ".", "getArguments", "(", ")", "[", "1", "]", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "void", "newTransaction", "(", ")", "{", "txn", "=", "mock", "(", "Transaction", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNewRootCreateNewBuffer", "(", ")", "throws", "Exception", "{", "final", "String", "str", "=", "\"", "<STR_LIT>", "\"", ";", "final", "long", "id", "=", "str", ".", "hashCode", "(", ")", ";", "final", "long", "rootRef", "=", "<NUM_LIT:15>", ";", "when", "(", "store", ".", "put", "(", "any", "(", "byte", "[", "]", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ")", ".", "thenReturn", "(", "rootRef", ")", ".", "thenReturn", "(", "0", "L", ")", ";", "long", "res", "=", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "id", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "release", "(", "rootRef", ")", ";", "verify", "(", "txn", ")", ".", "add", "(", "rootRef", ")", ";", "assertThat", "(", "res", ",", "is", "(", "rootRef", ")", ")", ";", "ByteBuffer", "buffer", "=", "buffers", ".", "get", "(", "id", ")", ";", "long", "nextRef", "=", "buffer", ".", "getLong", "(", ")", ";", "short", "numEntries", "=", "buffer", ".", "getShort", "(", ")", ";", "assertThat", "(", "nextRef", ",", "is", "(", "-", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "numEntries", ",", "is", "(", "(", "short", ")", "1", ")", ")", ";", "String", "_str", "=", "readString", "(", "buffer", ")", ";", "long", "_rootRef", "=", "buffer", ".", "getLong", "(", ")", ";", "buffer", ".", "rewind", "(", ")", ";", "assertThat", "(", "_str", ",", "equalTo", "(", "str", ")", ")", ";", "assertThat", "(", "_rootRef", ",", "is", "(", "rootRef", ")", ")", ";", "newTransaction", "(", ")", ";", "long", "resAgain", "=", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "verify", "(", "txn", ",", "never", "(", ")", ")", ".", "add", "(", "anyLong", "(", ")", ")", ";", "assertThat", "(", "resAgain", ",", "is", "(", "rootRef", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenCollidingRootsAppendToBuffer", "(", ")", "throws", "Exception", "{", "final", "String", "str1", "=", "COLLIDERS", "[", "0", "]", ";", "final", "String", "str2", "=", "COLLIDERS", "[", "1", "]", ";", "assert", "str1", ".", "hashCode", "(", ")", "=", "=", "str2", ".", "hashCode", "(", ")", ";", "assert", "str1", ".", "compareTo", "(", "str2", ")", ">", "0", ";", "final", "long", "id", "=", "str1", ".", "hashCode", "(", ")", ";", "final", "long", "rootRef1", "=", "<NUM_LIT>", ";", "final", "long", "rootRef2", "=", "<NUM_LIT>", ";", "when", "(", "store", ".", "put", "(", "any", "(", "byte", "[", "]", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ")", ".", "thenReturn", "(", "rootRef1", ")", ".", "thenReturn", "(", "rootRef2", ")", ".", "thenReturn", "(", "0", "L", ")", ";", "long", "res1", "=", "srm", ".", "get", "(", "str1", ",", "txn", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "id", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "release", "(", "rootRef1", ")", ";", "verify", "(", "txn", ")", ".", "add", "(", "rootRef1", ")", ";", "long", "res2", "=", "srm", ".", "get", "(", "str2", ",", "txn", ")", ";", "verify", "(", "store", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "release", "(", "id", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "release", "(", "rootRef2", ")", ";", "verify", "(", "txn", ")", ".", "add", "(", "rootRef2", ")", ";", "ByteBuffer", "buffer", "=", "buffers", ".", "get", "(", "id", ")", ";", "long", "nextRef", "=", "buffer", ".", "getLong", "(", ")", ";", "short", "numEntries", "=", "buffer", ".", "getShort", "(", ")", ";", "assertThat", "(", "nextRef", ",", "is", "(", "-", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "numEntries", ",", "is", "(", "(", "short", ")", "<NUM_LIT:2>", ")", ")", ";", "String", "_str2", "=", "readString", "(", "buffer", ")", ";", "long", "_rootRef2", "=", "buffer", ".", "getLong", "(", ")", ";", "String", "_str1", "=", "readString", "(", "buffer", ")", ";", "long", "_rootRef1", "=", "buffer", ".", "getLong", "(", ")", ";", "buffer", ".", "rewind", "(", ")", ";", "assertThat", "(", "_str1", ",", "equalTo", "(", "str1", ")", ")", ";", "assertThat", "(", "_rootRef1", ",", "is", "(", "rootRef1", ")", ")", ";", "assertThat", "(", "_str2", ",", "equalTo", "(", "str2", ")", ")", ";", "assertThat", "(", "_rootRef2", ",", "is", "(", "rootRef2", ")", ")", ";", "assertThat", "(", "res1", ",", "is", "(", "rootRef1", ")", ")", ";", "assertThat", "(", "res2", ",", "is", "(", "rootRef2", ")", ")", ";", "newTransaction", "(", ")", ";", "long", "resAgain1", "=", "srm", ".", "get", "(", "str1", ",", "txn", ")", ";", "long", "resAgain2", "=", "srm", ".", "get", "(", "str2", ",", "txn", ")", ";", "verify", "(", "txn", ",", "never", "(", ")", ")", ".", "add", "(", "anyLong", "(", ")", ")", ";", "assertThat", "(", "resAgain1", ",", "is", "(", "rootRef1", ")", ")", ";", "assertThat", "(", "resAgain2", ",", "is", "(", "rootRef2", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testRootFind", "(", ")", "throws", "Exception", "{", "final", "String", "str", "=", "\"", "<STR_LIT>", "\"", ";", "final", "long", "id", "=", "str", ".", "hashCode", "(", ")", ";", "assert", "id", "!", "=", "1", "&", "&", "id", "!", "=", "<NUM_LIT:12>", ";", "ByteBuffer", "buffer", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "1", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:1>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "buffers", ".", "put", "(", "id", ",", "buffer", ")", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "<NUM_LIT:12>", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "1", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "buffers", ".", "put", "(", "<NUM_LIT>", ",", "buffer", ")", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "<NUM_LIT:10>", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:1>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "buffers", ".", "put", "(", "<NUM_LIT>", ",", "buffer", ")", ";", "long", "res", "=", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "assertThat", "(", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "getx1", "(", "anyLong", "(", ")", ",", "any", "(", "Persistable", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "getx1", "(", "anyLong", "(", ")", ",", "anyShort", "(", ")", ",", "any", "(", "Persistable", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ";", "verify", "(", "txn", ",", "never", "(", ")", ")", ".", "add", "(", "anyLong", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testInsertEntryIntoPage", "(", ")", "throws", "Exception", "{", "final", "int", "pageSize", "=", "<NUM_LIT>", ";", "when", "(", "store", ".", "getMaxItemSize", "(", ")", ")", ".", "thenReturn", "(", "pageSize", ")", ";", "when", "(", "store", ".", "put", "(", "any", "(", "byte", "[", "]", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ")", ".", "thenReturn", "(", "<NUM_LIT>", ")", ".", "thenReturn", "(", "0", "L", ")", ";", "final", "String", "str", "=", "\"", "<STR_LIT>", "\"", ";", "final", "long", "id", "=", "str", ".", "hashCode", "(", ")", ";", "assert", "id", "!", "=", "1", "&", "&", "id", "!", "=", "<NUM_LIT:12>", ";", "ByteBuffer", "buffer", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "1", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:1>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "assert", "buffer", ".", "remaining", "(", ")", ">", "pageSize", ";", "buffers", ".", "put", "(", "id", ",", "buffer", ")", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "<NUM_LIT:12>", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:2>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "assert", "buffer", ".", "remaining", "(", ")", "<", "pageSize", "-", "<NUM_LIT:15>", ";", "buffers", ".", "put", "(", "<NUM_LIT>", ",", "buffer", ")", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "-", "1", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:1>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:0>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "buffers", ".", "put", "(", "<NUM_LIT>", ",", "buffer", ")", ";", "long", "res", "=", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "id", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "<NUM_LIT>", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "release", "(", "<NUM_LIT>", ")", ";", "verify", "(", "txn", ")", ".", "add", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "buffer", "=", "buffers", ".", "get", "(", "<NUM_LIT>", ")", ";", "long", "nextRef", "=", "buffer", ".", "getLong", "(", ")", ";", "short", "numEntries", "=", "buffer", ".", "getShort", "(", ")", ";", "assertThat", "(", "nextRef", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "numEntries", ",", "is", "(", "(", "short", ")", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "readString", "(", "buffer", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "buffer", ".", "getLong", "(", ")", ",", "is", "(", "0", "L", ")", ")", ";", "assertThat", "(", "readString", "(", "buffer", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "buffer", ".", "getLong", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "readString", "(", "buffer", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "buffer", ".", "getLong", "(", ")", ",", "is", "(", "0", "L", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenOverflowThenLinkNewBuffer", "(", ")", "throws", "Exception", "{", "final", "int", "pageSize", "=", "<NUM_LIT>", ";", "when", "(", "store", ".", "getMaxItemSize", "(", ")", ")", ".", "thenReturn", "(", "pageSize", ")", ";", "when", "(", "store", ".", "put", "(", "any", "(", "byte", "[", "]", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ")", ".", "thenReturn", "(", "<NUM_LIT>", ")", ".", "thenReturn", "(", "0", "L", ")", ";", "when", "(", "store", ".", "put", "(", "any", "(", "Persistable", ".", "class", ")", ",", "any", "(", "StoreTransaction", ".", "class", ")", ")", ")", ".", "thenAnswer", "(", "new", "Answer", "<", "Long", ">", "(", ")", "{", "@", "Override", "public", "Long", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "write", "(", "<NUM_LIT>", ",", "(", "Persistable", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ")", ";", "return", "<NUM_LIT>", ";", "}", "}", ")", ".", "thenReturn", "(", "0", "L", ")", ";", "final", "String", "str", "=", "\"", "<STR_LIT>", "\"", ";", "final", "long", "id", "=", "str", ".", "hashCode", "(", ")", ";", "assert", "id", "!", "=", "1", "&", "&", "id", "!", "=", "<NUM_LIT:12>", ";", "ByteBuffer", "buffer", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "1", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:1>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "assert", "buffer", ".", "remaining", "(", ")", ">", "pageSize", ";", "buffers", ".", "put", "(", "id", ",", "buffer", ")", ";", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "<NUM_LIT>", ")", ";", "buffer", ".", "putLong", "(", "-", "1", ")", ";", "buffer", ".", "putShort", "(", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:1>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT:0>", "\"", ",", "0", ")", ";", "writeEntry", "(", "buffer", ",", "\"", "<STR_LIT>", "\"", ",", "0", ")", ";", "buffer", ".", "flip", "(", ")", ";", "assert", "buffer", ".", "remaining", "(", ")", ">", "pageSize", ";", "buffers", ".", "put", "(", "<NUM_LIT>", ",", "buffer", ")", ";", "long", "res", "=", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "assertThat", "(", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "id", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "<NUM_LIT>", ")", ";", "verify", "(", "store", ")", ".", "release", "(", "<NUM_LIT>", ")", ";", "verify", "(", "store", ",", "never", "(", ")", ")", ".", "release", "(", "<NUM_LIT>", ")", ";", "verify", "(", "txn", ")", ".", "add", "(", "<NUM_LIT>", ")", ";", "newTransaction", "(", ")", ";", "long", "resAgain", "=", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "verify", "(", "txn", ",", "never", "(", ")", ")", ".", "add", "(", "anyLong", "(", ")", ")", ";", "assertThat", "(", "resAgain", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "buffer", "=", "buffers", ".", "get", "(", "<NUM_LIT>", ")", ";", "long", "nextRef", "=", "buffer", ".", "getLong", "(", ")", ";", "short", "numEntries", "=", "buffer", ".", "getShort", "(", ")", ";", "assertThat", "(", "nextRef", ",", "is", "(", "-", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "numEntries", ",", "is", "(", "(", "short", ")", "1", ")", ")", ";", "assertThat", "(", "readString", "(", "buffer", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "buffer", ".", "getLong", "(", ")", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "write", "(", "<NUM_LIT>", ",", "(", "Persistable", ")", "invocation", ".", "getArguments", "(", ")", "[", "0", "]", ")", ";", "return", "<NUM_LIT>", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNoServerThenLockRootRefWithClusterManager", "(", ")", "throws", "Exception", "{", "final", "String", "str", "=", "\"", "<STR_LIT>", "\"", ";", "final", "long", "id", "=", "\"", "<STR_LIT>", "\"", ".", "hashCode", "(", ")", ";", "final", "Object", "lock", "=", "new", "Object", "(", ")", ";", "when", "(", "cluster", ".", "hasServer", "(", ")", ")", ".", "thenReturn", "(", "false", ")", ";", "when", "(", "cluster", ".", "lockRoot", "(", "(", "int", ")", "id", ")", ")", ".", "thenReturn", "(", "lock", ")", ";", "srm", ".", "get", "(", "str", ",", "txn", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "cluster", ",", "store", ")", ";", "inOrder", ".", "verify", "(", "cluster", ")", ".", "lockRoot", "(", "(", "int", ")", "id", ")", ";", "inOrder", ".", "verify", "(", "store", ")", ".", "get1", "(", "eq", "(", "id", ")", ",", "any", "(", "Persistable", ".", "class", ")", ")", ";", "inOrder", ".", "verify", "(", "cluster", ")", ".", "unlockRoot", "(", "lock", ")", ";", "}", "</s>"]
["<s>", "private", "static", "short", "sh", "(", "int", "x", ")", "{", "return", "(", "short", ")", "x", ";", "}", "</s>"]
["<s>", "private", "static", "void", "writeEntry", "(", "ByteBuffer", "buffer", ",", "String", "str", ",", "long", "ref", ")", "{", "final", "byte", "[", "]", "chars", "=", "str", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "buffer", ".", "putShort", "(", "(", "short", ")", "chars", ".", "length", ")", ";", "buffer", ".", "put", "(", "chars", ")", ";", "buffer", ".", "putLong", "(", "ref", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "readString", "(", "ByteBuffer", "buffer", ")", "{", "short", "strLength", "=", "buffer", ".", "getShort", "(", ")", ";", "byte", "[", "]", "chars", "=", "new", "byte", "[", "strLength", "]", ";", "buffer", ".", "get", "(", "chars", ")", ";", "String", "str", "=", "new", "String", "(", "chars", ",", "Charsets", ".", "UTF_8", ")", ";", "return", "str", ";", "}", "</s>"]
["<s>", "private", "void", "read", "(", "long", "id", ",", "Persistable", "p", ")", "{", "final", "ByteBuffer", "buffer", "=", "buffers", ".", "get", "(", "id", ")", ";", "p", ".", "read", "(", "buffer", ")", ";", "if", "(", "buffer", "!", "=", "null", ")", "buffer", ".", "rewind", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "write", "(", "long", "id", ",", "Persistable", "p", ")", "{", "ByteBuffer", "buffer", ";", "if", "(", "p", "=", "=", "null", ")", "buffer", "=", "null", ";", "else", "{", "buffer", "=", "buffers", ".", "get", "(", "id", ")", ";", "if", "(", "buffer", "=", "=", "null", "|", "|", "buffer", ".", "remaining", "(", ")", "<", "p", ".", "size", "(", ")", ")", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "p", ".", "size", "(", ")", ")", ";", "p", ".", "write", "(", "buffer", ")", ";", "buffer", ".", "flip", "(", ")", ";", "}", "buffers", ".", "put", "(", "id", ",", "buffer", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "reset", "(", ")", "{", "mdt", "=", "new", "MockDistributedTree", "(", ")", ";", "listener", "=", "mock", "(", "Listener", ".", "class", ")", ";", "branch", "=", "null", ";", "}", "</s>"]
["<s>", "private", "void", "createBranch", "(", "boolean", "ordered", ")", "{", "final", "Set", "<", "String", ">", "requiredProperties", "=", "ImmutableSet", ".", "of", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "branch", "=", "new", "DistributedBranchHelper", "(", "mdt", ".", "tree", ",", "ROOT", ",", "ordered", ")", "{", "@", "Override", "protected", "boolean", "isNodeComplete", "(", "String", "node", ",", "Set", "<", "String", ">", "properties", ")", "{", "return", "properties", ".", "containsAll", "(", "requiredProperties", ")", ";", "}", "}", ";", "branch", ".", "addListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isNodeComplete", "(", "String", "node", ",", "Set", "<", "String", ">", "properties", ")", "{", "return", "properties", ".", "containsAll", "(", "requiredProperties", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test1", "(", ")", "{", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "listener", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test2", "(", ")", "{", "for", "(", "boolean", "ordered", ":", "new", "boolean", "[", "]", "{", "false", ",", "true", "}", ")", "{", "createBranch", "(", "ordered", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test3", "(", ")", "{", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test3_1", "(", ")", "{", "createBranch", "(", "false", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test4", "(", ")", "{", "for", "(", "boolean", "ordered", ":", "new", "boolean", "[", "]", "{", "false", ",", "true", "}", ")", "{", "createBranch", "(", "ordered", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test5", "(", ")", "{", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "listener", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test5_1", "(", ")", "{", "createBranch", "(", "false", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "listener", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test6", "(", ")", "{", "for", "(", "boolean", "ordered", ":", "new", "boolean", "[", "]", "{", "false", ",", "true", "}", ")", "{", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "createBranch", "(", "ordered", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "listener", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test7", "(", ")", "{", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "mdt", ".", "tree", ".", "getChildren", "(", "ROOT", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "listener", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test8", "(", ")", "{", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "mdt", ".", "tree", ".", "getChildren", "(", "ROOT", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ")", ";", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "mdt", ".", "remove", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test9", "(", ")", "{", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "(", "Matcher", ")", "empty", "(", ")", ")", ";", "mdt", ".", "remove", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test10", "(", ")", "{", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ")", ")", ")", ";", "mdt", ".", "remove", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test11", "(", ")", "{", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "createBranch", "(", "true", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ")", ")", ")", ";", "mdt", ".", "remove", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test12", "(", ")", "{", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "createBranch", "(", "true", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ")", ")", ")", ";", "mdt", ".", "remove", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT:2>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "test13", "(", ")", "{", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "mdt", ".", "add", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "mdt", ".", "set", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "createBranch", "(", "true", ")", ";", "verify", "(", "listener", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:0>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ")", ")", ")", ";", "mdt", ".", "remove", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "nodeChildAdded", "(", "ROOT", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "assertThat", "(", "branch", ".", "getChildren", "(", ")", ",", "equalTo", "(", "Arrays", ".", "asList", "(", "\"", "<STR_LIT:0>", "\"", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "String", "node", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeDeleted", "(", "String", "node", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "node", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "child", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "child", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "child", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "child", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "child", ")", "{", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "child", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "MessageOfType", "(", "Message", ".", "Type", "type", ")", "{", "this", ".", "type", "=", "type", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matchesSafely", "(", "Message", "item", ")", "{", "return", "item", "!", "=", "null", "&", "&", "item", ".", "getType", "(", ")", "=", "=", "type", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "type", ".", "name", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "MessageEqualTo", "(", "Message", "message", ")", "{", "super", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matchesSafely", "(", "Message", "item", ")", "{", "if", "(", "message", "=", "=", "null", ")", "return", "item", "=", "=", "null", ";", "if", "(", "item", "=", "=", "null", ")", "return", "false", ";", "if", "(", "item", "=", "=", "message", ")", "return", "true", ";", "if", "(", "!", "(", "message", ".", "getType", "(", ")", "=", "=", "item", ".", "getType", "(", ")", "&", "&", "message", ".", "isResponse", "(", ")", "=", "=", "item", ".", "isResponse", "(", ")", "&", "&", "message", ".", "getMessageId", "(", ")", "=", "=", "item", ".", "getMessageId", "(", ")", "&", "&", "message", ".", "getNode", "(", ")", "=", "=", "item", ".", "getNode", "(", ")", ")", ")", "return", "false", ";", "if", "(", "!", "message", ".", "getClass", "(", ")", ".", "equals", "(", "item", ".", "getClass", "(", ")", ")", ")", "return", "false", ";", "return", "fieldEqual", "(", "message", ",", "item", ",", "message", ".", "getClass", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "fieldEqual", "(", "Object", "a", ",", "Object", "b", ",", "Class", "clazz", ")", "{", "if", "(", "clazz", ".", "equals", "(", "Message", ".", "class", ")", ")", "return", "true", ";", "if", "(", "!", "fieldEqual", "(", "a", ",", "b", ",", "clazz", ".", "getSuperclass", "(", ")", ")", ")", "return", "false", ";", "try", "{", "for", "(", "Field", "field", ":", "clazz", ".", "getDeclaredFields", "(", ")", ")", "{", "field", ".", "setAccessible", "(", "true", ")", ";", "if", "(", "!", "equals", "(", "field", ".", "get", "(", "a", ")", ",", "field", ".", "get", "(", "b", ")", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "boolean", "equals", "(", "Object", "a", ",", "Object", "b", ")", "{", "if", "(", "a", "=", "=", "b", ")", "return", "true", ";", "if", "(", "a", "=", "=", "null", "|", "|", "b", "=", "=", "null", ")", "return", "false", ";", "if", "(", "a", ".", "getClass", "(", ")", ".", "isArray", "(", ")", ")", "{", "if", "(", "a", ".", "getClass", "(", ")", ".", "getComponentType", "(", ")", ".", "equals", "(", "short", ".", "class", ")", ")", "return", "new", "HashSet", "<", "Short", ">", "(", "Shorts", ".", "asList", "(", "(", "short", "[", "]", ")", "a", ")", ")", ".", "equals", "(", "new", "HashSet", "<", "Short", ">", "(", "Shorts", ".", "asList", "(", "(", "short", "[", "]", ")", "b", ")", ")", ")", ";", "else", "return", "Objects", ".", "deepEquals", "(", "a", ",", "b", ")", ";", "}", "else", "return", "a", ".", "equals", "(", "b", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Matcher", "<", "Message", ">", "ofType", "(", "Message", ".", "Type", "type", ")", "{", "return", "new", "MessageOfType", "(", "type", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Matcher", "<", "Message", ">", "equalTo", "(", "Message", "message", ")", "{", "return", "new", "MessageEqualTo", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Matcher", "<", "Message", ">", "deepEqualTo", "(", "Message", "message", ")", "{", "return", "new", "MessageDeepEqualTo", "(", "message", ")", ";", "}", "</s>"]
["<s>", "private", "MessageMatchers", "(", ")", "{", "}", "</s>"]
["<s>", "public", "CacheTest", "(", ")", "{", "hasServer", "=", "true", ";", "}", "</s>"]
["<s>", "@", "Parameterized", ".", "Parameters", "public", "static", "Collection", "<", "Object", "[", "]", ">", "data", "(", ")", "{", "return", "Arrays", ".", "asList", "(", "new", "Object", "[", "]", "[", "]", "{", "{", "true", "}", ",", "{", "false", "}", ",", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "java", ".", "util", ".", "logging", ".", "Logger", ".", "getLogger", "(", "\"", "\"", ")", ".", "setLevel", "(", "java", ".", "util", ".", "logging", ".", "Level", ".", "WARNING", ")", ";", "cluster", "=", "mock", "(", "FullCluster", ".", "class", ")", ";", "when", "(", "cluster", ".", "isMaster", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "cluster", ".", "hasServer", "(", ")", ")", ".", "thenReturn", "(", "hasServer", ")", ";", "when", "(", "cluster", ".", "getMyNodeId", "(", ")", ")", ".", "thenReturn", "(", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "comm", "=", "mock", "(", "AbstractComm", ".", "class", ")", ";", "backup", "=", "mock", "(", "Backup", ".", "class", ")", ";", "when", "(", "backup", ".", "inv", "(", "anyLong", "(", ")", ",", "anyShort", "(", ")", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "storage", "=", "spy", "(", "new", "HeapLocalStorage", "(", "\"", "<STR_LIT>", "\"", ",", "null", ")", ")", ";", "monitor", "=", "mock", "(", "CacheMonitor", ".", "class", ")", ";", "cache", "=", "makeCache", "(", "<NUM_LIT>", ")", ";", "cache", ".", "setReceiver", "(", "mock", "(", "MessageReceiver", ".", "class", ")", ")", ";", "messageId", "=", "0", ";", "}", "</s>"]
["<s>", "Cache", "makeCache", "(", "int", "capacity", ")", "throws", "Exception", "{", "return", "makeCache", "(", "capacity", ",", "false", ")", ";", "}", "</s>"]
["<s>", "Cache", "makeCache", "(", "boolean", "syncrhonous", ")", "throws", "Exception", "{", "return", "makeCache", "(", "<NUM_LIT:1000>", ",", "syncrhonous", ")", ";", "}", "</s>"]
["<s>", "Cache", "makeCache", "(", "int", "capacity", ",", "boolean", "syncrhonous", ")", "throws", "Exception", "{", "Cache", "_cache", "=", "new", "Cache", "(", "\"", "<STR_LIT>", "\"", ",", "cluster", ",", "comm", ",", "storage", ",", "backup", ",", "monitor", ",", "capacity", ")", ";", "_cache", ".", "setReuseLines", "(", "false", ")", ";", "_cache", ".", "setReuseSharerSets", "(", "false", ")", ";", "_cache", ".", "setSynchronous", "(", "syncrhonous", ")", ";", "_cache", ".", "init", "(", ")", ";", "verify", "(", "monitor", ")", ".", "setMonitoredObject", "(", "_cache", ")", ";", "verify", "(", "comm", ")", ".", "setReceiver", "(", "_cache", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ",", "atLeastOnce", "(", ")", ")", ".", "isSendToServerInsteadOfMulticast", "(", ")", ";", "return", "_cache", ";", "}", "</s>"]
["<s>", "private", "void", "reset", "(", ")", "throws", "Exception", "{", "setUp", "(", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTThenGetLine", "(", ")", "throws", "Exception", "{", "PUT", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "byte", "[", "]", "res", "=", "(", "byte", "[", "]", ")", "doOp", "(", "GET", ",", "<NUM_LIT>", ")", ";", "assertState", "(", "1", ",", "S", ",", "null", ")", ";", "assertVersion", "(", "1", ",", "1", ")", ";", "assertThat", "(", "deserialize", "(", "res", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addMessageReceived", "(", "Type", ".", "PUT", ")", ";", "verify", "(", "monitor", ")", ".", "addOp", "(", "eq", "(", "GET", ")", ",", "anyLong", "(", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addHit", "(", ")", ";", "verify", "(", "monitor", ")", ".", "addStalePurge", "(", "0", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTXThenGetXLine", "(", ")", "throws", "Exception", "{", "PUTX", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "byte", "[", "]", "res", "=", "(", "byte", "[", "]", ")", "doOp", "(", "GETX", ",", "<NUM_LIT>", ")", ";", "assertState", "(", "1", ",", "E", ",", "null", ")", ";", "assertVersion", "(", "1", ",", "1", ")", ";", "assertThat", "(", "deserialize", "(", "res", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addMessageReceived", "(", "Type", ".", "PUTX", ")", ";", "if", "(", "hasServer", "(", ")", ")", "verify", "(", "monitor", ")", ".", "addMessageReceived", "(", "Type", ".", "INVACK", ")", ";", "verify", "(", "monitor", ")", ".", "addOp", "(", "eq", "(", "GETX", ")", ",", "anyLong", "(", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "monitor", ")", ".", "addMessageSent", "(", "Type", ".", "INV", ")", ";", "verify", "(", "monitor", ")", ".", "addHit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetMissingLineThenBroadcastGET", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "Object", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "getType", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "assertState", "(", "1", ",", "I", ",", "getType", "=", "=", "GETX", "?", "O", ":", "S", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addMessageSent", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ".", "getType", "(", ")", ")", ";", "verify", "(", "monitor", ")", ".", "addMiss", "(", ")", ";", "verifyNoMoreInteractions", "(", "monitor", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetXAndGetMissingLineThenBroadcastGETX", "(", ")", "throws", "Exception", "{", "Object", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "assertState", "(", "1", ",", "I", ",", "O", ")", ";", "assertVersion", "(", "1", ",", "0", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTAndGetXThenGETX", "(", ")", "throws", "Exception", "{", "PUT", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "assertState", "(", "1", ",", "S", ",", "O", ")", ";", "assertVersion", "(", "1", ",", "1", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetWithHintThenGETFromHint", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "Object", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "getType", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:15>", ")", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "assertState", "(", "1", ",", "I", ",", "getType", "=", "=", "GETX", "?", "O", ":", "S", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:15>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetWithHintAndKnownOwnerThenGETFromOwner", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "PUT", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "makeInvalid", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "getType", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:15>", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:15>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetFromOwnerThenGETFromOwner", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "PUT", "(", "<NUM_LIT:2>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GET_FROM_OWNER", ",", "<NUM_LIT:2>", ",", "new", "Op", "(", "getType", ",", "1", ",", "null", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetFromOwnerAndNoLineThenBroadcastGET", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "Op", "get", "=", "(", "Op", ")", "cache", ".", "runOp", "(", "new", "Op", "(", "GET_FROM_OWNER", ",", "<NUM_LIT:2>", ",", "new", "Op", "(", "getType", ",", "1", ",", "null", ")", ",", "null", ")", ")", ";", "cache", ".", "runOp", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetFromOwnerAndKnownLineThenGETFromActualOwner", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "PUT", "(", "<NUM_LIT:2>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "1", ",", "sh", "(", "<NUM_LIT:15>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "makeInvalid", "(", "sh", "(", "<NUM_LIT:15>", ")", ",", "1", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GET_FROM_OWNER", ",", "<NUM_LIT:2>", ",", "new", "Op", "(", "getType", ",", "1", ",", "null", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:15>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETThenPUT", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ",", "<NUM_LIT>", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "final", "LineMessage", "get1", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "final", "LineMessage", "get2", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get1", ")", ";", "cache", ".", "receive", "(", "get2", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "get1", ",", "<NUM_LIT>", ",", "<NUM_LIT:2>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "get2", ",", "<NUM_LIT>", ",", "<NUM_LIT:2>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETXThenPUTX", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT:2>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ",", "<NUM_LIT>", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "final", "LineMessage", "get1", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "final", "LineMessage", "get2", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get1", ")", ";", "cache", ".", "receive", "(", "get2", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "get1", ",", "<NUM_LIT>", ",", "<NUM_LIT:2>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "get2", ",", "<NUM_LIT>", ",", "<NUM_LIT:2>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "final", "LineMessage", "getx", "=", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "getx", ")", ";", "assertOwner", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT>", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "I", ",", "null", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "getx", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT:2>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndNoLineThenCHNGD_OWNER", "(", ")", "throws", "Exception", "{", "for", "(", "Message", ".", "Type", "getType", ":", "new", "Message", ".", "Type", "[", "]", "{", "Message", ".", "Type", ".", "GET", ",", "Message", ".", "Type", ".", "GETX", "}", ")", "{", "final", "LineMessage", "get", "=", "new", "Message", ".", "GET", "(", "getType", ",", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "get", ",", "<NUM_LIT>", ",", "sh", "(", "-", "1", ")", ",", "false", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETBcastAndNoLineThenACK", "(", ")", "throws", "Exception", "{", "for", "(", "Message", ".", "Type", "getType", ":", "new", "Message", ".", "Type", "[", "]", "{", "Message", ".", "Type", ".", "GET", ",", "Message", ".", "Type", ".", "GETX", "}", ")", "{", "final", "LineMessage", "get", "=", "new", "Message", ".", "GET", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "ACK", "(", "get", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetAndCHNGD_OWNRThenGETAgain", "(", ")", "throws", "Exception", "{", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "when", "(", "cluster", ".", "getMaster", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ".", "thenReturn", "(", "makeNodeInfo", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ";", "LineMessage", "msg", "=", "(", "LineMessage", ")", "captureMessage", "(", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "true", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetAndCHNGD_OWNRAndNoNodeThenGETAgainIgnoreChange", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "Mockito", ".", "reset", "(", "comm", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "when", "(", "cluster", ".", "getMaster", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ".", "thenReturn", "(", "null", ")", ";", "LineMessage", "msg", "=", "(", "LineMessage", ")", "captureMessage", "(", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "true", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetxAndCHNGD_OWNRThenGETXAgain", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "when", "(", "cluster", ".", "getMaster", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ".", "thenReturn", "(", "makeNodeInfo", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "LineMessage", "msg", "=", "(", "LineMessage", ")", "captureMessage", "(", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "true", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetxAndINVFromServerThenGETXAgain", "(", ")", "throws", "Exception", "{", "assumeTrue", "(", "hasServer", ")", ";", "when", "(", "comm", ".", "isSendToServerInsteadOfMulticast", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "cache", "=", "makeCache", "(", "<NUM_LIT>", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INV", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetAndNOT_FOUNDAndHasServerThenGETFromServer", "(", ")", "throws", "Exception", "{", "assumeTrue", "(", "hasServer", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "id", "(", "<NUM_LIT>", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "NOT_FOUND", "(", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GET", "(", "sh", "(", "0", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetAndNOT_FOUNDAndNotHasServerThenThrowException", "(", ")", "throws", "Exception", "{", "assumeTrue", "(", "!", "hasServer", ")", ";", "final", "Op", "get", "=", "new", "Op", "(", "GET", ",", "id", "(", "<NUM_LIT>", ")", ",", "null", ")", ";", "cache", ".", "runOp", "(", "get", ")", ";", "cache", ".", "receive", "(", "Message", ".", "NOT_FOUND", "(", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ")", ")", ";", "try", "{", "get", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "ExecutionException", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "RefNotFoundException", ".", "class", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetAndNOT_FOUNDFromServerThenThrowException", "(", ")", "throws", "Exception", "{", "assumeTrue", "(", "hasServer", ")", ";", "final", "Op", "get", "=", "new", "Op", "(", "GET", ",", "id", "(", "<NUM_LIT>", ")", ",", "null", ")", ";", "cache", ".", "runOp", "(", "get", ")", ";", "cache", ".", "receive", "(", "Message", ".", "NOT_FOUND", "(", "Message", ".", "GET", "(", "sh", "(", "0", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ")", ")", ";", "try", "{", "get", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "ExecutionException", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "RefNotFoundException", ".", "class", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenMSGAndNoLineThenCHNGD_OWNER", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "cache", ".", "receive", "(", "msg", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "-", "1", ")", ",", "false", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenMSGBcastAndNoLineThenACK", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "cache", ".", "receive", "(", "msg", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "ACK", "(", "msg", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndNotOwnerThenCHNGD_OWNER", "(", ")", "throws", "Exception", "{", "for", "(", "Message", ".", "Type", "getType", ":", "new", "Message", ".", "Type", "[", "]", "{", "Message", ".", "Type", ".", "GET", ",", "Message", ".", "Type", ".", "GETX", "}", ")", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "LineMessage", "get", "=", "new", "Message", ".", "GET", "(", "getType", ",", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "get", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "true", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETBcastAndKnownOwnerThenCHNGD_OWNER", "(", ")", "throws", "Exception", "{", "for", "(", "Message", ".", "Type", "getType", ":", "new", "Message", ".", "Type", "[", "]", "{", "Message", ".", "Type", ".", "GET", ",", "Message", ".", "Type", ".", "GETX", "}", ")", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "LineMessage", "get", "=", "new", "Message", ".", "GET", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "get", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "true", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETBcastAndUnknownOwnerThenACK", "(", ")", "throws", "Exception", "{", "for", "(", "Message", ".", "Type", "getType", ":", "new", "Message", ".", "Type", "[", "]", "{", "Message", ".", "Type", ".", "GET", ",", "Message", ".", "Type", ".", "GETX", "}", ")", "{", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "final", "LineMessage", "get", "=", "new", "Message", ".", "GET", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "get", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "ACK", "(", "get", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenINVAndNoLineThenINVACK", "(", ")", "throws", "Exception", "{", "Message", ".", "INV", "inv", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "cache", ".", "receive", "(", "inv", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INVACK", "(", "inv", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Ignore", "@", "Test", "public", "void", "whenGetXAndHasSlavesThenWaitForSlavesBeforePUTX", "(", ")", "throws", "Exception", "{", "when", "(", "backup", ".", "inv", "(", "anyLong", "(", ")", ",", "anyShort", "(", ")", ")", ")", ".", "thenReturn", "(", "false", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ",", "is", "(", "true", ")", ")", ";", "Message", ".", "GET", "getx", "=", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "getx", ")", ";", "verify", "(", "backup", ")", ".", "inv", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "getx", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "sh", "(", "<NUM_LIT:5>", ")", ",", "<NUM_LIT>", ")", ".", "setIncoming", "(", ")", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ",", "is", "(", "false", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "getx", ",", "<NUM_LIT>", ",", "new", "short", "[", "0", "]", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPutThenAllocateId", "(", ")", "throws", "Exception", "{", "final", "RefAllocationsListener", "listener", "=", "getRefAllocationListener", "(", "cluster", ")", ";", "Object", "res", ";", "Op", "put", ";", "put", "=", "new", "Op", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ";", "res", "=", "cache", ".", "runOp", "(", "put", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "cluster", ")", ".", "allocateRefs", "(", "anyInt", "(", ")", ")", ";", "listener", ".", "refsAllocated", "(", "<NUM_LIT:100>", ",", "<NUM_LIT:3>", ")", ";", "res", "=", "put", ".", "getResult", "(", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "res", "=", "get", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "(", "String", ")", "res", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "res", "=", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "res", "=", "get", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "(", "String", ")", "res", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "cluster", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "allocateRefs", "(", "anyInt", "(", ")", ")", ";", "res", "=", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "res", "=", "get", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "(", "String", ")", "res", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "put", "=", "new", "Op", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ";", "res", "=", "cache", ".", "runOp", "(", "put", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "listener", ".", "refsAllocated", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "res", "=", "put", ".", "getResult", "(", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "res", "=", "doOp", "(", "GET", ",", "<NUM_LIT>", ")", ";", "assertThat", "(", "deserialize", "(", "(", "byte", "[", "]", ")", "res", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "res", "=", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "res", "=", "get", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "(", "String", ")", "res", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "cluster", ",", "times", "(", "<NUM_LIT:3>", ")", ")", ".", "allocateRefs", "(", "anyInt", "(", ")", ")", ";", "res", "=", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "res", "=", "get", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "(", "String", ")", "res", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTXAndGetXThenINV", "(", ")", "throws", "Exception", "{", "PUTX", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertState", "(", "1", ",", "O", ",", "E", ")", ";", "assertVersion", "(", "1", ",", "1", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "assertThat", "(", "deserialize", "(", "(", "byte", "[", "]", ")", "res", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetxAndPUTXThenDontWaitForINVACKIffServer", "(", ")", "throws", "Exception", "{", "Op", "getx", "=", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "getx", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "if", "(", "hasServer", ")", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "else", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "else", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "if", "(", "hasServer", ")", "{", "assertThat", "(", "getx", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "deserialize", "(", "(", "byte", "[", "]", ")", "getx", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "else", "{", "assertThat", "(", "getx", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetxAndPUTXAndSendToServerThenDoWaitForINVACKFromServer", "(", ")", "throws", "Exception", "{", "assumeTrue", "(", "hasServer", ")", ";", "when", "(", "comm", ".", "isSendToServerInsteadOfMulticast", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "cache", "=", "makeCache", "(", "<NUM_LIT>", ")", ";", "Op", "getx", "=", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "getx", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "assertThat", "(", "getx", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertThat", "(", "getx", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "deserialize", "(", "(", "byte", "[", "]", ")", "getx", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGetxAndPUTXAndNoServerThenDoWaitForINVACKFromPreviousOwner", "(", ")", "throws", "Exception", "{", "assumeTrue", "(", "!", "hasServer", ")", ";", "Op", "getx", "=", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "getx", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "GETX", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "assertThat", "(", "getx", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "getx", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "deserialize", "(", "(", "byte", "[", "]", ")", "getx", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSAndGetxDontINVSelf", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:5>", ",", "<NUM_LIT:20>", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertState", "(", "1", ",", "O", ",", "E", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTXAndGetXThenDontRespondToRequests", "(", ")", "throws", "Exception", "{", "PUTX", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "if", "(", "hasServer", ")", "{", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "cache", ".", "unlockLine", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ",", "null", ")", ";", "}", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "1", ")", ")", ";", "assertState", "(", "1", ",", "O", ",", "E", ")", ";", "assertVersion", "(", "1", ",", "1", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "null", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTXAndGetXAndAcksAndRequestsThenRespond", "(", ")", "throws", "Exception", "{", "PUTX", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "Op", "getx", "=", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "getx", ")", ";", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "cache", ".", "unlockLine", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ",", "null", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "1", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "assertState", "(", "1", ",", "O", ",", "null", ")", ";", "assertVersion", "(", "1", ",", "1", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "1", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "deserialize", "(", "res", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTThenCompleteGet", "(", ")", "throws", "Exception", "{", "final", "Op", "get", "=", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "get", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "assertState", "(", "1", ",", "I", ",", "S", ")", ";", "PUT", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertState", "(", "1", ",", "S", ",", "null", ")", ";", "assertThat", "(", "deserialize", "(", "get", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPUTXThenCompleteGetx", "(", ")", "throws", "Exception", "{", "final", "Op", "getx", "=", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "getx", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "assertState", "(", "1", ",", "I", ",", "O", ")", ";", "PUTX", "(", "1", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "assertState", "(", "1", ",", "O", ",", "E", ")", ";", "if", "(", "hasServer", ")", "assertThat", "(", "deserialize", "(", "getx", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ";", "assertThat", "(", "deserialize", "(", "getx", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertState", "(", "1", ",", "E", ",", "null", ")", ";", "assertOwner", "(", "1", ",", "sh", "(", "<NUM_LIT:5>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPendingMessages1", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GETX", ",", "GETS", "}", ")", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "getType", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "comm", ")", ";", "cache", ".", "release", "(", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPendingMessages2", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "comm", ")", ";", "cache", ".", "release", "(", "<NUM_LIT>", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "Message", ".", "GETX", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "new", "short", "[", "]", "{", "sh", "(", "<NUM_LIT:10>", ")", "}", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "CHNGD_OWNR", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "false", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPendingOps", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "Mockito", ".", "reset", "(", "comm", ")", ";", "assertLocked", "(", "<NUM_LIT>", ",", "false", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "GET", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "any", "(", "Message", ".", "class", ")", ")", ";", "Object", "res", ";", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "SET", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "SET", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:5>", ")", ")", ")", ")", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:5>", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "E", ")", ";", "INVACK", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPendingOps2", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ")", ";", "if", "(", "hasServer", "(", ")", ")", "{", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ";", "}", "assertLocked", "(", "<NUM_LIT>", ",", "false", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "E", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "GET", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verifyNoMoreInteractions", "(", "comm", ")", ";", "Object", "res", ";", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "SET", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "res", "=", "cache", ".", "runOp", "(", "new", "Op", "(", "SET", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ")", ";", "assertThat", "(", "res", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "verifyNoMoreInteractions", "(", "comm", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "false", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:5>", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPushThenPUTtoTarget", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSH", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPushxThenPUTXtoTarget", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSHX", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "null", ")", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSHX", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", ")", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", ")", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPushAndWrongStateThenIgnore", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSH", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ",", "null", ")", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSH", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ")", ",", "null", ")", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSHX", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "null", ")", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSHX", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "null", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "any", "(", "Message", ".", "class", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSetThenAllowLocalOps", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "!", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "}", "</s>"]
["<s>", "@", "Ignore", "@", "Test", "public", "void", "whenSetSetAndSynchronousDontGetUntilBACKUPACK", "(", ")", "throws", "Exception", "{", "cache", "=", "makeCache", "(", "true", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "!", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "Op", "get", "=", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "get", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "get", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "true", ")", ")", ";", "assertThat", "(", "deserialize", "(", "(", "byte", "[", "]", ")", "get", ".", "getResult", "(", ")", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSetThenDontProecssMessagesUntilBACKUPACK", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "!", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSetThenDontPushUntilBACKUPACK", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "!", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "PUSH", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ")", ",", "null", ")", ")", ";", "GET", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:100>", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "sh", "(", "1", ")", ")", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "comm", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUTX", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "hasServer", "(", ")", "?", "new", "short", "[", "]", "{", "sh", "(", "0", ")", "}", ":", "sh", "(", ")", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPutThenDontProecssMessagesUntilBACKUPACK", "(", ")", "throws", "Exception", "{", "long", "id", "=", "put", "(", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "release", "(", "id", ")", ";", "assert", "!", "cache", ".", "getLine", "(", "id", ")", ".", "isLocked", "(", ")", ";", "assertState", "(", "id", ",", "E", ",", "null", ")", ";", "assertModified", "(", "id", ",", "true", ")", ";", "assertVersion", "(", "id", ",", "1", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "id", ")", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "id", ",", "1", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "id", ")", ",", "id", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "sh", "(", "0", ")", ",", "id", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "PUT", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "id", ")", ",", "id", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "onlyBackupUponEndTransaction", "(", ")", "throws", "Exception", "{", "Transaction", "txn", "=", "cache", ".", "beginTransaction", "(", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "(", "Persistable", ")", "null", ",", "null", ",", "txn", ")", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "isLocked", "(", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "txn", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:2>", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "verify", "(", "backup", ",", "never", "(", ")", ")", ".", "backup", "(", "anyLong", "(", ")", ",", "anyLong", "(", ")", ")", ";", "set", "(", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "txn", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "assertVersion", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "get", "(", "<NUM_LIT>", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "cache", ".", "endTransaction", "(", "txn", ",", "false", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "<NUM_LIT>", ",", "<NUM_LIT:3>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETThenFlushBackups", "(", ")", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "SET", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "assertModified", "(", "<NUM_LIT>", ",", "true", ")", ";", "verify", "(", "backup", ")", ".", "backup", "(", "anyLong", "(", ")", ",", "anyLong", "(", ")", ")", ";", "verify", "(", "backup", ",", "never", "(", ")", ")", ".", "flush", "(", ")", ";", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:100>", ")", ",", "<NUM_LIT>", ")", ")", ";", "verify", "(", "backup", ")", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDirtyReads1", "(", ")", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:4>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDirtyReads2", "(", ")", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:4>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:5>", "\"", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDirtyReads3", "(", ")", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:1>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:2>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:4>", "\"", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "evict", "(", "<NUM_LIT>", ",", "false", ")", ";", "evict", "(", "<NUM_LIT>", ",", "false", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "not", "(", "PENDING", ")", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT:3>", "\"", ")", ";", "assertThat", "(", "cache", ".", "runOp", "(", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ")", ",", "is", "(", "PENDING", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCacheListeners", "(", ")", "{", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "cache", ".", "addCacheListener", "(", "listener", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "received", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "received", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "listener", ")", ".", "invalidated", "(", "<NUM_LIT>", ")", ";", "evict", "(", "<NUM_LIT>", ",", "false", ")", ";", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testCacheLineListeners", "(", ")", "throws", "Exception", "{", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "doOp", "(", "LSTN", ",", "<NUM_LIT>", ",", "listener", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "received", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "listener", ")", ".", "received", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "listener", ")", ".", "invalidated", "(", "<NUM_LIT>", ")", ";", "evict", "(", "<NUM_LIT>", ",", "false", ")", ";", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenLocalInteractionThenDontNotifyListeners", "(", ")", "throws", "Exception", "{", "CacheListener", "listener1", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "CacheListener", "listener2", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "cache", ".", "addCacheListener", "(", "listener1", ")", ";", "long", "id", "=", "put", "(", "\"", "<STR_LIT>", "\"", ")", ";", "doOp", "(", "LSTN", ",", "id", ",", "listener2", ")", ";", "set", "(", "id", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "get", "(", "id", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ";", "set", "(", "id", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "get", "(", "id", ")", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", ";", "del", "(", "id", ")", ";", "verify", "(", "listener1", ")", ".", "evicted", "(", "id", ")", ";", "verify", "(", "listener2", ")", ".", "evicted", "(", "id", ")", ";", "verifyNoMoreInteractions", "(", "listener1", ")", ";", "verifyNoMoreInteractions", "(", "listener2", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSetLineListenerInCacheListener", "(", ")", "throws", "Exception", "{", "final", "CacheListener", "lineListener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "cache", ".", "addCacheListener", "(", "new", "CacheListener", "(", ")", "{", "@", "Override", "public", "void", "received", "(", "long", "id", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "try", "{", "doOp", "(", "LSTN", ",", "id", ",", "lineListener", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "@", "Override", "public", "void", "invalidated", "(", "long", "id", ")", "{", "}", "@", "Override", "public", "void", "evicted", "(", "long", "id", ")", "{", "}", "}", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verify", "(", "lineListener", ")", ".", "received", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ",", "toBuffer", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "verify", "(", "lineListener", ")", ".", "invalidated", "(", "<NUM_LIT>", ")", ";", "evict", "(", "<NUM_LIT>", ",", "false", ")", ";", "verify", "(", "lineListener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "verifyNoMoreInteractions", "(", "lineListener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "received", "(", "long", "id", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "try", "{", "doOp", "(", "LSTN", ",", "id", ",", "lineListener", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "invalidated", "(", "long", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "evicted", "(", "long", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testDel", "(", ")", "throws", "Exception", "{", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "del", "(", "<NUM_LIT>", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", ")", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ",", "is", "(", "true", ")", ")", ";", "if", "(", "hasServer", "(", ")", ")", "{", "assertLocked", "(", "<NUM_LIT>", ",", "false", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "DEL", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ")", ")", ";", "}", "assertState", "(", "<NUM_LIT>", ",", "I", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenDeletedAndGETThenNOT_FOUND", "(", ")", "{", "pending", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSend", "(", ")", "throws", "Exception", "{", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:15>", ")", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "cache", ".", "send", "(", "msg", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "msg", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSendToOwner1", "(", ")", "{", "MessageReceiver", "receiver", "=", "mock", "(", "MessageReceiver", ".", "class", ")", ";", "cache", ".", "setReceiver", "(", "receiver", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "1", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ",", "null", ")", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:5>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSendToOwner2", "(", ")", "throws", "Exception", "{", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSGACK", "(", "msg", ")", ")", ";", "assertThat", "(", "send", ".", "getResult", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSendToOwner3", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSGACK", "(", "msg", ")", ")", ";", "assertThat", "(", "send", ".", "getResult", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSendToOwner4", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "MSG", "msg", "=", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "Op", "send", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "msg", ",", "null", ")", ";", "Object", "res", "=", "cache", ".", "runOp", "(", "send", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "when", "(", "cluster", ".", "getMaster", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ".", "thenReturn", "(", "makeNodeInfo", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "true", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "true", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "when", "(", "cluster", ".", "getMaster", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ")", ".", "thenReturn", "(", "makeNodeInfo", "(", "sh", "(", "<NUM_LIT:30>", ")", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ",", "true", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:30>", ")", ",", "true", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "MSG", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ")", ")", ")", ";", "assertThat", "(", "send", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "MSGACK", "(", "msg", ")", ")", ";", "assertThat", "(", "send", ".", "getResult", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenINVAndNodeNotFoundThenINVACKSelf", "(", ")", "throws", "Exception", "{", "doThrow", "(", "new", "NodeNotFoundException", "(", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ".", "when", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "doThrow", "(", "new", "NodeNotFoundException", "(", "sh", "(", "<NUM_LIT>", ")", ")", ")", ".", "when", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ")", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "1", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ",", "<NUM_LIT>", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "E", ")", ";", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ")", ")", ";", "if", "(", "hasServer", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "sh", "(", "0", ")", ",", "<NUM_LIT>", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "E", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenGETAndNodeNotFoundThenCHNGD_OWNRSelf", "(", ")", "throws", "Exception", "{", "for", "(", "Op", ".", "Type", "getType", ":", "new", "Op", ".", "Type", "[", "]", "{", "GET", ",", "GETX", "}", ")", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "INV", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "doThrow", "(", "new", "NodeNotFoundException", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "when", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "getType", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "matchingMessage", "(", "getType", ",", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ")", ")", ")", ")", ";", "reset", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenTimeoutThenInterruptPendingOps", "(", ")", "throws", "Exception", "{", "final", "Op", "op1", "=", "new", "Op", "(", "GET", ",", "<NUM_LIT>", ",", "null", ")", ";", "final", "Op", "op2", "=", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ";", "final", "Op", "op3", "=", "new", "Op", "(", "SET", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ",", "null", ")", ";", "final", "Op", "op4", "=", "new", "Op", "(", "SEND", ",", "<NUM_LIT>", ",", "Message", ".", "MSG", "(", "sh", "(", "-", "1", ")", ",", "<NUM_LIT>", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", ")", ")", ",", "null", ")", ";", "Object", "res1", "=", "cache", ".", "runOp", "(", "op1", ")", ";", "Object", "res2", "=", "cache", ".", "runOp", "(", "op2", ")", ";", "Object", "res3", "=", "cache", ".", "runOp", "(", "op3", ")", ";", "Object", "res4", "=", "cache", ".", "runOp", "(", "op4", ")", ";", "assertThat", "(", "res1", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "res2", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "res3", ",", "is", "(", "PENDING", ")", ")", ";", "assertThat", "(", "res4", ",", "is", "(", "PENDING", ")", ")", ";", "cache", ".", "receive", "(", "Message", ".", "TIMEOUT", "(", "new", "LineMessage", "(", "sh", "(", "1", ")", ",", "Type", ".", "GET", ",", "<NUM_LIT>", ")", ")", ")", ";", "try", "{", "op1", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "TimeoutException", ".", "class", ")", ")", ")", ";", "}", "try", "{", "op2", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "TimeoutException", ".", "class", ")", ")", ")", ";", "}", "try", "{", "op3", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "TimeoutException", ".", "class", ")", ")", ")", ";", "}", "try", "{", "op4", ".", "getResult", "(", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "assertThat", "(", "e", ".", "getCause", "(", ")", ",", "is", "(", "instanceOf", "(", "TimeoutException", ".", "class", ")", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testEviction1", "(", ")", "throws", "Exception", "{", "cache", "=", "makeCache", "(", "<NUM_LIT>", ")", ";", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "cache", ".", "addCacheListener", "(", "listener", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "GETX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "get", "(", "<NUM_LIT>", ")", ";", "get", "(", "<NUM_LIT>", ")", ";", "get", "(", "<NUM_LIT>", ")", ";", "get", "(", "<NUM_LIT>", ")", ";", "GETX", "(", "<NUM_LIT:16>", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "for", "(", "long", "i", "=", "<NUM_LIT>", ";", "i", "<", "=", "<NUM_LIT>", ";", "i", "+", "+", ")", "PUTX", "(", "i", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "long", "i", "=", "<NUM_LIT>", ";", "i", "<", "=", "<NUM_LIT>", ";", "i", "+", "+", ")", "PUT", "(", "i", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "InOrder", "inOrder", "=", "inOrder", "(", "listener", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "inOrder", ".", "verify", "(", "listener", ")", ".", "evicted", "(", "<NUM_LIT:16>", ")", ";", "for", "(", "long", "i", "=", "<NUM_LIT>", ";", "i", "<", "=", "<NUM_LIT>", ";", "i", "+", "+", ")", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "evicted", "(", "i", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNodeRemovedThenCleanUp", "(", ")", "throws", "Exception", "{", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "PUTX", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:10>", ",", "<NUM_LIT:20>", ",", "<NUM_LIT:30>", ")", ";", "PUT", "(", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "\"", "<STR_LIT>", "\"", ")", ";", "CacheListener", "listener", "=", "mock", "(", "CacheListener", ".", "class", ")", ";", "cache", ".", "addCacheListener", "(", "listener", ")", ";", "cache", ".", "nodeRemoved", "(", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "I", ",", "null", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "I", ",", "null", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "O", ",", "null", ")", ";", "assertState", "(", "<NUM_LIT>", ",", "S", ",", "null", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "verify", "(", "listener", ",", "never", "(", ")", ")", ".", "evicted", "(", "<NUM_LIT>", ")", ";", "cache", ".", "runOp", "(", "new", "Op", "(", "GETX", ",", "<NUM_LIT>", ",", "null", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:20>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:30>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ")", ")", ";", "if", "(", "hasServer", ")", "verify", "(", "comm", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ")", ")", ";", "verify", "(", "comm", ",", "never", "(", ")", ")", ".", "send", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "<NUM_LIT>", ",", "sh", "(", "<NUM_LIT:20>", ")", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenPutOrSetOverMaxItemSizeThenThrowException", "(", ")", "throws", "Exception", "{", "cache", ".", "setMaxItemSize", "(", "<NUM_LIT:7>", ")", ";", "long", "id", "=", "put", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "put", "(", "\"", "<STR_LIT>", "\"", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "}", "set", "(", "id", ",", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "set", "(", "id", ",", "\"", "<STR_LIT>", "\"", ")", ";", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNullData", "(", ")", "throws", "Exception", "{", "long", "ref1", "=", "put", "(", "null", ")", ";", "assertThat", "(", "get", "(", "ref1", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "set", "(", "ref1", ",", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "get", "(", "ref1", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "long", "ref2", "=", "put", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assertThat", "(", "get", "(", "ref2", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "set", "(", "ref2", ",", "null", ")", ";", "assertThat", "(", "get", "(", "ref2", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testAlloc", "(", ")", "throws", "Exception", "{", "final", "RefAllocationsListener", "listener", "=", "getRefAllocationListener", "(", "cluster", ")", ";", "Object", "res", ";", "Op", "alloc", ";", "Transaction", "txn", "=", "cache", ".", "beginTransaction", "(", ")", ";", "alloc", "=", "new", "Op", "(", "ALLOC", ",", "-", "<NUM_LIT>", ",", "<NUM_LIT:10>", ",", "txn", ")", ";", "res", "=", "cache", ".", "runOp", "(", "alloc", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "cluster", ")", ".", "allocateRefs", "(", "anyInt", "(", ")", ")", ";", "listener", ".", "refsAllocated", "(", "<NUM_LIT:100>", ",", "<NUM_LIT:3>", ")", ";", "assertThat", "(", "alloc", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "listener", ".", "refsAllocated", "(", "<NUM_LIT>", ",", "<NUM_LIT:30>", ")", ";", "res", "=", "alloc", ".", "getResult", "(", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:10>", ";", "i", "+", "+", ")", "{", "res", "=", "get", "(", "<NUM_LIT>", "+", "i", ")", ";", "assertThat", "(", "res", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertModified", "(", "<NUM_LIT>", "+", "i", ",", "true", ")", ";", "assertThat", "(", "cache", ".", "getLine", "(", "<NUM_LIT>", "+", "i", ")", ".", "isLocked", "(", ")", ",", "is", "(", "true", ")", ")", ";", "}", "res", "=", "doOp", "(", "ALLOC", ",", "-", "<NUM_LIT>", ",", "<NUM_LIT:7>", ",", "txn", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "alloc", "=", "new", "Op", "(", "ALLOC", ",", "-", "<NUM_LIT>", ",", "<NUM_LIT:20>", ",", "txn", ")", ";", "res", "=", "cache", ".", "runOp", "(", "alloc", ")", ";", "assertThat", "(", "res", ",", "is", "(", "PENDING", ")", ")", ";", "verify", "(", "cluster", ",", "atLeastOnce", "(", ")", ")", ".", "allocateRefs", "(", "anyInt", "(", ")", ")", ";", "listener", ".", "refsAllocated", "(", "<NUM_LIT>", ",", "<NUM_LIT:10>", ")", ";", "assertThat", "(", "alloc", ".", "getFuture", "(", ")", ".", "isDone", "(", ")", ",", "is", "(", "false", ")", ")", ";", "listener", ".", "refsAllocated", "(", "<NUM_LIT>", ",", "<NUM_LIT>", ")", ";", "res", "=", "alloc", ".", "getResult", "(", ")", ";", "assertThat", "(", "(", "Long", ")", "res", ",", "is", "(", "<NUM_LIT>", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testTransactions", "(", ")", "{", "pending", "(", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "hasServer", "(", ")", "{", "return", "hasServer", ";", "}", "</s>"]
["<s>", "private", "LineMessage", "matchingMessage", "(", "Op", ".", "Type", "type", ",", "short", "node", ",", "long", "line", ")", "{", "switch", "(", "type", ")", "{", "case", "GET", ":", "case", "GETS", ":", "return", "Message", ".", "GET", "(", "node", ",", "line", ")", ";", "case", "GETX", ":", "return", "Message", ".", "GETX", "(", "node", ",", "line", ")", ";", "default", ":", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "type", ")", ";", "}", "}", "</s>"]
["<s>", "void", "makeShared", "(", "long", "id", ")", "{", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:10>", ")", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "void", "makeInvalid", "(", "short", "owner", ",", "long", "id", ")", "{", "cache", ".", "receive", "(", "Message", ".", "INV", "(", "owner", ",", "id", ",", "owner", ")", ".", "setMessageId", "(", "+", "+", "messageId", ")", ")", ";", "}", "</s>"]
["<s>", "void", "PUT", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "String", "obj", ")", "{", "cache", ".", "receive", "(", "Message", ".", "PUT", "(", "owner", ",", "id", ",", "version", ",", "toBuffer", "(", "obj", ")", ")", ".", "setMessageId", "(", "+", "+", "messageId", ")", ")", ";", "}", "</s>"]
["<s>", "void", "PUTX", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "String", "obj", ",", "int", ".", ".", ".", "sharers", ")", "{", "short", "[", "]", "ssharers", "=", "new", "short", "[", "sharers", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "sharers", ".", "length", ";", "i", "+", "+", ")", "ssharers", "[", "i", "]", "=", "(", "short", ")", "sharers", "[", "i", "]", ";", "cache", ".", "receive", "(", "Message", ".", "PUTX", "(", "Message", ".", "GETX", "(", "owner", ",", "id", ")", ",", "id", ",", "ssharers", ",", "version", ",", "toBuffer", "(", "obj", ")", ")", ".", "setMessageId", "(", "+", "+", "messageId", ")", ")", ";", "}", "</s>"]
["<s>", "void", "PUTX", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "String", "obj", ")", "{", "cache", ".", "receive", "(", "Message", ".", "PUTX", "(", "Message", ".", "GETX", "(", "owner", ",", "id", ")", ",", "id", ",", "new", "short", "[", "0", "]", ",", "version", ",", "toBuffer", "(", "obj", ")", ")", ".", "setMessageId", "(", "+", "+", "messageId", ")", ")", ";", "if", "(", "hasServer", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "0", ")", ",", "id", ",", "owner", ")", ")", ")", ";", "}", "</s>"]
["<s>", "void", "GET", "(", "long", "id", ",", "short", "node", ")", "{", "cache", ".", "receive", "(", "Message", ".", "GET", "(", "node", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "void", "GETX", "(", "long", "id", ",", "short", "node", ")", "{", "cache", ".", "receive", "(", "Message", ".", "GETX", "(", "node", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "void", "INV", "(", "long", "id", ",", "short", "owner", ")", "{", "cache", ".", "receive", "(", "Message", ".", "INV", "(", "owner", ",", "id", ",", "owner", ")", ".", "setMessageId", "(", "+", "+", "messageId", ")", ")", ";", "}", "</s>"]
["<s>", "void", "INVACK", "(", "long", "id", ",", "short", "owner", ")", "{", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "owner", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "long", "put", "(", "String", "obj", ")", "throws", "Exception", "{", "getRefAllocationListener", "(", "cluster", ")", ".", "refsAllocated", "(", "<NUM_LIT:100>", ",", "<NUM_LIT:1000>", ")", ";", "return", "(", "Long", ")", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "serialize", "(", "obj", ")", ")", ";", "}", "</s>"]
["<s>", "String", "get", "(", "long", "id", ")", "throws", "Exception", "{", "return", "deserialize", "(", "(", "byte", "[", "]", ")", "doOp", "(", "GET", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "void", "set", "(", "long", "id", ",", "String", "obj", ")", "throws", "Exception", "{", "doOp", "(", "SET", ",", "id", ",", "serialize", "(", "obj", ")", ")", ";", "}", "</s>"]
["<s>", "void", "set", "(", "long", "id", ",", "String", "obj", ",", "Transaction", "txn", ")", "throws", "Exception", "{", "doOp", "(", "SET", ",", "id", ",", "serialize", "(", "obj", ")", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "void", "del", "(", "long", "id", ")", "throws", "Exception", "{", "doOp", "(", "DEL", ",", "id", ")", ";", "}", "</s>"]
["<s>", "private", "Message", "captureMessage", "(", ")", "throws", "Exception", "{", "ArgumentCaptor", "<", "Message", ">", "captor", "=", "(", "ArgumentCaptor", ")", "ArgumentCaptor", ".", "forClass", "(", "Message", ".", "class", ")", ";", "verify", "(", "comm", ")", ".", "send", "(", "captor", ".", "capture", "(", ")", ")", ";", "return", "captor", ".", "getValue", "(", ")", ";", "}", "</s>"]
["<s>", "private", "NodeInfo", "makeNodeInfo", "(", "final", "short", "node", ")", "{", "return", "new", "NodeInfo", "(", ")", "{", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "node", ";", "}", "@", "Override", "public", "short", "getNodeId", "(", ")", "{", "return", "node", ";", "}", "@", "Override", "public", "Object", "get", "(", "String", "property", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "@", "Override", "public", "Collection", "<", "String", ">", "getProperties", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "getNodeId", "(", ")", "{", "return", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "get", "(", "String", "property", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Collection", "<", "String", ">", "getProperties", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "RefAllocationsListener", "getRefAllocationListener", "(", "RefAllocator", "mock", ")", "{", "try", "{", "return", "(", "RefAllocationsListener", ")", "capture", "(", "mock", ",", "\"", "<STR_LIT>", "\"", ",", "arg", "(", "RefAllocationsListener", ".", "class", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "void", "assertState", "(", "long", "id", ",", "State", "state", ",", "State", "nextState", ")", "{", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "id", ")", ";", "assertThat", "(", "line", ".", "getState", "(", ")", ",", "is", "(", "state", ")", ")", ";", "assertThat", "(", "line", ".", "getNextState", "(", ")", ",", "is", "(", "nextState", ")", ")", ";", "}", "</s>"]
["<s>", "void", "assertOwner", "(", "long", "id", ",", "short", "node", ")", "{", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "id", ")", ";", "assertThat", "(", "line", ".", "getOwner", "(", ")", ",", "is", "(", "node", ")", ")", ";", "}", "</s>"]
["<s>", "void", "assertVersion", "(", "long", "id", ",", "long", "version", ")", "{", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "id", ")", ";", "assertThat", "(", "line", ".", "getVersion", "(", ")", ",", "is", "(", "version", ")", ")", ";", "}", "</s>"]
["<s>", "void", "assertLocked", "(", "long", "id", ",", "boolean", "value", ")", "{", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "id", ")", ";", "assertThat", "(", "line", ".", "isLocked", "(", ")", ",", "is", "(", "value", ")", ")", ";", "}", "</s>"]
["<s>", "void", "assertModified", "(", "long", "id", ",", "boolean", "value", ")", "{", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "id", ")", ";", "assertThat", "(", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ",", "is", "(", "value", ")", ")", ";", "}", "</s>"]
["<s>", "void", "evict", "(", "long", "id", ",", "boolean", "invack", ")", "{", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "id", ")", ";", "cache", ".", "evictLine", "(", "line", ",", "invack", ")", ";", "}", "</s>"]
["<s>", "static", "long", "id", "(", "long", "id", ")", "{", "return", "Cache", ".", "MAX_RESERVED_REF_ID", "+", "id", ";", "}", "</s>"]
["<s>", "static", "short", "sh", "(", "int", "x", ")", "{", "return", "(", "short", ")", "x", ";", "}", "</s>"]
["<s>", "static", "short", "[", "]", "sh", "(", "int", ".", ".", ".", "args", ")", "{", "final", "short", "[", "]", "array", "=", "new", "short", "[", "args", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "short", ")", "args", "[", "i", "]", ";", "return", "array", ";", "}", "</s>"]
["<s>", "static", "ByteBuffer", "toBuffer", "(", "String", "object", ")", "{", "return", "ByteBuffer", ".", "wrap", "(", "serialize", "(", "object", ")", ")", ";", "}", "</s>"]
["<s>", "static", "byte", "[", "]", "serialize", "(", "String", "object", ")", "{", "return", "object", "!", "=", "null", "?", "object", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ":", "null", ";", "}", "</s>"]
["<s>", "static", "String", "deserialize", "(", "Object", "obj", ")", "{", "return", "deserialize", "(", "(", "byte", "[", "]", ")", "obj", ")", ";", "}", "</s>"]
["<s>", "static", "String", "deserialize", "(", "byte", "[", "]", "array", ")", "{", "return", "array", "!", "=", "null", "?", "new", "String", "(", "array", ",", "Charsets", ".", "UTF_8", ")", ":", "null", ";", "}", "</s>"]
["<s>", "static", "void", "pending", "(", ")", "{", "fail", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "byte", "[", "]", "data", ",", "Object", "extra", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "(", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ")", ",", "extra", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "ByteBuffer", "data", ",", "Object", "extra", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Persistable", "data", ",", "Object", "extra", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Object", "extra", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "null", ",", "extra", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "null", ",", "null", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", "{", "return", "doOp", "(", "type", ",", "line", ",", "data", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "ByteBuffer", "data", ")", "throws", "TimeoutException", "{", "return", "doOp", "(", "type", ",", "line", ",", "data", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Persistable", "data", ")", "throws", "TimeoutException", "{", "return", "doOp", "(", "type", ",", "line", ",", "data", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "byte", "[", "]", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "(", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ")", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "ByteBuffer", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Persistable", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Object", "extra", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "null", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "cache", ".", "doOp", "(", "type", ",", "line", ",", "(", "Object", ")", "null", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "byte", "[", "]", "data", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "doOp", "(", "type", ",", "line", ",", "data", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "ByteBuffer", "data", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "doOp", "(", "type", ",", "line", ",", "data", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "line", ",", "Persistable", "data", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "doOp", "(", "type", ",", "line", ",", "data", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Boolean", "initialValue", "(", ")", "{", "return", "Boolean", ".", "FALSE", ";", "}", "</s>"]
["<s>", "private", "static", "<", "T", ">", "Answer", "<", "T", ">", "logAnswer", "(", "final", "Answer", "<", "T", ">", "answer", ")", "{", "return", "new", "Answer", "(", ")", "{", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Object", "retValue", ";", "try", "{", "retValue", "=", "answer", ".", "answer", "(", "invocation", ")", ";", "if", "(", "log", ".", "get", "(", ")", ")", "{", "if", "(", "!", "(", "invocation", ".", "getMethod", "(", ")", ".", "getName", "(", ")", ".", "equals", "(", "\"", "<STR_LIT:String>", "\"", ")", "&", "&", "invocation", ".", "getMethod", "(", ")", ".", "getParameterTypes", "(", ")", ".", "length", "=", "=", "0", "&", "&", "invocation", ".", "getMethod", "(", ")", ".", "getReturnType", "(", ")", ".", "equals", "(", "String", ".", "class", ")", ")", ")", "{", "if", "(", "invocation", ".", "getMethod", "(", ")", ".", "getReturnType", "(", ")", ".", "equals", "(", "void", ".", "class", ")", "|", "|", "invocation", ".", "getMethod", "(", ")", ".", "getReturnType", "(", ")", ".", "equals", "(", "Void", ".", "class", ")", ")", "System", ".", "out", ".", "println", "(", "(", "Thread", ".", "currentThread", "(", ")", "!", "=", "mainThread", ".", "get", "(", ")", "?", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "invocation", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "Thread", ".", "currentThread", "(", ")", ".", "getStackTrace", "(", ")", ")", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "else", "System", ".", "out", ".", "println", "(", "(", "Thread", ".", "currentThread", "(", ")", "!", "=", "mainThread", ".", "get", "(", ")", "?", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "invocation", "+", "\"", "<STR_LIT>", "\"", "+", "retValue", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "Thread", ".", "currentThread", "(", ")", ".", "getStackTrace", "(", ")", ")", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "}", "return", "retValue", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "if", "(", "log", ".", "get", "(", ")", ")", "System", ".", "out", ".", "println", "(", "(", "Thread", ".", "currentThread", "(", ")", "!", "=", "mainThread", ".", "get", "(", ")", "?", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "invocation", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "t", ")", ";", "throw", "t", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Object", "retValue", ";", "try", "{", "retValue", "=", "answer", ".", "answer", "(", "invocation", ")", ";", "if", "(", "log", ".", "get", "(", ")", ")", "{", "if", "(", "!", "(", "invocation", ".", "getMethod", "(", ")", ".", "getName", "(", ")", ".", "equals", "(", "\"", "<STR_LIT:String>", "\"", ")", "&", "&", "invocation", ".", "getMethod", "(", ")", ".", "getParameterTypes", "(", ")", ".", "length", "=", "=", "0", "&", "&", "invocation", ".", "getMethod", "(", ")", ".", "getReturnType", "(", ")", ".", "equals", "(", "String", ".", "class", ")", ")", ")", "{", "if", "(", "invocation", ".", "getMethod", "(", ")", ".", "getReturnType", "(", ")", ".", "equals", "(", "void", ".", "class", ")", "|", "|", "invocation", ".", "getMethod", "(", ")", ".", "getReturnType", "(", ")", ".", "equals", "(", "Void", ".", "class", ")", ")", "System", ".", "out", ".", "println", "(", "(", "Thread", ".", "currentThread", "(", ")", "!", "=", "mainThread", ".", "get", "(", ")", "?", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "invocation", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "Thread", ".", "currentThread", "(", ")", ".", "getStackTrace", "(", ")", ")", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "else", "System", ".", "out", ".", "println", "(", "(", "Thread", ".", "currentThread", "(", ")", "!", "=", "mainThread", ".", "get", "(", ")", "?", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "invocation", "+", "\"", "<STR_LIT>", "\"", "+", "retValue", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "Thread", ".", "currentThread", "(", ")", ".", "getStackTrace", "(", ")", ")", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "}", "}", "return", "retValue", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "if", "(", "log", ".", "get", "(", ")", ")", "System", ".", "out", ".", "println", "(", "(", "Thread", ".", "currentThread", "(", ")", "!", "=", "mainThread", ".", "get", "(", ")", "?", "Thread", ".", "currentThread", "(", ")", ".", "getName", "(", ")", ":", "\"", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "invocation", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "t", ")", ";", "throw", "t", ";", "}", "}", "</s>"]
["<s>", "public", "static", "void", "startLogging", "(", ")", "{", "mainThread", ".", "set", "(", "Thread", ".", "currentThread", "(", ")", ")", ";", "log", ".", "set", "(", "true", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "stopLogging", "(", ")", "{", "log", ".", "set", "(", "false", ")", ";", "mainThread", ".", "set", "(", "null", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "spy", "(", "T", "object", ")", "{", "return", "Mockito", ".", "mock", "(", "(", "Class", "<", "T", ">", ")", "object", ".", "getClass", "(", ")", ",", "Mockito", ".", "withSettings", "(", ")", ".", "spiedInstance", "(", "object", ")", ".", "defaultAnswer", "(", "logAnswer", "(", "Mockito", ".", "CALLS_REAL_METHODS", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "mock", "(", "Class", "<", "T", ">", "classToMock", ")", "{", "return", "Mockito", ".", "mock", "(", "classToMock", ",", "Mockito", ".", "withSettings", "(", ")", ".", "defaultAnswer", "(", "LOGS_CALLS", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "mock", "(", "Class", "<", "T", ">", "classToMock", ",", "String", "name", ")", "{", "return", "Mockito", ".", "mock", "(", "classToMock", ",", "Mockito", ".", "withSettings", "(", ")", ".", "name", "(", "name", ")", ".", "defaultAnswer", "(", "LOGS_CALLS", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "T", "mock", "(", "Class", "<", "T", ">", "classToMock", ",", "MockSettings", "mockSettings", ")", "{", "return", "Mockito", ".", "mock", "(", "classToMock", ",", "mockSettings", ".", "defaultAnswer", "(", "LOGS_CALLS", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "OngoingStubbing", "<", "T", ">", "when", "(", "T", "methodCall", ")", "{", "return", "new", "OngoingStubbingExt", "<", "T", ">", "(", "Mockito", ".", "when", "(", "methodCall", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Stubber", "doThrow", "(", "Throwable", "toBeThrown", ")", "{", "return", "doAnswer", "(", "new", "ThrowsException", "(", "toBeThrown", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Stubber", "doReturn", "(", "Object", "toBeReturned", ")", "{", "return", "doAnswer", "(", "new", "Returns", "(", "toBeReturned", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Stubber", "doNothing", "(", ")", "{", "return", "doAnswer", "(", "new", "DoesNothing", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Stubber", "doAnswer", "(", "Answer", "answer", ")", "{", "return", "new", "StubberExt", "(", "Mockito", ".", "doAnswer", "(", "logAnswer", "(", "answer", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "OngoingStubbingExt", "(", "OngoingStubbing", "<", "T", ">", "delegate", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "thenThrow", "(", "Throwable", ".", ".", ".", "throwables", ")", "{", "if", "(", "throwables", ".", "length", ">", "1", ")", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "return", "thenAnswer", "(", "new", "ThrowsException", "(", "throwables", "[", "0", "]", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "thenThrow", "(", "Class", "<", "?", "extends", "Throwable", ">", ".", ".", ".", "throwableClasses", ")", "{", "try", "{", "if", "(", "throwableClasses", ".", "length", ">", "0", ")", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "return", "thenAnswer", "(", "new", "ThrowsException", "(", "throwableClasses", "[", "0", "]", ".", "newInstance", "(", ")", ")", ")", ";", "}", "catch", "(", "InstantiationException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "thenReturn", "(", "T", "value", ",", "T", ".", ".", ".", "values", ")", "{", "if", "(", "values", ".", "length", ">", "0", ")", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "return", "thenReturn", "(", "value", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "thenReturn", "(", "T", "retValue", ")", "{", "return", "thenAnswer", "(", "new", "Returns", "(", "retValue", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "thenCallRealMethod", "(", ")", "{", "return", "thenAnswer", "(", "new", "CallsRealMethods", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "thenAnswer", "(", "Answer", "<", "?", ">", "answer", ")", "{", "return", "new", "OngoingStubbingExt", "(", "delegate", ".", "thenAnswer", "(", "logAnswer", "(", "answer", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "OngoingStubbing", "<", "T", ">", "then", "(", "Answer", "<", "?", ">", "answer", ")", "{", "return", "new", "OngoingStubbingExt", "(", "delegate", ".", "then", "(", "logAnswer", "(", "answer", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "M", ">", "M", "getMock", "(", ")", "{", "return", "delegate", ".", "getMock", "(", ")", ";", "}", "</s>"]
["<s>", "public", "StubberExt", "(", "Stubber", "delegate", ")", "{", "this", ".", "delegate", "=", "delegate", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Stubber", "doThrow", "(", "Throwable", "toBeThrown", ")", "{", "return", "doAnswer", "(", "new", "ThrowsException", "(", "toBeThrown", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Stubber", "doThrow", "(", "Class", "<", "?", "extends", "Throwable", ">", "toBeThrown", ")", "{", "try", "{", "return", "doAnswer", "(", "new", "ThrowsException", "(", "toBeThrown", ".", "newInstance", "(", ")", ")", ")", ";", "}", "catch", "(", "InstantiationException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Stubber", "doReturn", "(", "Object", "toBeReturned", ")", "{", "return", "doAnswer", "(", "new", "Returns", "(", "toBeReturned", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Stubber", "doNothing", "(", ")", "{", "return", "doAnswer", "(", "new", "DoesNothing", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Stubber", "doAnswer", "(", "Answer", "answer", ")", "{", "return", "new", "StubberExt", "(", "delegate", ".", "doAnswer", "(", "logAnswer", "(", "answer", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", ">", "T", "when", "(", "T", "mock", ")", "{", "return", "delegate", ".", "when", "(", "mock", ")", ";", "}", "</s>"]
["<s>", "private", "LogMock", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "Placeholder", "<", "T", ">", "arg", "(", "Class", "<", "T", ">", "clazz", ")", "{", "return", "new", "Placeholder", "(", "clazz", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Object", "capture", "(", "Object", "mock", ",", "String", "methodName", ",", "Object", ".", ".", ".", "args", ")", "{", "return", "capture", "(", "mock", ",", "times", "(", "1", ")", ",", "methodName", ",", "args", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Object", "capture", "(", "Object", "mock", ",", "VerificationMode", "mode", ",", "String", "methodName", ",", "Object", ".", ".", ".", "args", ")", "{", "try", "{", "int", "argIndex", "=", "-", "1", ";", "Class", "argType", "=", "null", ";", "Class", "[", "]", "types", "=", "new", "Class", "[", "args", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "args", "[", "i", "]", "instanceof", "Placeholder", ")", "{", "if", "(", "argType", "!", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "argIndex", "=", "i", ";", "argType", "=", "(", "(", "Placeholder", ")", "args", "[", "i", "]", ")", ".", "clazz", ";", "types", "[", "i", "]", "=", "argType", ";", "}", "else", "types", "[", "i", "]", "=", "Primitives", ".", "unwrap", "(", "args", "[", "i", "]", ".", "getClass", "(", ")", ")", ";", "}", "final", "Method", "method", "=", "mock", ".", "getClass", "(", ")", ".", "getDeclaredMethod", "(", "methodName", ",", "types", ")", ";", "method", ".", "setAccessible", "(", "true", ")", ";", "ArgumentCaptor", "captor", "=", "ArgumentCaptor", ".", "forClass", "(", "argType", ")", ";", "method", ".", "invoke", "(", "verify", "(", "mock", ",", "mode", ")", ",", "replace", "(", "args", ",", "argIndex", ",", "captor", ")", ")", ";", "return", "captor", ".", "getValue", "(", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "InvocationTargetException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ".", "getCause", "(", ")", ")", ";", "}", "catch", "(", "NoSuchMethodException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "SecurityException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "Object", "[", "]", "replace", "(", "Object", "[", "]", "args", ",", "int", "index", ",", "ArgumentCaptor", "captor", ")", "{", "Object", "[", "]", "res", "=", "new", "Object", "[", "args", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "i", "=", "=", "index", ")", "res", "[", "i", "]", "=", "captor", ".", "capture", "(", ")", ";", "else", "res", "[", "i", "]", "=", "eq", "(", "args", "[", "i", "]", ")", ";", "}", "return", "res", ";", "}", "</s>"]
["<s>", "public", "Placeholder", "(", "Class", "<", "T", ">", "clazz", ")", "{", "this", ".", "clazz", "=", "clazz", ";", "}", "</s>"]
["<s>", "private", "MockitoUtil", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "Map", "<", "ThreadTreeLocal", ",", "Object", ">", "initialValue", "(", ")", "{", "return", "new", "IdentityHashMap", "<", "ThreadTreeLocal", ",", "Object", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "T", "get", "(", ")", "{", "Map", "<", "ThreadTreeLocal", ",", "Object", ">", "map", "=", "getMap", "(", ")", ";", "if", "(", "map", ".", "containsKey", "(", "this", ")", ")", "return", "(", "T", ")", "map", ".", "get", "(", "this", ")", ";", "else", "return", "setInitialValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "set", "(", "T", "value", ")", "{", "getMap", "(", ")", ".", "put", "(", "this", ",", "value", ")", ";", "}", "</s>"]
["<s>", "protected", "T", "initialValue", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "private", "T", "setInitialValue", "(", ")", "{", "T", "value", "=", "initialValue", "(", ")", ";", "getMap", "(", ")", ".", "put", "(", "this", ",", "value", ")", ";", "return", "value", ";", "}", "</s>"]
["<s>", "private", "Map", "<", "ThreadTreeLocal", ",", "Object", ">", "getMap", "(", ")", "{", "return", "threadTreeLocalMap", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "answer", "(", "InvocationOnMock", "invocation", ")", "throws", "Throwable", "{", "Object", "[", "]", "arguments", "=", "invocation", ".", "getArguments", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "arguments", ".", "length", ";", "i", "+", "+", ")", "{", "Object", "from", "=", "arguments", "[", "i", "]", ";", "if", "(", "from", "instanceof", "Cloneable", ")", "{", "try", "{", "Method", "cloneMethod", "=", "from", ".", "getClass", "(", ")", ".", "getMethod", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Object", "newInstance", "=", "cloneMethod", ".", "invoke", "(", "from", ")", ";", "arguments", "[", "i", "]", "=", "newInstance", ";", "}", "catch", "(", "Exception", "e", ")", "{", "}", "}", "}", "return", "new", "ReturnsEmptyValues", "(", ")", ".", "answer", "(", "invocation", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", ">", "Matcher", "<", "Collection", "<", "E", ">", ">", "empty", "(", ")", "{", "return", "IsEmptyCollection", ".", "empty", "(", ")", ";", "}", "</s>"]
["<s>", "private", "CollectionMatchers", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "java", ".", "util", ".", "logging", ".", "Logger", ".", "getLogger", "(", "\"", "\"", ")", ".", "setLevel", "(", "java", ".", "util", ".", "logging", ".", "Level", ".", "FINER", ")", ";", "System", ".", "setProperty", "(", "Global", ".", "CUSTOM_LOG_FACTORY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "Logger", "log", "=", "LoggerFactory", ".", "getLogger", "(", "JGroupsTKB", ".", "class", ")", ";", "Cluster", "cluster", "=", "mock", "(", "Cluster", ".", "class", ")", ";", "JChannel", "jchannel", "=", "new", "JChannel", "(", ")", ";", "jchannel", ".", "setDiscardOwnMessages", "(", "true", ")", ";", "ControlChannel", "control", "=", "new", "ControlChannel", "(", "jchannel", ")", ";", "control", ".", "setDiscardOwnMessages", "(", "true", ")", ";", "jchannel", ".", "setReceiver", "(", "new", "ReceiverAdapter", "(", ")", "{", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "msg", ",", "msg", ".", "getHeaders", "(", ")", ",", "msg", ".", "getObject", "(", ")", "}", ")", ";", "}", "}", ")", ";", "control", ".", "setReceiver", "(", "new", "ReceiverAdapter", "(", ")", "{", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "msg", ",", "msg", ".", "getHeaders", "(", ")", ",", "msg", ".", "getObject", "(", ")", "}", ")", ";", "}", "@", "Override", "public", "void", "viewAccepted", "(", "View", "newView", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "newView", ")", ";", "synchronized", "(", "lock", ")", "{", "clustered", "=", "newView", ".", "size", "(", ")", ">", "1", ";", "lock", ".", "notifyAll", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "getState", "(", "OutputStream", "output", ")", "throws", "Exception", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "@", "Override", "public", "void", "setState", "(", "InputStream", "input", ")", "throws", "Exception", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT:...>", "\"", ")", ";", "jchannel", ".", "connect", "(", "\"", "<STR_LIT>", "\"", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "synchronized", "(", "lock", ")", "{", "while", "(", "!", "clustered", ")", "lock", ".", "wait", "(", ")", ";", "}", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "jchannel", ".", "send", "(", "message", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "control", ".", "send", "(", "message", "(", "\"", "<STR_LIT:1>", "\"", ")", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "jchannel", ".", "send", "(", "message", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "control", ".", "send", "(", "message", "(", "\"", "<STR_LIT:2>", "\"", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "msg", ",", "msg", ".", "getHeaders", "(", ")", ",", "msg", ".", "getObject", "(", ")", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "msg", ",", "msg", ".", "getHeaders", "(", ")", ",", "msg", ".", "getObject", "(", ")", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "viewAccepted", "(", "View", "newView", ")", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "newView", ")", ";", "synchronized", "(", "lock", ")", "{", "clustered", "=", "newView", ".", "size", "(", ")", ">", "1", ";", "lock", ".", "notifyAll", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getState", "(", "OutputStream", "output", ")", "throws", "Exception", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setState", "(", "InputStream", "input", ")", "throws", "Exception", "{", "log", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Message", "message", "(", "Object", "payload", ")", "{", "Message", "msg", "=", "new", "Message", "(", "null", ",", "payload", ")", ";", "msg", ".", "setFlag", "(", "Message", ".", "DONT_BUNDLE", ")", ";", "return", "msg", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "java", ".", "util", ".", "logging", ".", "Logger", ".", "getLogger", "(", "\"", "\"", ")", ".", "setLevel", "(", "java", ".", "util", ".", "logging", ".", "Level", ".", "FINER", ")", ";", "System", ".", "setProperty", "(", "Global", ".", "CUSTOM_LOG_FACTORY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "final", "JChannel", "jchannel", "=", "new", "JChannel", "(", "new", "File", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "jchannel", ".", "setReceiver", "(", "new", "ReceiverAdapter", "(", ")", "{", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "}", "}", ")", ";", "ControlChannel", "control", "=", "new", "ControlChannel", "(", "jchannel", ")", ";", "ReplicatedTree", ".", "ConflictResolver", "conflictResolver", "=", "new", "ReplicatedTree", ".", "ConflictResolver", "(", ")", "{", "@", "Override", "public", "byte", "[", "]", "resolve", "(", "String", "node", ",", "byte", "[", "]", "current", ",", "byte", "[", "]", "other", ",", "Address", "otherAddress", ")", "{", "final", "String", "currentString", "=", "current", "!", "=", "null", "?", "deserialize", "(", "current", ")", ":", "null", ";", "final", "String", "otherString", "=", "other", "!", "=", "null", "?", "deserialize", "(", "other", ")", ":", "null", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "currentString", "+", "\"", "<STR_LIT>", "\"", "+", "otherString", "+", "\"", "<STR_LIT>", "\"", "+", "otherAddress", ")", ";", "final", "boolean", "currentWins", "=", "jchannel", ".", "getAddress", "(", ")", ".", "compareTo", "(", "otherAddress", ")", "<", "=", "0", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "(", "currentWins", "?", "\"", "<STR_LIT>", "\"", "+", "jchannel", ".", "getAddress", "(", ")", "+", "\"", "\"", "+", "currentString", ":", "\"", "<STR_LIT>", "\"", "+", "otherAddress", "+", "\"", "\"", "+", "otherString", ")", ")", ";", "return", "currentWins", "?", "current", ":", "other", ";", "}", "}", ";", "ReplicatedTree", "tree", "=", "new", "ReplicatedTree", "(", "control", ",", "conflictResolver", ",", "<NUM_LIT>", ")", ";", "jchannel", ".", "connect", "(", "\"", "<STR_LIT>", "\"", ",", "null", ",", "<NUM_LIT>", ")", ";", "final", "Address", "myAddress", "=", "jchannel", ".", "getAddress", "(", ")", ";", "DistributedTreeTKB", "tkb", "=", "new", "DistributedTreeTKB", "(", "new", "DistributedTreeAdapter", "(", "tree", ")", ",", "myAddress", ".", "toString", "(", ")", ")", ";", "tkb", ".", "run", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "resolve", "(", "String", "node", ",", "byte", "[", "]", "current", ",", "byte", "[", "]", "other", ",", "Address", "otherAddress", ")", "{", "final", "String", "currentString", "=", "current", "!", "=", "null", "?", "deserialize", "(", "current", ")", ":", "null", ";", "final", "String", "otherString", "=", "other", "!", "=", "null", "?", "deserialize", "(", "other", ")", ":", "null", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "currentString", "+", "\"", "<STR_LIT>", "\"", "+", "otherString", "+", "\"", "<STR_LIT>", "\"", "+", "otherAddress", ")", ";", "final", "boolean", "currentWins", "=", "jchannel", ".", "getAddress", "(", ")", ".", "compareTo", "(", "otherAddress", ")", "<", "=", "0", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "(", "currentWins", "?", "\"", "<STR_LIT>", "\"", "+", "jchannel", ".", "getAddress", "(", ")", "+", "\"", "\"", "+", "currentString", ":", "\"", "<STR_LIT>", "\"", "+", "otherAddress", "+", "\"", "\"", "+", "otherString", ")", ")", ";", "return", "currentWins", "?", "current", ":", "other", ";", "}", "</s>"]
["<s>", "static", "byte", "[", "]", "serialize", "(", "String", "object", ")", "{", "return", "object", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "static", "String", "deserialize", "(", "byte", "[", "]", "array", ")", "{", "return", "new", "String", "(", "array", ",", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "java", ".", "util", ".", "logging", ".", "Logger", ".", "getLogger", "(", "\"", "\"", ")", ".", "setLevel", "(", "java", ".", "util", ".", "logging", ".", "Level", ".", "FINER", ")", ";", "System", ".", "setProperty", "(", "Global", ".", "CUSTOM_LOG_FACTORY", ",", "\"", "<STR_LIT>", "\"", ")", ";", "Random", "random", "=", "new", "Random", "(", ")", ";", "final", "JChannel", "jchannel", "=", "new", "JChannel", "(", "new", "File", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "jchannel", ".", "setReceiver", "(", "new", "ReceiverAdapter", "(", ")", "{", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "}", "}", ")", ";", "ControlChannel", "control", "=", "new", "ControlChannel", "(", "jchannel", ")", ";", "ReplicatedTree", ".", "ConflictResolver", "conflictResolver", "=", "new", "ReplicatedTree", ".", "ConflictResolver", "(", ")", "{", "@", "Override", "public", "byte", "[", "]", "resolve", "(", "String", "node", ",", "byte", "[", "]", "current", ",", "byte", "[", "]", "other", ",", "Address", "otherAddress", ")", "{", "final", "String", "currentString", "=", "current", "!", "=", "null", "?", "deserialize", "(", "current", ")", ":", "null", ";", "final", "String", "otherString", "=", "other", "!", "=", "null", "?", "deserialize", "(", "other", ")", ":", "null", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "currentString", "+", "\"", "<STR_LIT>", "\"", "+", "otherString", "+", "\"", "<STR_LIT>", "\"", "+", "otherAddress", ")", ";", "final", "boolean", "currentWins", "=", "jchannel", ".", "getAddress", "(", ")", ".", "compareTo", "(", "otherAddress", ")", "<", "=", "0", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "(", "currentWins", "?", "\"", "<STR_LIT>", "\"", "+", "jchannel", ".", "getAddress", "(", ")", "+", "\"", "\"", "+", "currentString", ":", "\"", "<STR_LIT>", "\"", "+", "otherAddress", "+", "\"", "\"", "+", "otherString", ")", ")", ";", "return", "currentWins", "?", "current", ":", "other", ";", "}", "}", ";", "ReplicatedTree", "tree", "=", "new", "ReplicatedTree", "(", "control", ",", "conflictResolver", ",", "<NUM_LIT>", ")", ";", "jchannel", ".", "connect", "(", "\"", "<STR_LIT>", "\"", ",", "null", ",", "<NUM_LIT>", ")", ";", "final", "Address", "myAddress", "=", "jchannel", ".", "getAddress", "(", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "null", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "null", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "out", ".", "println", "(", "tree", ")", ";", "put", "(", "tree", ",", "\"", "<STR_LIT>", "\"", ",", "false", ",", "\"", "<STR_LIT>", "\"", ")", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", "+", "tree", ".", "print", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "tree", ".", "remove", "(", "\"", "<STR_LIT>", "\"", ")", ";", "tree", ".", "create", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ".", "toString", "(", ")", ",", "true", ")", ";", "tree", ".", "create", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ".", "toString", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ".", "toString", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ")", ")", ";", "tree", ".", "create", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ".", "toString", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "tree", ".", "set", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ".", "toString", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "serialize", "(", "\"", "<STR_LIT>", "\"", "+", "myAddress", ")", ")", ";", "while", "(", "true", ")", "{", "System", ".", "out", ".", "println", "(", "tree", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "resolve", "(", "String", "node", ",", "byte", "[", "]", "current", ",", "byte", "[", "]", "other", ",", "Address", "otherAddress", ")", "{", "final", "String", "currentString", "=", "current", "!", "=", "null", "?", "deserialize", "(", "current", ")", ":", "null", ";", "final", "String", "otherString", "=", "other", "!", "=", "null", "?", "deserialize", "(", "other", ")", ":", "null", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "currentString", "+", "\"", "<STR_LIT>", "\"", "+", "otherString", "+", "\"", "<STR_LIT>", "\"", "+", "otherAddress", ")", ";", "final", "boolean", "currentWins", "=", "jchannel", ".", "getAddress", "(", ")", ".", "compareTo", "(", "otherAddress", ")", "<", "=", "0", ";", "System", ".", "out", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "(", "currentWins", "?", "\"", "<STR_LIT>", "\"", "+", "jchannel", ".", "getAddress", "(", ")", "+", "\"", "\"", "+", "currentString", ":", "\"", "<STR_LIT>", "\"", "+", "otherAddress", "+", "\"", "\"", "+", "otherString", ")", ")", ";", "return", "currentWins", "?", "current", ":", "other", ";", "}", "</s>"]
["<s>", "private", "static", "void", "put", "(", "ReplicatedTree", "tree", ",", "String", "node", ",", "boolean", "ephemeral", ",", "String", "data", ")", "throws", "Exception", "{", "tree", ".", "create", "(", "node", ",", "ephemeral", ")", ";", "tree", ".", "set", "(", "node", ",", "data", "!", "=", "null", "?", "serialize", "(", "data", ")", ":", "null", ")", ";", "}", "</s>"]
["<s>", "static", "byte", "[", "]", "serialize", "(", "String", "object", ")", "{", "return", "object", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "static", "String", "deserialize", "(", "byte", "[", "]", "array", ")", "{", "return", "new", "String", "(", "array", ",", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Matcher", "<", "MessagePacket", ">", "packetThatContains", "(", "Message", "m", ")", "{", "return", "new", "MessagePacketContains", "(", "m", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Matcher", "<", "MessagePacket", ">", "equalTo", "(", "MessagePacket", "p", ")", "{", "return", "new", "MessagePacketEqualTo", "(", "p", ")", ";", "}", "</s>"]
["<s>", "private", "MessagePacketMatchers", "(", ")", "{", "}", "</s>"]
["<s>", "public", "MessagePacketEqualTo", "(", "MessagePacket", "packet", ")", "{", "this", ".", "packet", "=", "packet", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matchesSafely", "(", "MessagePacket", "item", ")", "{", "if", "(", "packet", ".", "getMessages", "(", ")", ".", "size", "(", ")", "!", "=", "item", ".", "getMessages", "(", ")", ".", "size", "(", ")", ")", "return", "false", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "packet", ".", "getMessages", "(", ")", ".", "size", "(", ")", ";", "i", "+", "+", ")", "{", "if", "(", "!", "new", "MessageEqualTo", "(", "packet", ".", "getMessages", "(", ")", ".", "get", "(", "i", ")", ")", ".", "matches", "(", "item", ".", "getMessages", "(", ")", ".", "get", "(", "i", ")", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "packet", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "MessagePacketContains", "(", "Message", "message", ")", "{", "this", ".", "message", "=", "message", ";", "messageMatcher", "=", "new", "MessageEqualTo", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "matchesSafely", "(", "MessagePacket", "item", ")", "{", "for", "(", "Message", "m", ":", "item", ".", "getMessages", "(", ")", ")", "{", "if", "(", "messageMatcher", ".", "matches", "(", "m", ")", ")", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "describeTo", "(", "Description", "description", ")", "{", "description", ".", "appendText", "(", "message", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "UDPCommTest", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "throws", "Exception", "{", "cluster", "=", "mock", "(", "Cluster", ".", "class", ")", ";", "when", "(", "cluster", ".", "isMaster", "(", ")", ")", ".", "thenReturn", "(", "true", ")", ";", "when", "(", "cluster", ".", "getMyNodeId", "(", ")", ")", ".", "thenReturn", "(", "sh", "(", "1", ")", ")", ";", "when", "(", "cluster", ".", "getNodes", "(", ")", ")", ".", "thenReturn", "(", "new", "HashSet", "<", "Short", ">", "(", "Shorts", ".", "asList", "(", "sh", "(", "0", ",", "<NUM_LIT:2>", ",", "<NUM_LIT:3>", ",", "<NUM_LIT:4>", ")", ")", ")", ")", ";", "when", "(", "cluster", ".", "getMasters", "(", ")", ")", ".", "thenReturn", "(", "masters", ")", ";", "addNodeInfo", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "node2Address", ")", ";", "addNodeInfo", "(", "sh", "(", "<NUM_LIT:3>", ")", ",", "node3Address", ")", ";", "addNodeInfo", "(", "sh", "(", "<NUM_LIT:4>", ")", ",", "node4Address", ")", ";", "serverComm", "=", "mock", "(", "ServerComm", ".", "class", ")", ";", "channel", "=", "mock", "(", "DatagramChannel", ".", "class", ",", "new", "ClonesArguments", "(", ")", ")", ";", "receiver", "=", "mock", "(", "MessageReceiver", ".", "class", ")", ";", "comm", "=", "new", "UDPComm", "(", "\"", "<STR_LIT>", "\"", ",", "cluster", ",", "serverComm", ",", "PORT", ")", ";", "comm", ".", "setChannel", "(", "channel", ")", ";", "comm", ".", "setReceiver", "(", "receiver", ")", ";", "comm", ".", "setSendToServerInsteadOfMulticast", "(", "false", ")", ";", "comm", ".", "setMinimumNodesToMulticast", "(", "<NUM_LIT:3>", ")", ";", "comm", ".", "setMulticastGroup", "(", "GROUP", ")", ";", "comm", ".", "setResendPeriodMillisecs", "(", "<NUM_LIT:20>", ")", ";", "comm", ".", "setTimeout", "(", "<NUM_LIT>", ")", ";", "comm", ".", "setMinDelayMicrosecs", "(", "<NUM_LIT>", ")", ";", "comm", ".", "setMaxDelayMicrosecs", "(", "<NUM_LIT>", ")", ";", "comm", ".", "setExponentialBackoff", "(", "false", ")", ";", "comm", ".", "setJitter", "(", "false", ")", ";", "for", "(", "short", "node", ":", "sh", "(", "0", ",", "<NUM_LIT:2>", ",", "<NUM_LIT:3>", ",", "<NUM_LIT:4>", ")", ")", "comm", ".", "nodeAdded", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSimpleSendMessage", "(", ")", "throws", "Exception", "{", "final", "Message", "m", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "<NUM_LIT>", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "atLeastOnce", "(", ")", ")", ".", "write", "(", "argThat", "(", "is", "(", "packetThatContains", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSeveralMessagesThenAggregateInPacketUntilMaxDelay", "(", ")", "throws", "Exception", "{", "final", "Message", "m1", "=", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "final", "Message", "m2", "=", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "final", "Message", "m3", "=", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "final", "Message", "m4", "=", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "comm", ".", "send", "(", "m1", ")", ";", "comm", ".", "send", "(", "m2", ")", ";", "comm", ".", "send", "(", "m3", ")", ";", "sleep", "(", "<NUM_LIT:10>", ")", ";", "comm", ".", "send", "(", "m4", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "never", "(", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m1", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "never", "(", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m1", ",", "m2", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeastOnce", "(", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m1", ",", "m2", ",", "m3", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeastOnce", "(", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m1", ",", "m2", ",", "m3", ",", "m4", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSendRequestThenResendUntilResponse", "(", ")", "throws", "Exception", "{", "final", "Message", "m", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT:100>", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNoResponseThenTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "GET", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenNoResponseForINVThenNoTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ",", "never", "(", ")", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenReceiveResponseThenStopResendingAndNoTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "INVACK", "(", "m", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verifyNoMoreInteractions", "(", "channel", ")", ";", "verify", "(", "receiver", ",", "never", "(", ")", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenSendRespondThenSendOnlyOnce", "(", ")", "throws", "Exception", "{", "final", "Message", "m", "=", "Message", ".", "INVACK", "(", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ")", ".", "setMessageId", "(", "<NUM_LIT>", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT:100>", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "times", "(", "1", ")", ")", ".", "write", "(", "argThat", "(", "is", "(", "packetThatContains", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenRequestAgainAndHasResponseThenResendResponse", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "<NUM_LIT:2>", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ".", "setMessageId", "(", "<NUM_LIT>", ")", ".", "setIncoming", "(", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "m", ")", ")", ";", "comm", ".", "send", "(", "Message", ".", "INVACK", "(", "m", ")", ")", ";", "sleep", "(", "<NUM_LIT:100>", ")", ";", "verify", "(", "channel", ",", "times", "(", "1", ")", ")", ".", "write", "(", "argThat", "(", "is", "(", "packetThatContains", "(", "Message", ".", "INVACK", "(", "m", ")", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "m", ")", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "times", "(", "<NUM_LIT:2>", ")", ")", ".", "write", "(", "argThat", "(", "is", "(", "packetThatContains", "(", "Message", ".", "INVACK", "(", "m", ")", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testSimpleBroadcast", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "atLeastOnce", "(", ")", ")", ".", "write", "(", "argThat", "(", "is", "(", "packetThatContains", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenBroadcastRequestThenResendUntilResponse", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenBroadcastNoReplyThenTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenBroadcastAndReceiveReplyThenStopResendingAndNoTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "INVACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verifyNoMoreInteractions", "(", "channel", ")", ";", "verify", "(", "receiver", ",", "never", "(", ")", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenBroadcastAndReceiveAcksThenStopResendingAndNotFound", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:2>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:4>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "NOT_FOUND", "(", "m", ")", ")", ")", ")", ";", "verify", "(", "receiver", ",", "never", "(", ")", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenUnicastBroadcastThenResendUnicastUntilResponse", "(", ")", "throws", "Exception", "{", "comm", ".", "setMinimumNodesToMulticast", "(", "<NUM_LIT:10>", ")", ";", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "never", "(", ")", ")", ".", "write", "(", "any", "(", "MessagePacket", ".", "class", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node3Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node4Address", ")", ")", ";", "verifyNoMoreInteractions", "(", "channel", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenBroadcastRequestAndSomeAcksThenResendUnicastUntilResponse", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node4Address", ")", ")", ";", "verifyNoMoreInteractions", "(", "channel", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenUnicastBroadcastAndNoReplyThenTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "GET", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT:100>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node4Address", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "verifyNoMoreInteractions", "(", "receiver", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenUnicastBroadcastAndReceiveReplyThenNoTimeout", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "sleep", "(", "<NUM_LIT:100>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "INVACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:4>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "1", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "1", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node4Address", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "INVACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:4>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ")", ";", "verify", "(", "receiver", ",", "never", "(", ")", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "whenUnicastBroadcastAndReceiveAcksThenNotFound", "(", ")", "throws", "Exception", "{", "final", "LineMessage", "m", "=", "Message", ".", "INV", "(", "sh", "(", "-", "1", ")", ",", "id", "(", "<NUM_LIT>", ")", ",", "sh", "(", "<NUM_LIT:10>", ")", ")", ";", "comm", ".", "send", "(", "m", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:3>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:3>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "GROUP", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:2>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "comm", ".", "messageReceived", "(", "packet", "(", "Message", ".", "ACK", "(", "m", ")", ".", "setNode", "(", "sh", "(", "<NUM_LIT:4>", ")", ")", ".", "setIncoming", "(", ")", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:2>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node2Address", ")", ")", ";", "verify", "(", "channel", ",", "atLeast", "(", "<NUM_LIT:2>", ")", ")", ".", "write", "(", "argThat", "(", "equalTo", "(", "packet", "(", "m", ")", ")", ")", ",", "eq", "(", "node4Address", ")", ")", ";", "sleep", "(", "<NUM_LIT>", ")", ";", "await", "(", ")", ";", "verify", "(", "receiver", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "NOT_FOUND", "(", "m", ")", ")", ")", ")", ";", "verify", "(", "receiver", ",", "never", "(", ")", ")", ".", "receive", "(", "argThat", "(", "equalTo", "(", "Message", ".", "TIMEOUT", "(", "m", ")", ")", ")", ")", ";", "}", "</s>"]
["<s>", "static", "NodeChangeListener", "getNodeChangeListener", "(", "Cluster", "mock", ")", "{", "try", "{", "return", "(", "NodeChangeListener", ")", "capture", "(", "mock", ",", "\"", "<STR_LIT>", "\"", ",", "arg", "(", "NodeChangeListener", ".", "class", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "return", "null", ";", "}", "}", "</s>"]
["<s>", "static", "short", "sh", "(", "int", "x", ")", "{", "return", "(", "short", ")", "x", ";", "}", "</s>"]
["<s>", "static", "short", "[", "]", "sh", "(", "int", ".", ".", ".", "args", ")", "{", "final", "short", "[", "]", "array", "=", "new", "short", "[", "args", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "array", "[", "i", "]", "=", "(", "short", ")", "args", "[", "i", "]", ";", "return", "array", ";", "}", "</s>"]
["<s>", "private", "long", "id", "(", "long", "id", ")", "{", "return", "MAX_RESERVED_REF_ID", "+", "id", ";", "}", "</s>"]
["<s>", "void", "await", "(", ")", "{", "try", "{", "ExecutorService", "executor", "=", "comm", ".", "getExecutor", "(", ")", ";", "executor", ".", "shutdown", "(", ")", ";", "executor", ".", "awaitTermination", "(", "Long", ".", "MAX_VALUE", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "static", "void", "sleep", "(", "int", "millis", ")", "{", "try", "{", "Thread", ".", "sleep", "(", "millis", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "System", ".", "err", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "private", "static", "MessagePacket", "packet", "(", "Message", ".", ".", ".", "ms", ")", "{", "MessagePacket", "packet", "=", "new", "MessagePacket", "(", ")", ";", "for", "(", "Message", "m", ":", "ms", ")", "packet", ".", "addMessage", "(", "m", ")", ";", "return", "packet", ";", "}", "</s>"]
["<s>", "private", "void", "addNodeInfo", "(", "short", "node", ",", "InetSocketAddress", "address", ")", "{", "NodeInfo", "ni", "=", "mock", "(", "NodeInfo", ".", "class", ")", ";", "when", "(", "ni", ".", "getNodeId", "(", ")", ")", ".", "thenReturn", "(", "node", ")", ";", "when", "(", "ni", ".", "get", "(", "IpConstants", ".", "IP_ADDRESS", ")", ")", ".", "thenReturn", "(", "address", ".", "getAddress", "(", ")", ")", ";", "when", "(", "ni", ".", "get", "(", "IpConstants", ".", "IP_COMM_PORT", ")", ")", ".", "thenReturn", "(", "address", ".", "getPort", "(", ")", ")", ";", "when", "(", "cluster", ".", "getMaster", "(", "node", ")", ")", ".", "thenReturn", "(", "ni", ")", ";", "masters", ".", "add", "(", "ni", ")", ";", "}", "</s>"]
["<s>", "private", "MessagePacket", "captureMessagePacket", "(", ")", "throws", "Exception", "{", "ArgumentCaptor", "<", "MessagePacket", ">", "captor", "=", "(", "ArgumentCaptor", ")", "ArgumentCaptor", ".", "forClass", "(", "MessagePacket", ".", "class", ")", ";", "verify", "(", "channel", ",", "times", "(", "1", ")", ")", ".", "write", "(", "captor", ".", "capture", "(", ")", ",", "any", "(", "SocketAddress", ".", "class", ")", ")", ";", "return", "captor", ".", "getValue", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "final", "CuratorFramework", "client", "=", "CuratorFrameworkFactory", ".", "newClient", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT>", ",", "<NUM_LIT:1000>", ",", "new", "ExponentialBackoffRetry", "(", "<NUM_LIT:20>", ",", "<NUM_LIT:20>", ")", ")", ";", "client", ".", "start", "(", ")", ";", "try", "{", "Random", "rand", "=", "new", "Random", "(", ")", ";", "final", "String", "me", "=", "\"", "<STR_LIT:->", "\"", "+", "Long", ".", "toHexString", "(", "rand", ".", "nextLong", "(", ")", ")", ";", "final", "ZooKeeperDistributedTree", "tree", "=", "new", "ZooKeeperDistributedTree", "(", "client", ")", ";", "DistributedTreeTKB", "tkb", "=", "new", "DistributedTreeTKB", "(", "tree", ",", "me", ")", ";", "tkb", ".", "run", "(", ")", ";", "}", "finally", "{", "client", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "LinkedHashMap2Test", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Before", "public", "void", "setUp", "(", ")", "{", "map", "=", "new", "LinkedHashMap2", "<", "String", ",", "Integer", ">", "(", ")", ";", "map", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "1", ")", ";", "map", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:2>", ")", ";", "map", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "<NUM_LIT:3>", ")", ";", "}", "</s>"]
["<s>", "@", "After", "public", "void", "tearDown", "(", ")", "{", "map", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFirstKey", "(", ")", "{", "assertThat", "(", "map", ".", "firstKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "new", "LinkedHashMap2", "<", "String", ",", "Integer", ">", "(", ")", ".", "firstKey", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testFirstEntry", "(", ")", "{", "assertThat", "(", "map", ".", "firstEntry", "(", ")", ".", "getKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "firstEntry", "(", ")", ".", "getValue", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "new", "LinkedHashMap2", "<", "String", ",", "Integer", ">", "(", ")", ".", "firstEntry", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLastKey", "(", ")", "{", "assertThat", "(", "map", ".", "lastKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "new", "LinkedHashMap2", "<", "String", ",", "Integer", ">", "(", ")", ".", "lastKey", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testLastEntry", "(", ")", "{", "assertThat", "(", "map", ".", "lastEntry", "(", ")", ".", "getKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "lastEntry", "(", ")", ".", "getValue", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "new", "LinkedHashMap2", "<", "String", ",", "Integer", ">", "(", ")", ".", "lastEntry", "(", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNextKey", "(", ")", "{", "assertThat", "(", "map", ".", "nextKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "nextKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "nextKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertThat", "(", "map", ".", "nextKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testNextEntry", "(", ")", "{", "assertThat", "(", "map", ".", "nextEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "nextEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getValue", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "map", ".", "nextEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "nextEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getValue", "(", ")", ",", "is", "(", "<NUM_LIT:3>", ")", ")", ";", "assertThat", "(", "map", ".", "nextEntry", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertThat", "(", "map", ".", "nextEntry", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPreviousKey", "(", ")", "{", "assertThat", "(", "map", ".", "previousKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "previousKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "previousKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertThat", "(", "map", ".", "previousKey", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Test", "public", "void", "testPreviousEntry", "(", ")", "{", "assertThat", "(", "map", ".", "previousEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "previousEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getValue", "(", ")", ",", "is", "(", "1", ")", ")", ";", "assertThat", "(", "map", ".", "previousEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getKey", "(", ")", ",", "is", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "assertThat", "(", "map", ".", "previousEntry", "(", "\"", "<STR_LIT>", "\"", ")", ".", "getValue", "(", ")", ",", "is", "(", "<NUM_LIT:2>", ")", ")", ";", "assertThat", "(", "map", ".", "previousEntry", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "assertThat", "(", "map", ".", "previousEntry", "(", "\"", "<STR_LIT>", "\"", ")", ",", "is", "(", "nullValue", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "abstract", "Iterator", "<", "Long", ">", "iterator", "(", ")", ";", "</s>"]
["<s>", "public", "abstract", "boolean", "contains", "(", "long", "id", ")", ";", "</s>"]
["<s>", "void", "messageReceived", "(", "short", "fromNode", ",", "byte", "[", "]", "message", ")", ";", "</s>"]
["<s>", "short", "getMyNodeId", "(", ")", ";", "</s>"]
["<s>", "NodeInfo", "getMyNodeInfo", "(", ")", ";", "</s>"]
["<s>", "NodeInfo", "getNodeInfoByName", "(", "String", "nodeName", ")", ";", "</s>"]
["<s>", "Set", "<", "NodeInfo", ">", "getNodesByProperty", "(", "String", "propertyName", ",", "Object", "value", ")", ";", "</s>"]
["<s>", "boolean", "hasServer", "(", ")", ";", "</s>"]
["<s>", "boolean", "isOnline", "(", ")", ";", "</s>"]
["<s>", "boolean", "isMaster", "(", ")", ";", "</s>"]
["<s>", "Set", "<", "Short", ">", "getNodes", "(", ")", ";", "</s>"]
["<s>", "Collection", "<", "NodeInfo", ">", "getMasters", "(", ")", ";", "</s>"]
["<s>", "NodeInfo", "getMyMaster", "(", ")", ";", "</s>"]
["<s>", "List", "<", "NodeInfo", ">", "getMySlaves", "(", ")", ";", "</s>"]
["<s>", "NodeInfo", "getMaster", "(", "short", "node", ")", ";", "</s>"]
["<s>", "boolean", "isMaster", "(", "NodeInfo", "node", ")", ";", "</s>"]
["<s>", "DistributedTree", "getDistributedTree", "(", ")", ";", "</s>"]
["<s>", "void", "addLifecycleListener", "(", "LifecycleListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeLifecycleListener", "(", "LifecycleListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addSlaveConfigurationListener", "(", "SlaveConfigurationListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeSlaveConfigurationListener", "(", "SlaveConfigurationListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addNodeChangeListener", "(", "NodeChangeListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeNodeChangeListener", "(", "NodeChangeListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addMasterNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeMasterNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addSlaveNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeSlaveNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addNodeProperty", "(", "String", "property", ",", "boolean", "requiredForPeer", ",", "boolean", "requiredForServer", ",", "ReaderWriter", "<", "?", ">", "readerWriter", ")", ";", "</s>"]
["<s>", "void", "setNodeProperty", "(", "String", "property", ",", "Object", "value", ")", ";", "</s>"]
["<s>", "Object", "getUnderlyingResource", "(", ")", ";", "</s>"]
["<s>", "void", "goOffline", "(", ")", ";", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "null", ",", "(", "Object", ")", "null", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", "String", "configFile", ",", "String", "propertiesFile", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "configFile", ",", "(", "Object", ")", "propertiesFile", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Grid", "getInstance", "(", "String", "configFile", ",", "Properties", "properties", ")", "throws", "InterruptedException", "{", "return", "getInstance", "(", "configFile", ",", "(", "Object", ")", "properties", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Grid", "getInstance", "(", "String", "configFile", ",", "Object", "properties", ")", "throws", "InterruptedException", "{", "synchronized", "(", "lock", ")", "{", "Grid", "_instance", "=", "instance", ";", "if", "(", "_instance", "=", "=", "null", ")", "{", "_instance", "=", "new", "Grid", "(", "configFile", ",", "properties", ")", ";", "if", "(", "_instance", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "configFile", "+", "\"", "<STR_LIT:!>", "\"", ")", ";", "instance", "=", "_instance", ";", "}", "return", "_instance", ";", "}", "}", "</s>"]
["<s>", "private", "Grid", "(", "String", "configFile", ",", "Object", "properties", ")", "throws", "InterruptedException", "{", "this", ".", "context", "=", "SpringContainerHelper", ".", "createContext", "(", "\"", "<STR_LIT>", "\"", ",", "configFile", "!", "=", "null", "?", "new", "FileSystemResource", "(", "configFile", ")", ":", "new", "ClassPathResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "properties", "instanceof", "String", "?", "new", "FileSystemResource", "(", "(", "String", ")", "properties", ")", ":", "properties", ",", "new", "BeanFactoryPostProcessor", "(", ")", "{", "@", "Override", "public", "void", "postProcessBeanFactory", "(", "ConfigurableListableBeanFactory", "beanFactory1", ")", "throws", "BeansException", "{", "final", "DefaultListableBeanFactory", "beanFactory", "=", "(", "(", "DefaultListableBeanFactory", ")", "beanFactory1", ")", ";", "}", "}", ")", ";", "this", ".", "cluster", "=", "context", ".", "getBean", "(", "\"", "<STR_LIT>", "\"", ",", "Cluster", ".", "class", ")", ";", "this", ".", "clusterMonitor", "=", "new", "ClusterMonitor", "(", "cluster", ")", ";", "this", ".", "backup", "=", "context", ".", "getBean", "(", "\"", "<STR_LIT>", "\"", ",", "Backup", ".", "class", ")", ";", "this", ".", "cache", "=", "context", ".", "getBean", "(", "\"", "<STR_LIT>", "\"", ",", "Cache", ".", "class", ")", ";", "this", ".", "store", "=", "new", "StoreImpl", "(", "cache", ")", ";", "this", ".", "messenger", "=", "context", ".", "getBean", "(", "\"", "<STR_LIT>", "\"", ",", "Messenger", ".", "class", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postProcessBeanFactory", "(", "ConfigurableListableBeanFactory", "beanFactory1", ")", "throws", "BeansException", "{", "final", "DefaultListableBeanFactory", "beanFactory", "=", "(", "(", "DefaultListableBeanFactory", ")", "beanFactory1", ")", ";", "}", "</s>"]
["<s>", "public", "Store", "store", "(", ")", "{", "return", "store", ";", "}", "</s>"]
["<s>", "public", "Messenger", "messenger", "(", ")", "{", "return", "messenger", ";", "}", "</s>"]
["<s>", "public", "Cluster", "cluster", "(", ")", "{", "return", "cluster", ";", "}", "</s>"]
["<s>", "public", "void", "goOnline", "(", ")", "throws", "InterruptedException", "{", "(", "(", "Service", ")", "backup", ")", ".", "awaitAvailable", "(", ")", ";", "(", "(", "AbstractCluster", ")", "cluster", ")", ".", "goOnline", "(", ")", ";", "cache", ".", "awaitAvailable", "(", ")", ";", "}", "</s>"]
["<s>", "public", "RefNotFoundException", "(", "long", "ref", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", "+", "Long", ".", "toHexString", "(", "ref", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "void", "addMessageListener", "(", "long", "topic", ",", "MessageListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addMessageListener", "(", "String", "topic", ",", "MessageListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeMessageListener", "(", "long", "topic", ",", "MessageListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeMessageListener", "(", "String", "topic", ",", "MessageListener", "listener", ")", ";", "</s>"]
["<s>", "void", "send", "(", "short", "node", ",", "String", "topic", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "send", "(", "short", "node", ",", "long", "topic", ",", "Streamable", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "send", "(", "short", "node", ",", "String", "topic", ",", "Streamable", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "sendToNode", "(", "short", "node", ",", "long", "topic", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "sendToOwnerOf", "(", "long", "ref", ",", "long", "topic", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "sendToOwnerOf", "(", "long", "ref", ",", "String", "topic", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "sendToOwnerOf", "(", "long", "ref", ",", "long", "topic", ",", "Streamable", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "sendToOwnerOf", "(", "long", "ref", ",", "String", "topic", ",", "Streamable", "data", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "public", "TimeoutException", "(", "Throwable", "cause", ")", "{", "super", "(", "cause", ")", ";", "}", "</s>"]
["<s>", "public", "TimeoutException", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "void", "start", "(", "String", "configFile", ")", "{", "start", "(", "configFile", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "start", "(", "String", "configFile", ",", "String", "propertiesFile", ")", "{", "final", "ApplicationContext", "context", "=", "SpringContainerHelper", ".", "createContext", "(", "\"", "<STR_LIT>", "\"", ",", "configFile", "!", "=", "null", "?", "new", "FileSystemResource", "(", "configFile", ")", ":", "new", "ClassPathResource", "(", "\"", "<STR_LIT>", "\"", ")", ",", "propertiesFile", "!", "=", "null", "?", "new", "FileSystemResource", "(", "propertiesFile", ")", ":", "null", ",", "null", ")", ";", "MainMemory", "memory", "=", "context", ".", "getBean", "(", "\"", "<STR_LIT>", "\"", ",", "MainMemory", ".", "class", ")", ";", "(", "(", "AbstractCluster", ")", "memory", ".", "getCluster", "(", ")", ")", ".", "goOnline", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "main", "(", "String", "[", "]", "args", ")", "throws", "Exception", "{", "final", "String", "configFile", "=", "args", ".", "length", ">", "0", "?", "args", "[", "0", "]", ":", "null", ";", "final", "String", "propertiesFile", "=", "args", ".", "length", ">", "1", "?", "args", "[", "1", "]", ":", "null", ";", "start", "(", "configFile", ",", "propertiesFile", ")", ";", "Thread", ".", "sleep", "(", "Long", ".", "MAX_VALUE", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isLessThan", "(", "ItemState", "other", ")", "{", "return", "compareTo", "(", "other", ")", "<", "0", ";", "}", "</s>"]
["<s>", "int", "getMaxItemSize", "(", ")", ";", "</s>"]
["<s>", "StoreTransaction", "beginTransaction", "(", ")", ";", "</s>"]
["<s>", "void", "commit", "(", "StoreTransaction", "txn", ")", "throws", "InterruptedException", ";", "</s>"]
["<s>", "void", "abort", "(", "StoreTransaction", "txn", ")", "throws", "InterruptedException", ";", "</s>"]
["<s>", "void", "rollback", "(", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "void", "release", "(", "long", "id", ")", ";", "</s>"]
["<s>", "long", "getRoot", "(", "String", "rootName", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "boolean", "isRootCreated", "(", "long", "rootId", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "void", "setListener", "(", "long", "id", ",", "CacheListener", "listener", ")", ";", "</s>"]
["<s>", "long", "alloc", "(", "int", "count", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "long", "put", "(", "byte", "[", "]", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "long", "put", "(", "ByteBuffer", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "long", "put", "(", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "get", "(", "long", "id", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "get", "(", "long", "id", ",", "Persistable", "object", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "get", "(", "long", "id", ",", "short", "nodeHint", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "get", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "getFromOwner", "(", "long", "id", ",", "long", "ownerOf", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "getFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "gets", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "gets", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "gets", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "gets", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "getsFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "getsFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "getx", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "getx", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "getx", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "getx", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "byte", "[", "]", "getxFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "getxFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "set", "(", "long", "id", ",", "byte", "[", "]", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "set", "(", "long", "id", ",", "ByteBuffer", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "set", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "void", "del", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getAsync", "(", "long", "id", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getAsync", "(", "long", "id", ",", "Persistable", "object", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getAsync", "(", "long", "id", ",", "short", "nodeHint", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getsAsync", "(", "long", "id", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getsAsync", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getsAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getsAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getsFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getsFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getxAsync", "(", "long", "id", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getxAsync", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getxAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getxAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "byte", "[", "]", ">", "getxFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Persistable", ">", "getxFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Void", ">", "setAsync", "(", "long", "id", ",", "byte", "[", "]", "data", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Void", ">", "setAsync", "(", "long", "id", ",", "ByteBuffer", "data", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "ListenableFuture", "<", "Void", ">", "setAsync", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", ";", "</s>"]
["<s>", "void", "push", "(", "long", "id", ",", "short", ".", ".", ".", "toNodes", ")", ";", "</s>"]
["<s>", "void", "pushx", "(", "long", "id", ",", "short", "toNode", ")", ";", "</s>"]
["<s>", "boolean", "isPinned", "(", "long", "id", ")", ";", "</s>"]
["<s>", "ItemState", "getState", "(", "long", "id", ")", ";", "</s>"]
["<s>", "void", "invalidated", "(", "long", "id", ")", ";", "</s>"]
["<s>", "void", "received", "(", "long", "id", ",", "long", "version", ",", "ByteBuffer", "data", ")", ";", "</s>"]
["<s>", "void", "evicted", "(", "long", "id", ")", ";", "</s>"]
["<s>", "public", "static", "String", "parent", "(", "String", "node", ")", "{", "final", "int", "index", "=", "node", ".", "lastIndexOf", "(", "<CHAR_LIT:/>", ")", ";", "if", "(", "index", "<", "0", ")", "return", "null", ";", "return", "node", ".", "substring", "(", "0", ",", "index", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "child", "(", "String", "node", ")", "{", "final", "int", "index", "=", "node", ".", "lastIndexOf", "(", "<CHAR_LIT:/>", ")", ";", "if", "(", "index", "<", "0", "|", "|", "index", "=", "=", "node", ".", "length", "(", ")", "-", "1", ")", "return", "null", ";", "return", "node", ".", "substring", "(", "index", "+", "1", ",", "node", ".", "length", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "correctForRoot", "(", "String", "node", ")", "{", "return", "node", ".", "equals", "(", "\"", "<STR_LIT:/>", "\"", ")", "?", "\"", "\"", ":", "node", ";", "}", "</s>"]
["<s>", "public", "static", "Iterable", "<", "String", ">", "iterate", "(", "final", "String", "node", ")", "{", "return", "new", "Iterable", "<", "String", ">", "(", ")", "{", "@", "Override", "public", "Iterator", "<", "String", ">", "iterator", "(", ")", "{", "return", "new", "Scanner", "(", "node", ")", ".", "useDelimiter", "(", "\"", "<STR_LIT:/>", "\"", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Iterator", "<", "String", ">", "iterator", "(", ")", "{", "return", "new", "Scanner", "(", "node", ")", ".", "useDelimiter", "(", "\"", "<STR_LIT:/>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "DistributedTreeUtil", "(", ")", "{", "}", "</s>"]
["<s>", "public", "DistributedBranchHelper", "(", "DistributedTree", "tree", ",", "final", "String", "branchRoot", ",", "boolean", "ordered", ")", "{", "if", "(", "!", "branchRoot", ".", "startsWith", "(", "\"", "<STR_LIT:/>", "\"", ")", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "branchRoot", ")", ";", "this", ".", "tree", "=", "tree", ";", "this", ".", "branchRoot", "=", "branchRoot", ";", "this", ".", "ordered", "=", "ordered", ";", "tree", ".", "addListener", "(", "branchRoot", ",", "new", "Listener", "(", ")", "{", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "DistributedBranchHelper", ".", "this", ".", "nodeAdded", "(", "childName", ")", ";", "}", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "DistributedBranchHelper", ".", "this", ".", "nodeRemoved", "(", "childName", ")", ";", "}", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "DistributedBranchHelper", ".", "this", ".", "nodeUpdated", "(", "childName", ")", ";", "}", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "node", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeUpdated", "(", "node", ")", ";", "}", "@", "Override", "public", "void", "nodeAdded", "(", "String", "node", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeAdded", "(", "node", ")", ";", "}", "@", "Override", "public", "void", "nodeDeleted", "(", "String", "node", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeDeleted", "(", "node", ")", ";", "}", "}", ")", ";", "synchronized", "(", "nodes", ")", "{", "final", "List", "<", "String", ">", "children", "=", "tree", ".", "getChildren", "(", "branchRoot", ")", ";", "if", "(", "children", "!", "=", "null", ")", "{", "for", "(", "String", "nodeName", ":", "children", ")", "nodeAdded", "(", "nodeName", ")", ";", "}", "if", "(", "ordered", ")", "{", "final", "Node", "first", "=", "getFirstNode", "(", ")", ";", "if", "(", "first", "!", "=", "null", ")", "first", ".", "predecessorsComplete", "(", ")", ";", "}", "doneInit", "=", "true", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "DistributedBranchHelper", ".", "this", ".", "nodeAdded", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "DistributedBranchHelper", ".", "this", ".", "nodeRemoved", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "DistributedBranchHelper", ".", "this", ".", "nodeUpdated", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "node", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeUpdated", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "String", "node", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeAdded", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeDeleted", "(", "String", "node", ")", "{", "assert", "node", ".", "equals", "(", "branchRoot", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeDeleted", "(", "node", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addListener", "(", "Listener", "listener", ")", "{", "synchronized", "(", "nodes", ")", "{", "for", "(", "Node", "node", ":", "nodes", ".", "values", "(", ")", ")", "{", "if", "(", "!", "node", ".", "isComplete", "(", ")", ")", "break", ";", "listener", ".", "nodeChildAdded", "(", "branchRoot", ",", "node", ".", "name", ")", ";", "}", "listeners", ".", "add", "(", "listener", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "removeListener", "(", "Listener", "listener", ")", "{", "listeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getChildren", "(", ")", "{", "final", "List", "<", "String", ">", "children", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "synchronized", "(", "nodes", ")", "{", "for", "(", "Node", "node", ":", "nodes", ".", "values", "(", ")", ")", "{", "if", "(", "!", "node", ".", "isComplete", "(", ")", ")", "break", ";", "children", ".", "add", "(", "node", ".", "name", ")", ";", "}", "}", "return", "Collections", ".", "unmodifiableList", "(", "children", ")", ";", "}", "</s>"]
["<s>", "private", "void", "nodeAdded", "(", "String", "name", ")", "{", "synchronized", "(", "nodes", ")", "{", "Node", "node", "=", "nodes", ".", "remove", "(", "name", ")", ";", "if", "(", "node", "=", "=", "null", ")", "node", "=", "new", "Node", "(", "name", ")", ";", "nodes", ".", "put", "(", "name", ",", "node", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "if", "(", "ordered", ")", "{", "final", "Node", "previous", "=", "getPreviousNode", "(", "name", ")", ";", "if", "(", "(", "previous", "=", "=", "null", "&", "&", "doneInit", ")", "|", "|", "(", "previous", "!", "=", "null", "&", "&", "previous", ".", "isComplete", "(", ")", ")", ")", "node", ".", "predecessorsComplete", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "nodeCompleted", "(", "String", "name", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeChildAdded", "(", "branchRoot", ",", "name", ")", ";", "if", "(", "ordered", ")", "{", "synchronized", "(", "nodes", ")", "{", "final", "Node", "next", "=", "getNextNode", "(", "name", ")", ";", "if", "(", "next", "!", "=", "null", ")", "next", ".", "predecessorsComplete", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "nodeUpdated", "(", "String", "name", ")", "{", "final", "Node", "node", ";", "synchronized", "(", "nodes", ")", "{", "node", "=", "nodes", ".", "get", "(", "name", ")", ";", "}", "assert", "node", "!", "=", "null", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "node", ".", "isComplete", "(", ")", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "node", ".", "isComplete", "(", ")", ")", "{", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeChildUpdated", "(", "branchRoot", ",", "name", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "nodeRemoved", "(", "String", "name", ")", "{", "boolean", "_doneInit", ";", "final", "Node", "node", ";", "Node", "previous", "=", "null", ",", "next", "=", "null", ";", "synchronized", "(", "nodes", ")", "{", "if", "(", "ordered", ")", "{", "previous", "=", "nodes", ".", "previousValue", "(", "name", ")", ";", "next", "=", "nodes", ".", "nextValue", "(", "name", ")", ";", "}", "node", "=", "nodes", ".", "remove", "(", "name", ")", ";", "_doneInit", "=", "this", ".", "doneInit", ";", "}", "if", "(", "node", ".", "isComplete", "(", ")", ")", "{", "for", "(", "Listener", "listener", ":", "listeners", ")", "listener", ".", "nodeChildDeleted", "(", "branchRoot", ",", "name", ")", ";", "}", "if", "(", "ordered", ")", "{", "if", "(", "_doneInit", "&", "&", "next", "!", "=", "null", "&", "&", "(", "previous", "=", "=", "null", "|", "|", "previous", ".", "isComplete", "(", ")", ")", ")", "next", ".", "predecessorsComplete", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Node", "getNextNode", "(", "String", "node", ")", "{", "assert", "ordered", ";", "synchronized", "(", "nodes", ")", "{", "final", "Map", ".", "Entry", "<", "String", ",", "Node", ">", "entry", "=", "nodes", ".", "nextEntry", "(", "node", ")", ";", "return", "(", "entry", "!", "=", "null", "?", "entry", ".", "getValue", "(", ")", ":", "null", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Node", "getPreviousNode", "(", "String", "node", ")", "{", "assert", "ordered", ";", "synchronized", "(", "nodes", ")", "{", "final", "Map", ".", "Entry", "<", "String", ",", "Node", ">", "entry", "=", "nodes", ".", "previousEntry", "(", "node", ")", ";", "return", "(", "entry", "!", "=", "null", "?", "entry", ".", "getValue", "(", ")", ":", "null", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Node", "getFirstNode", "(", ")", "{", "assert", "ordered", ";", "synchronized", "(", "nodes", ")", "{", "final", "Map", ".", "Entry", "<", "String", ",", "Node", ">", "entry", "=", "nodes", ".", "firstEntry", "(", ")", ";", "return", "(", "entry", "!", "=", "null", "?", "entry", ".", "getValue", "(", ")", ":", "null", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "abstract", "boolean", "isNodeComplete", "(", "String", "node", ",", "Set", "<", "String", ">", "properties", ")", ";", "</s>"]
["<s>", "public", "Node", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "this", ".", "treePath", "=", "branchRoot", "+", "<CHAR_LIT:/>", "+", "name", ";", "this", ".", "predecessorsComplete", "=", "!", "ordered", ";", "tree", ".", "addListener", "(", "treePath", ",", "this", ")", ";", "for", "(", "String", "property", ":", "tree", ".", "getChildren", "(", "treePath", ")", ")", "testProperty", "(", "property", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "isComplete", "(", ")", "{", "return", "complete", ";", "}", "</s>"]
["<s>", "public", "void", "predecessorsComplete", "(", ")", "{", "assert", "ordered", ";", "synchronized", "(", "this", ")", "{", "if", "(", "predecessorsComplete", ")", "return", ";", "predecessorsComplete", "=", "true", ";", "}", "testComplete", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testProperty", "(", "String", "property", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "property", ")", ";", "synchronized", "(", "this", ")", "{", "if", "(", "tree", ".", "get", "(", "treePath", "+", "<CHAR_LIT:/>", "+", "property", ")", "=", "=", "null", ")", "return", ";", "properties", ".", "add", "(", "property", ")", ";", "}", "testComplete", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "testComplete", "(", ")", "{", "synchronized", "(", "this", ")", "{", "if", "(", "complete", ")", "return", ";", "if", "(", "!", "predecessorsComplete", "|", "|", "!", "isNodeComplete", "(", "treePath", ",", "properties", ")", ")", "return", ";", "complete", "=", "true", ";", "tree", ".", "removeListener", "(", "treePath", ",", "this", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "nodeCompleted", "(", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "childName", ")", "{", "nodeChildUpdated", "(", "node", ",", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "node", ".", "equals", "(", "treePath", ")", ";", "testProperty", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "void", "propertyChanged", "(", "NodeInfo", "node", ",", "String", "property", ",", "Object", "value", ")", ";", "</s>"]
["<s>", "void", "joinedCluster", "(", ")", ";", "</s>"]
["<s>", "void", "online", "(", "boolean", "master", ")", ";", "</s>"]
["<s>", "void", "offline", "(", ")", ";", "</s>"]
["<s>", "void", "switchToMaster", "(", ")", ";", "</s>"]
["<s>", "short", "getNodeId", "(", "Address", "address", ")", ";", "</s>"]
["<s>", "Address", "getNodeAddress", "(", "short", "id", ")", ";", "</s>"]
["<s>", "public", "DistributedTreeAdapter", "(", "DistributedTree", "tree", ")", "{", "this", ".", "tree", "=", "tree", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addListener", "(", "String", "node", ",", "Listener", "listener", ")", "{", "tree", ".", "addListener", "(", "node", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeListener", "(", "String", "node", ",", "Listener", "listener", ")", "{", "tree", ".", "removeListener", "(", "node", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "create", "(", "String", "node", ",", "boolean", "ephemeral", ")", "{", "tree", ".", "create", "(", "node", ",", "ephemeral", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "createEphemeralOrdered", "(", "String", "node", ")", "{", "tree", ".", "createEphemeralOrdered", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "String", "node", ",", "byte", "[", "]", "data", ")", "{", "tree", ".", "set", "(", "node", ",", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "String", "node", ")", "{", "tree", ".", "delete", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "flush", "(", ")", "{", "tree", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "exists", "(", "String", "node", ")", "{", "return", "tree", ".", "exists", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "get", "(", "String", "node", ")", "{", "return", "tree", ".", "get", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "getChildren", "(", "String", "node", ")", "{", "return", "tree", ".", "getChildren", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "print", "(", "String", "node", ",", "java", ".", "io", ".", "PrintStream", "out", ")", "{", "tree", ".", "print", "(", "node", ",", "out", ")", ";", "}", "</s>"]
["<s>", "void", "create", "(", "String", "node", ",", "boolean", "ephemeral", ")", ";", "</s>"]
["<s>", "void", "createEphemeralOrdered", "(", "String", "node", ")", ";", "</s>"]
["<s>", "List", "<", "String", ">", "getChildren", "(", "String", "node", ")", ";", "</s>"]
["<s>", "boolean", "exists", "(", "String", "node", ")", ";", "</s>"]
["<s>", "void", "set", "(", "String", "node", ",", "byte", "[", "]", "data", ")", ";", "</s>"]
["<s>", "byte", "[", "]", "get", "(", "String", "node", ")", ";", "</s>"]
["<s>", "void", "delete", "(", "String", "node", ")", ";", "</s>"]
["<s>", "void", "flush", "(", ")", ";", "</s>"]
["<s>", "void", "addListener", "(", "String", "node", ",", "Listener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeListener", "(", "String", "node", ",", "Listener", "listener", ")", ";", "</s>"]
["<s>", "void", "print", "(", "String", "node", ",", "java", ".", "io", ".", "PrintStream", "out", ")", ";", "</s>"]
["<s>", "void", "nodeAdded", "(", "String", "node", ")", ";", "</s>"]
["<s>", "void", "nodeUpdated", "(", "String", "node", ")", ";", "</s>"]
["<s>", "void", "nodeDeleted", "(", "String", "node", ")", ";", "</s>"]
["<s>", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "child", ")", ";", "</s>"]
["<s>", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "child", ")", ";", "</s>"]
["<s>", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "child", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "String", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeDeleted", "(", "String", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "node", ",", "String", "childName", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "node", ",", "String", "childName", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "childName", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "read", "(", "byte", "[", "]", "data", ")", "{", "return", "new", "String", "(", "data", ",", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "String", "value", ")", "{", "return", "value", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Boolean", "read", "(", "byte", "[", "]", "data", ")", "{", "return", "Boolean", ".", "parseBoolean", "(", "STRING", ".", "read", "(", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "Boolean", "value", ")", "{", "return", "STRING", ".", "write", "(", "value", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Short", "read", "(", "byte", "[", "]", "data", ")", "{", "return", "Short", ".", "parseShort", "(", "STRING", ".", "read", "(", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "Short", "value", ")", "{", "return", "STRING", ".", "write", "(", "value", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Integer", "read", "(", "byte", "[", "]", "data", ")", "{", "return", "Integer", ".", "parseInt", "(", "STRING", ".", "read", "(", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "Integer", "value", ")", "{", "return", "STRING", ".", "write", "(", "value", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "read", "(", "byte", "[", "]", "data", ")", "{", "return", "Long", ".", "parseLong", "(", "STRING", ".", "read", "(", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "Long", "value", ")", "{", "return", "STRING", ".", "write", "(", "value", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "ReaderWriters", "(", ")", "{", "}", "</s>"]
["<s>", "String", "getName", "(", ")", ";", "</s>"]
["<s>", "short", "getNodeId", "(", ")", ";", "</s>"]
["<s>", "Object", "get", "(", "String", "property", ")", ";", "</s>"]
["<s>", "Collection", "<", "String", ">", "getProperties", "(", ")", ";", "</s>"]
["<s>", "public", "AbstractNodeAddressResolver", "(", "final", "Cluster", "cluster", ")", "{", "this", ".", "cluster", "=", "cluster", ";", "cluster", ".", "addNodeChangeListener", "(", "new", "NodeChangeListener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "put", "(", "cluster", ".", "getMaster", "(", "id", ")", ")", ";", "}", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "put", "(", "cluster", ".", "getMaster", "(", "id", ")", ")", ";", "}", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "final", "Address", "address", "=", "nodeIdToAddress", ".", "get", "(", "id", ")", ";", "if", "(", "address", "!", "=", "null", ")", "addressToNodeId", ".", "remove", "(", "address", ")", ";", "nodeIdToAddress", ".", "remove", "(", "id", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "put", "(", "cluster", ".", "getMaster", "(", "id", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "put", "(", "cluster", ".", "getMaster", "(", "id", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "final", "Address", "address", "=", "nodeIdToAddress", ".", "get", "(", "id", ")", ";", "if", "(", "address", "!", "=", "null", ")", "addressToNodeId", ".", "remove", "(", "address", ")", ";", "nodeIdToAddress", ".", "remove", "(", "id", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "init", "(", ")", "{", "for", "(", "NodeInfo", "node", ":", "cluster", ".", "getMasters", "(", ")", ")", "put", "(", "node", ")", ";", "}", "</s>"]
["<s>", "private", "void", "put", "(", "NodeInfo", "node", ")", "{", "final", "short", "id", "=", "node", ".", "getNodeId", "(", ")", ";", "final", "Address", "address", "=", "getAddress", "(", "cluster", ".", "getMaster", "(", "id", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "address", ")", ";", "if", "(", "address", "!", "=", "null", ")", "{", "nodeIdToAddress", ".", "put", "(", "id", ",", "address", ")", ";", "addressToNodeId", ".", "put", "(", "address", ",", "id", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "abstract", "Address", "getAddress", "(", "NodeInfo", "node", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "short", "getNodeId", "(", "Address", "address", ")", "{", "final", "Short", "node", "=", "addressToNodeId", ".", "get", "(", "address", ")", ";", "return", "node", "!", "=", "null", "?", "node", ":", "-", "1", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Address", "getNodeAddress", "(", "short", "id", ")", "{", "return", "nodeIdToAddress", ".", "get", "(", "id", ")", ";", "}", "</s>"]
["<s>", "NodeInfo", "getNode", "(", "Address", "address", ")", ";", "</s>"]
["<s>", "Address", "getAddress", "(", "String", "nodeName", ")", ";", "</s>"]
["<s>", "T", "read", "(", "byte", "[", "]", "data", ")", ";", "</s>"]
["<s>", "byte", "[", "]", "write", "(", "T", "value", ")", ";", "</s>"]
["<s>", "void", "nodeAdded", "(", "short", "id", ")", ";", "</s>"]
["<s>", "void", "nodeSwitched", "(", "short", "id", ")", ";", "</s>"]
["<s>", "void", "nodeRemoved", "(", "short", "id", ")", ";", "</s>"]
["<s>", "void", "newMaster", "(", "NodeInfo", "node", ")", ";", "</s>"]
["<s>", "void", "slaveAdded", "(", "NodeInfo", "node", ")", ";", "</s>"]
["<s>", "void", "slaveRemoved", "(", "NodeInfo", "node", ")", ";", "</s>"]
["<s>", "public", "boolean", "isOf", "(", "long", "set", ")", "{", "return", "Enums", ".", "isIn", "(", "this", ",", "set", ")", ";", "}", "</s>"]
["<s>", "public", "static", "GET", "GET", "(", "short", "node", ",", "long", "line", ")", "{", "return", "new", "GET", "(", "Type", ".", "GET", ",", "node", ",", "line", ")", ";", "}", "</s>"]
["<s>", "public", "static", "GET", "GETX", "(", "short", "node", ",", "long", "line", ")", "{", "return", "new", "GET", "(", "Type", ".", "GETX", ",", "node", ",", "line", ")", ";", "}", "</s>"]
["<s>", "public", "static", "PUT", "PUT", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "PUT", "(", "responseTo", ",", "line", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "PUT", "PUT", "(", "short", "node", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "PUT", "(", "node", ",", "line", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "PUT", "PUT", "(", "short", "[", "]", "nodes", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "PUT", "(", "nodes", ",", "line", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "PUTX", "PUTX", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "[", "]", "sharers", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "PUTX", "(", "responseTo", ",", "line", ",", "sharers", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "PUTX", "PUTX", "(", "short", "node", ",", "long", "line", ",", "short", "[", "]", "sharers", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "PUTX", "(", "node", ",", "line", ",", "sharers", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "LineMessage", "DEL", "(", "short", "node", ",", "long", "line", ")", "{", "return", "new", "LineMessage", "(", "node", ",", "Type", ".", "DEL", ",", "line", ")", ";", "}", "</s>"]
["<s>", "public", "static", "INV", "INV", "(", "short", "node", ",", "long", "line", ",", "short", "previousOwner", ")", "{", "return", "new", "INV", "(", "node", ",", "line", ",", "previousOwner", ")", ";", "}", "</s>"]
["<s>", "public", "static", "INV", "INV", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "previousOwner", ")", "{", "return", "new", "INV", "(", "responseTo", ",", "line", ",", "previousOwner", ")", ";", "}", "</s>"]
["<s>", "public", "static", "LineMessage", "INVACK", "(", "LineMessage", "responseTo", ")", "{", "return", "new", "LineMessage", "(", "responseTo", ",", "Type", ".", "INVACK", ",", "responseTo", ".", "getLine", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "LineMessage", "INVACK", "(", "short", "node", ",", "long", "line", ")", "{", "return", "new", "LineMessage", "(", "node", ",", "Type", ".", "INVACK", ",", "line", ")", ";", "}", "</s>"]
["<s>", "public", "static", "CHNGD_OWNR", "CHNGD_OWNR", "(", "short", "node", ",", "long", "line", ",", "short", "newOwner", ",", "boolean", "certain", ")", "{", "return", "new", "CHNGD_OWNR", "(", "node", ",", "line", ",", "newOwner", ",", "certain", ")", ";", "}", "</s>"]
["<s>", "public", "static", "CHNGD_OWNR", "CHNGD_OWNR", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "newOwner", ",", "boolean", "certain", ")", "{", "return", "new", "CHNGD_OWNR", "(", "responseTo", ",", "line", ",", "newOwner", ",", "certain", ")", ";", "}", "</s>"]
["<s>", "public", "static", "LineMessage", "NOT_FOUND", "(", "LineMessage", "responseTo", ")", "{", "return", "new", "LineMessage", "(", "responseTo", ",", "Type", ".", "NOT_FOUND", ")", ";", "}", "</s>"]
["<s>", "public", "static", "BACKUP", "BACKUP", "(", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "return", "new", "BACKUP", "(", "(", "short", ")", "0", ",", "line", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "BACKUPACK", "BACKUPACK", "(", "short", "node", ",", "long", "line", ",", "long", "version", ")", "{", "return", "new", "BACKUPACK", "(", "node", ",", "line", ",", "version", ")", ";", "}", "</s>"]
["<s>", "public", "static", "BACKUP_PACKET", "BACKUP_PACKET", "(", "long", "id", ",", "Collection", "<", "BACKUP", ">", "backups", ")", "{", "return", "new", "BACKUP_PACKET", "(", "id", ",", "backups", ")", ";", "}", "</s>"]
["<s>", "public", "static", "BACKUP_PACKETACK", "BACKUP_PACKETACK", "(", "BACKUP_PACKET", "responseTo", ")", "{", "return", "new", "BACKUP_PACKETACK", "(", "responseTo", ")", ";", "}", "</s>"]
["<s>", "public", "static", "MSG", "MSG", "(", "MSG", "responseTo", ",", "byte", "[", "]", "data", ")", "{", "return", "new", "MSG", "(", "responseTo", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "MSG", "MSG", "(", "short", "node", ",", "long", "line", ",", "byte", "[", "]", "data", ")", "{", "return", "new", "MSG", "(", "node", ",", "line", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "MSG", "MSG", "(", "short", "[", "]", "nodes", ",", "long", "line", ",", "byte", "[", "]", "data", ")", "{", "return", "new", "MSG", "(", "nodes", ",", "line", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "static", "LineMessage", "MSGACK", "(", "MSG", "responseTo", ")", "{", "return", "new", "LineMessage", "(", "responseTo", ",", "Type", ".", "MSGACK", ")", ";", "}", "</s>"]
["<s>", "public", "static", "LineMessage", "TIMEOUT", "(", "LineMessage", "responseTo", ")", "{", "return", "new", "LineMessage", "(", "responseTo", ",", "Type", ".", "TIMEOUT", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Message", "ACK", "(", "Message", "responseTo", ")", "{", "return", "new", "Message", "(", "responseTo", ",", "Type", ".", "ACK", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Message", "readMessage", "(", "DataInput", "in", ")", "throws", "IOException", "{", "final", "Type", "type", "=", "Type", ".", "values", "(", ")", "[", "in", ".", "readByte", "(", ")", "]", ";", "final", "Message", "message", "=", "newMessage", "(", "type", ")", ";", "message", ".", "read", "(", "in", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "public", "static", "Message", "fromByteArray", "(", "byte", "[", "]", "array", ")", "{", "final", "Type", "type", "=", "Type", ".", "values", "(", ")", "[", "array", "[", "0", "]", "]", ";", "final", "Message", "message", "=", "newMessage", "(", "type", ")", ";", "message", ".", "read", "(", "array", ",", "1", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "public", "static", "Message", "fromByteBuffer", "(", "ByteBuffer", "buffer", ")", "{", "final", "Type", "type", "=", "Type", ".", "values", "(", ")", "[", "buffer", ".", "get", "(", ")", "]", ";", "final", "Message", "message", "=", "newMessage", "(", "type", ")", ";", "message", ".", "read", "(", "buffer", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "public", "static", "Message", "newMessage", "(", "Type", "type", ")", "{", "switch", "(", "type", ")", "{", "case", "INV", ":", "return", "new", "INV", "(", ")", ";", "case", "GET", ":", "case", "GETX", ":", "return", "new", "GET", "(", "type", ")", ";", "case", "PUT", ":", "return", "new", "PUT", "(", "type", ")", ";", "case", "PUTX", ":", "return", "new", "PUTX", "(", ")", ";", "case", "CHNGD_OWNR", ":", "return", "new", "CHNGD_OWNR", "(", ")", ";", "case", "BACKUP", ":", "return", "new", "BACKUP", "(", ")", ";", "case", "BACKUPACK", ":", "return", "new", "BACKUPACK", "(", ")", ";", "case", "BACKUP_PACKET", ":", "return", "new", "BACKUP_PACKET", "(", ")", ";", "case", "BACKUP_PACKETACK", ":", "return", "new", "BACKUP_PACKETACK", "(", ")", ";", "case", "MSG", ":", "return", "new", "MSG", "(", ")", ";", "case", "ACK", ":", "return", "new", "Message", "(", "type", ")", ";", "case", "DEL", ":", "case", "INVACK", ":", "case", "NOT_FOUND", ":", "case", "MSGACK", ":", "case", "TIMEOUT", ":", "return", "new", "LineMessage", "(", "type", ")", ";", "default", ":", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "type", ")", ";", "}", "}", "</s>"]
["<s>", "Message", "(", "Type", "type", ")", "{", "this", ".", "type", "=", "type", ";", "this", ".", "incoming", "=", "true", ";", "}", "</s>"]
["<s>", "public", "Message", "(", "Message", "responseTo", ",", "Type", "type", ")", "{", "this", ".", "incoming", "=", "false", ";", "this", ".", "node", "=", "responseTo", ".", "getNode", "(", ")", ";", "this", ".", "type", "=", "type", ";", "this", ".", "messageId", "=", "responseTo", ".", "messageId", ";", "this", ".", "flags", "=", "FLAG_RESPONSE", ";", "}", "</s>"]
["<s>", "public", "Message", "(", "short", "node", ",", "Type", "type", ")", "{", "this", ".", "incoming", "=", "false", ";", "this", ".", "node", "=", "node", ";", "this", ".", "type", "=", "type", ";", "setBroadcast", "(", "node", "=", "=", "-", "1", ")", ";", "setReplyRequired", "(", "true", ")", ";", "}", "</s>"]
["<s>", "public", "Message", "(", "short", "[", "]", "nodes", ",", "Type", "type", ")", "{", "this", ".", "incoming", "=", "false", ";", "Arrays", ".", "sort", "(", "nodes", ")", ";", "this", ".", "node", "=", "-", "1", ";", "this", ".", "type", "=", "type", ";", "setReplyRequired", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Message", "clone", "(", ")", "{", "try", "{", "return", "(", "Message", ")", "super", ".", "clone", "(", ")", ";", "}", "catch", "(", "CloneNotSupportedException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "false", ";", "if", "(", "!", "(", "obj", "instanceof", "Message", ")", ")", "return", "false", ";", "final", "Message", "other", "=", "(", "Message", ")", "obj", ";", "if", "(", "this", ".", "incoming", "=", "=", "other", ".", "incoming", "|", "|", "this", ".", "isResponse", "(", ")", "=", "=", "other", ".", "isResponse", "(", ")", ")", "return", "super", ".", "equals", "(", "obj", ")", ";", "if", "(", "this", ".", "messageId", "!", "=", "other", ".", "messageId", ")", "return", "false", ";", "if", "(", "this", ".", "node", ">", "=", "0", "&", "&", "other", ".", "node", ">", "=", "0", ")", "return", "this", ".", "node", "=", "=", "other", ".", "node", ";", "if", "(", "this", ".", "isBroadcast", "(", ")", ")", "{", "assert", "!", "other", ".", "isBroadcast", "(", ")", "&", "!", "this", ".", "isResponse", "(", ")", "&", "other", ".", "isResponse", "(", ")", ";", "return", "true", ";", "}", "if", "(", "other", ".", "isBroadcast", "(", ")", ")", "{", "assert", "!", "this", ".", "isBroadcast", "(", ")", "&", "!", "other", ".", "isResponse", "(", ")", "&", "this", ".", "isResponse", "(", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "int", "hash", "=", "<NUM_LIT:7>", ";", "hash", "=", "<NUM_LIT>", "*", "hash", "+", "(", "int", ")", "(", "this", ".", "messageId", "^", "(", "this", ".", "messageId", ">", ">", ">", "<NUM_LIT:32>", ")", ")", ";", "return", "hash", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "String", "toString", "(", ")", "{", "return", "partialToString", "(", ")", "+", "<CHAR_LIT:]>", ";", "}", "</s>"]
["<s>", "protected", "String", "partialToString", "(", ")", "{", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", ")", ";", "sb", ".", "append", "(", "<CHAR_LIT:[>", ")", ";", "sb", ".", "append", "(", "type", ")", ".", "append", "(", "<CHAR_LIT>", ")", ";", "sb", ".", "append", "(", "incoming", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "messageId", ">", "=", "0", "?", "messageId", ":", "\"", "<STR_LIT:_>", "\"", ")", ";", "if", "(", "isResponse", "(", ")", ")", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ";", "if", "(", "incoming", "&", "&", "isBroadcast", "(", ")", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ".", "append", "(", "incoming", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "node", ")", ";", "if", "(", "!", "isResponse", "(", ")", "&", "&", "!", "isReplyRequired", "(", ")", ")", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "short", "getNode", "(", ")", "{", "return", "node", ";", "}", "</s>"]
["<s>", "public", "Message", "setNode", "(", "short", "node", ")", "{", "this", ".", "node", "=", "node", ";", "if", "(", "!", "incoming", ")", "setBroadcast", "(", "node", "=", "=", "(", "short", ")", "-", "1", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "Message", "setIncoming", "(", ")", "{", "this", ".", "incoming", "=", "true", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "long", "getTimestamp", "(", ")", "{", "return", "timestamp", ";", "}", "</s>"]
["<s>", "public", "void", "setTimestamp", "(", "long", "timestamp", ")", "{", "this", ".", "timestamp", "=", "timestamp", ";", "}", "</s>"]
["<s>", "public", "Message", "setMessageId", "(", "long", "messageId", ")", "{", "this", ".", "messageId", "=", "messageId", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "long", "getMessageId", "(", ")", "{", "return", "messageId", ";", "}", "</s>"]
["<s>", "public", "boolean", "isResponse", "(", ")", "{", "return", "(", "flags", "&", "FLAG_RESPONSE", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "private", "void", "setBroadcast", "(", "boolean", "value", ")", "{", "assert", "!", "incoming", ";", "flags", "=", "(", "byte", ")", "(", "value", "?", "(", "flags", "|", "FLAG_BROADCAST", ")", ":", "(", "flags", "&", "~", "FLAG_BROADCAST", ")", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isBroadcast", "(", ")", "{", "return", "(", "flags", "&", "FLAG_BROADCAST", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "public", "final", "void", "setReplyRequired", "(", "boolean", "value", ")", "{", "assert", "!", "incoming", ";", "flags", "=", "(", "byte", ")", "(", "value", "?", "(", "flags", "|", "FLAG_REPLY_REQUIRED", ")", ":", "(", "flags", "&", "~", "FLAG_REPLY_REQUIRED", ")", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isReplyRequired", "(", ")", "{", "return", "(", "flags", "&", "FLAG_REPLY_REQUIRED", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "public", "Type", "getType", "(", ")", "{", "return", "type", ";", "}", "</s>"]
["<s>", "@", "Override", "final", "public", "void", "writeExternal", "(", "ObjectOutput", "out", ")", "throws", "IOException", "{", "write", "(", "out", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "final", "public", "void", "readExternal", "(", "ObjectInput", "in", ")", "throws", "IOException", "{", "type", "=", "Type", ".", "values", "(", ")", "[", "in", ".", "read", "(", ")", "]", ";", "read", "(", "in", ")", ";", "}", "</s>"]
["<s>", "private", "Streamable", "streamableNoBuffers", "(", ")", "{", "return", "new", "Streamable", "(", ")", "{", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "size1", "(", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "write1", "(", "out", ")", ";", "}", "@", "Override", "public", "void", "read", "(", "DataInput", "in", ")", "throws", "IOException", "{", "read1", "(", "in", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "size1", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "write1", "(", "out", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read", "(", "DataInput", "in", ")", "throws", "IOException", "{", "read1", "(", "in", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "int", "size", "(", ")", "{", "int", "size", "=", "size1", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "size", "+", "=", "<NUM_LIT:2>", "+", "getDataBuffer", "(", "i", ")", ".", "remaining", "(", ")", ";", "return", "size", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "write", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "write1", "(", "out", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "{", "final", "ByteBuffer", "buffer", "=", "getDataBuffer", "(", "i", ")", ";", "out", ".", "writeShort", "(", "verifyShort", "(", "buffer", ".", "remaining", "(", ")", ")", ")", ";", "Streamables", ".", "writeBuffer", "(", "out", ",", "buffer", ")", ";", "buffer", ".", "rewind", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "read", "(", "DataInput", "in", ")", "throws", "IOException", "{", "read1", "(", "in", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "{", "int", "size", "=", "in", ".", "readUnsignedShort", "(", ")", ";", "byte", "[", "]", "array", "=", "new", "byte", "[", "size", "]", ";", "in", ".", "readFully", "(", "array", ")", ";", "final", "ByteBuffer", "buffer", "=", "ByteBuffer", ".", "wrap", "(", "array", ")", ";", "setDataBuffer", "(", "i", ",", "buffer", ")", ";", "}", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "toByteArray", "(", ")", "{", "return", "Streamables", ".", "toByteArray", "(", "this", ")", ";", "}", "</s>"]
["<s>", "public", "void", "read", "(", "byte", "[", "]", "array", ",", "int", "offset", ")", "{", "Streamables", ".", "fromByteArray", "(", "streamableNoBuffers", "(", ")", ",", "array", ",", "offset", ")", ";", "offset", "=", "size1", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "{", "final", "int", "size", "=", "Ints", ".", "fromBytes", "(", "(", "byte", ")", "0", ",", "(", "byte", ")", "0", ",", "array", "[", "offset", "]", ",", "array", "[", "offset", "+", "1", "]", ")", ";", "offset", "+", "=", "<NUM_LIT:2>", ";", "final", "ByteBuffer", "buffer", "=", "ByteBuffer", ".", "wrap", "(", "array", ",", "offset", ",", "size", ")", ".", "slice", "(", ")", ";", "setDataBuffer", "(", "i", ",", "buffer", ")", ";", "offset", "+", "=", "size", ";", "}", "}", "</s>"]
["<s>", "public", "ByteBuffer", "[", "]", "toByteBuffers", "(", ")", "{", "final", "ByteBuffer", "buffer0", "=", "ByteBuffer", ".", "allocate", "(", "size1", "(", ")", "+", "<NUM_LIT:2>", "*", "getNumDataBuffers", "(", ")", ")", ";", "Persistables", ".", "persistable", "(", "streamableNoBuffers", "(", ")", ")", ".", "write", "(", "buffer0", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "buffer0", ".", "putShort", "(", "getDataBuffer", "(", "i", ")", "!", "=", "null", "?", "verifyShort", "(", "getDataBuffer", "(", "i", ")", ".", "remaining", "(", ")", ")", ":", "0", ")", ";", "buffer0", ".", "flip", "(", ")", ";", "final", "ByteBuffer", "[", "]", "buffers", "=", "new", "ByteBuffer", "[", "1", "+", "getNumDataBuffers", "(", ")", "]", ";", "buffers", "[", "0", "]", "=", "buffer0", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "buffers", "[", "1", "+", "i", "]", "=", "getDataBuffer", "(", "i", ")", ";", "return", "buffers", ";", "}", "</s>"]
["<s>", "public", "void", "read", "(", "ByteBuffer", "buffer", ")", "{", "Persistables", ".", "persistable", "(", "streamableNoBuffers", "(", ")", ")", ".", "read", "(", "buffer", ")", ";", "final", "int", "n", "=", "getNumDataBuffers", "(", ")", ";", "int", "lengthsPosition", "=", "buffer", ".", "position", "(", ")", ";", "buffer", ".", "position", "(", "buffer", ".", "position", "(", ")", "+", "<NUM_LIT:2>", "*", "n", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "n", ";", "i", "+", "+", ")", "{", "final", "int", "size", "=", "buffer", ".", "getShort", "(", "lengthsPosition", ")", "&", "<NUM_LIT>", ";", "lengthsPosition", "+", "=", "<NUM_LIT:2>", ";", "final", "ByteBuffer", "b1", "=", "Persistables", ".", "slice", "(", "buffer", ",", "size", ")", ";", "setDataBuffer", "(", "i", ",", "b1", ")", ";", "}", "}", "</s>"]
["<s>", "public", "int", "size1", "(", ")", "{", "return", "1", "+", "<NUM_LIT:8>", "+", "1", ";", "}", "</s>"]
["<s>", "public", "void", "write1", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "out", ".", "writeByte", "(", "type", ".", "ordinal", "(", ")", ")", ";", "out", ".", "writeLong", "(", "messageId", ")", ";", "out", ".", "writeByte", "(", "flags", ")", ";", "}", "</s>"]
["<s>", "public", "void", "read1", "(", "DataInput", "in", ")", "throws", "IOException", "{", "messageId", "=", "in", ".", "readLong", "(", ")", ";", "flags", "=", "in", ".", "readByte", "(", ")", ";", "}", "</s>"]
["<s>", "public", "final", "Message", "cloneDataBuffers", "(", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "getNumDataBuffers", "(", ")", ";", "i", "+", "+", ")", "setDataBuffer", "(", "i", ",", "Persistables", ".", "copyOf", "(", "getDataBuffer", "(", "i", ")", ")", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "public", "int", "getNumDataBuffers", "(", ")", "{", "return", "0", ";", "}", "</s>"]
["<s>", "ByteBuffer", "getDataBuffer", "(", "int", "index", ")", "{", "throw", "new", "IndexOutOfBoundsException", "(", ")", ";", "}", "</s>"]
["<s>", "void", "setDataBuffer", "(", "int", "index", ",", "ByteBuffer", "buffer", ")", "{", "throw", "new", "IndexOutOfBoundsException", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "short", "verifyShort", "(", "int", "size", ")", "{", "if", "(", "size", ">", "=", "(", "<NUM_LIT:2>", "<", "<", "<NUM_LIT:16>", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "size", "+", "\"", "<STR_LIT>", "\"", "+", "(", "<NUM_LIT:2>", "<", "<", "<NUM_LIT:16>", ")", ")", ";", "return", "(", "short", ")", "size", ";", "}", "</s>"]
["<s>", "public", "LineMessage", "(", "short", "[", "]", "nodes", ",", "Type", "type", ",", "long", "line", ")", "{", "super", "(", "nodes", ",", "type", ")", ";", "this", ".", "line", "=", "line", ";", "}", "</s>"]
["<s>", "public", "LineMessage", "(", "short", "node", ",", "Type", "type", ",", "long", "line", ")", "{", "super", "(", "node", ",", "type", ")", ";", "this", ".", "line", "=", "line", ";", "}", "</s>"]
["<s>", "public", "LineMessage", "(", "LineMessage", "responseTo", ",", "Type", "type", ")", "{", "this", "(", "responseTo", ",", "type", ",", "responseTo", ".", "getLine", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "LineMessage", "(", "LineMessage", "responseTo", ",", "Type", "type", ",", "long", "line", ")", "{", "super", "(", "responseTo", ",", "type", ")", ";", "assert", "line", "=", "=", "responseTo", ".", "line", ";", "this", ".", "line", "=", "line", ";", "}", "</s>"]
["<s>", "public", "LineMessage", "(", "Type", "type", ")", "{", "super", "(", "type", ")", ";", "this", ".", "line", "=", "-", "1", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "LineMessage", "setMessageId", "(", "long", "messageId", ")", "{", "return", "(", "LineMessage", ")", "super", ".", "setMessageId", "(", "messageId", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "LineMessage", "setIncoming", "(", ")", "{", "return", "(", "LineMessage", ")", "super", ".", "setIncoming", "(", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getLine", "(", ")", "{", "return", "line", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "int", "size1", "(", ")", "{", "return", "super", ".", "size1", "(", ")", "+", "sizeNoHeader", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "write1", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "write1", "(", "out", ")", ";", "writeNoHeader", "(", "out", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "read1", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "read1", "(", "in", ")", ";", "readNoHeader", "(", "in", ")", ";", "}", "</s>"]
["<s>", "int", "sizeNoHeader", "(", ")", "{", "return", "<NUM_LIT:8>", ";", "}", "</s>"]
["<s>", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "out", ".", "writeLong", "(", "line", ")", ";", "}", "</s>"]
["<s>", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "line", "=", "in", ".", "readLong", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "Long", ".", "toHexString", "(", "line", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "LineMessage", "clone", "(", ")", "{", "return", "(", "LineMessage", ")", "super", ".", "clone", "(", ")", ";", "}", "</s>"]
["<s>", "INV", "(", ")", "{", "super", "(", "Type", ".", "INV", ")", ";", "}", "</s>"]
["<s>", "public", "INV", "(", "short", "node", ",", "long", "line", ",", "short", "previousOwner", ")", "{", "super", "(", "node", ",", "Type", ".", "INV", ",", "line", ")", ";", "this", ".", "previousOwner", "=", "previousOwner", ";", "}", "</s>"]
["<s>", "public", "INV", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "previousOwner", ")", "{", "super", "(", "responseTo", ",", "Type", ".", "INV", ",", "line", ")", ";", "this", ".", "previousOwner", "=", "previousOwner", ";", "}", "</s>"]
["<s>", "public", "short", "getPreviousOwner", "(", ")", "{", "return", "previousOwner", ";", "}", "</s>"]
["<s>", "@", "Override", "int", "sizeNoHeader", "(", ")", "{", "return", "super", ".", "sizeNoHeader", "(", ")", "+", "<NUM_LIT:2>", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "writeNoHeader", "(", "out", ")", ";", "out", ".", "writeShort", "(", "previousOwner", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "readNoHeader", "(", "in", ")", ";", "previousOwner", "=", "in", ".", "readShort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "previousOwner", ";", "}", "</s>"]
["<s>", "GET", "(", "Type", "type", ")", "{", "super", "(", "type", ")", ";", "}", "</s>"]
["<s>", "public", "GET", "(", "Type", "type", ",", "short", "node", ",", "long", "line", ")", "{", "super", "(", "node", ",", "type", ",", "line", ")", ";", "assert", "type", "=", "=", "Type", ".", "GET", "|", "|", "type", "=", "=", "Type", ".", "GETX", ";", "}", "</s>"]
["<s>", "PUT", "(", "Type", "type", ")", "{", "super", "(", "type", ")", ";", "}", "</s>"]
["<s>", "public", "PUT", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "responseTo", ",", "Type", ".", "PUT", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "private", "PUT", "(", "Type", "type", ",", "LineMessage", "responseTo", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "responseTo", ",", "type", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "private", "PUT", "(", "Type", "type", ",", "short", "node", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "node", ",", "type", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "private", "PUT", "(", "Type", "type", ",", "short", "[", "]", "nodes", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "nodes", ",", "type", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "public", "PUT", "(", "short", "node", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "node", ",", "Type", ".", "PUT", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "public", "PUT", "(", "short", "[", "]", "nodes", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "nodes", ",", "Type", ".", "PUT", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "public", "long", "getVersion", "(", ")", "{", "return", "version", ";", "}", "</s>"]
["<s>", "public", "ByteBuffer", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "public", "void", "setData", "(", "ByteBuffer", "data", ")", "{", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumDataBuffers", "(", ")", "{", "return", "1", ";", "}", "</s>"]
["<s>", "@", "Override", "ByteBuffer", "getDataBuffer", "(", "int", "index", ")", "{", "if", "(", "index", "!", "=", "0", ")", "throw", "new", "IndexOutOfBoundsException", "(", ")", ";", "return", "getData", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "setDataBuffer", "(", "int", "index", ",", "ByteBuffer", "buffer", ")", "{", "if", "(", "index", "!", "=", "0", ")", "throw", "new", "IndexOutOfBoundsException", "(", ")", ";", "setData", "(", "buffer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "int", "sizeNoHeader", "(", ")", "{", "return", "super", ".", "sizeNoHeader", "(", ")", "+", "<NUM_LIT:8>", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "writeNoHeader", "(", "out", ")", ";", "out", ".", "writeLong", "(", "version", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "readNoHeader", "(", "in", ")", ";", "version", "=", "in", ".", "readLong", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "version", "+", "\"", "<STR_LIT>", "\"", "+", "(", "data", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT:(>", "\"", "+", "data", ".", "limit", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "PUT", "clone", "(", ")", "{", "final", "PUT", "clone", "=", "(", "PUT", ")", "super", ".", "clone", "(", ")", ";", "clone", ".", "data", "=", "data", "!", "=", "null", "?", "Persistables", ".", "copyOf", "(", "data", ")", ":", "null", ";", "return", "clone", ";", "}", "</s>"]
["<s>", "PUTX", "(", ")", "{", "super", "(", "Type", ".", "PUTX", ")", ";", "}", "</s>"]
["<s>", "public", "PUTX", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "[", "]", "sharers", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "Type", ".", "PUTX", ",", "responseTo", ",", "line", ",", "version", ",", "data", ")", ";", "this", ".", "sharers", "=", "sharers", ";", "}", "</s>"]
["<s>", "public", "PUTX", "(", "short", "node", ",", "long", "line", ",", "short", "[", "]", "sharers", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "Type", ".", "PUTX", ",", "node", ",", "line", ",", "version", ",", "data", ")", ";", "this", ".", "sharers", "=", "sharers", ";", "}", "</s>"]
["<s>", "public", "short", "[", "]", "getSharers", "(", ")", "{", "return", "sharers", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "sizeNoHeader", "(", ")", "{", "return", "super", ".", "sizeNoHeader", "(", ")", "+", "<NUM_LIT:2>", "+", "<NUM_LIT:2>", "*", "sharers", ".", "length", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "writeNoHeader", "(", "out", ")", ";", "out", ".", "writeShort", "(", "sharers", ".", "length", ")", ";", "for", "(", "short", "s", ":", "sharers", ")", "out", ".", "writeShort", "(", "s", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "readNoHeader", "(", "in", ")", ";", "int", "numSharers", "=", "in", ".", "readUnsignedShort", "(", ")", ";", "sharers", "=", "new", "short", "[", "numSharers", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numSharers", ";", "i", "+", "+", ")", "sharers", "[", "i", "]", "=", "in", ".", "readShort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "sharers", ")", ";", "}", "</s>"]
["<s>", "public", "CHNGD_OWNR", "(", ")", "{", "super", "(", "Type", ".", "CHNGD_OWNR", ")", ";", "}", "</s>"]
["<s>", "public", "CHNGD_OWNR", "(", "short", "node", ",", "long", "line", ",", "short", "newOwner", ",", "boolean", "certain", ")", "{", "super", "(", "node", ",", "Type", ".", "CHNGD_OWNR", ",", "line", ")", ";", "this", ".", "newOwner", "=", "newOwner", ";", "this", ".", "certain", "=", "certain", ";", "}", "</s>"]
["<s>", "public", "CHNGD_OWNR", "(", "LineMessage", "responseTo", ",", "long", "line", ",", "short", "newOwner", ",", "boolean", "certain", ")", "{", "super", "(", "responseTo", ",", "Type", ".", "CHNGD_OWNR", ",", "line", ")", ";", "this", ".", "newOwner", "=", "newOwner", ";", "this", ".", "certain", "=", "certain", ";", "}", "</s>"]
["<s>", "public", "short", "getNewOwner", "(", ")", "{", "return", "newOwner", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "sizeNoHeader", "(", ")", "{", "return", "super", ".", "sizeNoHeader", "(", ")", "+", "1", "+", "<NUM_LIT:2>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "writeNoHeader", "(", "out", ")", ";", "out", ".", "writeBoolean", "(", "certain", ")", ";", "out", ".", "writeShort", "(", "newOwner", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "readNoHeader", "(", "in", ")", ";", "certain", "=", "in", ".", "readBoolean", "(", ")", ";", "newOwner", "=", "in", ".", "readShort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "newOwner", "+", "\"", "<STR_LIT>", "\"", "+", "certain", ";", "}", "</s>"]
["<s>", "public", "BACKUP", "(", ")", "{", "super", "(", "Type", ".", "BACKUP", ")", ";", "}", "</s>"]
["<s>", "public", "BACKUP", "(", "short", "node", ",", "long", "line", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "super", "(", "Type", ".", "BACKUP", ",", "node", ",", "line", ",", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "BACKUPACK", "(", ")", "{", "super", "(", "Type", ".", "BACKUPACK", ")", ";", "}", "</s>"]
["<s>", "public", "BACKUPACK", "(", "short", "node", ",", "long", "line", ",", "long", "version", ")", "{", "super", "(", "node", ",", "Type", ".", "BACKUPACK", ",", "line", ")", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "public", "long", "getVersion", "(", ")", "{", "return", "version", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "sizeNoHeader", "(", ")", "{", "return", "super", ".", "sizeNoHeader", "(", ")", "+", "<NUM_LIT:8>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "writeNoHeader", "(", "out", ")", ";", "out", ".", "writeLong", "(", "version", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "readNoHeader", "(", "in", ")", ";", "version", "=", "in", ".", "readLong", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "version", ";", "}", "</s>"]
["<s>", "public", "BACKUP_PACKET", "(", "long", "id", ",", "Collection", "<", "BACKUP", ">", "backups", ")", "{", "super", "(", "(", "short", ")", "0", ",", "Type", ".", "BACKUP_PACKET", ")", ";", "this", ".", "backups", "=", "ImmutableList", ".", "copyOf", "(", "backups", ")", ";", "this", ".", "id", "=", "id", ";", "}", "</s>"]
["<s>", "public", "BACKUP_PACKET", "(", ")", "{", "super", "(", "Type", ".", "BACKUP_PACKET", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "BACKUP", ">", "getBackups", "(", ")", "{", "return", "backups", ";", "}", "</s>"]
["<s>", "public", "long", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumDataBuffers", "(", ")", "{", "return", "backups", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "ByteBuffer", "getDataBuffer", "(", "int", "index", ")", "{", "return", "backups", ".", "get", "(", "index", ")", ".", "getData", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "void", "setDataBuffer", "(", "int", "index", ",", "ByteBuffer", "buffer", ")", "{", "backups", ".", "get", "(", "index", ")", ".", "setData", "(", "buffer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Message", "setNode", "(", "short", "node", ")", "{", "super", ".", "setNode", "(", "node", ")", ";", "for", "(", "BACKUP", "msg", ":", "backups", ")", "msg", ".", "setNode", "(", "node", ")", ";", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size1", "(", ")", "{", "int", "size", "=", "super", ".", "size1", "(", ")", "+", "<NUM_LIT:8>", "+", "<NUM_LIT:4>", ";", "for", "(", "BACKUP", "msg", ":", "backups", ")", "size", "+", "=", "msg", ".", "sizeNoHeader", "(", ")", ";", "return", "size", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write1", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "write1", "(", "out", ")", ";", "out", ".", "writeLong", "(", "id", ")", ";", "out", ".", "writeInt", "(", "backups", ".", "size", "(", ")", ")", ";", "for", "(", "BACKUP", "msg", ":", "backups", ")", "msg", ".", "writeNoHeader", "(", "out", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read1", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "read1", "(", "in", ")", ";", "id", "=", "in", ".", "readLong", "(", ")", ";", "final", "int", "num", "=", "in", ".", "readInt", "(", ")", ";", "this", ".", "backups", "=", "new", "ArrayList", "<", "BACKUP", ">", "(", "num", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "num", ";", "i", "+", "+", ")", "{", "BACKUP", "backup", "=", "new", "BACKUP", "(", ")", ";", "backup", ".", "readNoHeader", "(", "in", ")", ";", "backups", ".", "add", "(", "backup", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", "+", "backups", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "BACKUP_PACKETACK", "(", "BACKUP_PACKET", "responseTo", ")", "{", "super", "(", "responseTo", ",", "Type", ".", "BACKUP_PACKETACK", ")", ";", "this", ".", "id", "=", "responseTo", ".", "getId", "(", ")", ";", "}", "</s>"]
["<s>", "public", "BACKUP_PACKETACK", "(", ")", "{", "super", "(", "Type", ".", "BACKUP_PACKETACK", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size1", "(", ")", "{", "return", "super", ".", "size1", "(", ")", "+", "<NUM_LIT:8>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write1", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "write1", "(", "out", ")", ";", "out", ".", "writeLong", "(", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read1", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "read1", "(", "in", ")", ";", "id", "=", "in", ".", "readLong", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "id", ";", "}", "</s>"]
["<s>", "MSG", "(", ")", "{", "super", "(", "Type", ".", "MSG", ")", ";", "}", "</s>"]
["<s>", "public", "MSG", "(", "MSG", "responseTo", ",", "byte", "[", "]", "data", ")", "{", "super", "(", "responseTo", ",", "Type", ".", "MSG", ")", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "private", "MSG", "(", "short", "node", ",", "long", "line", ",", "byte", "[", "]", "data", ")", "{", "super", "(", "node", ",", "Type", ".", "MSG", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "private", "MSG", "(", "short", "[", "]", "nodes", ",", "long", "line", ",", "byte", "[", "]", "data", ")", "{", "super", "(", "nodes", ",", "Type", ".", "MSG", ",", "line", ")", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "public", "void", "setData", "(", "byte", "[", "]", "data", ")", "{", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "sizeNoHeader", "(", ")", "{", "return", "super", ".", "sizeNoHeader", "(", ")", "+", "<NUM_LIT:2>", "+", "(", "data", "!", "=", "null", "?", "data", ".", "length", ":", "0", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeNoHeader", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "super", ".", "writeNoHeader", "(", "out", ")", ";", "out", ".", "writeShort", "(", "data", "!", "=", "null", "?", "(", "short", ")", "data", ".", "length", ":", "0", ")", ";", "if", "(", "data", "!", "=", "null", ")", "out", ".", "write", "(", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readNoHeader", "(", "DataInput", "in", ")", "throws", "IOException", "{", "super", ".", "readNoHeader", "(", "in", ")", ";", "final", "int", "dataLen", "=", "in", ".", "readUnsignedShort", "(", ")", ";", "if", "(", "dataLen", "=", "=", "0", ")", "data", "=", "null", ";", "else", "{", "data", "=", "new", "byte", "[", "dataLen", "]", ";", "in", ".", "readFully", "(", "data", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "partialToString", "(", ")", "{", "return", "super", ".", "partialToString", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "(", "data", "=", "=", "null", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT:(>", "\"", "+", "data", ".", "length", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "StoreImpl", "(", "Cache", "cache", ")", "{", "this", ".", "cache", "=", "cache", ";", "this", ".", "rootManager", "=", "new", "StringRootManager", "(", "this", ",", "cache", ".", "getCluster", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaxItemSize", "(", ")", "{", "return", "cache", ".", "getMaxItemSize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "StoreTransaction", "beginTransaction", "(", ")", "{", "return", "cache", ".", "beginTransaction", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "commit", "(", "StoreTransaction", "txn", ")", "throws", "InterruptedException", "{", "cache", ".", "endTransaction", "(", "(", "Transaction", ")", "txn", ",", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "abort", "(", "StoreTransaction", "txn", ")", "{", "try", "{", "cache", ".", "endTransaction", "(", "(", "Transaction", ")", "txn", ",", "true", ")", ";", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "rollback", "(", "StoreTransaction", "txn", ")", "{", "cache", ".", "rollback", "(", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "release", "(", "long", "id", ")", "{", "cache", ".", "release", "(", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getRoot", "(", "String", "root", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "rootManager", ".", "get", "(", "root", ",", "(", "Transaction", ")", "verifyNonNull", "(", "txn", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isRootCreated", "(", "long", "rootId", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "(", "Transaction", ")", "txn", ")", ".", "contains", "(", "rootId", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "alloc", "(", "int", "count", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "Long", ")", "cache", ".", "doOp", "(", "ALLOC", ",", "-", "<NUM_LIT>", ",", "null", ",", "count", ",", "(", "Transaction", ")", "verifyNonNull", "(", "txn", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "put", "(", "byte", "[", "]", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "Long", ")", "cache", ".", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "copyOf", "(", "data", ")", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "put", "(", "ByteBuffer", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "Long", ")", "cache", ".", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "data", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "put", "(", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "Long", ")", "cache", ".", "doOp", "(", "PUT", ",", "-", "<NUM_LIT>", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "get", "(", "long", "id", ")", "throws", "TimeoutException", "{", "return", "get", "(", "GET", ",", "id", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "get", "(", "long", "id", ",", "short", "nodeHint", ")", "throws", "TimeoutException", "{", "return", "get", "(", "GET", ",", "id", ",", "nodeHint", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getFromOwner", "(", "long", "id", ",", "long", "ownerOf", ")", "throws", "TimeoutException", "{", "return", "getFromOwner", "(", "GET", ",", "id", ",", "ownerOf", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "get", "(", "long", "id", ",", "Persistable", "object", ")", "throws", "TimeoutException", "{", "get", "(", "GET", ",", "id", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "get", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ")", "throws", "TimeoutException", "{", "get", "(", "GET", ",", "id", ",", "nodeHint", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ")", "throws", "TimeoutException", "{", "getFromOwner", "(", "GET", ",", "id", ",", "ownerOf", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "gets", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "get", "(", "GETS", ",", "id", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "gets", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "get", "(", "GETS", ",", "id", ",", "nodeHint", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getsFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "getFromOwner", "(", "GETS", ",", "id", ",", "ownerOf", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "gets", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "get", "(", "GETS", ",", "id", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "gets", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "get", "(", "GETS", ",", "id", ",", "nodeHint", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getsFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "getFromOwner", "(", "GETS", ",", "id", ",", "ownerOf", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getx", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "get", "(", "GETX", ",", "id", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getx", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "get", "(", "GETX", ",", "id", ",", "nodeHint", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getxFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "getFromOwner", "(", "GETX", ",", "id", ",", "ownerOf", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getx", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "get", "(", "GETX", ",", "id", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getx", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "get", "(", "GETX", ",", "id", ",", "nodeHint", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getxFromOwner", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "getFromOwner", "(", "GETX", ",", "id", ",", "ownerOf", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "long", "id", ",", "byte", "[", "]", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "SET", ",", "nonReserved", "(", "id", ")", ",", "copyOf", "(", "data", ")", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "long", "id", ",", "ByteBuffer", "data", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "SET", ",", "nonReserved", "(", "id", ")", ",", "data", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "SET", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "del", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "DEL", ",", "nonReserved", "(", "id", ")", ",", "null", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getAsync", "(", "long", "id", ")", "{", "return", "getAsync", "(", "GET", ",", "id", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getAsync", "(", "long", "id", ",", "short", "nodeHint", ")", "{", "return", "getAsync", "(", "GET", ",", "id", ",", "nodeHint", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ")", "{", "return", "getFromOwnerAsync", "(", "GET", ",", "id", ",", "ownerOf", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getAsync", "(", "long", "id", ",", "Persistable", "object", ")", "{", "return", "getAsync", "(", "GET", ",", "id", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ")", "{", "return", "getAsync", "(", "GET", ",", "id", ",", "nodeHint", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ")", "{", "return", "getFromOwnerAsync", "(", "GET", ",", "id", ",", "ownerOf", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getsAsync", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETS", ",", "id", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getsAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETS", ",", "id", ",", "nodeHint", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getsFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "{", "return", "getFromOwnerAsync", "(", "GETS", ",", "id", ",", "ownerOf", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getsAsync", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETS", ",", "id", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getsAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETS", ",", "id", ",", "nodeHint", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getsFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "getFromOwnerAsync", "(", "GETS", ",", "id", ",", "ownerOf", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getxAsync", "(", "long", "id", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETX", ",", "id", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getxAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETX", ",", "id", ",", "nodeHint", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "byte", "[", "]", ">", "getxFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "{", "return", "getFromOwnerAsync", "(", "GETX", ",", "id", ",", "ownerOf", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getxAsync", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETX", ",", "id", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getxAsync", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "getAsync", "(", "GETX", ",", "id", ",", "nodeHint", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Persistable", ">", "getxFromOwnerAsync", "(", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "getFromOwnerAsync", "(", "GETX", ",", "id", ",", "ownerOf", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Void", ">", "setAsync", "(", "long", "id", ",", "byte", "[", "]", "data", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "Void", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "SET", ",", "nonReserved", "(", "id", ")", ",", "copyOf", "(", "data", ")", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Void", ">", "setAsync", "(", "long", "id", ",", "ByteBuffer", "data", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "Void", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "SET", ",", "nonReserved", "(", "id", ")", ",", "data", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ListenableFuture", "<", "Void", ">", "setAsync", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "Void", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "SET", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setListener", "(", "long", "id", ",", "CacheListener", "listener", ")", "{", "try", "{", "cache", ".", "doOp", "(", "LSTN", ",", "id", ",", "null", ",", "listener", ",", "null", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "throw", "new", "AssertionError", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "push", "(", "long", "id", ",", "short", ".", ".", ".", "toNodes", ")", "{", "try", "{", "cache", ".", "doOp", "(", "PUSH", ",", "id", ",", "null", ",", "toNodes", ",", "null", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "pushx", "(", "long", "id", ",", "short", "toNode", ")", "{", "try", "{", "cache", ".", "doOp", "(", "PUSHX", ",", "id", ",", "null", ",", "toNode", ",", "null", ")", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isPinned", "(", "long", "id", ")", "{", "return", "cache", ".", "isLocked", "(", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ItemState", "getState", "(", "long", "id", ")", "{", "final", "Cache", ".", "State", "state", "=", "cache", ".", "getState", "(", "id", ")", ";", "if", "(", "state", "=", "=", "null", ")", "return", "ItemState", ".", "INVALID", ";", "else", "{", "switch", "(", "state", ")", "{", "case", "I", ":", "return", "ItemState", ".", "INVALID", ";", "case", "S", ":", "return", "ItemState", ".", "SHARED", ";", "case", "O", ":", "case", "E", ":", "return", "ItemState", ".", "OWNED", ";", "}", "throw", "new", "AssertionError", "(", ")", ";", "}", "}", "</s>"]
["<s>", "void", "get1", "(", "long", "id", ",", "Persistable", "object", ")", "throws", "TimeoutException", "{", "get1", "(", "GET", ",", "id", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "void", "get1", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ")", "throws", "TimeoutException", "{", "get1", "(", "GET", ",", "id", ",", "nodeHint", ",", "object", ",", "null", ")", ";", "}", "</s>"]
["<s>", "void", "getx1", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "get1", "(", "GETX", ",", "id", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "void", "getx1", "(", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "get1", "(", "GETX", ",", "id", ",", "nodeHint", ",", "object", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "void", "set1", "(", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "SET", ",", "id", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "static", "StoreTransaction", "verifyNonNull", "(", "StoreTransaction", "txn", ")", "{", "if", "(", "txn", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "txn", ";", "}", "</s>"]
["<s>", "private", "static", "byte", "[", "]", "copyOf", "(", "byte", "[", "]", "array", ")", "{", "return", "array", "=", "=", "null", "?", "null", ":", "Arrays", ".", "copyOf", "(", "array", ",", "array", ".", "length", ")", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "get", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "byte", "[", "]", ")", "cache", ".", "doOp", "(", "type", ",", "id", ",", "null", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "void", "get", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "get", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "byte", "[", "]", ")", "cache", ".", "doOp", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "null", ",", "nodeHint", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "void", "get", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "nodeHint", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "getFromOwner", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "return", "(", "byte", "[", "]", ")", "cache", ".", "doOp", "(", "GET_FROM_OWNER", ",", "nonReserved", "(", "ownerOf", ")", ",", "null", ",", "new", "Op", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "(", "Transaction", ")", "txn", ")", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "void", "getFromOwner", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "GET_FROM_OWNER", ",", "nonReserved", "(", "ownerOf", ")", ",", "null", ",", "new", "Op", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "(", "Transaction", ")", "txn", ")", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "byte", "[", "]", ">", "getAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "byte", "[", "]", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "type", ",", "id", ",", "null", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "Persistable", ">", "getAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "Persistable", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "byte", "[", "]", ">", "getAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "short", "nodeHint", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "byte", "[", "]", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "null", ",", "nodeHint", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "Persistable", ">", "getAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "Persistable", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "nodeHint", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "byte", "[", "]", ">", "getFromOwnerAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "long", "ownerOf", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "byte", "[", "]", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "GET_FROM_OWNER", ",", "nonReserved", "(", "ownerOf", ")", ",", "null", ",", "new", "Op", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "(", "Transaction", ")", "txn", ")", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "Persistable", ">", "getFromOwnerAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "long", "ownerOf", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "{", "return", "(", "ListenableFuture", "<", "Persistable", ">", ")", "(", "Object", ")", "cache", ".", "doOpAsync", "(", "GET_FROM_OWNER", ",", "nonReserved", "(", "ownerOf", ")", ",", "null", ",", "new", "Op", "(", "type", ",", "nonReserved", "(", "id", ")", ",", "object", ",", "(", "Transaction", ")", "txn", ")", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "long", "nonReserved", "(", "long", "id", ")", "{", "if", "(", "id", "<", "=", "Cache", ".", "MAX_RESERVED_REF_ID", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "id", ")", ";", "else", "return", "id", ";", "}", "</s>"]
["<s>", "private", "void", "get1", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "type", ",", "id", ",", "object", ",", "null", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "private", "void", "get1", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "short", "nodeHint", ",", "Persistable", "object", ",", "StoreTransaction", "txn", ")", "throws", "TimeoutException", "{", "cache", ".", "doOp", "(", "type", ",", "id", ",", "object", ",", "nodeHint", ",", "(", "Transaction", ")", "txn", ")", ";", "}", "</s>"]
["<s>", "short", "getNode", "(", ")", ";", "</s>"]
["<s>", "public", "NodeNotFoundException", "(", "short", "node", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "node", "=", "node", ";", "}", "</s>"]
["<s>", "public", "short", "getNode", "(", ")", "{", "return", "node", ";", "}", "</s>"]
["<s>", "public", "JMXBackupMonitor", "(", "String", "name", ")", "{", "super", "(", "BackupMXBean", ".", "class", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "collectAndResetCounters", "(", ")", "{", "replicationBackups", "=", "(", "int", ")", "replicationBackupsCounter", ".", "get", "(", ")", ";", "backupPackets", "=", "(", "int", ")", "backupPacketsCounter", ".", "get", "(", ")", ";", "backups", "=", "(", "int", ")", "backupsCounter", ".", "get", "(", ")", ";", "final", "long", "microsSinceLastCollect", "=", "TimeUnit", ".", "MICROSECONDS", ".", "convert", "(", "getMillisSinceLastCollect", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "avgSlavesAckTimeMicros", "=", "slavesAckTimeCounter", ".", "get", "(", ")", "/", "microsSinceLastCollect", ";", "avgServerAckTimeMicros", "=", "serverAckTimeCounter", ".", "get", "(", ")", "/", "microsSinceLastCollect", ";", "resetCounters", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "resetCounters", "(", ")", "{", "replicationBackupsCounter", ".", "reset", "(", ")", ";", "backupsCounter", ".", "reset", "(", ")", ";", "backupPacketsCounter", ".", "reset", "(", ")", ";", "slavesAckTimeCounter", ".", "reset", "(", ")", ";", "serverAckTimeCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addReplicationBackup", "(", "int", "num", ")", "{", "replicationBackupsCounter", ".", "add", "(", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addBackups", "(", "int", "num", ")", "{", "backupsCounter", ".", "add", "(", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addBackupPacket", "(", ")", "{", "backupPacketsCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addSlaveAckTime", "(", "long", "nanos", ")", "{", "slavesAckTimeCounter", ".", "add", "(", "TimeUnit", ".", "MICROSECONDS", ".", "convert", "(", "nanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addServerAckTime", "(", "long", "nanos", ")", "{", "serverAckTimeCounter", ".", "add", "(", "TimeUnit", ".", "MICROSECONDS", ".", "convert", "(", "nanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getAvgServerAckTimeMicros", "(", ")", "{", "return", "avgServerAckTimeMicros", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getAvgSlavesAckTimeMicros", "(", ")", "{", "return", "avgSlavesAckTimeMicros", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getBackups", "(", ")", "{", "return", "backups", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getBackupPackets", "(", ")", "{", "return", "backupPackets", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getReplicationBackups", "(", ")", "{", "return", "replicationBackups", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "OffHeapLocalStorage", "(", "String", "name", ",", "int", "pageSize", ",", "int", "maxItemSize", ",", "MonitoringType", "monitoringType", ")", "{", "super", "(", "name", ")", ";", "this", ".", "pageSize", "=", "pageSize", ";", "this", ".", "maxItemSize", "=", "nextPowerOfTwo", "(", "maxItemSize", ")", ";", "int", "numGroups", "=", "0", ";", "int", "tmpSize", "=", "1", "<", "<", "MIN_POWER", ";", "while", "(", "tmpSize", "<", "=", "maxItemSize", ")", "{", "numGroups", "+", "+", ";", "tmpSize", "<", "<", "=", "1", ";", "}", "int", "[", "]", "sizes", "=", "new", "int", "[", "numGroups", "]", ";", "this", ".", "pageGroups", "=", "new", "PageGroup", "[", "numGroups", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "pageGroups", ".", "length", ";", "i", "+", "+", ")", "{", "final", "int", "size", "=", "1", "<", "<", "(", "MIN_POWER", "+", "i", ")", ";", "pageGroups", "[", "i", "]", "=", "new", "PageGroup", "(", "i", ",", "size", ")", ";", "sizes", "[", "i", "]", "=", "size", ";", "}", "this", ".", "monitor", "=", "createMonitor", "(", "monitoringType", ",", "name", ",", "sizes", ")", ";", "}", "</s>"]
["<s>", "private", "OffHeapLocalStorageMonitor", "createMonitor", "(", "MonitoringType", "monitoringType", ",", "String", "name", ",", "int", "[", "]", "sizes", ")", "{", "if", "(", "monitoringType", "=", "=", "null", ")", "return", "(", "OffHeapLocalStorageMonitor", ")", "Proxy", ".", "newProxyInstance", "(", "OffHeapLocalStorage", ".", "class", ".", "getClassLoader", "(", ")", ",", "new", "Class", "<", "?", ">", "[", "]", "{", "OffHeapLocalStorageMonitor", ".", "class", "}", ",", "DegenerateInvocationHandler", ".", "INSTANCE", ")", ";", "else", "switch", "(", "monitoringType", ")", "{", "case", "JMX", ":", "return", "new", "JMXOffHeapLocalStorageMonitor", "(", "name", ",", "this", ",", "sizes", ")", ";", "case", "METRICS", ":", "return", "new", "MetricsOffHeapLocalStorageMonitor", "(", "name", ",", "this", ",", "sizes", ")", ";", "}", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "monitoringType", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxPagesForConcurrency", "(", "int", "maxPagesForConcurrency", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxPagesForConcurrency", "=", "maxPagesForConcurrency", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ByteBuffer", "allocateStorage", "(", "int", "size", ")", "{", "if", "(", "size", "=", "=", "0", ")", "return", "EMPTY_BUFFER", ";", "if", "(", "size", ">", "maxItemSize", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "size", "+", "\"", "<STR_LIT>", "\"", "+", "maxItemSize", ")", ";", "final", "int", "bin", "=", "getSizeIndex", "(", "size", ")", ";", "size", "=", "pageGroups", "[", "bin", "]", ".", "cellSize", ";", "monitor", ".", "allocated", "(", "bin", ",", "size", ")", ";", "totalSize", ".", "addAndGet", "(", "size", ")", ";", "final", "ByteBuffer", "buffer", "=", "pageGroups", "[", "bin", "]", ".", "allocate", "(", ")", ";", "buffer", ".", "position", "(", "0", ")", ";", "return", "buffer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "deallocateStorage", "(", "long", "id", ",", "ByteBuffer", "buffer", ")", "{", "if", "(", "buffer", "=", "=", "EMPTY_BUFFER", ")", "return", ";", "final", "Page", "page", "=", "getPage", "(", "buffer", ")", ";", "monitor", ".", "deallocated", "(", "page", ".", "getGroup", "(", ")", ".", "groupIndex", ",", "buffer", ".", "limit", "(", ")", ")", ";", "totalSize", ".", "addAndGet", "(", "-", "buffer", ".", "limit", "(", ")", ")", ";", "page", ".", "deallocate", "(", "buffer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTotalAllocatedSize", "(", ")", "{", "return", "totalSize", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "PageGroup", "(", "int", "index", ",", "int", "cellSize", ")", "{", "this", ".", "groupIndex", "=", "index", ";", "this", ".", "cellSize", "=", "cellSize", ";", "}", "</s>"]
["<s>", "ByteBuffer", "allocate", "(", ")", "{", "final", "int", "threadHash", "=", "Thread", ".", "currentThread", "(", ")", ".", "hashCode", "(", ")", ";", "ByteBuffer", "buffer", "=", "null", ";", "if", "(", "numPages", ">", "0", ")", "buffer", "=", "allocate", "(", "threadHash", "%", "numPages", ")", ";", "if", "(", "buffer", "=", "=", "null", ")", "{", "allocationLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "numPages", ">", "0", ")", "buffer", "=", "allocate", "(", "threadHash", "%", "numPages", ")", ";", "if", "(", "buffer", "=", "=", "null", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "pageSize", "*", "<NUM_LIT>", ",", "totalSize", ".", "get", "(", ")", ")", ";", "Page", "newPage", "=", "new", "Page", "(", "this", ",", "pageSize", ",", "cellSize", ",", "MIN_POWER", "+", "groupIndex", ")", ";", "buffer", "=", "newPage", ".", "allocate", "(", "true", ")", ";", "pages", ".", "add", "(", "newPage", ")", ";", "numPages", "+", "+", ";", "}", "}", "finally", "{", "allocationLock", ".", "unlock", "(", ")", ";", "}", "}", "assert", "buffer", "!", "=", "null", ";", "return", "buffer", ";", "}", "</s>"]
["<s>", "private", "ByteBuffer", "allocate", "(", "int", "start", ")", "{", "final", "int", "_numPages", "=", "numPages", ";", "boolean", "canGrowForConcurrency", "=", "_numPages", "<", "maxPagesForConcurrency", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "_numPages", ";", "i", "+", "+", ")", "{", "final", "Page", "page", "=", "pages", ".", "get", "(", "(", "start", "+", "i", ")", "%", "_numPages", ")", ";", "final", "ByteBuffer", "buffer", "=", "page", ".", "allocate", "(", "!", "canGrowForConcurrency", ")", ";", "if", "(", "buffer", "!", "=", "null", ")", "return", "buffer", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "Page", "(", "PageGroup", "group", ",", "int", "bufferKbSize", ",", "int", "cellSize", ",", "int", "power", ")", "{", "this", ".", "group", "=", "group", ";", "buffer", "=", "ByteBuffer", ".", "allocateDirect", "(", "bufferKbSize", "*", "<NUM_LIT>", ")", ";", "buffer", ".", "order", "(", "ByteOrder", ".", "nativeOrder", "(", ")", ")", ";", "setViewed", "(", "buffer", ",", "this", ")", ";", "this", ".", "cellSize", "=", "cellSize", ";", "this", ".", "freeCells", "=", "(", "bufferKbSize", "*", "<NUM_LIT>", ")", ">", ">", "power", ";", "int", "prev", "=", "-", "1", ";", "for", "(", "int", "i", "=", "freeCells", "-", "1", ";", "i", ">", "=", "0", ";", "i", "-", "-", ")", "{", "final", "int", "ptr", "=", "i", "<", "<", "power", ";", "buffer", ".", "putInt", "(", "ptr", ",", "prev", ")", ";", "prev", "=", "ptr", ";", "}", "this", ".", "head", "=", "0", ";", "}", "</s>"]
["<s>", "public", "PageGroup", "getGroup", "(", ")", "{", "return", "group", ";", "}", "</s>"]
["<s>", "ByteBuffer", "allocate", "(", "boolean", "doIt", ")", "{", "if", "(", "doIt", ")", "lock", ".", "lock", "(", ")", ";", "else", "if", "(", "!", "lock", ".", "tryLock", "(", ")", ")", "return", "null", ";", "final", "int", "ptr", ";", "final", "ByteBuffer", "slice", ";", "try", "{", "ptr", "=", "head", ";", "if", "(", "ptr", "=", "=", "-", "1", ")", "{", "assert", "freeCells", "=", "=", "0", ";", "return", "null", ";", "}", "head", "=", "buffer", ".", "getInt", "(", "ptr", ")", ";", "freeCells", "-", "-", ";", "slice", "=", "slice", "(", "buffer", ",", "ptr", ",", "cellSize", ")", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "slice", ".", "putInt", "(", "0", ",", "0", ")", ";", "return", "slice", ";", "}", "</s>"]
["<s>", "void", "deallocate", "(", "ByteBuffer", "slice", ")", "{", "assert", "getPage", "(", "slice", ")", "=", "=", "this", ";", "final", "int", "ptr", "=", "getOffset", "(", "slice", ")", ";", "lock", ".", "lock", "(", ")", ";", "try", "{", "buffer", ".", "putInt", "(", "ptr", ",", "head", ")", ";", "head", "=", "ptr", ";", "freeCells", "+", "+", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "int", "getSizeIndex", "(", "int", "size", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "pageGroups", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "size", "<", "=", "pageGroups", "[", "i", "]", ".", "cellSize", ")", "return", "i", ";", "}", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "size", "+", "\"", "<STR_LIT>", "\"", "+", "pageGroups", "[", "pageGroups", ".", "length", "-", "1", "]", ".", "cellSize", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "nextPowerOfTwo", "(", "int", "v", ")", "{", "assert", "v", ">", "=", "0", ";", "v", "-", "-", ";", "v", "|", "=", "v", ">", ">", "1", ";", "v", "|", "=", "v", ">", ">", "<NUM_LIT:2>", ";", "v", "|", "=", "v", ">", ">", "<NUM_LIT:4>", ";", "v", "|", "=", "v", ">", ">", "<NUM_LIT:8>", ";", "v", "|", "=", "v", ">", ">", "<NUM_LIT:16>", ";", "v", "+", "+", ";", "return", "v", ";", "}", "</s>"]
["<s>", "private", "static", "ByteBuffer", "slice", "(", "ByteBuffer", "buffer", ",", "int", "start", ",", "int", "length", ")", "{", "buffer", ".", "limit", "(", "start", "+", "length", ")", ";", "buffer", ".", "position", "(", "start", ")", ";", "final", "ByteBuffer", "slice", "=", "buffer", ".", "slice", "(", ")", ";", "buffer", ".", "clear", "(", ")", ";", "return", "slice", ";", "}", "</s>"]
["<s>", "private", "static", "Page", "getPage", "(", "ByteBuffer", "buffer", ")", "{", "return", "(", "Page", ")", "getViewed", "(", "(", "ByteBuffer", ")", "getViewed", "(", "buffer", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "Object", "getViewed", "(", "ByteBuffer", "buffer", ")", "{", "return", "(", "(", "sun", ".", "nio", ".", "ch", ".", "DirectBuffer", ")", "buffer", ")", ".", "attachment", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "getOffset", "(", "ByteBuffer", "slice", ")", "{", "final", "sun", ".", "nio", ".", "ch", ".", "DirectBuffer", "_slice", "=", "(", "sun", ".", "nio", ".", "ch", ".", "DirectBuffer", ")", "slice", ";", "final", "sun", ".", "nio", ".", "ch", ".", "DirectBuffer", "parent", "=", "(", "sun", ".", "nio", ".", "ch", ".", "DirectBuffer", ")", "_slice", ".", "attachment", "(", ")", ";", "return", "(", "int", ")", "(", "_slice", ".", "address", "(", ")", "-", "parent", ".", "address", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "void", "setViewed", "(", "ByteBuffer", "buffer", ",", "Object", "object", ")", "{", "try", "{", "VIEWD_BUFFER_FIELD", ".", "set", "(", "buffer", ",", "object", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "boolean", "setCounter", "(", "long", "id", ")", ";", "</s>"]
["<s>", "void", "allocateRefs", "(", "int", "count", ")", ";", "</s>"]
["<s>", "void", "addRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", ";", "</s>"]
["<s>", "void", "removeRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", ";", "</s>"]
["<s>", "void", "counterReady", "(", ")", ";", "</s>"]
["<s>", "void", "refsAllocated", "(", "long", "start", ",", "int", "num", ")", ";", "</s>"]
["<s>", "public", "boolean", "isOf", "(", "long", "set", ")", "{", "return", "Enums", ".", "isIn", "(", "this", ",", "set", ")", ";", "}", "</s>"]
["<s>", "Op", "(", "Type", "type", ",", "long", "line", ",", "Object", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "this", ".", "type", "=", "type", ";", "this", ".", "line", "=", "line", ";", "if", "(", "data", "!", "=", "null", "&", "&", "data", "instanceof", "byte", "[", "]", ")", "data", "=", "Arrays", ".", "copyOf", "(", "(", "(", "byte", "[", "]", ")", "data", ")", ",", "(", "(", "byte", "[", "]", ")", "data", ")", ".", "length", ")", ";", "this", ".", "data", "=", "data", ";", "this", ".", "txn", "=", "txn", ";", "this", ".", "extra", "=", "extra", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "byte", "[", "]", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "ByteBuffer", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "Persistable", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "(", "Object", ")", "data", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "byte", "[", "]", "data", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "data", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "ByteBuffer", "data", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "data", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "Persistable", "data", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "data", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "(", "Object", ")", "null", ",", "extra", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Op", "(", "Type", "type", ",", "long", "line", ",", "Transaction", "txn", ")", "{", "this", "(", "type", ",", "line", ",", "(", "Object", ")", "null", ",", "null", ",", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "getExtra", "(", ")", "{", "return", "extra", ";", "}", "</s>"]
["<s>", "public", "void", "setExtra", "(", "Object", "extra", ")", "{", "this", ".", "extra", "=", "extra", ";", "}", "</s>"]
["<s>", "public", "void", "createFuture", "(", ")", "{", "assert", "future", "=", "=", "null", ";", "this", ".", "future", "=", "SettableFuture", ".", "create", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasFuture", "(", ")", "{", "return", "future", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "SettableFuture", "<", "Object", ">", "getFuture", "(", ")", "{", "return", "future", ";", "}", "</s>"]
["<s>", "public", "void", "setResult", "(", "Object", "result", ")", "{", "future", ".", "set", "(", "result", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setException", "(", "Throwable", "t", ")", "{", "future", ".", "setException", "(", "t", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "getResult", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "return", "future", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Object", "getResult", "(", "long", "timeout", ",", "TimeUnit", "unit", ")", "throws", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "return", "future", ".", "get", "(", "timeout", ",", "unit", ")", ";", "}", "</s>"]
["<s>", "public", "long", "getStartTime", "(", ")", "{", "return", "startTime", ";", "}", "</s>"]
["<s>", "public", "void", "setStartTime", "(", "long", "startTime", ")", "{", "this", ".", "startTime", "=", "startTime", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "false", ";", "if", "(", "getClass", "(", ")", "!", "=", "obj", ".", "getClass", "(", ")", ")", "return", "false", ";", "final", "Op", "other", "=", "(", "Op", ")", "obj", ";", "if", "(", "this", ".", "type", "!", "=", "other", ".", "type", ")", "return", "false", ";", "if", "(", "this", ".", "line", "!", "=", "other", ".", "line", ")", "return", "false", ";", "if", "(", "!", "Objects", ".", "equals", "(", "this", ".", "data", ",", "other", ".", "data", ")", ")", "return", "false", ";", "if", "(", "!", "Objects", ".", "equals", "(", "this", ".", "extra", ",", "other", ".", "extra", ")", ")", "return", "false", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "int", "hash", "=", "<NUM_LIT:3>", ";", "hash", "=", "<NUM_LIT>", "*", "hash", "+", "(", "this", ".", "type", "!", "=", "null", "?", "this", ".", "type", ".", "hashCode", "(", ")", ":", "0", ")", ";", "hash", "=", "<NUM_LIT>", "*", "hash", "+", "(", "int", ")", "(", "this", ".", "line", "^", "(", "this", ".", "line", ">", ">", ">", "<NUM_LIT:32>", ")", ")", ";", "hash", "=", "<NUM_LIT>", "*", "hash", "+", "Objects", ".", "hashCode", "(", "this", ".", "data", ")", ";", "hash", "=", "<NUM_LIT>", "*", "hash", "+", "Objects", ".", "hashCode", "(", "this", ".", "extra", ")", ";", "return", "hash", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "type", "+", "\"", "<STR_LIT>", "\"", "+", "Long", ".", "toHexString", "(", "line", ")", "+", "(", "data", "!", "=", "null", "?", "\"", "<STR_LIT>", "\"", "+", "data", ":", "\"", "\"", ")", "+", "(", "extra", "!", "=", "null", "?", "\"", "<STR_LIT>", "\"", "+", "extra", ":", "\"", "\"", ")", "+", "<CHAR_LIT:)>", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "HeapLocalStorage", "(", "String", "name", ",", "MonitoringType", "monitoringType", ")", "{", "super", "(", "name", ")", ";", "this", ".", "monitor", "=", "createMonitor", "(", "monitoringType", ",", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ByteBuffer", "allocateStorage", "(", "int", "size", ")", "{", "monitor", ".", "allocated", "(", "size", ")", ";", "totalSize", ".", "addAndGet", "(", "size", ")", ";", "return", "ByteBuffer", ".", "allocate", "(", "size", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "deallocateStorage", "(", "long", "id", ",", "ByteBuffer", "buffer", ")", "{", "totalSize", ".", "addAndGet", "(", "-", "buffer", ".", "capacity", "(", ")", ")", ";", "monitor", ".", "deallocated", "(", "buffer", ".", "capacity", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTotalAllocatedSize", "(", ")", "{", "return", "totalSize", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "private", "LocalStorageMonitor", "createMonitor", "(", "MonitoringType", "monitoringType", ",", "String", "name", ")", "{", "if", "(", "monitoringType", "=", "=", "null", ")", "return", "(", "LocalStorageMonitor", ")", "Proxy", ".", "newProxyInstance", "(", "HeapLocalStorage", ".", "class", ".", "getClassLoader", "(", ")", ",", "new", "Class", "<", "?", ">", "[", "]", "{", "LocalStorageMonitor", ".", "class", "}", ",", "DegenerateInvocationHandler", ".", "INSTANCE", ")", ";", "else", "switch", "(", "monitoringType", ")", "{", "case", "JMX", ":", "return", "new", "JMXLocalStorageMonitor", "(", "name", ",", "this", ")", ";", "case", "METRICS", ":", "return", "new", "MetricsLocalStorageMonitor", "(", "name", ",", "this", ")", ";", "}", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "monitoringType", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "MainMemory", "(", "String", "name", ",", "Cluster", "cluster", ",", "MainMemoryDB", "store", ",", "Comm", "comm", ",", "MonitoringType", "monitoringType", ")", "{", "this", "(", "name", ",", "cluster", ",", "store", ",", "comm", ",", "createMonitor", "(", "monitoringType", ",", "name", ")", ")", ";", "}", "</s>"]
["<s>", "MainMemory", "(", "String", "name", ",", "Cluster", "cluster", ",", "MainMemoryDB", "store", ",", "Comm", "comm", ",", "MainMemoryMonitor", "monitor", ")", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "comm", "=", "comm", ";", "this", ".", "store", "=", "store", ";", "this", ".", "monitor", "=", "monitor", ";", "monitor", ".", "setMonitoredObject", "(", "this", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "this", ")", ";", "comm", ".", "setReceiver", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "if", "(", "master", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "store", ".", "dump", "(", "System", ".", "err", ")", ";", "}", "(", "(", "RefAllocator", ")", "getCluster", "(", ")", ")", ".", "setCounter", "(", "store", ".", "getMaxId", "(", ")", "+", "1", ")", ";", "}", "setReady", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "super", ".", "switchToMaster", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "shutdown", "(", ")", "{", "store", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "MainMemoryMonitor", "createMonitor", "(", "MonitoringType", "monitoringType", ",", "String", "name", ")", "{", "if", "(", "monitoringType", "=", "=", "null", ")", "return", "(", "MainMemoryMonitor", ")", "Proxy", ".", "newProxyInstance", "(", "MainMemory", ".", "class", ".", "getClassLoader", "(", ")", ",", "new", "Class", "<", "?", ">", "[", "]", "{", "MainMemoryMonitor", ".", "class", "}", ",", "DegenerateInvocationHandler", ".", "INSTANCE", ")", ";", "else", "switch", "(", "monitoringType", ")", "{", "case", "JMX", ":", "return", "new", "JMXMainMemoryMonitor", "(", "name", ")", ";", "case", "METRICS", ":", "return", "new", "MetricsMainMemoryMonitor", "(", ")", ";", "}", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "monitoringType", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "message", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "GET", ":", "case", "GETX", ":", "handleMessageGet", "(", "(", "Message", ".", "GET", ")", "message", ")", ";", "break", ";", "case", "INV", ":", "handleMessageInvalidate", "(", "(", "Message", ".", "INV", ")", "message", ")", ";", "break", ";", "case", "DEL", ":", "handleMessageDelete", "(", "(", "LineMessage", ")", "message", ")", ";", "break", ";", "case", "MSG", ":", "handleMessageMsg", "(", "(", "Message", ".", "MSG", ")", "message", ")", ";", "break", ";", "case", "BACKUP_PACKET", ":", "handleMessageBackup", "(", "(", "BACKUP_PACKET", ")", "message", ")", ";", "break", ";", "}", "}", "</s>"]
["<s>", "void", "send", "(", "Message", "message", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "try", "{", "comm", ".", "send", "(", "message", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "private", "boolean", "handleMessageGet", "(", "LineMessage", "msg", ")", "{", "final", "long", "id", "=", "msg", ".", "getLine", "(", ")", ";", "for", "(", ";", ";", ")", "{", "short", "owner", ";", "if", "(", "isReserved", "(", "id", ")", "&", "&", "store", ".", "casOwner", "(", "id", ",", "(", "short", ")", "-", "1", ",", "msg", ".", "getNode", "(", ")", ")", "=", "=", "msg", ".", "getNode", "(", ")", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ",", "msg", ".", "getNode", "(", ")", ")", ";", "monitor", ".", "addOwnerWrite", "(", ")", ";", "monitor", ".", "addObjectServed", "(", ")", ";", "store", ".", "write", "(", "id", ",", "msg", ".", "getNode", "(", ")", ",", "1", ",", "new", "byte", "[", "0", "]", ",", "null", ")", ";", "send", "(", "Message", ".", "PUTX", "(", "msg", ",", "id", ",", "new", "short", "[", "0", "]", ",", "1", ",", "null", ")", ")", ";", "return", "true", ";", "}", "else", "if", "(", "(", "owner", "=", "store", ".", "casOwner", "(", "id", ",", "SERVER", ",", "msg", ".", "getNode", "(", ")", ")", ")", "=", "=", "msg", ".", "getNode", "(", ")", ")", "{", "MainMemoryEntry", "entry", "=", "store", ".", "read", "(", "id", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ",", "msg", ".", "getNode", "(", ")", ")", ";", "monitor", ".", "addOwnerWrite", "(", ")", ";", "monitor", ".", "addObjectServed", "(", ")", ";", "send", "(", "Message", ".", "PUTX", "(", "msg", ",", "id", ",", "new", "short", "[", "0", "]", ",", "entry", ".", "version", ",", "ByteBuffer", ".", "wrap", "(", "entry", ".", "data", ")", ")", ")", ";", "return", "true", ";", "}", "if", "(", "owner", "=", "=", "-", "1", "&", "&", "!", "isReserved", "(", "id", ")", ")", "{", "send", "(", "Message", ".", "NOT_FOUND", "(", "msg", ")", ")", ";", "return", "false", ";", "}", "else", "if", "(", "owner", ">", "SERVER", ")", "{", "send", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "id", ",", "owner", ",", "true", ")", ")", ";", "monitor", ".", "addOwnerServed", "(", ")", ";", "return", "false", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "owner", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleMessageInvalidate", "(", "Message", ".", "INV", "msg", ")", "{", "final", "long", "id", "=", "msg", ".", "getLine", "(", ")", ";", "final", "short", "owner", "=", "msg", ".", "getNode", "(", ")", ";", "final", "short", "previousOwner", "=", "msg", ".", "getPreviousOwner", "(", ")", ";", "short", "currentOwner", ";", "if", "(", "(", "currentOwner", "=", "store", ".", "casOwner", "(", "id", ",", "previousOwner", ",", "owner", ")", ")", "=", "=", "owner", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ",", "msg", ".", "getNode", "(", ")", ")", ";", "monitor", ".", "addOwnerWrite", "(", ")", ";", "send", "(", "Message", ".", "INVACK", "(", "msg", ")", ")", ";", "}", "else", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "id", ")", ",", "msg", ".", "getNode", "(", ")", ",", "currentOwner", "}", ")", ";", "monitor", ".", "addOwnerServed", "(", ")", ";", "send", "(", "Message", ".", "INV", "(", "msg", ",", "id", ",", "currentOwner", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleMessageDelete", "(", "LineMessage", "msg", ")", "{", "final", "long", "id", "=", "msg", ".", "getLine", "(", ")", ";", "final", "short", "owner", "=", "msg", ".", "getNode", "(", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ")", ";", "final", "Object", "txn", "=", "store", ".", "beginTransaction", "(", ")", ";", "try", "{", "store", ".", "delete", "(", "id", ",", "txn", ")", ";", "store", ".", "commit", "(", "txn", ")", ";", "send", "(", "Message", ".", "INVACK", "(", "msg", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "store", ".", "abort", "(", "txn", ")", ";", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleMessageMsg", "(", "Message", ".", "MSG", "msg", ")", "{", "final", "long", "id", "=", "msg", ".", "getLine", "(", ")", ";", "if", "(", "handleMessageGet", "(", "msg", ")", ")", "send", "(", "Message", ".", "MSG", "(", "msg", ".", "getNode", "(", ")", ",", "id", ",", "msg", ".", "getData", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleMessageBackup", "(", "BACKUP_PACKET", "msg", ")", "{", "final", "Object", "txn", "=", "store", ".", "beginTransaction", "(", ")", ";", "try", "{", "monitor", ".", "addTransaction", "(", "msg", ".", "getBackups", "(", ")", ".", "size", "(", ")", ")", ";", "for", "(", "BACKUP", "backup", ":", "msg", ".", "getBackups", "(", ")", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "backup", ".", "getVersion", "(", ")", ",", "hex", "(", "backup", ".", "getLine", "(", ")", ")", ",", "backup", ".", "getData", "(", ")", "!", "=", "null", "?", "\"", "<STR_LIT:(>", "\"", "+", "backup", ".", "getData", "(", ")", ".", "remaining", "(", ")", "+", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", "}", ")", ";", "store", ".", "write", "(", "backup", ".", "getLine", "(", ")", ",", "msg", ".", "getNode", "(", ")", ",", "backup", ".", "getVersion", "(", ")", ",", "Persistables", ".", "toByteArray", "(", "backup", ".", "getData", "(", ")", ")", ",", "txn", ")", ";", "}", "store", ".", "commit", "(", "txn", ")", ";", "send", "(", "Message", ".", "BACKUP_PACKETACK", "(", "msg", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "store", ".", "abort", "(", "txn", ")", ";", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "node", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "store", ".", "removeOwner", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", "}", ")", "public", "JMXCacheMonitor", "(", "String", "name", ")", "{", "super", "(", "CacheMXBean", ".", "class", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "initCounters", "(", ")", "{", "for", "(", "Op", ".", "Type", "op", ":", "Op", ".", "Type", ".", "values", "(", ")", ")", "opMonitors", ".", "put", "(", "op", ",", "new", "OpMonitor", "(", "histogramBins", ")", ")", ";", "for", "(", "Message", ".", "Type", "m", ":", "Message", ".", "Type", ".", "values", "(", ")", ")", "messageMonitors", ".", "put", "(", "m", ",", "new", "MessageMonitor", "(", ")", ")", ";", "for", "(", "MessageDelayReason", "reason", ":", "MessageDelayReason", ".", "values", "(", ")", ")", "messageDelayMonitors", ".", "put", "(", "reason", ",", "new", "DelayedMessageMonitor", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "collectAndResetCounters", "(", ")", "{", "for", "(", "MessageMonitor", "mm", ":", "messageMonitors", ".", "values", "(", ")", ")", "mm", ".", "collectAndResetCounters", "(", ")", ";", "for", "(", "OpMonitor", "om", ":", "opMonitors", ".", "values", "(", ")", ")", "om", ".", "collectAndResetCounters", "(", ")", ";", "for", "(", "DelayedMessageMonitor", "dm", ":", "messageDelayMonitors", ".", "values", "(", ")", ")", "dm", ".", "collectAndResetCounters", "(", ")", ";", "hits", "=", "(", "int", ")", "hitsCounter", ".", "get", "(", ")", ";", "staleHits", "=", "(", "int", ")", "staleHitsCounter", ".", "get", "(", ")", ";", "misses", "=", "(", "int", ")", "missesCounter", ".", "get", "(", ")", ";", "invalidates", "=", "(", "int", ")", "invalidatesCounter", ".", "get", "(", ")", ";", "stalePurges", "=", "(", "int", ")", "stalePurgesCounter", ".", "get", "(", ")", ";", "hitsCounter", ".", "reset", "(", ")", ";", "staleHitsCounter", ".", "reset", "(", ")", ";", "missesCounter", ".", "reset", "(", ")", ";", "invalidatesCounter", ".", "reset", "(", ")", ";", "stalePurgesCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "resetCounters", "(", ")", "{", "for", "(", "MessageMonitor", "mm", ":", "messageMonitors", ".", "values", "(", ")", ")", "mm", ".", "reset", "(", ")", ";", "for", "(", "OpMonitor", "om", ":", "opMonitors", ".", "values", "(", ")", ")", "om", ".", "reset", "(", ")", ";", "for", "(", "DelayedMessageMonitor", "dm", ":", "messageDelayMonitors", ".", "values", "(", ")", ")", "dm", ".", "reset", "(", ")", ";", "hitsCounter", ".", "reset", "(", ")", ";", "staleHitsCounter", ".", "reset", "(", ")", ";", "missesCounter", ".", "reset", "(", ")", ";", "invalidatesCounter", ".", "reset", "(", ")", ";", "stalePurgesCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addHit", "(", ")", "{", "hitsCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addStaleHit", "(", ")", "{", "staleHitsCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMiss", "(", ")", "{", "missesCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addInvalidate", "(", "int", "num", ")", "{", "invalidatesCounter", ".", "add", "(", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageSent", "(", "Message", ".", "Type", "msg", ")", "{", "messageMonitors", ".", "get", "(", "msg", ")", ".", "addSent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageReceived", "(", "Message", ".", "Type", "msg", ")", "{", "messageMonitors", ".", "get", "(", "msg", ")", ".", "addReceived", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addOp", "(", "Op", ".", "Type", "type", ",", "long", "durationMicroSeconds", ")", "{", "if", "(", "durationMicroSeconds", ">", "0", ")", "opMonitors", ".", "get", "(", "type", ")", ".", "addOp", "(", "durationMicroSeconds", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageHandlingDelay", "(", "int", "numDelayed", ",", "long", "totalDelayNanos", ",", "MessageDelayReason", "reason", ")", "{", "final", "DelayedMessageMonitor", "m", "=", "messageDelayMonitors", ".", "get", "(", "reason", ")", ";", "m", ".", "addMessages", "(", "numDelayed", ")", ";", "m", ".", "addDelay", "(", "totalDelayNanos", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addStalePurge", "(", "int", "num", ")", "{", "stalePurgesCounter", ".", "add", "(", "num", ")", ";", "}", "</s>"]
["<s>", "void", "addSent", "(", ")", "{", "messagesSentCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "void", "addReceived", "(", ")", "{", "messagesReceivedCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "int", "getSent", "(", ")", "{", "return", "messagesSent", ";", "}", "</s>"]
["<s>", "int", "getReceived", "(", ")", "{", "return", "messagesReceived", ";", "}", "</s>"]
["<s>", "void", "collectAndResetCounters", "(", ")", "{", "collect", "(", ")", ";", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "void", "collect", "(", ")", "{", "messagesSent", "=", "(", "int", ")", "messagesSentCounter", ".", "get", "(", ")", ";", "messagesReceived", "=", "(", "int", ")", "messagesReceivedCounter", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "void", "reset", "(", ")", "{", "messagesSentCounter", ".", "reset", "(", ")", ";", "messagesReceivedCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "OpMonitor", "(", "long", ".", ".", ".", "histogramBins", ")", "{", "this", ".", "histogramBins", "=", "histogramBins", ";", "this", ".", "histogramCounters", "=", "new", "Counter", "[", "histogramBins", ".", "length", "+", "1", "]", ";", "this", ".", "rawHistogram", "=", "new", "long", "[", "histogramCounters", ".", "length", "]", ";", "this", ".", "histogram", "=", "new", "float", "[", "histogramCounters", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "histogramCounters", ".", "length", ";", "i", "+", "+", ")", "this", ".", "histogramCounters", "[", "i", "]", "=", "new", "Counter", "(", ")", ";", "}", "</s>"]
["<s>", "int", "getNumOps", "(", ")", "{", "return", "numOps", ";", "}", "</s>"]
["<s>", "synchronized", "long", "getMaxTime", "(", ")", "{", "return", "maxTime", ";", "}", "</s>"]
["<s>", "synchronized", "float", "[", "]", "getHistogram", "(", ")", "{", "return", "histogram", ";", "}", "</s>"]
["<s>", "void", "addOp", "(", "long", "duration", ")", "{", "numOpsCounter", ".", "inc", "(", ")", ";", "if", "(", "duration", "=", "=", "0", ")", "{", "histogramCounters", "[", "0", "]", ".", "inc", "(", ")", ";", "return", ";", "}", "for", "(", ";", ";", ")", "{", "long", "currentMax", "=", "maxTimeCounter", ".", "get", "(", ")", ";", "if", "(", "duration", ">", "currentMax", ")", "{", "if", "(", "maxTimeCounter", ".", "compareAndSet", "(", "currentMax", ",", "duration", ")", ")", "break", ";", "}", "else", "break", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "histogramBins", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "duration", "<", "histogramBins", "[", "i", "]", ")", "{", "histogramCounters", "[", "i", "]", ".", "inc", "(", ")", ";", "return", ";", "}", "}", "histogramCounters", "[", "histogramBins", ".", "length", "]", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "void", "collectAndResetCounters", "(", ")", "{", "collect", "(", ")", ";", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "synchronized", "void", "collect", "(", ")", "{", "numOps", "=", "(", "int", ")", "numOpsCounter", ".", "get", "(", ")", ";", "maxTime", "=", "maxTimeCounter", ".", "get", "(", ")", ";", "long", "sum", "=", "0", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "rawHistogram", ".", "length", ";", "i", "+", "+", ")", "{", "final", "long", "val", "=", "histogramCounters", "[", "i", "]", ".", "get", "(", ")", ";", "sum", "+", "=", "val", ";", "rawHistogram", "[", "i", "]", "=", "val", ";", "}", "for", "(", "int", "i", "=", "0", ";", "i", "<", "histogram", ".", "length", ";", "i", "+", "+", ")", "histogram", "[", "i", "]", "=", "(", "float", ")", "(", "(", "double", ")", "rawHistogram", "[", "i", "]", "/", "sum", "*", "<NUM_LIT>", ")", ";", "}", "</s>"]
["<s>", "void", "reset", "(", ")", "{", "numOpsCounter", ".", "reset", "(", ")", ";", "maxTimeCounter", ".", "set", "(", "0", ")", ";", "for", "(", "Counter", "histogramCounter", ":", "histogramCounters", ")", "histogramCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "void", "addDelay", "(", "long", "nanos", ")", "{", "delayCounter", ".", "add", "(", "TimeUnit", ".", "MICROSECONDS", ".", "convert", "(", "nanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ")", ";", "}", "</s>"]
["<s>", "void", "addMessages", "(", "int", "num", ")", "{", "messagesCounter", ".", "add", "(", "num", ")", ";", "}", "</s>"]
["<s>", "int", "getMessages", "(", ")", "{", "return", "messages", ";", "}", "</s>"]
["<s>", "long", "getTotalMicrosecondDelayPerSecond", "(", ")", "{", "return", "totalDelay", ";", "}", "</s>"]
["<s>", "void", "collectAndResetCounters", "(", ")", "{", "collect", "(", ")", ";", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "void", "collect", "(", ")", "{", "messages", "=", "(", "int", ")", "messagesCounter", ".", "get", "(", ")", ";", "double", "secondsSinceLast", "=", "getMillisSinceLastCollect", "(", ")", "/", "<NUM_LIT>", ";", "totalDelay", "=", "(", "long", ")", "(", "(", "double", ")", "delayCounter", ".", "get", "(", ")", "/", "secondsSinceLast", ")", ";", "}", "</s>"]
["<s>", "void", "reset", "(", ")", "{", "messagesCounter", ".", "reset", "(", ")", ";", "messagesCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "private", "int", "getNumOp", "(", "Op", ".", "Type", "ot", ")", "{", "return", "opMonitors", ".", "get", "(", "ot", ")", ".", "getNumOps", "(", ")", ";", "}", "</s>"]
["<s>", "private", "float", "[", "]", "getOpHistogram", "(", "Op", ".", "Type", "ot", ")", "{", "return", "opMonitors", ".", "get", "(", "ot", ")", ".", "getHistogram", "(", ")", ";", "}", "</s>"]
["<s>", "private", "int", "getNumMessagesReceived", "(", "Message", ".", "Type", "mt", ")", "{", "return", "messageMonitors", ".", "get", "(", "mt", ")", ".", "getReceived", "(", ")", ";", "}", "</s>"]
["<s>", "private", "int", "getNumMessagesSent", "(", "Message", ".", "Type", "mt", ")", "{", "return", "messageMonitors", ".", "get", "(", "mt", ")", ".", "getSent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpGet", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "GET", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "float", "[", "]", "getOpHistogramGet", "(", ")", "{", "return", "getOpHistogram", "(", "Op", ".", "Type", ".", "GET", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpGetS", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "GETS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "float", "[", "]", "getOpHistogramGetS", "(", ")", "{", "return", "getOpHistogram", "(", "Op", ".", "Type", ".", "GETS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpGetX", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "GETX", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "float", "[", "]", "getOpHistogramGetX", "(", ")", "{", "return", "getOpHistogram", "(", "Op", ".", "Type", ".", "GETX", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpSet", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "SET", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "float", "[", "]", "getOpHistogramSet", "(", ")", "{", "return", "getOpHistogram", "(", "Op", ".", "Type", ".", "SET", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpPut", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "PUT", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpDel", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "DEL", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumOpSend", "(", ")", "{", "return", "getNumOp", "(", "Op", ".", "Type", ".", "SEND", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedGET", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "GET", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentGET", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "GET", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedGETX", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "GETX", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentGETX", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "GETX", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedPUT", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "PUT", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentPUT", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "PUT", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedPUTX", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "PUTX", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentPUTX", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "PUTX", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedINV", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "INV", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentINV", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "INV", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedINVACK", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "INVACK", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentINVACK", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "INVACK", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedCHNGD_OWNR", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "CHNGD_OWNR", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentCHNGD_OWNR", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "CHNGD_OWNR", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedMSG", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "MSG", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentMSG", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "MSG", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesReceivedMSGACK", "(", ")", "{", "return", "getNumMessagesReceived", "(", "Message", ".", "Type", ".", "MSGACK", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesSentMSGACK", "(", ")", "{", "return", "getNumMessagesSent", "(", "Message", ".", "Type", ".", "MSGACK", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesDelayedDueLock", "(", ")", "{", "return", "messageDelayMonitors", ".", "get", "(", "MessageDelayReason", ".", "LOCK", ")", ".", "getMessages", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTotalMicrosecondDelayPerSecondDueLock", "(", ")", "{", "return", "messageDelayMonitors", ".", "get", "(", "MessageDelayReason", ".", "LOCK", ")", ".", "getTotalMicrosecondDelayPerSecond", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesDelayedDueBackup", "(", ")", "{", "return", "messageDelayMonitors", ".", "get", "(", "MessageDelayReason", ".", "BACKUP", ")", ".", "getMessages", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTotalMicrosecondDelayPerSecondDueBackup", "(", ")", "{", "return", "messageDelayMonitors", ".", "get", "(", "MessageDelayReason", ".", "BACKUP", ")", ".", "getTotalMicrosecondDelayPerSecond", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getNumMessagesDelayedDueOther", "(", ")", "{", "return", "messageDelayMonitors", ".", "get", "(", "MessageDelayReason", ".", "OTHER", ")", ".", "getMessages", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTotalMicrosecondDelayPerSecondDueOther", "(", ")", "{", "return", "messageDelayMonitors", ".", "get", "(", "MessageDelayReason", ".", "OTHER", ")", ".", "getTotalMicrosecondDelayPerSecond", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getHits", "(", ")", "{", "return", "hits", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getStaleHits", "(", ")", "{", "return", "staleHits", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMisses", "(", ")", "{", "return", "misses", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getInvalidates", "(", ")", "{", "return", "invalidates", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", "}", ")", "public", "JMXMainMemoryMonitor", "(", "String", "name", ")", "{", "super", "(", "MainMemoryMXBean", ".", "class", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "collectAndResetCounters", "(", ")", "{", "writes", "=", "writesCounter", ".", "get", "(", ")", ";", "transactions", "=", "transactionsCounter", ".", "get", "(", ")", ";", "objectsServed", "=", "objectsServedCounter", ".", "get", "(", ")", ";", "ownerWrites", "=", "ownerWritesCounter", ".", "get", "(", ")", ";", "ownersServed", "=", "ownersServedCounter", ".", "get", "(", ")", ";", "resetCounters", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "resetCounters", "(", ")", "{", "writesCounter", ".", "reset", "(", ")", ";", "transactionsCounter", ".", "reset", "(", ")", ";", "objectsServedCounter", ".", "reset", "(", ")", ";", "ownerWritesCounter", ".", "reset", "(", ")", ";", "ownersServedCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addTransaction", "(", "int", "numWrites", ")", "{", "transactionsCounter", ".", "inc", "(", ")", ";", "writesCounter", ".", "add", "(", "numWrites", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addObjectServed", "(", ")", "{", "objectsServedCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addOwnerWrite", "(", ")", "{", "ownerWritesCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addOwnerServed", "(", ")", "{", "ownersServedCounter", ".", "inc", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getObjectsServed", "(", ")", "{", "return", "(", "int", ")", "objectsServed", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getOwnerWrites", "(", ")", "{", "return", "(", "int", ")", "ownerWrites", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getOwnersServed", "(", ")", "{", "return", "(", "int", ")", "ownersServed", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getTransactions", "(", ")", "{", "return", "(", "int", ")", "transactions", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getWrites", "(", ")", "{", "return", "(", "int", ")", "writes", ";", "}", "</s>"]
["<s>", "void", "setMonitoredObject", "(", "Object", "obj", ")", ";", "</s>"]
["<s>", "void", "addMessageReceived", "(", "Message", ".", "Type", "msg", ")", ";", "</s>"]
["<s>", "void", "addMessageSent", "(", "Message", ".", "Type", "msg", ")", ";", "</s>"]
["<s>", "void", "addMessageHandlingDelay", "(", "int", "numDelayed", ",", "long", "totalDelayNanos", ",", "MessageDelayReason", "reason", ")", ";", "</s>"]
["<s>", "void", "addOp", "(", "Op", ".", "Type", "type", ",", "long", "durationMicroSeconds", ")", ";", "</s>"]
["<s>", "void", "addHit", "(", ")", ";", "</s>"]
["<s>", "void", "addStaleHit", "(", ")", ";", "</s>"]
["<s>", "void", "addMiss", "(", ")", ";", "</s>"]
["<s>", "void", "addInvalidate", "(", "int", "num", ")", ";", "</s>"]
["<s>", "void", "addStalePurge", "(", "int", "num", ")", ";", "</s>"]
["<s>", "public", "AbstractCluster", "(", "String", "name", ",", "short", "nodeId", ")", "{", "super", "(", "name", ")", ";", "if", "(", "nodeId", "<", "0", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "nodeId", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "this", ".", "myId", "=", "nodeId", ";", "this", ".", "online", "=", "false", ";", "this", ".", "master", "=", "false", ";", "this", ".", "requiredPeerNodeProperties", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "requiredServerProperties", ".", "add", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "myNodeInfo", "=", "new", "NodeInfoImpl", "(", ")", ";", "myNodeInfo", ".", "setNodeId", "(", "nodeId", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "setName", "(", "String", "name", ")", "{", "assertDuringInitialization", "(", ")", ";", "myNodeInfo", ".", "setName", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setHasServer", "(", "boolean", "hasServer", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "hasServer", "=", "hasServer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasServer", "(", ")", "{", "return", "hasServer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "addNodeProperty", "(", "String", "property", ",", "boolean", "requiredForPeer", ",", "boolean", "requiredForServer", ",", "ReaderWriter", "<", "?", ">", "readerWriter", ")", "{", "if", "(", "requiredForPeer", ")", "{", "assertDuringInitialization", "(", ")", ";", "requiredPeerNodeProperties", ".", "add", "(", "property", ")", ";", "}", "if", "(", "requiredForServer", ")", "{", "assertDuringInitialization", "(", ")", ";", "requiredServerProperties", ".", "add", "(", "property", ")", ";", "}", "if", "(", "!", "requiredForPeer", "&", "&", "!", "requiredForServer", ")", "{", "myNodeInfo", ".", "addProperty", "(", "property", ")", ";", "}", "readerWriters", ".", "put", "(", "property", ",", "readerWriter", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "setNodeProperty", "(", "String", "property", ",", "Object", "value", ")", "{", "if", "(", "requiredPeerNodeProperties", ".", "contains", "(", "property", ")", "|", "|", "requiredServerProperties", ".", "contains", "(", "property", ")", ")", "assertDuringInitialization", "(", ")", ";", "myNodeInfo", ".", "set", "(", "property", ",", "value", ")", ";", "}", "</s>"]
["<s>", "protected", "final", "void", "setControlTree", "(", "final", "DistributedTree", "controlTree", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "controlTree", "=", "controlTree", ";", "this", ".", "protectedTree", "=", "new", "DistributedTreeAdapter", "(", "controlTree", ")", "{", "@", "Override", "public", "void", "create", "(", "String", "node", ",", "boolean", "ephemeral", ")", "{", "super", ".", "create", "(", "protect", "(", "node", ")", ",", "ephemeral", ")", ";", "}", "@", "Override", "public", "void", "set", "(", "String", "node", ",", "byte", "[", "]", "data", ")", "{", "super", ".", "set", "(", "protect", "(", "node", ")", ",", "data", ")", ";", "}", "@", "Override", "public", "void", "delete", "(", "String", "node", ")", "{", "super", ".", "delete", "(", "protect", "(", "node", ")", ")", ";", "}", "private", "String", "protect", "(", "String", "node", ")", "{", "if", "(", "node", ".", "startsWith", "(", "NODES", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "NODES", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "node", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "create", "(", "String", "node", ",", "boolean", "ephemeral", ")", "{", "super", ".", "create", "(", "protect", "(", "node", ")", ",", "ephemeral", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "String", "node", ",", "byte", "[", "]", "data", ")", "{", "super", ".", "set", "(", "protect", "(", "node", ")", ",", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "String", "node", ")", "{", "super", ".", "delete", "(", "protect", "(", "node", ")", ")", ";", "}", "</s>"]
["<s>", "private", "String", "protect", "(", "String", "node", ")", "{", "if", "(", "node", ".", "startsWith", "(", "NODES", ")", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "NODES", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "return", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "if", "(", "controlTree", "=", "=", "null", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "controlTree", ".", "create", "(", "NODES", ",", "false", ")", ";", "controlTree", ".", "create", "(", "LEADERS", ",", "false", ")", ";", "if", "(", "controlTree", ".", "exists", "(", "myNodeInfo", ".", "treeNodePath", ")", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "myNodeInfo", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "requiredPeerNodeProperties", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "requiredServerProperties", ")", ";", "final", "Set", "<", "String", ">", "requiredProperties", "=", "(", "myId", "=", "=", "0", "?", "requiredServerProperties", ":", "requiredPeerNodeProperties", ")", ";", "for", "(", "String", "property", ":", "requiredProperties", ")", "{", "if", "(", "!", "property", ".", "equals", "(", "\"", "<STR_LIT>", "\"", ")", "&", "&", "myNodeInfo", ".", "get", "(", "property", ")", "=", "=", "null", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "property", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "branch", "=", "new", "DistributedBranchHelper", "(", "controlTree", ",", "NODES", ",", "false", ")", "{", "@", "Override", "protected", "boolean", "isNodeComplete", "(", "String", "node", ",", "Set", "<", "String", ">", "properties", ")", "{", "if", "(", "!", "properties", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "return", "false", ";", "}", "final", "short", "id", "=", "Short", ".", "parseShort", "(", "new", "String", "(", "controlTree", ".", "get", "(", "node", "+", "\"", "<STR_LIT>", "\"", ")", ",", "Charsets", ".", "UTF_8", ")", ")", ";", "final", "Set", "<", "String", ">", "requiredProperties", "=", "(", "id", "=", "=", "0", "?", "requiredServerProperties", ":", "requiredPeerNodeProperties", ")", ";", "final", "boolean", "success", "=", "properties", ".", "containsAll", "(", "requiredProperties", ")", ";", "return", "success", ";", "}", "}", ";", "branch", ".", "addListener", "(", "new", "DistributedTree", ".", "ListenerAdapter", "(", ")", "{", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "nodeAdded", "(", "childName", ")", ";", "}", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "nodeRemoved", "(", "childName", ")", ";", "}", "}", ")", ";", "controlTree", ".", "addListener", "(", "LEADERS", ",", "new", "DistributedTree", ".", "ListenerAdapter", "(", ")", "{", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "leaderAdded", "(", "childName", ")", ";", "}", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "leaderRemoved", "(", "childName", ")", ";", "}", "}", ")", ";", "for", "(", "String", "leader", ":", "controlTree", ".", "getChildren", "(", "LEADERS", ")", ")", "AbstractCluster", ".", "this", ".", "leaderAdded", "(", "leader", ")", ";", "myNodeInfo", ".", "writeToTree", "(", ")", ";", "setReady", "(", "true", ")", ";", "super", ".", "postInit", "(", ")", ";", "joined", "=", "true", ";", "fireJoinedCluster", "(", ")", ";", "for", "(", "short", "id", ":", "masters", ".", "keySet", "(", ")", ")", "{", "if", "(", "id", "!", "=", "myId", ")", "fireNodeAdded", "(", "id", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isNodeComplete", "(", "String", "node", ",", "Set", "<", "String", ">", "properties", ")", "{", "if", "(", "!", "properties", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ")", "{", "return", "false", ";", "}", "final", "short", "id", "=", "Short", ".", "parseShort", "(", "new", "String", "(", "controlTree", ".", "get", "(", "node", "+", "\"", "<STR_LIT>", "\"", ")", ",", "Charsets", ".", "UTF_8", ")", ")", ";", "final", "Set", "<", "String", ">", "requiredProperties", "=", "(", "id", "=", "=", "0", "?", "requiredServerProperties", ":", "requiredPeerNodeProperties", ")", ";", "final", "boolean", "success", "=", "properties", ".", "containsAll", "(", "requiredProperties", ")", ";", "return", "success", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "nodeAdded", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "nodeRemoved", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "leaderAdded", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "AbstractCluster", ".", "this", ".", "leaderRemoved", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "available", "(", "boolean", "value", ")", "{", "super", ".", "available", "(", "value", ")", ";", "if", "(", "!", "value", ")", "goOffline", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "DistributedTree", "getDistributedTree", "(", ")", "{", "return", "protectedTree", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "getMyNodeId", "(", ")", "{", "return", "myId", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "NodeInfo", "getMyNodeInfo", "(", ")", "{", "return", "myNodeInfo", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "NodeInfo", "getNodeInfoByName", "(", "String", "nodeName", ")", "{", "return", "nodes", ".", "get", "(", "nodeName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Collection", "<", "NodeInfo", ">", "getMasters", "(", ")", "{", "return", "Collections", ".", "unmodifiableCollection", "(", "(", "Collection", "<", "?", "extends", "NodeInfo", ">", ")", "masters", ".", "values", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "Collection", "<", "NodeInfo", ">", "getAllSlaves", "(", ")", "{", "return", "Collections", ".", "unmodifiableCollection", "(", "(", "Collection", "<", "?", "extends", "NodeInfo", ">", ")", "slaveServers", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "NodeInfo", "getMaster", "(", "short", "node", ")", "{", "return", "masters", ".", "get", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isMaster", "(", "NodeInfo", "node", ")", "{", "return", "masters", ".", "get", "(", "node", ".", "getNodeId", "(", ")", ")", "=", "=", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "NodeInfo", "getMyMaster", "(", ")", "{", "return", "myMaster", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "NodeInfo", ">", "getMySlaves", "(", ")", "{", "return", "ImmutableList", ".", "copyOf", "(", "(", "List", "<", "?", "extends", "NodeInfo", ">", ")", "mySlaves", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isMaster", "(", ")", "{", "return", "master", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isOnline", "(", ")", "{", "return", "online", ";", "}", "</s>"]
["<s>", "public", "boolean", "isJoined", "(", ")", "{", "return", "joined", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "if", "(", "myNodeInfo", ".", "getName", "(", ")", "!", "=", "null", ")", "{", "controlTree", ".", "delete", "(", "LEADERS", "+", "\"", "<STR_LIT:/>", "\"", "+", "myNodeInfo", ".", "getName", "(", ")", ")", ";", "}", "controlTree", ".", "delete", "(", "myNodeInfo", ".", "treeNodePath", ")", ";", "}", "</s>"]
["<s>", "public", "void", "goOnline", "(", ")", "{", "if", "(", "isOnline", "(", ")", ")", "return", ";", "if", "(", "isSecondSlave", "(", ")", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "getMyNodeId", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "goOffline", "(", ")", ";", "}", "try", "{", "awaitAvailable", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "controlTree", ".", "createEphemeralOrdered", "(", "LEADERS", "+", "\"", "<STR_LIT:/>", "\"", "+", "myNodeInfo", ".", "getName", "(", ")", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "goOffline", "(", ")", "{", "setOnline", "(", "false", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setOnline", "(", "boolean", "value", ")", "{", "if", "(", "this", ".", "online", "=", "=", "value", ")", "return", ";", "if", "(", "value", ")", "{", "if", "(", "isSecondSlave", "(", ")", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "getMyNodeId", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "value", "=", "false", ";", "}", "}", "this", ".", "online", "=", "value", ";", "if", "(", "online", ")", "{", "fireOnline", "(", ")", ";", "for", "(", "NodeInfo", "slave", ":", "mySlaves", ")", "fireSlaveAdded", "(", "slave", ")", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "controlTree", ".", "delete", "(", "LEADERS", "+", "\"", "<STR_LIT:/>", "\"", "+", "myNodeInfo", ".", "getName", "(", ")", ")", ";", "fireOffline", "(", ")", ";", "shutdown", "(", ")", ";", "System", ".", "exit", "(", "0", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "setMaster", "(", "boolean", "value", ")", "{", "if", "(", "this", ".", "master", "=", "=", "value", ")", "{", "return", ";", "}", "this", ".", "master", "=", "value", ";", "if", "(", "master", ")", "{", "fireSwitchToMaster", "(", ")", ";", "}", "else", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "for", "(", "NodeInfoImpl", "slave", ":", "findSlaves", "(", "myId", ")", ")", "{", "mySlaves", ".", "add", "(", "slave", ")", ";", "fireSlaveAdded", "(", "slave", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "setMyMaster", "(", "NodeInfoImpl", "newMaster", ")", "{", "if", "(", "this", ".", "myMaster", "=", "=", "newMaster", ")", "{", "return", ";", "}", "this", ".", "myMaster", "=", "newMaster", ";", "fireNewMaster", "(", "newMaster", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "<", "Short", ">", "getNodes", "(", ")", "{", "return", "Collections", ".", "unmodifiableSet", "(", "activeNodes", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Set", "<", "NodeInfo", ">", "getNodesByProperty", "(", "String", "propertyName", ",", "Object", "value", ")", "{", "final", "Set", "<", "NodeInfo", ">", "ns", "=", "new", "HashSet", "<", "NodeInfo", ">", "(", ")", ";", "for", "(", "NodeInfoImpl", "n", ":", "nodes", ".", "values", "(", ")", ")", "{", "final", "Object", "v", "=", "n", ".", "get", "(", "propertyName", ")", ";", "if", "(", "(", "v", "=", "=", "value", ")", "|", "|", "(", "v", "!", "=", "null", "&", "&", "v", ".", "equals", "(", "value", ")", ")", ")", "{", "ns", ".", "add", "(", "n", ")", ";", "}", "}", "return", "Collections", ".", "unmodifiableSet", "(", "ns", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "boolean", "isMe", "(", "NodeInfoImpl", "node", ")", ";", "</s>"]
["<s>", "private", "void", "nodeAdded", "(", "String", "nodeName", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "final", "NodeInfoImpl", "node", "=", "createNodeInfo", "(", "nodeName", ",", "true", ")", ";", "nodes", ".", "put", "(", "nodeName", ",", "node", ")", ";", "}", "</s>"]
["<s>", "private", "void", "nodeRemoved", "(", "String", "nodeName", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "final", "NodeInfoImpl", "node", "=", "nodes", ".", "get", "(", "nodeName", ")", ";", "if", "(", "isMe", "(", "node", ")", ")", "setOnline", "(", "false", ")", ";", "else", "leaderRemoved", "(", "nodeName", ")", ";", "nodes", ".", "remove", "(", "nodeName", ")", ";", "}", "</s>"]
["<s>", "private", "void", "leaderAdded", "(", "String", "nodeName", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "final", "NodeInfoImpl", "node", "=", "nodes", ".", "get", "(", "nodeName", ")", ";", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "return", ";", "}", "final", "NodeInfoImpl", "nodesMaster", "=", "findMaster", "(", "node", ".", "getNodeId", "(", ")", ",", "null", ")", ";", "final", "boolean", "nodeIsServer", "=", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "0", ")", ";", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "myId", ")", "{", "if", "(", "isMe", "(", "node", ")", ")", "{", "this", ".", "master", "=", "(", "node", "=", "=", "nodesMaster", ")", ";", "if", "(", "!", "this", ".", "master", ")", "assert", "this", ".", "myMaster", "=", "=", "nodesMaster", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "myId", ",", "this", ".", "master", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ",", "this", ".", "master", "?", "\"", "\"", ":", "\"", "<STR_LIT>", "\"", "+", "nodesMaster", "}", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "setOnline", "(", "true", ")", ";", "}", "else", "if", "(", "node", "=", "=", "nodesMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "this", ".", "myMaster", "=", "node", ";", "masters", ".", "put", "(", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "}", "else", "if", "(", "online", "&", "&", "this", ".", "master", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "mySlaves", ".", "add", "(", "node", ")", ";", "fireSlaveAdded", "(", "node", ")", ";", "}", "}", "else", "if", "(", "node", "=", "=", "nodesMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "final", "boolean", "switchover", "=", "masters", ".", "containsKey", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "masters", ".", "put", "(", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "if", "(", "nodeIsServer", ")", "{", "this", ".", "server", "=", "node", ";", "}", "if", "(", "switchover", ")", "{", "fireNodeSwitched", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "else", "{", "activeNodes", ".", "add", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "fireNodeAdded", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "}", "else", "{", "if", "(", "nodeIsServer", ")", "slaveServers", ".", "add", "(", "node", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "node", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "leaderRemoved", "(", "String", "nodeName", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "final", "NodeInfoImpl", "node", "=", "nodes", ".", "get", "(", "nodeName", ")", ";", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "return", ";", "}", "final", "boolean", "nodeIsServer", "=", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "0", ")", ";", "final", "NodeInfoImpl", "oldMaster", "=", "masters", ".", "get", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "if", "(", "nodeIsServer", ")", "{", "slaveServers", ".", "remove", "(", "node", ")", ";", "}", "final", "NodeInfoImpl", "newMaster", "=", "findMaster", "(", "node", ".", "getNodeId", "(", ")", ",", "nodeName", ")", ";", "if", "(", "oldMaster", "!", "=", "node", ")", "{", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "myId", "&", "&", "this", ".", "master", ")", "{", "if", "(", "mySlaves", ".", "remove", "(", "node", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "fireSlaveRemoved", "(", "node", ")", ";", "}", "}", "else", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "}", "else", "{", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "myId", ")", "{", "if", "(", "newMaster", "=", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "online", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "setOnline", "(", "false", ")", ";", "}", "else", "if", "(", "isMe", "(", "newMaster", ")", ")", "{", "if", "(", "!", "this", ".", "master", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "myMaster", "=", "null", ";", "masters", ".", "remove", "(", "myId", ")", ";", "setMaster", "(", "true", ")", ";", "}", "}", "else", "{", "if", "(", "this", ".", "master", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "newMaster", ")", ";", "masters", ".", "put", "(", "newMaster", ".", "getNodeId", "(", ")", ",", "newMaster", ")", ";", "setMyMaster", "(", "newMaster", ")", ";", "}", "}", "}", "else", "{", "if", "(", "nodeIsServer", ")", "this", ".", "server", "=", "newMaster", ";", "if", "(", "newMaster", "=", "=", "null", ")", "{", "if", "(", "masters", ".", "remove", "(", "node", ".", "getNodeId", "(", ")", ")", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ")", ";", "activeNodes", ".", "remove", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "fireNodeRemoved", "(", "node", ".", "getNodeId", "(", ")", ")", ";", "}", "}", "else", "{", "if", "(", "masters", ".", "put", "(", "newMaster", ".", "getNodeId", "(", ")", ",", "newMaster", ")", "!", "=", "newMaster", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getNodeId", "(", ")", ",", "newMaster", ")", ";", "fireNodeSwitched", "(", "newMaster", ".", "getNodeId", "(", ")", ")", ";", "}", "}", "}", "}", "}", "</s>"]
["<s>", "private", "NodeInfoImpl", "findMaster", "(", "short", "nodeId", ",", "String", "oldMaster", ")", "{", "for", "(", "String", "nodeName", ":", "controlTree", ".", "getChildren", "(", "LEADERS", ")", ")", "{", "if", "(", "oldMaster", "!", "=", "null", "&", "&", "oldMaster", ".", "equals", "(", "nodeName", ")", ")", "continue", ";", "final", "NodeInfoImpl", "node", "=", "nodes", ".", "get", "(", "nodeName", ")", ";", "if", "(", "node", "!", "=", "null", ")", "{", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "nodeId", ")", "return", "node", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "boolean", "isSecondSlave", "(", ")", "{", "int", "counter", "=", "0", ";", "for", "(", "String", "nodeName", ":", "controlTree", ".", "getChildren", "(", "LEADERS", ")", ")", "{", "final", "NodeInfoImpl", "node", "=", "nodes", ".", "get", "(", "nodeName", ")", ";", "if", "(", "node", "!", "=", "null", ")", "{", "if", "(", "isMe", "(", "node", ")", ")", "break", ";", "else", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "getMyNodeId", "(", ")", ")", "counter", "+", "+", ";", "}", "}", "return", "(", "counter", ">", "1", ")", ";", "}", "</s>"]
["<s>", "private", "List", "<", "NodeInfoImpl", ">", "findSlaves", "(", "short", "nodeId", ")", "{", "List", "<", "NodeInfoImpl", ">", "slaves", "=", "new", "ArrayList", "<", "NodeInfoImpl", ">", "(", ")", ";", "boolean", "foundMaster", "=", "false", ";", "for", "(", "String", "nodeName", ":", "controlTree", ".", "getChildren", "(", "LEADERS", ")", ")", "{", "final", "NodeInfoImpl", "node", "=", "nodes", ".", "get", "(", "nodeName", ")", ";", "assert", "node", "!", "=", "null", ";", "if", "(", "node", ".", "getNodeId", "(", ")", "=", "=", "nodeId", ")", "{", "if", "(", "foundMaster", ")", "slaves", ".", "add", "(", "node", ")", ";", "else", "foundMaster", "=", "true", ";", "}", "}", "return", "slaves", ";", "}", "</s>"]
["<s>", "protected", "NodeInfoImpl", "createNodeInfo", "(", "String", "nodeName", ",", "boolean", "attachToTree", ")", "{", "return", "new", "NodeInfoImpl", "(", "nodeName", ",", "attachToTree", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addLifecycleListener", "(", "LifecycleListener", "listener", ")", "{", "lifecycleListeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeLifecycleListener", "(", "LifecycleListener", "listener", ")", "{", "lifecycleListeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addSlaveConfigurationListener", "(", "SlaveConfigurationListener", "listener", ")", "{", "slaveConfigurationListeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeSlaveConfigurationListener", "(", "SlaveConfigurationListener", "listener", ")", "{", "slaveConfigurationListeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addNodeChangeListener", "(", "NodeChangeListener", "listener", ")", "{", "nodeChangeListeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeNodeChangeListener", "(", "NodeChangeListener", "listener", ")", "{", "nodeChangeListeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMasterNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", "{", "assertPropertyRegistered", "(", "property", ")", ";", "masterNodePropertyListeners", ".", "put", "(", "property", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeMasterNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", "{", "masterNodePropertyListeners", ".", "remove", "(", "property", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addSlaveNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", "{", "assertPropertyRegistered", "(", "property", ")", ";", "slaveNodePropertyListeners", ".", "put", "(", "property", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeSlaveNodePropertyListener", "(", "String", "property", ",", "NodePropertyListener", "listener", ")", "{", "slaveNodePropertyListeners", ".", "remove", "(", "property", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "private", "void", "fireJoinedCluster", "(", ")", "{", "for", "(", "LifecycleListener", "listener", ":", "lifecycleListeners", ")", "{", "try", "{", "listener", ".", "joinedCluster", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireOnline", "(", ")", "{", "for", "(", "LifecycleListener", "listener", ":", "lifecycleListeners", ")", "{", "try", "{", "listener", ".", "online", "(", "master", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireOffline", "(", ")", "{", "for", "(", "LifecycleListener", "listener", ":", "lifecycleListeners", ")", "{", "try", "{", "listener", ".", "offline", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireSwitchToMaster", "(", ")", "{", "for", "(", "LifecycleListener", "listener", ":", "lifecycleListeners", ")", "{", "try", "{", "listener", ".", "switchToMaster", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireNodeAdded", "(", "short", "id", ")", "{", "if", "(", "!", "isJoined", "(", ")", ")", "return", ";", "for", "(", "NodeChangeListener", "listener", ":", "nodeChangeListeners", ")", "{", "try", "{", "listener", ".", "nodeAdded", "(", "id", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "id", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireNodeSwitched", "(", "short", "id", ")", "{", "if", "(", "!", "isJoined", "(", ")", ")", "return", ";", "for", "(", "NodeChangeListener", "listener", ":", "nodeChangeListeners", ")", "{", "try", "{", "listener", ".", "nodeSwitched", "(", "id", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireNodeRemoved", "(", "short", "id", ")", "{", "if", "(", "!", "isJoined", "(", ")", ")", "return", ";", "for", "(", "NodeChangeListener", "listener", ":", "nodeChangeListeners", ")", "{", "try", "{", "listener", ".", "nodeRemoved", "(", "id", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireSlaveAdded", "(", "NodeInfo", "node", ")", "{", "if", "(", "!", "isOnline", "(", ")", ")", "return", ";", "for", "(", "SlaveConfigurationListener", "listener", ":", "slaveConfigurationListeners", ")", "{", "try", "{", "listener", ".", "slaveAdded", "(", "node", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireSlaveRemoved", "(", "NodeInfo", "node", ")", "{", "if", "(", "!", "isOnline", "(", ")", ")", "return", ";", "for", "(", "SlaveConfigurationListener", "listener", ":", "slaveConfigurationListeners", ")", "{", "try", "{", "listener", ".", "slaveRemoved", "(", "node", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireNewMaster", "(", "NodeInfo", "node", ")", "{", "if", "(", "!", "isOnline", "(", ")", ")", "return", ";", "for", "(", "SlaveConfigurationListener", "listener", ":", "slaveConfigurationListeners", ")", "{", "try", "{", "listener", ".", "newMaster", "(", "node", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "void", "fireNodePropertyChanged", "(", "NodeInfoImpl", "node", ",", "String", "property", ",", "Object", "value", ")", "{", "if", "(", "node", "=", "=", "myNodeInfo", ")", "return", ";", "if", "(", "masters", ".", "containsValue", "(", "node", ")", ")", "{", "for", "(", "NodePropertyListener", "listener", ":", "masterNodePropertyListeners", ".", "get", "(", "property", ")", ")", "{", "try", "{", "listener", ".", "propertyChanged", "(", "node", ",", "property", ",", "value", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "else", "if", "(", "mySlaves", ".", "contains", "(", "node", ")", ")", "{", "for", "(", "NodePropertyListener", "listener", ":", "slaveNodePropertyListeners", ".", "get", "(", "property", ")", ")", "{", "try", "{", "listener", ".", "propertyChanged", "(", "node", ",", "property", ",", "value", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "ReaderWriter", "assertPropertyRegistered", "(", "String", "property", ")", "{", "final", "ReaderWriter", "rw", "=", "readerWriters", ".", "get", "(", "property", ")", ";", "if", "(", "rw", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "property", ")", ";", "return", "rw", ";", "}", "</s>"]
["<s>", "protected", "final", "Object", "readProperty", "(", "String", "property", ",", "byte", "[", "]", "value", ")", "{", "ReaderWriter", "rw", "=", "assertPropertyRegistered", "(", "property", ")", ";", "return", "rw", ".", "read", "(", "value", ")", ";", "}", "</s>"]
["<s>", "protected", "final", "byte", "[", "]", "writeProperty", "(", "String", "property", ",", "Object", "value", ")", "{", "ReaderWriter", "rw", "=", "assertPropertyRegistered", "(", "property", ")", ";", "return", "rw", ".", "write", "(", "value", ")", ";", "}", "</s>"]
["<s>", "public", "NodeInfoImpl", "(", ")", "{", "this", ".", "attached", "=", "false", ";", "}", "</s>"]
["<s>", "public", "NodeInfoImpl", "(", "String", "name", ")", "{", "this", "(", "name", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "NodeInfoImpl", "(", "String", "name", ",", "boolean", "attachToTree", ")", "{", "setName", "(", "name", ")", ";", "this", ".", "attached", "=", "attachToTree", ";", "if", "(", "attached", ")", "{", "controlTree", ".", "addListener", "(", "treeNodePath", ",", "this", ")", ";", "for", "(", "String", "child", ":", "controlTree", ".", "getChildren", "(", "treeNodePath", ")", ")", "nodeChildUpdated", "(", "treeNodePath", ",", "child", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "setName", "(", "String", "name", ")", "{", "this", ".", "name", "=", "name", ";", "this", ".", "treeNodePath", "=", "NODES", "+", "<CHAR_LIT:/>", "+", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Collection", "<", "String", ">", "getProperties", "(", ")", "{", "return", "properties", ".", "keySet", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "getTreeNodePath", "(", ")", "{", "return", "treeNodePath", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "getNodeId", "(", ")", "{", "return", "nodeId", ";", "}", "</s>"]
["<s>", "private", "void", "setNodeId", "(", "short", "nodeId", ")", "{", "assertDuringInitialization", "(", ")", ";", "if", "(", "attached", ")", "{", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "this", ".", "nodeId", "=", "nodeId", ";", "}", "</s>"]
["<s>", "public", "void", "addProperty", "(", "String", "property", ")", "{", "assertInitialized", "(", ")", ";", "if", "(", "attached", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "controlTree", ".", "create", "(", "treeNodePath", "+", "<CHAR_LIT:/>", "+", "property", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "set", "(", "String", "property", ",", "Object", "value", ")", "{", "if", "(", "attached", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "properties", ".", "get", "(", "property", ")", "!", "=", "null", ")", "{", "if", "(", "!", "properties", ".", "get", "(", "property", ")", ".", "equals", "(", "value", ")", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", "+", "property", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "else", "{", "properties", ".", "put", "(", "property", ",", "value", ")", ";", "if", "(", "isInitialized", "(", ")", ")", "{", "controlTree", ".", "set", "(", "treeNodePath", "+", "<CHAR_LIT:/>", "+", "property", ",", "writeProperty", "(", "property", ",", "value", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "get", "(", "String", "property", ")", "{", "return", "properties", ".", "get", "(", "property", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeToTree", "(", ")", "{", "assertDuringInitialization", "(", ")", ";", "if", "(", "attached", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "name", "=", "=", "null", "|", "|", "nodeId", "<", "0", ")", "throw", "new", "AssertionError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ",", "nodeId", ")", ";", "controlTree", ".", "create", "(", "treeNodePath", ",", "true", ")", ";", "controlTree", ".", "create", "(", "treeNodePath", "+", "<CHAR_LIT:/>", "+", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "controlTree", ".", "set", "(", "treeNodePath", "+", "<CHAR_LIT:/>", "+", "\"", "<STR_LIT>", "\"", ",", "Short", ".", "toString", "(", "nodeId", ")", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "property", ":", "properties", ".", "entrySet", "(", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "property", ".", "getKey", "(", ")", ",", "property", ".", "getValue", "(", ")", ")", ";", "controlTree", ".", "create", "(", "treeNodePath", "+", "<CHAR_LIT:/>", "+", "property", ".", "getKey", "(", ")", ",", "true", ")", ";", "controlTree", ".", "set", "(", "treeNodePath", "+", "<CHAR_LIT:/>", "+", "property", ".", "getKey", "(", ")", ",", "writeProperty", "(", "property", ".", "getKey", "(", ")", ",", "property", ".", "getValue", "(", ")", ")", ")", ";", "}", "controlTree", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "readChild", "(", "String", "childName", ",", "byte", "[", "]", "value", ")", "{", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "childName", ")", ")", "{", "if", "(", "this", ".", "nodeId", ">", "=", "0", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", "+", "nodeId", ")", ";", "this", ".", "nodeId", "=", "Short", ".", "parseShort", "(", "new", "String", "(", "value", ",", "Charsets", ".", "UTF_8", ")", ")", ";", "}", "else", "{", "if", "(", "value", "=", "=", "null", ")", "return", ";", "if", "(", "(", "requiredPeerNodeProperties", ".", "contains", "(", "childName", ")", "|", "|", "requiredServerProperties", ".", "contains", "(", "childName", ")", ")", "&", "&", "properties", ".", "get", "(", "childName", ")", "!", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "childName", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", "+", "properties", ".", "get", "(", "childName", ")", ")", ";", "if", "(", "readerWriters", ".", "get", "(", "childName", ")", "!", "=", "null", ")", "properties", ".", "put", "(", "childName", ",", "readProperty", "(", "childName", ",", "value", ")", ")", ";", "else", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "childName", ",", "name", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "nodeChildUpdated", "(", "parentPath", ",", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "nodeChildUpdated", "(", "String", "parentPath", ",", "String", "childName", ")", "{", "assert", "parentPath", ".", "equals", "(", "treeNodePath", ")", ";", "try", "{", "readChild", "(", "childName", ",", "controlTree", ".", "get", "(", "parentPath", "+", "<CHAR_LIT:/>", "+", "childName", ")", ")", ";", "fireNodePropertyChanged", "(", "this", ",", "childName", ",", "properties", ".", "get", "(", "childName", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildDeleted", "(", "String", "node", ",", "String", "childName", ")", "{", "assert", "!", "requiredPeerNodeProperties", ".", "contains", "(", "childName", ")", "&", "&", "!", "requiredServerProperties", ".", "contains", "(", "childName", ")", ";", "properties", ".", "remove", "(", "childName", ")", ";", "fireNodePropertyChanged", "(", "this", ",", "childName", ",", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "false", ";", "if", "(", "obj", "=", "=", "this", ")", "return", "true", ";", "if", "(", "!", "(", "obj", "instanceof", "NodeInfo", ")", ")", "return", "false", ";", "final", "NodeInfoImpl", "other", "=", "(", "NodeInfoImpl", ")", "obj", ";", "if", "(", "(", "this", ".", "name", "=", "=", "null", ")", "?", "(", "other", ".", "name", "!", "=", "null", ")", ":", "!", "this", ".", "name", ".", "equals", "(", "other", ".", "name", ")", ")", "return", "false", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "int", "hash", "=", "<NUM_LIT:3>", ";", "hash", "=", "<NUM_LIT:31>", "*", "hash", "+", "(", "this", ".", "name", "!", "=", "null", "?", "this", ".", "name", ".", "hashCode", "(", ")", ":", "0", ")", ";", "return", "hash", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "name", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "nodeId", ")", ";", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "new", "TreeMap", "<", "String", ",", "Object", ">", "(", "properties", ")", ".", "entrySet", "(", ")", ")", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ".", "append", "(", "entry", ".", "getKey", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "entry", ".", "getValue", "(", ")", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "BackupImpl", "(", "String", "name", ",", "Cluster", "cluster", ",", "ServerComm", "serverComm", ",", "SlaveComm", "slaveComm", ",", "MonitoringType", "monitoringType", ")", "{", "this", "(", "name", ",", "cluster", ",", "serverComm", ",", "slaveComm", ",", "createMonitor", "(", "monitoringType", ",", "name", ")", ")", ";", "}", "</s>"]
["<s>", "BackupImpl", "(", "String", "name", ",", "Cluster", "cluster", ",", "ServerComm", "serverComm", ",", "SlaveComm", "slaveComm", ",", "BackupMonitor", "monitor", ")", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "monitor", "=", "monitor", ";", "if", "(", "cluster", ".", "hasServer", "(", ")", "&", "&", "serverComm", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "serverComm", "=", "serverComm", ";", "this", ".", "slaveComm", "=", "slaveComm", ";", "if", "(", "slaveComm", "!", "=", "null", ")", "slaveComm", ".", "setBackup", "(", "this", ")", ";", "map", "=", "map1", ";", "}", "</s>"]
["<s>", "static", "BackupMonitor", "createMonitor", "(", "MonitoringType", "monitoringType", ",", "String", "name", ")", "{", "if", "(", "monitoringType", "=", "=", "null", ")", "return", "(", "BackupMonitor", ")", "Proxy", ".", "newProxyInstance", "(", "Cache", ".", "class", ".", "getClassLoader", "(", ")", ",", "new", "Class", "<", "?", ">", "[", "]", "{", "BackupMonitor", ".", "class", "}", ",", "DegenerateInvocationHandler", ".", "INSTANCE", ")", ";", "else", "switch", "(", "monitoringType", ")", "{", "case", "JMX", ":", "return", "new", "JMXBackupMonitor", "(", "name", ")", ";", "case", "METRICS", ":", "return", "new", "MetricsBackupMonitor", "(", ")", ";", "}", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "monitoringType", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxDelay", "(", "int", "maxDelayMillis", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxDelayNanos", "=", "TimeUnit", ".", "NANOSECONDS", ".", "convert", "(", "maxDelayMillis", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMaxDelay", "(", ")", "{", "return", "(", "int", ")", "TimeUnit", ".", "MILLISECONDS", ".", "convert", "(", "maxDelayNanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "if", "(", "serverComm", "instanceof", "Service", ")", "removeDependency", "(", "(", "Service", ")", "serverComm", ")", ";", "super", ".", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "(", "(", "Service", ")", "getCluster", "(", ")", ")", ".", "awaitAvailable", "(", ")", ";", "if", "(", "getCluster", "(", ")", ".", "getMaster", "(", "getCluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "=", "=", "null", ")", "setReady", "(", "true", ")", ";", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "if", "(", "master", ")", "startFlushThread", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "super", ".", "switchToMaster", "(", ")", ";", "if", "(", "!", "isAvailable", "(", ")", "|", "|", "!", "completedReplication", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "getCluster", "(", ")", ".", "goOffline", "(", ")", ";", "}", "else", "{", "startFlushThread", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "shutdown", "(", ")", "{", "super", ".", "shutdown", "(", ")", ";", "scheduler", ".", "shutdownNow", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setCache", "(", "Cache", "cache", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "cache", "=", "cache", ";", "}", "</s>"]
["<s>", "private", "void", "startFlushThread", "(", ")", "{", "scheduler", ".", "scheduleAtFixedRate", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "flushNow", "(", ")", ";", "}", "}", ",", "maxDelayNanos", ",", "maxDelayNanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "flushNow", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "inv", "(", "long", "id", ",", "short", "owner", ")", "{", "try", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "owner", ")", ";", "return", "!", "slaveComm", ".", "send", "(", "Message", ".", "INV", "(", "getCluster", "(", ")", ".", "getMyNodeId", "(", ")", ",", "id", ",", "owner", ")", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "startBackup", "(", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "mapLock", ".", "readLock", "(", ")", ".", "lock", "(", ")", ";", "if", "(", "copyImmediately", ")", "{", "currentBackupsLock", ".", "lock", "(", ")", ";", "if", "(", "!", "copyImmediately", ")", "currentBackupsLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "endBackup", "(", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "mapLock", ".", "readLock", "(", ")", ".", "unlock", "(", ")", ";", "if", "(", "copyImmediately", ")", "{", "currentBackupsPossiblyReady", ".", "signal", "(", ")", ";", "currentBackupsLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "backup", "(", "long", "id", ",", "long", "version", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "id", ")", ",", "version", ",", "copyImmediately", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "\"", "}", ")", ";", "if", "(", "copyImmediately", ")", "currentBackups", ".", "put", "(", "id", ",", "makeBackup", "(", "cache", ".", "getLine", "(", "id", ")", ",", "version", ")", ")", ";", "else", "map", ".", "put", "(", "id", ",", "new", "BackupEntry", "(", "id", ",", "version", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "flush", "(", ")", "{", "scheduler", ".", "submit", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "flushNow", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "flushNow", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "flushNow", "(", ")", "{", "try", "{", "final", "NonBlockingHashMapLong", "<", "BackupEntry", ">", "oldMap", "=", "map", ";", "mapLock", ".", "writeLock", "(", ")", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "oldMap", ".", "isEmpty", "(", ")", ")", "return", ";", "switchMaps", "(", ")", ";", "}", "finally", "{", "mapLock", ".", "writeLock", "(", ")", ".", "unlock", "(", ")", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "currentBackupsLock", ".", "lock", "(", ")", ";", "try", "{", "assert", "!", "copyImmediately", ";", "for", "(", "Iterator", "<", "BackupEntry", ">", "it", "=", "oldMap", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "BackupEntry", "be", "=", "it", ".", "next", "(", ")", ";", "final", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "be", ".", "id", ")", ";", "assert", "line", "!", "=", "null", ";", "synchronized", "(", "line", ")", "{", "Message", ".", "BACKUP", "backup", "=", "makeBackup", "(", "line", ",", "be", ".", "version", ")", ";", "if", "(", "backup", "!", "=", "null", ")", "{", "oldMap", ".", "remove", "(", "be", ".", "id", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "be", ".", "id", ")", ",", "be", ".", "version", ")", ";", "currentBackups", ".", "put", "(", "be", ".", "id", ",", "backup", ")", ";", "}", "else", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "be", ".", "id", ")", ",", "be", ".", "version", ")", ";", "copyImmediately", "=", "true", ";", "}", "}", "it", ".", "remove", "(", ")", ";", "}", "}", "finally", "{", "currentBackupsLock", ".", "unlock", "(", ")", ";", "}", "if", "(", "copyImmediately", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "mapLock", ".", "writeLock", "(", ")", ".", "lock", "(", ")", ";", "currentBackupsLock", ".", "lock", "(", ")", ";", "try", "{", "for", "(", "Iterator", "<", "BackupEntry", ">", "it", "=", "map", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "BackupEntry", "be", "=", "it", ".", "next", "(", ")", ";", "final", "CacheLine", "line", "=", "cache", ".", "getLine", "(", "be", ".", "id", ")", ";", "assert", "line", "!", "=", "null", ";", "synchronized", "(", "line", ")", "{", "Message", ".", "BACKUP", "backup", "=", "makeBackup", "(", "line", ",", "be", ".", "version", ")", ";", "if", "(", "backup", "!", "=", "null", ")", "{", "map", ".", "remove", "(", "be", ".", "id", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "be", ".", "id", ")", ",", "be", ".", "version", ")", ";", "currentBackups", ".", "put", "(", "be", ".", "id", ",", "backup", ")", ";", "}", "else", "oldMap", ".", "put", "(", "be", ".", "id", ",", "be", ")", ";", "}", "it", ".", "remove", "(", ")", ";", "}", "}", "finally", "{", "currentBackupsLock", ".", "unlock", "(", ")", ";", "mapLock", ".", "writeLock", "(", ")", ".", "unlock", "(", ")", ";", "}", "currentBackupsLock", ".", "lock", "(", ")", ";", "try", "{", "for", "(", "Iterator", "<", "BackupEntry", ">", "it", "=", "oldMap", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "BackupEntry", "be", "=", "it", ".", "next", "(", ")", ";", "final", "Message", ".", "BACKUP", "backup", "=", "currentBackups", ".", "get", "(", "be", ".", "id", ")", ";", "if", "(", "backup", "!", "=", "null", "&", "&", "backup", ".", "getVersion", "(", ")", ">", "=", "be", ".", "version", ")", "it", ".", "remove", "(", ")", ";", "}", "while", "(", "!", "oldMap", ".", "isEmpty", "(", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "currentBackupsPossiblyReady", ".", "await", "(", ")", ";", "}", "copyImmediately", "=", "false", ";", "}", "finally", "{", "currentBackupsLock", ".", "unlock", "(", ")", ";", "}", "}", "final", "BACKUP_PACKET", "packet", "=", "flush1", "(", ")", ";", "if", "(", "packet", "!", "=", "null", ")", "send", "(", "packet", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "Thread", ".", "currentThread", "(", ")", ".", "interrupt", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "BACKUP_PACKET", "flush1", "(", ")", "{", "currentBackupsLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "lastSent", "=", "=", "null", ")", "{", "shouldFlush", "=", "false", ";", "this", ".", "lastFlush", "=", "System", ".", "nanoTime", "(", ")", ";", "if", "(", "currentBackups", ".", "isEmpty", "(", ")", ")", "return", "null", ";", "final", "BACKUP_PACKET", "packet", ";", "packet", "=", "Message", ".", "BACKUP_PACKET", "(", "nextId", ",", "currentBackups", ".", "values", "(", ")", ")", ";", "nextId", "+", "+", ";", "lastSent", "=", "packet", ";", "currentBackups", ".", "clear", "(", ")", ";", "return", "packet", ";", "}", "else", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "long", "passedMillis", "=", "TimeUnit", ".", "MILLISECONDS", ".", "convert", "(", "System", ".", "nanoTime", "(", ")", "-", "lastFlush", ",", "TimeUnit", ".", "NANOSECONDS", ")", ";", "if", "(", "passedMillis", ">", "<NUM_LIT>", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "passedMillis", ")", ";", "shouldFlush", "=", "true", ";", "return", "null", ";", "}", "}", "finally", "{", "currentBackupsLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "send", "(", "BACKUP_PACKET", "packet", ")", "{", "monitor", ".", "addBackupPacket", "(", ")", ";", "monitor", ".", "addBackups", "(", "packet", ".", "getBackups", "(", ")", ".", "size", "(", ")", ")", ";", "try", "{", "awaitServer", "=", "true", ";", "awaitSlaves", "=", "true", ";", "if", "(", "serverComm", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "packet", ")", ";", "serverComm", ".", "send", "(", "packet", ")", ";", "}", "else", "ack", "(", "true", ")", ";", "if", "(", "!", "slaveComm", ".", "send", "(", "packet", ")", ")", "ack", "(", "false", ")", ";", "else", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "packet", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "switchMaps", "(", ")", "{", "if", "(", "map", "=", "=", "map1", ")", "map", "=", "map2", ";", "else", "map", "=", "map1", ";", "}", "</s>"]
["<s>", "private", "Message", ".", "BACKUP", "makeBackup", "(", "CacheLine", "line", ",", "long", "version", ")", "{", "if", "(", "line", ".", "getVersion", "(", ")", "!", "=", "version", ")", "return", "null", ";", "final", "ByteBuffer", "buffer", "=", "ByteBuffer", ".", "allocate", "(", "line", ".", "getData", "(", ")", ".", "limit", "(", ")", ")", ";", "line", ".", "rewind", "(", ")", ";", "buffer", ".", "put", "(", "line", ".", "getData", "(", ")", ")", ";", "line", ".", "rewind", "(", ")", ";", "buffer", ".", "flip", "(", ")", ";", "final", "Message", ".", "BACKUP", "backup", "=", "Message", ".", "BACKUP", "(", "line", ".", "getId", "(", ")", ",", "line", ".", "getVersion", "(", ")", ",", "buffer", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "backup", ".", "getVersion", "(", ")", ",", "hex", "(", "backup", ".", "getLine", "(", ")", ")", ",", "backup", ".", "getData", "(", ")", "!", "=", "null", "?", "\"", "<STR_LIT:(>", "\"", "+", "backup", ".", "getData", "(", ")", ".", "remaining", "(", ")", "+", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", "}", ")", ";", "return", "backup", ";", "}", "</s>"]
["<s>", "private", "void", "serverAck", "(", "Message", "message", ")", "{", "final", "BACKUP_PACKETACK", "ack", "=", "(", "BACKUP_PACKETACK", ")", "message", ";", "if", "(", "ack", ".", "getId", "(", ")", "!", "=", "lastSent", ".", "getId", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "ack", ".", "getId", "(", ")", ",", "lastSent", ".", "getId", "(", ")", ")", ";", "return", ";", "}", "ack", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slavesAck", "(", "long", "id", ")", "{", "if", "(", "lastSent", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "return", ";", "}", "if", "(", "id", "!", "=", "lastSent", ".", "getId", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "lastSent", ".", "getId", "(", ")", ")", ";", "return", ";", "}", "ack", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slavesInvAck", "(", "long", "id", ")", "{", "cache", ".", "receive", "(", "Message", ".", "INVACK", "(", "getCluster", "(", ")", ".", "getMyNodeId", "(", ")", ",", "id", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "ack", "(", "boolean", "server", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "server", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "BACKUP_PACKET", "packet", "=", "null", ";", "final", "BACKUP_PACKET", "_lastSent", ";", "currentBackupsLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "server", "&", "&", "awaitSlaves", ")", "{", "awaitServer", "=", "false", ";", "return", ";", "}", "if", "(", "!", "server", "&", "&", "awaitServer", ")", "{", "awaitSlaves", "=", "false", ";", "return", ";", "}", "_lastSent", "=", "lastSent", ";", "lastSent", "=", "null", ";", "awaitServer", "=", "false", ";", "awaitSlaves", "=", "false", ";", "if", "(", "shouldFlush", ")", "packet", "=", "flush1", "(", ")", ";", "}", "finally", "{", "currentBackupsLock", ".", "unlock", "(", ")", ";", "}", "for", "(", "BACKUP", "backup", ":", "_lastSent", ".", "getBackups", "(", ")", ")", "cache", ".", "receive", "(", "Message", ".", "BACKUPACK", "(", "(", "short", ")", "0", ",", "backup", ".", "getLine", "(", ")", ",", "backup", ".", "getVersion", "(", ")", ")", ".", "setIncoming", "(", ")", ")", ";", "if", "(", "packet", "!", "=", "null", ")", "send", "(", "packet", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Iterator", "<", "BACKUP", ">", "iterOwned", "(", ")", "{", "final", "Iterator", "<", "Cache", ".", "CacheLine", ">", "it", "=", "cache", ".", "ownedIterator", "(", ")", ";", "return", "new", "Iterator", "<", "BACKUP", ">", "(", ")", "{", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasNext", "(", ")", ";", "}", "@", "Override", "public", "BACKUP", "next", "(", ")", "{", "final", "Cache", ".", "CacheLine", "line", "=", "it", ".", "next", "(", ")", ";", "synchronized", "(", "line", ")", "{", "monitor", ".", "addReplicationBackup", "(", "1", ")", ";", "return", "(", "BACKUP", ")", "Message", ".", "BACKUP", "(", "line", ".", "getId", "(", ")", ",", "line", ".", "getVersion", "(", ")", ",", "line", ".", "getData", "(", ")", ")", ".", "cloneDataBuffers", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasNext", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "BACKUP", "next", "(", ")", "{", "final", "Cache", ".", "CacheLine", "line", "=", "it", ".", "next", "(", ")", ";", "synchronized", "(", "line", ")", "{", "monitor", ".", "addReplicationBackup", "(", "1", ")", ";", "return", "(", "BACKUP", ")", "Message", ".", "BACKUP", "(", "line", ".", "getId", "(", ")", ",", "line", ".", "getVersion", "(", ")", ",", "line", ".", "getData", "(", ")", ")", ".", "cloneDataBuffers", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "BACKUP_PACKETACK", ":", "serverAck", "(", "message", ")", ";", "break", ";", "case", "BACKUP_PACKET", ":", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "else", "{", "monitor", ".", "addBackupPacket", "(", ")", ";", "monitor", ".", "addBackups", "(", "(", "(", "BACKUP_PACKET", ")", "message", ")", ".", "getBackups", "(", ")", ".", "size", "(", ")", ")", ";", "handleReceivedBackupPacket", "(", "(", "BACKUP_PACKET", ")", "message", ")", ";", "}", "break", ";", "case", "BACKUP", ":", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "else", "{", "monitor", ".", "addReplicationBackup", "(", "1", ")", ";", "handleReceivedBackup", "(", "(", "BACKUP", ")", "message", ")", ";", "}", "break", ";", "case", "INV", ":", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "else", "handleReceivedInvalidate", "(", "(", "INV", ")", "message", ")", ";", "break", ";", "default", ":", "}", "}", "</s>"]
["<s>", "private", "void", "handleReceivedBackupPacket", "(", "BACKUP_PACKET", "packet", ")", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "packet", ")", ";", "for", "(", "BACKUP", "backup", ":", "packet", ".", "getBackups", "(", ")", ")", "cache", ".", "receive", "(", "backup", ")", ";", "slaveComm", ".", "send", "(", "Message", ".", "BACKUP_PACKETACK", "(", "packet", ")", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleReceivedBackup", "(", "BACKUP", "backup", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "backup", ")", ";", "if", "(", "backup", ".", "getLine", "(", ")", "<", "0", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "completedReplication", "=", "true", ";", "setReady", "(", "true", ")", ";", "}", "else", "cache", ".", "receive", "(", "backup", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleReceivedInvalidate", "(", "INV", "inv", ")", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "inv", ")", ";", "cache", ".", "receive", "(", "inv", ")", ";", "slaveComm", ".", "send", "(", "Message", ".", "INVACK", "(", "inv", ")", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "BackupEntry", "(", "long", "id", ",", "long", "version", ")", "{", "this", ".", "id", "=", "id", ";", "this", ".", "version", "=", "version", ";", "}", "</s>"]
["<s>", "void", "setMonitoredObject", "(", "Object", "obj", ")", ";", "</s>"]
["<s>", "void", "addObjectServed", "(", ")", ";", "</s>"]
["<s>", "void", "addOwnerServed", "(", ")", ";", "</s>"]
["<s>", "void", "addOwnerWrite", "(", ")", ";", "</s>"]
["<s>", "void", "addTransaction", "(", "int", "numWrites", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "addReplicationBackup", "(", "int", "num", ")", "{", "replicationBackups", ".", "mark", "(", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addBackups", "(", "int", "num", ")", "{", "backups", ".", "mark", "(", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addBackupPacket", "(", ")", "{", "backupPackets", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addSlaveAckTime", "(", "long", "nanos", ")", "{", "slavesAckTime", ".", "update", "(", "nanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addServerAckTime", "(", "long", "nanos", ")", "{", "serverAckTime", ".", "update", "(", "nanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "Cache", "(", "String", "name", ",", "Cluster", "cluster", ",", "Comm", "comm", ",", "CacheStorage", "storage", ",", "Backup", "backup", ",", "MonitoringType", "monitoringType", ",", "long", "maxCapacity", ")", "{", "this", "(", "name", ",", "cluster", ",", "comm", ",", "storage", ",", "backup", ",", "createMonitor", "(", "monitoringType", ",", "name", ")", ",", "maxCapacity", ")", ";", "}", "</s>"]
["<s>", "Cache", "(", "String", "name", ",", "Cluster", "cluster", ",", "Comm", "comm", ",", "CacheStorage", "storage", ",", "Backup", "backup", ",", "CacheMonitor", "monitor", ",", "long", "maxCapacity", ")", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "comm", "=", "comm", ";", "this", ".", "storage", "=", "storage", ";", "this", ".", "hasServer", "=", "cluster", ".", "hasServer", "(", ")", ";", "this", ".", "monitor", "=", "monitor", ";", "this", ".", "backup", "=", "backup", ";", "this", ".", "idAllocator", "=", "new", "IdAllocator", "(", "this", ",", "(", "RefAllocator", ")", "cluster", ")", ";", "if", "(", "DIRTY_READS", ")", "this", ".", "ownerClocks", "=", "new", "NonBlockingHashMapLong", "<", "OwnerClock", ">", "(", ")", ";", "else", "this", ".", "ownerClocks", "=", "null", ";", "this", ".", "monitor", ".", "setMonitoredObject", "(", "this", ")", ";", "getCluster", "(", ")", ".", "addNodeChangeListener", "(", "this", ")", ";", "this", ".", "comm", ".", "setReceiver", "(", "this", ")", ";", "this", ".", "backup", ".", "setCache", "(", "this", ")", ";", "this", ".", "owned", "=", "new", "NonBlockingHashMapLong", "<", "CacheLine", ">", "(", ")", ";", "this", ".", "shared", "=", "buildSharedCache", "(", "maxCapacity", ")", ";", "this", ".", "pendingOps", "=", "new", "NonBlockingHashMapLong", "<", "ArrayList", "<", "Op", ">", ">", "(", ")", ";", "this", ".", "pendingMessages", "=", "new", "NonBlockingHashMapLong", "<", "HashSet", "<", "LineMessage", ">", ">", "(", ")", ";", "}", "</s>"]
["<s>", "private", "ConcurrentMap", "<", "Long", ",", "CacheLine", ">", "buildSharedCache", "(", "long", "maxCapacity", ")", "{", "return", "new", "ConcurrentLinkedHashMap", ".", "Builder", "<", "Long", ",", "CacheLine", ">", "(", ")", ".", "initialCapacity", "(", "<NUM_LIT:1000>", ")", ".", "maximumWeightedCapacity", "(", "maxCapacity", ")", ".", "weigher", "(", "new", "Weigher", "<", "CacheLine", ">", "(", ")", "{", "@", "Override", "public", "int", "weightOf", "(", "CacheLine", "line", ")", "{", "return", "1", "+", "line", ".", "size", "(", ")", ";", "}", "}", ")", ".", "listener", "(", "new", "EvictionListener", "<", "Long", ",", "CacheLine", ">", "(", ")", "{", "@", "Override", "public", "void", "onEviction", "(", "Long", "id", ",", "CacheLine", "line", ")", "{", "evictLine", "(", "line", ",", "true", ")", ";", "}", "}", ")", ".", "build", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "weightOf", "(", "CacheLine", "line", ")", "{", "return", "1", "+", "line", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "onEviction", "(", "Long", "id", ",", "CacheLine", "line", ")", "{", "evictLine", "(", "line", ",", "true", ")", ";", "}", "</s>"]
["<s>", "static", "CacheMonitor", "createMonitor", "(", "MonitoringType", "monitoringType", ",", "String", "name", ")", "{", "if", "(", "monitoringType", "=", "=", "null", ")", "return", "(", "CacheMonitor", ")", "Proxy", ".", "newProxyInstance", "(", "Cache", ".", "class", ".", "getClassLoader", "(", ")", ",", "new", "Class", "<", "?", ">", "[", "]", "{", "CacheMonitor", ".", "class", "}", ",", "DegenerateInvocationHandler", ".", "INSTANCE", ")", ";", "else", "switch", "(", "monitoringType", ")", "{", "case", "JMX", ":", "return", "new", "JMXCacheMonitor", "(", "name", ")", ";", "case", "METRICS", ":", "return", "new", "MetricsCacheMonitor", "(", ")", ";", "}", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "monitoringType", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setCompareBeforeWrite", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "compareBeforeWrite", "=", "value", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isCompareBeforeWrite", "(", ")", "{", "return", "compareBeforeWrite", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxItemSize", "(", "int", "maxItemSize", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxItemSize", "=", "maxItemSize", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMaxItemSize", "(", ")", "{", "return", "maxItemSize", ";", "}", "</s>"]
["<s>", "public", "void", "setReuseLines", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "reuseLines", "=", "value", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isReuseLines", "(", ")", "{", "return", "reuseLines", ";", "}", "</s>"]
["<s>", "public", "void", "setReuseSharerSets", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "reuseSharerSets", "=", "value", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isReuseSharerSets", "(", ")", "{", "return", "reuseSharerSets", ";", "}", "</s>"]
["<s>", "public", "void", "setRollbackSupported", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "rollbackSupported", "=", "value", ";", "}", "</s>"]
["<s>", "public", "void", "setSynchronous", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "synchronous", "=", "value", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isRollbackSupported", "(", ")", "{", "return", "rollbackSupported", ";", "}", "</s>"]
["<s>", "private", "Checksum", "getChecksum", "(", ")", "{", "assert", "compareBeforeWrite", ";", "return", "new", "DoubleHasher", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "if", "(", "synchronous", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "freeLineList", "=", "reuseLines", "?", "new", "ConcurrentLinkedDeque", "<", "CacheLine", ">", "(", ")", ":", "null", ";", "this", ".", "freeSharerSetList", "=", "reuseSharerSets", "?", "new", "ConcurrentLinkedDeque", "<", "TShortHashSet", ">", "(", ")", ":", "null", ";", "this", ".", "broadcastsRoutedToServer", "=", "hasServer", "&", "&", "(", "(", "AbstractComm", ")", "comm", ")", ".", "isSendToServerInsteadOfMulticast", "(", ")", ";", "}", "</s>"]
["<s>", "void", "allocatorReady", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "getCluster", "(", ")", ".", "isOnline", "(", ")", "&", "&", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "setReady", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "if", "(", "idAllocator", ".", "isReady", "(", ")", ")", "setReady", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "awaitAvailable", "(", ")", "throws", "InterruptedException", "{", "super", ".", "awaitAvailable", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiver", "=", "receiver", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasServer", "(", ")", "{", "return", "hasServer", ";", "}", "</s>"]
["<s>", "public", "void", "addCacheListener", "(", "CacheListener", "listener", ")", "{", "listeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeCacheListener", "(", "CacheListener", "listener", ")", "{", "listeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "Iterator", "<", "CacheLine", ">", "ownedIterator", "(", ")", "{", "return", "owned", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isLessThan", "(", "State", "other", ")", "{", "return", "compareTo", "(", "other", ")", "<", "0", ";", "}", "</s>"]
["<s>", "public", "long", "getId", "(", ")", "{", "return", "id", ";", "}", "</s>"]
["<s>", "private", "void", "clearFlags", "(", ")", "{", "flags", "=", "0", ";", "}", "</s>"]
["<s>", "void", "lock", "(", ")", "{", "flags", "|", "=", "LOCKED", ";", "}", "</s>"]
["<s>", "boolean", "unlock", "(", ")", "{", "if", "(", "!", "isLocked", "(", ")", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "flags", "&", "=", "~", "LOCKED", ";", "return", "true", ";", "}", "</s>"]
["<s>", "public", "boolean", "isLocked", "(", ")", "{", "return", "(", "flags", "&", "LOCKED", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "public", "boolean", "is", "(", "byte", "flag", ")", "{", "return", "(", "flags", "&", "flag", ")", "!", "=", "0", ";", "}", "</s>"]
["<s>", "private", "void", "set", "(", "byte", "flag", ",", "boolean", "value", ")", "{", "flags", "=", "(", "byte", ")", "(", "value", "?", "(", "flags", "|", "flag", ")", ":", "(", "flags", "&", "~", "flag", ")", ")", ";", "}", "</s>"]
["<s>", "public", "State", "getNextState", "(", ")", "{", "return", "nextState", ";", "}", "</s>"]
["<s>", "public", "short", "getOwner", "(", ")", "{", "return", "owner", ";", "}", "</s>"]
["<s>", "public", "State", "getState", "(", ")", "{", "return", "state", ";", "}", "</s>"]
["<s>", "public", "long", "getVersion", "(", ")", "{", "return", "version", ";", "}", "</s>"]
["<s>", "public", "long", "getOwnerClock", "(", ")", "{", "return", "ownerClock", ";", "}", "</s>"]
["<s>", "public", "void", "setOwnerClock", "(", "long", "clock", ")", "{", "this", ".", "ownerClock", "=", "clock", ";", "}", "</s>"]
["<s>", "public", "ByteBuffer", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "public", "CacheListener", "getListener", "(", ")", "{", "return", "listener", ";", "}", "</s>"]
["<s>", "public", "void", "setListener", "(", "CacheListener", "listener", ")", "{", "this", ".", "listener", "=", "listener", ";", "}", "</s>"]
["<s>", "public", "int", "size", "(", ")", "{", "return", "data", "!", "=", "null", "?", "data", ".", "capacity", "(", ")", ":", "0", ";", "}", "</s>"]
["<s>", "public", "void", "rewind", "(", ")", "{", "if", "(", "data", "!", "=", "null", ")", "data", ".", "rewind", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "StringBuffer", "sb", "=", "new", "StringBuffer", "(", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "hex", "(", "id", ")", ")", ";", "sb", ".", "append", "(", "\"", "\"", ")", ".", "append", "(", "state", ")", ".", "append", "(", "\"", "\"", ")", ";", "if", "(", "nextState", "!", "=", "null", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "nextState", ")", ".", "append", "(", "\"", "<STR_LIT:)>", "\"", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "owner", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "sharers", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "version", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "data", "!", "=", "null", "?", "\"", "<STR_LIT:(>", "\"", "+", "size", "(", ")", "+", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "isLocked", "(", ")", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "is", "(", "MODIFIED", ")", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "is", "(", "SLAVE", ")", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "is", "(", "DELETED", ")", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isLocked", "(", "long", "id", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "return", "false", ";", "else", "synchronized", "(", "line", ")", "{", "return", "line", ".", "isLocked", "(", ")", ";", "}", "}", "</s>"]
["<s>", "State", "getState", "(", "long", "id", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "return", "null", ";", "else", "synchronized", "(", "line", ")", "{", "return", "line", ".", "getState", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Object", "doOp", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "Object", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "if", "(", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "type", "!", "=", "Op", ".", "Type", ".", "LSTN", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "type", ",", "hex", "(", "id", ")", ",", "(", "data", "!", "=", "null", "?", "\"", "<STR_LIT>", "\"", "+", "data", ":", "\"", "\"", ")", ",", "(", "extra", "!", "=", "null", "?", "\"", "<STR_LIT>", "\"", "+", "extra", ":", "\"", "\"", ")", "}", ")", ";", "Object", "result", "=", "runFastTrack", "(", "id", ",", "type", ",", "data", ",", "extra", ",", "txn", ")", ";", "if", "(", "result", "instanceof", "Op", ")", "return", "doOp", "(", "(", "Op", ")", "result", ")", ";", "else", "if", "(", "result", "=", "=", "PENDING", ")", "{", "if", "(", "Thread", ".", "currentThread", "(", ")", "instanceof", "CommThread", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "doOp", "(", "new", "Op", "(", "type", ",", "id", ",", "data", ",", "extra", ",", "txn", ")", ")", ";", "}", "else", "return", "result", ";", "}", "</s>"]
["<s>", "public", "ListenableFuture", "<", "Object", ">", "doOpAsync", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "Object", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "if", "(", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "type", ",", "hex", "(", "id", ")", ",", "(", "data", "!", "=", "null", "?", "\"", "<STR_LIT>", "\"", "+", "data", ":", "\"", "\"", ")", ",", "(", "extra", "!", "=", "null", "?", "\"", "<STR_LIT>", "\"", "+", "extra", ":", "\"", "\"", ")", "}", ")", ";", "Object", "result", "=", "runFastTrack", "(", "id", ",", "type", ",", "data", ",", "extra", ",", "txn", ")", ";", "if", "(", "result", "instanceof", "Op", ")", "return", "doOpAsync", "(", "(", "Op", ")", "result", ")", ";", "else", "if", "(", "result", "=", "=", "PENDING", ")", "return", "doOpAsync", "(", "new", "Op", "(", "type", ",", "id", ",", "data", ",", "extra", ",", "txn", ")", ")", ";", "else", "return", "Futures", ".", "immediateFuture", "(", "result", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "doOp", "(", "Op", "op", ")", "throws", "TimeoutException", "{", "try", "{", "if", "(", "op", ".", "txn", "!", "=", "null", ")", "op", ".", "txn", ".", "add", "(", "op", ")", ";", "Object", "result", "=", "runOp", "(", "op", ")", ";", "if", "(", "result", "=", "=", "PENDING", ")", "return", "op", ".", "getResult", "(", "timeout", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "else", "return", "result", ";", "}", "catch", "(", "java", ".", "util", ".", "concurrent", ".", "TimeoutException", "e", ")", "{", "throw", "new", "TimeoutException", "(", "e", ")", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "return", "null", ";", "}", "catch", "(", "ExecutionException", "e", ")", "{", "Throwable", "ex", "=", "e", ".", "getCause", "(", ")", ";", "if", "(", "ex", "instanceof", "TimeoutException", ")", "throw", "(", "TimeoutException", ")", "ex", ";", "Throwables", ".", "propagateIfPossible", "(", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "ListenableFuture", "<", "Object", ">", "doOpAsync", "(", "Op", "op", ")", "{", "if", "(", "op", ".", "txn", "!", "=", "null", ")", "op", ".", "txn", ".", "add", "(", "op", ")", ";", "Object", "result", "=", "runOp", "(", "op", ")", ";", "if", "(", "result", "=", "=", "PENDING", ")", "return", "op", ".", "getFuture", "(", ")", ";", "else", "return", "Futures", ".", "immediateFuture", "(", "result", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "runFastTrack", "(", "long", "id", ",", "Op", ".", "Type", "type", ",", "Object", "data", ",", "Object", "extra", ",", "Transaction", "txn", ")", "{", "if", "(", "!", "type", ".", "isOf", "(", "FAST_TRACK_OPS", ")", ")", "return", "PENDING", ";", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "{", "final", "Object", "res", "=", "handleOpNoLine", "(", "type", ",", "id", ",", "extra", ")", ";", "if", "(", "res", "!", "=", "DIDNT_HANDLE", ")", "return", "res", ";", "return", "PENDING", ";", "}", "Object", "res", ";", "synchronized", "(", "line", ")", "{", "res", "=", "handleOp", "(", "line", ",", "type", ",", "data", ",", "extra", ",", "txn", ",", "false", ",", "LINE_EVERYTHING_CHANGED", ")", ";", "}", "if", "(", "res", "!", "=", "PENDING", ")", "monitor", ".", "addOp", "(", "type", ",", "0", ")", ";", "return", "res", ";", "}", "</s>"]
["<s>", "Object", "runOp", "(", "Op", "op", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "op", ")", ";", "recursive", ".", "set", "(", "Boolean", ".", "TRUE", ")", ";", "try", "{", "if", "(", "op", ".", "type", "=", "=", "Op", ".", "Type", ".", "PUT", "|", "|", "op", ".", "type", "=", "=", "Op", ".", "Type", ".", "ALLOC", ")", "return", "execOp", "(", "op", ",", "null", ")", ";", "final", "long", "id", "=", "op", ".", "line", ";", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "{", "Object", "res", "=", "handleOpNoLine", "(", "op", ".", "type", ",", "op", ".", "line", ",", "op", ".", "getExtra", "(", ")", ")", ";", "if", "(", "res", "!", "=", "DIDNT_HANDLE", ")", "return", "res", ";", "else", "line", "=", "(", "CacheLine", ")", "createNewCacheLine", "(", "op", ")", ";", "}", "final", "Object", "res", ";", "synchronized", "(", "line", ")", "{", "res", "=", "execOp", "(", "op", ",", "line", ")", ";", "}", "receiveShortCircuit", "(", ")", ";", "if", "(", "res", "instanceof", "Op", ")", "return", "runOp", "(", "(", "Op", ")", "res", ")", ";", "return", "res", ";", "}", "finally", "{", "recursive", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Object", "execOp", "(", "Op", "op", ",", "CacheLine", "line", ")", "{", "Object", "res", ";", "try", "{", "res", "=", "handleOp", "(", "line", ",", "op", ",", "false", ",", "LINE_EVERYTHING_CHANGED", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "if", "(", "op", ".", "hasFuture", "(", ")", ")", "{", "op", ".", "setException", "(", "t", ")", ";", "return", "null", ";", "}", "else", "{", "return", "Throwables", ".", "propagate", "(", "t", ")", ";", "}", "}", "if", "(", "res", "=", "=", "PENDING", ")", "{", "op", ".", "setStartTime", "(", "System", ".", "nanoTime", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "op", ",", "line", ")", ";", "addPendingOp", "(", "line", ",", "op", ")", ";", "}", "return", "res", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOp", "(", "CacheLine", "line", ",", "Op", "op", ",", "boolean", "pending", ",", "int", "lineChange", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "op", ",", "line", ")", ";", "try", "{", "Object", "res", ";", "switch", "(", "op", ".", "type", ")", "{", "case", "PUT", ":", "res", "=", "handleOpPut", "(", "op", ",", "line", ")", ";", "break", ";", "case", "ALLOC", ":", "res", "=", "handleOpAlloc", "(", "op", ",", "line", ")", ";", "break", ";", "default", ":", "res", "=", "handleOp", "(", "line", ",", "op", ".", "type", ",", "op", ".", "data", ",", "op", ".", "getExtra", "(", ")", ",", "op", ".", "txn", ",", "pending", ",", "lineChange", ")", ";", "break", ";", "}", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "op", ",", "res", ",", "line", "}", ")", ";", "if", "(", "res", "=", "=", "PENDING", ")", "return", "res", ";", "else", "if", "(", "res", "instanceof", "Op", ")", "return", "res", ";", "else", "{", "completeOp", "(", "line", ",", "op", ",", "res", ",", "pending", ")", ";", "return", "res", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "opException", "(", "line", ",", "op", ",", "e", ",", "pending", ")", ";", "return", "null", ";", "}", "}", "</s>"]
["<s>", "private", "Object", "handleOp", "(", "CacheLine", "line", ",", "Op", ".", "Type", "type", ",", "Object", "data", ",", "Object", "extra", ",", "Transaction", "txn", ",", "boolean", "pending", ",", "int", "lineChange", ")", "{", "assert", "line", "!", "=", "null", "|", "|", "type", "=", "=", "Op", ".", "Type", ".", "PUT", "|", "|", "type", "=", "=", "Op", ".", "Type", ".", "ALLOC", ";", "accessLine", "(", "line", ")", ";", "handleNodeEvents", "(", "line", ")", ";", "Object", "res", "=", "null", ";", "if", "(", "line", "!", "=", "null", "&", "&", "shouldHoldOp", "(", "line", ",", "type", ")", ")", "res", "=", "PENDING", ";", "else", "{", "switch", "(", "type", ")", "{", "case", "GET", ":", "case", "GETS", ":", "res", "=", "handleOpGet", "(", "line", ",", "type", ",", "data", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "GETX", ":", "res", "=", "handleOpGetX", "(", "line", ",", "data", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "GET_FROM_OWNER", ":", "res", "=", "handleOpGetFromOwner", "(", "line", ",", "extra", ")", ";", "break", ";", "case", "SET", ":", "res", "=", "handleOpSet", "(", "line", ",", "data", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "DEL", ":", "res", "=", "handleOpDel", "(", "line", ",", "nodeHint", "(", "extra", ")", ",", "txn", ",", "lineChange", ")", ";", "break", ";", "case", "SEND", ":", "res", "=", "handleOpSend", "(", "line", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "case", "PUSH", ":", "res", "=", "handleOpPush", "(", "line", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "case", "PUSHX", ":", "res", "=", "handleOpPushX", "(", "line", ",", "extra", ",", "lineChange", ")", ";", "break", ";", "case", "LSTN", ":", "res", "=", "handleOpListen", "(", "line", ",", "extra", ")", ";", "break", ";", "}", "}", "if", "(", "!", "pending", "&", "&", "type", ".", "isOf", "(", "HIT_OR_MISS_OPS", ")", ")", "{", "if", "(", "res", "!", "=", "PENDING", ")", "{", "if", "(", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "I", ")", "monitor", ".", "addStaleHit", "(", ")", ";", "else", "monitor", ".", "addHit", "(", ")", ";", "}", "}", "return", "res", ";", "}", "</s>"]
["<s>", "private", "void", "completeOp", "(", "CacheLine", "line", ",", "Op", "op", ",", "Object", "res", ",", "boolean", "pending", ")", "{", "long", "duration", "=", "0", ";", "if", "(", "pending", ")", "{", "assert", "op", ".", "getStartTime", "(", ")", "!", "=", "0", ";", "duration", "=", "(", "System", ".", "nanoTime", "(", ")", "-", "op", ".", "getStartTime", "(", ")", ")", "/", "<NUM_LIT:1000>", ";", "}", "if", "(", "op", ".", "hasFuture", "(", ")", ")", "op", ".", "setResult", "(", "res", ")", ";", "monitor", ".", "addOp", "(", "op", ".", "type", ",", "duration", ")", ";", "}", "</s>"]
["<s>", "private", "void", "opException", "(", "CacheLine", "line", ",", "Op", "op", ",", "Throwable", "t", ",", "boolean", "pending", ")", "{", "if", "(", "pending", ")", "{", "if", "(", "!", "op", ".", "hasFuture", "(", ")", ")", "op", ".", "createFuture", "(", ")", ";", "op", ".", "setException", "(", "t", ")", ";", "}", "else", "throw", "Throwables", ".", "propagate", "(", "t", ")", ";", "}", "</s>"]
["<s>", "protected", "Object", "handleOpNoLine", "(", "Op", ".", "Type", "type", ",", "long", "id", ",", "Object", "extra", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ")", ";", "switch", "(", "type", ")", "{", "case", "GET_FROM_OWNER", ":", "return", "extra", ";", "case", "PUSH", ":", "case", "PUSHX", ":", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ")", ";", "return", "null", ";", "default", ":", "return", "DIDNT_HANDLE", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "shouldHoldOp", "(", "CacheLine", "line", ",", "Op", ".", "Type", "op", ")", "{", "return", "(", "hasPendingMessages", "(", "line", ")", "&", "&", "op", ".", "isOf", "(", "LOCKING_OPS", ")", "&", "&", "!", "line", ".", "isLocked", "(", ")", "&", "&", "!", "(", "line", ".", "getState", "(", ")", "!", "=", "State", ".", "E", "&", "&", "line", ".", "getNextState", "(", ")", "=", "=", "State", ".", "E", ")", ")", "|", "|", "(", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", "&", "&", "op", ".", "isOf", "(", "PUSH_OPS", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handlePendingOps", "(", "CacheLine", "line", ",", "int", "change", ")", "{", "if", "(", "line", "=", "=", "null", ")", "return", ";", "for", "(", "Iterator", "<", "Op", ">", "it", "=", "getPendingOps", "(", "line", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Op", "op", "=", "it", ".", "next", "(", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "op", ",", "change", ")", ";", "if", "(", "handleOp", "(", "line", ",", "op", ",", "true", ",", "change", ")", "!", "=", "PENDING", ")", "it", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "message", ")", "{", "if", "(", "recursive", ".", "get", "(", ")", "!", "=", "Boolean", ".", "TRUE", ")", "{", "recursive", ".", "set", "(", "Boolean", ".", "TRUE", ")", ";", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive1", "(", "message", ")", ";", "receiveShortCircuit", "(", ")", ";", "}", "finally", "{", "recursive", ".", "remove", "(", ")", ";", "}", "}", "else", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "Queue", "<", "Message", ">", "ms", "=", "shortCircuitMessage", ".", "get", "(", ")", ";", "if", "(", "ms", "=", "=", "null", ")", "{", "ms", "=", "new", "ArrayDeque", "<", "Message", ">", "(", ")", ";", "shortCircuitMessage", ".", "set", "(", "ms", ")", ";", "}", "ms", ".", "add", "(", "message", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "receive1", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "MSG", ":", "handleMessageMsg", "(", "(", "Message", ".", "MSG", ")", "message", ")", ";", "return", ";", "case", "MSGACK", ":", "if", "(", "(", "(", "LineMessage", ")", "message", ")", ".", "getLine", "(", ")", "=", "=", "-", "1", ")", "{", "if", "(", "receiver", "!", "=", "null", ")", "receiver", ".", "receive", "(", "message", ")", ";", "return", ";", "}", "break", ";", "case", "BACKUP_PACKETACK", ":", "backup", ".", "receive", "(", "message", ")", ";", "return", ";", "default", ":", "}", "runMessage", "(", "(", "LineMessage", ")", "message", ")", ";", "monitor", ".", "addMessageReceived", "(", "message", ".", "getType", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "runMessage", "(", "LineMessage", "message", ")", "{", "final", "long", "id", "=", "message", ".", "getLine", "(", ")", ";", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "{", "if", "(", "handleMessageNoLine", "(", "message", ")", ")", "return", ";", "else", "line", "=", "(", "CacheLine", ")", "createNewCacheLine", "(", "message", ")", ";", "}", "synchronized", "(", "line", ")", "{", "handleMessage", "(", "message", ",", "line", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleMessageMsg", "(", "Message", ".", "MSG", "message", ")", "{", "if", "(", "receiver", "=", "=", "null", ")", "return", ";", "setOwnerClockPut", "(", "message", ")", ";", "if", "(", "message", ".", "getLine", "(", ")", "=", "=", "-", "1", ")", "{", "receiver", ".", "receive", "(", "message", ")", ";", "if", "(", "message", ".", "isReplyRequired", "(", ")", ")", "send", "(", "Message", ".", "MSGACK", "(", "message", ")", ")", ";", "return", ";", "}", "CacheLine", "line", "=", "getLine", "(", "message", ".", "getLine", "(", ")", ")", ";", "if", "(", "line", "=", "=", "null", ")", "{", "boolean", "res", "=", "handleMessageNoLine", "(", "message", ")", ";", "assert", "res", ";", "return", ";", "}", "synchronized", "(", "line", ")", "{", "if", "(", "handleNotOwner", "(", "message", ",", "line", ")", ")", "return", ";", "}", "receiver", ".", "receive", "(", "message", ")", ";", "if", "(", "message", ".", "isReplyRequired", "(", ")", ")", "send", "(", "Message", ".", "MSGACK", "(", "message", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "handleMessage", "(", "LineMessage", "message", ",", "CacheLine", "line", ")", "{", "assert", "line", "!", "=", "null", ";", "handleNodeEvents", "(", "line", ")", ";", "int", "change", "=", "handleMessage1", "(", "message", ",", "line", ")", ";", "handlePendingOps", "(", "line", ",", "change", ")", ";", "handlePendingMessagesAfterMessage", "(", "line", ",", "change", ")", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessage1", "(", "LineMessage", "message", ",", "CacheLine", "line", ")", "{", "accessLine", "(", "line", ")", ";", "if", "(", "shouldHoldMessage", "(", "line", ",", "message", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "line", ")", ";", "addPendingMessage", "(", "line", ",", "message", ")", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ")", "backup", ".", "flush", "(", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "try", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "PUT", ":", "return", "handleMessagePut", "(", "(", "Message", ".", "PUT", ")", "message", ",", "line", ")", ";", "case", "PUTX", ":", "return", "handleMessagePutX", "(", "(", "Message", ".", "PUTX", ")", "message", ",", "line", ")", ";", "case", "GET", ":", "return", "handleMessageGet", "(", "(", "Message", ".", "GET", ")", "message", ",", "line", ")", ";", "case", "GETX", ":", "return", "handleMessageGetX", "(", "(", "Message", ".", "GET", ")", "message", ",", "line", ")", ";", "case", "INV", ":", "return", "handleMessageInvalidate", "(", "(", "Message", ".", "INV", ")", "message", ",", "line", ")", ";", "case", "INVACK", ":", "return", "handleMessageInvalidateAck", "(", "message", ",", "line", ")", ";", "case", "NOT_FOUND", ":", "return", "handleMessageNotFound", "(", "message", ",", "line", ")", ";", "case", "CHNGD_OWNR", ":", "return", "handleMessageChngdOwnr", "(", "(", "Message", ".", "CHNGD_OWNR", ")", "message", ",", "line", ")", ";", "case", "MSGACK", ":", "return", "handleMessageMsgAck", "(", "message", ",", "line", ")", ";", "case", "BACKUP", ":", "return", "handleMessageBackup", "(", "(", "Message", ".", "PUT", ")", "message", ",", "line", ")", ";", "case", "BACKUPACK", ":", "return", "handleMessageBackupAck", "(", "(", "Message", ".", "BACKUPACK", ")", "message", ",", "line", ")", ";", "case", "TIMEOUT", ":", "return", "handleMessageTimeout", "(", "message", ",", "line", ")", ";", "default", ":", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "}", "catch", "(", "IrrelevantStateException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "line", ".", "state", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "}", "</s>"]
["<s>", "protected", "boolean", "handleMessageNoLine", "(", "LineMessage", "message", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "message", ".", "getLine", "(", ")", ")", ")", ";", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "INV", ":", "send", "(", "Message", ".", "INVACK", "(", "(", "Message", ".", "INV", ")", "message", ")", ")", ";", "return", "true", ";", "case", "INVACK", ":", "return", "true", ";", "case", "GET", ":", "case", "GETX", ":", "case", "MSG", ":", "handleNotOwner", "(", "message", ",", "null", ")", ";", "return", "true", ";", "default", ":", "return", "false", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "handleNotOwner", "(", "LineMessage", "msg", ",", "CacheLine", "line", ")", "{", "if", "(", "line", "!", "=", "null", "&", "&", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "{", "send", "(", "Message", ".", "NOT_FOUND", "(", "msg", ")", ")", ";", "return", "true", ";", "}", "if", "(", "line", "=", "=", "null", "|", "|", "line", ".", "state", "=", "=", "State", ".", "I", "|", "|", "line", ".", "state", "=", "=", "State", ".", "S", ")", "{", "final", "long", "id", ";", "final", "short", "owner", ";", "final", "boolean", "certain", ";", "if", "(", "line", "=", "=", "null", ")", "{", "id", "=", "msg", ".", "getLine", "(", ")", ";", "owner", "=", "(", "short", ")", "-", "1", ";", "certain", "=", "false", ";", "}", "else", "{", "id", "=", "line", ".", "getId", "(", ")", ";", "owner", "=", "line", ".", "getOwner", "(", ")", ";", "certain", "=", "(", "line", ".", "state", "=", "=", "State", ".", "S", ")", ";", "}", "if", "(", "certain", "|", "|", "!", "msg", ".", "isBroadcast", "(", ")", ")", "send", "(", "Message", ".", "CHNGD_OWNR", "(", "msg", ",", "id", ",", "owner", ",", "certain", ")", ")", ";", "else", "if", "(", "msg", ".", "isBroadcast", "(", ")", ")", "send", "(", "Message", ".", "ACK", "(", "msg", ")", ")", ";", "return", "true", ";", "}", "else", "return", "false", ";", "}", "</s>"]
["<s>", "private", "int", "handlePendingMessages", "(", "CacheLine", "line", ",", "CacheMonitor", ".", "MessageDelayReason", "reason", ")", "{", "int", "change", "=", "LINE_NO_CHANGE", ";", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "int", "messageCount", "=", "0", ";", "long", "totalDelay", "=", "0", ";", "for", "(", "LineMessage", "msg", ":", "getAndClearPendingMessages", "(", "line", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "msg", ")", ";", "change", "|", "=", "handleMessage1", "(", "msg", ",", "line", ")", ";", "messageCount", "+", "+", ";", "totalDelay", "+", "=", "now", "-", "msg", ".", "getTimestamp", "(", ")", ";", "}", "if", "(", "messageCount", ">", "0", ")", "monitor", ".", "addMessageHandlingDelay", "(", "messageCount", ",", "totalDelay", ",", "reason", ")", ";", "if", "(", "change", "!", "=", "LINE_NO_CHANGE", ")", "{", "handlePendingOps", "(", "line", ",", "change", ")", ";", "handlePendingMessagesAfterMessage", "(", "line", ",", "change", ")", ";", "}", "return", "change", ";", "}", "</s>"]
["<s>", "private", "boolean", "shouldHoldMessage", "(", "CacheLine", "line", ",", "Message", "message", ")", "{", "final", "boolean", "res", "=", "message", ".", "getType", "(", ")", ".", "isOf", "(", "MESSAGES_BLOCKED_BY_LOCK", ")", "&", "&", "(", "line", ".", "isLocked", "(", ")", "|", "|", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", "|", "|", "(", "line", ".", "getState", "(", ")", "!", "=", "State", ".", "E", "&", "&", "line", ".", "getNextState", "(", ")", "=", "=", "State", ".", "E", ")", ")", ";", "if", "(", "res", "&", "&", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "INV", "&", "&", "!", "line", ".", "isLocked", "(", ")", "&", "&", "!", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ")", "return", "false", ";", "return", "res", ";", "}", "</s>"]
["<s>", "private", "void", "handlePendingMessagesAfterMessage", "(", "CacheLine", "line", ",", "int", "change", ")", "{", "if", "(", "!", "line", ".", "isLocked", "(", ")", "&", "&", "!", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ")", "{", "CacheMonitor", ".", "MessageDelayReason", "reason", "=", "null", ";", "if", "(", "(", "change", "&", "LINE_MODIFIED_CHANGED", ")", "!", "=", "0", ")", "reason", "=", "CacheMonitor", ".", "MessageDelayReason", ".", "BACKUP", ";", "else", "if", "(", "(", "change", "&", "LINE_STATE_CHANGED", ")", "!", "=", "0", ")", "reason", "=", "CacheMonitor", ".", "MessageDelayReason", ".", "OTHER", ";", "if", "(", "reason", "!", "=", "null", ")", "handlePendingMessages", "(", "line", ",", "reason", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "send", "(", "Message", ".", "MSG", "message", ")", "{", "send", "(", "(", "Message", ")", "message", ")", ";", "monitor", ".", "addOp", "(", "Op", ".", "Type", ".", "SEND", ",", "0", ")", ";", "}", "</s>"]
["<s>", "public", "Transaction", "beginTransaction", "(", ")", "{", "return", "new", "Transaction", "(", "rollbackSupported", ")", ";", "}", "</s>"]
["<s>", "public", "void", "rollback", "(", "Transaction", "txn", ")", "{", "if", "(", "!", "rollbackSupported", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "txn", ".", "forEachRollback", "(", "new", "TLongObjectProcedure", "<", "RollbackInfo", ">", "(", ")", "{", "@", "Override", "public", "boolean", "execute", "(", "long", "id", ",", "RollbackInfo", "r", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "synchronized", "(", "line", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "r", ".", "version", ",", "r", ".", "modified", "}", ")", ";", "line", ".", "version", "=", "r", ".", "version", ";", "line", ".", "set", "(", "CacheLine", ".", "MODIFIED", ",", "r", ".", "modified", ")", ";", "writeData", "(", "line", ",", "r", ".", "data", ")", ";", "return", "true", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "execute", "(", "long", "id", ",", "RollbackInfo", "r", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "synchronized", "(", "line", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "r", ".", "version", ",", "r", ".", "modified", "}", ")", ";", "line", ".", "version", "=", "r", ".", "version", ";", "line", ".", "set", "(", "CacheLine", ".", "MODIFIED", ",", "r", ".", "modified", ")", ";", "writeData", "(", "line", ",", "r", ".", "data", ")", ";", "return", "true", ";", "}", "}", "</s>"]
["<s>", "public", "void", "endTransaction", "(", "Transaction", "txn", ",", "boolean", "abort", ")", "throws", "InterruptedException", "{", "Throwable", "ex", "=", "null", ";", "for", "(", "Op", "op", ":", "txn", ".", "getOps", "(", ")", ")", "{", "try", "{", "if", "(", "op", ".", "hasFuture", "(", ")", ")", "op", ".", "getResult", "(", ")", ";", "}", "catch", "(", "Throwable", "e", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "op", ",", "e", ")", ";", "if", "(", "ex", "=", "=", "null", ")", "ex", "=", "e", ";", "}", "}", "boolean", "flush", "=", "false", ";", "final", "ArrayList", "<", "CacheLine", ">", "unmodified", "=", "new", "ArrayList", "<", "CacheLine", ">", "(", ")", ";", "backup", ".", "startBackup", "(", ")", ";", "try", "{", "for", "(", "TLongIterator", "it", "=", "txn", ".", "getLines", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "long", "id", "=", "it", ".", "next", "(", ")", ";", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "synchronized", "(", "line", ")", "{", "if", "(", "unlockLine", "(", "line", ",", "txn", ")", ")", "{", "if", "(", "!", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ")", "unmodified", ".", "add", "(", "line", ")", ";", "else", "{", "line", ".", "set", "(", "CacheLine", ".", "SLAVE", ",", "true", ")", ";", "backup", ".", "backup", "(", "line", ".", "getId", "(", ")", ",", "line", ".", "getVersion", "(", ")", ")", ";", "if", "(", "hasPendingMessages", "(", "line", ")", ")", "flush", "=", "true", ";", "}", "}", "}", "}", "}", "finally", "{", "backup", ".", "endBackup", "(", ")", ";", "}", "if", "(", "flush", ")", "backup", ".", "flush", "(", ")", ";", "for", "(", "CacheLine", "line", ":", "unmodified", ")", "{", "synchronized", "(", "line", ")", "{", "handlePendingMessages", "(", "line", ",", "CacheMonitor", ".", "MessageDelayReason", ".", "LOCK", ")", ";", "}", "}", "if", "(", "!", "abort", ")", "{", "if", "(", "ex", "!", "=", "null", ")", "{", "if", "(", "ex", "instanceof", "ExecutionException", ")", "{", "ex", "=", "ex", ".", "getCause", "(", ")", ";", "}", "Throwables", ".", "propagateIfPossible", "(", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "release", "(", "long", "id", ")", "{", "final", "CacheLine", "line", "=", "getLine", "(", "id", ")", ";", "synchronized", "(", "line", ")", "{", "if", "(", "unlockLine", "(", "line", ",", "null", ")", ")", "{", "if", "(", "!", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ")", "handlePendingMessages", "(", "line", ",", "CacheMonitor", ".", "MessageDelayReason", ".", "LOCK", ")", ";", "else", "backupLine", "(", "line", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "backupLine", "(", "CacheLine", "line", ")", "{", "line", ".", "set", "(", "CacheLine", ".", "SLAVE", ",", "true", ")", ";", "backup", ".", "startBackup", "(", ")", ";", "backup", ".", "backup", "(", "line", ".", "getId", "(", ")", ",", "line", ".", "getVersion", "(", ")", ")", ";", "backup", ".", "endBackup", "(", ")", ";", "if", "(", "hasPendingMessages", "(", "line", ")", ")", "backup", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpGet", "(", "CacheLine", "line", ",", "Op", ".", "Type", "type", ",", "Object", "data", ",", "short", "nodeHint", ",", "Transaction", "txn", ",", "int", "change", ")", "{", "if", "(", "(", "change", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", "|", "(", "synchronous", "?", "LINE_MODIFIED_CHANGED", ":", "0", ")", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "if", "(", "!", "transitionToS", "(", "line", ",", "nodeHint", ")", ")", "{", "if", "(", "type", "!", "=", "Op", ".", "Type", ".", "GETS", "&", "&", "line", ".", "version", ">", "0", "&", "&", "!", "isPossibleInconsistencies", "(", "line", ")", ")", "{", "if", "(", "data", "!", "=", "null", ")", "{", "readData", "(", "line", ",", "(", "Persistable", ")", "data", ")", ";", "return", "null", ";", "}", "else", "return", "readData", "(", "line", ")", ";", "}", "else", "return", "PENDING", ";", "}", "if", "(", "type", "=", "=", "Op", ".", "Type", ".", "GETS", ")", "lockLine", "(", "line", ",", "txn", ")", ";", "if", "(", "data", "!", "=", "null", ")", "{", "readData", "(", "line", ",", "(", "Persistable", ")", "data", ")", ";", "return", "null", ";", "}", "else", "return", "readData", "(", "line", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpGetX", "(", "CacheLine", "line", ",", "Object", "data", ",", "short", "nodeHint", ",", "Transaction", "txn", ",", "int", "change", ")", "{", "if", "(", "(", "change", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "if", "(", "!", "transitionToE", "(", "line", ",", "nodeHint", ")", ")", "return", "PENDING", ";", "lockLine", "(", "line", ",", "txn", ")", ";", "if", "(", "data", "!", "=", "null", ")", "{", "readData", "(", "line", ",", "(", "Persistable", ")", "data", ")", ";", "return", "null", ";", "}", "else", "return", "readData", "(", "line", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpGetFromOwner", "(", "CacheLine", "line", ",", "Object", "extra", ")", "{", "final", "Op", "get", "=", "(", "Op", ")", "extra", ";", "final", "short", "owner", "=", "line", ".", "getOwner", "(", ")", ";", "if", "(", "owner", ">", "=", "0", ")", "get", ".", "setExtra", "(", "owner", ")", ";", "return", "get", ";", "}", "</s>"]
["<s>", "private", "boolean", "transitionToS", "(", "CacheLine", "line", ",", "short", "nodeHint", ")", "{", "if", "(", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "S", ")", ")", "{", "if", "(", "setNextState", "(", "line", ",", "State", ".", "S", ")", ")", "send", "(", "Message", ".", "GET", "(", "getTarget", "(", "line", ",", "nodeHint", ")", ",", "line", ".", "id", ")", ")", ";", "return", "false", ";", "}", "else", "return", "true", ";", "}", "</s>"]
["<s>", "private", "boolean", "transitionToO", "(", "CacheLine", "line", ",", "short", "nodeHint", ")", "{", "if", "(", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "if", "(", "setNextState", "(", "line", ",", "State", ".", "O", ")", ")", "send", "(", "Message", ".", "GETX", "(", "getTarget", "(", "line", ",", "nodeHint", ")", ",", "line", ".", "id", ")", ")", ";", "return", "false", ";", "}", "else", "return", "true", ";", "}", "</s>"]
["<s>", "private", "boolean", "transitionToE", "(", "CacheLine", "line", ",", "short", "nodeHint", ")", "{", "if", "(", "!", "transitionToO", "(", "line", ",", "nodeHint", ")", ")", "return", "false", ";", "assert", "!", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ";", "final", "boolean", "res", ";", "if", "(", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "E", ")", ")", "{", "if", "(", "setNextState", "(", "line", ",", "State", ".", "E", ")", ")", "{", "assert", "!", "line", ".", "sharers", ".", "isEmpty", "(", ")", ";", "for", "(", "TShortIterator", "it", "=", "line", ".", "sharers", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "short", "sharer", "=", "it", ".", "next", "(", ")", ";", "if", "(", "sharer", "!", "=", "Comm", ".", "SERVER", ")", "send", "(", "Message", ".", "INV", "(", "sharer", ",", "line", ".", "getId", "(", ")", ",", "line", ".", "getOwner", "(", ")", ")", ")", ";", "}", "}", "if", "(", "broadcastsRoutedToServer", ")", "res", "=", "!", "line", ".", "sharers", ".", "contains", "(", "Comm", ".", "SERVER", ")", ";", "else", "if", "(", "!", "hasServer", ")", "res", "=", "!", "line", ".", "sharers", ".", "contains", "(", "line", ".", "getOwner", "(", ")", ")", ";", "else", "res", "=", "true", ";", "}", "else", "res", "=", "true", ";", "if", "(", "res", ")", "line", ".", "set", "(", "CacheLine", ".", "MODIFIED", ",", "true", ")", ";", "return", "res", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpSet", "(", "CacheLine", "line", ",", "Object", "data", ",", "short", "nodeHint", ",", "Transaction", "txn", ",", "int", "change", ")", "{", "if", "(", "(", "change", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "if", "(", "!", "transitionToE", "(", "line", ",", "nodeHint", ")", ")", "return", "PENDING", ";", "setData", "(", "line", ",", "data", ",", "txn", ")", ";", "if", "(", "txn", "=", "=", "null", "&", "&", "!", "line", ".", "isLocked", "(", ")", ")", "backupLine", "(", "line", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "private", "void", "handleDeleted", "(", "CacheLine", "line", ")", "{", "if", "(", "isReserved", "(", "line", ".", "getId", "(", ")", ")", ")", "{", "line", ".", "set", "(", "CacheLine", ".", "DELETED", ",", "false", ")", ";", "setState", "(", "line", ",", "State", ".", "E", ")", ";", "}", "else", "throw", "new", "RefNotFoundException", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpPut", "(", "Op", "op", ",", "CacheLine", "line", ")", "{", "assert", "line", "=", "=", "null", ";", "long", "id", "=", "idAllocator", ".", "allocateIds", "(", "op", ",", "1", ")", ";", "if", "(", "id", "=", "=", "-", "1", ")", "return", "PENDING", ";", "line", "=", "allocateCacheLine", "(", ")", ";", "line", ".", "id", "=", "id", ";", "setState", "(", "line", ",", "State", ".", "E", ")", ";", "setOwner", "(", "line", ",", "myNodeId", "(", ")", ")", ";", "setData", "(", "line", ",", "op", ".", "data", ",", "op", ".", "txn", ")", ";", "lockLine", "(", "line", ",", "op", ".", "txn", ")", ";", "putLine", "(", "id", ",", "line", ",", "0", ",", "line", ".", "size", "(", ")", ")", ";", "return", "id", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpAlloc", "(", "Op", "op", ",", "CacheLine", "line", ")", "{", "assert", "line", "=", "=", "null", ";", "final", "int", "count", "=", "(", "Integer", ")", "op", ".", "getExtra", "(", ")", ";", "long", "id", "=", "idAllocator", ".", "allocateIds", "(", "op", ",", "count", ")", ";", "if", "(", "id", "=", "=", "-", "1", ")", "return", "PENDING", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "count", ";", "i", "+", "+", ")", "{", "line", "=", "allocateCacheLine", "(", ")", ";", "line", ".", "id", "=", "id", "+", "i", ";", "setState", "(", "line", ",", "State", ".", "E", ")", ";", "setOwner", "(", "line", ",", "myNodeId", "(", ")", ")", ";", "setData", "(", "line", ",", "null", ",", "op", ".", "txn", ")", ";", "lockLine", "(", "line", ",", "op", ".", "txn", ")", ";", "putLine", "(", "id", "+", "i", ",", "line", ",", "0", ",", "line", ".", "size", "(", ")", ")", ";", "}", "return", "id", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpDel", "(", "CacheLine", "line", ",", "short", "nodeHint", ",", "Transaction", "txn", ",", "int", "change", ")", "{", "if", "(", "(", "change", "&", "(", "LINE_STATE_CHANGED", "|", "LINE_OWNER_CHANGED", ")", ")", "=", "=", "0", ")", "return", "PENDING", ";", "if", "(", "!", "transitionToE", "(", "line", ",", "nodeHint", ")", ")", "return", "PENDING", ";", "final", "long", "id", "=", "line", ".", "getId", "(", ")", ";", "line", ".", "set", "(", "CacheLine", ".", "DELETED", ",", "true", ")", ";", "if", "(", "hasServer", "(", ")", ")", "{", "if", "(", "line", ".", "state", "=", "=", "State", ".", "E", ")", "setState", "(", "line", ",", "State", ".", "O", ")", ";", "line", ".", "sharers", ".", "add", "(", "Comm", ".", "SERVER", ")", ";", "send", "(", "Message", ".", "DEL", "(", "Comm", ".", "SERVER", ",", "id", ")", ")", ";", "}", "else", "setState", "(", "line", ",", "State", ".", "I", ")", ";", "deallocateStorage", "(", "id", ",", "line", ".", "data", ")", ";", "fireLineEvicted", "(", "line", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpSend", "(", "CacheLine", "line", ",", "Object", "extra", ",", "int", "change", ")", "{", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "handleDeleted", "(", "line", ")", ";", "if", "(", "(", "change", "&", "LINE_OWNER_CHANGED", ")", "=", "=", "0", ")", "return", "PENDING", ";", "final", "Message", ".", "MSG", "msg", "=", "(", "Message", ".", "MSG", ")", "extra", ";", "if", "(", "msg", ".", "getNode", "(", ")", "!", "=", "-", "1", "&", "&", "msg", ".", "getNode", "(", ")", "=", "=", "line", ".", "getOwner", "(", ")", ")", "return", "PENDING", ";", "if", "(", "!", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "msg", ".", "setNode", "(", "myNodeId", "(", ")", ")", ";", "msg", ".", "setReplyRequired", "(", "false", ")", ";", "msg", ".", "setIncoming", "(", ")", ";", "receive", "(", "msg", ")", ";", "return", "null", ";", "}", "final", "Message", ".", "MSG", "msg1", "=", "Message", ".", "MSG", "(", "line", ".", "getOwner", "(", ")", ",", "msg", ".", "getLine", "(", ")", ",", "msg", ".", "getData", "(", ")", ")", ";", "send", "(", "(", "Message", ")", "msg1", ")", ";", "return", "PENDING", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpPush", "(", "CacheLine", "line", ",", "Object", "extra", ",", "int", "change", ")", "{", "if", "(", "(", "change", "&", "LINE_MODIFIED_CHANGED", ")", "=", "=", "0", ")", "{", "assert", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ";", "return", "PENDING", ";", "}", "if", "(", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "line", ".", "getState", "(", ")", ")", ";", "return", "null", ";", "}", "setState", "(", "line", ",", "State", ".", "O", ")", ";", "short", "[", "]", "toNodes", "=", "(", "short", "[", "]", ")", "extra", ";", "line", ".", "sharers", ".", "addAll", "(", "toNodes", ")", ";", "for", "(", "short", "node", ":", "toNodes", ")", "{", "send", "(", "Message", ".", "PUT", "(", "node", ",", "line", ".", "id", ",", "line", ".", "version", ",", "readOnly", "(", "line", ".", "data", ")", ")", ")", ";", "line", ".", "rewind", "(", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "private", "Object", "handleOpPushX", "(", "CacheLine", "line", ",", "Object", "extra", ",", "int", "change", ")", "{", "if", "(", "(", "change", "&", "LINE_MODIFIED_CHANGED", ")", "=", "=", "0", ")", "{", "assert", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ";", "return", "PENDING", ";", "}", "if", "(", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "E", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "line", ".", "getId", "(", ")", ",", "line", ".", "getState", "(", ")", ")", ";", "return", "null", ";", "}", "short", "toNode", "=", "(", "Short", ")", "extra", ";", "setOwner", "(", "line", ",", "toNode", ")", ";", "final", "short", "[", "]", "sharers", "=", "line", ".", "sharers", ".", "toArray", "(", ")", ";", "setState", "(", "line", ",", "State", ".", "I", ")", ";", "send", "(", "Message", ".", "PUTX", "(", "toNode", ",", "line", ".", "id", ",", "sharers", ",", "line", ".", "version", ",", "readOnly", "(", "line", ".", "data", ")", ")", ")", ";", "line", ".", "rewind", "(", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "private", "Void", "handleOpListen", "(", "CacheLine", "line", ",", "Object", "listener", ")", "{", "line", ".", "setListener", "(", "(", "CacheListener", ")", "listener", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "private", "static", "short", "nodeHint", "(", "Object", "obj", ")", "{", "return", "obj", "!", "=", "null", "?", "(", "Short", ")", "obj", ":", "-", "1", ";", "}", "</s>"]
["<s>", "private", "static", "short", "getTarget", "(", "CacheLine", "line", ",", "short", "nodeHint", ")", "{", "short", "target", "=", "line", ".", "getOwner", "(", ")", ";", "if", "(", "target", "<", "0", ")", "target", "=", "nodeHint", ";", "return", "target", ";", "}", "</s>"]
["<s>", "private", "void", "setData", "(", "CacheLine", "line", ",", "Object", "data", ",", "Transaction", "txn", ")", "{", "assert", "!", "line", ".", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ";", "if", "(", "txn", "!", "=", "null", "&", "&", "rollbackSupported", "&", "&", "!", "txn", ".", "isRecorded", "(", "line", ".", "getId", "(", ")", ")", ")", "txn", ".", "recordRollback", "(", "line", ".", "getId", "(", ")", ",", "line", ".", "getVersion", "(", ")", ",", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ",", "line", ".", "getData", "(", ")", "!", "=", "null", "?", "Persistables", ".", "toByteArray", "(", "line", ".", "getData", "(", ")", ")", ":", "null", ")", ";", "if", "(", "writeData", "(", "line", ",", "data", ")", "|", "|", "line", ".", "version", "=", "=", "0", ")", "{", "line", ".", "version", "+", "+", ";", "line", ".", "set", "(", "CacheLine", ".", "MODIFIED", ",", "true", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "line", ".", "getVersion", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "int", "handleMessageGet", "(", "Message", ".", "GET", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "if", "(", "handleNotOwner", "(", "msg", ",", "line", ")", ")", "return", "LINE_NO_CHANGE", ";", "relevantStates", "(", "line", ",", "State", ".", "E", ",", "State", ".", "O", ")", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "change", "|", "=", "setState", "(", "line", ",", "State", ".", "O", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "line", ".", "sharers", ".", "add", "(", "msg", ".", "getNode", "(", ")", ")", ";", "send", "(", "Message", ".", "PUT", "(", "msg", ",", "line", ".", "id", ",", "line", ".", "version", ",", "readOnly", "(", "line", ".", "data", ")", ")", ")", ";", "line", ".", "rewind", "(", ")", ";", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessagePut", "(", "Message", ".", "PUT", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "relevantStates", "(", "line", ",", "State", ".", "I", ",", "State", ".", "S", ")", ";", "if", "(", "line", ".", "version", ">", "msg", ".", "getVersion", "(", ")", ")", "return", "LINE_NO_CHANGE", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "change", "|", "=", "setState", "(", "line", ",", "State", ".", "S", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "change", "|", "=", "setOwner", "(", "line", ",", "msg", ".", "getNode", "(", ")", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "line", ".", "version", "=", "msg", ".", "getVersion", "(", ")", ";", "writeData", "(", "line", ",", "msg", ".", "getData", "(", ")", ")", ";", "setOwnerClock", "(", "line", ",", "msg", ")", ";", "fireLineReceived", "(", "line", ")", ";", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageGetX", "(", "Message", ".", "GET", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "if", "(", "handleNotOwner", "(", "msg", ",", "line", ")", ")", "return", "0", ";", "relevantStates", "(", "line", ",", "State", ".", "E", ",", "State", ".", "O", ")", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ")", "{", "if", "(", "backup", ".", "inv", "(", "line", ".", "getId", "(", ")", ",", "msg", ".", "getNode", "(", ")", ")", ")", "line", ".", "set", "(", "CacheLine", ".", "SLAVE", ",", "false", ")", ";", "}", "if", "(", "!", "hasServer", "&", "&", "line", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ")", "line", ".", "sharers", ".", "add", "(", "myNodeId", "(", ")", ")", ";", "final", "short", "[", "]", "sharers", "=", "line", ".", "sharers", ".", "toArray", "(", ")", ";", "int", "change", "=", "0", ";", "change", "|", "=", "setState", "(", "line", ",", "(", "hasServer", "|", "!", "line", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ")", "?", "State", ".", "I", ":", "State", ".", "S", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "change", "|", "=", "setOwner", "(", "line", ",", "msg", ".", "getNode", "(", ")", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "send", "(", "Message", ".", "PUTX", "(", "msg", ",", "line", ".", "id", ",", "sharers", ",", "line", ".", "version", ",", "readOnly", "(", "line", ".", "data", ")", ")", ")", ";", "line", ".", "rewind", "(", ")", ";", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessagePutX", "(", "Message", ".", "PUTX", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "relevantStates", "(", "line", ",", "State", ".", "I", ",", "State", ".", "S", ")", ";", "if", "(", "line", ".", "version", ">", "msg", ".", "getVersion", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "msg", ".", "getVersion", "(", ")", ",", "line", ".", "version", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "final", "TShortHashSet", "sharers", "=", "new", "TShortHashSet", "(", "(", "msg", ".", "getSharers", "(", ")", "!", "=", "null", "?", "msg", ".", "getSharers", "(", ")", ".", "length", ":", "0", ")", "+", "1", ")", ";", "if", "(", "msg", ".", "getSharers", "(", ")", "!", "=", "null", ")", "sharers", ".", "addAll", "(", "msg", ".", "getSharers", "(", ")", ")", ";", "if", "(", "hasServer", "&", "&", "msg", ".", "getNode", "(", ")", "!", "=", "Comm", ".", "SERVER", ")", "sharers", ".", "add", "(", "Comm", ".", "SERVER", ")", ";", "sharers", ".", "remove", "(", "myNodeId", "(", ")", ")", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "change", "|", "=", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "change", "|", "=", "setState", "(", "line", ",", "sharers", ".", "isEmpty", "(", ")", "?", "State", ".", "E", ":", "State", ".", "O", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "if", "(", "sharers", ".", "isEmpty", "(", ")", ")", "change", "|", "=", "setOwner", "(", "line", ",", "myNodeId", "(", ")", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "else", "setOwner", "(", "line", ",", "msg", ".", "getNode", "(", ")", ")", ";", "line", ".", "sharers", ".", "addAll", "(", "sharers", ")", ";", "line", ".", "version", "=", "msg", ".", "getVersion", "(", ")", ";", "writeData", "(", "line", ",", "(", "Object", ")", "msg", ".", "getData", "(", ")", ")", ";", "setOwnerClock", "(", "line", ",", "msg", ")", ";", "fireLineReceived", "(", "line", ")", ";", "if", "(", "hasServer", "&", "&", "msg", ".", "getNode", "(", ")", "!", "=", "Comm", ".", "SERVER", ")", "send", "(", "Message", ".", "INV", "(", "Comm", ".", "SERVER", ",", "line", ".", "id", ",", "msg", ".", "getNode", "(", ")", ")", ")", ";", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageInvalidate", "(", "Message", ".", "INV", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "relevantStates", "(", "line", ",", "State", ".", "S", ",", "State", ".", "I", ",", "State", ".", "O", ")", ";", "else", "relevantStates", "(", "line", ",", "State", ".", "I", ",", "State", ".", "E", ")", ";", "assert", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", "|", "|", "msg", ".", "getNode", "(", ")", "=", "=", "Comm", ".", "SERVER", "|", "|", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", ";", "final", "short", "owner", "=", "(", "(", "msg", ".", "getNode", "(", ")", "=", "=", "Comm", ".", "SERVER", "|", "|", "msg", ".", "getNode", "(", ")", "=", "=", "getCluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", "?", "msg", ".", "getPreviousOwner", "(", ")", ":", "msg", ".", "getNode", "(", ")", ")", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "setNextState", "(", "line", ",", "null", ")", ";", "change", "|", "=", "setState", "(", "line", ",", "State", ".", "I", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "change", "|", "=", "setOwner", "(", "line", ",", "owner", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "setOwnerClock", "(", "line", ",", "msg", ")", ";", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "{", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ")", "{", "if", "(", "backup", ".", "inv", "(", "line", ".", "getId", "(", ")", ",", "owner", ")", ")", "line", ".", "set", "(", "CacheLine", ".", "SLAVE", ",", "false", ")", ";", "}", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ")", "addPendingMessage", "(", "line", ",", "msg", ")", ";", "else", "if", "(", "msg", ".", "getNode", "(", ")", "!", "=", "Comm", ".", "SERVER", ")", "send", "(", "Message", ".", "INVACK", "(", "msg", ")", ")", ";", "}", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageInvalidateAck", "(", "LineMessage", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "if", "(", "msg", ".", "getNode", "(", ")", "=", "=", "myNodeId", "(", ")", ")", "{", "assert", "line", ".", "is", "(", "CacheLine", ".", "SLAVE", ")", ";", "if", "(", "line", ".", "isLocked", "(", ")", ")", "{", "addPendingMessage", "(", "line", ",", "msg", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "relevantStates", "(", "line", ",", "State", ".", "I", ",", "State", ".", "S", ")", ";", "line", ".", "set", "(", "CacheLine", ".", "SLAVE", ",", "false", ")", ";", "int", "change", "=", "LINE_MODIFIED_CHANGED", ";", "if", "(", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "S", ")", "{", "setNextState", "(", "line", ",", "null", ")", ";", "change", "|", "=", "setState", "(", "line", ",", "State", ".", "I", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "setOwnerClock", "(", "line", ",", "msg", ")", ";", "send", "(", "Message", ".", "INVACK", "(", "line", ".", "getOwner", "(", ")", ",", "line", ".", "getId", "(", ")", ")", ")", ";", "}", "return", "change", ";", "}", "relevantStates", "(", "line", ",", "State", ".", "O", ")", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "line", ".", "sharers", ".", "remove", "(", "msg", ".", "getNode", "(", ")", ")", ";", "if", "(", "line", ".", "sharers", ".", "isEmpty", "(", ")", ")", "{", "change", "|", "=", "setState", "(", "line", ",", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", "?", "State", ".", "I", ":", "State", ".", "E", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "change", "|", "=", "setOwner", "(", "line", ",", "myNodeId", "(", ")", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "change", "|", "=", "LINE_STATE_CHANGED", ";", "}", "else", "if", "(", "(", "broadcastsRoutedToServer", "&", "&", "msg", ".", "getNode", "(", ")", "=", "=", "Comm", ".", "SERVER", ")", "|", "|", "(", "!", "hasServer", "&", "&", "msg", ".", "getNode", "(", ")", "=", "=", "line", ".", "getOwner", "(", ")", ")", ")", "{", "change", "|", "=", "LINE_STATE_CHANGED", ";", "}", "if", "(", "!", "msg", ".", "isResponse", "(", ")", ")", "send", "(", "Message", ".", "ACK", "(", "msg", ")", ")", ";", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageNotFound", "(", "LineMessage", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "relevantStates", "(", "line", ",", "State", ".", "I", ")", ";", "if", "(", "msg", ".", "getNode", "(", ")", "=", "=", "Comm", ".", "SERVER", "|", "|", "!", "hasServer", ")", "{", "line", ".", "set", "(", "CacheLine", ".", "DELETED", ",", "true", ")", ";", "return", "LINE_STATE_CHANGED", ";", "}", "else", "{", "setOwner", "(", "line", ",", "Comm", ".", "SERVER", ")", ";", "setNextState", "(", "line", ",", "null", ")", ";", "return", "LINE_OWNER_CHANGED", ";", "}", "}", "</s>"]
["<s>", "private", "int", "handleMessageChngdOwnr", "(", "Message", ".", "CHNGD_OWNR", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "relevantStates", "(", "line", ",", "State", ".", "I", ",", "State", ".", "S", ")", ";", "if", "(", "msg", ".", "getNewOwner", "(", ")", "!", "=", "-", "1", "&", "&", "getCluster", "(", ")", ".", "getMaster", "(", "msg", ".", "getNewOwner", "(", ")", ")", "=", "=", "null", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "msg", ".", "getNewOwner", "(", ")", ")", ";", "setNextState", "(", "line", ",", "null", ")", ";", "return", "LINE_OWNER_CHANGED", ";", "}", "if", "(", "setOwner", "(", "line", ",", "msg", ".", "getNewOwner", "(", ")", ")", ")", "{", "int", "change", "=", "LINE_OWNER_CHANGED", ";", "if", "(", "msg", ".", "getNode", "(", ")", "=", "=", "Comm", ".", "SERVER", "&", "&", "msg", ".", "getNewOwner", "(", ")", "=", "=", "myNodeId", "(", ")", ")", "{", "setState", "(", "line", ",", "State", ".", "E", ")", ";", "change", "|", "=", "LINE_STATE_CHANGED", ";", "}", "setNextState", "(", "line", ",", "null", ")", ";", "return", "change", ";", "}", "return", "LINE_NO_CHANGE", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageMsgAck", "(", "LineMessage", "ack", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "Op", "sendOp", "=", "null", ";", "final", "Collection", "<", "Op", ">", "pending", "=", "getPendingOps", "(", "line", ")", ";", "for", "(", "Iterator", "<", "Op", ">", "it", "=", "pending", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Op", "op", "=", "it", ".", "next", "(", ")", ";", "if", "(", "op", ".", "type", "=", "=", "Op", ".", "Type", ".", "SEND", ")", "{", "Message", ".", "MSG", "msg", "=", "(", "Message", ".", "MSG", ")", "op", ".", "getExtra", "(", ")", ";", "if", "(", "msg", ".", "getMessageId", "(", ")", "=", "=", "ack", ".", "getMessageId", "(", ")", ")", "{", "sendOp", "=", "op", ";", "break", ";", "}", "}", "}", "if", "(", "sendOp", "!", "=", "null", ")", "{", "completeOp", "(", "line", ",", "sendOp", ",", "null", ",", "true", ")", ";", "removePendingOp", "(", "line", ",", "sendOp", ")", ";", "}", "return", "LINE_NO_CHANGE", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageTimeout", "(", "LineMessage", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "for", "(", "Iterator", "<", "Op", ">", "it", "=", "getPendingOps", "(", "line", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Op", "op", "=", "it", ".", "next", "(", ")", ";", "if", "(", "!", "op", ".", "hasFuture", "(", ")", ")", "op", ".", "createFuture", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "op", ")", ";", "op", ".", "setException", "(", "new", "TimeoutException", "(", ")", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "line", ".", "nextState", "=", "null", ";", "return", "LINE_STATE_CHANGED", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageBackup", "(", "Message", ".", "PUT", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "msg", ")", ";", "return", "LINE_NO_CHANGE", ";", "}", "assert", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", ";", "assert", "msg", ".", "getNode", "(", ")", "=", "=", "myNodeId", "(", ")", ";", "if", "(", "line", ".", "version", ">", "msg", ".", "getVersion", "(", ")", ")", "return", "LINE_NO_CHANGE", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "change", "|", "=", "setState", "(", "line", ",", "State", ".", "E", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "change", "|", "=", "setOwner", "(", "line", ",", "msg", ".", "getNode", "(", ")", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "line", ".", "version", "=", "msg", ".", "getVersion", "(", ")", ";", "writeData", "(", "line", ",", "msg", ".", "getData", "(", ")", ")", ";", "fireLineReceived", "(", "line", ")", ";", "return", "change", ";", "}", "</s>"]
["<s>", "private", "int", "handleMessageBackupAck", "(", "Message", ".", "BACKUPACK", "msg", ",", "CacheLine", "line", ")", "throws", "IrrelevantStateException", "{", "relevantStates", "(", "line", ",", "State", ".", "O", ",", "State", ".", "E", ")", ";", "assert", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", ";", "assert", "line", ".", "getVersion", "(", ")", ">", "=", "msg", ".", "getVersion", "(", ")", ";", "int", "change", "=", "LINE_NO_CHANGE", ";", "if", "(", "line", ".", "is", "(", "CacheLine", ".", "MODIFIED", ")", "&", "&", "line", ".", "getVersion", "(", ")", "=", "=", "msg", ".", "getVersion", "(", ")", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "line", ".", "getVersion", "(", ")", ")", ";", "line", ".", "set", "(", "CacheLine", ".", "MODIFIED", ",", "false", ")", ";", "change", "|", "=", "LINE_MODIFIED_CHANGED", ";", "}", "return", "change", ";", "}", "</s>"]
["<s>", "private", "void", "setOwnerClock", "(", "CacheLine", "line", ",", "Message", "msg", ")", "{", "if", "(", "!", "DIRTY_READS", ")", "return", ";", "final", "long", "clock", "=", "msg", ".", "getMessageId", "(", ")", ";", "line", ".", "setOwnerClock", "(", "clock", ")", ";", "final", "short", "owner", "=", "msg", ".", "getNode", "(", ")", ";", "final", "OwnerClock", "oc", "=", "getOwnerClock", "(", "owner", ")", ";", "switch", "(", "msg", ".", "getType", "(", ")", ")", "{", "case", "INV", ":", "oc", ".", "invCounter", ".", "incrementAndGet", "(", ")", ";", "break", ";", "case", "PUT", ":", "case", "PUTX", ":", "case", "MSG", ":", "setOwnerClockPut", "(", "oc", ",", "clock", ")", ";", "break", ";", "default", ":", "break", ";", "}", "}", "</s>"]
["<s>", "private", "void", "setOwnerClockInv", "(", "CacheLine", "line", ",", "short", "owner", ")", "{", "final", "OwnerClock", "oc", "=", "getOwnerClock", "(", "owner", ")", ";", "final", "long", "current", "=", "oc", ".", "lastPut", ".", "get", "(", ")", ";", "line", ".", "setOwnerClock", "(", "current", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setOwnerClockPut", "(", "Message", "msg", ")", "{", "final", "short", "owner", "=", "msg", ".", "getNode", "(", ")", ";", "final", "OwnerClock", "oc", "=", "getOwnerClock", "(", "owner", ")", ";", "setOwnerClockPut", "(", "oc", ",", "msg", ".", "getMessageId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setOwnerClockPut", "(", "OwnerClock", "oc", ",", "long", "clock", ")", "{", "for", "(", ";", ";", ")", "{", "final", "long", "current", "=", "oc", ".", "lastPut", ".", "get", "(", ")", ";", "if", "(", "current", "<", "0", "|", "|", "clock", "<", "=", "current", ")", "break", ";", "if", "(", "oc", ".", "lastPut", ".", "compareAndSet", "(", "current", ",", "clock", ")", ")", "{", "monitor", ".", "addStalePurge", "(", "oc", ".", "invCounter", ".", "get", "(", ")", ")", ";", "oc", ".", "invCounter", ".", "set", "(", "0", ")", ";", "break", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "resetOwnerClock", "(", "short", "owner", ",", "long", "value", ")", "{", "OwnerClock", "oc", "=", "ownerClocks", ".", "get", "(", "owner", ")", ";", "if", "(", "oc", "!", "=", "null", ")", "{", "oc", ".", "lastPut", ".", "set", "(", "value", ")", ";", "final", "int", "count", "=", "oc", ".", "invCounter", ".", "get", "(", ")", ";", "monitor", ".", "addStalePurge", "(", "count", ")", ";", "oc", ".", "invCounter", ".", "set", "(", "0", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "owner", ",", "count", ")", ";", "}", "}", "</s>"]
["<s>", "private", "OwnerClock", "getOwnerClock", "(", "short", "owner", ")", "{", "OwnerClock", "oc", "=", "ownerClocks", ".", "get", "(", "owner", ")", ";", "if", "(", "oc", "=", "=", "null", ")", "{", "oc", "=", "new", "OwnerClock", "(", ")", ";", "OwnerClock", "tmp", "=", "ownerClocks", ".", "putIfAbsent", "(", "owner", ",", "oc", ")", ";", "if", "(", "tmp", "!", "=", "null", ")", "oc", "=", "tmp", ";", "}", "return", "oc", ";", "}", "</s>"]
["<s>", "private", "boolean", "isPossibleInconsistencies", "(", "CacheLine", "line", ")", "{", "final", "short", "owner", "=", "line", ".", "getOwner", "(", ")", ";", "if", "(", "owner", "=", "=", "-", "1", ")", "return", "false", ";", "final", "OwnerClock", "oc", "=", "ownerClocks", ".", "get", "(", "owner", ")", ";", "if", "(", "oc", "=", "=", "null", ")", "return", "false", ";", "long", "lastPut", "=", "oc", ".", "lastPut", ".", "get", "(", ")", ";", "return", "lastPut", "<", "0", "|", "|", "line", ".", "getOwnerClock", "(", ")", "<", "=", "lastPut", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "final", "short", "node", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "final", "short", "newOwner", "=", "hasServer", "?", "Comm", ".", "SERVER", ":", "(", "short", ")", "-", "1", ";", "final", "NodeEvent", "event", "=", "new", "NodeEvent", "(", "node", ",", "newOwner", ")", ";", "inNodeEventHandler", ".", "set", "(", "Boolean", ".", "TRUE", ")", ";", "nodeEvents", ".", "add", "(", "event", ")", ";", "try", "{", "processLines", "(", "new", "LinePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "processLine", "(", "CacheLine", "line", ")", "{", "for", "(", "Iterator", "<", "LineMessage", ">", "it", "=", "getPendingMessages", "(", "line", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "LineMessage", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getNode", "(", ")", "=", "=", "node", ")", "it", ".", "remove", "(", ")", ";", "}", "processLineOnNodeEvent", "(", "line", ",", "node", ",", "newOwner", ")", ";", "return", "true", ";", "}", "}", ")", ";", "}", "finally", "{", "nodeEvents", ".", "remove", "(", "event", ")", ";", "inNodeEventHandler", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "processLine", "(", "CacheLine", "line", ")", "{", "for", "(", "Iterator", "<", "LineMessage", ">", "it", "=", "getPendingMessages", "(", "line", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "LineMessage", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getNode", "(", ")", "=", "=", "node", ")", "it", ".", "remove", "(", ")", ";", "}", "processLineOnNodeEvent", "(", "line", ",", "node", ",", "newOwner", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "final", "short", "node", ")", "{", "final", "NodeEvent", "event", "=", "new", "NodeEvent", "(", "node", ",", "node", ")", ";", "inNodeEventHandler", ".", "set", "(", "Boolean", ".", "TRUE", ")", ";", "nodeEvents", ".", "add", "(", "event", ")", ";", "try", "{", "resetOwnerClock", "(", "node", ",", "-", "1", ")", ";", "processLines", "(", "new", "LinePredicate", "(", ")", "{", "@", "Override", "public", "boolean", "processLine", "(", "CacheLine", "line", ")", "{", "processLineOnNodeEvent", "(", "line", ",", "node", ",", "node", ")", ";", "return", "true", ";", "}", "}", ")", ";", "resetOwnerClock", "(", "node", ",", "1", ")", ";", "}", "finally", "{", "nodeEvents", ".", "remove", "(", "event", ")", ";", "inNodeEventHandler", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "processLine", "(", "CacheLine", "line", ")", "{", "processLineOnNodeEvent", "(", "line", ",", "node", ",", "node", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "node", ")", "{", "}", "</s>"]
["<s>", "private", "void", "handleNodeEvents", "(", "CacheLine", "line", ")", "{", "if", "(", "inNodeEventHandler", ".", "get", "(", ")", "=", "=", "Boolean", ".", "TRUE", ")", "return", ";", "for", "(", "NodeEvent", "event", ":", "nodeEvents", ")", "processLineOnNodeEvent", "(", "line", ",", "event", ".", "node", ",", "event", ".", "newOwner", ")", ";", "}", "</s>"]
["<s>", "private", "void", "processLineOnNodeEvent", "(", "CacheLine", "line", ",", "short", "node", ",", "short", "newOwner", ")", "{", "if", "(", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", "&", "&", "line", ".", "getOwner", "(", ")", "=", "=", "node", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "node", ",", "line", ",", "newOwner", "}", ")", ";", "int", "change", "=", "0", ";", "change", "|", "=", "setState", "(", "line", ",", "State", ".", "I", ")", "?", "LINE_STATE_CHANGED", ":", "0", ";", "setNextState", "(", "line", ",", "null", ")", ";", "if", "(", "node", "!", "=", "newOwner", ")", "change", "|", "=", "setOwner", "(", "line", ",", "newOwner", ")", "?", "LINE_OWNER_CHANGED", ":", "0", ";", "line", ".", "setOwnerClock", "(", "0", ")", ";", "handlePendingOps", "(", "line", ",", "change", ")", ";", "}", "else", "if", "(", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "O", "&", "&", "line", ".", "sharers", ".", "remove", "(", "node", ")", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "line", ")", ";", "if", "(", "line", ".", "sharers", ".", "isEmpty", "(", ")", ")", "{", "setState", "(", "line", ",", "State", ".", "E", ")", ";", "handlePendingOps", "(", "line", ",", "LINE_STATE_CHANGED", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "NodeEvent", "(", "short", "node", ",", "short", "newOwner", ")", "{", "this", ".", "node", "=", "node", ";", "this", ".", "newOwner", "=", "newOwner", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "false", ";", "if", "(", "obj", "=", "=", "this", ")", "return", "true", ";", "if", "(", "!", "(", "obj", "instanceof", "NodeEvent", ")", ")", "return", "false", ";", "return", "this", ".", "node", "=", "=", "(", "(", "NodeEvent", ")", "obj", ")", ".", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "node", ";", "}", "</s>"]
["<s>", "private", "boolean", "setNextState", "(", "CacheLine", "line", ",", "State", "nextState", ")", "{", "if", "(", "line", ".", "nextState", "=", "=", "nextState", ")", "return", "false", ";", "if", "(", "line", ".", "nextState", "=", "=", "null", "|", "|", "nextState", "=", "=", "null", "|", "|", "line", ".", "nextState", ".", "isLessThan", "(", "nextState", ")", ")", "{", "line", ".", "nextState", "=", "nextState", ";", "if", "(", "nextState", "=", "=", "State", ".", "S", "|", "nextState", "=", "=", "State", ".", "O", ")", "monitor", ".", "addMiss", "(", ")", ";", "if", "(", "nextState", "=", "=", "State", ".", "E", ")", "monitor", ".", "addInvalidate", "(", "line", ".", "sharers", ".", "size", "(", ")", ")", ";", "return", "true", ";", "}", "else", "return", "false", ";", "}", "</s>"]
["<s>", "private", "boolean", "setState", "(", "CacheLine", "line", ",", "State", "state", ")", "{", "if", "(", "line", ".", "nextState", "!", "=", "null", "&", "&", "(", "line", ".", "nextState", "=", "=", "state", "|", "|", "line", ".", "nextState", ".", "isLessThan", "(", "state", ")", ")", ")", "line", ".", "nextState", "=", "null", ";", "if", "(", "line", ".", "state", "!", "=", "state", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "line", ".", "state", ",", "state", "}", ")", ";", "if", "(", "!", "state", ".", "isLessThan", "(", "State", ".", "O", ")", "&", "&", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "owned", ".", "put", "(", "line", ".", "getId", "(", ")", ",", "line", ")", ";", "shared", ".", "remove", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "else", "if", "(", "state", ".", "isLessThan", "(", "State", ".", "O", ")", "&", "&", "!", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "shared", ".", "put", "(", "line", ".", "getId", "(", ")", ",", "line", ")", ";", "owned", ".", "remove", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "line", ".", "state", "=", "state", ";", "if", "(", "line", ".", "sharers", "=", "=", "null", "|", "|", "!", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "line", ".", "sharers", "=", "allocateSharerSet", "(", "SHARER_SET_DEFAULT_SIZE", ")", ";", "else", "if", "(", "line", ".", "sharers", "!", "=", "null", "|", "|", "state", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "deallocateSharerSet", "(", "line", ".", "id", ",", "line", ".", "sharers", ")", ";", "line", ".", "sharers", "=", "null", ";", "}", "if", "(", "state", "=", "=", "State", ".", "I", "&", "&", "!", "line", ".", "is", "(", "CacheLine", ".", "DELETED", ")", ")", "fireLineInvalidated", "(", "line", ")", ";", "return", "true", ";", "}", "else", "return", "false", ";", "}", "</s>"]
["<s>", "private", "boolean", "setOwner", "(", "CacheLine", "line", ",", "short", "owner", ")", "{", "short", "oldOwner", "=", "line", ".", "owner", ";", "if", "(", "owner", "!", "=", "oldOwner", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "line", ".", "owner", ",", "owner", "}", ")", ";", "line", ".", "owner", "=", "owner", ";", "return", "true", ";", "}", "else", "return", "false", ";", "}", "</s>"]
["<s>", "private", "void", "accessLine", "(", "CacheLine", "line", ")", "{", "}", "</s>"]
["<s>", "private", "boolean", "writeData", "(", "CacheLine", "line", ",", "Object", "data", ")", "{", "if", "(", "data", "=", "=", "null", ")", "return", "writeNull", "(", "line", ")", ";", "else", "if", "(", "data", "instanceof", "Persistable", ")", "return", "writeData", "(", "line", ",", "(", "Persistable", ")", "data", ")", ";", "else", "if", "(", "data", "instanceof", "ByteBuffer", ")", "return", "writeData", "(", "line", ",", "(", "ByteBuffer", ")", "data", ")", ";", "else", "return", "writeData", "(", "line", ",", "(", "byte", "[", "]", ")", "data", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "writeData", "(", "CacheLine", "line", ",", "byte", "[", "]", "data", ")", "{", "if", "(", "data", ".", "length", ">", "maxItemSize", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "data", ".", "length", "+", "\"", "<STR_LIT>", "\"", "+", "maxItemSize", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "compareBeforeWrite", ")", "{", "if", "(", "line", ".", "data", "!", "=", "null", "&", "&", "data", ".", "length", "=", "=", "line", ".", "data", ".", "remaining", "(", ")", ")", "{", "final", "int", "p", "=", "line", ".", "data", ".", "position", "(", ")", ";", "boolean", "modified", "=", "false", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "data", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "line", ".", "data", ".", "get", "(", "p", "+", "i", ")", "!", "=", "data", "[", "i", "]", ")", "{", "modified", "=", "true", ";", "break", ";", "}", "}", "if", "(", "!", "modified", ")", "return", "false", ";", "}", "}", "allocateLineData", "(", "line", ",", "data", ".", "length", ")", ";", "line", ".", "data", ".", "put", "(", "data", ")", ";", "line", ".", "data", ".", "flip", "(", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "private", "boolean", "writeData", "(", "CacheLine", "line", ",", "ByteBuffer", "data", ")", "{", "if", "(", "data", ".", "remaining", "(", ")", ">", "maxItemSize", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "data", ".", "remaining", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "maxItemSize", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "compareBeforeWrite", ")", "{", "if", "(", "line", ".", "data", "!", "=", "null", "&", "&", "data", ".", "remaining", "(", ")", "=", "=", "line", ".", "data", ".", "remaining", "(", ")", ")", "{", "final", "int", "p1", "=", "line", ".", "data", ".", "position", "(", ")", ";", "final", "int", "p2", "=", "data", ".", "position", "(", ")", ";", "boolean", "modified", "=", "false", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "data", ".", "remaining", "(", ")", ";", "i", "+", "+", ")", "{", "if", "(", "line", ".", "data", ".", "get", "(", "p1", "+", "i", ")", "!", "=", "data", ".", "get", "(", "p2", "+", "i", ")", ")", "{", "modified", "=", "true", ";", "break", ";", "}", "}", "if", "(", "!", "modified", ")", "return", "false", ";", "}", "}", "allocateLineData", "(", "line", ",", "data", ".", "remaining", "(", ")", ")", ";", "line", ".", "data", ".", "put", "(", "data", ")", ";", "line", ".", "data", ".", "flip", "(", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "private", "boolean", "writeData", "(", "CacheLine", "line", ",", "Persistable", "object", ")", "{", "if", "(", "object", ".", "size", "(", ")", ">", "maxItemSize", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "object", ".", "size", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "maxItemSize", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "compareBeforeWrite", ")", "{", "final", "Checksum", "chksm", "=", "getChecksum", "(", ")", ";", "if", "(", "line", ".", "data", "!", "=", "null", "&", "&", "object", ".", "size", "(", ")", "=", "=", "line", ".", "data", ".", "remaining", "(", ")", ")", "{", "final", "int", "n", "=", "line", ".", "data", ".", "remaining", "(", ")", ";", "chksm", ".", "update", "(", "line", ".", "data", ")", ";", "line", ".", "data", ".", "rewind", "(", ")", ";", "final", "byte", "[", "]", "hash", "=", "chksm", ".", "getChecksum", "(", ")", ";", "object", ".", "write", "(", "line", ".", "data", ")", ";", "line", ".", "data", ".", "flip", "(", ")", ";", "chksm", ".", "reset", "(", ")", ";", "chksm", ".", "update", "(", "line", ".", "data", ")", ";", "line", ".", "data", ".", "rewind", "(", ")", ";", "if", "(", "!", "Arrays", ".", "equals", "(", "hash", ",", "chksm", ".", "getChecksum", "(", ")", ")", ")", "return", "true", ";", "return", "false", ";", "}", "}", "allocateLineData", "(", "line", ",", "object", ".", "size", "(", ")", ")", ";", "object", ".", "write", "(", "line", ".", "data", ")", ";", "line", ".", "data", ".", "flip", "(", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "private", "boolean", "writeNull", "(", "CacheLine", "line", ")", "{", "if", "(", "line", ".", "data", "=", "=", "null", ")", "return", "false", ";", "final", "int", "oldSize", "=", "line", ".", "size", "(", ")", ";", "deallocateStorage", "(", "line", ".", "id", ",", "line", ".", "data", ")", ";", "line", ".", "data", "=", "null", ";", "if", "(", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "putLine", "(", "line", ".", "id", ",", "line", ",", "oldSize", ",", "0", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "private", "void", "allocateLineData", "(", "CacheLine", "line", ",", "int", "size", ")", "{", "final", "int", "oldSize", "=", "line", ".", "size", "(", ")", ";", "if", "(", "line", ".", "data", "!", "=", "null", ")", "{", "if", "(", "line", ".", "data", ".", "capacity", "(", ")", ">", "=", "size", "&", "&", "line", ".", "data", ".", "capacity", "(", ")", "<", "size", "*", "<NUM_LIT:4>", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "line", ".", "getId", "(", ")", ")", ",", "line", ".", "data", ".", "capacity", "(", ")", ",", "size", "}", ")", ";", "line", ".", "data", ".", "clear", "(", ")", ";", "}", "else", "{", "deallocateStorage", "(", "line", ".", "id", ",", "line", ".", "data", ")", ";", "line", ".", "data", "=", "null", ";", "}", "}", "boolean", "resized", "=", "false", ";", "if", "(", "line", ".", "data", "=", "=", "null", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "size", ",", "hex", "(", "line", ".", "getId", "(", ")", ")", ")", ";", "line", ".", "data", "=", "allocateStorage", "(", "size", ")", ";", "resized", "=", "true", ";", "}", "line", ".", "data", ".", "limit", "(", "size", ")", ";", "if", "(", "resized", "&", "&", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "putLine", "(", "line", ".", "id", ",", "line", ",", "oldSize", ",", "line", ".", "size", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "readData", "(", "CacheLine", "line", ")", "{", "accessLine", "(", "line", ")", ";", "if", "(", "line", ".", "data", "=", "=", "null", ")", "return", "null", ";", "byte", "[", "]", "data", "=", "new", "byte", "[", "line", ".", "data", ".", "remaining", "(", ")", "]", ";", "line", ".", "data", ".", "get", "(", "data", ")", ";", "line", ".", "data", ".", "rewind", "(", ")", ";", "return", "data", ";", "}", "</s>"]
["<s>", "private", "void", "readData", "(", "CacheLine", "line", ",", "Persistable", "object", ")", "{", "accessLine", "(", "line", ")", ";", "final", "ByteBuffer", "buffer", "=", "line", ".", "data", "!", "=", "null", "?", "line", ".", "data", ":", "EMPTY_BUFFER", ";", "if", "(", "object", "instanceof", "VersionedPersistable", ")", "(", "(", "VersionedPersistable", ")", "object", ")", ".", "read", "(", "line", ".", "getVersion", "(", ")", ",", "buffer", ")", ";", "else", "object", ".", "read", "(", "buffer", ")", ";", "line", ".", "rewind", "(", ")", ";", "}", "</s>"]
["<s>", "private", "CacheLine", "createNewCacheLine", "(", "Op", "op", ")", "{", "CacheLine", "line", "=", "allocateCacheLine", "(", ")", ";", "line", ".", "id", "=", "op", ".", "line", ";", "return", "putLine", "(", "op", ".", "line", ",", "line", ",", "0", ",", "0", ")", ";", "}", "</s>"]
["<s>", "private", "CacheLine", "createNewCacheLine", "(", "Message", "message", ")", "{", "final", "long", "id", "=", "(", "(", "LineMessage", ")", "message", ")", ".", "getLine", "(", ")", ";", "CacheLine", "line", "=", "allocateCacheLine", "(", ")", ";", "line", ".", "id", "=", "id", ";", "return", "putLine", "(", "id", ",", "line", ",", "0", ",", "0", ")", ";", "}", "</s>"]
["<s>", "void", "evictLine", "(", "CacheLine", "line", ",", "boolean", "invack", ")", "{", "final", "long", "id", "=", "line", ".", "getId", "(", ")", ";", "final", "int", "oldSize", "=", "line", ".", "size", "(", ")", ";", "discardLine", "(", "line", ",", "invack", ")", ";", "removeLine", "(", "id", ",", "line", ",", "oldSize", ")", ";", "}", "</s>"]
["<s>", "private", "void", "discardLine", "(", "CacheLine", "line", ",", "boolean", "invack", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "line", ")", ";", "fireLineEvicted", "(", "line", ")", ";", "final", "long", "id", "=", "line", ".", "getId", "(", ")", ";", "deallocateStorage", "(", "id", ",", "line", ".", "data", ")", ";", "if", "(", "invack", "&", "&", "line", ".", "getState", "(", ")", "=", "=", "State", ".", "S", ")", "send", "(", "Message", ".", "INVACK", "(", "line", ".", "getOwner", "(", ")", ",", "line", ".", "getId", "(", ")", ")", ")", ";", "clearLine", "(", "line", ")", ";", "deallocateCacheLine", "(", "id", ",", "line", ")", ";", "}", "</s>"]
["<s>", "private", "void", "clearLine", "(", "CacheLine", "line", ")", "{", "if", "(", "line", ".", "sharers", "!", "=", "null", ")", "deallocateSharerSet", "(", "line", ".", "id", ",", "line", ".", "sharers", ")", ";", "line", ".", "id", "=", "0", ";", "line", ".", "clearFlags", "(", ")", ";", "line", ".", "state", "=", "State", ".", "I", ";", "line", ".", "nextState", "=", "null", ";", "line", ".", "owner", "=", "-", "1", ";", "line", ".", "sharers", "=", "null", ";", "line", ".", "version", "=", "0", ";", "line", ".", "data", "=", "null", ";", "}", "</s>"]
["<s>", "void", "lockLine", "(", "CacheLine", "line", ",", "Transaction", "txn", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "line", ")", ";", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Throwable", "(", ")", ")", ";", "line", ".", "lock", "(", ")", ";", "if", "(", "txn", "!", "=", "null", ")", "txn", ".", "add", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "boolean", "unlockLine", "(", "CacheLine", "line", ",", "Transaction", "txn", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "line", ")", ";", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Throwable", "(", ")", ")", ";", "assert", "txn", "=", "=", "null", "|", "|", "txn", ".", "contains", "(", "line", ".", "getId", "(", ")", ")", ";", "return", "line", ".", "unlock", "(", ")", ";", "}", "</s>"]
["<s>", "void", "send", "(", "Message", "message", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "try", "{", "comm", ".", "send", "(", "message", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "final", "Message", "response", "=", "genResponse", "(", "message", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "response", ",", "message", ")", ";", "if", "(", "response", "!", "=", "null", ")", "receive", "(", "shortCircuitMessage", "(", "message", ".", "getNode", "(", ")", ",", "response", ")", ")", ";", "}", "monitor", ".", "addMessageSent", "(", "message", ".", "getType", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "receiveShortCircuit", "(", ")", "{", "Queue", "<", "Message", ">", "ms", "=", "this", ".", "shortCircuitMessage", ".", "get", "(", ")", ";", "if", "(", "ms", "!", "=", "null", ")", "{", "while", "(", "!", "ms", ".", "isEmpty", "(", ")", ")", "{", "Message", "m", "=", "ms", ".", "remove", "(", ")", ";", "receive1", "(", "m", ")", ";", "}", "}", "this", ".", "shortCircuitMessage", ".", "remove", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Message", "genResponse", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "INV", ":", "return", "Message", ".", "INVACK", "(", "(", "Message", ".", "INV", ")", "message", ")", ";", "case", "GET", ":", "case", "GETX", ":", "return", "Message", ".", "CHNGD_OWNR", "(", "(", "(", "LineMessage", ")", "message", ")", ",", "(", "(", "LineMessage", ")", "message", ")", ".", "getLine", "(", ")", ",", "(", "short", ")", "-", "1", ",", "false", ")", ";", "default", ":", "return", "null", ";", "}", "}", "</s>"]
["<s>", "private", "Message", "shortCircuitMessage", "(", "short", "node", ",", "Message", "message", ")", "{", "message", ".", "setIncoming", "(", ")", ";", "message", ".", "setNode", "(", "node", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "CacheLine", "getLine", "(", "long", "id", ")", "{", "CacheLine", "line", "=", "owned", ".", "get", "(", "id", ")", ";", "if", "(", "line", "=", "=", "null", ")", "line", "=", "shared", ".", "get", "(", "id", ")", ";", "return", "line", ";", "}", "</s>"]
["<s>", "private", "CacheLine", "putLine", "(", "long", "id", ",", "Cache", ".", "CacheLine", "line", ",", "int", "oldSize", ",", "int", "newSize", ")", "{", "final", "CacheLine", "old", ";", "if", "(", "line", ".", "getState", "(", ")", ".", "isLessThan", "(", "State", ".", "O", ")", ")", "{", "old", "=", "shared", ".", "put", "(", "id", ",", "line", ")", ";", "if", "(", "old", "!", "=", "null", "&", "&", "old", "!", "=", "line", ")", "evictLine", "(", "old", ",", "false", ")", ";", "return", "line", ";", "}", "else", "{", "old", "=", "owned", ".", "putIfAbsent", "(", "id", ",", "(", "CacheLine", ")", "line", ")", ";", "if", "(", "old", "!", "=", "null", "&", "&", "old", "!", "=", "line", ")", "{", "evictLine", "(", "line", ",", "false", ")", ";", "return", "old", ";", "}", "else", "return", "line", ";", "}", "}", "</s>"]
["<s>", "void", "removeLine", "(", "long", "id", ",", "CacheLine", "line", ",", "int", "oldSize", ")", "{", "if", "(", "owned", ".", "remove", "(", "id", ")", "=", "=", "null", ")", "shared", ".", "remove", "(", "id", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addPendingOp", "(", "CacheLine", "line", ",", "Op", "op", ")", "{", "if", "(", "op", ".", "hasFuture", "(", ")", ")", "return", ";", "op", ".", "createFuture", "(", ")", ";", "ArrayList", "<", "Op", ">", "ops", "=", "pendingOps", ".", "get", "(", "op", ".", "line", ")", ";", "if", "(", "ops", "=", "=", "null", ")", "{", "ops", "=", "new", "ArrayList", "<", "Op", ">", "(", ")", ";", "pendingOps", ".", "put", "(", "op", ".", "line", ",", "ops", ")", ";", "}", "ops", ".", "add", "(", "op", ")", ";", "}", "</s>"]
["<s>", "private", "Collection", "<", "Op", ">", "getPendingOps", "(", "CacheLine", "line", ")", "{", "ArrayList", "<", "Op", ">", "ops", "=", "pendingOps", ".", "get", "(", "line", ".", "getId", "(", ")", ")", ";", "return", "(", "ops", "!", "=", "null", "?", "ops", ":", "Collections", ".", "EMPTY_LIST", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removePendingOp", "(", "CacheLine", "line", ",", "Op", "op", ")", "{", "ArrayList", "<", "Op", ">", "ops", "=", "pendingOps", ".", "get", "(", "op", ".", "line", ")", ";", "if", "(", "ops", "=", "=", "null", ")", "return", ";", "ops", ".", "remove", "(", "op", ")", ";", "if", "(", "ops", ".", "isEmpty", "(", ")", ")", "pendingOps", ".", "remove", "(", "op", ".", "line", ")", ";", "}", "</s>"]
["<s>", "private", "void", "addPendingMessage", "(", "CacheLine", "line", ",", "LineMessage", "message", ")", "{", "HashSet", "<", "LineMessage", ">", "msgs", "=", "pendingMessages", ".", "get", "(", "line", ".", "getId", "(", ")", ")", ";", "if", "(", "msgs", "=", "=", "null", ")", "{", "msgs", "=", "new", "LinkedHashSet", "<", "LineMessage", ">", "(", ")", ";", "pendingMessages", ".", "put", "(", "line", ".", "getId", "(", ")", ",", "msgs", ")", ";", "}", "msgs", ".", "add", "(", "message", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "hasPendingMessages", "(", "CacheLine", "line", ")", "{", "final", "Collection", "<", "LineMessage", ">", "msgs", "=", "pendingMessages", ".", "get", "(", "line", ".", "getId", "(", ")", ")", ";", "return", "msgs", "!", "=", "null", "&", "&", "!", "msgs", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Set", "<", "LineMessage", ">", "getAndClearPendingMessages", "(", "CacheLine", "line", ")", "{", "Set", "<", "LineMessage", ">", "msgs", "=", "pendingMessages", ".", "remove", "(", "line", ".", "getId", "(", ")", ")", ";", "if", "(", "msgs", "=", "=", "null", ")", "msgs", "=", "Collections", ".", "emptySet", "(", ")", ";", "return", "msgs", ";", "}", "</s>"]
["<s>", "private", "Set", "<", "LineMessage", ">", "getPendingMessages", "(", "CacheLine", "line", ")", "{", "Set", "<", "LineMessage", ">", "msgs", "=", "pendingMessages", ".", "get", "(", "line", ".", "getId", "(", ")", ")", ";", "if", "(", "msgs", "=", "=", "null", ")", "msgs", "=", "Collections", ".", "emptySet", "(", ")", ";", "return", "msgs", ";", "}", "</s>"]
["<s>", "boolean", "processLine", "(", "CacheLine", "line", ")", ";", "</s>"]
["<s>", "private", "void", "processLines", "(", "LinePredicate", "lp", ")", "{", "for", "(", "ConcurrentMap", "<", "Long", ",", "CacheLine", ">", "map", ":", "new", "ConcurrentMap", "[", "]", "{", "owned", ",", "shared", "}", ")", "{", "for", "(", "Iterator", "<", "CacheLine", ">", "it", "=", "map", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "CacheLine", "line", "=", "it", ".", "next", "(", ")", ";", "final", "boolean", "retain", ";", "synchronized", "(", "line", ")", "{", "retain", "=", "lp", ".", "processLine", "(", "line", ")", ";", "if", "(", "!", "retain", ")", "discardLine", "(", "line", ",", "false", ")", ";", "}", "if", "(", "!", "retain", ")", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "short", "myNodeId", "(", ")", "{", "return", "getCluster", "(", ")", ".", "getMyNodeId", "(", ")", ";", "}", "</s>"]
["<s>", "private", "CacheLine", "allocateCacheLine", "(", ")", "{", "CacheLine", "line", ";", "if", "(", "freeLineList", "=", "=", "null", ")", "line", "=", "new", "CacheLine", "(", ")", ";", "else", "{", "line", "=", "freeLineList", ".", "pollFirst", "(", ")", ";", "if", "(", "line", "=", "=", "null", ")", "line", "=", "new", "CacheLine", "(", ")", ";", "}", "clearLine", "(", "line", ")", ";", "return", "line", ";", "}", "</s>"]
["<s>", "private", "void", "deallocateCacheLine", "(", "long", "id", ",", "Cache", ".", "CacheLine", "line", ")", "{", "if", "(", "freeLineList", "=", "=", "null", ")", "return", ";", "freeLineList", ".", "addFirst", "(", "line", ")", ";", "}", "</s>"]
["<s>", "private", "TShortHashSet", "allocateSharerSet", "(", "int", "size", ")", "{", "if", "(", "freeSharerSetList", "=", "=", "null", ")", "return", "new", "TShortHashSet", "(", "size", ")", ";", "TShortHashSet", "sharers", "=", "freeSharerSetList", ".", "pollFirst", "(", ")", ";", "if", "(", "sharers", "!", "=", "null", ")", "return", "sharers", ";", "return", "new", "TShortHashSet", "(", "size", ")", ";", "}", "</s>"]
["<s>", "private", "void", "deallocateSharerSet", "(", "long", "id", ",", "TShortHashSet", "sharers", ")", "{", "if", "(", "freeSharerSetList", "=", "=", "null", ")", "return", ";", "freeSharerSetList", ".", "addFirst", "(", "sharers", ")", ";", "}", "</s>"]
["<s>", "ByteBuffer", "allocateStorage", "(", "int", "length", ")", "{", "return", "storage", ".", "allocateStorage", "(", "length", ")", ";", "}", "</s>"]
["<s>", "void", "deallocateStorage", "(", "long", "id", ",", "ByteBuffer", "buffer", ")", "{", "if", "(", "buffer", "!", "=", "null", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "id", ")", ")", ";", "storage", ".", "deallocateStorage", "(", "id", ",", "buffer", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "fireLineInvalidated", "(", "CacheLine", "line", ")", "{", "if", "(", "line", ".", "getListener", "(", ")", "!", "=", "null", ")", "{", "try", "{", "line", ".", "getListener", "(", ")", ".", "invalidated", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "for", "(", "CacheListener", "listener", ":", "listeners", ")", "{", "try", "{", "listener", ".", "invalidated", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "fireLineReceived", "(", "CacheLine", "line", ")", "{", "final", "long", "id", "=", "line", ".", "getId", "(", ")", ";", "final", "long", "version", "=", "line", ".", "getVersion", "(", ")", ";", "final", "ByteBuffer", "data", "=", "line", ".", "data", ";", "if", "(", "line", ".", "getListener", "(", ")", "!", "=", "null", ")", "{", "try", "{", "line", ".", "getListener", "(", ")", ".", "received", "(", "id", ",", "version", ",", "data", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "line", ".", "rewind", "(", ")", ";", "}", "for", "(", "CacheListener", "listener", ":", "listeners", ")", "{", "try", "{", "listener", ".", "received", "(", "id", ",", "version", ",", "data", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "line", ".", "rewind", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "fireLineEvicted", "(", "CacheLine", "line", ")", "{", "if", "(", "line", ".", "getListener", "(", ")", "!", "=", "null", ")", "{", "try", "{", "line", ".", "getListener", "(", ")", ".", "evicted", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "for", "(", "CacheListener", "listener", ":", "listeners", ")", "{", "try", "{", "listener", ".", "evicted", "(", "line", ".", "getId", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "</s>"]
["<s>", "private", "static", "ByteBuffer", "readOnly", "(", "ByteBuffer", "buffer", ")", "{", "return", "buffer", "!", "=", "null", "?", "buffer", ".", "asReadOnlyBuffer", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "isReserved", "(", "long", "id", ")", "{", "return", "id", "<", "=", "MAX_RESERVED_REF_ID", ";", "}", "</s>"]
["<s>", "private", "void", "relevantStates", "(", "CacheLine", "line", ",", "State", ".", ".", ".", "states", ")", "throws", "IrrelevantStateException", "{", "final", "State", "state", "=", "line", ".", "state", ";", "for", "(", "State", "s", ":", "states", ")", "{", "if", "(", "state", "=", "=", "s", ")", "return", ";", "}", "throw", "IRRELEVANT_STATE", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setMonitoredObject", "(", "Object", "obj", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addObjectServed", "(", ")", "{", "objectsServed", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addOwnerServed", "(", ")", "{", "ownersServed", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addOwnerWrite", "(", ")", "{", "ownerWrites", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addTransaction", "(", "int", "numWrites", ")", "{", "transactions", ".", "mark", "(", ")", ";", "writes", ".", "mark", "(", "numWrites", ")", ";", "}", "</s>"]
["<s>", "void", "allocated", "(", "int", "bin", ",", "int", "size", ")", ";", "</s>"]
["<s>", "void", "deallocated", "(", "int", "bin", ",", "int", "size", ")", ";", "</s>"]
["<s>", "Object", "lockRoot", "(", "int", "id", ")", ";", "</s>"]
["<s>", "void", "unlockRoot", "(", "Object", "lock", ")", ";", "</s>"]
["<s>", "public", "MetricsCacheMonitor", "(", ")", "{", "for", "(", "Op", ".", "Type", "op", ":", "Op", ".", "Type", ".", "values", "(", ")", ")", "opMonitors", ".", "put", "(", "op", ",", "Metrics", ".", "newTimer", "(", "Cache", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "op", ".", "name", "(", ")", ",", "TimeUnit", ".", "MICROSECONDS", ",", "TimeUnit", ".", "SECONDS", ")", ")", ";", "for", "(", "Message", ".", "Type", "m", ":", "Message", ".", "Type", ".", "values", "(", ")", ")", "messageMonitors", ".", "put", "(", "m", ",", "new", "MessageMonitor", "(", "m", ")", ")", ";", "for", "(", "MessageDelayReason", "reason", ":", "MessageDelayReason", ".", "values", "(", ")", ")", "messageDelayMonitors", ".", "put", "(", "reason", ",", "new", "DelayedMessageMonitor", "(", "reason", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setMonitoredObject", "(", "Object", "obj", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addHit", "(", ")", "{", "hits", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addStaleHit", "(", ")", "{", "staleHits", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMiss", "(", ")", "{", "misses", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addInvalidate", "(", "int", "num", ")", "{", "invalidates", ".", "mark", "(", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageSent", "(", "Type", "msg", ")", "{", "messageMonitors", ".", "get", "(", "msg", ")", ".", "addSent", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageReceived", "(", "Type", "msg", ")", "{", "messageMonitors", ".", "get", "(", "msg", ")", ".", "addReceived", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addOp", "(", "Op", ".", "Type", "type", ",", "long", "durationMicroSeconds", ")", "{", "opMonitors", ".", "get", "(", "type", ")", ".", "update", "(", "durationMicroSeconds", ",", "TimeUnit", ".", "MICROSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageHandlingDelay", "(", "int", "numDelayed", ",", "long", "totalDelayNanos", ",", "MessageDelayReason", "reason", ")", "{", "final", "DelayedMessageMonitor", "m", "=", "messageDelayMonitors", ".", "get", "(", "reason", ")", ";", "m", ".", "addMessages", "(", "numDelayed", ")", ";", "m", ".", "addDelay", "(", "totalDelayNanos", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addStalePurge", "(", "int", "num", ")", "{", "stalePurges", ".", "mark", "(", "num", ")", ";", "}", "</s>"]
["<s>", "public", "MessageMonitor", "(", "Message", ".", "Type", "type", ")", "{", "this", ".", "messagesSent", "=", "Metrics", ".", "newMeter", "(", "Cache", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "type", ".", "name", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "SECONDS", ")", ";", "this", ".", "messagesReceived", "=", "Metrics", ".", "newMeter", "(", "Cache", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "type", ".", "name", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "void", "addSent", "(", ")", "{", "messagesSent", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "void", "addReceived", "(", ")", "{", "messagesReceived", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "public", "DelayedMessageMonitor", "(", "MessageDelayReason", "reason", ")", "{", "this", ".", "messages", "=", "Metrics", ".", "newMeter", "(", "Cache", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "reason", ".", "name", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "SECONDS", ")", ";", "this", ".", "delay", "=", "Metrics", ".", "newTimer", "(", "Cache", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "reason", ".", "name", "(", ")", ",", "TimeUnit", ".", "MICROSECONDS", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "void", "addDelay", "(", "long", "nanos", ")", "{", "delay", ".", "update", "(", "nanos", ",", "TimeUnit", ".", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "void", "addMessages", "(", "int", "num", ")", "{", "messages", ".", "mark", "(", "num", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", "{", "refAllocationListeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", "{", "refAllocationListeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "fireCounterReady", "(", ")", "{", "for", "(", "RefAllocationsListener", "listener", ":", "refAllocationListeners", ")", "listener", ".", "counterReady", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "fireRefsAllocated", "(", "long", "start", ",", "int", "num", ")", "{", "for", "(", "RefAllocationsListener", "listener", ":", "refAllocationListeners", ")", "listener", ".", "refsAllocated", "(", "start", ",", "num", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "SetMultimap", "<", "Long", ",", "LineMessage", ">", "allocateElement", "(", ")", "{", "SetMultimap", "<", "Long", ",", "LineMessage", ">", "mm", "=", "HashMultimap", ".", "create", "(", ")", ";", "return", "Multimaps", ".", "synchronizedSetMultimap", "(", "mm", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "SetMultimap", "<", "Long", ",", "LineMessage", ">", "emptyElement", "(", ")", "{", "return", "ImmutableSetMultimap", ".", "of", "(", ")", ";", "}", "</s>"]
["<s>", "public", "NodeDeathLayer", "(", "Comm", "comm", ",", "Cluster", "cluster", ")", "{", "this", ".", "comm", "=", "comm", ";", "this", ".", "cluster", "=", "cluster", ";", "comm", ".", "setReceiver", "(", "this", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "cache", "=", "receiver", ";", "}", "</s>"]
["<s>", "public", "void", "addPending", "(", "LineMessage", "message", ")", "{", "short", "node", "=", "message", ".", "getNode", "(", ")", ";", "if", "(", "node", "!", "=", "-", "1", ")", "pending", ".", "getOrAllocate", "(", "node", ")", ".", "put", "(", "message", ".", "getLine", "(", ")", ",", "message", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removePending", "(", "LineMessage", "message", ")", "{", "Set", "<", "LineMessage", ">", "msgs", "=", "pending", ".", "get", "(", "message", ".", "getNode", "(", ")", ")", ".", "get", "(", "message", ".", "getLine", "(", ")", ")", ";", "for", "(", "Iterator", "<", "LineMessage", ">", "it", "=", "msgs", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "Message", "msg", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "INVACK", "&", "&", "msg", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "INV", ")", "it", ".", "remove", "(", ")", ";", "else", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "PUTX", "&", "&", "(", "msg", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "GETX", "|", "|", "msg", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "GET", ")", ")", "it", ".", "remove", "(", ")", ";", "else", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "PUT", "&", "&", "msg", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "GET", ")", "it", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "message", ")", "{", "removePending", "(", "(", "LineMessage", ")", "message", ")", ";", "cache", ".", "receive", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "message", ")", "{", "try", "{", "comm", ".", "send", "(", "message", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "final", "Message", "response", "=", "genResponse", "(", "(", "LineMessage", ")", "message", ")", ";", "if", "(", "response", "!", "=", "null", ")", "cache", ".", "receive", "(", "shortCircuitMessage", "(", "message", ".", "getNode", "(", ")", ",", "response", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "node", ")", "{", "final", "Multimap", "<", "Long", ",", "LineMessage", ">", "mm", "=", "pending", ".", "get", "(", "node", ")", ";", "for", "(", "LineMessage", "m", ":", "mm", ".", "values", "(", ")", ")", "{", "final", "Message", "response", "=", "genResponse", "(", "m", ")", ";", "if", "(", "response", "!", "=", "null", ")", "cache", ".", "receive", "(", "shortCircuitMessage", "(", "m", ".", "getNode", "(", ")", ",", "response", ")", ")", ";", "}", "pending", ".", "remove", "(", "node", ")", ";", "}", "</s>"]
["<s>", "private", "Message", "genResponse", "(", "Message", "message", ")", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "INV", ":", "return", "Message", ".", "INVACK", "(", "(", "Message", ".", "INV", ")", "message", ")", ";", "case", "GET", ":", "case", "GETX", ":", "return", "Message", ".", "CHNGD_OWNR", "(", "(", "LineMessage", ")", "message", ",", "(", "(", "LineMessage", ")", "message", ")", ".", "getLine", "(", ")", ",", "(", "short", ")", "-", "1", ",", "false", ")", ";", "default", ":", "return", "null", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "node", ")", "{", "}", "</s>"]
["<s>", "private", "Message", "shortCircuitMessage", "(", "short", "node", ",", "Message", "message", ")", "{", "message", ".", "setIncoming", "(", ")", ";", "message", ".", "setNode", "(", "node", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "List", "<", "MessageListener", ">", "allocateElement", "(", ")", "{", "return", "new", "CopyOnWriteArrayList", "<", "MessageListener", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "List", "<", "MessageListener", ">", "allocateElement", "(", ")", "{", "return", "new", "CopyOnWriteArrayList", "<", "MessageListener", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "MessengerImpl", "(", "String", "name", ",", "Cache", "cache", ",", "NodeOrderedThreadPoolExecutor", "threadPool", ")", "{", "super", "(", "name", ")", ";", "this", ".", "executor", "=", "threadPool", ";", "if", "(", "executor", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "cache", "=", "cache", ";", "cache", ".", "setReceiver", "(", "new", "MessageReceiver", "(", ")", "{", "@", "Override", "public", "void", "receive", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "MSGACK", ")", "{", "}", "else", "MessengerImpl", ".", "this", ".", "receive", "(", "(", "MSG", ")", "message", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "MSGACK", ")", "{", "}", "else", "MessengerImpl", ".", "this", ".", "receive", "(", "(", "MSG", ")", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageListener", "(", "long", "topic", ",", "MessageListener", "listener", ")", "{", "longTopicListeners", ".", "put", "(", "topic", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeMessageListener", "(", "long", "topic", ",", "MessageListener", "listener", ")", "{", "longTopicListeners", ".", "remove", "(", "topic", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addMessageListener", "(", "String", "topic", ",", "MessageListener", "listener", ")", "{", "stringTopicListeners", ".", "put", "(", "topic", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeMessageListener", "(", "String", "topic", ",", "MessageListener", "listener", ")", "{", "stringTopicListeners", ".", "remove", "(", "topic", ",", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "sendToNode", "(", "short", "node", ",", "long", "topic", ",", "byte", "[", "]", "data", ")", "{", "sendToNode", "(", "node", ",", "new", "Msg", "(", "topic", ",", "null", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "short", "node", ",", "String", "topic", ",", "byte", "[", "]", "data", ")", "{", "if", "(", "topic", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sendToNode", "(", "node", ",", "new", "Msg", "(", "-", "1", ",", "topic", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "short", "node", ",", "long", "topic", ",", "Streamable", "data", ")", "{", "sendToNode", "(", "node", ",", "new", "Msg", "(", "topic", ",", "null", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "short", "node", ",", "String", "topic", ",", "Streamable", "data", ")", "{", "if", "(", "topic", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sendToNode", "(", "node", ",", "new", "Msg", "(", "-", "1", ",", "topic", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "sendToOwnerOf", "(", "long", "ref", ",", "long", "topic", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", "{", "sendToOwnerOf", "(", "ref", ",", "new", "Msg", "(", "topic", ",", "null", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "sendToOwnerOf", "(", "long", "ref", ",", "String", "topic", ",", "byte", "[", "]", "data", ")", "throws", "TimeoutException", "{", "if", "(", "topic", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sendToOwnerOf", "(", "ref", ",", "new", "Msg", "(", "-", "1", ",", "topic", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "sendToOwnerOf", "(", "long", "ref", ",", "long", "topic", ",", "Streamable", "data", ")", "throws", "TimeoutException", "{", "sendToOwnerOf", "(", "ref", ",", "new", "Msg", "(", "topic", ",", "null", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "sendToOwnerOf", "(", "long", "ref", ",", "String", "topic", ",", "Streamable", "data", ")", "throws", "TimeoutException", "{", "if", "(", "topic", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sendToOwnerOf", "(", "ref", ",", "new", "Msg", "(", "-", "1", ",", "topic", ",", "data", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "sendToNode", "(", "short", "node", ",", "Msg", "msg", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "msg", ")", ";", "cache", ".", "send", "(", "Message", ".", "MSG", "(", "node", ",", "-", "1", ",", "Streamables", ".", "toByteArray", "(", "msg", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "sendToOwnerOf", "(", "long", "line", ",", "Msg", "msg", ")", "throws", "TimeoutException", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "Long", ".", "toHexString", "(", "line", ")", ",", "msg", ")", ";", "final", "LineMessage", "message", "=", "Message", ".", "MSG", "(", "(", "short", ")", "-", "1", ",", "line", ",", "Streamables", ".", "toByteArray", "(", "msg", ")", ")", ";", "cache", ".", "doOpAsync", "(", "Type", ".", "SEND", ",", "line", ",", "null", ",", "message", ",", "null", ")", ";", "}", "</s>"]
["<s>", "private", "void", "receive", "(", "MSG", "message", ")", "{", "final", "Msg", "msg", "=", "new", "Msg", "(", ")", ";", "Streamables", ".", "fromByteArray", "(", "msg", ",", "message", ".", "getData", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "msg", ")", ";", "final", "Collection", "<", "MessageListener", ">", "ls", "=", "msg", ".", "hasSTopic", "(", ")", "?", "stringTopicListeners", ".", "get", "(", "msg", ".", "getsTopic", "(", ")", ")", ":", "longTopicListeners", ".", "get", "(", "msg", ".", "getlTopic", "(", ")", ")", ";", "if", "(", "ls", "!", "=", "null", ")", "notifyListeners", "(", "ls", ",", "message", ".", "getNode", "(", ")", ",", "msg", ")", ";", "}", "</s>"]
["<s>", "private", "void", "notifyListeners", "(", "final", "Collection", "<", "MessageListener", ">", "listeners", ",", "final", "short", "node", ",", "final", "Msg", "msg", ")", "{", "executor", ".", "execute", "(", "new", "NodeTask", "(", ")", "{", "@", "Override", "public", "short", "getNode", "(", ")", "{", "return", "node", ";", "}", "@", "Override", "public", "void", "run", "(", ")", "{", "synchronized", "(", "listeners", ")", "{", "for", "(", "final", "MessageListener", "listener", ":", "listeners", ")", "{", "if", "(", "!", "(", "listener", "instanceof", "WithExecutor", ")", ")", "{", "try", "{", "listener", ".", "messageReceived", "(", "node", ",", "msg", ".", "getData", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "else", "{", "(", "(", "WithExecutor", ")", "listener", ")", ".", "getExecutor", "(", ")", ".", "execute", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "listener", ".", "messageReceived", "(", "node", ",", "msg", ".", "getData", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ")", ";", "}", "}", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "getNode", "(", ")", "{", "return", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "synchronized", "(", "listeners", ")", "{", "for", "(", "final", "MessageListener", "listener", ":", "listeners", ")", "{", "if", "(", "!", "(", "listener", "instanceof", "WithExecutor", ")", ")", "{", "try", "{", "listener", ".", "messageReceived", "(", "node", ",", "msg", ".", "getData", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "else", "{", "(", "(", "WithExecutor", ")", "listener", ")", ".", "getExecutor", "(", ")", ".", "execute", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "listener", ".", "messageReceived", "(", "node", ",", "msg", ".", "getData", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "listener", ".", "messageReceived", "(", "node", ",", "msg", ".", "getData", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Msg", "(", ")", "{", "}", "</s>"]
["<s>", "public", "Msg", "(", "long", "topic", ",", "byte", "[", "]", "data", ")", "{", "this", "(", "topic", ",", "null", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "Msg", "(", "String", "topic", ",", "byte", "[", "]", "data", ")", "{", "this", "(", "-", "1", ",", "topic", ",", "data", ")", ";", "assert", "topic", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "Msg", "(", "long", "topic", ",", "Streamable", "data", ")", "{", "this", "(", "topic", ",", "null", ",", "data", ")", ";", "}", "</s>"]
["<s>", "public", "Msg", "(", "String", "topic", ",", "Streamable", "data", ")", "{", "this", "(", "-", "1", ",", "topic", ",", "data", ")", ";", "assert", "topic", "!", "=", "null", ";", "}", "</s>"]
["<s>", "private", "Msg", "(", "long", "lTopic", ",", "String", "sTopic", ",", "byte", "[", "]", "data", ")", "{", "this", ".", "lTopic", "=", "lTopic", ";", "this", ".", "sTopic", "=", "sTopic", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "private", "Msg", "(", "long", "lTopic", ",", "String", "sTopic", ",", "Streamable", "data", ")", "{", "this", "(", "lTopic", ",", "sTopic", ",", "Streamables", ".", "toByteArray", "(", "data", ")", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "hasSTopic", "(", ")", "{", "return", "sTopic", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "long", "getlTopic", "(", ")", "{", "return", "lTopic", ";", "}", "</s>"]
["<s>", "public", "String", "getsTopic", "(", ")", "{", "return", "sTopic", ";", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "1", "+", "(", "lTopic", "!", "=", "-", "1", "?", "<NUM_LIT:8>", ":", "Streamables", ".", "calcUtfLength", "(", "sTopic", ")", "+", "<NUM_LIT:2>", "+", "data", ".", "length", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "DataOutput", "out", ")", "throws", "IOException", "{", "final", "boolean", "hasSTopic", "=", "hasSTopic", "(", ")", ";", "out", ".", "writeBoolean", "(", "hasSTopic", ")", ";", "if", "(", "hasSTopic", ")", "out", ".", "writeUTF", "(", "sTopic", ")", ";", "else", "out", ".", "writeLong", "(", "lTopic", ")", ";", "out", ".", "writeShort", "(", "(", "short", ")", "data", ".", "length", ")", ";", "out", ".", "write", "(", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read", "(", "DataInput", "in", ")", "throws", "IOException", "{", "final", "boolean", "hasSTopic", "=", "in", ".", "readBoolean", "(", ")", ";", "if", "(", "hasSTopic", ")", "{", "lTopic", "=", "-", "1", ";", "sTopic", "=", "in", ".", "readUTF", "(", ")", ";", "}", "else", "{", "lTopic", "=", "in", ".", "readLong", "(", ")", ";", "sTopic", "=", "null", ";", "}", "final", "int", "dataLength", "=", "in", ".", "readUnsignedShort", "(", ")", ";", "data", "=", "new", "byte", "[", "dataLength", "]", ";", "in", ".", "readFully", "(", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "sTopic", "!", "=", "null", ")", "sb", ".", "append", "(", "<CHAR_LIT:\">", ")", ".", "append", "(", "sTopic", ")", ".", "append", "(", "<CHAR_LIT:\">", ")", ";", "else", "sb", ".", "append", "(", "lTopic", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "data", "=", "=", "null", ")", "sb", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "else", "sb", ".", "append", "(", "(", "\"", "<STR_LIT:(>", "\"", ")", ")", ".", "append", "(", "data", ".", "length", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ";", "sb", ".", "append", "(", "\"", "<STR_LIT:]>", "\"", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "ByteBuffer", "allocateStorage", "(", "int", "size", ")", ";", "</s>"]
["<s>", "void", "deallocateStorage", "(", "long", "id", ",", "ByteBuffer", "buffer", ")", ";", "</s>"]
["<s>", "long", "getTotalAllocatedSize", "(", ")", ";", "</s>"]
["<s>", "public", "ClusterMonitor", "(", "Cluster", "cluster", ")", "{", "super", "(", "ClusterMXBean", ".", "class", ",", "true", ",", "new", "NotificationBroadcasterSupport", "(", ")", ")", ";", "this", ".", "name", "=", "\"", "<STR_LIT>", "\"", ";", "this", ".", "cluster", "=", "cluster", ";", "registerMBean", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "registerMBean", "(", ")", "{", "try", "{", "MBeanServer", "mbs", "=", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ";", "ObjectName", "mxbeanName", "=", "new", "ObjectName", "(", "name", ")", ";", "mbs", ".", "registerMBean", "(", "this", ",", "mxbeanName", ")", ";", "this", ".", "registered", "=", "true", ";", "}", "catch", "(", "InstanceAlreadyExistsException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "MBeanRegistrationException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "NotCompliantMBeanException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "MalformedObjectNameException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "unregisterMBean", "(", ")", "{", "try", "{", "if", "(", "registered", ")", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ".", "unregisterMBean", "(", "new", "ObjectName", "(", "name", ")", ")", ";", "this", ".", "registered", "=", "false", ";", "}", "catch", "(", "InstanceNotFoundException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "MBeanRegistrationException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "MalformedObjectNameException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "MBeanNotificationInfo", "[", "]", "getNotificationInfo", "(", ")", "{", "String", "[", "]", "types", "=", "new", "String", "[", "]", "{", "AttributeChangeNotification", ".", "ATTRIBUTE_CHANGE", "}", ";", "String", "_name", "=", "AttributeChangeNotification", ".", "class", ".", "getName", "(", ")", ";", "String", "description", "=", "\"", "<STR_LIT>", "\"", ";", "MBeanNotificationInfo", "info", "=", "new", "MBeanNotificationInfo", "(", "types", ",", "_name", ",", "description", ")", ";", "return", "new", "MBeanNotificationInfo", "[", "]", "{", "info", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "SortedMap", "<", "String", ",", "String", ">", "getMyNodeInfo", "(", ")", "{", "return", "toMap", "(", "cluster", ".", "getMyNodeInfo", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isOnline", "(", ")", "{", "return", "cluster", ".", "isOnline", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isMaster", "(", ")", "{", "return", "cluster", ".", "isMaster", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "cluster", ".", "goOffline", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasServer", "(", ")", "{", "return", "cluster", ".", "hasServer", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "getNodes", "(", ")", "{", "return", "toMapList", "(", "cluster", ".", "getMasters", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "SortedMap", "<", "String", ",", "String", ">", "getMyMaster", "(", ")", "{", "return", "toMap", "(", "cluster", ".", "getMyMaster", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "getMySlaves", "(", ")", "{", "return", "toMapList", "(", "cluster", ".", "getMySlaves", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "List", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "toMapList", "(", "Collection", "<", "NodeInfo", ">", "nis", ")", "{", "SortedSet", "<", "NodeInfo", ">", "nis1", "=", "new", "TreeSet", "<", "NodeInfo", ">", "(", "new", "Comparator", "<", "NodeInfo", ">", "(", ")", "{", "@", "Override", "public", "int", "compare", "(", "NodeInfo", "o1", ",", "NodeInfo", "o2", ")", "{", "return", "o1", ".", "getNodeId", "(", ")", "-", "o2", ".", "getNodeId", "(", ")", ";", "}", "}", ")", ";", "nis1", ".", "addAll", "(", "nis", ")", ";", "List", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "list", "=", "new", "ArrayList", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "(", "nis", ".", "size", "(", ")", ")", ";", "for", "(", "NodeInfo", "ni", ":", "nis1", ")", "list", ".", "add", "(", "toMap", "(", "ni", ")", ")", ";", "return", "list", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "compare", "(", "NodeInfo", "o1", ",", "NodeInfo", "o2", ")", "{", "return", "o1", ".", "getNodeId", "(", ")", "-", "o2", ".", "getNodeId", "(", ")", ";", "}", "</s>"]
["<s>", "private", "SortedMap", "<", "String", ",", "String", ">", "toMap", "(", "NodeInfo", "ni", ")", "{", "SortedMap", "<", "String", ",", "String", ">", "map", "=", "new", "TreeMap", "<", "String", ",", "String", ">", "(", ")", ";", "map", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "Short", ".", "toString", "(", "ni", ".", "getNodeId", "(", ")", ")", ")", ";", "map", ".", "put", "(", "\"", "<STR_LIT>", "\"", ",", "ni", ".", "getName", "(", ")", ")", ";", "for", "(", "String", "p", ":", "ni", ".", "getProperties", "(", ")", ")", "map", ".", "put", "(", "p", ",", "ni", ".", "get", "(", "p", ")", ".", "toString", "(", ")", ")", ";", "return", "map", ";", "}", "</s>"]
["<s>", "private", "void", "notifyAttributeChange", "(", "String", "message", ",", "String", "attrName", ")", "{", "try", "{", "Object", "newValue", "=", "this", ".", "getAttribute", "(", "attrName", ")", ";", "Notification", "n", "=", "new", "AttributeChangeNotification", "(", "this", ",", "notificationSequenceNumber", "+", "+", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "message", ",", "attrName", ",", "null", ",", "null", ",", "newValue", ")", ";", "sendNotification", "(", "n", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "ex", ".", "printStackTrace", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "joinedCluster", "(", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "offline", "(", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "online", "(", "boolean", "master", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", "+", "(", "master", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "newMaster", "(", "NodeInfo", "node", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slaveAdded", "(", "NodeInfo", "node", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slaveRemoved", "(", "NodeInfo", "node", ")", "{", "notifyAttributeChange", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ",", "long", "stackSize", ")", "{", "super", "(", "group", ",", "target", ",", "name", ",", "stackSize", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "super", "(", "group", ",", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "Runnable", "target", ",", "String", "name", ")", "{", "super", "(", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "ThreadGroup", "group", ",", "String", "name", ")", "{", "super", "(", "group", ",", "name", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "String", "name", ")", "{", "super", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ")", "{", "super", "(", "group", ",", "target", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", "Runnable", "target", ")", "{", "super", "(", "target", ")", ";", "}", "</s>"]
["<s>", "public", "CommThread", "(", ")", "{", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "ConfigurableThreadPool", "(", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveMillis", ",", "int", "maxQueueSize", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveMillis", ",", "TimeUnit", ".", "MILLISECONDS", ",", "makeQueue", "(", "maxQueueSize", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "BlockingQueue", "<", "Runnable", ">", "makeQueue", "(", "int", "maxSize", ")", "{", "if", "(", "maxSize", "=", "=", "0", ")", "return", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ";", "else", "if", "(", "maxSize", ">", "0", ")", "return", "new", "ArrayBlockingQueue", "<", "Runnable", ">", "(", "maxSize", ")", ";", "else", "return", "new", "LinkedTransferQueue", "<", "Runnable", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "NodeOrderedThreadPoolExecutor", "(", "Cluster", "cluster", ",", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "maxQueueSize", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "NodeOrderedThreadPoolExecutor", "(", "Cluster", "cluster", ",", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ",", "ThreadFactory", "threadFactory", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "maxQueueSize", ",", "threadFactory", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "NodeOrderedThreadPoolExecutor", "(", "Cluster", "cluster", ",", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ",", "RejectedExecutionHandler", "handler", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "maxQueueSize", ",", "handler", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "NodeOrderedThreadPoolExecutor", "(", "Cluster", "cluster", ",", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ",", "ThreadFactory", "threadFactory", ",", "RejectedExecutionHandler", "handler", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "maxQueueSize", ",", "threadFactory", ",", "handler", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "removeChildExecutor", "(", "id", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "Object", "getChildExecutorKey", "(", "Runnable", "task", ")", "{", "return", "(", "(", "NodeAttached", ")", "task", ")", ".", "getNode", "(", ")", ";", "}", "</s>"]
["<s>", "public", "MetricsLocalStorageMonitor", "(", "String", "name", ",", "CacheStorage", "localStorage", ")", "{", "allocated", "=", "Metrics", ".", "newHistogram", "(", "CacheStorage", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "name", ",", "true", ")", ";", "deallocated", "=", "Metrics", ".", "newHistogram", "(", "CacheStorage", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "name", ",", "true", ")", ";", "final", "WeakReference", "<", "CacheStorage", ">", "_localStorage", "=", "new", "WeakReference", "<", "CacheStorage", ">", "(", "localStorage", ")", ";", "totalSize", "=", "Metrics", ".", "newGauge", "(", "CacheStorage", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "name", ",", "new", "Gauge", "<", "Long", ">", "(", ")", "{", "@", "Override", "public", "Long", "value", "(", ")", "{", "final", "CacheStorage", "localStorage", "=", "_localStorage", ".", "get", "(", ")", ";", "return", "localStorage", "!", "=", "null", "?", "localStorage", ".", "getTotalAllocatedSize", "(", ")", ":", "0", "L", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "value", "(", ")", "{", "final", "CacheStorage", "localStorage", "=", "_localStorage", ".", "get", "(", ")", ";", "return", "localStorage", "!", "=", "null", "?", "localStorage", ".", "getTotalAllocatedSize", "(", ")", ":", "0", "L", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "allocated", "(", "int", "size", ")", "{", "allocated", ".", "update", "(", "size", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "deallocated", "(", "int", "size", ")", "{", "deallocated", ".", "update", "(", "size", ")", ";", "}", "</s>"]
["<s>", "void", "receive", "(", "Message", "message", ")", ";", "</s>"]
["<s>", "public", "MetricsOffHeapLocalStorageMonitor", "(", "String", "name", ",", "CacheStorage", "storage", ",", "int", "[", "]", "bins", ")", "{", "super", "(", "name", ",", "storage", ")", ";", "this", ".", "binMetrics", "=", "new", "BinMetrics", "[", "bins", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "bins", ".", "length", ";", "i", "+", "+", ")", "this", ".", "binMetrics", "[", "i", "]", "=", "new", "BinMetrics", "(", "name", ",", "bins", "[", "i", "]", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "allocated", "(", "int", "bin", ",", "int", "size", ")", "{", "super", ".", "allocated", "(", "size", ")", ";", "binMetrics", "[", "bin", "]", ".", "allocated", "(", "size", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "deallocated", "(", "int", "bin", ",", "int", "size", ")", "{", "super", ".", "deallocated", "(", "size", ")", ";", "binMetrics", "[", "bin", "]", ".", "deallocated", "(", "size", ")", ";", "}", "</s>"]
["<s>", "public", "BinMetrics", "(", "String", "name", ",", "int", "bin", ")", "{", "totalSize", "=", "Metrics", ".", "newCounter", "(", "CacheStorage", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "name", "+", "<CHAR_LIT:[>", "+", "bin", "+", "<CHAR_LIT:]>", ")", ";", "allocated", "=", "Metrics", ".", "newMeter", "(", "CacheStorage", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "name", "+", "<CHAR_LIT:[>", "+", "bin", "+", "<CHAR_LIT:]>", ",", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "SECONDS", ")", ";", "deallocated", "=", "Metrics", ".", "newMeter", "(", "CacheStorage", ".", "class", ",", "\"", "<STR_LIT>", "\"", ",", "name", "+", "<CHAR_LIT:[>", "+", "bin", "+", "<CHAR_LIT:]>", ",", "\"", "<STR_LIT>", "\"", ",", "TimeUnit", ".", "SECONDS", ")", ";", "}", "</s>"]
["<s>", "public", "void", "allocated", "(", "int", "size", ")", "{", "totalSize", ".", "inc", "(", "size", ")", ";", "allocated", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "deallocated", "(", "int", "size", ")", "{", "totalSize", ".", "dec", "(", "size", ")", ";", "deallocated", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "void", "addBackups", "(", "int", "num", ")", ";", "</s>"]
["<s>", "void", "addReplicationBackup", "(", "int", "num", ")", ";", "</s>"]
["<s>", "void", "addBackupPacket", "(", ")", ";", "</s>"]
["<s>", "void", "addSlaveAckTime", "(", "long", "nanos", ")", ";", "</s>"]
["<s>", "void", "addServerAckTime", "(", "long", "nanos", ")", ";", "</s>"]
["<s>", "public", "JMXOffHeapLocalStorageMonitor", "(", "String", "name", ",", "CacheStorage", "storage", ",", "int", "[", "]", "bins", ")", "{", "super", "(", "OffHeapLocalStorageMXBean", ".", "class", ",", "name", ",", "storage", ")", ";", "this", ".", "bins", "=", "new", "Integer", "[", "bins", ".", "length", "]", ";", "this", ".", "binCounters", "=", "new", "BinCounters", "[", "bins", ".", "length", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "bins", ".", "length", ";", "i", "+", "+", ")", "{", "this", ".", "bins", "[", "i", "]", "=", "bins", "[", "i", "]", ";", "this", ".", "binCounters", "[", "i", "]", "=", "new", "BinCounters", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "collectAndResetCounters", "(", ")", "{", "super", ".", "collectAndResetCounters", "(", ")", ";", "for", "(", "BinCounters", "bc", ":", "binCounters", ")", "bc", ".", "collectAndReset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "resetCounters", "(", ")", "{", "super", ".", "resetCounters", "(", ")", ";", "for", "(", "BinCounters", "bc", ":", "binCounters", ")", "bc", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "allocated", "(", "int", "bin", ",", "int", "size", ")", "{", "super", ".", "allocated", "(", "size", ")", ";", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "deallocated", "(", "int", "bin", ",", "int", "size", ")", "{", "super", ".", "deallocated", "(", "size", ")", ";", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "Integer", ",", "Integer", ">", "getBinsAllocated", "(", ")", "{", "Map", "<", "Integer", ",", "Integer", ">", "table", "=", "new", "HashMap", "<", "Integer", ",", "Integer", ">", "(", "binCounters", ".", "length", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "binCounters", ".", "length", ";", "i", "+", "+", ")", "table", ".", "put", "(", "bins", "[", "i", "]", ",", "binCounters", "[", "i", "]", ".", "allocated", ")", ";", "return", "table", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "Integer", ",", "Integer", ">", "getBinsDeallocated", "(", ")", "{", "Map", "<", "Integer", ",", "Integer", ">", "table", "=", "new", "HashMap", "<", "Integer", ",", "Integer", ">", "(", "binCounters", ".", "length", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "binCounters", ".", "length", ";", "i", "+", "+", ")", "table", ".", "put", "(", "bins", "[", "i", "]", ",", "binCounters", "[", "i", "]", ".", "deallocated", ")", ";", "return", "table", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "Integer", ",", "Long", ">", "getBinsTotalMemory", "(", ")", "{", "Map", "<", "Integer", ",", "Long", ">", "table", "=", "new", "HashMap", "<", "Integer", ",", "Long", ">", "(", "binCounters", ".", "length", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "binCounters", ".", "length", ";", "i", "+", "+", ")", "table", ".", "put", "(", "bins", "[", "i", "]", ",", "binCounters", "[", "i", "]", ".", "totalSize", ".", "get", "(", ")", ")", ";", "return", "table", ";", "}", "</s>"]
["<s>", "public", "void", "collectAndReset", "(", ")", "{", "allocated", "=", "(", "int", ")", "allocatedCounter", ".", "get", "(", ")", ";", "deallocated", "=", "(", "int", ")", "deallocatedCounter", ".", "get", "(", ")", ";", "allocatedCounter", ".", "reset", "(", ")", ";", "deallocatedCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "reset", "(", ")", "{", "allocatedCounter", ".", "reset", "(", ")", ";", "deallocatedCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "public", "JMXLocalStorageMonitor", "(", "String", "name", ",", "CacheStorage", "localStorage", ")", "{", "this", "(", "LocalStorageMXBean", ".", "class", ",", "name", ",", "localStorage", ")", ";", "}", "</s>"]
["<s>", "protected", "JMXLocalStorageMonitor", "(", "Class", "mbean", ",", "String", "name", ",", "CacheStorage", "localStorage", ")", "{", "super", "(", "mbean", ",", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "localStorage", "=", "new", "WeakReference", "<", "CacheStorage", ">", "(", "localStorage", ")", ";", "setMonitoredObject", "(", "localStorage", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "initCounters", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "collectAndResetCounters", "(", ")", "{", "allocated", "=", "(", "int", ")", "allocatedCounter", ".", "get", "(", ")", ";", "deallocated", "=", "(", "int", ")", "deallocatedCounter", ".", "get", "(", ")", ";", "allocatedCounter", ".", "reset", "(", ")", ";", "deallocatedCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "resetCounters", "(", ")", "{", "allocatedCounter", ".", "reset", "(", ")", ";", "deallocatedCounter", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "allocated", "(", "int", "size", ")", "{", "allocatedCounter", ".", "add", "(", "size", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "deallocated", "(", "int", "size", ")", "{", "deallocatedCounter", ".", "add", "(", "size", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getAllocated", "(", ")", "{", "return", "allocated", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getDeallocated", "(", ")", "{", "return", "deallocated", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTotalMemory", "(", ")", "{", "final", "CacheStorage", "_localStorage", "=", "localStorage", ".", "get", "(", ")", ";", "return", "_localStorage", "!", "=", "null", "?", "_localStorage", ".", "getTotalAllocatedSize", "(", ")", ":", "0", "L", ";", "}", "</s>"]
["<s>", "void", "setCache", "(", "Cache", "cache", ")", ";", "</s>"]
["<s>", "void", "startBackup", "(", ")", ";", "</s>"]
["<s>", "void", "backup", "(", "long", "id", ",", "long", "version", ")", ";", "</s>"]
["<s>", "void", "endBackup", "(", ")", ";", "</s>"]
["<s>", "boolean", "inv", "(", "long", "id", ",", "short", "owner", ")", ";", "</s>"]
["<s>", "void", "flush", "(", ")", ";", "</s>"]
["<s>", "Iterator", "<", "BACKUP", ">", "iterOwned", "(", ")", ";", "</s>"]
["<s>", "void", "receive", "(", "Message", "message", ")", ";", "</s>"]
["<s>", "void", "slavesAck", "(", "long", "id", ")", ";", "</s>"]
["<s>", "void", "slavesInvAck", "(", "long", "id", ")", ";", "</s>"]
["<s>", "public", "StringRootManager", "(", "StoreImpl", "store", ",", "Cluster", "cluster", ")", "{", "this", ".", "store", "=", "store", ";", "this", ".", "cluster", "=", "cluster", ";", "this", ".", "rootLocker", "=", "(", "RootLocker", ")", "cluster", ";", "}", "</s>"]
["<s>", "public", "long", "get", "(", "String", "root", ",", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "return", "new", "StringRootPageHandler", "(", "root", ")", ".", "find", "(", "txn", ")", ";", "}", "</s>"]
["<s>", "public", "StringRootPageHandler", "(", "String", "str", ")", "{", "this", ".", "str", "=", "str", ";", "}", "</s>"]
["<s>", "public", "long", "find", "(", "Transaction", "txn", ")", "throws", "TimeoutException", "{", "ref", "=", "str", ".", "hashCode", "(", ")", ";", "result", "=", "-", "1", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "ref", ")", ")", ";", "initialGet", "(", ")", ";", "while", "(", "result", "<", "0", "&", "&", "ref", ">", "=", "0", ")", "store", ".", "get1", "(", "ref", ",", "this", ")", ";", "if", "(", "result", ">", "=", "0", ")", "return", "result", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "str", ")", ";", "final", "short", "mySize", "=", "(", "short", ")", "new", "Entry", "(", "str", ",", "-", "1", ")", ".", "size", "(", ")", ";", "ref", "=", "str", ".", "hashCode", "(", ")", ";", "long", "prevRef", "=", "-", "1", ";", "while", "(", "ref", "!", "=", "-", "1", ")", "{", "final", "long", "curRef", "=", "this", ".", "ref", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "ref", ")", ")", ";", "try", "{", "store", ".", "getx1", "(", "curRef", ",", "this", ",", "null", ")", ";", "}", "finally", "{", "if", "(", "prevRef", ">", "=", "0", ")", "{", "store", ".", "release", "(", "prevRef", ")", ";", "}", "}", "if", "(", "result", ">", "=", "0", ")", "{", "store", ".", "release", "(", "curRef", ")", ";", "return", "result", ";", "}", "else", "if", "(", "this", ".", "size", "+", "mySize", "<", "=", "store", ".", "getMaxItemSize", "(", ")", ")", "{", "final", "long", "myRef", "=", "store", ".", "put", "(", "new", "byte", "[", "0", "]", ",", "null", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "str", ",", "hex", "(", "myRef", ")", ",", "hex", "(", "curRef", ")", "}", ")", ";", "final", "StringRootPage", "page", "=", "new", "StringRootPage", "(", ")", ";", "store", ".", "getx1", "(", "curRef", ",", "page", ",", "null", ")", ";", "page", ".", "put", "(", "str", ",", "myRef", ")", ";", "store", ".", "set1", "(", "curRef", ",", "page", ",", "null", ")", ";", "store", ".", "release", "(", "curRef", ")", ";", "txn", ".", "add", "(", "myRef", ")", ";", "return", "myRef", ";", "}", "prevRef", "=", "curRef", ";", "}", "final", "long", "myRef", "=", "store", ".", "put", "(", "new", "byte", "[", "0", "]", ",", "null", ")", ";", "final", "StringRootPage", "page", "=", "new", "StringRootPage", "(", ")", ";", "page", ".", "put", "(", "str", ",", "myRef", ")", ";", "this", ".", "ref", "=", "store", ".", "put", "(", "page", ",", "null", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "str", ",", "hex", "(", "myRef", ")", ",", "hex", "(", "this", ".", "ref", ")", "}", ")", ";", "if", "(", "prevRef", ">", "=", "0", ")", "{", "store", ".", "set1", "(", "prevRef", ",", "this", ",", "null", ")", ";", "store", ".", "release", "(", "prevRef", ")", ";", "}", "store", ".", "release", "(", "ref", ")", ";", "txn", ".", "add", "(", "myRef", ")", ";", "return", "myRef", ";", "}", "</s>"]
["<s>", "private", "void", "initialGet", "(", ")", "throws", "TimeoutException", "{", "if", "(", "cluster", ".", "hasServer", "(", ")", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "ref", ")", ")", ";", "store", ".", "get1", "(", "ref", ",", "Comm", ".", "SERVER", ",", "this", ")", ";", "}", "else", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "ref", ")", ")", ";", "Object", "lock", "=", "rootLocker", ".", "lockRoot", "(", "(", "int", ")", "ref", ")", ";", "try", "{", "store", ".", "get1", "(", "ref", ",", "this", ")", ";", "}", "finally", "{", "rootLocker", ".", "unlockRoot", "(", "lock", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "size", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read", "(", "ByteBuffer", "buffer", ")", "{", "if", "(", "buffer", "=", "=", "null", "|", "|", "buffer", ".", "remaining", "(", ")", "<", "<NUM_LIT:10>", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "ref", ")", ")", ";", "this", ".", "ref", "=", "-", "1", ";", "this", ".", "size", "=", "0", ";", "return", ";", "}", "final", "long", "nextRef", "=", "buffer", ".", "getLong", "(", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "hex", "(", "nextRef", ")", ")", ";", "this", ".", "ref", "=", "nextRef", ";", "this", ".", "size", "=", "(", "short", ")", "buffer", ".", "limit", "(", ")", ";", "final", "short", "numEntries", "=", "buffer", ".", "getShort", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numEntries", ";", "i", "+", "+", ")", "{", "final", "Entry", "entry", "=", "new", "Entry", "(", ")", ";", "entry", ".", "read", "(", "buffer", ")", ";", "if", "(", "entry", ".", "str", ".", "equals", "(", "this", ".", "str", ")", ")", "{", "result", "=", "entry", ".", "ref", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "str", ",", "hex", "(", "result", ")", ")", ";", "return", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "ByteBuffer", "buffer", ")", "{", "buffer", ".", "putLong", "(", "0", ",", "ref", ")", ";", "buffer", ".", "position", "(", "buffer", ".", "limit", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "long", "get", "(", "String", "str", ")", "{", "final", "int", "index", "=", "Collections", ".", "binarySearch", "(", "entries", ",", "new", "Entry", "(", "str", ",", "-", "1", ")", ")", ";", "if", "(", "index", ">", "=", "0", ")", "return", "entries", ".", "get", "(", "index", ")", ".", "ref", ";", "else", "return", "-", "1", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "put", "(", "String", "str", ",", "long", "ref", ")", "{", "final", "Entry", "entry", "=", "new", "Entry", "(", "str", ",", "ref", ")", ";", "final", "int", "index", "=", "Collections", ".", "binarySearch", "(", "entries", ",", "entry", ")", ";", "if", "(", "index", "<", "0", ")", "entries", ".", "add", "(", "-", "index", "-", "1", ",", "entry", ")", ";", "else", "assert", "entries", ".", "get", "(", "index", ")", ".", "ref", "=", "=", "ref", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setNextRef", "(", "long", "ref", ")", "{", "this", ".", "nextRef", "=", "ref", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "int", "size", "=", "<NUM_LIT:2>", "+", "<NUM_LIT:8>", ";", "for", "(", "Entry", "entry", ":", "entries", ")", "size", "+", "=", "entry", ".", "size", "(", ")", ";", "return", "size", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "write", "(", "ByteBuffer", "buffer", ")", "{", "buffer", ".", "putLong", "(", "nextRef", ")", ";", "buffer", ".", "putShort", "(", "(", "short", ")", "entries", ".", "size", "(", ")", ")", ";", "for", "(", "Entry", "entry", ":", "entries", ")", "entry", ".", "write", "(", "buffer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "read", "(", "ByteBuffer", "buffer", ")", "{", "if", "(", "buffer", "=", "=", "null", "|", "|", "buffer", ".", "remaining", "(", ")", "<", "<NUM_LIT:10>", ")", "{", "nextRef", "=", "-", "1", ";", "return", ";", "}", "nextRef", "=", "buffer", ".", "getLong", "(", ")", ";", "final", "short", "numEntries", "=", "buffer", ".", "getShort", "(", ")", ";", "entries", ".", "ensureCapacity", "(", "numEntries", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "numEntries", ";", "i", "+", "+", ")", "{", "final", "Entry", "entry", "=", "new", "Entry", "(", ")", ";", "entry", ".", "read", "(", "buffer", ")", ";", "entries", ".", "add", "(", "entry", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Entry", "(", "String", "str", ",", "long", "ref", ")", "{", "this", ".", "str", "=", "str", ";", "this", ".", "ref", "=", "ref", ";", "}", "</s>"]
["<s>", "public", "Entry", "(", ")", "{", "this", "(", "null", ",", "-", "1", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "compareTo", "(", "Entry", "o", ")", "{", "return", "str", ".", "compareTo", "(", "o", ".", "str", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "false", ";", "if", "(", "getClass", "(", ")", "!", "=", "obj", ".", "getClass", "(", ")", ")", "return", "false", ";", "final", "Entry", "other", "=", "(", "Entry", ")", "obj", ";", "if", "(", "!", "Objects", ".", "equals", "(", "this", ".", "str", ",", "other", ".", "str", ")", ")", "return", "false", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "str", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "<NUM_LIT:2>", "+", "Streamables", ".", "calcUtfLength", "(", "str", ")", "+", "<NUM_LIT:8>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "ByteBuffer", "buffer", ")", "{", "final", "byte", "[", "]", "chars", "=", "str", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "buffer", ".", "putShort", "(", "(", "short", ")", "chars", ".", "length", ")", ";", "buffer", ".", "put", "(", "chars", ")", ";", "buffer", ".", "putLong", "(", "ref", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read", "(", "ByteBuffer", "buffer", ")", "{", "final", "short", "length", "=", "buffer", ".", "getShort", "(", ")", ";", "final", "byte", "[", "]", "chars", "=", "new", "byte", "[", "length", "]", ";", "buffer", ".", "get", "(", "chars", ")", ";", "str", "=", "new", "String", "(", "chars", ",", "Charsets", ".", "UTF_8", ")", ";", "ref", "=", "buffer", ".", "getLong", "(", ")", ";", "}", "</s>"]
["<s>", "void", "setBackup", "(", "Backup", "backup", ")", ";", "</s>"]
["<s>", "boolean", "send", "(", "Message", "message", ")", "throws", "NodeNotFoundException", ";", "</s>"]
["<s>", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", ";", "</s>"]
["<s>", "void", "send", "(", "Message", "message", ")", "throws", "NodeNotFoundException", ";", "</s>"]
["<s>", "void", "allocated", "(", "int", "size", ")", ";", "</s>"]
["<s>", "void", "deallocated", "(", "int", "size", ")", ";", "</s>"]
["<s>", "public", "IdAllocator", "(", "Cache", "cache", ",", "RefAllocator", "refAllocator", ")", "{", "this", ".", "cache", "=", "cache", ";", "this", ".", "refAllocator", "=", "refAllocator", ";", "refAllocator", ".", "addRefAllocationsListener", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "counterReady", "(", ")", "{", "ready", "=", "true", ";", "cache", ".", "allocatorReady", "(", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "isReady", "(", ")", "{", "return", "ready", ";", "}", "</s>"]
["<s>", "private", "synchronized", "long", "allocateIds", "(", "int", "count", ")", "{", "if", "(", "nextId", "+", "count", ">", "maxId", "&", "&", "nextMinId", ">", "minId", ")", "{", "minId", "=", "nextMinId", ";", "maxId", "=", "nextMaxId", ";", "nextId", "=", "minId", ";", "}", "final", "long", "id", ";", "if", "(", "nextId", "+", "count", "-", "1", "<", "=", "maxId", ")", "{", "id", "=", "nextId", ";", "nextId", "+", "=", "count", ";", "}", "else", "id", "=", "-", "1", ";", "if", "(", "!", "requestedMoreIds", "&", "&", "(", "id", "=", "=", "-", "1", "|", "|", "shouldAllocateMoreIds", "(", ")", ")", ")", "{", "allocateMoreRefs", "(", "count", ")", ";", "requestedMoreIds", "=", "true", ";", "}", "return", "id", ";", "}", "</s>"]
["<s>", "public", "synchronized", "long", "allocateIds", "(", "Op", "op", ",", "int", "count", ")", "{", "final", "long", "id", "=", "allocateIds", "(", "count", ")", ";", "if", "(", "id", "=", "=", "-", "1", ")", "{", "if", "(", "!", "op", ".", "hasFuture", "(", ")", ")", "op", ".", "createFuture", "(", ")", ";", "pendingOps", ".", "add", "(", "op", ")", ";", "}", "return", "id", ";", "}", "</s>"]
["<s>", "private", "boolean", "shouldAllocateMoreIds", "(", ")", "{", "return", "nextId", ">", "(", "minId", "+", "(", "maxId", "-", "minId", ")", "/", "<NUM_LIT:2>", ")", ";", "}", "</s>"]
["<s>", "void", "allocateMoreRefs", "(", "int", "count", ")", "{", "refAllocator", ".", "allocateRefs", "(", "Math", ".", "max", "(", "<NUM_LIT:2>", "*", "count", ",", "REFS_TO_ALLOCATE", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "refsAllocated", "(", "long", "start", ",", "int", "num", ")", "{", "List", "<", "Op", ">", "pending", ";", "synchronized", "(", "this", ")", "{", "assert", "start", ">", "nextId", "|", "|", "(", "start", "=", "=", "minId", ")", ";", "assert", "start", "+", "num", ">", "maxId", ";", "if", "(", "start", "=", "=", "minId", ")", "{", "assert", "start", "+", "num", ">", "maxId", ";", "maxId", "=", "start", "+", "num", "-", "1", ";", "}", "else", "{", "assert", "start", ">", "nextId", ";", "requestedMoreIds", "=", "false", ";", "this", ".", "nextMinId", "=", "start", ";", "this", ".", "nextMaxId", "=", "start", "+", "num", "-", "1", ";", "}", "pending", "=", "pendingOps", ";", "pendingOps", "=", "new", "ArrayList", "<", "Op", ">", "(", ")", ";", "}", "for", "(", "Op", "op", ":", "pending", ")", "cache", ".", "runOp", "(", "op", ")", ";", "}", "</s>"]
["<s>", "public", "ClusterService", "(", "String", "name", ",", "Cluster", "cluster", ")", "{", "super", "(", "name", ")", ";", "this", ".", "cluster", "=", "cluster", ";", "cluster", ".", "addLifecycleListener", "(", "this", ")", ";", "synchronized", "(", "lifecycleLock", ")", "{", "online", "=", "cluster", ".", "isOnline", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "if", "(", "online", ")", "startService", "(", ")", ";", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "startService", "(", ")", "{", "final", "boolean", "master", "=", "cluster", ".", "isMaster", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "master", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "start", "(", "master", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "0", ")", "protected", "boolean", "isOnline", "(", ")", "{", "return", "online", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isMaster", "(", ")", "{", "return", "cluster", ".", "isMaster", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "void", "start", "(", "boolean", "master", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "joinedCluster", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "online", "(", "boolean", "master", ")", "{", "synchronized", "(", "lifecycleLock", ")", "{", "if", "(", "!", "online", ")", "{", "online", "=", "true", ";", "if", "(", "isInitialized", "(", ")", ")", "startService", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "offline", "(", ")", "{", "synchronized", "(", "lifecycleLock", ")", "{", "if", "(", "online", ")", "{", "online", "=", "false", ";", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "getName", "(", ")", ")", ";", "shutdown", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "getName", "(", ")", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "getName", "(", ")", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "}", "</s>"]
["<s>", "public", "Cluster", "getCluster", "(", ")", "{", "return", "cluster", ";", "}", "</s>"]
["<s>", "public", "AbstractComm", "(", "String", "name", ",", "Cluster", "cluster", ",", "NodeAddressResolver", "<", "Address", ">", "addressResolver", ")", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "addressResolver", "=", "addressResolver", ";", "this", ".", "cluster", "=", "cluster", ";", "cluster", ".", "addNodeChangeListener", "(", "this", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setSendToServerInsteadOfMulticast", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "sendToServerInsteadOfMulticast", "=", "value", ";", "}", "</s>"]
["<s>", "public", "boolean", "isSendToServerInsteadOfMulticast", "(", ")", "{", "return", "sendToServerInsteadOfMulticast", ";", "}", "</s>"]
["<s>", "public", "void", "setTimeout", "(", "long", "milliseconds", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "timeout", "=", "milliseconds", ";", "}", "</s>"]
["<s>", "protected", "long", "getTimeout", "(", ")", "{", "return", "timeout", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiver", "=", "receiver", ";", "}", "</s>"]
["<s>", "protected", "short", "getNode", "(", "Address", "address", ")", "{", "return", "addressResolver", ".", "getNodeId", "(", "address", ")", ";", "}", "</s>"]
["<s>", "protected", "Address", "getNodeAddress", "(", "short", "node", ")", "{", "return", "addressResolver", ".", "getNodeAddress", "(", "node", ")", ";", "}", "</s>"]
["<s>", "protected", "long", "nextMessageId", "(", ")", "{", "return", "nextMessageId", ".", "getAndIncrement", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "ScheduledExecutorService", "getScheduler", "(", ")", "{", "return", "scheduler", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "final", "Message", "message", ")", "throws", "NodeNotFoundException", "{", "assert", "message", ".", "getMessageId", "(", ")", "<", "=", "0", "^", "message", ".", "isResponse", "(", ")", ";", "message", ".", "setTimestamp", "(", "System", ".", "nanoTime", "(", ")", ")", ";", "assert", "message", ".", "isBroadcast", "(", ")", "^", "message", ".", "getNode", "(", ")", ">", "=", "0", ";", "if", "(", "message", ".", "getNode", "(", ")", "=", "=", "cluster", ".", "getMyNodeId", "(", ")", ")", "{", "scheduler", ".", "execute", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "receive", "(", "message", ")", ";", "}", "}", ")", ";", "return", ";", "}", "if", "(", "getCluster", "(", ")", ".", "hasServer", "(", ")", ")", "{", "if", "(", "message", ".", "isBroadcast", "(", ")", "&", "&", "(", "sendToServerInsteadOfMulticast", "|", "|", "(", "message", "instanceof", "LineMessage", "&", "&", "Cache", ".", "isReserved", "(", "(", "(", "LineMessage", ")", "message", ")", ".", "getLine", "(", ")", ")", ")", ")", ")", "message", ".", "setNode", "(", "SERVER", ")", ";", "}", "if", "(", "message", ".", "getNode", "(", ")", "=", "=", "SERVER", ")", "sendToServer", "(", "message", ")", ";", "else", "if", "(", "message", ".", "getNode", "(", ")", ">", "=", "0", ")", "sendToNode", "(", "message", ",", "message", ".", "getNode", "(", ")", ")", ";", "else", "broadcast", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "receive", "(", "message", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "assignMessageId", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "getMessageId", "(", ")", "<", "0", ")", "message", ".", "setMessageId", "(", "nextMessageId", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "sendToServer", "(", "Message", "message", ")", "{", "assignMessageId", "(", "message", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "sendToNode", "(", "Message", "message", ",", "short", "node", ")", "throws", "NodeNotFoundException", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "message", ")", ";", "final", "Address", "address", "=", "getNodeAddress", "(", "node", ")", ";", "if", "(", "address", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "message", ")", ";", "throw", "new", "NodeNotFoundException", "(", "node", ")", ";", "}", "else", "sendToNode", "(", "message", ",", "node", ",", "address", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "void", "sendToNode", "(", "Message", "message", ",", "short", "node", ",", "Address", "address", ")", ";", "</s>"]
["<s>", "protected", "abstract", "void", "broadcast", "(", "Message", "message", ")", ";", "</s>"]
["<s>", "protected", "final", "void", "receive", "(", "Message", "message", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "receiver", ".", "receive", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "Transaction", "(", "boolean", "rollback", ")", "{", "rollbackLog", "=", "rollback", "?", "new", "TLongObjectHashMap", "<", "RollbackInfo", ">", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "synchronized", "void", "add", "(", "long", "id", ")", "{", "if", "(", "ls", "=", "=", "null", ")", "ls", "=", "new", "TLongHashSet", "(", ")", ";", "ls", ".", "add", "(", "id", ")", ";", "if", "(", "lines", "=", "=", "null", ")", "lines", "=", "ls", ";", "else", "if", "(", "lines", "!", "=", "ls", ")", "(", "(", "TLongCompoundCollection", ")", "lines", ")", ".", "addCollection", "(", "ls", ")", ";", "}", "</s>"]
["<s>", "synchronized", "void", "add", "(", "TLongCollection", "c", ")", "{", "if", "(", "lines", "=", "=", "null", ")", "lines", "=", "new", "TLongCompoundCollection", "(", ")", ";", "else", "if", "(", "lines", "=", "=", "ls", ")", "{", "lines", "=", "new", "TLongCompoundCollection", "(", ")", ";", "(", "(", "TLongCompoundCollection", ")", "lines", ")", ".", "addCollection", "(", "ls", ")", ";", "}", "(", "(", "TLongCompoundCollection", ")", "lines", ")", ".", "addCollection", "(", "c", ")", ";", "}", "</s>"]
["<s>", "synchronized", "void", "add", "(", "Op", "op", ")", "{", "if", "(", "ops", "=", "=", "null", ")", "ops", "=", "new", "ArrayList", "<", "Op", ">", "(", ")", ";", "ops", ".", "add", "(", "op", ")", ";", "}", "</s>"]
["<s>", "synchronized", "boolean", "isRecorded", "(", "long", "id", ")", "{", "return", "rollbackLog", ".", "contains", "(", "id", ")", ";", "}", "</s>"]
["<s>", "synchronized", "void", "recordRollback", "(", "long", "id", ",", "long", "version", ",", "boolean", "modified", ",", "byte", "[", "]", "data", ")", "{", "RollbackInfo", "prev", "=", "rollbackLog", ".", "putIfAbsent", "(", "id", ",", "new", "RollbackInfo", "(", "version", ",", "modified", ",", "data", ")", ")", ";", "assert", "prev", "=", "=", "null", ";", "}", "</s>"]
["<s>", "synchronized", "TLongCollection", "getLines", "(", ")", "{", "return", "lines", "!", "=", "null", "?", "lines", ":", "TLongAbstractCollection", ".", "EMPTY_COLLECTION", ";", "}", "</s>"]
["<s>", "synchronized", "List", "<", "Op", ">", "getOps", "(", ")", "{", "return", "ops", "=", "=", "null", "?", "Collections", ".", "<", "Op", ">", "emptyList", "(", ")", ":", "ops", ";", "}", "</s>"]
["<s>", "synchronized", "void", "forEachRollback", "(", "TLongObjectProcedure", "<", "RollbackInfo", ">", "proc", ")", "{", "rollbackLog", ".", "forEachEntry", "(", "proc", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "Iterator", "<", "Long", ">", "iterator", "(", ")", "{", "if", "(", "lines", "=", "=", "null", ")", "return", "Collections", ".", "emptyIterator", "(", ")", ";", "final", "TLongIterator", "it", "=", "lines", ".", "iterator", "(", ")", ";", "return", "new", "Iterator", "<", "Long", ">", "(", ")", "{", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasNext", "(", ")", ";", "}", "@", "Override", "public", "Long", "next", "(", ")", "{", "return", "it", ".", "next", "(", ")", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasNext", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Long", "next", "(", ")", "{", "return", "it", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "boolean", "contains", "(", "long", "id", ")", "{", "if", "(", "lines", "=", "=", "null", ")", "return", "false", ";", "return", "lines", ".", "contains", "(", "id", ")", ";", "}", "</s>"]
["<s>", "public", "RollbackInfo", "(", "long", "version", ",", "boolean", "modified", ",", "byte", "[", "]", "data", ")", "{", "this", ".", "version", "=", "version", ";", "this", ".", "modified", "=", "modified", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "void", "nodeAdded", "(", "String", "fqn", ")", ";", "</s>"]
["<s>", "void", "nodeRemoved", "(", "String", "fqn", ")", ";", "</s>"]
["<s>", "void", "nodeUpdated", "(", "String", "fqn", ")", ";", "</s>"]
["<s>", "void", "nodeChildAdded", "(", "String", "parentFqn", ",", "String", "childName", ")", ";", "</s>"]
["<s>", "void", "nodeChildRemoved", "(", "String", "parentFqn", ",", "String", "childName", ")", ";", "</s>"]
["<s>", "void", "nodeChildUpdated", "(", "String", "parentFqn", ",", "String", "childName", ")", ";", "</s>"]
["<s>", "byte", "[", "]", "resolve", "(", "String", "node", ",", "byte", "[", "]", "current", ",", "byte", "[", "]", "other", ",", "Address", "otherAddress", ")", ";", "</s>"]
["<s>", "public", "ReplicatedTree", "(", "Channel", "channel", ",", "ConflictResolver", "conflictResolver", ",", "long", "getStateTimeout", ")", "throws", "Exception", "{", "if", "(", "!", "channel", ".", "hasProtocol", "(", "SEQUENCER", ".", "class", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "channel", "=", "channel", ";", "this", ".", "conflictResolver", "=", "conflictResolver", ";", "this", ".", "getStateTimeout", "=", "getStateTimeout", ";", "channel", ".", "setReceiver", "(", "myReceiver", ")", ";", "}", "</s>"]
["<s>", "public", "ReplicatedTree", "(", "JChannel", "channel", ",", "ConflictResolver", "conflictResolver", ",", "long", "getStateTimeout", ")", "throws", "Exception", "{", "this", "(", "new", "JChannelAdapter", "(", "channel", ")", ",", "conflictResolver", ",", "getStateTimeout", ")", ";", "}", "</s>"]
["<s>", "public", "void", "start", "(", ")", "throws", "Exception", "{", "channel", ".", "getState", "(", "null", ",", "getStateTimeout", ",", "true", ")", ";", "}", "</s>"]
["<s>", "public", "Channel", "getChannel", "(", ")", "{", "return", "channel", ";", "}", "</s>"]
["<s>", "public", "void", "addListener", "(", "String", "node", ",", "ReplicatedTreeListener", "listener", ")", "{", "final", "Node", "n", "=", "findNode", "(", "node", ")", ";", "if", "(", "n", "=", "=", "null", ")", "pendingListeners", ".", "put", "(", "node", ",", "listener", ")", ";", "else", "n", ".", "addListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeListener", "(", "String", "node", ",", "ReplicatedTreeListener", "listener", ")", "{", "final", "Node", "n", "=", "findNode", "(", "node", ")", ";", "if", "(", "n", "=", "=", "null", ")", "pendingListeners", ".", "remove", "(", "node", ",", "listener", ")", ";", "else", "n", ".", "removeListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "create", "(", "String", "fqn", ",", "boolean", "ephemeral", ")", "{", "awaitRunning", "(", ")", ";", "try", "{", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ",", "ephemeral", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "\"", ")", ";", "channel", ".", "send", "(", "new", "Message", "(", "null", ",", "new", "Request", "(", "Request", ".", "CREATE", ",", "fqn", ",", "ephemeral", ")", ")", ")", ";", "synchronized", "(", "updateCondition", ")", "{", "while", "(", "!", "exists", "(", "fqn", ")", ")", "{", "updateCondition", ".", "wait", "(", ")", ";", "}", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "set", "(", "String", "fqn", ",", "byte", "[", "]", "data", ")", "{", "awaitRunning", "(", ")", ";", "try", "{", "channel", ".", "send", "(", "new", "Message", "(", "null", ",", "new", "Request", "(", "Request", ".", "SET", ",", "fqn", ",", "data", ")", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "remove", "(", "String", "fqn", ")", "{", "awaitRunning", "(", ")", ";", "try", "{", "channel", ".", "send", "(", "new", "Message", "(", "null", ",", "new", "Request", "(", "Request", ".", "REMOVE", ",", "fqn", ")", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "remove", "(", "String", "parentFqn", ",", "String", "childName", ")", "{", "remove", "(", "parentFqn", "+", "SEPARATOR", "+", "childName", ")", ";", "}", "</s>"]
["<s>", "public", "void", "flush", "(", ")", "{", "awaitRunning", "(", ")", ";", "try", "{", "Message", "msg", "=", "new", "Message", "(", "null", ",", "new", "byte", "[", "0", "]", ")", ";", "msg", ".", "setFlag", "(", "Message", ".", "RSVP", ")", ";", "channel", ".", "send", "(", "msg", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "boolean", "exists", "(", "String", "fqn", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", "false", ";", "return", "findNode", "(", "fqn", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "get", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "final", "byte", "[", "]", "buffer", "=", "n", ".", "getData", "(", ")", ";", "if", "(", "buffer", "=", "=", "null", ")", "return", "null", ";", "return", "Arrays", ".", "copyOf", "(", "buffer", ",", "buffer", ".", "length", ")", ";", "}", "</s>"]
["<s>", "public", "String", "print", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "return", "n", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "List", "<", "String", ">", "getChildren", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "final", "Set", "<", "String", ">", "names", "=", "n", ".", "getChildrenNames", "(", ")", ";", "return", "new", "ArrayList", "<", "String", ">", "(", "names", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "root", ".", "print", "(", "sb", ",", "0", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "toString", "(", "String", "fqn", ")", "{", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "=", "=", "null", ")", "return", "null", ";", "final", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "n", ".", "print", "(", "sb", ",", "0", ")", ";", "return", "sb", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "Message", "msg", ")", "{", "if", "(", "msg", "=", "=", "null", "|", "|", "msg", ".", "getLength", "(", ")", "=", "=", "0", ")", "return", ";", "try", "{", "final", "Request", "req", "=", "(", "Request", ")", "msg", ".", "getObject", "(", ")", ";", "final", "String", "fqn", "=", "req", ".", "fqn", ";", "switch", "(", "req", ".", "type", ")", "{", "case", "Request", ".", "CREATE", ":", "_create", "(", "fqn", ",", "req", ".", "ephemeral", "?", "msg", ".", "getSrc", "(", ")", ":", "null", ")", ";", "break", ";", "case", "Request", ".", "SET", ":", "_set", "(", "fqn", ",", "req", ".", "data", ")", ";", "break", ";", "case", "Request", ".", "REMOVE", ":", "_remove", "(", "fqn", ")", ";", "break", ";", "default", ":", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "req", ".", "type", ")", ";", "break", ";", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "finally", "{", "synchronized", "(", "updateCondition", ")", "{", "updateCondition", ".", "notifyAll", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getState", "(", "OutputStream", "ostream", ")", "throws", "Exception", "{", "synchronized", "(", "root", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Util", ".", "objectToStream", "(", "root", ",", "new", "DataOutputStream", "(", "ostream", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setState", "(", "InputStream", "istream", ")", "throws", "Exception", "{", "synchronized", "(", "root", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "Node", "_root", "=", "(", "Node", ")", "Util", ".", "objectFromStream", "(", "new", "DataInputStream", "(", "istream", ")", ")", ";", "merge", "(", "root", ",", "_root", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "viewAccepted", "(", "View", "newView", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "newView", ")", ";", "if", "(", "newView", "instanceof", "MergeView", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "MergeView", "mergeView", "=", "(", "MergeView", ")", "newView", ";", "final", "List", "<", "View", ">", "subgroups", "=", "mergeView", ".", "getSubgroups", "(", ")", ";", "for", "(", "View", "subgroup", ":", "subgroups", ")", "{", "if", "(", "!", "subgroup", ".", "containsMember", "(", "channel", ".", "getAddress", "(", ")", ")", ")", "{", "try", "{", "otherAddress", "=", "subgroup", ".", "getMembers", "(", ")", ".", "get", "(", "0", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "otherAddress", ")", ";", "channel", ".", "getState", "(", "otherAddress", ",", "getStateTimeout", ",", "false", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "finally", "{", "otherAddress", "=", "null", ";", "}", "}", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "List", "<", "Address", ">", "currentMembers", "=", "newView", ".", "getMembers", "(", ")", ";", "final", "Set", "<", "Address", ">", "dead", "=", "new", "HashSet", "<", "Address", ">", "(", "members", ")", ";", "dead", ".", "removeAll", "(", "currentMembers", ")", ";", "members", ".", "clear", "(", ")", ";", "members", ".", "addAll", "(", "currentMembers", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "dead", ")", ";", "removeDeadEphemerals", "(", "root", ",", "dead", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "block", "(", ")", "{", "setRunning", "(", "false", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "unblock", "(", ")", "{", "setRunning", "(", "true", ")", ";", "}", "</s>"]
["<s>", "private", "void", "_create", "(", "String", "fqn", ",", "Address", "ephemeral", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "findNode", "(", "fqn", ",", "true", ",", "ephemeral", ")", ";", "}", "</s>"]
["<s>", "private", "void", "_set", "(", "String", "fqn", ",", "byte", "[", "]", "data", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", ";", "final", "Node", "n", "=", "findNode", "(", "fqn", ")", ";", "if", "(", "n", "!", "=", "null", "&", "&", "(", "(", "n", ".", "getData", "(", ")", "=", "=", "null", "&", "&", "data", "!", "=", "null", ")", "|", "|", "!", "Arrays", ".", "equals", "(", "n", ".", "getData", "(", ")", ",", "data", ")", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "n", ".", "setData", "(", "data", ")", ";", "}", "else", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "}", "</s>"]
["<s>", "private", "void", "_remove", "(", "String", "fqn", ")", "{", "if", "(", "fqn", "=", "=", "null", ")", "return", ";", "if", "(", "fqn", ".", "equals", "(", "SSEPARATOR", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "root", ".", "removeAll", "(", ")", ";", "return", ";", "}", "final", "Node", "parent", "=", "findNode", "(", "parent", "(", "fqn", ")", ")", ";", "if", "(", "parent", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "parent", "(", "fqn", ")", ",", "fqn", ")", ";", "return", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "fqn", ")", ";", "parent", ".", "removeChild", "(", "child", "(", "fqn", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Node", "findNode", "(", "String", "fqn", ",", "boolean", "create", ",", "Address", "ephemeral", ")", "{", "if", "(", "fqn", "=", "=", "null", "|", "|", "fqn", ".", "equals", "(", "SSEPARATOR", ")", "|", "|", "\"", "\"", ".", "equals", "(", "fqn", ")", ")", "return", "root", ";", "final", "Scanner", "scanner", "=", "new", "Scanner", "(", "fqn", ")", ".", "useDelimiter", "(", "SSEPARATOR", ")", ";", "Node", "curr", "=", "root", ";", "while", "(", "scanner", ".", "hasNext", "(", ")", ")", "{", "final", "String", "name", "=", "scanner", ".", "next", "(", ")", ";", "Node", "node", "=", "curr", ".", "getChild", "(", "name", ")", ";", "if", "(", "create", ")", "{", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "curr", ".", "fqn", "+", "(", "!", "curr", ".", "fqn", ".", "equals", "(", "SSEPARATOR", ")", "?", "SEPARATOR", ":", "\"", "\"", ")", "+", "name", ")", ";", "node", "=", "curr", ".", "createChild", "(", "name", ",", "ephemeral", ",", "null", ",", "pendingListeners", ")", ";", "}", "else", "{", "if", "(", "node", ".", "getEphemeralAddress", "(", ")", "!", "=", "null", ")", "{", "if", "(", "ephemeral", "=", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "fqn", ")", ";", "node", ".", "setNotEphemeral", "(", ")", ";", "}", "else", "if", "(", "!", "ephemeral", ".", "equals", "(", "node", ".", "getEphemeralAddress", "(", ")", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "node", ".", "fqn", ",", "node", ".", "getEphemeralAddress", "(", ")", ",", "ephemeral", "}", ")", ";", "node", ".", "setNotEphemeral", "(", ")", ";", "}", "}", "}", "}", "if", "(", "node", "=", "=", "null", ")", "return", "null", ";", "else", "curr", "=", "node", ";", "}", "return", "curr", ";", "}", "</s>"]
["<s>", "private", "Node", "findNode", "(", "String", "fqn", ")", "{", "return", "findNode", "(", "fqn", ",", "false", ",", "null", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removeDeadEphemerals", "(", "Node", "node", ",", "Set", "<", "Address", ">", "dead", ")", "{", "List", "<", "Node", ">", "removedChildren", "=", "new", "ArrayList", "<", "Node", ">", "(", ")", ";", "List", "<", "Node", ">", "nonRemovedChildren", "=", "new", "ArrayList", "<", "Node", ">", "(", ")", ";", "synchronized", "(", "node", ")", "{", "for", "(", "Iterator", "<", "Node", ">", "it", "=", "node", ".", "getChildren", "(", ")", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Node", "child", "=", "it", ".", "next", "(", ")", ";", "if", "(", "child", ".", "getEphemeralAddress", "(", ")", "!", "=", "null", "&", "&", "dead", ".", "contains", "(", "child", ".", "getEphemeralAddress", "(", ")", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "child", ".", "fqn", ",", "child", ".", "getEphemeralAddress", "(", ")", ")", ";", "it", ".", "remove", "(", ")", ";", "removedChildren", ".", "add", "(", "child", ")", ";", "}", "else", "nonRemovedChildren", ".", "add", "(", "child", ")", ";", "}", "}", "for", "(", "Node", "child", ":", "removedChildren", ")", "child", ".", "notifyNodeRemoved", "(", ")", ";", "for", "(", "Node", "child", ":", "nonRemovedChildren", ")", "removeDeadEphemerals", "(", "child", ",", "dead", ")", ";", "}", "</s>"]
["<s>", "private", "void", "merge", "(", "Node", "node", ",", "Node", "other", ")", "{", "assert", "node", ".", "fqn", ".", "equals", "(", "other", ".", "fqn", ")", ";", "if", "(", "(", "node", ".", "data", "=", "=", "null", "&", "&", "other", ".", "getData", "(", ")", "!", "=", "null", ")", "|", "|", "(", "node", ".", "data", "!", "=", "null", "&", "&", "!", "Arrays", ".", "equals", "(", "node", ".", "data", ",", "other", ".", "getData", "(", ")", ")", ")", ")", "{", "byte", "[", "]", "newData", "=", "null", ";", "if", "(", "otherAddress", "=", "=", "null", ")", "newData", "=", "other", ".", "getData", "(", ")", ";", "else", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "fqn", ")", ";", "if", "(", "conflictResolver", "!", "=", "null", ")", "newData", "=", "conflictResolver", ".", "resolve", "(", "node", ".", "fqn", ",", "node", ".", "getData", "(", ")", ",", "other", ".", "getData", "(", ")", ",", "otherAddress", ")", ";", "}", "if", "(", "(", "node", ".", "getData", "(", ")", "=", "=", "null", "&", "&", "newData", "!", "=", "null", ")", "|", "|", "!", "Arrays", ".", "equals", "(", "node", ".", "data", ",", "newData", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "fqn", ")", ";", "node", ".", "setData", "(", "newData", ")", ";", "}", "}", "for", "(", "Node", "otherChild", ":", "other", ".", "getChildren", "(", ")", ".", "values", "(", ")", ")", "{", "Node", "child", "=", "node", ".", "getChild", "(", "otherChild", ".", "name", ")", ";", "if", "(", "child", "=", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "otherChild", ".", "name", ")", ";", "child", "=", "node", ".", "createChild", "(", "otherChild", ".", "name", ",", "otherChild", ".", "getEphemeralAddress", "(", ")", ",", "otherChild", ".", "getData", "(", ")", ",", "pendingListeners", ")", ";", "}", "merge", "(", "child", ",", "otherChild", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "String", "parent", "(", "String", "fqn", ")", "{", "final", "int", "index", "=", "fqn", ".", "lastIndexOf", "(", "SEPARATOR", ")", ";", "if", "(", "index", "<", "0", ")", "return", "null", ";", "return", "fqn", ".", "substring", "(", "0", ",", "index", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "child", "(", "String", "fqn", ")", "{", "final", "int", "index", "=", "fqn", ".", "lastIndexOf", "(", "SEPARATOR", ")", ";", "if", "(", "index", "<", "0", "|", "|", "index", "=", "=", "fqn", ".", "length", "(", ")", "-", "1", ")", "return", "null", ";", "return", "fqn", ".", "substring", "(", "index", "+", "1", ",", "fqn", ".", "length", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setRunning", "(", "boolean", "value", ")", "{", "synchronized", "(", "lock", ")", "{", "running", "=", "value", ";", "if", "(", "running", ")", "lock", ".", "notifyAll", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "awaitRunning", "(", ")", "{", "try", "{", "synchronized", "(", "lock", ")", "{", "while", "(", "!", "running", ")", "lock", ".", "wait", "(", ")", ";", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "Node", "(", "String", "childName", ",", "String", "fqn", ",", "Node", "parent", ",", "Address", "ephemeral", ",", "byte", "[", "]", "data", ")", "{", "this", ".", "name", "=", "childName", ";", "this", ".", "fqn", "=", "fqn", ";", "this", ".", "parent", "=", "parent", ";", "this", ".", "ephemeral", "=", "ephemeral", ";", "this", ".", "data", "=", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ";", "}", "</s>"]
["<s>", "Address", "getEphemeralAddress", "(", ")", "{", "return", "ephemeral", ";", "}", "</s>"]
["<s>", "void", "setNotEphemeral", "(", ")", "{", "ephemeral", "=", "null", ";", "}", "</s>"]
["<s>", "synchronized", "byte", "[", "]", "getData", "(", ")", "{", "return", "data", ";", "}", "</s>"]
["<s>", "final", "void", "setData", "(", "byte", "[", "]", "data", ")", "{", "synchronized", "(", "this", ")", "{", "this", ".", "data", "=", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ";", "}", "notifyNodeModified", "(", ")", ";", "}", "</s>"]
["<s>", "synchronized", "Map", "<", "String", ",", "Node", ">", "getChildren", "(", ")", "{", "return", "children", "!", "=", "null", "?", "children", ":", "(", "Map", "<", "String", ",", "Node", ">", ")", "Collections", ".", "EMPTY_MAP", ";", "}", "</s>"]
["<s>", "synchronized", "Set", "<", "String", ">", "getChildrenNames", "(", ")", "{", "return", "children", "!", "=", "null", "?", "Collections", ".", "unmodifiableSet", "(", "children", ".", "keySet", "(", ")", ")", ":", "(", "Set", "<", "String", ">", ")", "Collections", ".", "EMPTY_SET", ";", "}", "</s>"]
["<s>", "synchronized", "Node", "getChild", "(", "String", "childName", ")", "{", "return", "childName", "=", "=", "null", "?", "null", ":", "children", "=", "=", "null", "?", "null", ":", "children", ".", "get", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "synchronized", "boolean", "hasChild", "(", "String", "childName", ")", "{", "return", "childName", "!", "=", "null", "&", "&", "children", "!", "=", "null", "&", "&", "children", ".", "containsKey", "(", "childName", ")", ";", "}", "</s>"]
["<s>", "private", "Node", "addChild", "(", "Node", "child", ")", "{", "synchronized", "(", "this", ")", "{", "assert", "children", "=", "=", "null", "|", "|", "!", "children", ".", "containsKey", "(", "child", ".", "name", ")", ";", "assert", "fqn", ".", "equals", "(", "parent", "(", "child", ".", "fqn", ")", ")", "|", "|", "(", "fqn", ".", "equals", "(", "\"", "<STR_LIT:/>", "\"", ")", "&", "&", "parent", "(", "child", ".", "fqn", ")", ".", "equals", "(", "\"", "\"", ")", ")", ";", "if", "(", "children", "=", "=", "null", ")", "children", "=", "new", "LinkedHashMap", "<", "String", ",", "Node", ">", "(", ")", ";", "children", ".", "put", "(", "child", ".", "name", ",", "child", ")", ";", "}", "child", ".", "notifyNodeAdded", "(", ")", ";", "return", "child", ";", "}", "</s>"]
["<s>", "Node", "createChild", "(", "String", "childName", ",", "Address", "ephemeral", ",", "byte", "[", "]", "data", ",", "Multimap", "<", "String", ",", "ReplicatedTreeListener", ">", "pendingListeners", ")", "{", "if", "(", "childName", "=", "=", "null", ")", "return", "null", ";", "final", "Node", "child", "=", "new", "Node", "(", "childName", ",", "(", "!", "fqn", ".", "equals", "(", "SSEPARATOR", ")", "?", "fqn", ":", "\"", "\"", ")", "+", "SEPARATOR", "+", "childName", ",", "this", ",", "ephemeral", ",", "data", ")", ";", "for", "(", "ReplicatedTreeListener", "listener", ":", "pendingListeners", ".", "removeAll", "(", "child", ".", "fqn", ")", ")", "child", ".", "addListener", "(", "listener", ")", ";", "addChild", "(", "child", ")", ";", "return", "child", ";", "}", "</s>"]
["<s>", "void", "removeChild", "(", "String", "childName", ")", "{", "Node", "child", "=", "null", ";", "synchronized", "(", "this", ")", "{", "if", "(", "childName", "!", "=", "null", "&", "&", "children", "!", "=", "null", ")", "child", "=", "children", ".", "remove", "(", "childName", ")", ";", "}", "if", "(", "child", "!", "=", "null", ")", "child", ".", "notifyNodeRemoved", "(", ")", ";", "}", "</s>"]
["<s>", "synchronized", "void", "removeAll", "(", ")", "{", "children", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "addListener", "(", "ReplicatedTreeListener", "listener", ")", "{", "synchronized", "(", "this", ")", "{", "if", "(", "listeners", "=", "=", "null", ")", "listeners", "=", "new", "CopyOnWriteArrayList", "<", "ReplicatedTreeListener", ">", "(", ")", ";", "}", "if", "(", "!", "listeners", ".", "contains", "(", "listener", ")", ")", "listeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeListener", "(", "ReplicatedTreeListener", "listener", ")", "{", "synchronized", "(", "this", ")", "{", "if", "(", "listeners", "=", "=", "null", ")", "return", ";", "}", "listeners", ".", "remove", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "void", "notifyNodeAdded", "(", ")", "{", "List", "<", "ReplicatedTreeListener", ">", "_listeners", "=", "listeners", ";", "if", "(", "_listeners", "!", "=", "null", ")", "{", "for", "(", "ReplicatedTreeListener", "listener", ":", "_listeners", ")", "{", "try", "{", "listener", ".", "nodeAdded", "(", "fqn", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "if", "(", "parent", "!", "=", "null", ")", "_listeners", "=", "parent", ".", "listeners", ";", "if", "(", "_listeners", "!", "=", "null", ")", "{", "for", "(", "ReplicatedTreeListener", "listener", ":", "_listeners", ")", "{", "try", "{", "listener", ".", "nodeChildAdded", "(", "parent", ".", "fqn", ",", "name", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "void", "notifyNodeRemoved", "(", ")", "{", "notifyNodeRemoved1", "(", ")", ";", "List", "<", "ReplicatedTreeListener", ">", "_listeners", "=", "null", ";", "if", "(", "parent", "!", "=", "null", ")", "_listeners", "=", "parent", ".", "listeners", ";", "if", "(", "_listeners", "!", "=", "null", ")", "{", "for", "(", "ReplicatedTreeListener", "listener", ":", "_listeners", ")", "{", "try", "{", "listener", ".", "nodeChildRemoved", "(", "parent", ".", "fqn", ",", "name", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "private", "void", "notifyNodeRemoved1", "(", ")", "{", "List", "<", "Node", ">", "_children", "=", "null", ";", "synchronized", "(", "this", ")", "{", "if", "(", "children", "!", "=", "null", ")", "_children", "=", "new", "ArrayList", "<", "Node", ">", "(", "children", ".", "values", "(", ")", ")", ";", "}", "if", "(", "_children", "!", "=", "null", ")", "{", "for", "(", "Node", "child", ":", "_children", ")", "child", ".", "notifyNodeRemoved1", "(", ")", ";", "}", "List", "<", "ReplicatedTreeListener", ">", "_listeners", "=", "listeners", ";", "if", "(", "_listeners", "!", "=", "null", ")", "{", "for", "(", "ReplicatedTreeListener", "listener", ":", "_listeners", ")", "{", "try", "{", "listener", ".", "nodeRemoved", "(", "fqn", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "void", "notifyNodeModified", "(", ")", "{", "List", "<", "ReplicatedTreeListener", ">", "_listeners", "=", "listeners", ";", "if", "(", "_listeners", "!", "=", "null", ")", "{", "for", "(", "ReplicatedTreeListener", "listener", ":", "listeners", ")", "{", "try", "{", "listener", ".", "nodeUpdated", "(", "fqn", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "if", "(", "parent", "!", "=", "null", ")", "_listeners", "=", "parent", ".", "listeners", ";", "if", "(", "_listeners", "!", "=", "null", ")", "{", "for", "(", "ReplicatedTreeListener", "listener", ":", "_listeners", ")", "{", "try", "{", "listener", ".", "nodeChildUpdated", "(", "parent", ".", "fqn", ",", "name", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "synchronized", "StringBuilder", "print", "(", "StringBuilder", "sb", ",", "int", "indent", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "indent", ";", "i", "+", "+", ")", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ";", "sb", ".", "append", "(", "SEPARATOR", ")", ".", "append", "(", "name", ")", ";", "if", "(", "children", "!", "=", "null", ")", "{", "for", "(", "Node", "n", ":", "children", ".", "values", "(", ")", ")", "{", "sb", ".", "append", "(", "<STR_LIT:\\n>", ")", ";", "n", ".", "print", "(", "sb", ",", "indent", "+", "INDENT", ")", ";", "}", "}", "return", "sb", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "name", "+", "\"", "<STR_LIT>", "\"", "+", "fqn", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "data", ")", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "private", "void", "writeObject", "(", "ObjectOutputStream", "s", ")", "throws", "IOException", "{", "try", "{", "s", ".", "defaultWriteObject", "(", ")", ";", "s", ".", "writeBoolean", "(", "ephemeral", "!", "=", "null", ")", ";", "if", "(", "ephemeral", "!", "=", "null", ")", "Util", ".", "writeAddress", "(", "ephemeral", ",", "s", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "IOException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "readObject", "(", "ObjectInputStream", "s", ")", "throws", "IOException", ",", "ClassNotFoundException", "{", "try", "{", "s", ".", "defaultReadObject", "(", ")", ";", "final", "boolean", "hasAddress", "=", "s", ".", "readBoolean", "(", ")", ";", "if", "(", "hasAddress", ")", "ephemeral", "=", "Util", ".", "readAddress", "(", "s", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "IOException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Request", "(", "byte", "type", ",", "String", "fqn", ")", "{", "this", "(", "type", ",", "fqn", ",", "false", ",", "null", ")", ";", "}", "</s>"]
["<s>", "private", "Request", "(", "byte", "type", ",", "String", "fqn", ",", "boolean", "ephemeral", ")", "{", "this", "(", "type", ",", "fqn", ",", "ephemeral", ",", "null", ")", ";", "}", "</s>"]
["<s>", "private", "Request", "(", "byte", "type", ",", "String", "fqn", ",", "byte", "[", "]", "data", ")", "{", "this", "(", "type", ",", "fqn", ",", "false", ",", "data", ")", ";", "}", "</s>"]
["<s>", "private", "Request", "(", "byte", "type", ",", "String", "fqn", ",", "boolean", "ephemeral", ",", "byte", "[", "]", "data", ")", "{", "this", ".", "type", "=", "type", ";", "this", ".", "fqn", "=", "fqn", ";", "this", ".", "data", "=", "data", ";", "this", ".", "ephemeral", "=", "ephemeral", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "(", "type", "=", "=", "CREATE", "?", "\"", "<STR_LIT>", "\"", ":", "type", "=", "=", "SET", "?", "\"", "<STR_LIT>", "\"", ":", "type", "=", "=", "REMOVE", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "fqn", "+", "\"", "<STR_LIT>", "\"", "+", "Arrays", ".", "toString", "(", "data", ")", "+", "<CHAR_LIT:)>", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "JGroupsCluster", "(", "String", "name", ",", "short", "nodeId", ",", "String", "jgroupsClusterName", ")", "throws", "Exception", "{", "super", "(", "name", ",", "nodeId", ")", ";", "this", ".", "jgroupsClusterName", "=", "jgroupsClusterName", ";", "}", "</s>"]
["<s>", "public", "void", "setJgroupsConfFile", "(", "String", "jgroupsConfFile", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "jgroupsConfFile", "=", "jgroupsConfFile", ";", "}", "</s>"]
["<s>", "public", "void", "setJgroupsConf", "(", "Element", "jgroupsConfXML", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "jgroupsConfXML", "=", "jgroupsConfXML", ";", "}", "</s>"]
["<s>", "public", "void", "setJgroupsThreadPool", "(", "ThreadPoolExecutor", "threadPool", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "jgroupsThreadPool", "=", "threadPool", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "if", "(", "jgroupsConfXML", "!", "=", "null", ")", "this", ".", "channel", "=", "new", "JChannel", "(", "jgroupsConfXML", ")", ";", "else", "if", "(", "jgroupsConfFile", "!", "=", "null", ")", "this", ".", "channel", "=", "new", "JChannel", "(", "jgroupsConfFile", ")", ";", "else", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "jgroupsConfXML", "!", "=", "null", "&", "&", "jgroupsConfFile", "!", "=", "null", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "controlChannel", "=", "new", "ControlChannel", "(", "channel", ")", ";", "if", "(", "!", "controlChannel", ".", "hasProtocol", "(", "SEQUENCER", ".", "class", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "addNodeProperty", "(", "JGROUPS_ADDRESS", ",", "true", ",", "true", ",", "JGROUPS_ADDRESS_READER_WRITER", ")", ";", "channel", ".", "addChannelListener", "(", "new", "ChannelListener", "(", ")", "{", "@", "Override", "public", "void", "channelConnected", "(", "org", ".", "jgroups", ".", "Channel", "channel", ")", "{", "}", "@", "Override", "public", "void", "channelDisconnected", "(", "org", ".", "jgroups", ".", "Channel", "channel", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "goOffline", "(", ")", ";", "}", "@", "Override", "public", "void", "channelClosed", "(", "org", ".", "jgroups", ".", "Channel", "channel", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "goOffline", "(", ")", ";", "}", "}", ")", ";", "final", "DistributedTree", "tree", "=", "new", "DistributedTreeAdapter", "(", "new", "ReplicatedTree", "(", "controlChannel", ",", "null", ",", "<NUM_LIT>", ")", ")", ";", "if", "(", "jgroupsThreadPool", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "jgroupsThreadPool", ".", "setRejectedExecutionHandler", "(", "new", "ThreadPoolExecutor", ".", "DiscardPolicy", "(", ")", ")", ";", "jgroupsThreadPool", ".", "setThreadFactory", "(", "new", "CustomThreadFactory", "(", "\"", "<STR_LIT>", "\"", ")", "{", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "}", ")", ";", "ThreadPoolExecutorMonitor", ".", "register", "(", "\"", "<STR_LIT>", "\"", ",", "jgroupsThreadPool", ")", ";", "channel", ".", "getProtocolStack", "(", ")", ".", "getTransport", "(", ")", ".", "setDefaultThreadPool", "(", "jgroupsThreadPool", ")", ";", "channel", ".", "connect", "(", "jgroupsClusterName", ",", "null", ",", "<NUM_LIT>", ")", ";", "setName", "(", "getMyAddress", "(", ")", ".", "toString", "(", ")", ")", ";", "setNodeProperty", "(", "JGROUPS_ADDRESS", ",", "getMyAddress", "(", ")", ")", ";", "initRefIdCounter", "(", ")", ";", "if", "(", "!", "hasServer", "(", ")", ")", "this", ".", "lockService", "=", "new", "LockService", "(", "channel", ")", ";", "this", ".", "dataChannel", "=", "new", "JChannelAdapter", "(", "channel", ")", "{", "@", "Override", "public", "void", "send", "(", "Message", "msg", ")", "throws", "Exception", "{", "msg", ".", "setFlag", "(", "Message", ".", "NO_TOTAL_ORDER", ")", ";", "super", ".", "send", "(", "msg", ")", ";", "}", "}", ";", "setControlTree", "(", "tree", ")", ";", "super", ".", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "org", ".", "jgroups", ".", "Channel", "channel", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelDisconnected", "(", "org", ".", "jgroups", ".", "Channel", "channel", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "goOffline", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelClosed", "(", "org", ".", "jgroups", ".", "Channel", "channel", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ")", ";", "goOffline", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "msg", ")", "throws", "Exception", "{", "msg", ".", "setFlag", "(", "Message", ".", "NO_TOTAL_ORDER", ")", ";", "super", ".", "send", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "private", "void", "initRefIdCounter", "(", ")", "throws", "Exception", "{", "this", ".", "counterService", "=", "new", "CounterService", "(", "channel", ")", ";", "this", ".", "refIdCounter", "=", "counterService", ".", "getOrCreateCounter", "(", "\"", "<STR_LIT>", "\"", ",", "1", ")", ";", "refAllocationExecutor", ".", "submit", "(", "new", "Callable", "<", "Void", ">", "(", ")", "{", "@", "Override", "public", "Void", "call", "(", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "long", "id", ";", "while", "(", "(", "id", "=", "refIdCounter", ".", "get", "(", ")", ")", "<", "INITIAL_REF_ID", ")", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "counterReady", "=", "true", ";", "refAllocatorSupport", ".", "fireCounterReady", "(", ")", ";", "return", "null", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "call", "(", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "long", "id", ";", "while", "(", "(", "id", "=", "refIdCounter", ".", "get", "(", ")", ")", "<", "INITIAL_REF_ID", ")", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "counterReady", "=", "true", ";", "refAllocatorSupport", ".", "fireCounterReady", "(", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "super", ".", "shutdown", "(", ")", ";", "refAllocationExecutor", ".", "shutdownNow", "(", ")", ";", "channel", ".", "disconnect", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "getUnderlyingResource", "(", ")", "{", "return", "channel", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isMe", "(", "NodeInfoImpl", "node", ")", "{", "return", "node", ".", "get", "(", "JGROUPS_ADDRESS", ")", ".", "equals", "(", "getMyAddress", "(", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "final", "Address", "getMyAddress", "(", ")", "{", "return", "channel", ".", "getAddress", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Channel", "getDataChannel", "(", ")", "{", "return", "dataChannel", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "setCounter", "(", "long", "initialValue", ")", "{", "initialValue", "=", "Math", ".", "max", "(", "initialValue", ",", "INITIAL_REF_ID", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "initialValue", ")", ";", "for", "(", ";", ";", ")", "{", "long", "id", "=", "refIdCounter", ".", "get", "(", ")", ";", "if", "(", "id", ">", "=", "initialValue", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "return", "false", ";", "}", "if", "(", "refIdCounter", ".", "compareAndSet", "(", "id", ",", "initialValue", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "initialValue", ")", ";", "return", "true", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", "{", "refAllocatorSupport", ".", "addRefAllocationsListener", "(", "listener", ")", ";", "if", "(", "counterReady", ")", "listener", ".", "counterReady", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", "{", "refAllocatorSupport", ".", "addRefAllocationsListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "allocateRefs", "(", "final", "int", "count", ")", "{", "refAllocationExecutor", ".", "submit", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "long", "end", "=", "refIdCounter", ".", "addAndGet", "(", "count", ")", ";", "refAllocatorSupport", ".", "fireRefsAllocated", "(", "end", "-", "count", ",", "count", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "long", "end", "=", "refIdCounter", ".", "addAndGet", "(", "count", ")", ";", "refAllocatorSupport", ".", "fireRefsAllocated", "(", "end", "-", "count", ",", "count", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "lockRoot", "(", "int", "id", ")", "{", "final", "Lock", "lock", "=", "lockService", ".", "getLock", "(", "Integer", ".", "toHexString", "(", "id", ")", ")", ";", "lock", ".", "lock", "(", ")", ";", "return", "lock", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "unlockRoot", "(", "Object", "obj", ")", "{", "(", "(", "Lock", ")", "obj", ")", ".", "unlock", "(", ")", ";", "}", "</s>"]
["<s>", "void", "send", "(", "Address", "dst", ",", "byte", "[", "]", "buf", ",", "int", "offset", ",", "int", "length", ")", "throws", "Exception", ";", "</s>"]
["<s>", "void", "send", "(", "Address", "dst", ",", "byte", "[", "]", "buf", ")", "throws", "Exception", ";", "</s>"]
["<s>", "void", "send", "(", "Address", "dst", ",", "Object", "obj", ")", "throws", "Exception", ";", "</s>"]
["<s>", "String", "getViewAsString", "(", ")", ";", "</s>"]
["<s>", "String", "getAddressAsUUID", "(", ")", ";", "</s>"]
["<s>", "String", "getAddressAsString", "(", ")", ";", "</s>"]
["<s>", "public", "static", "Channel", "asChannel", "(", "JChannel", "jchannel", ")", "{", "return", "new", "JChannelAdapter", "(", "jchannel", ")", ";", "}", "</s>"]
["<s>", "public", "static", "ChannelExtender", "asExtendedChannel", "(", "JChannel", "jchannel", ")", "{", "return", "new", "ChannelExtender", "(", "new", "JChannelAdapter", "(", "jchannel", ")", ")", ";", "}", "</s>"]
["<s>", "public", "JChannelAdapter", "(", "JChannel", "jchannel", ")", "{", "this", ".", "jchannel", "=", "jchannel", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Address", "dst", ",", "byte", "[", "]", "buf", ",", "int", "offset", ",", "int", "length", ")", "throws", "Exception", "{", "send", "(", "new", "Message", "(", "dst", ",", "null", ",", "buf", ",", "offset", ",", "length", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Address", "dst", ",", "byte", "[", "]", "buf", ")", "throws", "Exception", "{", "send", "(", "new", "Message", "(", "dst", ",", "null", ",", "buf", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Address", "dst", ",", "Object", "obj", ")", "throws", "Exception", "{", "send", "(", "new", "Message", "(", "dst", ",", "null", ",", "obj", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getViewAsString", "(", ")", "{", "final", "View", "v", "=", "getView", "(", ")", ";", "return", "v", "!", "=", "null", "?", "v", ".", "toString", "(", ")", ":", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAddressAsUUID", "(", ")", "{", "return", "getAddress", "(", ")", "instanceof", "UUID", "?", "(", "(", "UUID", ")", "getAddress", "(", ")", ")", ".", "toStringLong", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAddressAsString", "(", ")", "{", "return", "getAddress", "(", ")", "!", "=", "null", "?", "getAddress", "(", ")", ".", "toString", "(", ")", ":", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setDiscardOwnMessages", "(", "boolean", "flag", ")", "{", "jchannel", ".", "setDiscardOwnMessages", "(", "flag", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "getDiscardOwnMessages", "(", ")", "{", "return", "jchannel", ".", "getDiscardOwnMessages", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeChannelListener", "(", "ChannelListener", "listener", ")", "{", "jchannel", ".", "removeChannelListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addChannelListener", "(", "ChannelListener", "listener", ")", "{", "jchannel", ".", "addChannelListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "Receiver", "r", ")", "{", "jchannel", ".", "setReceiver", "(", "r", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Receiver", "getReceiver", "(", ")", "{", "return", "jchannel", ".", "getReceiver", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "msg", ")", "throws", "Exception", "{", "jchannel", ".", "send", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isOpen", "(", ")", "{", "return", "jchannel", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isConnected", "(", ")", "{", "return", "jchannel", ".", "isConnected", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "View", "getView", "(", ")", "{", "return", "jchannel", ".", "getView", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getState", "(", "Address", "target", ",", "long", "timeout", ",", "boolean", "useFlushIfPresent", ")", "throws", "Exception", "{", "jchannel", ".", "getState", "(", "target", ",", "timeout", ",", "useFlushIfPresent", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", "Address", "member", ")", "{", "return", "jchannel", ".", "getName", "(", "member", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "jchannel", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getClusterName", "(", ")", "{", "return", "jchannel", ".", "getClusterName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Address", "getAddress", "(", ")", "{", "return", "jchannel", ".", "getAddress", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", "extends", "Protocol", ">", "boolean", "hasProtocol", "(", "Class", "<", "T", ">", "protocolType", ")", "{", "return", "jchannel", ".", "getProtocolStack", "(", ")", ".", "findProtocol", "(", "protocolType", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Log", "getLog", "(", "Class", "clazz", ")", "{", "return", "new", "SLF4JLog", "(", "LoggerFactory", ".", "getLogger", "(", "clazz", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Log", "getLog", "(", "String", "category", ")", "{", "return", "new", "SLF4JLog", "(", "LoggerFactory", ".", "getLogger", "(", "category", ")", ")", ";", "}", "</s>"]
["<s>", "public", "SLF4JLog", "(", "Logger", "logger", ")", "{", "this", ".", "logger", "=", "logger", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isFatalEnabled", "(", ")", "{", "return", "logger", ".", "isErrorEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isErrorEnabled", "(", ")", "{", "return", "logger", ".", "isErrorEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isWarnEnabled", "(", ")", "{", "return", "logger", ".", "isWarnEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isInfoEnabled", "(", ")", "{", "return", "logger", ".", "isInfoEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDebugEnabled", "(", ")", "{", "return", "logger", ".", "isDebugEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isTraceEnabled", "(", ")", "{", "return", "logger", ".", "isTraceEnabled", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "fatal", "(", "String", "msg", ")", "{", "logger", ".", "error", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "fatal", "(", "String", "msg", ",", "Throwable", "throwable", ")", "{", "logger", ".", "error", "(", "msg", ",", "throwable", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "error", "(", "String", "msg", ")", "{", "logger", ".", "error", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "error", "(", "String", "msg", ",", "Throwable", "throwable", ")", "{", "logger", ".", "error", "(", "msg", ",", "throwable", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "warn", "(", "String", "msg", ")", "{", "logger", ".", "warn", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "warn", "(", "String", "msg", ",", "Throwable", "throwable", ")", "{", "logger", ".", "warn", "(", "msg", ",", "throwable", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "info", "(", "String", "msg", ")", "{", "logger", ".", "info", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "debug", "(", "String", "msg", ")", "{", "logger", ".", "debug", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "debug", "(", "String", "msg", ",", "Throwable", "throwable", ")", "{", "logger", ".", "debug", "(", "msg", ",", "throwable", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "trace", "(", "Object", "msg", ")", "{", "logger", ".", "trace", "(", "msg", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "trace", "(", "String", "msg", ")", "{", "logger", ".", "trace", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "trace", "(", "String", "msg", ",", "Throwable", "throwable", ")", "{", "logger", ".", "trace", "(", "msg", ",", "throwable", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setLevel", "(", "String", "level", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getLevel", "(", ")", "{", "return", "\"", "\"", ";", "}", "</s>"]
["<s>", "public", "DistributedTreeAdapter", "(", "ReplicatedTree", "tree", ")", "{", "this", ".", "tree", "=", "tree", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addListener", "(", "String", "node", ",", "final", "Listener", "listener", ")", "{", "tree", ".", "addListener", "(", "node", ",", "new", "ListenerAdapter", "(", "listener", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeListener", "(", "String", "node", ",", "final", "Listener", "listener", ")", "{", "tree", ".", "removeListener", "(", "node", ",", "new", "ListenerAdapter", "(", "listener", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "create", "(", "String", "node", ",", "boolean", "ephemeral", ")", "{", "tree", ".", "create", "(", "node", ",", "ephemeral", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "createEphemeralOrdered", "(", "String", "node", ")", "{", "tree", ".", "create", "(", "node", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "String", "node", ",", "byte", "[", "]", "data", ")", "{", "tree", ".", "set", "(", "node", ",", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "String", "node", ")", "{", "tree", ".", "remove", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "flush", "(", ")", "{", "tree", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "exists", "(", "String", "node", ")", "{", "return", "tree", ".", "exists", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "get", "(", "String", "node", ")", "{", "return", "tree", ".", "get", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "getChildren", "(", "String", "node", ")", "{", "return", "tree", ".", "getChildren", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "print", "(", "String", "node", ",", "PrintStream", "out", ")", "{", "out", ".", "println", "(", "tree", ".", "toString", "(", "node", ")", ")", ";", "}", "</s>"]
["<s>", "public", "ListenerAdapter", "(", "Listener", "listener", ")", "{", "this", ".", "listener", "=", "listener", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "String", "fqn", ")", "{", "listener", ".", "nodeAdded", "(", "fqn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "String", "fqn", ")", "{", "listener", ".", "nodeDeleted", "(", "fqn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeUpdated", "(", "String", "fqn", ")", "{", "listener", ".", "nodeUpdated", "(", "fqn", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildAdded", "(", "String", "parentFqn", ",", "String", "childName", ")", "{", "listener", ".", "nodeChildAdded", "(", "parentFqn", ",", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildRemoved", "(", "String", "parentFqn", ",", "String", "childName", ")", "{", "listener", ".", "nodeChildDeleted", "(", "parentFqn", ",", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeChildUpdated", "(", "String", "parentFqn", ",", "String", "childName", ")", "{", "listener", ".", "nodeChildUpdated", "(", "parentFqn", ",", "childName", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "equals", "(", "Object", "obj", ")", "{", "if", "(", "obj", "=", "=", "null", ")", "return", "false", ";", "if", "(", "!", "(", "obj", "instanceof", "ListenerAdapter", ")", ")", "return", "false", ";", "return", "this", ".", "listener", "=", "=", "(", "(", "ListenerAdapter", ")", "obj", ")", ".", "listener", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "hashCode", "(", ")", "{", "return", "listener", ".", "hashCode", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ControlChannel", "(", "JChannel", "channel", ")", "{", "super", "(", "channel", ")", ";", "this", ".", "dataDiscardOwnMessages", "=", "channel", ".", "getDiscardOwnMessages", "(", ")", ";", "channel", ".", "setDiscardOwnMessages", "(", "false", ")", ";", "channel", ".", "setUpHandler", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "Receiver", "receiver", ")", "{", "this", ".", "receiver", "=", "receiver", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Receiver", "getReceiver", "(", ")", "{", "return", "receiver", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setDiscardOwnMessages", "(", "boolean", "flag", ")", "{", "this", ".", "discardOwnMessages", "=", "flag", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "getDiscardOwnMessages", "(", ")", "{", "return", "discardOwnMessages", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "msg", ")", "throws", "Exception", "{", "msg", ".", "putHeader", "(", "MAGIC_HEADER", ",", "CONTROL_MARKER", ")", ";", "super", ".", "send", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "up", "(", "Event", "evt", ")", "{", "final", "Receiver", "dataReceiver", "=", "jchannel", ".", "getReceiver", "(", ")", ";", "if", "(", "receiver", "!", "=", "null", ")", "{", "switch", "(", "evt", ".", "getType", "(", ")", ")", "{", "case", "Event", ".", "MSG", ":", "final", "Message", "msg", "=", "(", "Message", ")", "evt", ".", "getArg", "(", ")", ";", "if", "(", "msg", ".", "getHeader", "(", "MAGIC_HEADER", ")", "!", "=", "null", ")", "{", "if", "(", "!", "(", "discardOwnMessages", "&", "&", "getAddress", "(", ")", "!", "=", "null", "&", "&", "msg", ".", "getSrc", "(", ")", "!", "=", "null", "&", "&", "getAddress", "(", ")", ".", "equals", "(", "msg", ".", "getSrc", "(", ")", ")", ")", ")", "receiver", ".", "receive", "(", "msg", ")", ";", "}", "else", "{", "if", "(", "dataReceiver", "!", "=", "null", "&", "&", "!", "(", "dataDiscardOwnMessages", "&", "&", "getAddress", "(", ")", "!", "=", "null", "&", "&", "msg", ".", "getSrc", "(", ")", "!", "=", "null", "&", "&", "getAddress", "(", ")", ".", "equals", "(", "msg", ".", "getSrc", "(", ")", ")", ")", ")", "dataReceiver", ".", "receive", "(", "msg", ")", ";", "}", "break", ";", "case", "Event", ".", "VIEW_CHANGE", ":", "receiver", ".", "viewAccepted", "(", "(", "View", ")", "evt", ".", "getArg", "(", ")", ")", ";", "break", ";", "case", "Event", ".", "SUSPECT", ":", "receiver", ".", "suspect", "(", "(", "Address", ")", "evt", ".", "getArg", "(", ")", ")", ";", "break", ";", "case", "Event", ".", "GET_STATE_OK", ":", "final", "StateTransferResult", "result", "=", "(", "StateTransferResult", ")", "evt", ".", "getArg", "(", ")", ";", "final", "byte", "[", "]", "state", "=", "result", ".", "getBuffer", "(", ")", ";", "if", "(", "state", "!", "=", "null", ")", "{", "final", "ByteArrayInputStream", "input", "=", "new", "ByteArrayInputStream", "(", "state", ")", ";", "try", "{", "receiver", ".", "setState", "(", "input", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "break", ";", "case", "Event", ".", "STATE_TRANSFER_INPUTSTREAM", ":", "final", "InputStream", "is", "=", "(", "InputStream", ")", "evt", ".", "getArg", "(", ")", ";", "if", "(", "is", "!", "=", "null", ")", "{", "try", "{", "receiver", ".", "setState", "(", "is", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "t", ")", ";", "}", "}", "break", ";", "case", "Event", ".", "GET_APPLSTATE", ":", "byte", "[", "]", "tmpState", "=", "null", ";", "if", "(", "receiver", "!", "=", "null", ")", "{", "ByteArrayOutputStream", "output", "=", "new", "ByteArrayOutputStream", "(", "<NUM_LIT>", ")", ";", "try", "{", "receiver", ".", "getState", "(", "output", ")", ";", "tmpState", "=", "output", ".", "toByteArray", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "new", "RuntimeException", "(", "getAddress", "(", ")", "+", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "return", "new", "StateTransferInfo", "(", "null", ",", "0", "L", ",", "tmpState", ")", ";", "case", "Event", ".", "BLOCK", ":", "receiver", ".", "block", "(", ")", ";", "if", "(", "dataReceiver", "!", "=", "null", ")", "dataReceiver", ".", "block", "(", ")", ";", "return", "true", ";", "case", "Event", ".", "UNBLOCK", ":", "receiver", ".", "unblock", "(", ")", ";", "if", "(", "dataReceiver", "!", "=", "null", ")", "dataReceiver", ".", "unblock", "(", ")", ";", "break", ";", "}", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "ControlHeader", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeTo", "(", "DataOutput", "out", ")", "throws", "Exception", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readFrom", "(", "DataInput", "in", ")", "throws", "Exception", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "Address", "read", "(", "byte", "[", "]", "data", ")", "{", "try", "{", "return", "Util", ".", "readAddress", "(", "new", "DataInputStream", "(", "new", "ByteArrayInputStream", "(", "data", ")", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "Address", "value", ")", "{", "try", "{", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "final", "DataOutputStream", "dos", "=", "new", "DataOutputStream", "(", "baos", ")", ";", "Util", ".", "writeAddress", "(", "(", "Address", ")", "value", ",", "dos", ")", ";", "dos", ".", "flush", "(", ")", ";", "return", "baos", ".", "toByteArray", "(", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "JGroupsConstants", "(", ")", "{", "}", "</s>"]
["<s>", "Address", "getAddress", "(", ")", ";", "</s>"]
["<s>", "String", "getClusterName", "(", ")", ";", "</s>"]
["<s>", "String", "getName", "(", "Address", "member", ")", ";", "</s>"]
["<s>", "String", "getName", "(", ")", ";", "</s>"]
["<s>", "void", "getState", "(", "Address", "target", ",", "long", "timeout", ",", "boolean", "useFlushIfPresent", ")", "throws", "Exception", ";", "</s>"]
["<s>", "View", "getView", "(", ")", ";", "</s>"]
["<s>", "boolean", "isConnected", "(", ")", ";", "</s>"]
["<s>", "boolean", "isOpen", "(", ")", ";", "</s>"]
["<s>", "void", "send", "(", "Message", "msg", ")", "throws", "Exception", ";", "</s>"]
["<s>", "void", "setReceiver", "(", "Receiver", "r", ")", ";", "</s>"]
["<s>", "Receiver", "getReceiver", "(", ")", ";", "</s>"]
["<s>", "void", "removeChannelListener", "(", "ChannelListener", "listener", ")", ";", "</s>"]
["<s>", "void", "addChannelListener", "(", "ChannelListener", "listener", ")", ";", "</s>"]
["<s>", "void", "setDiscardOwnMessages", "(", "boolean", "flag", ")", ";", "</s>"]
["<s>", "boolean", "getDiscardOwnMessages", "(", ")", ";", "</s>"]
["<s>", "<", "T", "extends", "Protocol", ">", "boolean", "hasProtocol", "(", "Class", "<", "T", ">", "protocolType", ")", ";", "</s>"]
["<s>", "public", "JGroupsNodeAddressResolver", "(", "Cluster", "cluster", ")", "{", "super", "(", "cluster", ")", ";", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Address", "getAddress", "(", "NodeInfo", "node", ")", "{", "return", "(", "Address", ")", "node", ".", "get", "(", "JGroupsConstants", ".", "JGROUPS_ADDRESS", ")", ";", "}", "</s>"]
["<s>", "public", "ChannelExtender", "(", "Channel", "jchannel", ")", "{", "this", ".", "channel", "=", "jchannel", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Address", "dst", ",", "byte", "[", "]", "buf", ",", "int", "offset", ",", "int", "length", ")", "throws", "Exception", "{", "send", "(", "new", "Message", "(", "dst", ",", "null", ",", "buf", ",", "offset", ",", "length", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Address", "dst", ",", "byte", "[", "]", "buf", ")", "throws", "Exception", "{", "send", "(", "new", "Message", "(", "dst", ",", "null", ",", "buf", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Address", "dst", ",", "Object", "obj", ")", "throws", "Exception", "{", "send", "(", "new", "Message", "(", "dst", ",", "null", ",", "obj", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getViewAsString", "(", ")", "{", "final", "View", "v", "=", "getView", "(", ")", ";", "return", "v", "!", "=", "null", "?", "v", ".", "toString", "(", ")", ":", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAddressAsUUID", "(", ")", "{", "return", "getAddress", "(", ")", "instanceof", "UUID", "?", "(", "(", "UUID", ")", "getAddress", "(", ")", ")", ".", "toStringLong", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAddressAsString", "(", ")", "{", "return", "getAddress", "(", ")", "!", "=", "null", "?", "getAddress", "(", ")", ".", "toString", "(", ")", ":", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setDiscardOwnMessages", "(", "boolean", "flag", ")", "{", "channel", ".", "setDiscardOwnMessages", "(", "flag", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "getDiscardOwnMessages", "(", ")", "{", "return", "channel", ".", "getDiscardOwnMessages", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeChannelListener", "(", "ChannelListener", "listener", ")", "{", "channel", ".", "removeChannelListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addChannelListener", "(", "ChannelListener", "listener", ")", "{", "channel", ".", "addChannelListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "Receiver", "r", ")", "{", "channel", ".", "setReceiver", "(", "r", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Receiver", "getReceiver", "(", ")", "{", "return", "channel", ".", "getReceiver", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "msg", ")", "throws", "Exception", "{", "channel", ".", "send", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isOpen", "(", ")", "{", "return", "channel", ".", "isOpen", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isConnected", "(", ")", "{", "return", "channel", ".", "isConnected", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "View", "getView", "(", ")", "{", "return", "channel", ".", "getView", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "getState", "(", "Address", "target", ",", "long", "timeout", ",", "boolean", "useFlushIfPresent", ")", "throws", "Exception", "{", "channel", ".", "getState", "(", "target", ",", "timeout", ",", "useFlushIfPresent", ")", ";", "}", "</s>"]
["<s>", "public", "void", "getState", "(", "Address", "target", ",", "long", "timeout", ")", "throws", "Exception", "{", "getState", "(", "target", ",", "timeout", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", "Address", "member", ")", "{", "return", "channel", ".", "getName", "(", "member", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getName", "(", ")", "{", "return", "channel", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getClusterName", "(", ")", "{", "return", "channel", ".", "getClusterName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Address", "getAddress", "(", ")", "{", "return", "channel", ".", "getAddress", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "<", "T", "extends", "Protocol", ">", "boolean", "hasProtocol", "(", "Class", "<", "T", ">", "protocolType", ")", "{", "return", "channel", ".", "hasProtocol", "(", "protocolType", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Deque", "<", "Message", ">", "allocateElement", "(", ")", "{", "return", "new", "ConcurrentLinkedDeque", "<", "Message", ">", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "JGroupsComm", "(", "String", "name", ",", "Cluster", "cluster", ",", "Comm", "serverComm", ")", "{", "super", "(", "name", ",", "cluster", ",", "new", "JGroupsNodeAddressResolver", "(", "cluster", ")", ")", ";", "this", ".", "channel", "=", "getCluster", "(", ")", ".", "getDataChannel", "(", ")", ";", "this", ".", "serverComm", "=", "serverComm", ";", "channel", ".", "setReceiver", "(", "new", "ReceiverAdapter", "(", ")", "{", "@", "Override", "public", "void", "receive", "(", "org", ".", "jgroups", ".", "Message", "msg", ")", "{", "JGroupsComm", ".", "this", ".", "receive", "(", "msg", ")", ";", "}", "}", ")", ";", "this", ".", "sendToServerInsteadOfMulticast", "=", "(", "serverComm", "!", "=", "null", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "receive", "(", "org", ".", "jgroups", ".", "Message", "msg", ")", "{", "JGroupsComm", ".", "this", ".", "receive", "(", "msg", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "super", ".", "setReceiver", "(", "receiver", ")", ";", "if", "(", "serverComm", "!", "=", "null", ")", "serverComm", ".", "setReceiver", "(", "receiver", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "if", "(", "sendToServerInsteadOfMulticast", "&", "&", "serverComm", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postInit", "(", ")", "throws", "Exception", "{", "if", "(", "!", "sendToServerInsteadOfMulticast", ")", "this", ".", "pendingBroadcasts", "=", "new", "ConcurrentHashMap", "<", "Long", ",", "BroadcastEntry", ">", "(", ")", ";", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "final", "long", "timeoutNano", "=", "TimeUnit", ".", "NANOSECONDS", ".", "convert", "(", "getTimeout", "(", ")", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "getScheduler", "(", ")", ".", "scheduleAtFixedRate", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "if", "(", "pendingBroadcasts", "!", "=", "null", ")", "{", "for", "(", "BroadcastEntry", "entry", ":", "pendingBroadcasts", ".", "values", "(", ")", ")", "{", "final", "Message", "message", "=", "entry", ".", "message", ";", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "INVACK", "&", "&", "now", "-", "message", ".", "getTimestamp", "(", ")", ">", "timeoutNano", ")", "{", "if", "(", "pendingBroadcasts", ".", "remove", "(", "message", ".", "getMessageId", "(", ")", ")", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "Message", ".", "TIMEOUT", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "}", "}", "}", "for", "(", "Deque", "<", "Message", ">", "pending", ":", "pendingReply", ".", "values", "(", ")", ")", "{", "for", "(", "Message", "message", ":", "reverse", "(", "pending", ")", ")", "{", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "INVACK", "&", "&", "now", "-", "message", ".", "getTimestamp", "(", ")", ">", "timeoutNano", ")", "{", "if", "(", "pending", ".", "removeLastOccurrence", "(", "message", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "Message", ".", "TIMEOUT", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "}", "else", "break", ";", "}", "}", "if", "(", "hasPendingBroadcasts", "(", ")", ")", "{", "try", "{", "channel", ".", "send", "(", "new", "org", ".", "jgroups", ".", "Message", "(", "null", ",", "new", "byte", "[", "0", "]", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "}", "}", ",", "0", ",", "getTimeout", "(", ")", "/", "<NUM_LIT:2>", ",", "TimeUnit", ".", "MILLISECONDS", ")", ";", "setReady", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "if", "(", "pendingBroadcasts", "!", "=", "null", ")", "{", "for", "(", "BroadcastEntry", "entry", ":", "pendingBroadcasts", ".", "values", "(", ")", ")", "{", "final", "Message", "message", "=", "entry", ".", "message", ";", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "INVACK", "&", "&", "now", "-", "message", ".", "getTimestamp", "(", ")", ">", "timeoutNano", ")", "{", "if", "(", "pendingBroadcasts", ".", "remove", "(", "message", ".", "getMessageId", "(", ")", ")", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "Message", ".", "TIMEOUT", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "}", "}", "}", "for", "(", "Deque", "<", "Message", ">", "pending", ":", "pendingReply", ".", "values", "(", ")", ")", "{", "for", "(", "Message", "message", ":", "reverse", "(", "pending", ")", ")", "{", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "INVACK", "&", "&", "now", "-", "message", ".", "getTimestamp", "(", ")", ">", "timeoutNano", ")", "{", "if", "(", "pending", ".", "removeLastOccurrence", "(", "message", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "Message", ".", "TIMEOUT", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "}", "else", "break", ";", "}", "}", "if", "(", "hasPendingBroadcasts", "(", ")", ")", "{", "try", "{", "channel", ".", "send", "(", "new", "org", ".", "jgroups", ".", "Message", "(", "null", ",", "new", "byte", "[", "0", "]", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "JGroupsCluster", "getCluster", "(", ")", "{", "return", "(", "JGroupsCluster", ")", "super", ".", "getCluster", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "hasPendingBroadcasts", "(", ")", "{", "return", "!", "pendingBroadcasts", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "addToPending", "(", "Message", "message", ",", "short", "node", ")", "{", "if", "(", "!", "message", ".", "getType", "(", ")", ".", "isOf", "(", "Message", ".", "Type", ".", "REQUIRES_RESPONSE", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "true", ";", "}", "if", "(", "node", ">", "=", "0", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "pendingReply", ".", "getOrAllocate", "(", "node", ")", ".", "addFirst", "(", "message", ")", ";", "}", "else", "{", "assert", "message", ".", "isBroadcast", "(", ")", ";", "assert", "message", "instanceof", "LineMessage", ";", "final", "Set", "<", "Short", ">", "nodes", "=", "getCluster", "(", ")", ".", "getNodes", "(", ")", ";", "if", "(", "message", "instanceof", "LineMessage", ")", "{", "if", "(", "nodes", ".", "isEmpty", "(", ")", "|", "|", "(", "nodes", ".", "size", "(", ")", "=", "=", "1", "&", "&", "nodes", ".", "contains", "(", "Comm", ".", "SERVER", ")", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "Message", ".", "NOT_FOUND", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "return", "false", ";", "}", "else", "{", "pendingBroadcasts", ".", "put", "(", "message", ".", "getMessageId", "(", ")", ",", "new", "BroadcastEntry", "(", "(", "LineMessage", ")", "message", ",", "nodes", ")", ")", ";", "return", "true", ";", "}", "}", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "sendToNode", "(", "Message", "message", ",", "short", "node", ",", "Address", "address", ")", "{", "assignMessageId", "(", "message", ")", ";", "addToPending", "(", "message", ",", "node", ")", ";", "try", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "node", ",", "address", ",", "message", "}", ")", ";", "channel", ".", "send", "(", "new", "org", ".", "jgroups", ".", "Message", "(", "address", ",", "message", ".", "toByteArray", "(", ")", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "message", "+", "\"", "<STR_LIT>", "\"", "+", "node", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "sendToServer", "(", "Message", "message", ")", "{", "super", ".", "sendToServer", "(", "message", ")", ";", "try", "{", "serverComm", ".", "send", "(", "message", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "broadcast", "(", "Message", "message", ")", "{", "assignMessageId", "(", "message", ")", ";", "if", "(", "addToPending", "(", "message", ",", "(", "short", ")", "-", "1", ")", ")", "broadcast", "(", "message", ")", ";", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "channel", ".", "send", "(", "new", "org", ".", "jgroups", ".", "Message", "(", "null", ",", "message", ".", "toByteArray", "(", ")", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "message", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "receive", "(", "org", ".", "jgroups", ".", "Message", "msg", ")", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "msg", ")", ";", "if", "(", "getCluster", "(", ")", ".", "getMyAddress", "(", ")", "!", "=", "null", "&", "&", "msg", ".", "getSrc", "(", ")", "!", "=", "null", "&", "&", "getCluster", "(", ")", ".", "getMyAddress", "(", ")", ".", "equals", "(", "msg", ".", "getSrc", "(", ")", ")", ")", "return", ";", "final", "byte", "[", "]", "buffer", "=", "msg", ".", "getRawBuffer", "(", ")", ";", "if", "(", "buffer", ".", "length", "=", "=", "0", ")", "return", ";", "final", "Message", "message", "=", "Message", ".", "fromByteArray", "(", "buffer", ")", ";", "final", "Address", "source", "=", "msg", ".", "getSrc", "(", ")", ";", "if", "(", "message", ".", "isResponse", "(", ")", ")", "{", "final", "Deque", "<", "Message", ">", "pending", "=", "pendingReply", ".", "get", "(", "message", ".", "getNode", "(", ")", ")", ";", "if", "(", "pending", "!", "=", "null", ")", "{", "boolean", "res", "=", "pending", ".", "removeLastOccurrence", "(", "message", ")", ";", "if", "(", "res", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "}", "if", "(", "message", ".", "isResponse", "(", ")", ")", "{", "final", "BroadcastEntry", "entry", "=", "pendingBroadcasts", ".", "get", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "if", "(", "entry", "!", "=", "null", ")", "{", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "ACK", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "pendingBroadcasts", ".", "remove", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "}", "else", "removeFromPendingBroadcasts", "(", "message", ".", "getMessageId", "(", ")", ",", "message", ".", "getNode", "(", ")", ")", ";", "}", "}", "final", "short", "sourceNode", "=", "getNode", "(", "source", ")", ";", "if", "(", "sourceNode", "<", "0", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "source", ")", ";", "message", ".", "setNode", "(", "sourceNode", ")", ";", "receive", "(", "message", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "super", ".", "nodeAdded", "(", "id", ")", ";", "try", "{", "for", "(", "Message", "message", ":", "reverse", "(", "pendingReply", ".", "get", "(", "id", ")", ")", ")", "sendToNode", "(", "message", ",", "id", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "AssertionError", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "super", ".", "nodeSwitched", "(", "id", ")", ";", "try", "{", "for", "(", "Message", "message", ":", "reverse", "(", "pendingReply", ".", "get", "(", "id", ")", ")", ")", "sendToNode", "(", "message", ",", "id", ")", ";", "for", "(", "BroadcastEntry", "entry", ":", "pendingBroadcasts", ".", "values", "(", ")", ")", "sendToNode", "(", "entry", ".", "message", ",", "id", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "AssertionError", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "super", ".", "nodeRemoved", "(", "id", ")", ";", "pendingReply", ".", "remove", "(", "id", ")", ";", "for", "(", "Long", "messageId", ":", "pendingBroadcasts", ".", "keySet", "(", ")", ")", "removeFromPendingBroadcasts", "(", "messageId", ",", "id", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removeFromPendingBroadcasts", "(", "long", "messageId", ",", "short", "node", ")", "{", "final", "BroadcastEntry", "entry", "=", "pendingBroadcasts", ".", "get", "(", "messageId", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "entry", ".", "message", ")", ";", "if", "(", "entry", ".", "removeNode", "(", "node", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "entry", ".", "message", ")", ";", "receive", "(", "Message", ".", "NOT_FOUND", "(", "entry", ".", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "pendingBroadcasts", ".", "remove", "(", "messageId", ")", ";", "}", "}", "</s>"]
["<s>", "public", "BroadcastEntry", "(", "LineMessage", "message", ",", "Set", "<", "Short", ">", "nodes", ")", "{", "this", ".", "message", "=", "message", ";", "this", ".", "nodes", "=", "new", "TShortHashSet", "(", "nodes", ")", ";", "this", ".", "nodes", ".", "remove", "(", "Comm", ".", "SERVER", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "this", ".", "nodes", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "addNode", "(", "short", "node", ")", "{", "nodes", ".", "add", "(", "node", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "removeNode", "(", "short", "node", ")", "{", "nodes", ".", "remove", "(", "node", ")", ";", "return", "nodes", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "abstract", "void", "invalidated", "(", "long", "id", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "abstract", "void", "evicted", "(", "long", "id", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "abstract", "void", "received", "(", "long", "id", ",", "long", "version", ",", "ByteBuffer", "data", ")", ";", "</s>"]
["<s>", "public", "abstract", "T", "get", "(", "Store", "store", ")", ";", "</s>"]
["<s>", "public", "SerializingDistributedObject", "(", ")", "{", "}", "</s>"]
["<s>", "private", "byte", "[", "]", "serialize", "(", "Object", "obj", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "private", "T", "deserialize", "(", "byte", "[", "]", "buffer", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "invalidated", "(", "long", "id", ")", "{", "ref", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "evicted", "(", "long", "id", ")", "{", "ref", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "received", "(", "long", "id", ",", "long", "version", ",", "ByteBuffer", "data", ")", "{", "}", "</s>"]
["<s>", "public", "T", "get", "(", "Store", "store", ")", "{", "if", "(", "ref", "=", "=", "null", ")", "{", "for", "(", ";", ";", ")", "{", "try", "{", "byte", "[", "]", "data", "=", "store", ".", "get", "(", "id", ")", ";", "ref", "=", "deserialize", "(", "data", ")", ";", "break", ";", "}", "catch", "(", "TimeoutException", "e", ")", "{", "}", "}", "}", "return", "ref", ";", "}", "</s>"]
["<s>", "public", "MainMemoryEntry", "(", "long", "version", ",", "byte", "[", "]", "data", ")", "{", "this", ".", "version", "=", "version", ";", "this", ".", "data", "=", "data", ";", "}", "</s>"]
["<s>", "public", "MainMemoryEntry", "(", "byte", "[", "]", "buffer", ")", "{", "this", ".", "version", "=", "Longs", ".", "fromByteArray", "(", "buffer", ")", ";", "this", ".", "data", "=", "new", "byte", "[", "buffer", ".", "length", "-", "(", "Longs", ".", "BYTES", ")", "]", ";", "System", ".", "arraycopy", "(", "buffer", ",", "Longs", ".", "BYTES", ",", "data", ",", "0", ",", "data", ".", "length", ")", ";", "}", "</s>"]
["<s>", "public", "byte", "[", "]", "toByteArray", "(", ")", "{", "final", "byte", "[", "]", "buffer", "=", "new", "byte", "[", "Longs", ".", "BYTES", "+", "(", "data", "!", "=", "null", "?", "data", ".", "length", ":", "0", ")", "]", ";", "BerkeleyDB", ".", "toByteArray", "(", "version", ",", "buffer", ")", ";", "if", "(", "data", "!", "=", "null", ")", "System", ".", "arraycopy", "(", "data", ",", "0", ",", "buffer", ",", "Longs", ".", "BYTES", ",", "data", ".", "length", ")", ";", "return", "buffer", ";", "}", "</s>"]
["<s>", "short", "casOwner", "(", "long", "id", ",", "short", "oldNode", ",", "short", "newNode", ")", ";", "</s>"]
["<s>", "void", "removeOwner", "(", "short", "node", ")", ";", "</s>"]
["<s>", "Object", "beginTransaction", "(", ")", ";", "</s>"]
["<s>", "void", "commit", "(", "Object", "txn", ")", ";", "</s>"]
["<s>", "void", "abort", "(", "Object", "txn", ")", ";", "</s>"]
["<s>", "void", "write", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "byte", "[", "]", "data", ",", "Object", "txn", ")", ";", "</s>"]
["<s>", "MainMemoryEntry", "read", "(", "long", "id", ")", ";", "</s>"]
["<s>", "void", "delete", "(", "long", "id", ",", "Object", "txn", ")", ";", "</s>"]
["<s>", "long", "getMaxId", "(", ")", ";", "</s>"]
["<s>", "void", "close", "(", ")", ";", "</s>"]
["<s>", "void", "dump", "(", "java", ".", "io", ".", "PrintStream", "ps", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "receiver1", "=", "receiver", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "message", ")", "{", "final", "Message", "m", "=", "message", ".", "clone", "(", ")", ";", "m", ".", "setNode", "(", "node1", ")", ";", "m", ".", "setIncoming", "(", ")", ";", "queue", ".", "execute", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT:\\\">", "<STR_LIT:{}>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ",", "node2", ",", "m", ")", ";", "receiver2", ".", "receive", "(", "m", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT:\\\">", "<STR_LIT:{}>", "<STR_LIT:\\\">", "<STR_LIT>", "\"", ",", "node2", ",", "m", ")", ";", "receiver2", ".", "receive", "(", "m", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "receiver2", "=", "receiver", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "message", ")", "{", "final", "Message", "m", "=", "message", ".", "clone", "(", ")", ";", "m", ".", "setNode", "(", "node2", ")", ";", "m", ".", "setIncoming", "(", ")", ";", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "m", ")", ";", "receiver1", ".", "receive", "(", "m", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "Comm", "getComm1", "(", "short", "node1", ")", "{", "this", ".", "node1", "=", "node1", ";", "return", "comm1", ";", "}", "</s>"]
["<s>", "public", "synchronized", "Comm", "getComm2", "(", "short", "node2", ")", "{", "this", ".", "node2", "=", "node2", ";", "return", "comm2", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "TcpServerServerComm", "(", "String", "name", ",", "Cluster", "cluster", ",", "int", "port", ")", "throws", "Exception", "{", "this", "(", "name", ",", "cluster", ",", "port", ",", "null", ")", ";", "}", "</s>"]
["<s>", "TcpServerServerComm", "(", "String", "name", ",", "final", "Cluster", "cluster", ",", "int", "port", ",", "final", "ChannelHandler", "testHandler", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ",", "new", "ChannelGroup", "(", ")", ",", "port", ",", "testHandler", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_ADDRESS", ",", "true", ",", "true", ",", "INET_ADDRESS_READER_WRITER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_ADDRESS", ",", "InetAddress", ".", "getLocalHost", "(", ")", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_SERVER_PORT", ",", "false", ",", "true", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_SERVER_PORT", ",", "port", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "new", "NodeChangeListener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "}", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "final", "Channel", "channel", "=", "getChannels", "(", ")", ".", "get", "(", "id", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "channel", ".", "close", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "final", "Channel", "channel", "=", "getChannels", "(", ")", ".", "get", "(", "id", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "channel", ".", "close", "(", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "final", "Channel", "channel", "=", "getChannels", "(", ")", ".", "get", "(", "id", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "channel", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "final", "Channel", "channel", "=", "getChannels", "(", ")", ".", "get", "(", "id", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "channel", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "start", "(", "boolean", "master", ")", "{", "bind", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "ChannelGroup", "getChannels", "(", ")", "{", "return", "(", "ChannelGroup", ")", "super", ".", "getChannels", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiver", "=", "receiver", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "send", "(", "Message", "message", ")", "{", "if", "(", "!", "message", ".", "isResponse", "(", ")", ")", "message", ".", "setMessageId", "(", "nextMessageId", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "final", "Channel", "ch", "=", "getChannels", "(", ")", ".", "get", "(", "message", ".", "getNode", "(", ")", ")", ";", "if", "(", "ch", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ".", "getNode", "(", ")", ")", ";", "return", ";", "}", "ch", ".", "write", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "receive", "(", "ChannelHandlerContext", "ctx", ",", "Message", "message", ")", "{", "receiver", ".", "receive", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "ChannelGroup", "(", "String", "name", ")", "{", "super", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "ChannelGroup", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "add", "(", "Channel", "channel", ")", "{", "if", "(", "channel", "instanceof", "ServerChannel", ")", "return", "super", ".", "add", "(", "channel", ")", ";", "else", "{", "final", "NodeInfo", "node", "=", "ChannelNodeInfo", ".", "nodeInfo", ".", "get", "(", "channel", ")", ";", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ".", "getRemoteAddress", "(", ")", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "channel", ".", "getRemoteAddress", "(", ")", ")", ";", "}", "final", "short", "nodeId", "=", "node", ".", "getNodeId", "(", ")", ";", "if", "(", "channels", ".", "containsKey", "(", "nodeId", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ".", "getRemoteAddress", "(", ")", ",", "nodeId", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "nodeId", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "boolean", "added", "=", "super", ".", "add", "(", "channel", ")", ";", "if", "(", "added", ")", "channels", ".", "put", "(", "nodeId", ",", "channel", ")", ";", "return", "added", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "remove", "(", "Object", "o", ")", "{", "final", "Channel", "channel", "=", "(", "Channel", ")", "o", ";", "final", "boolean", "removed", "=", "super", ".", "remove", "(", "o", ")", ";", "if", "(", "removed", ")", "channels", ".", "inverse", "(", ")", ".", "remove", "(", "channel", ")", ";", "ChannelNodeInfo", ".", "nodeInfo", ".", "remove", "(", "channel", ")", ";", "return", "removed", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "super", ".", "clear", "(", ")", ";", "channels", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "contains", "(", "Object", "o", ")", "{", "if", "(", "o", "instanceof", "Short", ")", "return", "channels", ".", "containsKey", "(", "(", "Short", ")", "o", ")", ";", "else", "return", "super", ".", "contains", "(", "o", ")", ";", "}", "</s>"]
["<s>", "public", "Channel", "get", "(", "short", "node", ")", "{", "return", "channels", ".", "get", "(", "node", ")", ";", "}", "</s>"]
["<s>", "public", "ChannelNodeNameReader", "(", "Cluster", "cluster", ")", "{", "this", ".", "cluster", "=", "cluster", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "throws", "Exception", "{", "final", "ChannelBuffer", "message", "=", "(", "ChannelBuffer", ")", "e", ".", "getMessage", "(", ")", ";", "final", "int", "size", "=", "message", ".", "readableBytes", "(", ")", ";", "final", "byte", "[", "]", "array", "=", "new", "byte", "[", "size", "]", ";", "message", ".", "readBytes", "(", "array", ")", ";", "this", ".", "nodeName", "=", "new", "String", "(", "array", ",", "Charsets", ".", "UTF_8", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "ctx", ".", "getChannel", "(", ")", ",", "nodeName", ")", ";", "this", ".", "node", "=", "cluster", ".", "getNodeInfoByName", "(", "nodeName", ")", ";", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ctx", ".", "getChannel", "(", ")", ",", "nodeName", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "final", "SocketAddress", "address", "=", "ctx", ".", "getChannel", "(", ")", ".", "getRemoteAddress", "(", ")", ";", "final", "InetAddress", "host", "=", "(", "(", "InetSocketAddress", ")", "address", ")", ".", "getAddress", "(", ")", ";", "if", "(", "!", "host", ".", "equals", "(", "(", "InetAddress", ")", "node", ".", "get", "(", "IpConstants", ".", "IP_ADDRESS", ")", ")", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "address", ",", "node", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "ctx", ".", "getChannel", "(", ")", ",", "node", ")", ";", "ChannelNodeInfo", ".", "nodeInfo", ".", "set", "(", "ctx", ".", "getChannel", "(", ")", ",", "node", ")", ";", "assert", "connectEvent", "!", "=", "null", ";", "ctx", ".", "sendUpstream", "(", "connectEvent", ")", ";", "ctx", ".", "getPipeline", "(", ")", ".", "remove", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "this", ".", "connectEvent", "=", "e", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelClosed", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "node", "=", "null", ";", "super", ".", "channelClosed", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "node", "=", "null", ";", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "throws", "Exception", "{", "node", "=", "null", ";", "super", ".", "exceptionCaught", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "TcpSlaveServerComm", "(", "String", "name", ",", "Cluster", "cluster", ",", "int", "port", ")", "throws", "Exception", "{", "this", "(", "name", ",", "cluster", ",", "port", ",", "null", ")", ";", "}", "</s>"]
["<s>", "TcpSlaveServerComm", "(", "String", "name", ",", "final", "Cluster", "cluster", ",", "int", "port", ",", "final", "ChannelHandler", "testHandler", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ",", "new", "ChannelGroup", "(", ")", ",", "port", ",", "testHandler", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_ADDRESS", ",", "true", ",", "true", ",", "INET_ADDRESS_READER_WRITER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_ADDRESS", ",", "InetAddress", ".", "getLocalHost", "(", ")", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_SLAVE_PORT", ",", "true", ",", "false", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_SLAVE_PORT", ",", "port", ")", ";", "cluster", ".", "addSlaveConfigurationListener", "(", "new", "SlaveConfigurationListener", "(", ")", "{", "@", "Override", "public", "void", "newMaster", "(", "NodeInfo", "node", ")", "{", "}", "@", "Override", "public", "void", "slaveAdded", "(", "NodeInfo", "node", ")", "{", "}", "@", "Override", "public", "void", "slaveRemoved", "(", "NodeInfo", "node", ")", "{", "final", "Channel", "channel", "=", "getChannels", "(", ")", ".", "get", "(", "node", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "channel", ".", "close", "(", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "newMaster", "(", "NodeInfo", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slaveAdded", "(", "NodeInfo", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slaveRemoved", "(", "NodeInfo", "node", ")", "{", "final", "Channel", "channel", "=", "getChannels", "(", ")", ".", "get", "(", "node", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "channel", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setBackup", "(", "Backup", "backup", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "backup", "=", "backup", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "available", "(", "boolean", "value", ")", "{", "super", ".", "available", "(", "value", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "if", "(", "master", ")", "{", "bind", "(", ")", ";", "startReplicationThread", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "super", ".", "switchToMaster", "(", ")", ";", "bind", "(", ")", ";", "startReplicationThread", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "replThread", ".", "interrupt", "(", ")", ";", "super", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "SimpleChannelUpstreamHandler", "(", ")", "{", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "getChannels", "(", ")", ".", "size", "(", ")", ">", "<NUM_LIT:2>", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "new", "ArrayList", "<", "Channel", ">", "(", "getChannels", "(", ")", ")", ")", ";", "}", "final", "InetAddress", "remoteAddress", "=", "(", "(", "InetSocketAddress", ")", "ctx", ".", "getChannel", "(", ")", ".", "getRemoteAddress", "(", ")", ")", ".", "getAddress", "(", ")", ";", "if", "(", "getCluster", "(", ")", ".", "getNodesByProperty", "(", "IP_ADDRESS", ",", "remoteAddress", ")", ".", "isEmpty", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "remoteAddress", ")", ";", "ctx", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "return", ";", "}", "replIters", ".", "put", "(", "ctx", ".", "getChannel", "(", ")", ",", "backup", ".", "iterOwned", "(", ")", ")", ";", "synchronized", "(", "replIters", ")", "{", "replIters", ".", "notify", "(", ")", ";", "}", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "}", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "ack", "(", "ctx", ",", "null", ")", ";", "replIters", ".", "remove", "(", "ctx", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "}", "}", ")", ";", "return", "pipeline", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "getChannels", "(", ")", ".", "size", "(", ")", ">", "<NUM_LIT:2>", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "new", "ArrayList", "<", "Channel", ">", "(", "getChannels", "(", ")", ")", ")", ";", "}", "final", "InetAddress", "remoteAddress", "=", "(", "(", "InetSocketAddress", ")", "ctx", ".", "getChannel", "(", ")", ".", "getRemoteAddress", "(", ")", ")", ".", "getAddress", "(", ")", ";", "if", "(", "getCluster", "(", ")", ".", "getNodesByProperty", "(", "IP_ADDRESS", ",", "remoteAddress", ")", ".", "isEmpty", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "remoteAddress", ")", ";", "ctx", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "return", ";", "}", "replIters", ".", "put", "(", "ctx", ".", "getChannel", "(", ")", ",", "backup", ".", "iterOwned", "(", ")", ")", ";", "synchronized", "(", "replIters", ")", "{", "replIters", ".", "notify", "(", ")", ";", "}", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "ack", "(", "ctx", ",", "null", ")", ";", "replIters", ".", "remove", "(", "ctx", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "receive", "(", "ChannelHandlerContext", "ctx", ",", "Message", "message", ")", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "BACKUP_PACKETACK", ":", "ack", "(", "ctx", ",", "(", "BACKUP_PACKETACK", ")", "message", ")", ";", "break", ";", "case", "INVACK", ":", "invack", "(", "ctx", ",", "(", "LineMessage", ")", "message", ")", ";", "break", ";", "default", ":", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "ack", "(", "ChannelHandlerContext", "ctx", ",", "BACKUP_PACKETACK", "ack", ")", "{", "synchronized", "(", "this", ")", "{", "if", "(", "ack", "!", "=", "null", "&", "&", "ack", ".", "getId", "(", ")", "!", "=", "lastId", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "ack", ".", "getId", "(", ")", ",", "lastId", ")", ";", "return", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "ctx", ".", "getChannel", "(", ")", ")", ";", "sentSlave", "=", "false", ";", "}", "backup", ".", "slavesAck", "(", "lastId", ")", ";", "}", "</s>"]
["<s>", "private", "void", "invack", "(", "ChannelHandlerContext", "ctx", ",", "LineMessage", "invack", ")", "{", "backup", ".", "slavesInvAck", "(", "invack", ".", "getLine", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "NodeInfo", "getNodeInfo", "(", "Channel", "channel", ")", "{", "return", "ChannelNodeInfo", ".", "nodeInfo", ".", "get", "(", "channel", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "boolean", "send", "(", "Message", "message", ")", "{", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "BACKUP_PACKET", "&", "&", "sentSlave", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "!", "message", ".", "isResponse", "(", ")", ")", "message", ".", "setMessageId", "(", "nextMessageId", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "final", "Set", "<", "Channel", ">", "slaves", "=", "new", "HashSet", "<", "Channel", ">", "(", ")", ";", "final", "ChannelGroupFuture", "fs", "=", "getChannels", "(", ")", ".", "write", "(", "message", ")", ";", "for", "(", "ChannelFuture", "f", ":", "fs", ")", "slaves", ".", "add", "(", "f", ".", "getChannel", "(", ")", ")", ";", "if", "(", "slaves", ".", "isEmpty", "(", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "false", ";", "}", "else", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "slaves", ")", ";", "if", "(", "slaves", ".", "size", "(", ")", ">", "1", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "slaves", ")", ";", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "INV", ":", "return", "true", ";", "case", "BACKUP_PACKET", ":", "lastId", "=", "(", "(", "BACKUP_PACKET", ")", "message", ")", ".", "getId", "(", ")", ";", "sentSlave", "=", "true", ";", "return", "true", ";", "default", ":", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "false", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "ChannelGroup", "getChannels", "(", ")", "{", "return", "(", "ChannelGroup", ")", "super", ".", "getChannels", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ChannelGroup", "(", "String", "name", ")", "{", "super", "(", "name", ")", ";", "}", "</s>"]
["<s>", "public", "ChannelGroup", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "add", "(", "Channel", "channel", ")", "{", "if", "(", "channel", "instanceof", "ServerChannel", ")", "return", "super", ".", "add", "(", "channel", ")", ";", "else", "{", "final", "NodeInfo", "node", "=", "getNodeInfo", "(", "channel", ")", ";", "if", "(", "node", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ".", "getRemoteAddress", "(", ")", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "channel", ".", "getRemoteAddress", "(", ")", ")", ";", "}", "final", "boolean", "added", "=", "super", ".", "add", "(", "channel", ")", ";", "if", "(", "added", ")", "channels", ".", "put", "(", "node", ",", "channel", ")", ";", "return", "added", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "remove", "(", "Object", "o", ")", "{", "final", "Channel", "channel", "=", "(", "Channel", ")", "o", ";", "final", "boolean", "removed", "=", "super", ".", "remove", "(", "o", ")", ";", "if", "(", "removed", ")", "channels", ".", "inverse", "(", ")", ".", "remove", "(", "channel", ")", ";", "ChannelNodeInfo", ".", "nodeInfo", ".", "remove", "(", "channel", ")", ";", "return", "removed", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "super", ".", "clear", "(", ")", ";", "channels", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "contains", "(", "Object", "o", ")", "{", "if", "(", "o", "instanceof", "NodeInfo", ")", "return", "channels", ".", "containsKey", "(", "(", "NodeInfo", ")", "o", ")", ";", "else", "return", "super", ".", "contains", "(", "o", ")", ";", "}", "</s>"]
["<s>", "public", "Channel", "get", "(", "NodeInfo", "node", ")", "{", "return", "channels", ".", "get", "(", "node", ")", ";", "}", "</s>"]
["<s>", "public", "NodeInfo", "get", "(", "Channel", "channel", ")", "{", "return", "channels", ".", "inverse", "(", ")", ".", "get", "(", "channel", ")", ";", "}", "</s>"]
["<s>", "private", "void", "startReplicationThread", "(", ")", "{", "if", "(", "this", ".", "replThread", "!", "=", "null", ")", "return", ";", "this", ".", "replThread", "=", "new", "Thread", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "while", "(", "!", "Thread", ".", "interrupted", "(", ")", ")", "{", "synchronized", "(", "replIters", ")", "{", "while", "(", "replIters", ".", "isEmpty", "(", ")", ")", "replIters", ".", "wait", "(", ")", ";", "}", "for", "(", "Iterator", "<", "Map", ".", "Entry", "<", "Channel", ",", "Iterator", "<", "BACKUP", ">", ">", ">", "entryIter", "=", "replIters", ".", "entrySet", "(", ")", ".", "iterator", "(", ")", ";", "entryIter", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Map", ".", "Entry", "<", "Channel", ",", "Iterator", "<", "BACKUP", ">", ">", "entry", "=", "entryIter", ".", "next", "(", ")", ";", "final", "Channel", "channel", "=", "entry", ".", "getKey", "(", ")", ";", "final", "Iterator", "<", "BACKUP", ">", "iter", "=", "entry", ".", "getValue", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:10>", ";", "i", "+", "+", ")", "{", "if", "(", "iter", ".", "hasNext", "(", ")", ")", "{", "final", "BACKUP", "backup", "=", "iter", ".", "next", "(", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "backup", ",", "channel", ")", ";", "channel", ".", "write", "(", "backup", ")", ";", "}", "else", "{", "channel", ".", "write", "(", "Message", ".", "BACKUP", "(", "-", "1", ",", "-", "1", ",", "null", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ")", ";", "entryIter", ".", "remove", "(", ")", ";", "break", ";", "}", "}", "}", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", ")", ";", "replThread", ".", "setName", "(", "\"", "<STR_LIT>", "\"", ")", ";", "replThread", ".", "setDaemon", "(", "true", ")", ";", "replThread", ".", "setPriority", "(", "Thread", ".", "NORM_PRIORITY", "-", "1", ")", ";", "replThread", ".", "start", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "while", "(", "!", "Thread", ".", "interrupted", "(", ")", ")", "{", "synchronized", "(", "replIters", ")", "{", "while", "(", "replIters", ".", "isEmpty", "(", ")", ")", "replIters", ".", "wait", "(", ")", ";", "}", "for", "(", "Iterator", "<", "Map", ".", "Entry", "<", "Channel", ",", "Iterator", "<", "BACKUP", ">", ">", ">", "entryIter", "=", "replIters", ".", "entrySet", "(", ")", ".", "iterator", "(", ")", ";", "entryIter", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Map", ".", "Entry", "<", "Channel", ",", "Iterator", "<", "BACKUP", ">", ">", "entry", "=", "entryIter", ".", "next", "(", ")", ";", "final", "Channel", "channel", "=", "entry", ".", "getKey", "(", ")", ";", "final", "Iterator", "<", "BACKUP", ">", "iter", "=", "entry", ".", "getValue", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT:10>", ";", "i", "+", "+", ")", "{", "if", "(", "iter", ".", "hasNext", "(", ")", ")", "{", "final", "BACKUP", "backup", "=", "iter", ".", "next", "(", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "backup", ",", "channel", ")", ";", "channel", ".", "write", "(", "backup", ")", ";", "}", "else", "{", "channel", ".", "write", "(", "Message", ".", "BACKUP", "(", "-", "1", ",", "-", "1", ",", "null", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ")", ";", "entryIter", ".", "remove", "(", ")", ";", "break", ";", "}", "}", "}", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Object", "encode", "(", "ChannelHandlerContext", "ctx", ",", "Channel", "channel", ",", "Object", "msg", ")", "throws", "Exception", "{", "final", "MessagePacket", "packet", "=", "(", "MessagePacket", ")", "msg", ";", "return", "ChannelBuffers", ".", "wrappedBuffer", "(", "packet", ".", "toByteBuffers", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Object", "decode", "(", "ChannelHandlerContext", "ctx", ",", "Channel", "channel", ",", "Object", "msg", ")", "throws", "Exception", "{", "final", "ChannelBuffer", "buffer", "=", "(", "ChannelBuffer", ")", "msg", ";", "final", "MessagePacket", "packet", "=", "new", "MessagePacket", "(", ")", ";", "packet", ".", "fromByteBuffer", "(", "buffer", ".", "toByteBuffer", "(", ")", ")", ";", "return", "packet", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Object", "encode", "(", "ChannelHandlerContext", "ctx", ",", "Channel", "channel", ",", "Object", "msg", ")", "throws", "Exception", "{", "final", "Message", "message", "=", "(", "Message", ")", "msg", ";", "final", "ByteBuffer", "[", "]", "buffers", "=", "message", ".", "toByteBuffers", "(", ")", ";", "return", "ChannelBuffers", ".", "wrappedBuffer", "(", "buffers", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Object", "decode", "(", "ChannelHandlerContext", "ctx", ",", "Channel", "channel", ",", "Object", "msg", ")", "throws", "Exception", "{", "final", "ChannelBuffer", "buffer", "=", "(", "ChannelBuffer", ")", "msg", ";", "final", "Message", "message", "=", "Message", ".", "fromByteBuffer", "(", "buffer", ".", "toByteBuffer", "(", ")", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "int", "getBroadcastQueueLength", "(", ")", ";", "</s>"]
["<s>", "Map", "<", "Short", ",", "Integer", ">", "getPeerQueuesLengths", "(", ")", ";", "</s>"]
["<s>", "public", "UDPCommMonitor", "(", "String", "name", ",", "UDPComm", "monitored", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", "+", "name", ",", "monitored", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getBroadcastQueueLength", "(", ")", "{", "final", "UDPComm", "comm", "=", "getMonitored", "(", ")", ";", "if", "(", "comm", "=", "=", "null", ")", "return", "-", "1", ";", "return", "comm", ".", "getBroadcastPeer", "(", ")", ".", "getQueueLength", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Map", "<", "Short", ",", "Integer", ">", "getPeerQueuesLengths", "(", ")", "{", "final", "UDPComm", "comm", "=", "getMonitored", "(", ")", ";", "if", "(", "comm", "=", "=", "null", ")", "return", "null", ";", "final", "Map", "<", "Short", ",", "Integer", ">", "lengths", "=", "new", "HashMap", "<", "Short", ",", "Integer", ">", "(", "comm", ".", "getPeers", "(", ")", ".", "size", "(", ")", ")", ";", "for", "(", "Map", ".", "Entry", "<", "Short", ",", "UDPComm", ".", "NodePeer", ">", "entry", ":", "comm", ".", "getPeers", "(", ")", ".", "entrySet", "(", ")", ")", "lengths", ".", "put", "(", "entry", ".", "getKey", "(", ")", ",", "entry", ".", "getValue", "(", ")", ".", "getQueueLength", "(", ")", ")", ";", "return", "lengths", ";", "}", "</s>"]
["<s>", "public", "ChannelNodeNameWriter", "(", "Cluster", "cluster", ")", "{", "this", ".", "cluster", "=", "cluster", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "final", "Channel", "channel", "=", "ctx", ".", "getChannel", "(", ")", ";", "final", "String", "name", "=", "cluster", ".", "getMyNodeInfo", "(", ")", ".", "getName", "(", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "final", "byte", "[", "]", "array", "=", "name", ".", "getBytes", "(", "Charsets", ".", "UTF_8", ")", ";", "final", "ChannelBuffer", "message", "=", "ChannelBuffers", ".", "wrappedBuffer", "(", "array", ")", ";", "ctx", ".", "sendDownstream", "(", "new", "DownstreamMessageEvent", "(", "channel", ",", "new", "DefaultChannelFuture", "(", "channel", ",", "false", ")", ",", "message", ",", "null", ")", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "ctx", ".", "getPipeline", "(", ")", ".", "remove", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "throws", "Exception", "{", "final", "short", "nodeId", "=", "getNodeId", "(", "ctx", ",", "e", ".", "getRemoteAddress", "(", ")", ")", ";", "if", "(", "e", ".", "getMessage", "(", ")", "instanceof", "Message", ")", "(", "(", "Message", ")", "e", ".", "getMessage", "(", ")", ")", ".", "setNode", "(", "nodeId", ")", ";", "else", "if", "(", "e", ".", "getMessage", "(", ")", "instanceof", "MessagePacket", ")", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ".", "setNode", "(", "nodeId", ")", ";", "ctx", ".", "sendUpstream", "(", "e", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "short", "getNodeId", "(", "ChannelHandlerContext", "ctx", ",", "SocketAddress", "address", ")", ";", "</s>"]
["<s>", "public", "SocketNodeAddressResolver", "(", "Cluster", "cluster", ",", "String", "portProperty", ")", "{", "super", "(", "cluster", ")", ";", "this", ".", "portProperty", "=", "portProperty", ";", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "InetSocketAddress", "getAddress", "(", "NodeInfo", "node", ")", "{", "final", "InetAddress", "address", "=", "(", "InetAddress", ")", "node", ".", "get", "(", "IpConstants", ".", "IP_ADDRESS", ")", ";", "final", "Integer", "port", "=", "(", "Integer", ")", "node", ".", "get", "(", "portProperty", ")", ";", "if", "(", "address", "=", "=", "null", "|", "|", "port", "=", "=", "null", ")", "{", "if", "(", "address", "=", "=", "null", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "IpConstants", ".", "IP_ADDRESS", ",", "node", ")", ";", "if", "(", "port", "=", "=", "null", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "portProperty", ",", "node", ")", ";", "return", "null", ";", "}", "InetSocketAddress", "socket", "=", "new", "InetSocketAddress", "(", "address", ",", "port", ")", ";", "return", "socket", ";", "}", "</s>"]
["<s>", "public", "LoggingHandler", "(", "Logger", "logger", ")", "{", "this", ".", "logger", "=", "logger", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelClosed", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelClosed", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getChannel", "(", ")", ",", "e", ".", "getChannel", "(", ")", ".", "getRemoteAddress", "(", ")", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "logger", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getChannel", "(", ")", ",", "e", ".", "getChannel", "(", ")", ".", "getRemoteAddress", "(", ")", ")", ";", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "throws", "Exception", "{", "logger", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "e", ".", "getChannel", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getMessage", "(", ")", "}", ")", ";", "logger", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "super", ".", "exceptionCaught", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "boolean", "accept", "(", "ChannelHandlerContext", "ctx", ",", "ChannelEvent", "e", ",", "InetSocketAddress", "inetSocketAddress", ")", "throws", "Exception", ";", "</s>"]
["<s>", "protected", "boolean", "isBlocked", "(", "ChannelHandlerContext", "ctx", ")", "{", "return", "ctx", ".", "getAttachment", "(", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleUpstream", "(", "ChannelHandlerContext", "ctx", ",", "ChannelEvent", "e", ")", "throws", "Exception", "{", "if", "(", "e", "instanceof", "ChannelStateEvent", ")", "{", "ChannelStateEvent", "evt", "=", "(", "ChannelStateEvent", ")", "e", ";", "switch", "(", "evt", ".", "getState", "(", ")", ")", "{", "case", "OPEN", ":", "case", "BOUND", ":", "if", "(", "isBlocked", "(", "ctx", ")", ")", "return", ";", "else", "{", "ctx", ".", "sendUpstream", "(", "e", ")", ";", "return", ";", "}", "case", "CONNECTED", ":", "if", "(", "evt", ".", "getValue", "(", ")", "!", "=", "null", ")", "{", "InetSocketAddress", "inetSocketAddress", "=", "(", "InetSocketAddress", ")", "e", ".", "getChannel", "(", ")", ".", "getRemoteAddress", "(", ")", ";", "if", "(", "!", "accept", "(", "ctx", ",", "e", ",", "inetSocketAddress", ")", ")", "{", "ctx", ".", "setAttachment", "(", "Boolean", ".", "TRUE", ")", ";", "Channels", ".", "close", "(", "e", ".", "getChannel", "(", ")", ")", ";", "if", "(", "isBlocked", "(", "ctx", ")", ")", "return", ";", "}", "ctx", ".", "setAttachment", "(", "null", ")", ";", "}", "else", "{", "if", "(", "isBlocked", "(", "ctx", ")", ")", "return", ";", "}", "break", ";", "}", "}", "if", "(", "isBlocked", "(", "ctx", ")", ")", "return", ";", "ctx", ".", "sendUpstream", "(", "e", ")", ";", "}", "</s>"]
["<s>", "AbstractTcpServer", "(", "String", "name", ",", "final", "Cluster", "cluster", ",", "DefaultChannelGroup", "channels", ",", "int", "port", ",", "final", "ChannelHandler", "testHandler", ")", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "channels", "=", "channels", ";", "this", ".", "port", "=", "port", ";", "if", "(", "bossExecutor", "=", "=", "null", ")", "bossExecutor", "=", "(", "ThreadPoolExecutor", ")", "Executors", ".", "newCachedThreadPool", "(", ")", ";", "if", "(", "workerExecutor", "=", "=", "null", ")", "workerExecutor", "=", "(", "ThreadPoolExecutor", ")", "Executors", ".", "newCachedThreadPool", "(", ")", ";", "configureThreadPool", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "bossExecutor", ")", ";", "configureThreadPool", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "workerExecutor", ")", ";", "if", "(", "receiveExecutor", "!", "=", "null", ")", "configureThreadPool", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "receiveExecutor", ")", ";", "this", ".", "channelFactory", "=", "new", "NioServerSocketChannelFactory", "(", "bossExecutor", ",", "workerExecutor", ")", ";", "this", ".", "bootstrap", "=", "new", "ServerBootstrap", "(", "channelFactory", ")", ";", "origChannelFacotry", "=", "new", "TcpMessagePipelineFactory", "(", "LOG", ",", "channels", ",", "receiveExecutor", ")", "{", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addBefore", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "new", "ChannelNodeNameReader", "(", "cluster", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "channelHandler", ")", ";", "if", "(", "testHandler", "!", "=", "null", ")", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "testHandler", ")", ";", "return", "pipeline", ";", "}", "}", ";", "bootstrap", ".", "setPipelineFactory", "(", "new", "ChannelPipelineFactory", "(", ")", "{", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "return", "AbstractTcpServer", ".", "this", ".", "getPipeline", "(", ")", ";", "}", "}", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addBefore", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "new", "ChannelNodeNameReader", "(", "cluster", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "channelHandler", ")", ";", "if", "(", "testHandler", "!", "=", "null", ")", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "testHandler", ")", ";", "return", "pipeline", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "return", "AbstractTcpServer", ".", "this", ".", "getPipeline", "(", ")", ";", "}", "</s>"]
["<s>", "public", "AbstractTcpServer", "(", "String", "name", ",", "Cluster", "cluster", ",", "DefaultChannelGroup", "channels", ",", "int", "port", ")", "{", "this", "(", "name", ",", "cluster", ",", "channels", ",", "port", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setBossExecutor", "(", "ThreadPoolExecutor", "bossExecutor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "bossExecutor", "=", "bossExecutor", ";", "}", "</s>"]
["<s>", "public", "void", "setWorkerExecutor", "(", "ThreadPoolExecutor", "workerExecutor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "workerExecutor", "=", "workerExecutor", ";", "}", "</s>"]
["<s>", "public", "void", "setReceiveExecutor", "(", "OrderedMemoryAwareThreadPoolExecutor", "receiveExecutor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiveExecutor", "=", "receiveExecutor", ";", "}", "</s>"]
["<s>", "private", "void", "configureThreadPool", "(", "String", "name", ",", "ThreadPoolExecutor", "executor", ")", "{", "executor", ".", "setRejectedExecutionHandler", "(", "new", "ThreadPoolExecutor", ".", "DiscardPolicy", "(", ")", ")", ";", "executor", ".", "setThreadFactory", "(", "new", "CustomThreadFactory", "(", "name", ")", "{", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "}", ")", ";", "ThreadPoolExecutorMonitor", ".", "register", "(", "name", ",", "executor", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "{", "final", "Message", "message", "=", "(", "Message", ")", "e", ".", "getMessage", "(", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "ctx", ",", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getMessage", "(", ")", ")", ";", "ctx", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "return", "origChannelFacotry", ".", "getPipeline", "(", ")", ";", "}", "</s>"]
["<s>", "abstract", "protected", "void", "receive", "(", "ChannelHandlerContext", "ctx", ",", "Message", "message", ")", ";", "</s>"]
["<s>", "protected", "void", "bind", "(", ")", "{", "Channel", "channel", "=", "bootstrap", ".", "bind", "(", "new", "InetSocketAddress", "(", "port", ")", ")", ";", "channels", ".", "add", "(", "channel", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ",", "port", ")", ";", "setReady", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "channels", ".", "close", "(", ")", ".", "awaitUninterruptibly", "(", ")", ";", "channelFactory", ".", "releaseExternalResources", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "DefaultChannelGroup", "getChannels", "(", ")", "{", "return", "channels", ";", "}", "</s>"]
["<s>", "protected", "long", "nextMessageId", "(", ")", "{", "return", "nextMessageId", ".", "getAndIncrement", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getPort", "(", ")", "{", "return", "port", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "short", "getNodeId", "(", "ChannelHandlerContext", "ctx", ",", "SocketAddress", "address", ")", "{", "final", "Channel", "channel", "=", "ctx", ".", "getChannel", "(", ")", ";", "NodeInfo", "node", "=", "ChannelNodeInfo", ".", "nodeInfo", ".", "get", "(", "channel", ")", ";", "assert", "node", "!", "=", "null", ";", "return", "node", ".", "getNodeId", "(", ")", ";", "}", "</s>"]
["<s>", "public", "TcpMessagePipelineFactory", "(", "Logger", "logger", ",", "DefaultChannelGroup", "channelGroup", ",", "Executor", "executor", ")", "{", "this", ".", "logger", "=", "logger", ";", "this", ".", "channelGroup", "=", "channelGroup", ";", "this", ".", "nodeResolver", "=", "new", "ChannelAttachedNodeResolver", "(", ")", ";", "this", ".", "lengthFieldSize", "=", "<NUM_LIT:4>", ";", "this", ".", "executor", "=", "executor", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "Channels", ".", "pipeline", "(", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "LengthFieldBasedFrameDecoder", "(", "(", "int", ")", "(", "(", "<NUM_LIT>", "<", "<", "(", "lengthFieldSize", "*", "<NUM_LIT:8>", ")", ")", "-", "1", ")", "&", "(", "-", "1", ">", ">", ">", "1", ")", ",", "0", ",", "lengthFieldSize", ",", "0", ",", "lengthFieldSize", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "LengthFieldPrepender", "(", "lengthFieldSize", ",", "false", ")", ")", ";", "if", "(", "executor", "!", "=", "null", ")", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "ExecutionHandler", "(", "executor", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "LoggingHandler", "(", "logger", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "MessageCodec", "(", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "nodeResolver", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "SimpleChannelUpstreamHandler", "(", ")", "{", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "channelGroup", "!", "=", "null", ")", "channelGroup", ".", "add", "(", "e", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "}", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "channelGroup", "!", "=", "null", ")", "channelGroup", ".", "remove", "(", "e", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "e", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "}", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "throws", "Exception", "{", "e", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "super", ".", "exceptionCaught", "(", "ctx", ",", "e", ")", ";", "}", "}", ")", ";", "return", "pipeline", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "channelGroup", "!", "=", "null", ")", "channelGroup", ".", "add", "(", "e", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "channelGroup", "!", "=", "null", ")", "channelGroup", ".", "remove", "(", "e", ".", "getChannel", "(", ")", ")", ";", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "e", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "throws", "Exception", "{", "e", ".", "getChannel", "(", ")", ".", "close", "(", ")", ";", "super", ".", "exceptionCaught", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "TcpServerClientComm", "(", "String", "name", ",", "Cluster", "cluster", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ",", "IP_SERVER_PORT", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_ADDRESS", ",", "true", ",", "true", ",", "INET_ADDRESS_READER_WRITER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_ADDRESS", ",", "InetAddress", ".", "getLocalHost", "(", ")", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_SERVER_PORT", ",", "false", ",", "true", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "addNodeChangeListener", "(", "new", "NodeChangeListener", "(", ")", "{", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "id", "=", "=", "Comm", ".", "SERVER", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "setNodeName", "(", "getCluster", "(", ")", ".", "getMaster", "(", "Comm", ".", "SERVER", ")", ".", "getName", "(", ")", ")", ";", "connectLater", "(", ")", ";", "}", "}", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "id", "=", "=", "Comm", ".", "SERVER", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "reconnect", "(", "getCluster", "(", ")", ".", "getMaster", "(", "Comm", ".", "SERVER", ")", ".", "getName", "(", ")", ")", ";", "}", "}", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "id", "=", "=", "Comm", ".", "SERVER", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "disconnect", "(", ")", ";", "setNodeName", "(", "null", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeAdded", "(", "short", "id", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "id", "=", "=", "Comm", ".", "SERVER", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "setNodeName", "(", "getCluster", "(", ")", ".", "getMaster", "(", "Comm", ".", "SERVER", ")", ".", "getName", "(", ")", ")", ";", "connectLater", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeSwitched", "(", "short", "id", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "id", "=", "=", "Comm", ".", "SERVER", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "reconnect", "(", "getCluster", "(", ")", ".", "getMaster", "(", "Comm", ".", "SERVER", ")", ".", "getName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "nodeRemoved", "(", "short", "id", ")", "{", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", "&", "&", "id", "=", "=", "Comm", ".", "SERVER", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "disconnect", "(", ")", ";", "setNodeName", "(", "null", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "if", "(", "master", ")", "{", "final", "NodeInfo", "serverInfo", "=", "getCluster", "(", ")", ".", "getMaster", "(", "Comm", ".", "SERVER", ")", ";", "if", "(", "serverInfo", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "reconnect", "(", "serverInfo", ".", "getName", "(", ")", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "super", ".", "switchToMaster", "(", ")", ";", "reconnect", "(", "getCluster", "(", ")", ".", "getMaster", "(", "Comm", ".", "SERVER", ")", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiver", "=", "receiver", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "receive", "(", "ChannelHandlerContext", "ctx", ",", "Message", "message", ")", "{", "receiver", ".", "receive", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setTimestamp", "(", "long", "timestamp", ")", "{", "this", ".", "timestamp", "=", "timestamp", ";", "}", "</s>"]
["<s>", "public", "long", "getTimestamp", "(", ")", "{", "return", "timestamp", ";", "}", "</s>"]
["<s>", "public", "void", "addMessage", "(", "Message", "message", ")", "{", "assert", "messages", ".", "size", "(", ")", "<", "<NUM_LIT>", ";", "messages", ".", "add", "(", "message", ")", ";", "size", "+", "=", "message", ".", "size", "(", ")", ";", "numBuffers", "+", "=", "1", "+", "message", ".", "getNumDataBuffers", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "removeMessage", "(", "Message", "m", ")", "{", "int", "index", "=", "messages", ".", "indexOf", "(", "m", ")", ";", "Message", "message", "=", "messages", ".", "get", "(", "index", ")", ";", "if", "(", "index", ">", "=", "0", ")", "{", "messages", ".", "remove", "(", "index", ")", ";", "messageRemoved", "(", "message", ")", ";", "return", "true", ";", "}", "else", "return", "false", ";", "}", "</s>"]
["<s>", "public", "boolean", "removeMessage", "(", "long", "id", ")", "{", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "messages", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Message", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getMessageId", "(", ")", "!", "=", "id", ")", "continue", ";", "it", ".", "remove", "(", ")", ";", "messageRemoved", "(", "message", ")", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "private", "void", "messageRemoved", "(", "Message", "message", ")", "{", "size", "-", "=", "message", ".", "size", "(", ")", ";", "numBuffers", "-", "=", "1", "+", "message", ".", "getNumDataBuffers", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Message", "getMessage", "(", "Message", "m", ")", "{", "int", "index", "=", "messages", ".", "indexOf", "(", "m", ")", ";", "if", "(", "index", "<", "0", ")", "return", "null", ";", "Message", "message", "=", "messages", ".", "get", "(", "index", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "public", "boolean", "contains", "(", "Message", "m", ")", "{", "return", "messages", ".", "contains", "(", "m", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "contains", "(", "long", "id", ")", "{", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "messages", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Message", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getMessageId", "(", ")", "!", "=", "id", ")", "continue", ";", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "int", "numMessages", "(", ")", "{", "return", "messages", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ArrayList", "<", "Message", ">", "getMessages", "(", ")", "{", "return", "messages", ";", "}", "</s>"]
["<s>", "public", "boolean", "isMulticast", "(", ")", "{", "return", "multicast", ";", "}", "</s>"]
["<s>", "public", "void", "setMulticast", "(", ")", "{", "this", ".", "multicast", "=", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Iterator", "<", "Message", ">", "iterator", "(", ")", "{", "return", "wrapIterator", "(", "messages", ".", "iterator", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "Iterator", "<", "Message", ">", "reverseIterator", "(", ")", "{", "return", "wrapIterator", "(", "Util", ".", "reverse", "(", "messages", ")", ".", "iterator", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "Iterator", "<", "Message", ">", "wrapIterator", "(", "final", "Iterator", "<", "Message", ">", "it", ")", "{", "return", "new", "Iterator", "<", "Message", ">", "(", ")", "{", "private", "Message", "message", ";", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasNext", "(", ")", ";", "}", "@", "Override", "public", "Message", "next", "(", ")", "{", "message", "=", "it", ".", "next", "(", ")", ";", "return", "message", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "it", ".", "remove", "(", ")", ";", "messageRemoved", "(", "message", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasNext", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Message", "next", "(", ")", "{", "message", "=", "it", ".", "next", "(", ")", ";", "return", "message", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "it", ".", "remove", "(", ")", ";", "messageRemoved", "(", "message", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isEmpty", "(", ")", "{", "return", "messages", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "sizeInBytes", "(", ")", "{", "return", "size", ";", "}", "</s>"]
["<s>", "public", "int", "getNumBuffers", "(", ")", "{", "return", "numBuffers", ";", "}", "</s>"]
["<s>", "public", "ByteBuffer", "[", "]", "toByteBuffers", "(", ")", "{", "ByteBuffer", "[", "]", "buffers", "=", "new", "ByteBuffer", "[", "numBuffers", "]", ";", "int", "i", "=", "0", ";", "for", "(", "Message", "message", ":", "messages", ")", "{", "ByteBuffer", "[", "]", "bs", "=", "message", ".", "toByteBuffers", "(", ")", ";", "for", "(", "ByteBuffer", "b", ":", "bs", ")", "{", "b", ".", "rewind", "(", ")", ";", "buffers", "[", "i", "]", "=", "b", ";", "i", "+", "+", ";", "}", "}", "return", "buffers", ";", "}", "</s>"]
["<s>", "public", "void", "fromByteBuffer", "(", "ByteBuffer", "buffer", ")", "{", "while", "(", "buffer", ".", "hasRemaining", "(", ")", ")", "addMessage", "(", "Message", ".", "fromByteBuffer", "(", "buffer", ")", ")", ";", "}", "</s>"]
["<s>", "public", "short", "getNode", "(", ")", "{", "return", "messages", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getNode", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setNode", "(", "short", "node", ")", "{", "for", "(", "Message", "m", ":", "messages", ")", "m", ".", "setNode", "(", "node", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "messages", "+", "<CHAR_LIT:]>", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "MessagePacket", "clone", "(", ")", "{", "try", "{", "final", "MessagePacket", "clone", "=", "(", "MessagePacket", ")", "super", ".", "clone", "(", ")", ";", "clone", ".", "messages", "=", "(", "ArrayList", "<", "Message", ">", ")", "messages", ".", "clone", "(", ")", ";", "return", "clone", ";", "}", "catch", "(", "CloneNotSupportedException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "TcpSlaveClientComm", "(", "String", "name", ",", "Cluster", "cluster", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ",", "IP_SLAVE_PORT", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_ADDRESS", ",", "true", ",", "true", ",", "INET_ADDRESS_READER_WRITER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_ADDRESS", ",", "InetAddress", ".", "getLocalHost", "(", ")", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_SLAVE_PORT", ",", "true", ",", "false", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "addSlaveConfigurationListener", "(", "scListener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "newMaster", "(", "NodeInfo", "node", ")", "{", "if", "(", "!", "node", ".", "equals", "(", "getCluster", "(", ")", ".", "getMyNodeInfo", "(", ")", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ".", "getName", "(", ")", ")", ";", "reconnect", "(", "node", ".", "getName", "(", ")", ")", ";", "}", "else", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slaveAdded", "(", "NodeInfo", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "slaveRemoved", "(", "NodeInfo", "node", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "available", "(", "boolean", "value", ")", "{", "super", ".", "available", "(", "value", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "joinedCluster", "(", ")", "{", "super", ".", "joinedCluster", "(", ")", ";", "final", "NodeInfo", "master", "=", "getCluster", "(", ")", ".", "getMaster", "(", "getCluster", "(", ")", ".", "getMyNodeId", "(", ")", ")", ";", "if", "(", "master", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "master", ".", "getName", "(", ")", ")", ";", "reconnect", "(", "master", ".", "getName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "if", "(", "master", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "shutdown", "(", ")", ";", "return", ";", "}", "final", "String", "myMaster", "=", "getCluster", "(", ")", ".", "getMyMaster", "(", ")", ".", "getName", "(", ")", ";", "assert", "myMaster", "!", "=", "null", ";", "if", "(", "!", "myMaster", ".", "equals", "(", "getNodeName", "(", ")", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "myMaster", ")", ";", "reconnect", "(", "myMaster", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "getCluster", "(", ")", ".", "removeSlaveConfigurationListener", "(", "scListener", ")", ";", "super", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "switchToMaster", "(", ")", "{", "super", ".", "switchToMaster", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setBackup", "(", "Backup", "backup", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "backup", "=", "backup", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "receive", "(", "ChannelHandlerContext", "ctx", ",", "Message", "message", ")", "{", "backup", ".", "receive", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "TcpSlaveComm", "(", "String", "name", ",", "final", "Cluster", "cluster", ",", "int", "port", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "server", "=", "new", "TcpSlaveServerComm", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "cluster", ",", "port", ")", ";", "this", ".", "client", "=", "new", "TcpSlaveClientComm", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "cluster", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "server", ".", "init", "(", ")", ";", "client", ".", "init", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getPort", "(", ")", "{", "return", "server", ".", "getPort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "server", ".", "postInit", "(", ")", ";", "client", ".", "postInit", "(", ")", ";", "setReady", "(", "true", ")", ";", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "available", "(", "boolean", "value", ")", "{", "super", ".", "available", "(", "value", ")", ";", "server", ".", "available", "(", "value", ")", ";", "client", ".", "available", "(", "value", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setBackup", "(", "Backup", "backup", ")", "{", "server", ".", "setBackup", "(", "backup", ")", ";", "client", ".", "setBackup", "(", "backup", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setBossExecutor", "(", "ThreadPoolExecutor", "executor", ")", "{", "assertDuringInitialization", "(", ")", ";", "server", ".", "setBossExecutor", "(", "executor", ")", ";", "client", ".", "setBossExecutor", "(", "executor", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setWorkerExecutor", "(", "ThreadPoolExecutor", "executor", ")", "{", "assertDuringInitialization", "(", ")", ";", "server", ".", "setWorkerExecutor", "(", "executor", ")", ";", "client", ".", "setWorkerExecutor", "(", "executor", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setReceiveExecutor", "(", "OrderedMemoryAwareThreadPoolExecutor", "executor", ")", "{", "assertDuringInitialization", "(", ")", ";", "server", ".", "setReceiveExecutor", "(", "executor", ")", ";", "client", ".", "setReceiveExecutor", "(", "executor", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "start", "(", "boolean", "master", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "send", "(", "Message", "message", ")", "throws", "NodeNotFoundException", "{", "switch", "(", "message", ".", "getType", "(", ")", ")", "{", "case", "BACKUP_PACKET", ":", "if", "(", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "false", ";", "}", "return", "server", ".", "send", "(", "message", ")", ";", "case", "BACKUP_PACKETACK", ":", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "false", ";", "}", "client", ".", "send", "(", "message", ")", ";", "break", ";", "case", "INV", ":", "if", "(", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "false", ";", "}", "return", "server", ".", "send", "(", "message", ")", ";", "case", "INVACK", ":", "if", "(", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "return", "false", ";", "}", "client", ".", "send", "(", "message", ")", ";", "break", ";", "default", ":", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "public", "AbstractTcpClient", "(", "String", "name", ",", "final", "Cluster", "cluster", ",", "final", "String", "portProperty", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ")", ";", "this", ".", "portProperty", "=", "portProperty", ";", "if", "(", "bossExecutor", "=", "=", "null", ")", "bossExecutor", "=", "(", "ThreadPoolExecutor", ")", "Executors", ".", "newCachedThreadPool", "(", ")", ";", "if", "(", "workerExecutor", "=", "=", "null", ")", "workerExecutor", "=", "(", "ThreadPoolExecutor", ")", "Executors", ".", "newCachedThreadPool", "(", ")", ";", "configureThreadPool", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "bossExecutor", ")", ";", "configureThreadPool", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "workerExecutor", ")", ";", "if", "(", "receiveExecutor", "!", "=", "null", ")", "configureThreadPool", "(", "name", "+", "\"", "<STR_LIT>", "\"", ",", "receiveExecutor", ")", ";", "this", ".", "channelFactory", "=", "new", "NioClientSocketChannelFactory", "(", "bossExecutor", ",", "workerExecutor", ")", ";", "this", ".", "bootstrap", "=", "new", "ClientBootstrap", "(", "channelFactory", ")", ";", "origChannelFacotry", "=", "new", "TcpMessagePipelineFactory", "(", "LOG", ",", "null", ",", "receiveExecutor", ")", "{", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addBefore", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "new", "ChannelNodeNameWriter", "(", "cluster", ")", ")", ";", "pipeline", ".", "addBefore", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "new", "SimpleChannelUpstreamHandler", "(", ")", "{", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "nodeName", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "NodeInfo", "ni", "=", "cluster", ".", "getNodeInfoByName", "(", "nodeName", ")", ";", "ChannelNodeInfo", ".", "nodeInfo", ".", "set", "(", "ctx", ".", "getChannel", "(", ")", ",", "ni", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "pipeline", ".", "remove", "(", "this", ")", ";", "}", "}", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "channelHandler", ")", ";", "return", "pipeline", ";", "}", "}", ";", "bootstrap", ".", "setPipelineFactory", "(", "new", "ChannelPipelineFactory", "(", ")", "{", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "return", "AbstractTcpClient", ".", "this", ".", "getPipeline", "(", ")", ";", "}", "}", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "reconnect", "=", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addBefore", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "new", "ChannelNodeNameWriter", "(", "cluster", ")", ")", ";", "pipeline", ".", "addBefore", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "new", "SimpleChannelUpstreamHandler", "(", ")", "{", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "nodeName", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "NodeInfo", "ni", "=", "cluster", ".", "getNodeInfoByName", "(", "nodeName", ")", ";", "ChannelNodeInfo", ".", "nodeInfo", ".", "set", "(", "ctx", ".", "getChannel", "(", ")", ",", "ni", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "pipeline", ".", "remove", "(", "this", ")", ";", "}", "}", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "channelHandler", ")", ";", "return", "pipeline", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "if", "(", "nodeName", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "NodeInfo", "ni", "=", "cluster", ".", "getNodeInfoByName", "(", "nodeName", ")", ";", "ChannelNodeInfo", ".", "nodeInfo", ".", "set", "(", "ctx", ".", "getChannel", "(", ")", ",", "ni", ")", ";", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "pipeline", ".", "remove", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "return", "AbstractTcpClient", ".", "this", ".", "getPipeline", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "disconnect", "(", ")", ";", "channelFactory", ".", "releaseExternalResources", "(", ")", ";", "executor", ".", "shutdownNow", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setBossExecutor", "(", "ThreadPoolExecutor", "bossExecutor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "bossExecutor", "=", "bossExecutor", ";", "}", "</s>"]
["<s>", "public", "void", "setWorkerExecutor", "(", "ThreadPoolExecutor", "workerExecutor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "workerExecutor", "=", "workerExecutor", ";", "}", "</s>"]
["<s>", "public", "void", "setReceiveExecutor", "(", "OrderedMemoryAwareThreadPoolExecutor", "receiveExecutor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiveExecutor", "=", "receiveExecutor", ";", "}", "</s>"]
["<s>", "private", "void", "configureThreadPool", "(", "String", "name", ",", "ThreadPoolExecutor", "executor", ")", "{", "executor", ".", "setRejectedExecutionHandler", "(", "new", "ThreadPoolExecutor", ".", "DiscardPolicy", "(", ")", ")", ";", "executor", ".", "setThreadFactory", "(", "new", "CustomThreadFactory", "(", "name", ")", "{", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "}", ")", ";", "ThreadPoolExecutorMonitor", ".", "register", "(", "name", ",", "executor", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "protected", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "return", "origChannelFacotry", ".", "getPipeline", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "setNodeName", "(", "String", "nodeName", ")", "{", "this", ".", "nodeName", "=", "nodeName", ";", "}", "</s>"]
["<s>", "protected", "String", "getNodeName", "(", ")", "{", "return", "nodeName", ";", "}", "</s>"]
["<s>", "private", "InetSocketAddress", "getAddress", "(", "NodeInfo", "node", ",", "String", "portProperty", ")", "{", "final", "InetAddress", "_address", "=", "(", "InetAddress", ")", "node", ".", "get", "(", "IpConstants", ".", "IP_ADDRESS", ")", ";", "final", "Integer", "port", "=", "(", "Integer", ")", "node", ".", "get", "(", "portProperty", ")", ";", "if", "(", "_address", "=", "=", "null", "|", "|", "port", "=", "=", "null", ")", "{", "if", "(", "_address", "=", "=", "null", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "IpConstants", ".", "IP_ADDRESS", ",", "node", ")", ";", "if", "(", "port", "=", "=", "null", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "portProperty", ",", "node", ")", ";", "return", "null", ";", "}", "InetSocketAddress", "socket", "=", "new", "InetSocketAddress", "(", "_address", ",", "port", ")", ";", "return", "socket", ";", "}", "</s>"]
["<s>", "protected", "void", "reconnect", "(", "String", "nodeName", ")", "{", "if", "(", "nodeName", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "!", "nodeName", ".", "equals", "(", "this", ".", "nodeName", ")", ")", "{", "disconnect", "(", ")", ";", "setNodeName", "(", "nodeName", ")", ";", "}", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "reconnect", "=", "true", ";", "connectLater", "(", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isConnected", "(", ")", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "return", "channel", "!", "=", "null", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "void", "connectLater", "(", ")", "{", "executor", ".", "submit", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "connect", "(", ")", ";", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "connect", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "connect", "(", ")", "{", "try", "{", "for", "(", ";", ";", ")", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "!", "reconnect", "|", "|", "Thread", ".", "interrupted", "(", ")", ")", "return", ";", "if", "(", "channel", "!", "=", "null", ")", "return", ";", "address", "=", "getAddress", "(", "getCluster", "(", ")", ".", "getNodeInfoByName", "(", "nodeName", ")", ",", "portProperty", ")", ";", "if", "(", "address", "=", "=", "null", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ")", ";", "return", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ",", "address", ")", ";", "connecting", "=", "true", ";", "ChannelFuture", "future", "=", "bootstrap", ".", "connect", "(", "address", ")", ";", "future", ".", "awaitUninterruptibly", "(", ")", ";", "if", "(", "future", ".", "isSuccess", "(", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "address", ")", ";", "channelConnected", ".", "signalAll", "(", ")", ";", "break", ";", "}", "}", "catch", "(", "ChannelException", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "address", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "}", "catch", "(", "InterruptedException", "e", ")", "{", "}", "}", "</s>"]
["<s>", "protected", "void", "disconnect", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", ",", "address", ")", ";", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "connecting", "=", "false", ";", "reconnect", "=", "false", ";", "if", "(", "channel", "!", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ")", ";", "channel", ".", "close", "(", ")", ".", "awaitUninterruptibly", "(", ")", ";", "}", "channel", "=", "null", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "Channel", "getChannel", "(", ")", "{", "Channel", "_channel", "=", "channel", ";", "if", "(", "_channel", "=", "=", "null", ")", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "while", "(", "channel", "=", "=", "null", ")", "channelConnected", ".", "await", "(", ")", ";", "return", "channel", ";", "}", "catch", "(", "InterruptedException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "}", "else", "return", "_channel", ";", "}", "</s>"]
["<s>", "public", "void", "send", "(", "Message", "message", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "if", "(", "!", "message", ".", "getType", "(", ")", ".", "isOf", "(", "Message", ".", "Type", ".", "REQUIRES_RESPONSE", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "else", "pendingReply", ".", "addFirst", "(", "message", ")", ";", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "channel", "!", "=", "null", ")", "{", "channel", ".", "write", "(", "message", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "else", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "abstract", "protected", "void", "receive", "(", "ChannelHandlerContext", "ctx", ",", "Message", "message", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "{", "final", "Message", "message", "=", "(", "Message", ")", "e", ".", "getMessage", "(", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "pendingReply", ".", "removeLastOccurrence", "(", "message", ")", ";", "receive", "(", "ctx", ",", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelConnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "channel", "=", "e", ".", "getChannel", "(", ")", ";", "if", "(", "!", "connecting", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ")", ";", "channel", ".", "close", "(", ")", ";", "return", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ")", ";", "for", "(", "Message", "pending", ":", "reverse", "(", "pendingReply", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "pending", ")", ";", "channel", ".", "write", "(", "pending", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "pending", ")", ";", "}", "setReady", "(", "true", ")", ";", "connecting", "=", "false", ";", "channelConnected", ".", "signalAll", "(", ")", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "super", ".", "channelConnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "channelDisconnected", "(", "ChannelHandlerContext", "ctx", ",", "ChannelStateEvent", "e", ")", "throws", "Exception", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "ctx", ".", "getChannel", "(", ")", "=", "=", "channel", ")", "{", "setReady", "(", "false", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "channel", ".", "close", "(", ")", ";", "channel", "=", "null", ";", "connectLater", "(", ")", ";", "}", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "}", "super", ".", "channelDisconnected", "(", "ctx", ",", "e", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "{", "channelLock", ".", "lock", "(", ")", ";", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getMessage", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "setReady", "(", "false", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "channel", ".", "close", "(", ")", ";", "channel", "=", "null", ";", "}", "finally", "{", "channelLock", ".", "unlock", "(", ")", ";", "connectLater", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "UDPComm", "(", "String", "name", ",", "Cluster", "cluster", ",", "ServerComm", "serverComm", ",", "int", "port", ")", "throws", "Exception", "{", "super", "(", "name", ",", "cluster", ",", "new", "SocketNodeAddressResolver", "(", "cluster", ",", "IP_COMM_PORT", ")", ")", ";", "this", ".", "serverComm", "=", "serverComm", ";", "this", ".", "port", "=", "port", ";", "cluster", ".", "addNodeProperty", "(", "IP_ADDRESS", ",", "true", ",", "true", ",", "INET_ADDRESS_READER_WRITER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_ADDRESS", ",", "InetAddress", ".", "getLocalHost", "(", ")", ")", ";", "cluster", ".", "addNodeProperty", "(", "IP_COMM_PORT", ",", "true", ",", "false", ",", "ReaderWriters", ".", "INTEGER", ")", ";", "cluster", ".", "setNodeProperty", "(", "IP_COMM_PORT", ",", "port", ")", ";", "this", ".", "monitor", "=", "new", "UDPCommMonitor", "(", "name", ",", "this", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getPort", "(", ")", "{", "return", "port", ";", "}", "</s>"]
["<s>", "public", "void", "setReceiveBufferSize", "(", "int", "size", ")", "{", "assertDuringInitialization", "(", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "size", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMulticastGroup", "(", "InetSocketAddress", "group", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "multicastGroup", "=", "group", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "String", "getMulticastGroupName", "(", ")", "{", "return", "multicastGroup", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMulticastNetworkInterface", "(", "NetworkInterface", "multicastNetworkInterface", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "multicastNetworkInterface", "=", "multicastNetworkInterface", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "String", "getMulticastNetworkInterfaceName", "(", ")", "{", "return", "multicastNetworkInterface", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxQueueSize", "(", "int", "maxQueueSize", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxQueueSize", "=", "maxQueueSize", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMaxQueueSize", "(", ")", "{", "return", "maxQueueSize", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxPacketSize", "(", "int", "maxPacketSize", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxPacketSize", "=", "maxPacketSize", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMaxPacketSize", "(", ")", "{", "return", "maxPacketSize", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxRequestOnlyPacketSize", "(", "int", "maxRequestOnlyPacketSize", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxRequestOnlyPacketSize", "=", "maxRequestOnlyPacketSize", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMaxRequestOnlyPacketSize", "(", ")", "{", "return", "maxRequestOnlyPacketSize", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxDelayMicrosecs", "(", "int", "maxDelayMicrosecs", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxDelayNanos", "=", "NANOSECONDS", ".", "convert", "(", "maxDelayMicrosecs", ",", "MICROSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMaxDelayMicrosecs", "(", ")", "{", "return", "(", "int", ")", "MICROSECONDS", ".", "convert", "(", "maxDelayNanos", ",", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMinDelayMicrosecs", "(", "int", "minDelayMicrosecs", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "minDelayNanos", "=", "NANOSECONDS", ".", "convert", "(", "minDelayMicrosecs", ",", "MICROSECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMinDelayMicrosecs", "(", ")", "{", "return", "(", "int", ")", "MICROSECONDS", ".", "convert", "(", "minDelayNanos", ",", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setResendPeriodMillisecs", "(", "int", "resnedPeriodMillisecs", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "resendPeriodNanos", "=", "NANOSECONDS", ".", "convert", "(", "resnedPeriodMillisecs", ",", "MILLISECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getResendPeriodMillisecs", "(", ")", "{", "return", "(", "int", ")", "MILLISECONDS", ".", "convert", "(", "resendPeriodNanos", ",", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMinimumNodesToMulticast", "(", "int", "minimumNodesToMulticast", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "minimumNodesToMulticast", "=", "minimumNodesToMulticast", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "int", "getMinimumNodesToMulticast", "(", ")", "{", "return", "minimumNodesToMulticast", ";", "}", "</s>"]
["<s>", "public", "void", "setWorkerExecutor", "(", "ThreadPoolExecutor", "executor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "workerExecutor", "=", "executor", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "String", "getWorkerExecutorName", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "public", "void", "setReceiveExecutor", "(", "OrderedMemoryAwareThreadPoolExecutor", "executor", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "receiveExecutor", "=", "executor", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "String", "getReceiveExecutorName", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "public", "void", "setJitter", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "jitter", "=", "value", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isJitter", "(", ")", "{", "return", "jitter", ";", "}", "</s>"]
["<s>", "public", "void", "setExponentialBackoff", "(", "boolean", "value", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "exponentialBackoff", "=", "value", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isExponentialBackoff", "(", ")", "{", "return", "exponentialBackoff", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setReceiver", "(", "MessageReceiver", "receiver", ")", "{", "super", ".", "setReceiver", "(", "receiver", ")", ";", "if", "(", "serverComm", "!", "=", "null", ")", "serverComm", ".", "setReceiver", "(", "receiver", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "if", "(", "!", "isSendToServerInsteadOfMulticast", "(", ")", "&", "&", "multicastGroup", "=", "=", "null", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "this", ".", "myAddress", "=", "new", "InetSocketAddress", "(", "InetAddress", ".", "getLocalHost", "(", ")", ",", "port", ")", ";", "configureThreadPool", "(", "getWorkerExecutorName", "(", ")", ",", "workerExecutor", ")", ";", "if", "(", "receiveExecutor", "!", "=", "null", ")", "configureThreadPool", "(", "getReceiveExecutorName", "(", ")", ",", "receiveExecutor", ")", ";", "this", ".", "channelFactory", "=", "isSendToServerInsteadOfMulticast", "(", ")", "?", "new", "NioDatagramChannelFactory", "(", "workerExecutor", ")", ":", "new", "OioDatagramChannelFactory", "(", "workerExecutor", ")", ";", "this", ".", "bootstrap", "=", "new", "ConnectionlessBootstrap", "(", "channelFactory", ")", ";", "bootstrap", ".", "setPipelineFactory", "(", "new", "UdpMessagePipelineFactory", "(", "LOG", ",", "new", "ChannelNodeAddressResolver", "(", "addressResolver", ")", ",", "receiveExecutor", ")", "{", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "SimpleChannelHandler", "(", ")", "{", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "{", "if", "(", "ctx", ".", "getChannel", "(", ")", "=", "=", "multicastChannel", ")", "{", "if", "(", "e", ".", "getRemoteAddress", "(", ")", ".", "equals", "(", "myAddress", ")", ")", "return", ";", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ".", "setMulticast", "(", ")", ";", "}", "messageReceived", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ";", "}", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getMessage", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "}", "}", ")", ";", "return", "pipeline", ";", "}", "}", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "new", "InetSocketAddress", "(", "port", ")", ")", ";", "bootstrap", ".", "setOption", "(", "\"", "<STR_LIT>", "\"", ",", "true", ")", ";", "monitor", ".", "registerMBean", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "super", ".", "getPipeline", "(", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "SimpleChannelHandler", "(", ")", "{", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "{", "if", "(", "ctx", ".", "getChannel", "(", ")", "=", "=", "multicastChannel", ")", "{", "if", "(", "e", ".", "getRemoteAddress", "(", ")", ".", "equals", "(", "myAddress", ")", ")", "return", ";", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ".", "setMulticast", "(", ")", ";", "}", "messageReceived", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ";", "}", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getMessage", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "}", "}", ")", ";", "return", "pipeline", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "messageReceived", "(", "ChannelHandlerContext", "ctx", ",", "MessageEvent", "e", ")", "{", "if", "(", "ctx", ".", "getChannel", "(", ")", "=", "=", "multicastChannel", ")", "{", "if", "(", "e", ".", "getRemoteAddress", "(", ")", ".", "equals", "(", "myAddress", ")", ")", "return", ";", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ".", "setMulticast", "(", ")", ";", "}", "messageReceived", "(", "(", "MessagePacket", ")", "e", ".", "getMessage", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "exceptionCaught", "(", "ChannelHandlerContext", "ctx", ",", "ExceptionEvent", "e", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getCause", "(", ")", ".", "getMessage", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "void", "configureThreadPool", "(", "String", "name", ",", "ThreadPoolExecutor", "executor", ")", "{", "executor", ".", "setRejectedExecutionHandler", "(", "new", "ThreadPoolExecutor", ".", "DiscardPolicy", "(", ")", ")", ";", "executor", ".", "setThreadFactory", "(", "new", "CustomThreadFactory", "(", "name", ")", "{", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "}", ")", ";", "ThreadPoolExecutorMonitor", ".", "register", "(", "name", ",", "executor", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "CommThread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postInit", "(", ")", "throws", "Exception", "{", "if", "(", "!", "sendToServerInsteadOfMulticast", ")", "this", ".", "broadcastPeer", "=", "new", "BroadcastPeer", "(", ")", ";", "super", ".", "postInit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "start", "(", "boolean", "master", ")", "{", "this", ".", "channel", "=", "(", "DatagramChannel", ")", "bootstrap", ".", "bind", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "channel", ",", "port", ")", ";", "if", "(", "!", "isSendToServerInsteadOfMulticast", "(", ")", ")", "{", "final", "int", "multicastPort", "=", "multicastGroup", ".", "getPort", "(", ")", ";", "this", ".", "multicastChannel", "=", "(", "DatagramChannel", ")", "bootstrap", ".", "bind", "(", "new", "InetSocketAddress", "(", "multicastPort", ")", ")", ";", "if", "(", "multicastNetworkInterface", "!", "=", "null", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "multicastChannel", ",", "multicastGroup", ",", "multicastNetworkInterface", "}", ")", ";", "multicastChannel", ".", "joinGroup", "(", "multicastGroup", ",", "multicastNetworkInterface", ")", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "multicastChannel", ",", "multicastGroup", ")", ";", "multicastChannel", ".", "joinGroup", "(", "multicastGroup", ".", "getAddress", "(", ")", ")", ";", "}", "}", "else", "this", ".", "multicastChannel", "=", "null", ";", "setReady", "(", "true", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "monitor", ".", "unregisterMBean", "(", ")", ";", "if", "(", "channel", "!", "=", "null", ")", "channel", ".", "close", "(", ")", ";", "channelFactory", ".", "releaseExternalResources", "(", ")", ";", "}", "</s>"]
["<s>", "void", "setChannel", "(", "DatagramChannel", "channel", ")", "{", "this", ".", "channel", "=", "channel", ";", "}", "</s>"]
["<s>", "ExecutorService", "getExecutor", "(", ")", "{", "return", "executor", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "sendToServer", "(", "Message", "message", ")", "{", "super", ".", "sendToServer", "(", "message", ")", ";", "try", "{", "serverComm", ".", "send", "(", "message", ")", ";", "}", "catch", "(", "NodeNotFoundException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "sendToNode", "(", "Message", "message", ",", "short", "node", ",", "InetSocketAddress", "address", ")", "{", "try", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "node", ",", "address", ",", "message", "}", ")", ";", "message", ".", "cloneDataBuffers", "(", ")", ";", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "node", ")", ";", "if", "(", "peer", "=", "=", "null", ")", "throw", "new", "NodeNotFoundException", "(", "node", ")", ";", "peer", ".", "sendMessage", "(", "message", ")", ";", "executor", ".", "submit", "(", "peer", ")", ";", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "message", "+", "\"", "<STR_LIT>", "\"", "+", "node", ",", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "protected", "synchronized", "void", "broadcast", "(", "Message", "message", ")", "{", "try", "{", "assert", "message", ".", "isBroadcast", "(", ")", "&", "&", "!", "message", ".", "isResponse", "(", ")", ";", "assignMessageId", "(", "message", ")", ";", "final", "boolean", "unicast", "=", "getNumPeerNodes", "(", ")", "<", "minimumNodesToMulticast", ";", "final", "TShortHashSet", "nodes", "=", "new", "TShortHashSet", "(", ")", ";", "for", "(", "NodePeer", "peer", ":", "peers", ".", "values", "(", ")", ")", "{", "nodes", ".", "add", "(", "peer", ".", "node", ")", ";", "peer", ".", "sendMessage", "(", "message", ",", "unicast", ")", ";", "executor", ".", "submit", "(", "peer", ")", ";", "}", "if", "(", "nodes", ".", "isEmpty", "(", ")", ")", "{", "if", "(", "message", "instanceof", "LineMessage", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "receive", "(", "Message", ".", "NOT_FOUND", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "return", ";", "}", "broadcastPeer", ".", "sendMessage", "(", "message", ",", "nodes", ",", "unicast", ")", ";", "if", "(", "!", "unicast", ")", "executor", ".", "submit", "(", "broadcastPeer", ")", ";", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "void", "messageReceived", "(", "MessagePacket", "packet", ")", "{", "if", "(", "!", "getCluster", "(", ")", ".", "isMaster", "(", ")", ")", "return", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "packet", ")", ";", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "packet", ".", "setTimestamp", "(", "now", ")", ";", "final", "short", "node", "=", "packet", ".", "getNode", "(", ")", ";", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "node", ")", ";", "if", "(", "peer", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "node", ")", ";", "try", "{", "peer", ".", "receivePacket", "(", "packet", ")", ";", "}", "catch", "(", "InterruptedException", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "nodeAdded", "(", "short", "id", ")", "{", "super", ".", "nodeAdded", "(", "id", ")", ";", "if", "(", "id", "=", "=", "0", ")", "return", ";", "if", "(", "peers", ".", "get", "(", "id", ")", "!", "=", "null", ")", "return", ";", "final", "NodePeer", "peer", "=", "new", "NodePeer", "(", "id", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "peer", ",", "id", ")", ";", "peer", ".", "setAddress", "(", "getNodeAddress", "(", "id", ")", ")", ";", "peers", ".", "put", "(", "id", ",", "peer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "nodeSwitched", "(", "short", "id", ")", "{", "super", ".", "nodeSwitched", "(", "id", ")", ";", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "id", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "peer", ")", ";", "peer", ".", "setAddress", "(", "getNodeAddress", "(", "id", ")", ")", ";", "executor", ".", "submit", "(", "peer", ")", ";", "executor", ".", "submit", "(", "broadcastPeer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "nodeRemoved", "(", "short", "id", ")", "{", "super", ".", "nodeRemoved", "(", "id", ")", ";", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "id", ")", ";", "if", "(", "peer", "!", "=", "null", ")", "peer", ".", "removed", "(", ")", ";", "peers", ".", "remove", "(", "id", ")", ";", "broadcastPeer", ".", "removeNode", "(", "id", ")", ";", "}", "</s>"]
["<s>", "public", "void", "sendMessage", "(", "Message", "message", ")", "throws", "InterruptedException", "{", "if", "(", "!", "queue", ".", "offer", "(", "message", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "this", ")", ";", "queue", ".", "put", "(", "message", ")", ";", "}", "}", "</s>"]
["<s>", "public", "int", "getQueueLength", "(", ")", "{", "return", "queue", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "forceResend", "(", ")", "{", "this", ".", "lastSent", "=", "0", ";", "this", ".", "nextSend", "=", "0", ";", "this", ".", "delayMultiplier", "=", "0", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isTimeToResned", "(", "long", "now", ")", "{", "if", "(", "now", ">", "nextSend", ")", "{", "nextSend", "=", "Long", ".", "MAX_VALUE", ";", "lastSent", "=", "now", ";", "return", "true", ";", "}", "else", "return", "false", ";", "}", "</s>"]
["<s>", "protected", "void", "resendIn", "(", "long", "now", ",", "long", "delay", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "delay", ")", ";", "nextSend", "=", "now", "+", "delay", ";", "executor", ".", "schedule", "(", "this", ",", "delay", ",", "NANOSECONDS", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "resend", "(", "long", "now", ")", "{", "long", "delay", "=", "resendPeriodNanos", "<", "<", "delayMultiplier", ";", "if", "(", "exponentialBackoff", ")", "delayMultiplier", "+", "+", ";", "if", "(", "jitter", ")", "delay", "=", "randInterval", "(", "delay", ")", ";", "resendIn", "(", "now", ",", "delay", ")", ";", "}", "</s>"]
["<s>", "protected", "long", "getLastSent", "(", ")", "{", "return", "lastSent", ";", "}", "</s>"]
["<s>", "protected", "void", "addTimeout", "(", "Message", "message", ")", "{", "timeouts", ".", "add", "(", "message", ")", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isTimeout", "(", "Message", "response", ")", "{", "return", "timeouts", ".", "remove", "(", "response", ")", ";", "}", "</s>"]
["<s>", "protected", "synchronized", "void", "cleanupTimeouts", "(", "long", "now", ")", "{", "if", "(", "now", "-", "lastTimeoutsCleanup", ">", "=", "NANOSECONDS", ".", "convert", "(", "<NUM_LIT:10>", ",", "SECONDS", ")", ")", "{", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "timeouts", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "now", "-", "it", ".", "next", "(", ")", ".", "getTimestamp", "(", ")", ">", "=", "NANOSECONDS", ".", "convert", "(", "<NUM_LIT:10>", ",", "SECONDS", ")", ")", "it", ".", "remove", "(", ")", ";", "}", "lastTimeoutsCleanup", "=", "now", ";", "}", "}", "</s>"]
["<s>", "public", "NodePeer", "(", "short", "node", ")", "{", "this", ".", "node", "=", "node", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setAddress", "(", "InetSocketAddress", "nodeAddress", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "nodeAddress", ")", ";", "this", ".", "nodeAddress", "=", "nodeAddress", ";", "lastReceivedBroadcastId", "=", "0", ";", "if", "(", "sentPacket", "!", "=", "null", ")", "{", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "sentPacket", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Message", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "isResponse", "(", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "message", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "forceResend", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT:=>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", "+", "nodeAddress", "+", "\"", "<STR_LIT>", "\"", "+", "getLastSent", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "sentPacket", "+", "\"", "<STR_LIT>", "\"", "+", "pendingRequests", "+", "\"", "<STR_LIT>", "\"", "+", "overflow", "+", "\"", "<STR_LIT>", "\"", "+", "queue", "+", "\"", "<STR_LIT>", "\"", "+", "broadcast", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "public", "boolean", "isBroadcast", "(", ")", "{", "return", "broadcast", ";", "}", "</s>"]
["<s>", "public", "void", "unicastBroadcast", "(", ")", "{", "assert", "broadcast", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "broadcast", "=", "false", ";", "}", "</s>"]
["<s>", "public", "void", "removed", "(", ")", "{", "removed", "=", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "sendMessage", "(", "Message", "message", ")", "throws", "InterruptedException", "{", "synchronized", "(", "queue", ")", "{", "assignMessageId", "(", "message", ")", ";", "super", ".", "sendMessage", "(", "message", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "sendMessage", "(", "Message", "message", ",", "boolean", "unicastBroadcast", ")", "throws", "InterruptedException", "{", "if", "(", "unicastBroadcast", "&", "&", "message", ".", "isBroadcast", "(", ")", ")", "unicastBroadcasts", ".", "add", "(", "message", ")", ";", "sendMessage", "(", "message", ")", ";", "}", "</s>"]
["<s>", "void", "receivePacket", "(", "MessagePacket", "packet", ")", "throws", "InterruptedException", "{", "final", "List", "<", "Message", ">", "received", "=", "new", "ArrayList", "<", "Message", ">", "(", "packet", ".", "numMessages", "(", ")", ")", ";", "final", "List", "<", "Message", ">", "broadcastResponses", "=", "new", "ArrayList", "<", "Message", ">", "(", "packet", ".", "numMessages", "(", ")", ")", ";", "synchronized", "(", "this", ")", "{", "handleReceived", "(", "packet", ",", "received", ",", "broadcastResponses", ")", ";", "}", "for", "(", "Message", "message", ":", "broadcastResponses", ")", "broadcastPeer", ".", "receivedResponse", "(", "message", ",", "received", ")", ";", "recursive", ".", "set", "(", "Boolean", ".", "TRUE", ")", ";", "try", "{", "for", "(", "Message", "message", ":", "received", ")", "receive", "(", "message", ")", ";", "}", "finally", "{", "recursive", ".", "remove", "(", ")", ";", "}", "call", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "call", "(", ")", "throws", "InterruptedException", "{", "if", "(", "recursive", ".", "get", "(", ")", "=", "=", "Boolean", ".", "TRUE", ")", "return", "null", ";", "recursive", ".", "set", "(", "Boolean", ".", "TRUE", ")", ";", "try", "{", "if", "(", "removed", "|", "|", "getCluster", "(", ")", ".", "getMaster", "(", "node", ")", "=", "=", "null", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "return", "null", ";", "}", "final", "List", "<", "Message", ">", "received", "=", "new", "ArrayList", "<", "Message", ">", "(", ")", ";", "synchronized", "(", "this", ")", "{", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "handleTimeout", "(", "now", ",", "received", ")", ";", "handleQueue", "(", "now", ")", ";", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "sentPacket", ".", "isEmpty", "(", ")", ")", "sentPacket", "=", "null", ";", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "!", "broadcast", ")", "{", "if", "(", "isTimeToResned", "(", "now", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "sentPacket", ")", ";", "channel", ".", "write", "(", "sentPacket", ",", "nodeAddress", ")", ";", "if", "(", "hasRequests", ")", "resend", "(", "now", ")", ";", "}", "}", "}", "for", "(", "Message", "message", ":", "received", ")", "receive", "(", "message", ")", ";", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "return", "null", ";", "}", "finally", "{", "recursive", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleReceived", "(", "MessagePacket", "receivedPacket", ",", "List", "<", "Message", ">", "received", ",", "List", "<", "Message", ">", "broadcastResponses", ")", "{", "if", "(", "receivedPacket", "=", "=", "null", ")", "return", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "receivedPacket", ")", ";", "boolean", "oobMulticast", "=", "false", ";", "if", "(", "receivedPacket", ".", "isMulticast", "(", ")", ")", "{", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "receivedPacket", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Message", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getMessageId", "(", ")", "<", "lastReceivedBroadcastId", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "message", ")", ";", "oobMulticast", "=", "true", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "if", "(", "receivedPacket", ".", "isEmpty", "(", ")", ")", "return", ";", "if", "(", "!", "oobMulticast", "&", "&", "sentPacket", "!", "=", "null", ")", "{", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "sentPacket", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Message", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "isResponse", "(", ")", "&", "&", "!", "receivedPacket", ".", "contains", "(", "message", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "message", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "for", "(", "Message", "message", ":", "receivedPacket", ")", "{", "message", ".", "setTimestamp", "(", "receivedPacket", ".", "getTimestamp", "(", ")", ")", ";", "if", "(", "message", ".", "isBroadcast", "(", ")", ")", "{", "if", "(", "message", ".", "getMessageId", "(", ")", ">", "lastReceivedBroadcastId", ")", "lastReceivedBroadcastId", "=", "message", ".", "getMessageId", "(", ")", ";", "}", "if", "(", "message", ".", "isResponse", "(", ")", ")", "{", "final", "Message", "request", "=", "(", "sentPacket", "!", "=", "null", "?", "sentPacket", ".", "getMessage", "(", "message", ")", ":", "null", ")", ";", "if", "(", "request", "=", "=", "null", "&", "&", "!", "(", "isTimeout", "(", "message", ")", "|", "|", "(", "broadcast", "&", "&", "broadcastPeer", ".", "isTimeout", "(", "message", ")", ")", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "message", ")", ";", "continue", ";", "}", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "this", ",", "message", ",", "request", "!", "=", "null", "?", "request", ":", "\"", "<STR_LIT>", "\"", "}", ")", ";", "if", "(", "request", "!", "=", "null", ")", "{", "if", "(", "request", ".", "isBroadcast", "(", ")", ")", "broadcastResponses", ".", "add", "(", "message", ")", ";", "sentPacket", ".", "removeMessage", "(", "message", ")", ";", "}", "}", "else", "{", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "sentPacket", ".", "contains", "(", "message", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "message", ")", ";", "continue", ";", "}", "if", "(", "pendingRequests", ".", "contains", "(", "message", ".", "getMessageId", "(", ")", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "message", ")", ";", "continue", ";", "}", "else", "pendingRequests", ".", "add", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "}", "if", "(", "message", ".", "getType", "(", ")", "=", "=", "Message", ".", "Type", ".", "ACK", ")", "continue", ";", "received", ".", "add", "(", "message", ")", ";", "if", "(", "!", "message", ".", "isResponse", "(", ")", "&", "&", "!", "message", ".", "isReplyRequired", "(", ")", ")", "{", "if", "(", "!", "queue", ".", "offer", "(", "Message", ".", "ACK", "(", "message", ")", ")", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "}", "if", "(", "sentPacket", "!", "=", "null", ")", "{", "forceResend", "(", ")", ";", "if", "(", "sentPacket", ".", "isEmpty", "(", ")", ")", "{", "sentPacket", "=", "null", ";", "broadcast", "=", "false", ";", "hasRequests", "=", "false", ";", "requestsOnly", "=", "true", ";", "}", "else", "{", "boolean", "_hasRequests", "=", "false", ";", "boolean", "_requestsOnly", "=", "true", ";", "boolean", "_broadcast", "=", "true", ";", "for", "(", "Message", "message", ":", "sentPacket", ")", "{", "if", "(", "message", ".", "isResponse", "(", ")", ")", "_requestsOnly", "=", "false", ";", "else", "_hasRequests", "=", "true", ";", "if", "(", "!", "message", ".", "isBroadcast", "(", ")", ")", "_broadcast", "=", "false", ";", "}", "hasRequests", "=", "_hasRequests", ";", "requestsOnly", "=", "_requestsOnly", ";", "if", "(", "!", "broadcast", "&", "&", "_broadcast", ")", "{", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "executor", ".", "submit", "(", "broadcastPeer", ")", ";", "}", "broadcast", "=", "_broadcast", ";", "}", "}", "}", "</s>"]
["<s>", "private", "void", "handleTimeout", "(", "long", "now", ",", "List", "<", "Message", ">", "received", ")", "{", "if", "(", "broadcast", "|", "|", "sentPacket", "=", "=", "null", "|", "|", "sentPacket", ".", "isEmpty", "(", ")", ")", "return", ";", "final", "long", "timeoutNanos", "=", "NANOSECONDS", ".", "convert", "(", "getTimeout", "(", ")", ",", "MILLISECONDS", ")", ";", "for", "(", "Iterator", "<", "Message", ">", "it", "=", "sentPacket", ".", "reverseIterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "Message", "message", "=", "it", ".", "next", "(", ")", ";", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "INV", "&", "&", "now", "-", "message", ".", "getTimestamp", "(", ")", ">", "timeoutNanos", ")", "{", "if", "(", "message", ".", "isResponse", "(", ")", "|", "|", "message", ".", "isBroadcast", "(", ")", ")", "continue", ";", "if", "(", "message", "instanceof", "LineMessage", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "received", ".", "add", "(", "Message", ".", "TIMEOUT", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "it", ".", "remove", "(", ")", ";", "addTimeout", "(", "message", ")", ";", "}", "else", "break", ";", "}", "if", "(", "sentPacket", ".", "isEmpty", "(", ")", ")", "{", "sentPacket", "=", "null", ";", "broadcast", "=", "false", ";", "hasRequests", "=", "false", ";", "requestsOnly", "=", "true", ";", "}", "cleanupTimeouts", "(", "now", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "markAsTimeout", "(", "Message", "message", ")", "{", "if", "(", "sentPacket", ".", "removeMessage", "(", "message", ".", "getMessageId", "(", ")", ")", ")", "addTimeout", "(", "message", ")", ";", "}", "</s>"]
["<s>", "private", "synchronized", "void", "handleQueue", "(", "long", "start", ")", "throws", "InterruptedException", "{", "Message", "next", "=", "overflow", ";", "overflow", "=", "null", ";", "if", "(", "next", "=", "=", "null", ")", "next", "=", "queue", ".", "poll", "(", ")", ";", "for", "(", ";", ";", ")", "{", "if", "(", "next", "=", "=", "null", ")", "break", ";", "overflow", "=", "next", ";", "final", "boolean", "unicastBroadcast", "=", "next", ".", "isBroadcast", "(", ")", "&", "&", "unicastBroadcasts", ".", "remove", "(", "next", ")", ";", "if", "(", "broadcast", "&", "&", "(", "!", "next", ".", "isBroadcast", "(", ")", "|", "|", "unicastBroadcast", ")", ")", "break", ";", "if", "(", "!", "broadcast", "&", "&", "next", ".", "isBroadcast", "(", ")", "&", "&", "!", "unicastBroadcast", ")", "{", "if", "(", "sentPacket", "=", "=", "null", "|", "|", "sentPacket", ".", "isEmpty", "(", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "next", ")", ";", "broadcast", "=", "true", ";", "}", "}", "if", "(", "next", ".", "size", "(", ")", ">", "maxPacketSize", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "next", ",", "maxPacketSize", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "next", ".", "size", "(", ")", "+", "sentPacketSizeInBytes", "(", ")", ">", "maxPacketSize", ")", "{", "if", "(", "next", ".", "isResponse", "(", ")", "&", "&", "requestsOnly", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "next", ",", "sentPacket", ")", ";", "break", ";", "}", "if", "(", "!", "next", ".", "isResponse", "(", ")", ")", "{", "if", "(", "requestsOnly", "&", "&", "next", ".", "size", "(", ")", "+", "sentPacketSizeInBytes", "(", ")", ">", "maxRequestOnlyPacketSize", ")", "break", ";", "hasRequests", "=", "true", ";", "}", "else", "requestsOnly", "=", "false", ";", "if", "(", "next", ".", "isResponse", "(", ")", ")", "pendingRequests", ".", "remove", "(", "next", ".", "getMessageId", "(", ")", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "next", ")", ";", "if", "(", "sentPacket", "=", "=", "null", ")", "sentPacket", "=", "new", "MessagePacket", "(", ")", ";", "sentPacket", ".", "addMessage", "(", "next", ")", ";", "forceResend", "(", ")", ";", "overflow", "=", "null", ";", "if", "(", "broadcast", ")", "{", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "this", ")", ";", "executor", ".", "submit", "(", "broadcastPeer", ")", ";", "}", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "if", "(", "(", "now", "-", "start", "+", "minDelayNanos", ")", ">", "maxDelayNanos", ")", "break", ";", "next", "=", "queue", ".", "poll", "(", "minDelayNanos", ",", "NANOSECONDS", ")", ";", "}", "}", "</s>"]
["<s>", "private", "int", "sentPacketSizeInBytes", "(", ")", "{", "return", "sentPacket", "!", "=", "null", "?", "sentPacket", ".", "sizeInBytes", "(", ")", ":", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "multicastGroup", "+", "\"", "<STR_LIT>", "\"", "+", "getLastSent", "(", ")", "+", "\"", "<STR_LIT>", "\"", "+", "sentPacket", "+", "\"", "<STR_LIT>", "\"", "+", "overflow", "+", "\"", "<STR_LIT>", "\"", "+", "queue", "+", "<CHAR_LIT:}>", ";", "}", "</s>"]
["<s>", "public", "void", "sendMessage", "(", "Message", "message", ",", "TShortHashSet", "nodes", ",", "boolean", "unicast", ")", "throws", "InterruptedException", "{", "broadcasts", ".", "put", "(", "message", ".", "getMessageId", "(", ")", ",", "new", "BroadcastEntry", "(", "message", ",", "nodes", ")", ")", ";", "if", "(", "!", "unicast", ")", "sendMessage", "(", "message", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "call", "(", ")", "throws", "InterruptedException", "{", "final", "List", "<", "Message", ">", "received", "=", "new", "ArrayList", "<", "Message", ">", "(", ")", ";", "synchronized", "(", "this", ")", "{", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "handleTimeout", "(", "now", ",", "received", ")", ";", "handleQueue", "(", "now", ")", ";", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "sentPacket", ".", "isEmpty", "(", ")", ")", "sentPacket", "=", "null", ";", "if", "(", "isTimeToResned", "(", "now", ")", ")", "{", "if", "(", "sentPacket", "!", "=", "null", ")", "{", "assert", "!", "sendToServerInsteadOfMulticast", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "sentPacket", ")", ";", "channel", ".", "write", "(", "sentPacket", ",", "multicastGroup", ")", ";", "resend", "(", "now", ")", ";", "}", "else", "if", "(", "!", "broadcasts", ".", "isEmpty", "(", ")", ")", "{", "executor", ".", "schedule", "(", "this", ",", "getTimeout", "(", ")", ",", "MILLISECONDS", ")", ";", "}", "}", "}", "for", "(", "Message", "message", ":", "received", ")", "receive", "(", "message", ")", ";", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "</s>"]
["<s>", "private", "void", "handleQueue", "(", "long", "start", ")", "throws", "InterruptedException", "{", "Message", "next", "=", "overflow", ";", "overflow", "=", "null", ";", "if", "(", "next", "=", "=", "null", ")", "next", "=", "queue", ".", "poll", "(", ")", ";", "loop", ":", "for", "(", ";", ";", ")", "{", "if", "(", "next", "=", "=", "null", ")", "break", ";", "overflow", "=", "next", ";", "if", "(", "next", ".", "size", "(", ")", ">", "maxPacketSize", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "next", ",", "maxPacketSize", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "next", ".", "size", "(", ")", "+", "sentPacket", ".", "sizeInBytes", "(", ")", ">", "maxPacketSize", ")", "break", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "next", ")", ";", "BroadcastEntry", "entry", "=", "broadcasts", ".", "get", "(", "next", ".", "getMessageId", "(", ")", ")", ";", "if", "(", "entry", "!", "=", "null", ")", "{", "if", "(", "entry", ".", "nodes", ".", "isEmpty", "(", ")", ")", "{", "broadcasts", ".", "remove", "(", "next", ".", "getMessageId", "(", ")", ")", ";", "if", "(", "next", "instanceof", "LineMessage", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "next", ")", ";", "receive", "(", "Message", ".", "NOT_FOUND", "(", "(", "LineMessage", ")", "next", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "entry", "=", "null", ";", "}", "}", "if", "(", "entry", "!", "=", "null", ")", "{", "for", "(", "TShortIterator", "it", "=", "entry", ".", "nodes", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "short", "node", "=", "it", ".", "next", "(", ")", ";", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "node", ")", ";", "synchronized", "(", "peer", ")", "{", "if", "(", "!", "(", "peer", ".", "isBroadcast", "(", ")", "&", "&", "peer", ".", "sentPacket", ".", "contains", "(", "next", ".", "getMessageId", "(", ")", ")", ")", ")", "{", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "peer", ")", ";", "break", "loop", ";", "}", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "peer", ",", "next", ")", ";", "}", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "next", ")", ";", "if", "(", "sentPacket", "=", "=", "null", ")", "sentPacket", "=", "new", "MessagePacket", "(", ")", ";", "sentPacket", ".", "addMessage", "(", "next", ")", ";", "forceResend", "(", ")", ";", "}", "overflow", "=", "null", ";", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "if", "(", "maxDelayNanos", ">", "(", "now", "-", "start", "+", "minDelayNanos", ")", ")", "break", ";", "next", "=", "queue", ".", "poll", "(", "minDelayNanos", ",", "NANOSECONDS", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "handleTimeout", "(", "long", "now", ",", "List", "<", "Message", ">", "received", ")", "{", "if", "(", "broadcasts", ".", "isEmpty", "(", ")", ")", "return", ";", "final", "long", "timeoutNanos", "=", "NANOSECONDS", ".", "convert", "(", "getTimeout", "(", ")", ",", "MILLISECONDS", ")", ";", "for", "(", "Iterator", "<", "BroadcastEntry", ">", "it", "=", "broadcasts", ".", "values", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "BroadcastEntry", "entry", "=", "it", ".", "next", "(", ")", ";", "final", "Message", "message", "=", "entry", ".", "message", ";", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "INV", "&", "&", "now", "-", "message", ".", "getTimestamp", "(", ")", ">", "timeoutNanos", ")", "{", "if", "(", "message", "instanceof", "LineMessage", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "received", ".", "add", "(", "Message", ".", "TIMEOUT", "(", "(", "LineMessage", ")", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "it", ".", "remove", "(", ")", ";", "releasePeers", "(", "entry", ",", "(", "short", ")", "-", "1", ")", ";", "addTimeout", "(", "message", ")", ";", "if", "(", "sentPacket", "!", "=", "null", ")", "sentPacket", ".", "removeMessage", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "}", "}", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "sentPacket", ".", "isEmpty", "(", ")", ")", "sentPacket", "=", "null", ";", "cleanupTimeouts", "(", "now", ")", ";", "}", "</s>"]
["<s>", "public", "void", "receivedResponse", "(", "Message", "message", ",", "List", "<", "Message", ">", "received", ")", "{", "final", "BroadcastEntry", "entry", "=", "broadcasts", ".", "get", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "if", "(", "entry", "=", "=", "null", ")", "return", ";", "synchronized", "(", "this", ")", "{", "boolean", "done", "=", "entry", ".", "removeNode", "(", "message", ".", "getNode", "(", ")", ")", ";", "if", "(", "message", ".", "getType", "(", ")", "!", "=", "Message", ".", "Type", ".", "ACK", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ")", ";", "if", "(", "!", "done", ")", "releasePeers", "(", "entry", ",", "message", ".", "getNode", "(", ")", ")", ";", "done", "=", "true", ";", "}", "else", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ".", "getNode", "(", ")", ",", "entry", ".", "message", ")", ";", "final", "int", "numNodes", "=", "entry", ".", "nodes", ".", "size", "(", ")", ";", "if", "(", "done", ")", "{", "if", "(", "entry", ".", "message", "instanceof", "LineMessage", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "entry", ".", "message", ")", ";", "received", ".", "add", "(", "Message", ".", "NOT_FOUND", "(", "(", "LineMessage", ")", "entry", ".", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "}", "}", "else", "if", "(", "numNodes", "<", "minimumNodesToMulticast", "&", "&", "(", "numNodes", "+", "1", ")", ">", "=", "minimumNodesToMulticast", ")", "{", "if", "(", "sentPacket", "!", "=", "null", ")", "sentPacket", ".", "removeMessage", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "final", "long", "now", "=", "System", ".", "nanoTime", "(", ")", ";", "final", "long", "sinceLastSent", "=", "now", "-", "getLastSent", "(", ")", ";", "long", "delay", "=", "resendPeriodNanos", "-", "sinceLastSent", ";", "delay", "=", "(", "delay", ">", "=", "0", "?", "delay", ":", "0", ")", ";", "for", "(", "TShortIterator", "it", "=", "entry", ".", "nodes", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "it", ".", "next", "(", ")", ")", ";", "if", "(", "peer", ".", "isBroadcast", "(", ")", ")", "{", "peer", ".", "unicastBroadcast", "(", ")", ";", "peer", ".", "forceResend", "(", ")", ";", "peer", ".", "resendIn", "(", "now", ",", "delay", ")", ";", "executor", ".", "submit", "(", "peer", ")", ";", "}", "}", "}", "}", "if", "(", "done", ")", "{", "if", "(", "sentPacket", "!", "=", "null", ")", "sentPacket", ".", "removeMessage", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "broadcasts", ".", "remove", "(", "message", ".", "getMessageId", "(", ")", ")", ";", "}", "if", "(", "sentPacket", "!", "=", "null", "&", "&", "sentPacket", ".", "isEmpty", "(", ")", ")", "sentPacket", "=", "null", ";", "}", "}", "</s>"]
["<s>", "private", "void", "releasePeers", "(", "BroadcastEntry", "entry", ",", "short", "node", ")", "{", "final", "Message", "message", "=", "entry", ".", "message", ";", "for", "(", "TShortIterator", "it", "=", "entry", ".", "nodes", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "final", "NodePeer", "peer", "=", "peers", ".", "get", "(", "it", ".", "next", "(", ")", ")", ";", "if", "(", "peer", ".", "isBroadcast", "(", ")", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "peer", ",", "message", ")", ";", "if", "(", "peer", ".", "node", "!", "=", "node", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "peer", ")", ";", "peer", ".", "markAsTimeout", "(", "message", ")", ";", "}", "peer", ".", "unicastBroadcast", "(", ")", ";", "executor", ".", "submit", "(", "peer", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "void", "removeNode", "(", "short", "node", ")", "{", "synchronized", "(", "this", ")", "{", "for", "(", "Iterator", "<", "Map", ".", "Entry", "<", "Long", ",", "BroadcastEntry", ">", ">", "it", "=", "broadcasts", ".", "entrySet", "(", ")", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "BroadcastEntry", "entry", "=", "it", ".", "next", "(", ")", ".", "getValue", "(", ")", ";", "if", "(", "entry", ".", "removeNode", "(", "node", ")", "&", "&", "entry", ".", "message", "instanceof", "LineMessage", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "entry", ".", "message", ")", ";", "receive", "(", "Message", ".", "NOT_FOUND", "(", "(", "LineMessage", ")", "entry", ".", "message", ")", ".", "setIncoming", "(", ")", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "public", "BroadcastEntry", "(", "Message", "message", ",", "TShortHashSet", "nodes", ")", "{", "this", ".", "message", "=", "message", ";", "this", ".", "nodes", "=", "nodes", ";", "this", ".", "nodes", ".", "remove", "(", "Comm", ".", "SERVER", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "message", ",", "this", ".", "nodes", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "addNode", "(", "short", "node", ")", "{", "nodes", ".", "add", "(", "node", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "removeNode", "(", "short", "node", ")", "{", "nodes", ".", "remove", "(", "node", ")", ";", "return", "nodes", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "private", "int", "getNumPeerNodes", "(", ")", "{", "return", "getCluster", "(", ")", ".", "getNodes", "(", ")", ".", "size", "(", ")", "-", "(", "getCluster", "(", ")", ".", "getNodes", "(", ")", ".", "contains", "(", "Comm", ".", "SERVER", ")", "?", "1", ":", "0", ")", "+", "1", ";", "}", "</s>"]
["<s>", "private", "static", "long", "randInterval", "(", "long", "expected", ")", "{", "return", "(", "long", ")", "randExp", "(", "<NUM_LIT:1.0>", "/", "expected", ")", ";", "}", "</s>"]
["<s>", "private", "static", "double", "randExp", "(", "double", "lambda", ")", "{", "return", "-", "Math", ".", "log", "(", "1", "-", "ThreadLocalRandom", ".", "current", "(", ")", ".", "nextDouble", "(", ")", ")", "/", "lambda", ";", "}", "</s>"]
["<s>", "BroadcastPeer", "getBroadcastPeer", "(", ")", "{", "return", "broadcastPeer", ";", "}", "</s>"]
["<s>", "ConcurrentMap", "<", "Short", ",", "NodePeer", ">", "getPeers", "(", ")", "{", "return", "peers", ";", "}", "</s>"]
["<s>", "public", "MasterNodesFilteringHandler", "(", "NodeAddressResolver", "<", "SocketAddress", ">", "addressHandler", ")", "{", "this", ".", "addressHandler", "=", "addressHandler", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "accept", "(", "ChannelHandlerContext", "ctx", ",", "ChannelEvent", "e", ",", "InetSocketAddress", "inetSocketAddress", ")", "throws", "Exception", "{", "final", "boolean", "res", "=", "addressHandler", ".", "getNodeId", "(", "inetSocketAddress", ")", ">", "=", "0", ";", "if", "(", "!", "res", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "ctx", ".", "getChannel", "(", ")", ")", ";", "return", "res", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleDownstream", "(", "ChannelHandlerContext", "ctx", ",", "ChannelEvent", "evt", ")", "throws", "Exception", "{", "if", "(", "!", "(", "evt", "instanceof", "MessageEvent", ")", ")", "{", "ctx", ".", "sendDownstream", "(", "evt", ")", ";", "return", ";", "}", "final", "MessageEvent", "e", "=", "(", "MessageEvent", ")", "evt", ";", "final", "Object", "originalMessage", "=", "e", ".", "getMessage", "(", ")", ";", "final", "Object", "encodedMessage", "=", "encode", "(", "ctx", ",", "e", ".", "getChannel", "(", ")", ",", "originalMessage", ")", ";", "if", "(", "originalMessage", "=", "=", "encodedMessage", ")", "ctx", ".", "sendDownstream", "(", "evt", ")", ";", "else", "if", "(", "encodedMessage", "!", "=", "null", ")", "ctx", ".", "sendDownstream", "(", "new", "DownstreamMessageEvent", "(", "ctx", ".", "getChannel", "(", ")", ",", "e", ".", "getFuture", "(", ")", ",", "encodedMessage", ",", "e", ".", "getRemoteAddress", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleUpstream", "(", "ChannelHandlerContext", "ctx", ",", "ChannelEvent", "evt", ")", "throws", "Exception", "{", "if", "(", "!", "(", "evt", "instanceof", "MessageEvent", ")", ")", "{", "ctx", ".", "sendUpstream", "(", "evt", ")", ";", "return", ";", "}", "final", "MessageEvent", "e", "=", "(", "MessageEvent", ")", "evt", ";", "final", "Object", "originalMessage", "=", "e", ".", "getMessage", "(", ")", ";", "final", "Object", "decodedMessage", "=", "decode", "(", "ctx", ",", "e", ".", "getChannel", "(", ")", ",", "originalMessage", ")", ";", "if", "(", "originalMessage", "=", "=", "decodedMessage", ")", "ctx", ".", "sendUpstream", "(", "evt", ")", ";", "else", "if", "(", "decodedMessage", "!", "=", "null", ")", "ctx", ".", "sendUpstream", "(", "new", "UpstreamMessageEvent", "(", "ctx", ".", "getChannel", "(", ")", ",", "decodedMessage", ",", "e", ".", "getRemoteAddress", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "Object", "encode", "(", "ChannelHandlerContext", "ctx", ",", "Channel", "channel", ",", "Object", "msg", ")", "throws", "Exception", ";", "</s>"]
["<s>", "protected", "abstract", "Object", "decode", "(", "ChannelHandlerContext", "ctx", ",", "Channel", "channel", ",", "Object", "msg", ")", "throws", "Exception", ";", "</s>"]
["<s>", "public", "UdpMessagePipelineFactory", "(", "Logger", "logger", ",", "ChannelNodeAddressResolver", "nodeResolver", ",", "Executor", "executor", ")", "{", "this", ".", "logger", "=", "logger", ";", "this", ".", "nodeResolver", "=", "nodeResolver", ";", "this", ".", "executor", "=", "executor", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "ChannelPipeline", "getPipeline", "(", ")", "throws", "Exception", "{", "final", "ChannelPipeline", "pipeline", "=", "Channels", ".", "pipeline", "(", ")", ";", "if", "(", "executor", "!", "=", "null", ")", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "ExecutionHandler", "(", "executor", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "LoggingHandler", "(", "logger", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "new", "MessagePacketCodec", "(", ")", ")", ";", "pipeline", ".", "addLast", "(", "\"", "<STR_LIT>", "\"", ",", "nodeResolver", ")", ";", "return", "pipeline", ";", "}", "</s>"]
["<s>", "public", "ChannelNodeAddressResolver", "(", "NodeAddressResolver", "<", "InetSocketAddress", ">", "addressResolver", ")", "{", "this", ".", "addressResolver", "=", "addressResolver", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "short", "getNodeId", "(", "ChannelHandlerContext", "ctx", ",", "SocketAddress", "address", ")", "{", "Short", "node", "=", "null", ";", "try", "{", "node", "=", "addressResolver", ".", "getNodeId", "(", "(", "InetSocketAddress", ")", "address", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "}", "if", "(", "node", "=", "=", "null", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "address", ")", ";", "return", "node", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InetAddress", "read", "(", "byte", "[", "]", "data", ")", "{", "try", "{", "final", "String", "strAddress", "=", "ReaderWriters", ".", "STRING", ".", "read", "(", "data", ")", ";", "return", "InetAddress", ".", "getByName", "(", "strAddress", ")", ";", "}", "catch", "(", "UnknownHostException", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "InetAddress", "value", ")", "{", "return", "ReaderWriters", ".", "STRING", ".", "write", "(", "value", ".", "getHostAddress", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "InetSocketAddress", "read", "(", "byte", "[", "]", "data", ")", "{", "final", "String", "strAddress", "=", "ReaderWriters", ".", "STRING", ".", "read", "(", "data", ")", ";", "final", "int", "index", "=", "strAddress", ".", "lastIndexOf", "(", "<CHAR_LIT::>", ")", ";", "final", "String", "host", "=", "strAddress", ".", "substring", "(", "0", ",", "index", ")", ";", "final", "int", "port", "=", "Integer", ".", "parseInt", "(", "strAddress", ".", "substring", "(", "index", "+", "1", ")", ")", ";", "return", "new", "InetSocketAddress", "(", "host", ",", "port", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "write", "(", "InetSocketAddress", "value", ")", "{", "return", "ReaderWriters", ".", "STRING", ".", "write", "(", "value", ".", "toString", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "IpConstants", "(", ")", "{", "}", "</s>"]
["<s>", "public", "ZooKeeperDistributedTree", "(", "CuratorFramework", "client", ")", "{", "this", ".", "client", "=", "client", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addListener", "(", "final", "String", "node", ",", "final", "Listener", "listener", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "listener", ",", "possiblyWithSequence", "(", "node", ")", ")", ";", "final", "MyWatcher", "watcher", "=", "new", "MyWatcher", "(", "listener", ",", "possiblyWithSequence", "(", "node", ")", ")", ";", "watcher", ".", "checkEphemeral", "(", ")", ";", "watcher", ".", "setChildren", "(", ")", ";", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "watcher", ")", ".", "forPath", "(", "watcher", ".", "path", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeListener", "(", "String", "node", ",", "Listener", "listener", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "listener", ")", ";", "removedListeners", ".", "add", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "create", "(", "String", "node", ",", "boolean", "ephemeral", ")", "{", "try", "{", "if", "(", "exists", "(", "node", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "possiblyWithSequence", "(", "node", ")", ")", ";", "return", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "ephemeral", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "\"", ",", "node", ")", ";", "if", "(", "ephemeral", ")", "{", "EphemeralChildren", "ec", "=", "null", ";", "final", "String", "parent", "=", "parent", "(", "node", ")", ";", "if", "(", "!", "exists", "(", "parent", ")", ")", "client", ".", "create", "(", ")", ".", "creatingParentsIfNeeded", "(", ")", ".", "withMode", "(", "CreateMode", ".", "EPHEMERAL", ")", ".", "forPath", "(", "parent", ")", ";", "else", "ec", "=", "getEphemeralChildren", "(", "parent", ")", ";", "if", "(", "ec", "!", "=", "null", "|", "|", "client", ".", "checkExists", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "parent", ")", ")", ".", "getEphemeralOwner", "(", ")", "!", "=", "0", ")", "{", "if", "(", "ec", "=", "=", "null", ")", "ec", "=", "new", "EphemeralChildren", "(", ")", ";", "ec", ".", "createChild", "(", "child", "(", "node", ")", ")", ";", "client", ".", "setData", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "parent", ")", ",", "ec", ".", "toByteArray", "(", ")", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "possiblyWithSequence", "(", "parent", ")", "+", "<CHAR_LIT:/>", "+", "child", "(", "node", ")", ")", ";", "return", ";", "}", "}", "client", ".", "create", "(", ")", ".", "creatingParentsIfNeeded", "(", ")", ".", "withMode", "(", "ephemeral", "?", "CreateMode", ".", "EPHEMERAL", ":", "CreateMode", ".", "PERSISTENT", ")", ".", "forPath", "(", "node", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "createEphemeralOrdered", "(", "String", "node", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "if", "(", "exists", "(", "node", ")", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "possiblyWithSequence", "(", "node", ")", ")", ";", "return", ";", "}", "String", "nameWithSequence", "=", "client", ".", "create", "(", ")", ".", "creatingParentsIfNeeded", "(", ")", ".", "withMode", "(", "CreateMode", ".", "EPHEMERAL_SEQUENTIAL", ")", ".", "forPath", "(", "node", "+", "<CHAR_LIT::>", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nameWithSequence", ")", ";", "putOrdered", "(", "node", ",", "nameWithSequence", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "exists", "(", "String", "node", ")", "{", "try", "{", "Stat", "stat", "=", "client", ".", "checkExists", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "node", ")", ")", ";", "final", "boolean", "exists", "=", "(", "stat", "!", "=", "null", ")", ";", "if", "(", "!", "exists", ")", "{", "EphemeralChildren", "ec", "=", "getEphemeralChildren", "(", "parent", "(", "node", ")", ")", ";", "if", "(", "ec", "!", "=", "null", ")", "return", "ec", ".", "hasChild", "(", "child", "(", "node", ")", ")", ";", "}", "return", "exists", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "set", "(", "String", "node", ",", "byte", "[", "]", "data", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "possiblyWithSequence", "(", "node", ")", ")", ";", "client", ".", "setData", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "node", ")", ",", "data", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "final", "EphemeralChildren", "ec", "=", "getEphemeralChildren", "(", "parent", "(", "node", ")", ")", ";", "if", "(", "ec", "!", "=", "null", ")", "{", "try", "{", "ec", ".", "setChildData", "(", "child", "(", "node", ")", ",", "data", ")", ";", "client", ".", "setData", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "parent", "(", "node", ")", ")", ",", "ec", ".", "toByteArray", "(", ")", ")", ";", "return", ";", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "}", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "get", "(", "String", "node", ")", "{", "try", "{", "return", "client", ".", "getData", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "node", ")", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "final", "EphemeralChildren", "ec", "=", "getEphemeralChildren", "(", "parent", "(", "node", ")", ")", ";", "if", "(", "ec", "!", "=", "null", ")", "return", "ec", ".", "getChildData", "(", "child", "(", "node", ")", ")", ";", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "String", "node", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "possiblyWithSequence", "(", "node", ")", ")", ";", "for", "(", "String", "child", ":", "getChildren1", "(", "node", ")", ")", "delete", "(", "correctForRoot", "(", "node", ")", "+", "<CHAR_LIT:/>", "+", "child", ")", ";", "client", ".", "delete", "(", ")", ".", "guaranteed", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "node", ")", ")", ";", "removeOrdered", "(", "node", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "final", "EphemeralChildren", "ec", "=", "getEphemeralChildren", "(", "parent", "(", "node", ")", ")", ";", "if", "(", "ec", "!", "=", "null", ")", "{", "try", "{", "ec", ".", "deleteChild", "(", "child", "(", "node", ")", ")", ";", "client", ".", "setData", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "parent", "(", "node", ")", ")", ",", "ec", ".", "toByteArray", "(", ")", ")", ";", "return", ";", "}", "catch", "(", "Exception", "e", ")", "{", "ex", "=", "e", ";", "}", "}", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "List", "<", "String", ">", "getChildren1", "(", "String", "node", ")", "throws", "Exception", "{", "List", "<", "String", ">", "unordered", "=", "client", ".", "getChildren", "(", ")", ".", "forPath", "(", "possiblyWithSequence", "(", "node", ")", ")", ";", "if", "(", "unordered", "=", "=", "null", "|", "|", "unordered", ".", "isEmpty", "(", ")", ")", "{", "final", "EphemeralChildren", "ec", "=", "getEphemeralChildren", "(", "node", ")", ";", "if", "(", "ec", "!", "=", "null", ")", "return", "ec", ".", "getChildren", "(", ")", ";", "}", "return", "orderedChildren", "(", "node", ",", "unordered", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "List", "<", "String", ">", "getChildren", "(", "String", "node", ")", "{", "try", "{", "return", "getChildren1", "(", "node", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "flush", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "print", "(", "String", "node", ",", "java", ".", "io", ".", "PrintStream", "out", ")", "{", "print", "(", "node", ",", "out", ",", "0", ")", ";", "out", ".", "print", "(", "<STR_LIT:\\n>", ")", ";", "}", "</s>"]
["<s>", "private", "void", "print", "(", "String", "node", ",", "java", ".", "io", ".", "PrintStream", "out", ",", "int", "indent", ")", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "indent", ";", "i", "+", "+", ")", "out", ".", "print", "(", "<CHAR_LIT>", ")", ";", "final", "String", "name", "=", "child", "(", "node", ")", ";", "out", ".", "append", "(", "<CHAR_LIT:/>", ")", ".", "append", "(", "name", "!", "=", "null", "?", "name", ":", "\"", "\"", ")", ";", "try", "{", "for", "(", "String", "child", ":", "getChildren1", "(", "node", ")", ")", "{", "out", ".", "print", "(", "<STR_LIT:\\n>", ")", ";", "print", "(", "correctForRoot", "(", "node", ")", "+", "<CHAR_LIT:/>", "+", "child", ",", "out", ",", "indent", "+", "<NUM_LIT:4>", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "}", "}", "</s>"]
["<s>", "public", "MyWatcher", "(", "Listener", "listener", ",", "String", "path", ")", "{", "this", ".", "listener", "=", "listener", ";", "this", ".", "path", "=", "path", ";", "}", "</s>"]
["<s>", "public", "void", "setChildren", "(", ")", "{", "try", "{", "List", "<", "String", ">", "cs", "=", "null", ";", "if", "(", "ephemeral", ")", "{", "ephemeralChildren", "=", "getEphemeralChildren", "(", "path", ")", ";", "if", "(", "ephemeralChildren", "!", "=", "null", ")", "cs", "=", "ephemeralChildren", ".", "getChildren", "(", ")", ";", "}", "else", "{", "if", "(", "client", ".", "checkExists", "(", ")", ".", "forPath", "(", "path", ")", "!", "=", "null", ")", "cs", "=", "client", ".", "getChildren", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "path", ")", ";", "}", "if", "(", "cs", "=", "=", "null", ")", "return", ";", "children", "=", "new", "ArrayList", "<", "String", ">", "(", "cs", ")", ";", "Collections", ".", "sort", "(", "children", ")", ";", "for", "(", "String", "child", ":", "children", ")", "{", "try", "{", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "childrenWatcher", ")", ".", "forPath", "(", "correctForRoot", "(", "path", ")", "+", "<CHAR_LIT:/>", "+", "child", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "}", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "checkEphemeral", "(", ")", "{", "try", "{", "if", "(", "!", "created", ")", "{", "final", "Stat", "stat", "=", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "path", ")", ";", "if", "(", "stat", "!", "=", "null", ")", "{", "ephemeral", "=", "stat", ".", "getEphemeralOwner", "(", ")", "!", "=", "0", ";", "created", "=", "true", ";", "}", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "process", "(", "WatchedEvent", "event", ")", "{", "try", "{", "if", "(", "event", ".", "getPath", "(", ")", "!", "=", "null", ")", "{", "if", "(", "!", "removedListeners", ".", "remove", "(", "listener", ")", ")", "{", "if", "(", "event", ".", "getType", "(", ")", "=", "=", "Watcher", ".", "Event", ".", "EventType", ".", "NodeDataChanged", ")", "{", "assert", "path", ".", "equals", "(", "parent", "(", "event", ".", "getPath", "(", ")", ")", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", "(", "event", ".", "getPath", "(", ")", ")", ",", "event", ".", "getPath", "(", ")", ")", ";", "listener", ".", "nodeChildUpdated", "(", "path", ",", "child", "(", "nodeName", "(", "event", ".", "getPath", "(", ")", ")", ")", ")", ";", "}", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", ";", "}", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "process", "(", "WatchedEvent", "event", ")", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "event", ")", ";", "if", "(", "!", "removedListeners", ".", "remove", "(", "listener", ")", ")", "{", "final", "String", "node", "=", "nodeName", "(", "event", ".", "getPath", "(", ")", ")", ";", "switch", "(", "event", ".", "getType", "(", ")", ")", "{", "case", "NodeCreated", ":", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "event", ".", "getPath", "(", ")", ")", ";", "rememberIfOrdered", "(", "event", ".", "getPath", "(", ")", ")", ";", "listener", ".", "nodeAdded", "(", "node", ")", ";", "checkEphemeral", "(", ")", ";", "if", "(", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", "!", "=", "null", ")", "client", ".", "getChildren", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", ";", "break", ";", "case", "NodeDataChanged", ":", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "event", ".", "getPath", "(", ")", ")", ";", "if", "(", "ephemeral", ")", "{", "final", "EphemeralChildren", "ec", "=", "getEphemeralChildren", "(", "event", ".", "getPath", "(", ")", ")", ";", "if", "(", "ec", "!", "=", "null", ")", "{", "processChildrenChanged", "(", "event", ",", "node", ",", "ec", ".", "getChildren", "(", ")", ")", ";", "if", "(", "ephemeralChildren", "!", "=", "null", ")", "{", "for", "(", "Map", ".", "Entry", "<", "String", ",", "byte", "[", "]", ">", "entry", ":", "ephemeralChildren", ".", "getChildrenData", "(", ")", ".", "entrySet", "(", ")", ")", "{", "if", "(", "ec", ".", "hasChild", "(", "entry", ".", "getKey", "(", ")", ")", "&", "&", "!", "Arrays", ".", "equals", "(", "entry", ".", "getValue", "(", ")", ",", "ec", ".", "getChildData", "(", "entry", ".", "getKey", "(", ")", ")", ")", ")", "listener", ".", "nodeChildUpdated", "(", "node", ",", "entry", ".", "getKey", "(", ")", ")", ";", "}", "listener", ".", "nodeUpdated", "(", "node", ")", ";", "}", "else", "{", "if", "(", "ec", ".", "getData", "(", ")", "!", "=", "null", ")", "listener", ".", "nodeUpdated", "(", "node", ")", ";", "}", "}", "else", "{", "if", "(", "ephemeralChildren", "!", "=", "null", ")", "{", "processChildrenChanged", "(", "event", ",", "node", ",", "new", "ArrayList", "<", "String", ">", "(", ")", ")", ";", "if", "(", "ephemeralChildren", ".", "getData", "(", ")", "!", "=", "null", ")", "listener", ".", "nodeUpdated", "(", "node", ")", ";", "}", "}", "ephemeralChildren", "=", "ec", ";", "}", "else", "listener", ".", "nodeUpdated", "(", "node", ")", ";", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", ";", "break", ";", "case", "NodeDeleted", ":", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "event", ".", "getPath", "(", ")", ")", ";", "listener", ".", "nodeDeleted", "(", "node", ")", ";", "removeOrdered", "(", "node", ")", ";", "created", "=", "false", ";", "break", ";", "case", "NodeChildrenChanged", ":", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "event", ".", "getPath", "(", ")", ")", ";", "List", "<", "String", ">", "newChildren", "=", "Collections", ".", "emptyList", "(", ")", ";", "try", "{", "newChildren", "=", "new", "ArrayList", "<", "String", ">", "(", "client", ".", "getChildren", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", ")", ";", "}", "catch", "(", "KeeperException", ".", "NoNodeException", "e", ")", "{", "}", "processChildrenChanged", "(", "event", ",", "node", ",", "newChildren", ")", ";", "break", ";", "case", "None", ":", "try", "{", "if", "(", "event", ".", "getPath", "(", ")", "!", "=", "null", ")", "{", "if", "(", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", "!", "=", "null", ")", "client", ".", "getChildren", "(", ")", ".", "usingWatcher", "(", "this", ")", ".", "forPath", "(", "event", ".", "getPath", "(", ")", ")", ";", "}", "}", "catch", "(", "KeeperException", ".", "NoNodeException", "e", ")", "{", "}", "break", ";", "}", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "processChildrenChanged", "(", "WatchedEvent", "event", ",", "String", "node", ",", "List", "<", "String", ">", "newChildren", ")", "throws", "Exception", "{", "Collections", ".", "sort", "(", "newChildren", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "children", ",", "newChildren", ")", ";", "int", "i", "=", "0", ";", "int", "j", "=", "0", ";", "while", "(", "i", "<", "children", ".", "size", "(", ")", "|", "|", "j", "<", "newChildren", ".", "size", "(", ")", ")", "{", "String", "o", "=", "i", "<", "children", ".", "size", "(", ")", "?", "children", ".", "get", "(", "i", ")", ":", "null", ";", "String", "n", "=", "j", "<", "newChildren", ".", "size", "(", ")", "?", "newChildren", ".", "get", "(", "j", ")", ":", "null", ";", "final", "int", "c", ";", "if", "(", "o", "=", "=", "null", "&", "&", "n", "=", "=", "null", ")", "c", "=", "0", ";", "else", "if", "(", "o", "=", "=", "null", ")", "c", "=", "1", ";", "else", "if", "(", "n", "=", "=", "null", ")", "c", "=", "-", "1", ";", "else", "c", "=", "o", ".", "compareTo", "(", "n", ")", ";", "if", "(", "c", "=", "=", "0", ")", "{", "i", "+", "+", ";", "j", "+", "+", ";", "}", "else", "if", "(", "c", ">", "0", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", "(", "n", ")", ",", "n", ")", ";", "rememberIfOrdered", "(", "event", ".", "getPath", "(", ")", "+", "<CHAR_LIT:/>", "+", "n", ")", ";", "listener", ".", "nodeChildAdded", "(", "node", ",", "nodeName", "(", "n", ")", ")", ";", "if", "(", "!", "ephemeral", ")", "client", ".", "checkExists", "(", ")", ".", "usingWatcher", "(", "childrenWatcher", ")", ".", "forPath", "(", "correctForRoot", "(", "event", ".", "getPath", "(", ")", ")", "+", "<CHAR_LIT:/>", "+", "n", ")", ";", "j", "+", "+", ";", "}", "else", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "nodeName", "(", "o", ")", ",", "o", ")", ";", "listener", ".", "nodeChildDeleted", "(", "node", ",", "nodeName", "(", "o", ")", ")", ";", "removeOrdered", "(", "correctForRoot", "(", "node", ")", "+", "<CHAR_LIT:/>", "+", "nodeName", "(", "o", ")", ")", ";", "i", "+", "+", ";", "}", "}", "children", "=", "newChildren", ";", "}", "</s>"]
["<s>", "private", "List", "<", "String", ">", "orderedChildren", "(", "String", "parent", ",", "List", "<", "String", ">", "unordered", ")", "{", "final", "SortedMap", "<", "Long", ",", "String", ">", "sm", "=", "new", "TreeMap", "<", "Long", ",", "String", ">", "(", ")", ";", "final", "List", "<", "String", ">", "ordered", "=", "new", "ArrayList", "<", "String", ">", "(", "unordered", ".", "size", "(", ")", ")", ";", "for", "(", "String", "child", ":", "unordered", ")", "{", "if", "(", "isOrdered", "(", "child", ")", ")", "{", "final", "String", "name", "=", "getName", "(", "child", ")", ";", "sm", ".", "put", "(", "getSequence", "(", "child", ")", ",", "name", ")", ";", "putOrdered", "(", "parent", "+", "<CHAR_LIT:/>", "+", "name", ",", "parent", "+", "<CHAR_LIT:/>", "+", "child", ")", ";", "}", "else", "ordered", ".", "add", "(", "child", ")", ";", "}", "for", "(", "String", "child", ":", "sm", ".", "values", "(", ")", ")", "ordered", ".", "add", "(", "child", ")", ";", "return", "ordered", ";", "}", "</s>"]
["<s>", "private", "String", "possiblyWithSequence", "(", "String", "node", ")", "{", "final", "String", "nodeWithSequence", "=", "namesWithSequence", ".", "get", "(", "node", ")", ";", "return", "nodeWithSequence", "!", "=", "null", "?", "nodeWithSequence", ":", "node", ";", "}", "</s>"]
["<s>", "private", "void", "rememberIfOrdered", "(", "String", "node", ")", "{", "if", "(", "isOrdered", "(", "node", ")", ")", "putOrdered", "(", "getName", "(", "node", ")", ",", "node", ")", ";", "}", "</s>"]
["<s>", "private", "void", "putOrdered", "(", "String", "node", ",", "String", "nodeWithSeq", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ",", "nodeWithSeq", ")", ";", "namesWithSequence", ".", "put", "(", "node", ",", "nodeWithSeq", ")", ";", "}", "</s>"]
["<s>", "private", "void", "removeOrdered", "(", "String", "node", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "node", ")", ";", "namesWithSequence", ".", "remove", "(", "node", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "nodeName", "(", "String", "node", ")", "{", "return", "isOrdered", "(", "node", ")", "?", "getName", "(", "node", ")", ":", "node", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "isOrdered", "(", "String", "node", ")", "{", "if", "(", "node", "=", "=", "null", ")", "return", "false", ";", "return", "ORDERED_NODE", ".", "matcher", "(", "node", ")", ".", "matches", "(", ")", ";", "}", "</s>"]
["<s>", "private", "static", "String", "getName", "(", "String", "node", ")", "{", "return", "node", ".", "substring", "(", "0", ",", "node", ".", "lastIndexOf", "(", "<CHAR_LIT::>", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "long", "getSequence", "(", "String", "node", ")", "{", "return", "Long", ".", "parseLong", "(", "node", ".", "substring", "(", "node", ".", "lastIndexOf", "(", "<CHAR_LIT::>", ")", "+", "1", ")", ")", ";", "}", "</s>"]
["<s>", "private", "EphemeralChildren", "getEphemeralChildren", "(", "String", "node", ")", "{", "try", "{", "if", "(", "node", "=", "=", "null", "|", "|", "node", ".", "isEmpty", "(", ")", "|", "|", "node", ".", "equals", "(", "\"", "<STR_LIT:/>", "\"", ")", ")", "return", "null", ";", "node", "=", "possiblyWithSequence", "(", "node", ")", ";", "final", "Stat", "stat", "=", "client", ".", "checkExists", "(", ")", ".", "forPath", "(", "node", ")", ";", "if", "(", "stat", "=", "=", "null", ")", "return", "null", ";", "else", "if", "(", "stat", ".", "getEphemeralOwner", "(", ")", "=", "=", "0", ")", "return", "null", ";", "byte", "[", "]", "buffer", "=", "client", ".", "getData", "(", ")", ".", "forPath", "(", "node", ")", ";", "if", "(", "buffer", "=", "=", "null", "|", "|", "buffer", ".", "length", "=", "=", "0", ")", "return", "null", ";", "return", "new", "EphemeralChildren", "(", "buffer", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "node", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "EphemeralChildren", "(", ")", "{", "}", "</s>"]
["<s>", "public", "EphemeralChildren", "(", "byte", "[", "]", "buffer", ")", "{", "fromByteArray", "(", "buffer", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setData", "(", "byte", "[", "]", "data", ")", "{", "if", "(", "data", "=", "=", "null", ")", "this", ".", "data", "=", "null", ";", "else", "this", ".", "data", "=", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "byte", "[", "]", "getData", "(", ")", "{", "return", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ";", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "hasChild", "(", "String", "child", ")", "{", "if", "(", "children", "=", "=", "null", ")", "return", "false", ";", "return", "children", ".", "containsKey", "(", "child", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "createChild", "(", "String", "child", ")", "{", "if", "(", "children", "=", "=", "null", ")", "children", "=", "new", "HashMap", "<", "String", ",", "byte", "[", "]", ">", "(", ")", ";", "children", ".", "put", "(", "child", ",", "null", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "deleteChild", "(", "String", "child", ")", "{", "if", "(", "children", "=", "=", "null", ")", "return", ";", "children", ".", "remove", "(", "child", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setChildData", "(", "String", "child", ",", "byte", "[", "]", "data", ")", "{", "if", "(", "children", "=", "=", "null", ")", "children", "=", "new", "HashMap", "<", "String", ",", "byte", "[", "]", ">", "(", ")", ";", "children", ".", "put", "(", "child", ",", "data", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "data", ",", "data", ".", "length", ")", ":", "null", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "byte", "[", "]", "getChildData", "(", "String", "child", ")", "{", "if", "(", "children", "=", "=", "null", "|", "|", "!", "children", ".", "containsKey", "(", "child", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "child", "+", "\"", "<STR_LIT>", "\"", ")", ";", "final", "byte", "[", "]", "d", "=", "children", ".", "get", "(", "child", ")", ";", "return", "d", "!", "=", "null", "?", "Arrays", ".", "copyOf", "(", "d", ",", "d", ".", "length", ")", ":", "null", ";", "}", "</s>"]
["<s>", "public", "synchronized", "List", "<", "String", ">", "getChildren", "(", ")", "{", "return", "children", "!", "=", "null", "?", "new", "ArrayList", "<", "String", ">", "(", "children", ".", "keySet", "(", ")", ")", ":", "null", ";", "}", "</s>"]
["<s>", "public", "synchronized", "Map", "<", "String", ",", "byte", "[", "]", ">", "getChildrenData", "(", ")", "{", "return", "children", "!", "=", "null", "?", "children", ":", "Collections", ".", "<", "String", ",", "byte", "[", "]", ">", "emptyMap", "(", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "byte", "[", "]", "toByteArray", "(", ")", "{", "try", "{", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", ")", ";", "final", "ObjectOutputStream", "oos", "=", "new", "ObjectOutputStream", "(", "baos", ")", ";", "if", "(", "data", "=", "=", "null", ")", "oos", ".", "writeInt", "(", "-", "1", ")", ";", "else", "{", "oos", ".", "writeShort", "(", "data", ".", "length", ")", ";", "oos", ".", "write", "(", "data", ")", ";", "}", "oos", ".", "writeObject", "(", "children", ")", ";", "oos", ".", "flush", "(", ")", ";", "baos", ".", "flush", "(", ")", ";", "return", "baos", ".", "toByteArray", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "void", "fromByteArray", "(", "byte", "[", "]", "array", ")", "{", "try", "{", "final", "ObjectInputStream", "ois", "=", "new", "ObjectInputStream", "(", "new", "ByteArrayInputStream", "(", "array", ")", ")", ";", "final", "int", "dataLen", "=", "ois", ".", "readInt", "(", ")", ";", "if", "(", "dataLen", "=", "=", "-", "1", ")", "data", "=", "null", ";", "else", "{", "data", "=", "new", "byte", "[", "dataLen", "]", ";", "ois", ".", "readFully", "(", "data", ")", ";", "}", "children", "=", "(", "Map", "<", "String", ",", "byte", "[", "]", ">", ")", "ois", ".", "readObject", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "catch", "(", "ClassNotFoundException", "e", ")", "{", "throw", "new", "AssertionError", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "ZooKeeperCluster", "(", "String", "name", ",", "short", "nodeId", ",", "String", "zkConnectString", ")", "throws", "Exception", "{", "super", "(", "name", ",", "nodeId", ")", ";", "this", ".", "zkConnectString", "=", "zkConnectString", ";", "}", "</s>"]
["<s>", "public", "void", "setConnectionTimeoutMs", "(", "int", "connectionTimeoutMs", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "connectionTimeoutMs", "=", "connectionTimeoutMs", ";", "}", "</s>"]
["<s>", "public", "void", "setRetryPolicy", "(", "RetryPolicy", "retryPolicy", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "retryPolicy", "=", "retryPolicy", ";", "}", "</s>"]
["<s>", "public", "void", "setSessionTimeoutMs", "(", "int", "sessionTimeoutMs", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "sessionTimeoutMs", "=", "sessionTimeoutMs", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "client", "=", "CuratorFrameworkFactory", ".", "newClient", "(", "zkConnectString", ",", "sessionTimeoutMs", ",", "connectionTimeoutMs", ",", "retryPolicy", ")", ";", "client", ".", "start", "(", ")", ";", "try", "{", "client", ".", "create", "(", ")", ".", "creatingParentsIfNeeded", "(", ")", ".", "withMode", "(", "CreateMode", ".", "PERSISTENT", ")", ".", "forPath", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "KeeperException", ".", "NodeExistsException", "e", ")", "{", "}", "myNodeName", "=", "child", "(", "client", ".", "create", "(", ")", ".", "creatingParentsIfNeeded", "(", ")", ".", "withMode", "(", "CreateMode", ".", "EPHEMERAL_SEQUENTIAL", ")", ".", "forPath", "(", "ROOT", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", ")", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "myNodeName", ",", "myId", ")", ";", "setName", "(", "myNodeName", ")", ";", "initRefIdCounter", "(", ")", ";", "final", "ZooKeeperDistributedTree", "tree", "=", "new", "ZooKeeperDistributedTree", "(", "client", ")", ";", "setControlTree", "(", "tree", ")", ";", "super", ".", "init", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "initRefIdCounter", "(", ")", "throws", "Exception", "{", "this", ".", "refIdCounter", "=", "new", "DistributedAtomicLong", "(", "client", ",", "REF_COUNTER", ",", "retryPolicy", ")", ";", "AtomicValue", "<", "Long", ">", "av", ";", "av", "=", "refIdCounter", ".", "increment", "(", ")", ";", "if", "(", "!", "av", ".", "succeeded", "(", ")", ")", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "refAllocationExecutor", ".", "submit", "(", "new", "Callable", "<", "Void", ">", "(", ")", "{", "@", "Override", "public", "Void", "call", "(", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "AtomicValue", "<", "Long", ">", "av", ";", "for", "(", ";", ";", ")", "{", "av", "=", "refIdCounter", ".", "get", "(", ")", ";", "if", "(", "av", ".", "succeeded", "(", ")", ")", "{", "if", "(", "av", ".", "postValue", "(", ")", ">", "=", "INITIAL_REF_ID", ")", "break", ";", "}", "else", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "av", ".", "postValue", "(", ")", ")", ";", "counterReady", "=", "true", ";", "refAllocatorSupport", ".", "fireCounterReady", "(", ")", ";", "return", "null", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "call", "(", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "try", "{", "AtomicValue", "<", "Long", ">", "av", ";", "for", "(", ";", ";", ")", "{", "av", "=", "refIdCounter", ".", "get", "(", ")", ";", "if", "(", "av", ".", "succeeded", "(", ")", ")", "{", "if", "(", "av", ".", "postValue", "(", ")", ">", "=", "INITIAL_REF_ID", ")", "break", ";", "}", "else", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "av", ".", "postValue", "(", ")", ")", ";", "counterReady", "=", "true", ";", "refAllocatorSupport", ".", "fireCounterReady", "(", ")", ";", "return", "null", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "shutdown", "(", ")", "{", "refAllocationExecutor", ".", "shutdownNow", "(", ")", ";", "client", ".", "close", "(", ")", ";", "super", ".", "shutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "boolean", "isMe", "(", "NodeInfoImpl", "node", ")", "{", "return", "myNodeName", ".", "equals", "(", "node", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "getUnderlyingResource", "(", ")", "{", "return", "client", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "lockRoot", "(", "int", "id", ")", "{", "try", "{", "final", "InterProcessMutex", "mutex", "=", "new", "InterProcessMutex", "(", "client", ",", "ROOT_LOCKS", "+", "<CHAR_LIT:/>", "+", "id", ")", ";", "mutex", ".", "acquire", "(", ")", ";", "return", "mutex", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "unlockRoot", "(", "Object", "lock", ")", "{", "try", "{", "final", "InterProcessMutex", "mutex", "=", "(", "InterProcessMutex", ")", "lock", ";", "mutex", ".", "release", "(", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "addRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", "{", "refAllocatorSupport", ".", "addRefAllocationsListener", "(", "listener", ")", ";", "if", "(", "counterReady", ")", "listener", ".", "counterReady", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeRefAllocationsListener", "(", "RefAllocationsListener", "listener", ")", "{", "refAllocatorSupport", ".", "addRefAllocationsListener", "(", "listener", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "setCounter", "(", "long", "initialValue", ")", "{", "initialValue", "=", "Math", ".", "max", "(", "initialValue", ",", "INITIAL_REF_ID", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "initialValue", ")", ";", "try", "{", "AtomicValue", "<", "Long", ">", "av", ";", "long", "id", "=", "0", ";", "for", "(", ";", ";", ")", "{", "av", "=", "refIdCounter", ".", "compareAndSet", "(", "id", ",", "initialValue", ")", ";", "if", "(", "av", ".", "succeeded", "(", ")", ")", "{", "assert", "av", ".", "postValue", "(", ")", "=", "=", "initialValue", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "initialValue", ")", ";", "return", "true", ";", "}", "else", "if", "(", "av", ".", "postValue", "(", ")", ">", "=", "initialValue", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "initialValue", ")", ";", "return", "false", ";", "}", "else", "id", "=", "av", ".", "preValue", "(", ")", ";", "Thread", ".", "sleep", "(", "<NUM_LIT>", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "allocateRefs", "(", "final", "int", "count", ")", "{", "refAllocationExecutor", ".", "submit", "(", "new", "Runnable", "(", ")", "{", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "count", ")", ";", "final", "AtomicValue", "<", "Long", ">", "av", "=", "refIdCounter", ".", "add", "(", "(", "long", ")", "count", ")", ";", "if", "(", "av", ".", "succeeded", "(", ")", ")", "refAllocatorSupport", ".", "fireRefsAllocated", "(", "av", ".", "preValue", "(", ")", ",", "count", ")", ";", "else", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "}", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "count", ")", ";", "final", "AtomicValue", "<", "Long", ">", "av", "=", "refIdCounter", ".", "add", "(", "(", "long", ")", "count", ")", ";", "if", "(", "av", ".", "succeeded", "(", ")", ")", "refAllocatorSupport", ".", "fireRefsAllocated", "(", "av", ".", "preValue", "(", ")", ",", "count", ")", ";", "else", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "SQLDB", "(", "String", "name", ",", "DataSource", "dataSource", ")", "{", "super", "(", "name", ")", ";", "this", ".", "dataSource", "=", "dataSource", ";", "}", "</s>"]
["<s>", "public", "void", "setPassword", "(", "String", "password", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "password", "=", "password", ";", "}", "</s>"]
["<s>", "public", "void", "setUsername", "(", "String", "username", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "username", "=", "username", ";", "}", "</s>"]
["<s>", "public", "void", "setSchema", "(", "String", "schema", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "schema", "=", "schema", ";", "}", "</s>"]
["<s>", "public", "void", "setTableName", "(", "String", "tableName", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "tableName", "=", "tableName", ";", "}", "</s>"]
["<s>", "public", "void", "setMaxItemSize", "(", "int", "maxItemSize", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "maxItemSize", "=", "maxItemSize", ";", "}", "</s>"]
["<s>", "public", "void", "setUseUpdateableCursors", "(", "boolean", "useUpdateableCursors", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "useUpdateableCursors", "=", "useUpdateableCursors", ";", "}", "</s>"]
["<s>", "public", "void", "setBigintType", "(", "String", "bigintType", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "bigintType", "=", "bigintType", ";", "}", "</s>"]
["<s>", "public", "void", "setVarbinaryType", "(", "String", "varbinaryType", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "varbinaryType", "=", "varbinaryType", ";", "}", "</s>"]
["<s>", "public", "void", "setSmallintType", "(", "String", "smallintType", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "smallintType", "=", "smallintType", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "dataSource", ")", ";", "if", "(", "username", "!", "=", "null", ")", "conn", "=", "dataSource", ".", "getConnection", "(", "username", ",", "password", ")", ";", "else", "conn", "=", "dataSource", ".", "getConnection", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ")", ";", "initDbTypes", "(", ")", ";", "this", ".", "table", "=", "schema", "+", "\"", "<STR_LIT:.>", "\"", "+", "tableName", ";", "initTable", "(", ")", ";", "initPreparedStatements", "(", ")", ";", "conn", ".", "setAutoCommit", "(", "false", ")", ";", "conn", ".", "setTransactionIsolation", "(", "Connection", ".", "TRANSACTION_READ_COMMITTED", ")", ";", "}", "</s>"]
["<s>", "private", "void", "initTable", "(", ")", "throws", "SQLException", "{", "try", "{", "Statement", "stmt", "=", "null", ";", "try", "{", "stmt", "=", "conn", ".", "createStatement", "(", ")", ";", "String", "createTable", "=", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "bigintType", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "smallintType", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "bigintType", "+", "\"", "<STR_LIT>", "\"", "+", "\"", "<STR_LIT>", "\"", "+", "createVarbinary", "(", "maxItemSize", ")", "+", "\"", "<STR_LIT:)>", "\"", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "createTable", ")", ";", "stmt", ".", "executeUpdate", "(", "createTable", ")", ";", "stmt", ".", "executeUpdate", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "finally", "{", "if", "(", "stmt", "!", "=", "null", ")", "stmt", ".", "close", "(", ")", ";", "}", "}", "catch", "(", "SQLException", "e", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "e", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "e", ".", "getMessage", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "initPreparedStatements", "(", ")", "throws", "SQLException", "{", "getMaxId", "(", ")", ";", "dump", "(", "null", ")", ";", "insert", "(", "0", ",", "(", "short", ")", "0", ",", "0", ",", "null", ",", "null", ")", ";", "read", "(", "0", ")", ";", "write", "(", "0", ",", "(", "short", ")", "0", ",", "0", ",", "null", ",", "null", ")", ";", "delete", "(", "0", ",", "null", ")", ";", "removeOwner", "(", "(", "short", ")", "0", ")", ";", "if", "(", "useUpdateableCursors", ")", "casOwnerUpdateableCursor", "(", "0", ",", "(", "short", ")", "0", ",", "(", "short", ")", "0", ")", ";", "else", "{", "casOwnerUpdate", "(", "0", ",", "(", "short", ")", "0", ",", "(", "short", ")", "0", ")", ";", "getOwner", "(", "0", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "initDbTypes", "(", ")", "throws", "SQLException", "{", "if", "(", "bigintType", "=", "=", "null", "|", "|", "smallintType", "=", "=", "null", "|", "|", "varbinaryType", "=", "=", "null", ")", "{", "final", "Map", "<", "Integer", ",", "String", ">", "types", "=", "new", "HashMap", "<", "Integer", ",", "String", ">", "(", ")", ";", "final", "DatabaseMetaData", "dmd", "=", "conn", ".", "getMetaData", "(", ")", ";", "final", "ResultSet", "rs", "=", "dmd", ".", "getTypeInfo", "(", ")", ";", "while", "(", "rs", ".", "next", "(", ")", ")", "{", "final", "int", "jdbcType", "=", "rs", ".", "getInt", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "String", "typeName", "=", "rs", ".", "getString", "(", "\"", "<STR_LIT>", "\"", ")", ";", "types", ".", "put", "(", "jdbcType", ",", "typeName", ")", ";", "}", "rs", ".", "close", "(", ")", ";", "if", "(", "bigintType", "=", "=", "null", ")", "bigintType", "=", "types", ".", "get", "(", "Types", ".", "BIGINT", ")", ";", "if", "(", "smallintType", "=", "=", "null", ")", "smallintType", "=", "types", ".", "get", "(", "Types", ".", "SMALLINT", ")", ";", "if", "(", "varbinaryType", "=", "=", "null", ")", "varbinaryType", "=", "types", ".", "get", "(", "Types", ".", "VARBINARY", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "bigintType", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "smallintType", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "varbinaryType", ")", ";", "}", "}", "</s>"]
["<s>", "private", "String", "createVarbinary", "(", "int", "size", ")", "{", "if", "(", "varbinaryType", ".", "contains", "(", "\"", "<STR_LIT>", "\"", ")", ")", "return", "varbinaryType", ".", "replace", "(", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT:(>", "\"", "+", "size", "+", "\"", "<STR_LIT:)>", "\"", ")", ";", "else", "return", "varbinaryType", "+", "\"", "<STR_LIT:(>", "\"", "+", "size", "+", "\"", "<STR_LIT:)>", "\"", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "{", "try", "{", "conn", ".", "close", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "beginTransaction", "(", ")", "{", "return", "TRANSACTION", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "commit", "(", "Object", "txn", ")", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "txn", "=", "=", "TRANSACTION", ";", "conn", ".", "commit", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "abort", "(", "Object", "txn", ")", "{", "try", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "assert", "txn", "=", "=", "TRANSACTION", ";", "conn", ".", "rollback", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "byte", "[", "]", "data", ",", "Object", "txn", ")", "{", "if", "(", "setLine", "=", "=", "null", ")", "{", "setLine", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "id", "+", "\"", "<STR_LIT>", "\"", "+", "version", "+", "\"", "<STR_LIT>", "\"", "+", "data", ".", "length", "+", "\"", "<STR_LIT>", "\"", ")", ";", "if", "(", "data", ".", "length", ">", "maxItemSize", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "data", ".", "length", ",", "maxItemSize", ")", ";", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "try", "{", "setLine", ".", "setLong", "(", "<NUM_LIT:3>", ",", "id", ")", ";", "setLine", ".", "setShort", "(", "<NUM_LIT:4>", ",", "owner", ")", ";", "setLine", ".", "setLong", "(", "1", ",", "version", ")", ";", "setLine", ".", "setBytes", "(", "<NUM_LIT:2>", ",", "data", ")", ";", "if", "(", "setLine", ".", "executeUpdate", "(", ")", "<", "1", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "id", ")", ";", "insert", "(", "id", ",", "(", "short", ")", "owner", ",", "version", ",", "data", ",", "txn", ")", ";", "}", "else", "if", "(", "txn", "=", "=", "null", ")", "conn", ".", "commit", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "MainMemoryEntry", "read", "(", "long", "id", ")", "{", "if", "(", "getLine", "=", "=", "null", ")", "{", "getLine", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", "null", ";", "}", "try", "{", "ResultSet", "rs", "=", "null", ";", "try", "{", "getLine", ".", "setLong", "(", "1", ",", "id", ")", ";", "rs", "=", "getLine", ".", "executeQuery", "(", ")", ";", "rs", ".", "next", "(", ")", ";", "final", "long", "version", "=", "rs", ".", "getLong", "(", "1", ")", ";", "final", "byte", "[", "]", "data", "=", "rs", ".", "getBytes", "(", "<NUM_LIT:2>", ")", ";", "conn", ".", "commit", "(", ")", ";", "return", "new", "MainMemoryEntry", "(", "version", ",", "data", ")", ";", "}", "finally", "{", "if", "(", "rs", "!", "=", "null", ")", "rs", ".", "close", "(", ")", ";", "}", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "casOwner", "(", "long", "id", ",", "short", "oldNode", ",", "short", "newNode", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "id", ",", "oldNode", ",", "newNode", "}", ")", ";", "try", "{", "if", "(", "oldNode", "<", "0", ")", "{", "try", "{", "insert", "(", "id", ",", "newNode", ",", "-", "1", ",", "null", ",", "null", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "newNode", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "getOwner", "(", "id", ")", ";", "}", "else", "{", "if", "(", "useUpdateableCursors", ")", "return", "casOwnerUpdateableCursor", "(", "id", ",", "oldNode", ",", "newNode", ")", ";", "else", "return", "casOwnerUpdate", "(", "id", ",", "oldNode", ",", "newNode", ")", ";", "}", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "short", "casOwnerUpdateableCursor", "(", "long", "id", ",", "short", "oldNode", ",", "short", "newNode", ")", "throws", "SQLException", "{", "if", "(", "casOwner", "=", "=", "null", ")", "{", "casOwner", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ",", "ResultSet", ".", "TYPE_FORWARD_ONLY", ",", "ResultSet", ".", "CONCUR_UPDATABLE", ")", ";", "return", "0", ";", "}", "ResultSet", "rs", "=", "null", ";", "try", "{", "final", "short", "res", ";", "casOwner", ".", "setLong", "(", "1", ",", "id", ")", ";", "rs", "=", "casOwner", ".", "executeQuery", "(", ")", ";", "if", "(", "rs", ".", "next", "(", ")", ")", "{", "final", "short", "currentOwner", "=", "rs", ".", "getShort", "(", "1", ")", ";", "if", "(", "currentOwner", "!", "=", "oldNode", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "res", "=", "currentOwner", ";", "}", "else", "{", "rs", ".", "updateShort", "(", "1", ",", "newNode", ")", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "res", "=", "newNode", ";", "}", "conn", ".", "commit", "(", ")", ";", "return", "res", ";", "}", "else", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "-", "1", ";", "}", "}", "finally", "{", "if", "(", "rs", "!", "=", "null", ")", "rs", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "short", "casOwnerUpdate", "(", "long", "id", ",", "short", "oldNode", ",", "short", "newNode", ")", "throws", "SQLException", "{", "if", "(", "casOwner", "=", "=", "null", ")", "{", "casOwner", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", "0", ";", "}", "final", "short", "res", ";", "casOwner", ".", "setLong", "(", "<NUM_LIT:2>", ",", "id", ")", ";", "casOwner", ".", "setShort", "(", "<NUM_LIT:3>", ",", "oldNode", ")", ";", "casOwner", ".", "setShort", "(", "1", ",", "newNode", ")", ";", "int", "rows", "=", "casOwner", ".", "executeUpdate", "(", ")", ";", "if", "(", "rows", ">", "0", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "res", "=", "newNode", ";", "}", "else", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "res", "=", "getOwner", "(", "id", ")", ";", "}", "conn", ".", "commit", "(", ")", ";", "return", "res", ";", "}", "</s>"]
["<s>", "private", "short", "getOwner", "(", "long", "id", ")", "throws", "SQLException", "{", "if", "(", "getOwner", "=", "=", "null", ")", "{", "getOwner", "=", "conn", ".", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", "0", ";", "}", "ResultSet", "rs", "=", "null", ";", "try", "{", "getOwner", ".", "setLong", "(", "1", ",", "id", ")", ";", "rs", "=", "getOwner", ".", "executeQuery", "(", ")", ";", "rs", ".", "next", "(", ")", ";", "final", "short", "res", "=", "rs", ".", "getShort", "(", "1", ")", ";", "conn", ".", "commit", "(", ")", ";", "return", "res", ";", "}", "finally", "{", "if", "(", "rs", "!", "=", "null", ")", "rs", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "insert", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "byte", "[", "]", "data", ",", "Object", "txn", ")", "throws", "SQLException", "{", "if", "(", "insertLine", "=", "=", "null", ")", "{", "insertLine", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "insertLine", ".", "setLong", "(", "1", ",", "id", ")", ";", "insertLine", ".", "setShort", "(", "<NUM_LIT:2>", ",", "owner", ")", ";", "insertLine", ".", "setLong", "(", "<NUM_LIT:3>", ",", "version", ")", ";", "insertLine", ".", "setBytes", "(", "<NUM_LIT:4>", ",", "data", ")", ";", "insertLine", ".", "executeUpdate", "(", ")", ";", "if", "(", "txn", "=", "=", "null", ")", "conn", ".", "commit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "long", "id", ",", "Object", "txn", ")", "{", "if", "(", "deleteLine", "=", "=", "null", ")", "{", "deleteLine", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "try", "{", "deleteLine", ".", "setLong", "(", "1", ",", "id", ")", ";", "deleteLine", ".", "executeUpdate", "(", ")", ";", "if", "(", "txn", "=", "=", "null", ")", "conn", ".", "commit", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeOwner", "(", "short", "node", ")", "{", "if", "(", "deleteOwner", "=", "=", "null", ")", "{", "deleteOwner", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", "+", "\"", "<STR_LIT>", "\"", ")", ";", "return", ";", "}", "try", "{", "deleteOwner", ".", "setShort", "(", "1", ",", "node", ")", ";", "deleteOwner", ".", "executeUpdate", "(", ")", ";", "conn", ".", "commit", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getMaxId", "(", ")", "{", "if", "(", "getMaxId", "=", "=", "null", ")", "{", "getMaxId", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", ")", ";", "return", "0", ";", "}", "ResultSet", "rs", "=", "null", ";", "try", "{", "rs", "=", "getMaxId", ".", "executeQuery", "(", ")", ";", "rs", ".", "next", "(", ")", ";", "final", "long", "res", "=", "rs", ".", "getLong", "(", "1", ")", ";", "conn", ".", "commit", "(", ")", ";", "return", "res", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "finally", "{", "try", "{", "if", "(", "rs", "!", "=", "null", ")", "rs", ".", "close", "(", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dump", "(", "PrintStream", "ps", ")", "{", "if", "(", "selectAll", "=", "=", "null", ")", "{", "selectAll", "=", "prepareStatement", "(", "\"", "<STR_LIT>", "\"", "+", "table", ")", ";", "return", ";", "}", "try", "{", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ResultSet", "rs", "=", "null", ";", "try", "{", "rs", "=", "selectAll", ".", "executeQuery", "(", ")", ";", "while", "(", "rs", ".", "next", "(", ")", ")", "{", "final", "long", "id", "=", "rs", ".", "getLong", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "short", "owner", "=", "rs", ".", "getShort", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "long", "version", "=", "rs", ".", "getLong", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "byte", "[", "]", "data", "=", "rs", ".", "getBytes", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "hex", "(", "id", ")", "+", "\"", "<STR_LIT>", "\"", "+", "owner", "+", "\"", "<STR_LIT>", "\"", "+", "version", "+", "\"", "<STR_LIT>", "\"", "+", "data", ".", "length", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "conn", ".", "commit", "(", ")", ";", "}", "finally", "{", "if", "(", "rs", "!", "=", "null", ")", "rs", ".", "close", "(", ")", ";", "}", "}", "catch", "(", "SQLException", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "PreparedStatement", "prepareStatement", "(", "String", "sql", ")", "{", "try", "{", "assertDuringInitialization", "(", ")", ";", "return", "conn", ".", "prepareStatement", "(", "sql", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "sql", ",", "e", ")", ";", "throw", "new", "Error", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "private", "PreparedStatement", "prepareStatement", "(", "String", "sql", ",", "int", "resultSetType", ",", "int", "resultSetConcurrency", ")", "{", "try", "{", "assertDuringInitialization", "(", ")", ";", "return", "conn", ".", "prepareStatement", "(", "sql", ",", "resultSetType", ",", "resultSetConcurrency", ")", ";", "}", "catch", "(", "SQLException", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "sql", ",", "e", ")", ";", "throw", "new", "Error", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "int", "getNumOpGet", "(", ")", ";", "</s>"]
["<s>", "float", "[", "]", "getOpHistogramGet", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOpGetS", "(", ")", ";", "</s>"]
["<s>", "float", "[", "]", "getOpHistogramGetS", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOpGetX", "(", ")", ";", "</s>"]
["<s>", "float", "[", "]", "getOpHistogramGetX", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOpSet", "(", ")", ";", "</s>"]
["<s>", "float", "[", "]", "getOpHistogramSet", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOpPut", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOpDel", "(", ")", ";", "</s>"]
["<s>", "int", "getNumOpSend", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedGET", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentGET", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedGETX", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentGETX", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedPUT", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentPUT", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedPUTX", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentPUTX", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedINV", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentINV", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedINVACK", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentINVACK", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedCHNGD_OWNR", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentCHNGD_OWNR", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedMSG", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentMSG", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesReceivedMSGACK", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesSentMSGACK", "(", ")", ";", "</s>"]
["<s>", "int", "getHits", "(", ")", ";", "</s>"]
["<s>", "int", "getStaleHits", "(", ")", ";", "</s>"]
["<s>", "int", "getMisses", "(", ")", ";", "</s>"]
["<s>", "int", "getInvalidates", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesDelayedDueLock", "(", ")", ";", "</s>"]
["<s>", "long", "getTotalMicrosecondDelayPerSecondDueLock", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesDelayedDueBackup", "(", ")", ";", "</s>"]
["<s>", "long", "getTotalMicrosecondDelayPerSecondDueBackup", "(", ")", ";", "</s>"]
["<s>", "int", "getNumMessagesDelayedDueOther", "(", ")", ";", "</s>"]
["<s>", "long", "getTotalMicrosecondDelayPerSecondDueOther", "(", ")", ";", "</s>"]
["<s>", "Map", "<", "Integer", ",", "Long", ">", "getBinsTotalMemory", "(", ")", ";", "</s>"]
["<s>", "Map", "<", "Integer", ",", "Integer", ">", "getBinsAllocated", "(", ")", ";", "</s>"]
["<s>", "Map", "<", "Integer", ",", "Integer", ">", "getBinsDeallocated", "(", ")", ";", "</s>"]
["<s>", "int", "getObjectsServed", "(", ")", ";", "</s>"]
["<s>", "int", "getOwnerWrites", "(", ")", ";", "</s>"]
["<s>", "int", "getOwnersServed", "(", ")", ";", "</s>"]
["<s>", "int", "getTransactions", "(", ")", ";", "</s>"]
["<s>", "int", "getWrites", "(", ")", ";", "</s>"]
["<s>", "public", "void", "reset", "(", ")", "{", "cat", ".", "set", "(", "0", ")", ";", "}", "</s>"]
["<s>", "public", "void", "inc", "(", ")", "{", "cat", ".", "increment", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "add", "(", "long", "val", ")", "{", "cat", ".", "add", "(", "val", ")", ";", "}", "</s>"]
["<s>", "public", "long", "get", "(", ")", "{", "return", "cat", ".", "get", "(", ")", ";", "}", "</s>"]
["<s>", "long", "getAvgServerAckTimeMicros", "(", ")", ";", "</s>"]
["<s>", "long", "getAvgSlavesAckTimeMicros", "(", ")", ";", "</s>"]
["<s>", "int", "getBackupPackets", "(", ")", ";", "</s>"]
["<s>", "int", "getBackups", "(", ")", ";", "</s>"]
["<s>", "int", "getReplicationBackups", "(", ")", ";", "</s>"]
["<s>", "boolean", "isUpdates", "(", ")", ";", "</s>"]
["<s>", "void", "setUpdates", "(", "boolean", "value", ")", ";", "</s>"]
["<s>", "void", "startUpdates", "(", ")", ";", "</s>"]
["<s>", "void", "stopUpdates", "(", ")", ";", "</s>"]
["<s>", "SortedMap", "<", "String", ",", "String", ">", "getMyNodeInfo", "(", ")", ";", "</s>"]
["<s>", "boolean", "isOnline", "(", ")", ";", "</s>"]
["<s>", "boolean", "isMaster", "(", ")", ";", "</s>"]
["<s>", "void", "shutdown", "(", ")", ";", "</s>"]
["<s>", "boolean", "hasServer", "(", ")", ";", "</s>"]
["<s>", "List", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "getNodes", "(", ")", ";", "</s>"]
["<s>", "SortedMap", "<", "String", ",", "String", ">", "getMyMaster", "(", ")", ";", "</s>"]
["<s>", "List", "<", "SortedMap", "<", "String", ",", "String", ">", ">", "getMySlaves", "(", ")", ";", "</s>"]
["<s>", "long", "getTotalMemory", "(", ")", ";", "</s>"]
["<s>", "int", "getAllocated", "(", ")", ";", "</s>"]
["<s>", "int", "getDeallocated", "(", ")", ";", "</s>"]
["<s>", "@", "ConstructorProperties", "(", "{", "\"", "<STR_LIT>", "\"", ",", "\"", "<STR_LIT>", "\"", "}", ")", "public", "BerkeleyDB", "(", "String", "name", ",", "String", "envHome", ")", "{", "super", "(", "name", ")", ";", "this", ".", "envHome", "=", "envHome", ";", "final", "EnvironmentConfig", "envConfig", "=", "new", "EnvironmentConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ";", "envConfig", ".", "setDurability", "(", "new", "Durability", "(", "durability", ",", "Durability", ".", "SyncPolicy", ".", "SYNC", ",", "Durability", ".", "ReplicaAckPolicy", ".", "SIMPLE_MAJORITY", ")", ")", ";", "this", ".", "env", "=", "new", "Environment", "(", "new", "File", "(", "envHome", ")", ",", "envConfig", ")", ";", "this", ".", "entryBinding", "=", "new", "MainMemoryTupleBinding", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setTruncate", "(", "boolean", "truncate", ")", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "truncate", "=", "truncate", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "boolean", "isTruncate", "(", ")", "{", "return", "truncate", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "-", "1", ",", "description", "=", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getEnvHome", "(", ")", "{", "return", "envHome", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "if", "(", "truncate", ")", "truncate", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "env", ".", "getHome", "(", ")", ")", ";", "this", ".", "ownerDirectory", "=", "env", ".", "openDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DatabaseConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ")", ";", "this", ".", "ownerIndex", "=", "env", ".", "openSecondaryDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "ownerDirectory", ",", "(", "(", "SecondaryConfig", ")", "(", "new", "SecondaryConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setSortedDuplicates", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ")", ")", ".", "setAllowPopulate", "(", "true", ")", ".", "setKeyCreator", "(", "new", "OwnerKeyCreator", "(", ")", ")", ")", ";", "PreloadConfig", "ownerDirectoryPreloadConfig", "=", "new", "PreloadConfig", "(", ")", ";", "this", ".", "ownerDirectory", ".", "preload", "(", "ownerDirectoryPreloadConfig", ")", ";", "this", ".", "mainStore", "=", "env", ".", "openDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "new", "DatabaseConfig", "(", ")", ".", "setAllowCreate", "(", "true", ")", ".", "setTransactional", "(", "true", ")", ")", ";", "if", "(", "!", "truncate", ")", "resetOwners", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "truncate", "(", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "env", ".", "getHome", "(", ")", ")", ";", "Transaction", "txn", "=", "env", ".", "beginTransaction", "(", "null", ",", "TransactionConfig", ".", "DEFAULT", ")", ";", "try", "{", "env", ".", "truncateDatabase", "(", "txn", ",", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "env", ".", "truncateDatabase", "(", "txn", ",", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "txn", ".", "commit", "(", ")", ";", "env", ".", "truncateDatabase", "(", "null", ",", "\"", "<STR_LIT>", "\"", ",", "false", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "txn", ".", "abort", "(", ")", ";", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "casOwner", "(", "long", "id", ",", "short", "oldNode", ",", "short", "newNode", ")", "{", "final", "DatabaseEntry", "key", "=", "new", "DatabaseEntry", "(", "Longs", ".", "toByteArray", "(", "id", ")", ")", ";", "final", "DatabaseEntry", "value", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "Transaction", "txn", "=", "env", ".", "beginTransaction", "(", "null", ",", "null", ")", ";", "try", "{", "OperationStatus", "status", ";", "value", ".", "setData", "(", "Shorts", ".", "toByteArray", "(", "newNode", ")", ")", ";", "if", "(", "oldNode", "<", "0", ")", "{", "status", "=", "ownerDirectory", ".", "putNoOverwrite", "(", "txn", ",", "key", ",", "value", ")", ";", "if", "(", "status", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "txn", ".", "commit", "(", ")", ";", "return", "newNode", ";", "}", "}", "status", "=", "ownerDirectory", ".", "get", "(", "txn", ",", "key", ",", "value", ",", "LockMode", ".", "RMW", ")", ";", "if", "(", "status", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "final", "short", "curOldNode", "=", "Shorts", ".", "fromByteArray", "(", "value", ".", "getData", "(", ")", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "hex", "(", "id", ")", ",", "curOldNode", ",", "oldNode", "}", ")", ";", "if", "(", "oldNode", "!", "=", "curOldNode", ")", "{", "assert", "curOldNode", ">", "=", "0", ";", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "txn", ".", "commit", "(", ")", ";", "return", "curOldNode", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "value", ".", "setData", "(", "Shorts", ".", "toByteArray", "(", "newNode", ")", ")", ";", "ownerDirectory", ".", "put", "(", "txn", ",", "key", ",", "value", ")", ";", "txn", ".", "commit", "(", ")", ";", "return", "newNode", ";", "}", "else", "if", "(", "status", "=", "=", "OperationStatus", ".", "NOTFOUND", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "txn", ".", "commit", "(", ")", ";", "return", "(", "short", ")", "-", "1", ";", "}", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ",", "status", ")", ";", "throw", "new", "AssertionError", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "txn", ".", "abort", "(", ")", ";", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "removeOwner", "(", "short", "node", ")", "{", "final", "boolean", "trace", "=", "LOG", ".", "isTraceEnabled", "(", ")", ";", "final", "Transaction", "txn", "=", "null", ";", "TLongArrayList", "lines", "=", "new", "TLongArrayList", "(", ")", ";", "final", "DatabaseEntry", "sKey", "=", "new", "DatabaseEntry", "(", "Shorts", ".", "toByteArray", "(", "node", ")", ")", ";", "final", "DatabaseEntry", "pKey", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "data", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "SecondaryCursor", "cursor", "=", "ownerIndex", ".", "openCursor", "(", "txn", ",", "null", ")", ";", "try", "{", "OperationStatus", "retVal", "=", "cursor", ".", "getSearchKey", "(", "sKey", ",", "pKey", ",", "data", ",", "LockMode", ".", "DEFAULT", ")", ";", "while", "(", "retVal", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "final", "long", "id", "=", "Longs", ".", "fromByteArray", "(", "pKey", ".", "getData", "(", ")", ")", ";", "if", "(", "trace", ")", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "id", ",", "node", ")", ";", "lines", ".", "add", "(", "id", ")", ";", "retVal", "=", "cursor", ".", "getNextDup", "(", "sKey", ",", "pKey", ",", "data", ",", "LockMode", ".", "DEFAULT", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "byte", "[", "]", "longArray", "=", "new", "byte", "[", "<NUM_LIT:8>", "]", ";", "for", "(", "TLongIterator", "it", "=", "lines", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "toByteArray", "(", "it", ".", "next", "(", ")", ",", "longArray", ")", ";", "pKey", ".", "setData", "(", "longArray", ")", ";", "ownerDirectory", ".", "put", "(", "null", ",", "pKey", ",", "SERVER", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "resetOwners", "(", ")", "{", "final", "boolean", "trace", "=", "LOG", ".", "isTraceEnabled", "(", ")", ";", "final", "DatabaseEntry", "key", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "data", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DiskOrderedCursor", "cursor", "=", "ownerDirectory", ".", "openCursor", "(", "new", "DiskOrderedCursorConfig", "(", ")", ".", "setKeysOnly", "(", "true", ")", ")", ";", "try", "{", "OperationStatus", "retVal", "=", "cursor", ".", "getNext", "(", "key", ",", "data", ",", "null", ")", ";", "while", "(", "retVal", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "if", "(", "trace", ")", "LOG", ".", "trace", "(", "\"", "<STR_LIT>", "\"", ",", "Longs", ".", "fromByteArray", "(", "key", ".", "getData", "(", ")", ")", ")", ";", "ownerDirectory", ".", "put", "(", "null", ",", "key", ",", "SERVER", ")", ";", "retVal", "=", "cursor", ".", "getNext", "(", "key", ",", "data", ",", "null", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "beginTransaction", "(", ")", "{", "return", "env", ".", "beginTransaction", "(", "null", ",", "TransactionConfig", ".", "DEFAULT", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "commit", "(", "Object", "txn", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "(", "(", "Transaction", ")", "txn", ")", ".", "commit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "abort", "(", "Object", "txn", ")", "{", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", ")", ";", "(", "(", "Transaction", ")", "txn", ")", ".", "abort", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "long", "id", ",", "short", "owner", ",", "long", "version", ",", "byte", "[", "]", "data", ",", "Object", "txn", ")", "{", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "\"", "<STR_LIT>", "\"", "+", "hex", "(", "id", ")", "+", "\"", "<STR_LIT>", "\"", "+", "version", "+", "\"", "<STR_LIT>", "\"", "+", "(", "data", "!", "=", "null", "?", "\"", "<STR_LIT:(>", "\"", "+", "data", ".", "length", "+", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "DatabaseEntry", "key", "=", "new", "DatabaseEntry", "(", "Longs", ".", "toByteArray", "(", "id", ")", ")", ";", "final", "DatabaseEntry", "dbEntry", "=", "new", "DatabaseEntry", "(", ")", ";", "entryBinding", ".", "objectToEntry", "(", "new", "MainMemoryEntry", "(", "version", ",", "data", ")", ",", "dbEntry", ")", ";", "mainStore", ".", "put", "(", "(", "Transaction", ")", "txn", ",", "key", ",", "dbEntry", ")", ";", "ownerDirectory", ".", "putNoOverwrite", "(", "(", "Transaction", ")", "txn", ",", "key", ",", "new", "DatabaseEntry", "(", "Shorts", ".", "toByteArray", "(", "owner", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "MainMemoryEntry", "read", "(", "long", "id", ")", "{", "final", "DatabaseEntry", "dbEntry", "=", "new", "DatabaseEntry", "(", ")", ";", "OperationStatus", "status", "=", "mainStore", ".", "get", "(", "null", ",", "new", "DatabaseEntry", "(", "Longs", ".", "toByteArray", "(", "id", ")", ")", ",", "dbEntry", ",", "LockMode", ".", "READ_COMMITTED", ")", ";", "if", "(", "status", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "final", "MainMemoryEntry", "entry", "=", "entryBinding", ".", "entryToObject", "(", "dbEntry", ")", ";", "return", "entry", ";", "}", "else", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "delete", "(", "long", "id", ",", "Object", "txn", ")", "{", "mainStore", ".", "delete", "(", "(", "Transaction", ")", "txn", ",", "new", "DatabaseEntry", "(", "Longs", ".", "toByteArray", "(", "id", ")", ")", ")", ";", "ownerDirectory", ".", "delete", "(", "(", "Transaction", ")", "txn", ",", "new", "DatabaseEntry", "(", "Longs", ".", "toByteArray", "(", "id", ")", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getMaxId", "(", ")", "{", "final", "long", "ownerDirecotryMaxId", "=", "getMaxId", "(", "ownerDirectory", ")", ";", "final", "long", "mainStoreMaxId", "=", "getMaxId", "(", "mainStore", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "ownerDirecotryMaxId", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "mainStoreMaxId", ")", ";", "return", "Math", ".", "max", "(", "ownerDirecotryMaxId", ",", "mainStoreMaxId", ")", ";", "}", "</s>"]
["<s>", "private", "long", "getMaxId", "(", "Database", "db", ")", "{", "final", "DatabaseEntry", "key", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "value", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "Cursor", "cursor", "=", "db", ".", "openCursor", "(", "null", ",", "CursorConfig", ".", "DEFAULT", ")", ";", "try", "{", "final", "OperationStatus", "status", "=", "cursor", ".", "getLast", "(", "key", ",", "value", ",", "null", ")", ";", "if", "(", "status", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "return", "Longs", ".", "fromByteArray", "(", "key", ".", "getData", "(", ")", ")", ";", "else", "return", "0", ";", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "{", "ownerIndex", ".", "close", "(", ")", ";", "ownerDirectory", ".", "close", "(", ")", ";", "mainStore", ".", "close", "(", ")", ";", "env", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "objectToEntry", "(", "MainMemoryEntry", "entry", ",", "TupleOutput", "out", ")", "{", "out", ".", "writeLong", "(", "entry", ".", "version", ")", ";", "out", ".", "writeFast", "(", "entry", ".", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "MainMemoryEntry", "entryToObject", "(", "TupleInput", "in", ")", "{", "final", "long", "version", "=", "in", ".", "readLong", "(", ")", ";", "final", "int", "dataLength", "=", "in", ".", "getBufferLength", "(", ")", "-", "in", ".", "getBufferOffset", "(", ")", ";", "final", "byte", "[", "]", "data", "=", "new", "byte", "[", "dataLength", "]", ";", "in", ".", "readFast", "(", "data", ")", ";", "return", "new", "MainMemoryEntry", "(", "version", ",", "data", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "createSecondaryKey", "(", "SecondaryDatabase", "secondary", ",", "DatabaseEntry", "key", ",", "DatabaseEntry", "data", ",", "DatabaseEntry", "result", ")", "{", "result", ".", "setData", "(", "data", ".", "getData", "(", ")", ")", ";", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "dump", "(", "java", ".", "io", ".", "PrintStream", "ps", ")", "{", "String", "home", "=", "\"", "\"", ";", "try", "{", "home", "=", "env", ".", "getHome", "(", ")", ".", "getCanonicalPath", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "}", "ps", ".", "println", "(", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "home", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ps", ".", "println", "(", ")", ";", "printOwners", "(", "ps", ")", ";", "ps", ".", "println", "(", ")", ";", "printMainStore", "(", "ps", ")", ";", "ps", ".", "println", "(", ")", ";", "printOwnerIndex", "(", "ps", ")", ";", "ps", ".", "println", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "printOwners", "(", "java", ".", "io", ".", "PrintStream", "ps", ")", "{", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "DatabaseEntry", "key", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "value", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "Cursor", "cursor", "=", "ownerDirectory", ".", "openCursor", "(", "null", ",", "CursorConfig", ".", "DEFAULT", ")", ";", "try", "{", "while", "(", "cursor", ".", "getNext", "(", "key", ",", "value", ",", "LockMode", ".", "DEFAULT", ")", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "long", "id", "=", "Longs", ".", "fromByteArray", "(", "key", ".", "getData", "(", ")", ")", ";", "short", "owner", "=", "Shorts", ".", "fromByteArray", "(", "value", ".", "getData", "(", ")", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "hex", "(", "id", ")", "+", "\"", "<STR_LIT>", "\"", "+", "owner", "+", "\"", "\"", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "printMainStore", "(", "java", ".", "io", ".", "PrintStream", "ps", ")", "{", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "DatabaseEntry", "key", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "value", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "Cursor", "cursor", "=", "mainStore", ".", "openCursor", "(", "null", ",", "CursorConfig", ".", "DEFAULT", ")", ";", "try", "{", "while", "(", "cursor", ".", "getNext", "(", "key", ",", "value", ",", "LockMode", ".", "DEFAULT", ")", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "long", "id", "=", "Longs", ".", "fromByteArray", "(", "key", ".", "getData", "(", ")", ")", ";", "final", "MainMemoryEntry", "entry", "=", "entryBinding", ".", "entryToObject", "(", "value", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "hex", "(", "id", ")", "+", "\"", "<STR_LIT>", "\"", "+", "entry", ".", "version", "+", "\"", "<STR_LIT>", "\"", "+", "entry", ".", "data", ".", "length", "+", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "printOwnerIndex", "(", "java", ".", "io", ".", "PrintStream", "ps", ")", "{", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", ")", ";", "final", "DatabaseEntry", "sKey", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "pKey", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "DatabaseEntry", "value", "=", "new", "DatabaseEntry", "(", ")", ";", "final", "SecondaryCursor", "cursor", "=", "ownerIndex", ".", "openCursor", "(", "null", ",", "CursorConfig", ".", "DEFAULT", ")", ";", "try", "{", "while", "(", "cursor", ".", "getNext", "(", "sKey", ",", "pKey", ",", "value", ",", "LockMode", ".", "DEFAULT", ")", "=", "=", "OperationStatus", ".", "SUCCESS", ")", "{", "long", "id", "=", "Longs", ".", "fromByteArray", "(", "pKey", ".", "getData", "(", ")", ")", ";", "short", "owner", "=", "Shorts", ".", "fromByteArray", "(", "sKey", ".", "getData", "(", ")", ")", ";", "ps", ".", "println", "(", "\"", "<STR_LIT>", "\"", "+", "owner", "+", "\"", "<STR_LIT>", "\"", "+", "hex", "(", "id", ")", ")", ";", "}", "}", "finally", "{", "cursor", ".", "close", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "byte", "[", "]", "toByteArray", "(", "long", "value", ",", "byte", "[", "]", "array", ")", "{", "array", "[", "0", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT>", ")", ";", "array", "[", "1", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT>", ")", ";", "array", "[", "<NUM_LIT:2>", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT>", ")", ";", "array", "[", "<NUM_LIT:3>", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT:32>", ")", ";", "array", "[", "<NUM_LIT:4>", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT:24>", ")", ";", "array", "[", "<NUM_LIT:5>", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT:16>", ")", ";", "array", "[", "<NUM_LIT:6>", "]", "=", "(", "byte", ")", "(", "value", ">", ">", "<NUM_LIT:8>", ")", ";", "array", "[", "<NUM_LIT:7>", "]", "=", "(", "byte", ")", "value", ";", "return", "array", ";", "}", "</s>"]
["<s>", "public", "MultiLane", "(", "int", "width", ")", "{", "if", "(", "width", "<", "=", "0", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "width", ")", ";", "if", "(", "(", "width", "&", "(", "width", "-", "1", ")", ")", "!", "=", "0", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "width", ")", ";", "lanes", "=", "(", "LinkedBlockingQueue", "<", "T", ">", "[", "]", ")", "new", "LinkedBlockingQueue", "[", "width", "]", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "width", ";", "i", "+", "+", ")", "lanes", "[", "i", "]", "=", "new", "LinkedBlockingQueue", "<", "T", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "put", "(", "T", "v", ")", "throws", "InterruptedException", "{", "final", "int", "curs", "=", "putCursor", ".", "getAndIncrement", "(", ")", ";", "lanes", "[", "curs", "&", "(", "lanes", ".", "length", "-", "1", ")", "]", ".", "put", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "T", "take", "(", ")", "throws", "InterruptedException", "{", "final", "int", "curs", "=", "takeCursor", ".", "getAndIncrement", "(", ")", ";", "return", "lanes", "[", "curs", "&", "(", "lanes", ".", "length", "-", "1", ")", "]", ".", "take", "(", ")", ";", "}", "</s>"]
["<s>", "public", "TLongRange", "(", "long", "start", ",", "int", "length", ")", "{", "this", ".", "start", "=", "start", ";", "this", ".", "length", "=", "length", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "length", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "TLongIterator", "iterator", "(", ")", "{", "return", "new", "TLongIterator", "(", ")", "{", "private", "int", "nextIndex", "=", "0", ";", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "nextIndex", "<", "length", ";", "}", "@", "Override", "public", "long", "next", "(", ")", "{", "return", "start", "+", "(", "nextIndex", "+", "+", ")", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "nextIndex", "<", "length", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "next", "(", ")", "{", "return", "start", "+", "(", "nextIndex", "+", "+", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "contains", "(", "long", "entry", ")", "{", "return", "(", "entry", ">", "=", "start", "&", "&", "entry", "<", "(", "start", "+", "length", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "remove", "(", "long", "entry", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Object", "addToSingleOrSet", "(", "Object", "obj", ",", "Object", "singleOrSet", ")", "{", "if", "(", "singleOrSet", "=", "=", "null", ")", "return", "obj", ";", "else", "if", "(", "singleOrSet", "instanceof", "Set", ")", "return", "(", "(", "Set", ")", "singleOrSet", ")", ".", "add", "(", "obj", ")", ";", "else", "{", "final", "Set", "set", "=", "new", "HashSet", "(", ")", ";", "set", ".", "add", "(", "singleOrSet", ")", ";", "set", ".", "add", "(", "obj", ")", ";", "return", "set", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Object", "removeFromSingleOrSet", "(", "Object", "obj", ",", "Object", "singleOrSet", ")", "{", "if", "(", "singleOrSet", "=", "=", "null", ")", "return", "null", ";", "if", "(", "singleOrSet", "instanceof", "Set", ")", "{", "Set", "set", "=", "(", "Set", ")", "singleOrSet", ";", "set", ".", "remove", "(", "obj", ")", ";", "if", "(", "set", ".", "isEmpty", "(", ")", ")", "return", "null", ";", "else", "return", "set", ";", "}", "else", "{", "assert", "obj", "=", "=", "singleOrSet", ";", "return", "null", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Set", "getSingleOrSet", "(", "Object", "singleOrSet", ")", "{", "if", "(", "singleOrSet", "instanceof", "Set", ")", "return", "(", "Set", ")", "singleOrSet", ";", "return", "Collections", ".", "singleton", "(", "singleOrSet", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", ">", "Iterable", "<", "E", ">", "reverse", "(", "final", "Deque", "<", "E", ">", "deque", ")", "{", "return", "new", "Iterable", "<", "E", ">", "(", ")", "{", "@", "Override", "public", "Iterator", "<", "E", ">", "iterator", "(", ")", "{", "return", "deque", ".", "descendingIterator", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Iterator", "<", "E", ">", "iterator", "(", ")", "{", "return", "deque", ".", "descendingIterator", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", ">", "Iterable", "<", "E", ">", "reverse", "(", "final", "List", "<", "E", ">", "list", ")", "{", "return", "new", "Iterable", "<", "E", ">", "(", ")", "{", "@", "Override", "public", "Iterator", "<", "E", ">", "iterator", "(", ")", "{", "final", "ListIterator", "<", "E", ">", "it", "=", "list", ".", "listIterator", "(", "list", ".", "size", "(", ")", ")", ";", "return", "new", "Iterator", "<", "E", ">", "(", ")", "{", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasPrevious", "(", ")", ";", "}", "@", "Override", "public", "E", "next", "(", ")", "{", "return", "it", ".", "previous", "(", ")", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "}", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Iterator", "<", "E", ">", "iterator", "(", ")", "{", "final", "ListIterator", "<", "E", ">", "it", "=", "list", ".", "listIterator", "(", "list", ".", "size", "(", ")", ")", ";", "return", "new", "Iterator", "<", "E", ">", "(", ")", "{", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasPrevious", "(", ")", ";", "}", "@", "Override", "public", "E", "next", "(", ")", "{", "return", "it", ".", "previous", "(", ")", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "it", ".", "hasPrevious", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "E", "next", "(", ")", "{", "return", "it", ".", "previous", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "it", ".", "remove", "(", ")", ";", "}", "</s>"]
["<s>", "private", "Util", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "<", "E", ">", "Set", "<", "E", ">", "make", "(", "ConcurrentMap", "<", "E", ",", "Object", ">", "map", ")", "{", "return", "new", "ConcurrentSet", "<", "E", ">", "(", "map", ")", ";", "}", "</s>"]
["<s>", "public", "ConcurrentSet", "(", "ConcurrentMap", "<", "E", ",", "Object", ">", "map", ")", "{", "this", ".", "map", "=", "map", ";", "}", "</s>"]
["<s>", "public", "ConcurrentSet", "(", "ConcurrentMap", "<", "E", ",", "Object", ">", "map", ",", "Collection", "<", "E", ">", "elements", ")", "{", "for", "(", "E", "elem", ":", "elements", ")", "map", ".", "put", "(", "elem", ",", "PRESENT", ")", ";", "this", ".", "map", "=", "map", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "add", "(", "E", "e", ")", "{", "return", "map", ".", "putIfAbsent", "(", "e", ",", "PRESENT", ")", "!", "=", "PRESENT", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "contains", "(", "Object", "o", ")", "{", "return", "map", ".", "containsKey", "(", "o", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "remove", "(", "Object", "o", ")", "{", "return", "map", ".", "remove", "(", "o", ")", "=", "=", "PRESENT", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "map", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isEmpty", "(", ")", "{", "return", "map", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Iterator", "<", "E", ">", "iterator", "(", ")", "{", "return", "map", ".", "keySet", "(", ")", ".", "iterator", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "size", "(", ")", "{", "return", "map", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "TLongIterator", "iterator", "(", ")", "{", "return", "new", "TLongIterator", "(", ")", "{", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "false", ";", "}", "@", "Override", "public", "long", "next", "(", ")", "{", "throw", "new", "NoSuchElementException", "(", ")", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "next", "(", ")", "{", "throw", "new", "NoSuchElementException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "abstract", "int", "size", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "abstract", "TLongIterator", "iterator", "(", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "long", "getNoEntryValue", "(", ")", "{", "return", "0", "L", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isEmpty", "(", ")", "{", "return", "size", "(", ")", "=", "=", "0", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "contains", "(", "long", "entry", ")", "{", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "entry", "=", "=", "it", ".", "next", "(", ")", ")", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "[", "]", "toArray", "(", ")", "{", "long", "[", "]", "dest", "=", "new", "long", "[", "size", "(", ")", "]", ";", "final", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "dest", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "!", "it", ".", "hasNext", "(", ")", ")", "return", "Arrays", ".", "copyOf", "(", "dest", ",", "i", ")", ";", "dest", "[", "i", "]", "=", "it", ".", "next", "(", ")", ";", "}", "return", "it", ".", "hasNext", "(", ")", "?", "finishToArray", "(", "dest", ",", "it", ")", ":", "dest", ";", "}", "</s>"]
["<s>", "private", "static", "long", "[", "]", "finishToArray", "(", "long", "[", "]", "r", ",", "TLongIterator", "it", ")", "{", "int", "i", "=", "r", ".", "length", ";", "while", "(", "it", ".", "hasNext", "(", ")", ")", "{", "int", "cap", "=", "r", ".", "length", ";", "if", "(", "i", "=", "=", "cap", ")", "{", "int", "newCap", "=", "cap", "+", "(", "cap", ">", ">", "1", ")", "+", "1", ";", "if", "(", "newCap", "-", "MAX_ARRAY_SIZE", ">", "0", ")", "newCap", "=", "hugeCapacity", "(", "cap", "+", "1", ")", ";", "r", "=", "Arrays", ".", "copyOf", "(", "r", ",", "newCap", ")", ";", "}", "r", "[", "i", "+", "+", "]", "=", "it", ".", "next", "(", ")", ";", "}", "return", "(", "i", "=", "=", "r", ".", "length", ")", "?", "r", ":", "Arrays", ".", "copyOf", "(", "r", ",", "i", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "hugeCapacity", "(", "int", "minCapacity", ")", "{", "if", "(", "minCapacity", "<", "0", ")", "throw", "new", "OutOfMemoryError", "(", "\"", "<STR_LIT>", "\"", ")", ";", "return", "(", "minCapacity", ">", "MAX_ARRAY_SIZE", ")", "?", "Integer", ".", "MAX_VALUE", ":", "MAX_ARRAY_SIZE", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "[", "]", "toArray", "(", "long", "[", "]", "dest", ")", "{", "final", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "dest", ".", "length", ";", "i", "+", "+", ")", "{", "if", "(", "!", "it", ".", "hasNext", "(", ")", ")", "{", "dest", "[", "i", "]", "=", "getNoEntryValue", "(", ")", ";", "break", ";", "}", "dest", "[", "i", "]", "=", "it", ".", "next", "(", ")", ";", "}", "return", "dest", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "add", "(", "long", "entry", ")", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "remove", "(", "long", "entry", ")", "{", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "entry", "=", "=", "it", ".", "next", "(", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "return", "true", ";", "}", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "containsAll", "(", "Collection", "<", "?", ">", "collection", ")", "{", "for", "(", "Object", "e", ":", "collection", ")", "{", "if", "(", "!", "contains", "(", "(", "Long", ")", "e", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "containsAll", "(", "TLongCollection", "collection", ")", "{", "for", "(", "TLongIterator", "it", "=", "collection", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "!", "contains", "(", "it", ".", "next", "(", ")", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "containsAll", "(", "long", "[", "]", "array", ")", "{", "for", "(", "long", "e", ":", "array", ")", "{", "if", "(", "!", "contains", "(", "e", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "addAll", "(", "Collection", "<", "?", "extends", "Long", ">", "collection", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "Long", "e", ":", "collection", ")", "{", "if", "(", "add", "(", "e", ")", ")", "modified", "=", "true", ";", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "addAll", "(", "TLongCollection", "collection", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "collection", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "add", "(", "it", ".", "next", "(", ")", ")", ")", "modified", "=", "true", ";", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "addAll", "(", "long", "[", "]", "array", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "long", "e", ":", "array", ")", "{", "if", "(", "add", "(", "e", ")", ")", "modified", "=", "true", ";", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "removeAll", "(", "Collection", "<", "?", ">", "collection", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "collection", ".", "contains", "(", "it", ".", "next", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "modified", "=", "true", ";", "}", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "removeAll", "(", "TLongCollection", "collection", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "collection", ".", "contains", "(", "it", ".", "next", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "modified", "=", "true", ";", "}", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "removeAll", "(", "long", "[", "]", "array", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "contains", "(", "array", ",", "it", ".", "next", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "modified", "=", "true", ";", "}", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "retainAll", "(", "Collection", "<", "?", ">", "collection", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "!", "collection", ".", "contains", "(", "it", ".", "next", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "modified", "=", "true", ";", "}", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "retainAll", "(", "TLongCollection", "collection", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "!", "collection", ".", "contains", "(", "it", ".", "next", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "modified", "=", "true", ";", "}", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "retainAll", "(", "long", "[", "]", "array", ")", "{", "boolean", "modified", "=", "false", ";", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "!", "contains", "(", "array", ",", "it", ".", "next", "(", ")", ")", ")", "{", "it", ".", "remove", "(", ")", ";", "modified", "=", "true", ";", "}", "}", "return", "modified", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "it", ".", "next", "(", ")", ";", "it", ".", "remove", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "forEach", "(", "TLongProcedure", "procedure", ")", "{", "for", "(", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "if", "(", "!", "procedure", ".", "execute", "(", "it", ".", "next", "(", ")", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "private", "static", "boolean", "contains", "(", "long", "[", "]", "array", ",", "long", "value", ")", "{", "for", "(", "long", "e", ":", "array", ")", "{", "if", "(", "e", "=", "=", "value", ")", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "final", "TLongIterator", "it", "=", "iterator", "(", ")", ";", "if", "(", "!", "it", ".", "hasNext", "(", ")", ")", "return", "\"", "<STR_LIT:[]>", "\"", ";", "StringBuilder", "sb", "=", "new", "StringBuilder", "(", ")", ";", "sb", ".", "append", "(", "<CHAR_LIT:[>", ")", ";", "for", "(", ";", ";", ")", "{", "long", "e", "=", "it", ".", "next", "(", ")", ";", "sb", ".", "append", "(", "e", ")", ";", "if", "(", "!", "it", ".", "hasNext", "(", ")", ")", "return", "sb", ".", "append", "(", "<CHAR_LIT:]>", ")", ".", "toString", "(", ")", ";", "sb", ".", "append", "(", "<CHAR_LIT:U+002C>", ")", ".", "append", "(", "<CHAR_LIT>", ")", ";", "}", "}", "</s>"]
["<s>", "public", "ConcurrentMultimapWithCopyOnWriteArrayList", "(", ")", "{", "super", "(", "new", "NonBlockingHashMap", "<", "K", ",", "List", "<", "V", ">", ">", "(", ")", ",", "(", "List", "<", "V", ">", ")", "Collections", ".", "EMPTY_LIST", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "List", "<", "V", ">", "allocateElement", "(", ")", "{", "return", "new", "CopyOnWriteArrayList", "<", "V", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "LinkedHashMap2", "(", "int", "initialCapacity", ",", "float", "loadFactor", ")", "{", "super", "(", "initialCapacity", ",", "loadFactor", ")", ";", "}", "</s>"]
["<s>", "public", "LinkedHashMap2", "(", "int", "initialCapacity", ")", "{", "super", "(", "initialCapacity", ")", ";", "}", "</s>"]
["<s>", "public", "LinkedHashMap2", "(", ")", "{", "}", "</s>"]
["<s>", "public", "LinkedHashMap2", "(", "Map", "<", "?", "extends", "K", ",", "?", "extends", "V", ">", "m", ")", "{", "super", "(", "m", ")", ";", "}", "</s>"]
["<s>", "public", "Map", ".", "Entry", "<", "K", ",", "V", ">", "firstEntry", "(", ")", "{", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "header", "=", "getHeader", "(", ")", ";", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "first", "=", "getNextEntry", "(", "header", ")", ";", "return", "(", "first", "!", "=", "header", "?", "first", ":", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Map", ".", "Entry", "<", "K", ",", "V", ">", "lastEntry", "(", ")", "{", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "header", "=", "getHeader", "(", ")", ";", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "last", "=", "getPreviousEntry", "(", "header", ")", ";", "return", "(", "last", "!", "=", "header", "?", "last", ":", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Map", ".", "Entry", "<", "K", ",", "V", ">", "nextEntry", "(", "K", "key", ")", "{", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "nextEntry", "=", "getNextEntry", "(", "getEntry", "(", "key", ")", ")", ";", "return", "(", "nextEntry", "!", "=", "getHeader", "(", ")", "?", "nextEntry", ":", "null", ")", ";", "}", "</s>"]
["<s>", "public", "Map", ".", "Entry", "<", "K", ",", "V", ">", "previousEntry", "(", "K", "key", ")", "{", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "previousEntry", "=", "getPreviousEntry", "(", "getEntry", "(", "key", ")", ")", ";", "return", "(", "previousEntry", "!", "=", "getHeader", "(", ")", "?", "previousEntry", ":", "null", ")", ";", "}", "</s>"]
["<s>", "public", "K", "firstKey", "(", ")", "{", "return", "getKey", "(", "getNextEntry", "(", "getHeader", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "K", "lastKey", "(", ")", "{", "return", "getKey", "(", "getPreviousEntry", "(", "getHeader", "(", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "K", "nextKey", "(", "K", "key", ")", "{", "return", "getKey", "(", "getNextEntry", "(", "getEntry", "(", "key", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "K", "previousKey", "(", "K", "key", ")", "{", "return", "getKey", "(", "getPreviousEntry", "(", "getEntry", "(", "key", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "V", "nextValue", "(", "K", "key", ")", "{", "return", "getValue", "(", "getNextEntry", "(", "getEntry", "(", "key", ")", ")", ")", ";", "}", "</s>"]
["<s>", "public", "V", "previousValue", "(", "K", "key", ")", "{", "return", "getValue", "(", "getPreviousEntry", "(", "getEntry", "(", "key", ")", ")", ")", ";", "}", "</s>"]
["<s>", "private", "K", "getKey", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", "entry", ")", "{", "return", "entry", "!", "=", "null", "?", "entry", ".", "getKey", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "private", "V", "getValue", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", "entry", ")", "{", "return", "entry", "!", "=", "null", "?", "entry", ".", "getValue", "(", ")", ":", "null", ";", "}", "</s>"]
["<s>", "protected", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "getEntry", "(", "K", "key", ")", "{", "try", "{", "return", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", ")", "getEntry", ".", "invoke", "(", "this", ",", "key", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "InvocationTargetException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "getHeader", "(", ")", "{", "try", "{", "return", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", ")", "header", ".", "get", "(", "this", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "getNextEntry", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", "entry", ")", "{", "if", "(", "entry", "=", "=", "null", ")", "return", "null", ";", "try", "{", "return", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", ")", "after", ".", "get", "(", "entry", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "protected", "final", "Map", ".", "Entry", "<", "K", ",", "V", ">", "getPreviousEntry", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", "entry", ")", "{", "if", "(", "entry", "=", "=", "null", ")", "return", "null", ";", "try", "{", "return", "(", "Map", ".", "Entry", "<", "K", ",", "V", ">", ")", "before", ".", "get", "(", "entry", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "TLongCompoundCollection", "(", ")", "{", "collections", "=", "new", "ArrayList", "<", "TLongCollection", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addCollection", "(", "TLongCollection", "c", ")", "{", "collections", ".", "add", "(", "c", ")", ";", "}", "</s>"]
["<s>", "public", "void", "removeCollection", "(", "TLongCollection", "c", ")", "{", "collections", ".", "remove", "(", "c", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "int", "size", "=", "0", ";", "for", "(", "TLongCollection", "c", ":", "collections", ")", "size", "+", "=", "c", ".", "size", "(", ")", ";", "return", "size", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isEmpty", "(", ")", "{", "for", "(", "TLongCollection", "c", ":", "collections", ")", "{", "if", "(", "!", "c", ".", "isEmpty", "(", ")", ")", "return", "false", ";", "}", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "TLongIterator", "iterator", "(", ")", "{", "return", "new", "TLongIterator", "(", ")", "{", "private", "Iterator", "<", "TLongCollection", ">", "ce", "=", "collections", ".", "iterator", "(", ")", ";", "private", "TLongIterator", "i", "=", "null", ";", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "setIterator", "(", ")", ";", "if", "(", "i", "=", "=", "null", ")", "return", "false", ";", "return", "i", ".", "hasNext", "(", ")", ";", "}", "@", "Override", "public", "long", "next", "(", ")", "{", "setIterator", "(", ")", ";", "if", "(", "i", "=", "=", "null", ")", "throw", "new", "NoSuchElementException", "(", ")", ";", "return", "i", ".", "next", "(", ")", ";", "}", "@", "Override", "public", "void", "remove", "(", ")", "{", "i", ".", "remove", "(", ")", ";", "}", "private", "void", "setIterator", "(", ")", "{", "if", "(", "i", "=", "=", "null", "|", "|", "!", "i", ".", "hasNext", "(", ")", ")", "{", "if", "(", "ce", ".", "hasNext", "(", ")", ")", "i", "=", "ce", ".", "next", "(", ")", ".", "iterator", "(", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "hasNext", "(", ")", "{", "setIterator", "(", ")", ";", "if", "(", "i", "=", "=", "null", ")", "return", "false", ";", "return", "i", ".", "hasNext", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "next", "(", ")", "{", "setIterator", "(", ")", ";", "if", "(", "i", "=", "=", "null", ")", "throw", "new", "NoSuchElementException", "(", ")", ";", "return", "i", ".", "next", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "remove", "(", ")", "{", "i", ".", "remove", "(", ")", ";", "}", "</s>"]
["<s>", "private", "void", "setIterator", "(", ")", "{", "if", "(", "i", "=", "=", "null", "|", "|", "!", "i", ".", "hasNext", "(", ")", ")", "{", "if", "(", "ce", ".", "hasNext", "(", ")", ")", "i", "=", "ce", ".", "next", "(", ")", ".", "iterator", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "clear", "(", ")", "{", "for", "(", "TLongCollection", "c", ":", "collections", ")", "c", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "contains", "(", "long", "value", ")", "{", "for", "(", "TLongCollection", "c", ":", "collections", ")", "{", "if", "(", "c", ".", "contains", "(", "value", ")", ")", "return", "true", ";", "}", "return", "false", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "remove", "(", "long", "value", ")", "{", "boolean", "retValue", "=", "false", ";", "for", "(", "TLongCollection", "c", ":", "collections", ")", "retValue", "|", "=", "c", ".", "remove", "(", "value", ")", ";", "return", "retValue", ";", "}", "</s>"]
["<s>", "public", "ConcurrentMultimap", "(", "ConcurrentMap", "<", "K", ",", "C", ">", "map", ",", "C", "emptyCollection", ")", "{", "super", "(", "map", ")", ";", "this", ".", "emptyCollection", "=", "emptyCollection", ";", "}", "</s>"]
["<s>", "public", "ConcurrentMultimap", "(", "C", "emptyCollection", ")", "{", "this", ".", "emptyCollection", "=", "emptyCollection", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "C", "emptyElement", "(", ")", "{", "return", "emptyCollection", ";", "}", "</s>"]
["<s>", "public", "void", "put", "(", "K", "key", ",", "V", "value", ")", "{", "getOrAllocate", "(", "key", ")", ".", "add", "(", "value", ")", ";", "}", "</s>"]
["<s>", "public", "void", "put", "(", "K", "key", ",", "Collection", "<", "V", ">", "values", ")", "{", "getOrAllocate", "(", "key", ")", ".", "addAll", "(", "values", ")", ";", "}", "</s>"]
["<s>", "public", "void", "remove", "(", "K", "key", ",", "V", "value", ")", "{", "final", "C", "coll", "=", "get", "(", "key", ")", ";", "if", "(", "coll", "=", "=", "null", ")", "return", ";", "coll", ".", "remove", "(", "value", ")", ";", "}", "</s>"]
["<s>", "public", "Collection", "<", "C", ">", "values", "(", ")", "{", "return", "map", ".", "values", "(", ")", ";", "}", "</s>"]
["<s>", "public", "Set", "<", "K", ">", "keySet", "(", ")", "{", "return", "map", ".", "keySet", "(", ")", ";", "}", "</s>"]
["<s>", "public", "ConcurrentMapComplex", "(", "ConcurrentMap", "<", "K", ",", "V", ">", "map", ")", "{", "this", ".", "map", "=", "map", ";", "}", "</s>"]
["<s>", "public", "ConcurrentMapComplex", "(", ")", "{", "this", ".", "map", "=", "new", "ConcurrentHashMap", "<", "K", ",", "V", ">", "(", ")", ";", "}", "</s>"]
["<s>", "public", "V", "getOrAllocate", "(", "K", "key", ")", "{", "V", "coll", "=", "map", ".", "get", "(", "key", ")", ";", "if", "(", "coll", "=", "=", "null", ")", "{", "coll", "=", "allocateElement", "(", ")", ";", "V", "tmp", "=", "map", ".", "putIfAbsent", "(", "key", ",", "coll", ")", ";", "if", "(", "tmp", "!", "=", "null", ")", "coll", "=", "tmp", ";", "}", "return", "coll", ";", "}", "</s>"]
["<s>", "public", "V", "get", "(", "K", "key", ")", "{", "final", "V", "value", "=", "map", ".", "get", "(", "key", ")", ";", "return", "value", "!", "=", "null", "?", "value", ":", "emptyElement", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "remove", "(", "K", "key", ")", "{", "map", ".", "remove", "(", "key", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "V", "allocateElement", "(", ")", ";", "</s>"]
["<s>", "protected", "abstract", "V", "emptyElement", "(", ")", ";", "</s>"]
["<s>", "public", "int", "size", "(", ")", "{", "return", "map", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "isEmpty", "(", ")", "{", "return", "map", ".", "isEmpty", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "contains", "(", "long", "obj", ")", "{", "return", "map", ".", "containsKey", "(", "obj", ")", ";", "}", "</s>"]
["<s>", "public", "void", "clear", "(", ")", "{", "map", ".", "clear", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "add", "(", "long", "e", ")", "{", "return", "map", ".", "put", "(", "e", ",", "VALUE", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "boolean", "remove", "(", "long", "o", ")", "{", "return", "map", ".", "remove", "(", "o", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "long", "[", "]", "getSnapshotAndClear", "(", ")", "{", "final", "Set", "<", "Long", ">", "set", "=", "map", ".", "keySet", "(", ")", ";", "final", "long", "[", "]", "array", "=", "new", "long", "[", "set", ".", "size", "(", ")", "]", ";", "int", "i", "=", "0", ";", "for", "(", "NonBlockingHashMapLong", ".", "IteratorLong", "it", "=", "(", "NonBlockingHashMapLong", ".", "IteratorLong", ")", "set", ".", "iterator", "(", ")", ";", "it", ".", "hasNext", "(", ")", ";", ")", "{", "array", "[", "i", "]", "=", "it", ".", "nextLong", "(", ")", ";", "it", ".", "remove", "(", ")", ";", "i", "+", "+", ";", "}", "assert", "i", "=", "=", "array", ".", "length", ";", "return", "array", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", ")", "{", "return", "0", "L", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ")", "{", "return", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ",", "E", "e3", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e3", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ",", "E", "e3", ",", "E", "e4", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e3", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e4", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ",", "E", "e3", ",", "E", "e4", ",", "E", "e5", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e3", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e4", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e5", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ",", "E", "e3", ",", "E", "e4", ",", "E", "e5", ",", "E", "e6", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e3", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e4", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e5", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e6", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ",", "E", "e3", ",", "E", "e4", ",", "E", "e5", ",", "E", "e6", ",", "E", "e7", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e3", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e4", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e5", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e6", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e7", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", "e1", ",", "E", "e2", ",", "E", "e3", ",", "E", "e4", ",", "E", "e5", ",", "E", "e6", ",", "E", "e7", ",", "E", "e8", ")", "{", "long", "set", "=", "0", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e1", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e2", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e3", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e4", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e5", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e6", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e7", ".", "ordinal", "(", ")", ")", ";", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e8", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "setOf", "(", "E", ".", ".", ".", "es", ")", "{", "long", "set", "=", "0", ";", "for", "(", "E", "e", ":", "es", ")", "set", "|", "=", "(", "<NUM_LIT>", "<", "<", "e", ".", "ordinal", "(", ")", ")", ";", "return", "set", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "long", "rangeBetween", "(", "E", "from", ",", "E", "to", ")", "{", "return", "(", "-", "<NUM_LIT>", ">", ">", ">", "(", "from", ".", "ordinal", "(", ")", "-", "to", ".", "ordinal", "(", ")", "-", "1", ")", ")", "<", "<", "from", ".", "ordinal", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "boolean", "intersects", "(", "long", "set1", ",", "long", "set2", ")", "{", "return", "0", "L", "!", "=", "(", "set1", "&", "set2", ")", ";", "}", "</s>"]
["<s>", "public", "static", "<", "E", "extends", "Enum", "<", "E", ">", ">", "boolean", "isIn", "(", "E", "e", ",", "long", "set", ")", "{", "return", "intersects", "(", "setOf", "(", "e", ")", ",", "set", ")", ";", "}", "</s>"]
["<s>", "private", "Enums", "(", ")", "{", "}", "</s>"]
["<s>", "public", "DOMElementProprtyEditor", "(", ")", "throws", "Exception", "{", "docBuilder", "=", "DocumentBuilderFactory", ".", "newInstance", "(", ")", ".", "newDocumentBuilder", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "setAsText", "(", "String", "text", ")", "throws", "IllegalArgumentException", "{", "try", "{", "final", "Document", "doc", "=", "docBuilder", ".", "parse", "(", "new", "InputSource", "(", "new", "StringReader", "(", "text", ")", ")", ")", ";", "final", "Element", "element", "=", "doc", ".", "getDocumentElement", "(", ")", ";", "setValue", "(", "element", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "IllegalArgumentException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getAsText", "(", ")", "{", "try", "{", "final", "Node", "node", "=", "(", "Node", ")", "getValue", "(", ")", ";", "Source", "source", "=", "new", "DOMSource", "(", "node", ")", ";", "StringWriter", "stringWriter", "=", "new", "StringWriter", "(", ")", ";", "Result", "result", "=", "new", "StreamResult", "(", "stringWriter", ")", ";", "TransformerFactory", "factory", "=", "TransformerFactory", ".", "newInstance", "(", ")", ";", "Transformer", "transformer", "=", "factory", ".", "newTransformer", "(", ")", ";", "transformer", ".", "transform", "(", "source", ",", "result", ")", ";", "return", "stringWriter", ".", "getBuffer", "(", ")", ".", "toString", "(", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "}", "return", "null", ";", "}", "</s>"]
["<s>", "public", "static", "void", "rethrow", "(", "Throwable", "t", ")", "{", "if", "(", "t", "instanceof", "RuntimeException", ")", "throw", "(", "(", "RuntimeException", ")", "t", ")", ";", "if", "(", "t", "instanceof", "Error", ")", "throw", "(", "(", "Error", ")", "t", ")", ";", "else", "throw", "new", "RuntimeException", "(", "t", ")", ";", "}", "</s>"]
["<s>", "private", "Exceptions", "(", ")", "{", "}", "</s>"]
["<s>", "private", "DegenerateInvocationHandler", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "invoke", "(", "Object", "proxy", ",", "Method", "method", ",", "Object", "[", "]", "args", ")", "throws", "Throwable", "{", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "boolean", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Boolean", ".", "class", ")", ")", "return", "Boolean", ".", "FALSE", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "byte", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Byte", ".", "class", ")", ")", "return", "(", "byte", ")", "0", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "char", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Character", ".", "class", ")", ")", "return", "(", "char", ")", "0", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "short", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Short", ".", "class", ")", ")", "return", "(", "short", ")", "0", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "int", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Integer", ".", "class", ")", ")", "return", "0", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "long", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Long", ".", "class", ")", ")", "return", "0", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "float", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Float", ".", "class", ")", ")", "return", "<NUM_LIT:0.0f>", ";", "if", "(", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "double", ".", "class", ")", "|", "|", "method", ".", "getReturnType", "(", ")", ".", "equals", "(", "Double", ".", "class", ")", ")", "return", "<NUM_LIT:0.0f>", ";", "else", "return", "null", ";", "}", "</s>"]
["<s>", "public", "ByteBufferOutputStream", "(", "ByteBuffer", "buffer", ")", "{", "this", ".", "buffer", "=", "buffer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeObject", "(", "Object", "obj", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "int", "b", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "put", "(", "(", "byte", ")", "b", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "put", "(", "b", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "put", "(", "b", ",", "off", ",", "len", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeBoolean", "(", "boolean", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "put", "(", "v", "?", "(", "byte", ")", "1", ":", "(", "byte", ")", "0", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeByte", "(", "int", "v", ")", "throws", "IOException", "{", "write", "(", "v", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeBytes", "(", "String", "s", ")", "throws", "IOException", "{", "byte", "[", "]", "b", "=", "s", ".", "getBytes", "(", ")", ";", "write", "(", "b", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeChar", "(", "int", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "putChar", "(", "(", "char", ")", "v", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeChars", "(", "String", "s", ")", "throws", "IOException", "{", "try", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "s", ".", "length", "(", ")", ";", "i", "+", "+", ")", "buffer", ".", "putChar", "(", "s", ".", "charAt", "(", "i", ")", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeDouble", "(", "double", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "putDouble", "(", "v", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeFloat", "(", "float", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "putFloat", "(", "v", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeInt", "(", "int", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "putInt", "(", "v", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeLong", "(", "long", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "putLong", "(", "v", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeShort", "(", "int", "v", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "putShort", "(", "(", "short", ")", "v", ")", ";", "}", "catch", "(", "BufferOverflowException", "e", ")", "{", "throw", "new", "IOException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeUTF", "(", "String", "s", ")", "throws", "IOException", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "byte", "[", "]", "toByteArray", "(", "Streamable", "streamable", ")", "{", "try", "{", "final", "ByteArrayOutputStream", "baos", "=", "new", "ByteArrayOutputStream", "(", "streamable", ".", "size", "(", ")", ")", ";", "final", "DataOutputStream", "dos", "=", "new", "DataOutputStream", "(", "baos", ")", ";", "streamable", ".", "write", "(", "dos", ")", ";", "dos", ".", "flush", "(", ")", ";", "baos", ".", "close", "(", ")", ";", "return", "baos", ".", "toByteArray", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "void", "fromByteArray", "(", "Streamable", "streamable", ",", "byte", "[", "]", "array", ")", "{", "fromByteArray", "(", "streamable", ",", "array", ",", "0", ",", "array", ".", "length", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "fromByteArray", "(", "Streamable", "streamable", ",", "byte", "[", "]", "array", ",", "int", "offset", ")", "{", "fromByteArray", "(", "streamable", ",", "array", ",", "offset", ",", "array", ".", "length", "-", "offset", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "fromByteArray", "(", "Streamable", "streamable", ",", "byte", "[", "]", "array", ",", "int", "offset", ",", "int", "length", ")", "{", "try", "{", "final", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "array", ",", "offset", ",", "length", ")", ";", "final", "DataInputStream", "dis", "=", "new", "DataInputStream", "(", "bais", ")", ";", "streamable", ".", "read", "(", "dis", ")", ";", "bais", ".", "close", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "e", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "void", "writeBuffer", "(", "DataOutput", "out", ",", "ByteBuffer", "buffer", ")", "throws", "IOException", "{", "if", "(", "buffer", ".", "hasArray", "(", ")", ")", "{", "out", ".", "write", "(", "buffer", ".", "array", "(", ")", ",", "buffer", ".", "arrayOffset", "(", ")", "+", "buffer", ".", "position", "(", ")", ",", "buffer", ".", "remaining", "(", ")", ")", ";", "buffer", ".", "position", "(", "buffer", ".", "limit", "(", ")", ")", ";", "}", "else", "{", "final", "byte", "[", "]", "array", "=", "new", "byte", "[", "buffer", ".", "remaining", "(", ")", "]", ";", "buffer", ".", "get", "(", "array", ")", ";", "assert", "buffer", ".", "remaining", "(", ")", "=", "=", "0", "&", "&", "buffer", ".", "position", "(", ")", "=", "=", "buffer", ".", "limit", "(", ")", ";", "out", ".", "write", "(", "array", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "int", "calcUtfLength", "(", "String", "str", ")", "{", "final", "int", "strlen", "=", "str", ".", "length", "(", ")", ";", "int", "utflen", "=", "0", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "strlen", ";", "i", "+", "+", ")", "{", "int", "c", "=", "str", ".", "charAt", "(", "i", ")", ";", "if", "(", "(", "c", ">", "=", "<NUM_LIT>", ")", "&", "&", "(", "c", "<", "=", "<NUM_LIT>", ")", ")", "{", "utflen", "+", "+", ";", "}", "else", "if", "(", "c", ">", "<NUM_LIT>", ")", "{", "utflen", "+", "=", "<NUM_LIT:3>", ";", "}", "else", "{", "utflen", "+", "=", "<NUM_LIT:2>", ";", "}", "}", "return", "utflen", ";", "}", "</s>"]
["<s>", "public", "<", "T", "extends", "Streamable", ">", "void", "register", "(", "byte", "qualifier", ",", "Class", "<", "T", ">", "clazz", ")", "{", "ClassInfo", "old", "=", "types", ".", "putIfAbsent", "(", "qualifier", ",", "new", "ClassInfo", "(", "clazz", ")", ")", ";", "if", "(", "old", "!", "=", "null", ")", "{", "throw", "new", "RuntimeException", "(", "\"", "<STR_LIT>", "\"", "+", "qualifier", "+", "\"", "<STR_LIT>", "\"", "+", "old", ".", "clazz", ".", "getName", "(", ")", ")", ";", "}", "}", "</s>"]
["<s>", "public", "Object", "read", "(", "DataInput", "in", ")", "throws", "IOException", "{", "final", "byte", "qualifier", "=", "in", ".", "readByte", "(", ")", ";", "final", "ClassInfo", "ci", "=", "types", ".", "get", "(", "qualifier", ")", ";", "if", "(", "ci", "=", "=", "null", ")", "throw", "new", "IOException", "(", "\"", "<STR_LIT>", "\"", "+", "qualifier", ")", ";", "final", "Streamable", "obj", "=", "(", "Streamable", ")", "ci", ".", "construct", "(", "qualifier", ")", ";", "obj", ".", "read", "(", "in", ")", ";", "return", "obj", ";", "}", "</s>"]
["<s>", "public", "Object", "fromByteArray", "(", "byte", "[", "]", "array", ")", "throws", "IOException", "{", "final", "ByteArrayInputStream", "bais", "=", "new", "ByteArrayInputStream", "(", "array", ")", ";", "final", "DataInputStream", "dis", "=", "new", "DataInputStream", "(", "bais", ")", ";", "final", "Object", "obj", "=", "read", "(", "dis", ")", ";", "bais", ".", "close", "(", ")", ";", "return", "obj", ";", "}", "</s>"]
["<s>", "public", "ClassInfo", "(", "Class", "<", "T", ">", "clazz", ")", "{", "try", "{", "boolean", "_constructorWithQualifier", "=", "false", ";", "Constructor", "<", "T", ">", "_constructor", "=", "null", ";", "try", "{", "_constructor", "=", "clazz", ".", "getDeclaredConstructor", "(", "byte", ".", "class", ")", ";", "_constructorWithQualifier", "=", "true", ";", "}", "catch", "(", "NoSuchMethodException", "ex", ")", "{", "}", "if", "(", "_constructor", "=", "=", "null", ")", "{", "try", "{", "_constructor", "=", "clazz", ".", "getDeclaredConstructor", "(", ")", ";", "_constructorWithQualifier", "=", "false", ";", "}", "catch", "(", "NoSuchMethodException", "ex", ")", "{", "}", "}", "if", "(", "_constructor", "=", "=", "null", ")", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "clazz", ".", "getName", "(", ")", "+", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "clazz", "=", "clazz", ";", "this", ".", "constructorWithQualifier", "=", "_constructorWithQualifier", ";", "this", ".", "constructor", "=", "_constructor", ";", "}", "catch", "(", "SecurityException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "T", "construct", "(", "byte", "type", ")", "{", "try", "{", "if", "(", "constructorWithQualifier", ")", "return", "constructor", ".", "newInstance", "(", "type", ")", ";", "else", "return", "constructor", ".", "newInstance", "(", ")", ";", "}", "catch", "(", "InstantiationException", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "catch", "(", "IllegalAccessException", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "catch", "(", "IllegalArgumentException", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "catch", "(", "InvocationTargetException", "ex", ")", "{", "throw", "Throwables", ".", "propagate", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "DataObjectInputAdapter", "(", "DataInput", "in", ")", "{", "this", ".", "in", "=", "in", ";", "if", "(", "in", "instanceof", "InputStream", ")", "is", "=", "(", "InputStream", ")", "in", ";", "else", "is", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "readObject", "(", ")", "throws", "ClassNotFoundException", ",", "IOException", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "available", "(", ")", "throws", "IOException", "{", "if", "(", "is", "!", "=", "null", ")", "return", "is", ".", "available", "(", ")", ";", "else", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "if", "(", "is", "!", "=", "null", ")", "is", ".", "close", "(", ")", ";", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "skip", "(", "long", "n", ")", "throws", "IOException", "{", "if", "(", "is", "!", "=", "null", ")", "{", "return", "is", ".", "skip", "(", "n", ")", ";", "}", "else", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "read", "(", ")", "throws", "IOException", "{", "return", "readUnsignedByte", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "read", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "readFully", "(", "b", ")", ";", "return", "b", ".", "length", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "read", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "readFully", "(", "b", ",", "off", ",", "len", ")", ";", "return", "len", ";", "}", "</s>"]
["<s>", "public", "int", "skipBytes", "(", "int", "n", ")", "throws", "IOException", "{", "return", "in", ".", "skipBytes", "(", "n", ")", ";", "}", "</s>"]
["<s>", "public", "int", "readUnsignedShort", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readUnsignedShort", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "readUnsignedByte", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readUnsignedByte", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "readUTF", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readUTF", "(", ")", ";", "}", "</s>"]
["<s>", "public", "short", "readShort", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readShort", "(", ")", ";", "}", "</s>"]
["<s>", "public", "long", "readLong", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readLong", "(", ")", ";", "}", "</s>"]
["<s>", "public", "String", "readLine", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readLine", "(", ")", ";", "}", "</s>"]
["<s>", "public", "int", "readInt", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readInt", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "readFully", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "in", ".", "readFully", "(", "b", ",", "off", ",", "len", ")", ";", "}", "</s>"]
["<s>", "public", "void", "readFully", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "in", ".", "readFully", "(", "b", ")", ";", "}", "</s>"]
["<s>", "public", "float", "readFloat", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readFloat", "(", ")", ";", "}", "</s>"]
["<s>", "public", "double", "readDouble", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readDouble", "(", ")", ";", "}", "</s>"]
["<s>", "public", "char", "readChar", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readChar", "(", ")", ";", "}", "</s>"]
["<s>", "public", "byte", "readByte", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readByte", "(", ")", ";", "}", "</s>"]
["<s>", "public", "boolean", "readBoolean", "(", ")", "throws", "IOException", "{", "return", "in", ".", "readBoolean", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "Persistable", "persistable", "(", "final", "Streamable", "streamable", ")", "{", "return", "new", "Persistable", "(", ")", "{", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "streamable", ".", "size", "(", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "ByteBuffer", "buffer", ")", "{", "try", "{", "streamable", ".", "write", "(", "new", "ByteBufferOutputStream", "(", "buffer", ")", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "@", "Override", "public", "void", "read", "(", "ByteBuffer", "buffer", ")", "{", "try", "{", "streamable", ".", "read", "(", "new", "ByteBufferInputStream", "(", "buffer", ")", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "streamable", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "ByteBuffer", "buffer", ")", "{", "try", "{", "streamable", ".", "write", "(", "new", "ByteBufferOutputStream", "(", "buffer", ")", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read", "(", "ByteBuffer", "buffer", ")", "{", "try", "{", "streamable", ".", "read", "(", "new", "ByteBufferInputStream", "(", "buffer", ")", ")", ";", "}", "catch", "(", "IOException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "static", "Persistable", "persistable", "(", "final", "ByteBuffer", "buffer", ")", "{", "return", "new", "Persistable", "(", ")", "{", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "buffer", ".", "limit", "(", ")", ";", "}", "@", "Override", "public", "void", "write", "(", "ByteBuffer", "buffer1", ")", "{", "buffer1", ".", "put", "(", "buffer", ")", ";", "buffer1", ".", "flip", "(", ")", ";", "}", "@", "Override", "public", "void", "read", "(", "ByteBuffer", "buffer1", ")", "{", "buffer", ".", "rewind", "(", ")", ";", "buffer", ".", "put", "(", "buffer1", ")", ";", "buffer", ".", "rewind", "(", ")", ";", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "size", "(", ")", "{", "return", "buffer", ".", "limit", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "write", "(", "ByteBuffer", "buffer1", ")", "{", "buffer1", ".", "put", "(", "buffer", ")", ";", "buffer1", ".", "flip", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "read", "(", "ByteBuffer", "buffer1", ")", "{", "buffer", ".", "rewind", "(", ")", ";", "buffer", ".", "put", "(", "buffer1", ")", ";", "buffer", ".", "rewind", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "byte", "[", "]", "toByteArray", "(", "ByteBuffer", "buffer", ")", "{", "if", "(", "buffer", ".", "hasArray", "(", ")", "&", "&", "buffer", ".", "arrayOffset", "(", ")", "=", "=", "0", "&", "&", "buffer", ".", "position", "(", ")", "=", "=", "0", "&", "&", "buffer", ".", "limit", "(", ")", "=", "=", "buffer", ".", "capacity", "(", ")", "&", "&", "buffer", ".", "array", "(", ")", ".", "length", "=", "=", "buffer", ".", "capacity", "(", ")", ")", "{", "final", "byte", "[", "]", "array", "=", "buffer", ".", "array", "(", ")", ";", "return", "array", ";", "}", "final", "int", "p", "=", "buffer", ".", "position", "(", ")", ";", "final", "byte", "[", "]", "array", "=", "new", "byte", "[", "buffer", ".", "remaining", "(", ")", "]", ";", "buffer", ".", "get", "(", "array", ")", ";", "buffer", ".", "position", "(", "p", ")", ";", "return", "array", ";", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "copyOf", "(", "ByteBuffer", "buffer", ")", "{", "final", "int", "n", "=", "buffer", ".", "capacity", "(", ")", ";", "final", "ByteBuffer", "buffer2", "=", "ByteBuffer", ".", "allocate", "(", "n", ")", ";", "final", "int", "p", "=", "buffer", ".", "position", "(", ")", ";", "buffer", ".", "position", "(", "0", ")", ";", "final", "int", "l", "=", "buffer", ".", "limit", "(", ")", ";", "buffer", ".", "limit", "(", "n", ")", ";", "buffer2", ".", "put", "(", "buffer", ")", ";", "buffer2", ".", "flip", "(", ")", ";", "buffer", ".", "position", "(", "p", ")", ";", "buffer", ".", "limit", "(", "l", ")", ";", "return", "buffer2", ";", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "slice", "(", "ByteBuffer", "buffer", ",", "int", "start", ",", "int", "length", ")", "{", "final", "int", "l", "=", "buffer", ".", "limit", "(", ")", ";", "final", "int", "p", "=", "buffer", ".", "position", "(", ")", ";", "buffer", ".", "limit", "(", "start", "+", "length", ")", ";", "buffer", ".", "position", "(", "start", ")", ";", "final", "ByteBuffer", "slice", "=", "buffer", ".", "slice", "(", ")", ";", "buffer", ".", "limit", "(", "l", ")", ";", "buffer", ".", "position", "(", "p", ")", ";", "return", "slice", ";", "}", "</s>"]
["<s>", "public", "static", "ByteBuffer", "slice", "(", "ByteBuffer", "buffer", ",", "int", "length", ")", "{", "final", "int", "l", "=", "buffer", ".", "limit", "(", ")", ";", "buffer", ".", "limit", "(", "buffer", ".", "position", "(", ")", "+", "length", ")", ";", "final", "ByteBuffer", "slice", "=", "buffer", ".", "slice", "(", ")", ";", "buffer", ".", "limit", "(", "l", ")", ";", "buffer", ".", "position", "(", "buffer", ".", "position", "(", ")", "+", "length", ")", ";", "return", "slice", ";", "}", "</s>"]
["<s>", "private", "Persistables", "(", ")", "{", "}", "</s>"]
["<s>", "public", "MessageDigestChecksum", "(", "String", "algorithm", ")", "{", "try", "{", "md", "=", "MessageDigest", ".", "getInstance", "(", "algorithm", ")", ";", "}", "catch", "(", "NoSuchAlgorithmException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "reset", "(", ")", "{", "md", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "byte", "b", ")", "{", "md", ".", "update", "(", "b", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "byte", "[", "]", "array", ")", "{", "md", ".", "update", "(", "array", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "ByteBuffer", "buffer", ")", "{", "md", ".", "update", "(", "buffer", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getChecksum", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "public", "DataObjectOutputAdapter", "(", "DataOutput", "out", ")", "{", "this", ".", "out", "=", "out", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "writeObject", "(", "Object", "obj", ")", "throws", "IOException", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "close", "(", ")", "throws", "IOException", "{", "if", "(", "out", "instanceof", "OutputStream", ")", "(", "(", "OutputStream", ")", "out", ")", ".", "close", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "flush", "(", ")", "throws", "IOException", "{", "if", "(", "out", "instanceof", "OutputStream", ")", "(", "(", "OutputStream", ")", "out", ")", ".", "flush", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeUTF", "(", "String", "s", ")", "throws", "IOException", "{", "out", ".", "writeUTF", "(", "s", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeShort", "(", "int", "v", ")", "throws", "IOException", "{", "out", ".", "writeShort", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeLong", "(", "long", "v", ")", "throws", "IOException", "{", "out", ".", "writeLong", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeInt", "(", "int", "v", ")", "throws", "IOException", "{", "out", ".", "writeInt", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeFloat", "(", "float", "v", ")", "throws", "IOException", "{", "out", ".", "writeFloat", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeDouble", "(", "double", "v", ")", "throws", "IOException", "{", "out", ".", "writeDouble", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeChars", "(", "String", "s", ")", "throws", "IOException", "{", "out", ".", "writeChars", "(", "s", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeChar", "(", "int", "v", ")", "throws", "IOException", "{", "out", ".", "writeChar", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeBytes", "(", "String", "s", ")", "throws", "IOException", "{", "out", ".", "writeBytes", "(", "s", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeByte", "(", "int", "v", ")", "throws", "IOException", "{", "out", ".", "writeByte", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "writeBoolean", "(", "boolean", "v", ")", "throws", "IOException", "{", "out", ".", "writeBoolean", "(", "v", ")", ";", "}", "</s>"]
["<s>", "public", "void", "write", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "out", ".", "write", "(", "b", ",", "off", ",", "len", ")", ";", "}", "</s>"]
["<s>", "public", "void", "write", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "out", ".", "write", "(", "b", ")", ";", "}", "</s>"]
["<s>", "public", "void", "write", "(", "int", "b", ")", "throws", "IOException", "{", "out", ".", "write", "(", "b", ")", ";", "}", "</s>"]
["<s>", "int", "size", "(", ")", ";", "</s>"]
["<s>", "void", "write", "(", "ByteBuffer", "buffer", ")", ";", "</s>"]
["<s>", "void", "read", "(", "ByteBuffer", "buffer", ")", ";", "</s>"]
["<s>", "@", "Override", "public", "void", "reset", "(", ")", "{", "counter", "=", "0", ";", "hasher1", ".", "reset", "(", ")", ";", "hasher2", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "byte", "b", ")", "{", "hasher1", ".", "update", "(", "b", ")", ";", "if", "(", "counter", "%", "<NUM_LIT:2>", "=", "=", "0", ")", "hasher2", ".", "update", "(", "b", ")", ";", "counter", "+", "+", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "byte", "[", "]", "array", ")", "{", "for", "(", "byte", "b", ":", "array", ")", "update", "(", "b", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "ByteBuffer", "buffer", ")", "{", "while", "(", "buffer", ".", "hasRemaining", "(", ")", ")", "update", "(", "buffer", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getChecksum", "(", ")", "{", "final", "byte", "[", "]", "array", "=", "new", "byte", "[", "<NUM_LIT:16>", "]", ";", "System", ".", "arraycopy", "(", "hasher1", ".", "getChecksum", "(", ")", ",", "0", ",", "array", ",", "0", ",", "<NUM_LIT:8>", ")", ";", "System", ".", "arraycopy", "(", "hasher2", ".", "getChecksum", "(", ")", ",", "0", ",", "array", ",", "<NUM_LIT:8>", ",", "<NUM_LIT:8>", ")", ";", "return", "array", ";", "}", "</s>"]
["<s>", "public", "Hasher", "(", ")", "{", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "reset", "(", ")", "{", "value", "=", "START", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "[", "]", "getChecksum", "(", ")", "{", "return", "Longs", ".", "toByteArray", "(", "value", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "byte", "b", ")", "{", "value", "=", "(", "value", "*", "MULT", ")", "^", "TABLE", "[", "(", "int", ")", "b", "&", "<NUM_LIT>", "]", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "byte", "[", "]", "array", ")", "{", "for", "(", "byte", "b", ":", "array", ")", "update", "(", "b", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "update", "(", "ByteBuffer", "buffer", ")", "{", "while", "(", "buffer", ".", "hasRemaining", "(", ")", ")", "update", "(", "buffer", ".", "get", "(", ")", ")", ";", "}", "</s>"]
["<s>", "private", "static", "long", "[", "]", "createLookupTable", "(", ")", "{", "long", "[", "]", "table", "=", "new", "long", "[", "<NUM_LIT>", "]", ";", "long", "h", "=", "<NUM_LIT>", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "<NUM_LIT>", ";", "i", "+", "+", ")", "{", "for", "(", "int", "j", "=", "0", ";", "j", "<", "<NUM_LIT:31>", ";", "j", "+", "+", ")", "{", "h", "=", "(", "h", ">", ">", ">", "<NUM_LIT:7>", ")", "^", "h", ";", "h", "=", "(", "h", "<", "<", "<NUM_LIT:11>", ")", "^", "h", ";", "h", "=", "(", "h", ">", ">", ">", "<NUM_LIT:10>", ")", "^", "h", ";", "}", "table", "[", "i", "]", "=", "h", ";", "}", "return", "table", ";", "}", "</s>"]
["<s>", "int", "size", "(", ")", ";", "</s>"]
["<s>", "void", "write", "(", "DataOutput", "out", ")", "throws", "IOException", ";", "</s>"]
["<s>", "void", "read", "(", "DataInput", "in", ")", "throws", "IOException", ";", "</s>"]
["<s>", "void", "read", "(", "long", "version", ",", "ByteBuffer", "buffer", ")", ";", "</s>"]
["<s>", "void", "reset", "(", ")", ";", "</s>"]
["<s>", "void", "update", "(", "byte", "b", ")", ";", "</s>"]
["<s>", "void", "update", "(", "byte", "[", "]", "array", ")", ";", "</s>"]
["<s>", "void", "update", "(", "ByteBuffer", "buffer", ")", ";", "</s>"]
["<s>", "byte", "[", "]", "getChecksum", "(", ")", ";", "</s>"]
["<s>", "public", "ByteBufferInputStream", "(", "ByteBuffer", "buffer", ")", "{", "this", ".", "buffer", "=", "buffer", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "readObject", "(", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "readBoolean", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "get", "(", ")", "!", "=", "0", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "byte", "readByte", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "get", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "char", "readChar", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "getChar", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "double", "readDouble", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "getDouble", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "float", "readFloat", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "getFloat", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readFully", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "get", "(", "b", ",", "off", ",", "len", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "readFully", "(", "byte", "[", "]", "b", ")", "throws", "IOException", "{", "try", "{", "buffer", ".", "get", "(", "b", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "readInt", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "getInt", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "readLine", "(", ")", "throws", "IOException", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "readLong", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "getLong", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "short", "readShort", "(", ")", "throws", "IOException", "{", "try", "{", "return", "buffer", ".", "getShort", "(", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "readUnsignedByte", "(", ")", "throws", "IOException", "{", "try", "{", "return", "unsignedByte", "(", "buffer", ".", "get", "(", ")", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "readUnsignedShort", "(", ")", "throws", "IOException", "{", "try", "{", "return", "unsignedShort", "(", "buffer", ".", "getShort", "(", ")", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "throw", "new", "EOFException", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "readUTF", "(", ")", "throws", "IOException", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "skipBytes", "(", "int", "n", ")", "throws", "IOException", "{", "n", "=", "Math", ".", "min", "(", "n", ",", "available", "(", ")", ")", ";", "buffer", ".", "position", "(", "buffer", ".", "position", "(", ")", "+", "n", ")", ";", "return", "n", ";", "}", "</s>"]
["<s>", "private", "static", "short", "unsignedByte", "(", "byte", "n", ")", "{", "return", "(", "short", ")", "(", "(", "n", "<", "<", "<NUM_LIT:8>", ")", ">", ">", ">", "<NUM_LIT:8>", ")", ";", "}", "</s>"]
["<s>", "private", "static", "int", "unsignedShort", "(", "short", "n", ")", "{", "return", "(", "(", "n", "<", "<", "<NUM_LIT:16>", ")", ">", ">", ">", "<NUM_LIT:16>", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "available", "(", ")", "throws", "IOException", "{", "return", "buffer", ".", "limit", "(", ")", "-", "buffer", ".", "position", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "read", "(", ")", "throws", "IOException", "{", "try", "{", "return", "unsignedByte", "(", "buffer", ".", "get", "(", ")", ")", ";", "}", "catch", "(", "BufferUnderflowException", "e", ")", "{", "return", "-", "1", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "read", "(", "byte", "[", "]", "b", ",", "int", "off", ",", "int", "len", ")", "throws", "IOException", "{", "if", "(", "len", "=", "=", "0", ")", "return", "0", ";", "if", "(", "available", "(", ")", "=", "=", "0", ")", "return", "-", "1", ";", "int", "n", "=", "Math", ".", "min", "(", "len", ",", "available", "(", ")", ")", ";", "buffer", ".", "get", "(", "b", ",", "off", ",", "len", ")", ";", "return", "n", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "skip", "(", "long", "n", ")", "throws", "IOException", "{", "return", "skipBytes", "(", "(", "int", ")", "n", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "markSupported", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "mark", "(", "int", "readlimit", ")", "{", "buffer", ".", "mark", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "void", "reset", "(", ")", "throws", "IOException", "{", "buffer", ".", "reset", "(", ")", ";", "}", "</s>"]
["<s>", "private", "QueueFactory", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "<", "T", ">", "BlockingQueue", "<", "T", ">", "getInstance", "(", "int", "maxSize", ")", "{", "if", "(", "maxSize", "=", "=", "0", ")", "return", "new", "SynchronousQueue", "<", "T", ">", "(", ")", ";", "else", "if", "(", "maxSize", ">", "0", ")", "return", "new", "ArrayBlockingQueue", "<", "T", ">", "(", "maxSize", ")", ";", "else", "return", "new", "LinkedTransferQueue", "<", "T", ">", "(", ")", ";", "}", "</s>"]
["<s>", "Executor", "getExecutor", "(", ")", ";", "</s>"]
["<s>", "public", "CustomThreadFactory", "(", "String", "poolName", ")", "{", "SecurityManager", "s", "=", "System", ".", "getSecurityManager", "(", ")", ";", "group", "=", "(", "s", "!", "=", "null", ")", "?", "s", ".", "getThreadGroup", "(", ")", ":", "Thread", ".", "currentThread", "(", ")", ".", "getThreadGroup", "(", ")", ";", "namePrefix", "=", "poolName", "+", "\"", "<STR_LIT>", "\"", ";", "}", "</s>"]
["<s>", "public", "int", "getPriority", "(", ")", "{", "return", "priority", ";", "}", "</s>"]
["<s>", "public", "void", "setPriority", "(", "int", "priority", ")", "{", "this", ".", "priority", "=", "priority", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Thread", "newThread", "(", "Runnable", "r", ")", "{", "Thread", "t", "=", "allocateThread", "(", "group", ",", "r", ",", "namePrefix", "+", "threadNumber", ".", "getAndIncrement", "(", ")", ")", ";", "if", "(", "t", ".", "isDaemon", "(", ")", ")", "t", ".", "setDaemon", "(", "false", ")", ";", "if", "(", "t", ".", "getPriority", "(", ")", "!", "=", "priority", ")", "t", ".", "setPriority", "(", "priority", ")", ";", "return", "t", ";", "}", "</s>"]
["<s>", "protected", "Thread", "allocateThread", "(", "ThreadGroup", "group", ",", "Runnable", "target", ",", "String", "name", ")", "{", "return", "new", "Thread", "(", "group", ",", "target", ",", "name", ")", ";", "}", "</s>"]
["<s>", "public", "OrderedThreadPoolExecutor", "(", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ",", "ThreadFactory", "threadFactory", ",", "RejectedExecutionHandler", "handler", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ",", "threadFactory", ",", "handler", ")", ";", "this", ".", "maxQueueSize", "=", "maxQueueSize", ";", "}", "</s>"]
["<s>", "public", "OrderedThreadPoolExecutor", "(", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ",", "RejectedExecutionHandler", "handler", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ",", "handler", ")", ";", "this", ".", "maxQueueSize", "=", "maxQueueSize", ";", "}", "</s>"]
["<s>", "public", "OrderedThreadPoolExecutor", "(", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ",", "ThreadFactory", "threadFactory", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ",", "threadFactory", ")", ";", "this", ".", "maxQueueSize", "=", "maxQueueSize", ";", "}", "</s>"]
["<s>", "public", "OrderedThreadPoolExecutor", "(", "int", "corePoolSize", ",", "int", "maximumPoolSize", ",", "long", "keepAliveTime", ",", "TimeUnit", "unit", ",", "int", "maxQueueSize", ")", "{", "super", "(", "corePoolSize", ",", "maximumPoolSize", ",", "keepAliveTime", ",", "unit", ",", "new", "SynchronousQueue", "<", "Runnable", ">", "(", ")", ")", ";", "this", ".", "maxQueueSize", "=", "maxQueueSize", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "execute", "(", "Runnable", "task", ")", "{", "if", "(", "task", "instanceof", "ChildExecutor", ")", "super", ".", "execute", "(", "task", ")", ";", "else", "getChildExecutor", "(", "task", ")", ".", "execute", "(", "task", ")", ";", "}", "</s>"]
["<s>", "protected", "abstract", "Object", "getChildExecutorKey", "(", "Runnable", "task", ")", ";", "</s>"]
["<s>", "protected", "boolean", "removeChildExecutor", "(", "Object", "key", ")", "{", "return", "childExecutors", ".", "remove", "(", "key", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "protected", "Executor", "getChildExecutor", "(", "Runnable", "task", ")", "{", "Object", "key", "=", "getChildExecutorKey", "(", "task", ")", ";", "Executor", "executor", "=", "childExecutors", ".", "get", "(", "key", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "{", "executor", "=", "new", "ChildExecutor", "(", ")", ";", "Executor", "oldExecutor", "=", "childExecutors", ".", "putIfAbsent", "(", "key", ",", "executor", ")", ";", "if", "(", "oldExecutor", "!", "=", "null", ")", "{", "executor", "=", "oldExecutor", ";", "}", "}", "return", "executor", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "execute", "(", "Runnable", "command", ")", "{", "tasks", ".", "add", "(", "command", ")", ";", "if", "(", "!", "isRunning", ".", "get", "(", ")", ")", "OrderedThreadPoolExecutor", ".", "super", ".", "execute", "(", "this", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "run", "(", ")", "{", "if", "(", "isRunning", ".", "compareAndSet", "(", "false", ",", "true", ")", ")", "{", "try", "{", "Thread", "thread", "=", "Thread", ".", "currentThread", "(", ")", ";", "for", "(", ";", ";", ")", "{", "final", "Runnable", "task", "=", "tasks", ".", "poll", "(", ")", ";", "if", "(", "task", "=", "=", "null", ")", "break", ";", "beforeExecute", "(", "thread", ",", "task", ")", ";", "try", "{", "task", ".", "run", "(", ")", ";", "afterExecute", "(", "task", ",", "null", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "afterExecute", "(", "task", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "}", "finally", "{", "isRunning", ".", "set", "(", "false", ")", ";", "}", "if", "(", "!", "isRunning", ".", "get", "(", ")", "&", "&", "tasks", ".", "peek", "(", ")", "!", "=", "null", ")", "OrderedThreadPoolExecutor", ".", "super", ".", "execute", "(", "this", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isDone", "(", ")", "{", "return", "done", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "V", "get", "(", ")", "throws", "InterruptedException", ",", "ExecutionException", "{", "lock", ".", "lock", "(", ")", ";", "try", "{", "while", "(", "!", "done", ")", "cond", ".", "await", "(", ")", ";", "return", "getResult", "(", ")", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "V", "get", "(", "long", "timeout", ",", "TimeUnit", "unit", ")", "throws", "InterruptedException", ",", "ExecutionException", ",", "TimeoutException", "{", "lock", ".", "lock", "(", ")", ";", "try", "{", "if", "(", "!", "cond", ".", "await", "(", "timeout", ",", "unit", ")", ")", "throw", "new", "TimeoutException", "(", ")", ";", "else", "return", "getResult", "(", ")", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "V", "getResult", "(", ")", "throws", "ExecutionException", "{", "if", "(", "exception", "!", "=", "null", ")", "throw", "new", "ExecutionException", "(", "exception", ")", ";", "else", "return", "result", ";", "}", "</s>"]
["<s>", "public", "void", "setResult", "(", "V", "result", ")", "{", "this", ".", "result", "=", "result", ";", "}", "</s>"]
["<s>", "public", "void", "setException", "(", "Throwable", "exception", ")", "{", "this", ".", "exception", "=", "exception", ";", "}", "</s>"]
["<s>", "public", "void", "done", "(", ")", "{", "lock", ".", "lock", "(", ")", ";", "try", "{", "cond", ".", "signalAll", "(", ")", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "done", "(", "V", "result", ")", "{", "lock", ".", "lock", "(", ")", ";", "try", "{", "setResult", "(", "result", ")", ";", "cond", ".", "signalAll", "(", ")", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "failed", "(", "Throwable", "exception", ")", "{", "lock", ".", "lock", "(", ")", ";", "try", "{", "setException", "(", "exception", ")", ";", "cond", ".", "signalAll", "(", ")", ";", "}", "finally", "{", "lock", ".", "unlock", "(", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "cancel", "(", "boolean", "mayInterruptIfRunning", ")", "{", "throw", "new", "UnsupportedOperationException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isCancelled", "(", ")", "{", "return", "false", ";", "}", "</s>"]
["<s>", "private", "CurrentThreadExecutor", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "execute", "(", "Runnable", "command", ")", "{", "command", ".", "run", "(", ")", ";", "}", "</s>"]
["<s>", "public", "static", "void", "register", "(", "String", "name", ",", "ThreadPoolExecutor", "executor", ")", "{", "new", "ThreadPoolExecutorMonitor", "(", "name", ",", "executor", ")", ";", "}", "</s>"]
["<s>", "public", "ThreadPoolExecutorMonitor", "(", "String", "name", ",", "ThreadPoolExecutor", "executor", ")", "{", "super", "(", "\"", "<STR_LIT>", "\"", "+", "name", ",", "executor", ")", ";", "registerMBean", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isTerminating", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "false", ";", "return", "executor", ".", "isTerminating", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isTerminated", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "false", ";", "return", "executor", ".", "isTerminated", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isShutdown", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "false", ";", "return", "executor", ".", "isShutdown", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getTaskCount", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getTaskCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "getRejectedExecutionHandler", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "null", ";", "return", "executor", ".", "getRejectedExecutionHandler", "(", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getPoolSize", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getPoolSize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getMaximumPoolSize", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getMaximumPoolSize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getLargestPoolSize", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getLargestPoolSize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getKeepAliveTime", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getKeepAliveTime", "(", "TimeUnit", ".", "MILLISECONDS", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getCorePoolSize", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getCorePoolSize", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "long", "getCompletedTaskCount", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getCompletedTaskCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getActiveCount", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getActiveCount", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "int", "getQueuedTasks", "(", ")", "{", "final", "ThreadPoolExecutor", "executor", "=", "getMonitored", "(", ")", ";", "if", "(", "executor", "=", "=", "null", ")", "return", "-", "1", ";", "return", "executor", ".", "getQueue", "(", ")", ".", "size", "(", ")", ";", "}", "</s>"]
["<s>", "public", "PeriodicMonitor", "(", "Class", "mbeanInterface", ",", "String", "name", ")", "{", "super", "(", "mbeanInterface", ",", "true", ",", "new", "NotificationBroadcasterSupport", "(", ")", ")", ";", "this", ".", "name", "=", "name", ";", "this", ".", "lastCollectTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "this", ".", "monitored", "=", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "collectAndResetCounters1", "(", ")", ";", "registerMBean", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "destroy", "(", ")", "throws", "Exception", "{", "unregisterMBean", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "setMonitoredObject", "(", "Object", "obj", ")", "{", "this", ".", "monitored", "=", "new", "WeakReference", "<", "Object", ">", "(", "obj", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "isMonitoredObjectAlive", "(", ")", "{", "return", "monitored", "=", "=", "null", "|", "|", "monitored", ".", "get", "(", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "private", "void", "registerMBean", "(", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "MBeanServer", "mbs", "=", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ";", "ObjectName", "mxbeanName", "=", "new", "ObjectName", "(", "name", ")", ";", "mbs", ".", "registerMBean", "(", "this", ",", "mxbeanName", ")", ";", "timer", ".", "addNotificationListener", "(", "this", ",", "new", "NotificationFilter", "(", ")", "{", "@", "Override", "public", "boolean", "isNotificationEnabled", "(", "Notification", "notification", ")", "{", "return", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "notification", ".", "getType", "(", ")", ")", ";", "}", "}", ",", "null", ")", ";", "this", ".", "registered", "=", "true", ";", "}", "catch", "(", "InstanceAlreadyExistsException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "MBeanRegistrationException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "NotCompliantMBeanException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "MalformedObjectNameException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isNotificationEnabled", "(", "Notification", "notification", ")", "{", "return", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "notification", ".", "getType", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "void", "unregisterMBean", "(", ")", "{", "try", "{", "if", "(", "registered", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ".", "unregisterMBean", "(", "new", "ObjectName", "(", "name", ")", ")", ";", "timer", ".", "stop", "(", ")", ";", "}", "this", ".", "registered", "=", "false", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "MBeanNotificationInfo", "[", "]", "getNotificationInfo", "(", ")", "{", "String", "[", "]", "types", "=", "new", "String", "[", "]", "{", "AttributeChangeNotification", ".", "ATTRIBUTE_CHANGE", "}", ";", "String", "_name", "=", "AttributeChangeNotification", ".", "class", ".", "getName", "(", ")", ";", "String", "description", "=", "\"", "<STR_LIT>", "\"", ";", "MBeanNotificationInfo", "info", "=", "new", "MBeanNotificationInfo", "(", "types", ",", "_name", ",", "description", ")", ";", "return", "new", "MBeanNotificationInfo", "[", "]", "{", "info", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "handleNotification", "(", "Notification", "notification", ",", "Object", "handback", ")", "{", "if", "(", "\"", "<STR_LIT>", "\"", ".", "equals", "(", "notification", ".", "getType", "(", ")", ")", ")", "{", "refresh", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "refresh", "(", ")", "{", "collectAndResetCounters1", "(", ")", ";", "Notification", "n", "=", "new", "AttributeChangeNotification", "(", "this", ",", "notificationSequenceNumber", "+", "+", ",", "System", ".", "currentTimeMillis", "(", ")", ",", "\"", "<STR_LIT>", "\"", ",", "\"", "\"", ",", "null", ",", "null", ",", "null", ")", ";", "sendNotification", "(", "n", ")", ";", "}", "</s>"]
["<s>", "protected", "long", "getMillisSinceLastCollect", "(", ")", "{", "return", "System", ".", "currentTimeMillis", "(", ")", "-", "lastCollectTime", ";", "}", "</s>"]
["<s>", "public", "synchronized", "int", "getTimerPeriod", "(", ")", "{", "return", "timerPeriod", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setTimerPeriod", "(", "int", "timerPeriod", ")", "{", "if", "(", "timerPeriod", "!", "=", "this", ".", "timerPeriod", ")", "{", "this", ".", "timerPeriod", "=", "timerPeriod", ";", "if", "(", "timerStarted", ")", "{", "stopUpdates", "(", ")", ";", "startUpdates", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "public", "synchronized", "boolean", "isUpdates", "(", ")", "{", "return", "timerStarted", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "setUpdates", "(", "boolean", "value", ")", "{", "if", "(", "value", "=", "=", "timerStarted", ")", "return", ";", "if", "(", "!", "timerStarted", ")", "startUpdates", "(", ")", ";", "else", "stopUpdates", "(", ")", ";", "}", "</s>"]
["<s>", "public", "synchronized", "void", "startUpdates", "(", ")", "{", "if", "(", "!", "timerStarted", ")", "{", "timer", ".", "addNotification", "(", "\"", "<STR_LIT>", "\"", ",", "null", ",", "null", ",", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ",", "timerPeriod", ")", ";", "this", ".", "timerStarted", "=", "true", ";", "timer", ".", "start", "(", ")", ";", "}", "}", "</s>"]
["<s>", "public", "synchronized", "void", "stopUpdates", "(", ")", "{", "if", "(", "timerStarted", ")", "{", "try", "{", "timer", ".", "removeNotifications", "(", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "timerStarted", "=", "false", ";", "}", "catch", "(", "InstanceNotFoundException", "ex", ")", "{", "}", "timer", ".", "stop", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "collectAndResetCounters1", "(", ")", "{", "if", "(", "registered", ")", "{", "if", "(", "isMonitoredObjectAlive", "(", ")", ")", "unregisterMBean", "(", ")", ";", "else", "{", "collectAndResetCounters", "(", ")", ";", "lastCollectTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "return", ";", "}", "}", "resetCounters", "(", ")", ";", "lastCollectTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "initCounters", "(", ")", "{", "}", "</s>"]
["<s>", "protected", "abstract", "void", "collectAndResetCounters", "(", ")", ";", "</s>"]
["<s>", "protected", "abstract", "void", "resetCounters", "(", ")", ";", "</s>"]
["<s>", "boolean", "isTerminating", "(", ")", ";", "</s>"]
["<s>", "boolean", "isTerminated", "(", ")", ";", "</s>"]
["<s>", "boolean", "isShutdown", "(", ")", ";", "</s>"]
["<s>", "long", "getTaskCount", "(", ")", ";", "</s>"]
["<s>", "String", "getRejectedExecutionHandler", "(", ")", ";", "</s>"]
["<s>", "int", "getPoolSize", "(", ")", ";", "</s>"]
["<s>", "int", "getMaximumPoolSize", "(", ")", ";", "</s>"]
["<s>", "int", "getLargestPoolSize", "(", ")", ";", "</s>"]
["<s>", "long", "getKeepAliveTime", "(", ")", ";", "</s>"]
["<s>", "int", "getCorePoolSize", "(", ")", ";", "</s>"]
["<s>", "long", "getCompletedTaskCount", "(", ")", ";", "</s>"]
["<s>", "int", "getActiveCount", "(", ")", ";", "</s>"]
["<s>", "int", "getQueuedTasks", "(", ")", ";", "</s>"]
["<s>", "public", "Monitor", "(", "String", "name", ",", "T", "monitored", ")", "{", "this", ".", "name", "=", "name", ";", "this", ".", "monitored", "=", "new", "WeakReference", "<", "T", ">", "(", "monitored", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "registerMBean", "(", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "destroy", "(", ")", "throws", "Exception", "{", "unregisterMBean", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "T", "getMonitored", "(", ")", "{", "T", "m", "=", "monitored", ".", "get", "(", ")", ";", "if", "(", "m", "=", "=", "null", ")", "unregisterMBean", "(", ")", ";", "return", "m", ";", "}", "</s>"]
["<s>", "protected", "boolean", "isMonitoredObjectAlive", "(", ")", "{", "return", "monitored", "=", "=", "null", "|", "|", "monitored", ".", "get", "(", ")", "!", "=", "null", ";", "}", "</s>"]
["<s>", "public", "void", "registerMBean", "(", ")", "{", "try", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "MBeanServer", "mbs", "=", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ";", "ObjectName", "mxbeanName", "=", "new", "ObjectName", "(", "name", ")", ";", "mbs", ".", "registerMBean", "(", "this", ",", "mxbeanName", ")", ";", "this", ".", "registered", "=", "true", ";", "}", "catch", "(", "InstanceAlreadyExistsException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "MBeanRegistrationException", "ex", ")", "{", "throw", "new", "RuntimeException", "(", "ex", ")", ";", "}", "catch", "(", "NotCompliantMBeanException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "catch", "(", "MalformedObjectNameException", "ex", ")", "{", "throw", "new", "AssertionError", "(", "ex", ")", ";", "}", "}", "</s>"]
["<s>", "public", "void", "unregisterMBean", "(", ")", "{", "try", "{", "if", "(", "registered", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ".", "unregisterMBean", "(", "new", "ObjectName", "(", "name", ")", ")", ";", "}", "this", ".", "registered", "=", "false", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "e", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "synchronized", "String", "format", "(", "LogRecord", "record", ")", "{", "dat", ".", "setTime", "(", "record", ".", "getMillis", "(", ")", ")", ";", "String", "source", ";", "if", "(", "record", ".", "getSourceClassName", "(", ")", "!", "=", "null", ")", "{", "source", "=", "record", ".", "getSourceClassName", "(", ")", ";", "if", "(", "record", ".", "getSourceMethodName", "(", ")", "!", "=", "null", ")", "{", "source", "+", "=", "\"", "\"", "+", "record", ".", "getSourceMethodName", "(", ")", ";", "}", "}", "else", "{", "source", "=", "record", ".", "getLoggerName", "(", ")", ";", "}", "String", "message", "=", "formatMessage", "(", "record", ")", ";", "String", "throwable", "=", "\"", "\"", ";", "if", "(", "record", ".", "getThrown", "(", ")", "!", "=", "null", ")", "{", "StringWriter", "sw", "=", "new", "StringWriter", "(", ")", ";", "PrintWriter", "pw", "=", "new", "PrintWriter", "(", "sw", ")", ";", "pw", ".", "println", "(", ")", ";", "record", ".", "getThrown", "(", ")", ".", "printStackTrace", "(", "pw", ")", ";", "pw", ".", "close", "(", ")", ";", "throwable", "=", "sw", ".", "toString", "(", ")", ";", "}", "return", "String", ".", "format", "(", "format", ",", "dat", ",", "source", ",", "record", ".", "getLoggerName", "(", ")", ",", "record", ".", "getLevel", "(", ")", ".", "getLocalizedName", "(", ")", ",", "message", ",", "throwable", ",", "record", ".", "getThreadID", "(", ")", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "hex", "(", "long", "num", ")", "{", "return", "Long", ".", "toHexString", "(", "num", ")", ";", "}", "</s>"]
["<s>", "public", "static", "String", "hex", "(", "int", "num", ")", "{", "return", "Integer", ".", "toHexString", "(", "num", ")", ";", "}", "</s>"]
["<s>", "private", "LoggingUtils", "(", ")", "{", "}", "</s>"]
["<s>", "public", "static", "ConfigurableApplicationContext", "createContext", "(", "String", "defaultDomain", ",", "Resource", "xmlResource", ",", "Object", "properties", ",", "BeanFactoryPostProcessor", "beanFactoryPostProcessor", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ",", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ",", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", "}", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "new", "Object", "[", "]", "{", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ",", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ",", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", "}", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "System", ".", "getProperty", "(", "\"", "<STR_LIT>", "\"", ")", ")", ";", "final", "DefaultListableBeanFactory", "beanFactory", "=", "createBeanFactory", "(", ")", ";", "final", "GenericApplicationContext", "context", "=", "new", "GenericApplicationContext", "(", "beanFactory", ")", ";", "context", ".", "registerShutdownHook", "(", ")", ";", "if", "(", "properties", "!", "=", "null", ")", "{", "final", "PropertyPlaceholderConfigurer", "propertyPlaceholderConfigurer", "=", "new", "PropertyPlaceholderConfigurer", "(", ")", ";", "propertyPlaceholderConfigurer", ".", "setSystemPropertiesMode", "(", "PropertyPlaceholderConfigurer", ".", "SYSTEM_PROPERTIES_MODE_OVERRIDE", ")", ";", "if", "(", "properties", "instanceof", "Resource", ")", "propertyPlaceholderConfigurer", ".", "setLocation", "(", "(", "Resource", ")", "properties", ")", ";", "else", "if", "(", "properties", "instanceof", "Properties", ")", "propertyPlaceholderConfigurer", ".", "setProperties", "(", "(", "Properties", ")", "properties", ")", ";", "else", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", "+", "properties", "+", "\"", "<STR_LIT>", "\"", ")", ";", "context", ".", "addBeanFactoryPostProcessor", "(", "propertyPlaceholderConfigurer", ")", ";", "}", "context", ".", "registerBeanDefinition", "(", "\"", "<STR_LIT>", "\"", ",", "getMBeanExporterBeanDefinition", "(", "defaultDomain", ")", ")", ";", "context", ".", "addBeanFactoryPostProcessor", "(", "new", "BeanFactoryPostProcessor", "(", ")", "{", "@", "Override", "public", "void", "postProcessBeanFactory", "(", "ConfigurableListableBeanFactory", "beanFactory", ")", "throws", "BeansException", "{", "for", "(", "String", "beanName", ":", "beanFactory", ".", "getBeanDefinitionNames", "(", ")", ")", "{", "try", "{", "final", "BeanDefinition", "beanDefinition", "=", "beanFactory", ".", "getBeanDefinition", "(", "beanName", ")", ";", "if", "(", "beanDefinition", ".", "getBeanClassName", "(", ")", "!", "=", "null", ")", "{", "final", "Class", "<", "?", ">", "beanClass", "=", "Class", ".", "forName", "(", "beanDefinition", ".", "getBeanClassName", "(", ")", ")", ";", "if", "(", "Component", ".", "class", ".", "isAssignableFrom", "(", "beanClass", ")", ")", "beanDefinition", ".", "getConstructorArgumentValues", "(", ")", ".", "addIndexedArgumentValue", "(", "0", ",", "beanName", ")", ";", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "beanName", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "new", "Error", "(", "ex", ")", ";", "}", "}", "}", "}", ")", ";", "if", "(", "beanFactoryPostProcessor", "!", "=", "null", ")", "context", ".", "addBeanFactoryPostProcessor", "(", "beanFactoryPostProcessor", ")", ";", "beanFactory", ".", "registerCustomEditor", "(", "org", ".", "w3c", ".", "dom", ".", "Element", ".", "class", ",", "co", ".", "paralleluniverse", ".", "common", ".", "util", ".", "DOMElementProprtyEditor", ".", "class", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "beans", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "(", ")", ";", "beanFactory", ".", "addBeanPostProcessor", "(", "new", "BeanPostProcessor", "(", ")", "{", "@", "Override", "public", "Object", "postProcessBeforeInitialization", "(", "Object", "bean", ",", "String", "beanName", ")", "throws", "BeansException", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "beanName", ",", "bean", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "beans", ".", "put", "(", "beanName", ",", "bean", ")", ";", "if", "(", "bean", "instanceof", "Service", ")", "{", "final", "BeanDefinition", "beanDefinition", "=", "beanFactory", ".", "getBeanDefinition", "(", "beanName", ")", ";", "Collection", "<", "String", ">", "dependencies", "=", "getBeanDependencies", "(", "beanDefinition", ")", ";", "for", "(", "String", "dependeeName", ":", "dependencies", ")", "{", "Object", "dependee", "=", "beanFactory", ".", "getBean", "(", "dependeeName", ")", ";", "if", "(", "dependee", "instanceof", "Service", ")", "{", "(", "(", "Service", ")", "dependee", ")", ".", "addDependedBy", "(", "(", "Service", ")", "bean", ")", ";", "(", "(", "Service", ")", "bean", ")", ".", "addDependsOn", "(", "(", "Service", ")", "dependee", ")", ";", "}", "}", "}", "return", "bean", ";", "}", "@", "Override", "public", "Object", "postProcessAfterInitialization", "(", "Object", "bean", ",", "String", "beanName", ")", "throws", "BeansException", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "beanName", ",", "bean", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "return", "bean", ";", "}", "}", ")", ";", "final", "XmlBeanDefinitionReader", "xmlReader", "=", "new", "XmlBeanDefinitionReader", "(", "(", "BeanDefinitionRegistry", ")", "beanFactory", ")", ";", "xmlReader", ".", "loadBeanDefinitions", "(", "xmlResource", ")", ";", "context", ".", "refresh", "(", ")", ";", "try", "{", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "entry", ":", "beans", ".", "entrySet", "(", ")", ")", "{", "final", "String", "beanName", "=", "entry", ".", "getKey", "(", ")", ";", "final", "Object", "bean", "=", "entry", ".", "getValue", "(", ")", ";", "if", "(", "bean", "instanceof", "Component", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "beanName", ",", "bean", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "(", "(", "Component", ")", "bean", ")", ".", "postInit", "(", ")", ";", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "Throwables", ".", "propagate", "(", "e", ")", ";", "}", "return", "context", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "postProcessBeanFactory", "(", "ConfigurableListableBeanFactory", "beanFactory", ")", "throws", "BeansException", "{", "for", "(", "String", "beanName", ":", "beanFactory", ".", "getBeanDefinitionNames", "(", ")", ")", "{", "try", "{", "final", "BeanDefinition", "beanDefinition", "=", "beanFactory", ".", "getBeanDefinition", "(", "beanName", ")", ";", "if", "(", "beanDefinition", ".", "getBeanClassName", "(", ")", "!", "=", "null", ")", "{", "final", "Class", "<", "?", ">", "beanClass", "=", "Class", ".", "forName", "(", "beanDefinition", ".", "getBeanClassName", "(", ")", ")", ";", "if", "(", "Component", ".", "class", ".", "isAssignableFrom", "(", "beanClass", ")", ")", "beanDefinition", ".", "getConstructorArgumentValues", "(", ")", ".", "addIndexedArgumentValue", "(", "0", ",", "beanName", ")", ";", "}", "}", "catch", "(", "Exception", "ex", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "beanName", "+", "\"", "<STR_LIT>", "\"", ",", "ex", ")", ";", "throw", "new", "Error", "(", "ex", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "postProcessBeforeInitialization", "(", "Object", "bean", ",", "String", "beanName", ")", "throws", "BeansException", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "beanName", ",", "bean", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "beans", ".", "put", "(", "beanName", ",", "bean", ")", ";", "if", "(", "bean", "instanceof", "Service", ")", "{", "final", "BeanDefinition", "beanDefinition", "=", "beanFactory", ".", "getBeanDefinition", "(", "beanName", ")", ";", "Collection", "<", "String", ">", "dependencies", "=", "getBeanDependencies", "(", "beanDefinition", ")", ";", "for", "(", "String", "dependeeName", ":", "dependencies", ")", "{", "Object", "dependee", "=", "beanFactory", ".", "getBean", "(", "dependeeName", ")", ";", "if", "(", "dependee", "instanceof", "Service", ")", "{", "(", "(", "Service", ")", "dependee", ")", ".", "addDependedBy", "(", "(", "Service", ")", "bean", ")", ";", "(", "(", "Service", ")", "bean", ")", ".", "addDependsOn", "(", "(", "Service", ")", "dependee", ")", ";", "}", "}", "}", "return", "bean", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "postProcessAfterInitialization", "(", "Object", "bean", ",", "String", "beanName", ")", "throws", "BeansException", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "beanName", ",", "bean", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "return", "bean", ";", "}", "</s>"]
["<s>", "public", "static", "Collection", "<", "String", ">", "getBeanDependencies", "(", "BeanDefinition", "beanDefinition", ")", "{", "Set", "<", "String", ">", "dependencies", "=", "new", "HashSet", "<", "String", ">", "(", ")", ";", "if", "(", "beanDefinition", ".", "getDependsOn", "(", ")", "!", "=", "null", ")", "dependencies", ".", "addAll", "(", "Arrays", ".", "asList", "(", "beanDefinition", ".", "getDependsOn", "(", ")", ")", ")", ";", "for", "(", "ValueHolder", "value", ":", "beanDefinition", ".", "getConstructorArgumentValues", "(", ")", ".", "getGenericArgumentValues", "(", ")", ")", "{", "if", "(", "value", ".", "getValue", "(", ")", "instanceof", "BeanReference", ")", "dependencies", ".", "add", "(", "(", "(", "BeanReference", ")", "value", ".", "getValue", "(", ")", ")", ".", "getBeanName", "(", ")", ")", ";", "}", "for", "(", "ValueHolder", "value", ":", "beanDefinition", ".", "getConstructorArgumentValues", "(", ")", ".", "getIndexedArgumentValues", "(", ")", ".", "values", "(", ")", ")", "{", "if", "(", "value", ".", "getValue", "(", ")", "instanceof", "BeanReference", ")", "dependencies", ".", "add", "(", "(", "(", "BeanReference", ")", "value", ".", "getValue", "(", ")", ")", ".", "getBeanName", "(", ")", ")", ";", "}", "for", "(", "PropertyValue", "value", ":", "beanDefinition", ".", "getPropertyValues", "(", ")", ".", "getPropertyValueList", "(", ")", ")", "{", "if", "(", "value", ".", "getValue", "(", ")", "instanceof", "BeanReference", ")", "dependencies", ".", "add", "(", "(", "(", "BeanReference", ")", "value", ".", "getValue", "(", ")", ")", ".", "getBeanName", "(", ")", ")", ";", "}", "return", "dependencies", ";", "}", "</s>"]
["<s>", "private", "static", "DefaultListableBeanFactory", "createBeanFactory", "(", ")", "{", "return", "new", "DefaultListableBeanFactory", "(", ")", "{", "{", "final", "InstantiationStrategy", "is", "=", "getInstantiationStrategy", "(", ")", ";", "setInstantiationStrategy", "(", "new", "InstantiationStrategy", "(", ")", "{", "@", "Override", "public", "Object", "instantiate", "(", "RootBeanDefinition", "beanDefinition", ",", "String", "beanName", ",", "BeanFactory", "owner", ")", "throws", "BeansException", "{", "return", "is", ".", "instantiate", "(", "beanDefinition", ",", "beanName", ",", "owner", ")", ";", "}", "@", "Override", "public", "Object", "instantiate", "(", "RootBeanDefinition", "beanDefinition", ",", "String", "beanName", ",", "BeanFactory", "owner", ",", "Constructor", "<", "?", ">", "ctor", ",", "Object", "[", "]", "args", ")", "throws", "BeansException", "{", "final", "Object", "bean", "=", "is", ".", "instantiate", "(", "beanDefinition", ",", "beanName", ",", "owner", ",", "ctor", ",", "args", ")", ";", "addDependencies", "(", "bean", ",", "args", ")", ";", "return", "bean", ";", "}", "@", "Override", "public", "Object", "instantiate", "(", "RootBeanDefinition", "beanDefinition", ",", "String", "beanName", ",", "BeanFactory", "owner", ",", "Object", "factoryBean", ",", "Method", "factoryMethod", ",", "Object", "[", "]", "args", ")", "throws", "BeansException", "{", "final", "Object", "bean", "=", "is", ".", "instantiate", "(", "beanDefinition", ",", "beanName", ",", "owner", ",", "factoryBean", ",", "factoryMethod", ",", "args", ")", ";", "addDependencies", "(", "bean", ",", "args", ")", ";", "return", "bean", ";", "}", "}", ")", ";", "}", "private", "void", "addDependencies", "(", "Object", "bean", ",", "Object", "[", "]", "args", ")", "{", "if", "(", "bean", "instanceof", "Service", ")", "{", "for", "(", "Object", "arg", ":", "args", ")", "{", "if", "(", "arg", "instanceof", "Service", ")", "{", "(", "(", "Service", ")", "arg", ")", ".", "addDependedBy", "(", "(", "Service", ")", "bean", ")", ";", "(", "(", "Service", ")", "bean", ")", ".", "addDependsOn", "(", "(", "Service", ")", "arg", ")", ";", "}", "}", "}", "}", "}", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "instantiate", "(", "RootBeanDefinition", "beanDefinition", ",", "String", "beanName", ",", "BeanFactory", "owner", ")", "throws", "BeansException", "{", "return", "is", ".", "instantiate", "(", "beanDefinition", ",", "beanName", ",", "owner", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "instantiate", "(", "RootBeanDefinition", "beanDefinition", ",", "String", "beanName", ",", "BeanFactory", "owner", ",", "Constructor", "<", "?", ">", "ctor", ",", "Object", "[", "]", "args", ")", "throws", "BeansException", "{", "final", "Object", "bean", "=", "is", ".", "instantiate", "(", "beanDefinition", ",", "beanName", ",", "owner", ",", "ctor", ",", "args", ")", ";", "addDependencies", "(", "bean", ",", "args", ")", ";", "return", "bean", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Object", "instantiate", "(", "RootBeanDefinition", "beanDefinition", ",", "String", "beanName", ",", "BeanFactory", "owner", ",", "Object", "factoryBean", ",", "Method", "factoryMethod", ",", "Object", "[", "]", "args", ")", "throws", "BeansException", "{", "final", "Object", "bean", "=", "is", ".", "instantiate", "(", "beanDefinition", ",", "beanName", ",", "owner", ",", "factoryBean", ",", "factoryMethod", ",", "args", ")", ";", "addDependencies", "(", "bean", ",", "args", ")", ";", "return", "bean", ";", "}", "</s>"]
["<s>", "private", "void", "addDependencies", "(", "Object", "bean", ",", "Object", "[", "]", "args", ")", "{", "if", "(", "bean", "instanceof", "Service", ")", "{", "for", "(", "Object", "arg", ":", "args", ")", "{", "if", "(", "arg", "instanceof", "Service", ")", "{", "(", "(", "Service", ")", "arg", ")", ".", "addDependedBy", "(", "(", "Service", ")", "bean", ")", ";", "(", "(", "Service", ")", "bean", ")", ".", "addDependsOn", "(", "(", "Service", ")", "arg", ")", ";", "}", "}", "}", "}", "</s>"]
["<s>", "public", "static", "BeanDefinition", "defineBean", "(", "Class", "<", "?", ">", "clazz", ",", "ConstructorArgumentValues", "constructorArgs", ",", "MutablePropertyValues", "properties", ")", "{", "GenericBeanDefinition", "bean", "=", "new", "GenericBeanDefinition", "(", ")", ";", "bean", ".", "setBeanClass", "(", "clazz", ")", ";", "bean", ".", "setAutowireCandidate", "(", "true", ")", ";", "bean", ".", "setConstructorArgumentValues", "(", "constructorArgs", ")", ";", "bean", ".", "setPropertyValues", "(", "properties", ")", ";", "return", "bean", ";", "}", "</s>"]
["<s>", "private", "static", "BeanDefinition", "getMBeanExporterBeanDefinition", "(", "String", "defaultDomain", ")", "{", "final", "AnnotationJmxAttributeSource", "annotationSource", "=", "new", "AnnotationJmxAttributeSource", "(", ")", ";", "final", "GenericBeanDefinition", "bean", "=", "new", "GenericBeanDefinition", "(", ")", ";", "bean", ".", "setBeanClass", "(", "MBeanExporter", ".", "class", ")", ";", "MutablePropertyValues", "properties", "=", "new", "MutablePropertyValues", "(", ")", ";", "properties", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "ManagementFactory", ".", "getPlatformMBeanServer", "(", ")", ")", ";", "properties", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "MBeanExporter", ".", "AUTODETECT_ASSEMBLER", ")", ";", "properties", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "new", "MetadataMBeanInfoAssembler", "(", "annotationSource", ")", ")", ";", "properties", ".", "add", "(", "\"", "<STR_LIT>", "\"", ",", "new", "MBeanNamingStrategy", "(", "annotationSource", ")", ".", "setDefaultDomain", "(", "defaultDomain", ")", ")", ";", "bean", ".", "setPropertyValues", "(", "properties", ")", ";", "return", "bean", ";", "}", "</s>"]
["<s>", "public", "static", "ConstructorArgumentValues", "constructorArgs", "(", "Object", ".", ".", ".", "args", ")", "{", "ConstructorArgumentValues", "cav", "=", "new", "ConstructorArgumentValues", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "args", ".", "length", ";", "i", "+", "+", ")", "cav", ".", "addIndexedArgumentValue", "(", "i", ",", "args", "[", "i", "]", ")", ";", "return", "cav", ";", "}", "</s>"]
["<s>", "public", "static", "MutablePropertyValues", "properties", "(", "Map", "<", "String", ",", "?", "extends", "Object", ">", "properties", ")", "{", "MutablePropertyValues", "mpv", "=", "new", "MutablePropertyValues", "(", "properties", ")", ";", "return", "mpv", ";", "}", "</s>"]
["<s>", "private", "SpringContainerHelper", "(", ")", "{", "}", "</s>"]
["<s>", "protected", "Component", "(", "String", "name", ")", "{", "this", ".", "initialized", "=", "false", ";", "this", ".", "name", "=", "name", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "-", "1", ",", "description", "=", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getType", "(", ")", "{", "return", "getClass", "(", ")", ".", "getName", "(", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "-", "1", ",", "description", "=", "\"", "<STR_LIT>", "\"", ")", "public", "String", "getName", "(", ")", "{", "return", "name", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "try", "{", "init", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"", "<STR_LIT>", "\"", "+", "name", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "final", "void", "destroy", "(", ")", "throws", "Exception", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "try", "{", "shutdown", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "name", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", "+", "name", ",", "e", ")", ";", "throw", "e", ";", "}", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "0", ",", "description", "=", "\"", "<STR_LIT>", "\"", ")", "public", "boolean", "isInitialized", "(", ")", "{", "return", "initialized", ";", "}", "</s>"]
["<s>", "protected", "void", "assertDuringInitialization", "(", ")", "{", "if", "(", "initialized", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "assertInitialized", "(", ")", "{", "if", "(", "!", "initialized", ")", "throw", "new", "IllegalStateException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "assertDuringInitialization", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "assertDuringInitialization", "(", ")", ";", "this", ".", "initialized", "=", "true", ";", "}", "</s>"]
["<s>", "protected", "void", "shutdown", "(", ")", "{", "}", "</s>"]
["<s>", "@", "Override", "public", "String", "toString", "(", ")", "{", "return", "name", "+", "<CHAR_LIT:(>", "+", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", "+", "<CHAR_LIT:)>", ";", "}", "</s>"]
["<s>", "protected", "Service", "(", "String", "name", ")", "{", "super", "(", "name", ")", ";", "this", ".", "ready", "=", "false", ";", "}", "</s>"]
["<s>", "void", "addDependedBy", "(", "Service", "service", ")", "{", "assertDuringInitialization", "(", ")", ";", "dependedBy", ".", "add", "(", "service", ")", ";", "}", "</s>"]
["<s>", "void", "addDependsOn", "(", "Service", "service", ")", "{", "assertDuringInitialization", "(", ")", ";", "dependsOn", ".", "add", "(", "service", ")", ";", "}", "</s>"]
["<s>", "public", "void", "addDependency", "(", "Service", "service", ")", "{", "assertDuringInitialization", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "service", ".", "getName", "(", ")", ",", "getName", "(", ")", ")", ";", "addDependsOn", "(", "service", ")", ";", "service", ".", "addDependedBy", "(", "this", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "removeDependency", "(", "Service", "service", ")", "{", "assertDuringInitialization", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "service", ")", ";", "if", "(", "!", "dependsOn", ".", "remove", "(", "service", ")", ")", "LOG", ".", "warn", "(", "\"", "<STR_LIT>", "\"", ",", "getName", "(", ")", ",", "service", ".", "getName", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "0", ",", "description", "=", "\"", "<STR_LIT>", "\"", ")", "public", "List", "<", "String", ">", "getDependedBy", "(", ")", "{", "final", "List", "<", "String", ">", "ds", "=", "new", "ArrayList", "<", "String", ">", "(", "dependedBy", ".", "size", "(", ")", ")", ";", "for", "(", "Service", "s", ":", "dependedBy", ")", "ds", ".", "add", "(", "s", ".", "getName", "(", ")", ")", ";", "return", "ds", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "0", ",", "description", "=", "\"", "<STR_LIT>", "\"", ")", "public", "List", "<", "String", ">", "getDependsOn", "(", ")", "{", "List", "<", "String", ">", "ds", "=", "new", "ArrayList", "<", "String", ">", "(", "dependsOn", ".", "size", "(", ")", ")", ";", "for", "(", "Service", "s", ":", "dependsOn", ")", "ds", ".", "add", "(", "s", ".", "getName", "(", ")", ")", ";", "return", "ds", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "init", "(", ")", "throws", "Exception", "{", "super", ".", "init", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "getName", "(", ")", ",", "getDependsOn", "(", ")", ")", ";", "}", "</s>"]
["<s>", "@", "Override", "protected", "void", "postInit", "(", ")", "throws", "Exception", "{", "super", ".", "postInit", "(", ")", ";", "checkDependenciesAvailability", "(", ")", ";", "checkAvailability", "(", ")", ";", "runAvailableMethod", "(", ")", ";", "}", "</s>"]
["<s>", "private", "boolean", "checkDependenciesAvailability", "(", ")", "{", "synchronized", "(", "SERVICE_AVILABILITY_LOCK", ")", "{", "for", "(", "Service", "dep", ":", "dependsOn", ")", "{", "if", "(", "!", "dep", ".", "isAvailable", "(", ")", ")", "{", "dependenciesAvailable", "=", "false", ";", "return", "false", ";", "}", "}", "dependenciesAvailable", "=", "true", ";", "return", "true", ";", "}", "}", "</s>"]
["<s>", "private", "boolean", "checkAvailability", "(", ")", "{", "synchronized", "(", "SERVICE_AVILABILITY_LOCK", ")", "{", "boolean", "_available", "=", "ready", "&", "&", "dependenciesAvailable", ";", "if", "(", "_available", "!", "=", "available", ")", "{", "availabilityChanged", "=", "true", ";", "SERVICE_AVILABILITY_LOCK", ".", "notifyAll", "(", ")", ";", "this", ".", "available", "=", "_available", ";", "SERVICE_AVILABILITY_LOCK", ".", "notifyAll", "(", ")", ";", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "this", ",", "available", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "Service", "dependent", ":", "dependedBy", ")", "dependent", ".", "dependencyChanged", "(", "this", ")", ";", "}", "}", "return", "available", ";", "}", "</s>"]
["<s>", "private", "void", "runAvailableMethod", "(", ")", "{", "if", "(", "availabilityChanged", ")", "{", "available", "(", "this", ".", "available", ")", ";", "availabilityChanged", "=", "false", ";", "for", "(", "Service", "dependent", ":", "dependedBy", ")", "dependent", ".", "runAvailableMethod", "(", ")", ";", "}", "}", "</s>"]
["<s>", "private", "void", "dependencyChanged", "(", "Service", "service", ")", "{", "checkDependenciesAvailability", "(", ")", ";", "checkAvailability", "(", ")", ";", "}", "</s>"]
["<s>", "protected", "void", "available", "(", "boolean", "value", ")", "{", "}", "</s>"]
["<s>", "protected", "void", "setReady", "(", "boolean", "ready", ")", "{", "synchronized", "(", "SERVICE_AVILABILITY_LOCK", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "getName", "(", ")", ",", "ready", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "ready", "=", "ready", ";", "checkAvailability", "(", ")", ";", "}", "runAvailableMethod", "(", ")", ";", "}", "</s>"]
["<s>", "public", "void", "awaitAvailable", "(", ")", "throws", "InterruptedException", "{", "synchronized", "(", "SERVICE_AVILABILITY_LOCK", ")", "{", "while", "(", "!", "available", ")", "{", "LOG", ".", "info", "(", "\"", "<STR_LIT>", "\"", ",", "getName", "(", ")", ")", ";", "LOG", ".", "debug", "(", "getDependencyGraph", "(", ")", ")", ";", "SERVICE_AVILABILITY_LOCK", ".", "wait", "(", ")", ";", "}", "}", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "0", ")", "public", "boolean", "isReady", "(", ")", "{", "return", "ready", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "(", "currencyTimeLimit", "=", "0", ")", "public", "boolean", "isAvailable", "(", ")", "{", "return", "available", ";", "}", "</s>"]
["<s>", "@", "ManagedAttribute", "public", "String", "getDependencyGraph", "(", ")", "{", "return", "getDependencyGraph", "(", "new", "StringBuilder", "(", ")", ",", "0", ")", ".", "toString", "(", ")", ";", "}", "</s>"]
["<s>", "private", "StringBuilder", "getDependencyGraph", "(", "StringBuilder", "sb", ",", "int", "indent", ")", "{", "sb", ".", "append", "(", "<STR_LIT:\\n>", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "indent", "*", "<NUM_LIT:4>", ";", "i", "+", "+", ")", "sb", ".", "append", "(", "<CHAR_LIT>", ")", ";", "sb", ".", "append", "(", "getName", "(", ")", ")", ".", "append", "(", "\"", "<STR_LIT>", "\"", ")", ".", "append", "(", "isReady", "(", ")", "?", "\"", "<STR_LIT>", "\"", ":", "\"", "<STR_LIT>", "\"", ")", ";", "for", "(", "Service", "s", ":", "dependsOn", ")", "s", ".", "getDependencyGraph", "(", "sb", ",", "indent", "+", "1", ")", ";", "return", "sb", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Void", "getObject", "(", ")", "throws", "Exception", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "Class", "<", "?", "extends", "Void", ">", "getObjectType", "(", ")", "{", "return", "null", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "boolean", "isSingleton", "(", ")", "{", "return", "true", ";", "}", "</s>"]
["<s>", "public", "MBeanNamingStrategy", "(", ")", "{", "}", "</s>"]
["<s>", "public", "MBeanNamingStrategy", "(", "JmxAttributeSource", "attributeSource", ")", "{", "Assert", ".", "notNull", "(", "attributeSource", ",", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "attributeSource", "=", "attributeSource", ";", "}", "</s>"]
["<s>", "public", "void", "setAttributeSource", "(", "JmxAttributeSource", "attributeSource", ")", "{", "Assert", ".", "notNull", "(", "attributeSource", ",", "\"", "<STR_LIT>", "\"", ")", ";", "this", ".", "attributeSource", "=", "attributeSource", ";", "}", "</s>"]
["<s>", "public", "MBeanNamingStrategy", "setDefaultDomain", "(", "String", "defaultDomain", ")", "{", "this", ".", "defaultDomain", "=", "defaultDomain", ";", "return", "this", ";", "}", "</s>"]
["<s>", "@", "Override", "public", "void", "afterPropertiesSet", "(", ")", "{", "if", "(", "this", ".", "attributeSource", "=", "=", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"", "<STR_LIT>", "\"", ")", ";", "}", "}", "</s>"]
["<s>", "@", "Override", "public", "ObjectName", "getObjectName", "(", "Object", "managedBean", ",", "String", "beanKey", ")", "throws", "MalformedObjectNameException", "{", "Class", "managedClass", "=", "AopUtils", ".", "getTargetClass", "(", "managedBean", ")", ";", "ManagedResource", "mr", "=", "this", ".", "attributeSource", ".", "getManagedResource", "(", "managedClass", ")", ";", "if", "(", "mr", "!", "=", "null", "&", "&", "StringUtils", ".", "hasText", "(", "mr", ".", "getObjectName", "(", ")", ")", ")", "{", "return", "ObjectName", ".", "getInstance", "(", "mr", ".", "getObjectName", "(", ")", ")", ";", "}", "else", "{", "String", "domain", "=", "this", ".", "defaultDomain", ";", "if", "(", "domain", "=", "=", "null", ")", "domain", "=", "ClassUtils", ".", "getPackageName", "(", "managedClass", ")", ";", "return", "ObjectName", ".", "getInstance", "(", "domain", "+", "\"", "<STR_LIT>", "\"", "+", "beanKey", ")", ";", "}", "}", "</s>"]
